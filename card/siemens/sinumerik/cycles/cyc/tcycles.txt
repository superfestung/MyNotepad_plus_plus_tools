;----------------------------------------------------------
;
;@(#)$program_version_id:V06.24.00.00 15/07/24 15:00:00, Technology Cycles,
;
;----------------------------------------------------------
;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_TECHCYC_SPF
PROC CUST_TECHCYC(INT _MODE)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2022-11-29
; Machine Manufacturer Cycle for Technology Cycles
;----------------------------------------------------------------
; CAUTION:
; It is possible that one mode is called several times in succession.
; The machine manufacturer must therefore make sure that the repeated 
; call of an already set state does not lead to a false response at
; the machine.
;----------------------------------------------------------------
; PARAMETER:
;
; _MODE    :   Mode:
;                 1 = Main spindle: Change to C axis mode
;                 2 = Main spindle: Change to spindle mode
;                 3 = Main spindle: C axis clamping
;               403 = Main spindle: damping brake on
;                 4 = Main spindle: Release C axis clamping
;                 5 = Main spindle: Flush chuck
;                 6 = Main spindle: Close chuck
;                 7 = Main spindle: Open chuck with selection 'spindle stationary'
;                 8 = Main spindle: Open chuck with selection 'spindle rotating'
;                 9 = Main spindle: Flush chuck off
;
;                11 = Tool spindle: Change to C axis mode
;                12 = Tool spindle: Change to spindle mode
;                13 = Tool spindle: C axis clamping
;                14 = Tool spindle: Release C axis clamping
;
;                21 = Sub spindle: Change to C axis mode
;                22 = Sub spindle: Change to spindle mode
;                23 = Sub spindle: C axis clamping
;               423 = Sub spindle: damping brake on
;                24 = Sub spindle: Release C axis clamping
;                25 = Sub spindle: Flush chuck
;                26 = Sub spindle: Close chuck
;                27 = Sub spindle: Open chuck with selection 'spindle stationary'
;                28 = Sub spindle: Open chuck with selection 'spindle rotating'
;                29 = Sub spindle: Flush chuck off
;
;                30 = 4th axes after block search (e.g. sub spindle linear axis, tailstock, steady rest)
;
;                41 = Engage driven tool
;                42 = Disengage driven tool
;
;                61 = Change to turning
;                62 = Change to peripheral surface machining C
;                63 = Change to face machining C
;                64 = Change to peripheral surface machining Y
;                65 = Change to face machining Y
;                66 = Change to face machining B (swiveling)
;                67 = Deselect face machining B (swiveling)
;                68 = After block search on ST-block before swiveling
;
;               100 = Position receptacle before cut-off
;               101 = Open receptacle for cut-off
;               102 = Close receptacle after cut-off
;               103 = End of cut-off
;
;               110 = Tool change (ShopTurn, CYCLE206)
;               111 = After tool change cycle (with tool change) (ShopTurn, CYCLE206)
;               112 = Before tool change at release plane (ShopTurn)
;               113 = Before cutting edge change (ShopTurn, CYCLE206)
;               114 = After tool change cycle (without tool change) (ShopTurn)
;               115 = After tool preselection (ShopTurn)
;               116 = At tool change point (ShopTurn)
;               117 = Before tool change T (ShopMill, ShopTurn, CYCLE206)
;               118 = Output of M and H functions after tool change (ShopMill, ShopTurn)
;               119 = Before tool preselection (ShopTurn)
;
;               120 = Definition: coupling counterspindle/main spindle
;               121 = Delete definition: coupling counterspindle/main spindle
;               122 = Definition: coupling main spindle/counterspindle
;               123 = Delete definition: coupling main spindle/counterspindle
;               125 = Change to main spindle
;               126 = Change to sub spindle
;
;               131 = Program start (ShopTurn-Program)
;               132 = End program header (ShopTurn-Program)
;               135 = End program loop (ShopTurn-Program)
;               136 = Program end (ShopTurn-Program)
;
;               140 = Blocksearch before tool change
;               141 = Blocksearch after tool change (collected tool)
;               142 = Blocksearch after tool change (new tool from ShopTurn)
;
;               150 = 2-channel roughing: leading channel before balance cutting
;               151 = 2-channel roughing: leading channel after balance cutting
;               152 = 2-channel roughing: following channel before balance cutting
;               153 = 2-channel roughing: following channel after balance cutting
;               154 = 2-channel roughing: start roughing in leading channel
;               155 = 2-channel roughing: end roughing in leading channel
;               156 = 2-channel roughing: start roughing in following channel
;               157 = 2-channel roughing: end roughing in following channel
;
;               160 = Start multichannel programming
;
;               170 = Start group with spindle
;               171 = End group with spindle
;
;               231 = Program start (ShopMill-Program)
;               232 = End program header (ShopMill-Program)
;               235 = End program loop (ShopMill-Program)
;               236 = Program end (ShopMill-Program)
;
;               300 = CYCLE86 - position of spindle align to tool orientation (SD 55216 Bit6=1)
;
;               900 = Before setting the WORKPIECE (only ShopMill + ShopTurn)
;
;----------------------------------------------------------------
; GUD PARAMETER:
;
; _F_S_NR[0]:         Number of main spindle
; _F_S_NR[2]:         Number of counterspindle
; _F_S_AX[0]:         Axis variable of main spindle
; _F_S_AX[2]:         Axis variable of counterspindle
; _SC_CHAN:           Channels of the joblist ("1,2")
; _SC_ROU_CHAN[0]:    Number of leading channel for 2-channel roughing
; _SC_ROU_CHAN[1]:    Number of following channel for 2-channel roughing
; _E_ST_PRG:          ShopTurn program is active
; _TC_N_WZ:           Tool follow up (CYCLE800)
; _TC_A_WZ:           Tool orientating (CYCLE800)
; _MEA_CORR_ANGLE[0]: user correction angle for tapping
; _MEA_CORR_ANGLE[1]: cycle correction angle for tapping
;----------------------------------------------------------------
; In the variable _F_SUB_STA there is information available 
; for counterspindle acceptance in ShopTurn:
;   Bit 0: 1=Grip is ready
;   Bit 1: 1=With cut-off
;   Bit 2: 1=Grip with mainspindle is ready
;   Bit 3: 1=Backside is active
;   Bit 4: 0=Selection 'spindle stationary'; 1=Selection 'spindle rotating'
;   Bit 5: 0=Selection 'Main- to counterspindle'; 1=Selection 'Counter- to mainspindle'
; This information can be used in CUST_TECHCYC(3 - 9, 23 - 29,
;   120,121,125,126).
;----------------------------------------------------------------
; In the variable _F_PLANE there is information available about
; the next machining plane already before a tool change.
; This information can be used e.g. in CUST_TECHCYC(41, 42, 110 - 117)
; or in the tool change cycle of the manufacturer (L6) to prepare
; the following change of the machining plane during
; the tool change.
;   _F_PLANE = 61 = Turning
;   _F_PLANE = 62 = Peripheral surface C
;   _F_PLANE = 63 = Face C
;   _F_PLANE = 64 = Peripheral surface Y
;   _F_PLANE = 65 = Face Y
;   _F_PLANE = 66 = Face B (swiveling)
;----------------------------------------------------------------
; Before T change this new values are available:
;   _F_T_STR = tool name ("" = no, "0" = T0)
;   _F_DP_NO = sister tool (-1 = no)
;   _F_T_MP  = magazin place (-1 = no)
;   _F_MTL   = multitool location (-1 = no)
; This informations can only be used in CUST_TECHCYC(117).
;----------------------------------------------------------------
; Before cutting edge change the new cutting edge is available
; in the GUD _F_D_NO.
; This information can only be used in CUST_TECHCYC(113).
;----------------------------------------------------------------
; The tool number of the preselected tool is available in the GUD _F_TFI.
; The tool name of the preselected tool is available in the GUD _F_TF.
; This information can only be used in CUST_TECHCYC(115 and 119).
;----------------------------------------------------------------
; The name of the channel axis for clamping is available in the GUD _E_WP_SOCKET.
; This information can only be used in CUST_TECHCYC(900).
;----------------------------------------------------------------
DEF INT _I
DEF REAL _FAK1
DEF STRING[100] _STR
DEF CHAR _CHR=34
;
GROUP_BEGIN(1000, "DO_UPGRADE: Logic for compatibility if you upgrade software", 0,0)
  ;BEGIN_DO_UPGRADE
  ; logic for compatibility if you upgrade software
  IF (($P_PATH[$P_STACK]=="/_N_CST_DIR/") AND ($P_SUBPAR[1]==0))
    _MODE=_SC_CUST_MODE[0]
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "CASE _MODE OF ...", 0,0)
  ; Mode:
  CASE _MODE OF 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 403 GOTOF _M403 4 GOTOF _M4 5 GOTOF _M5 6 GOTOF _M6 7 GOTOF _M7 8 GOTOF _M8 9 GOTOF _M9 11 GOTOF _M11 12 GOTOF _M12 13 GOTOF _M13 14 GOTOF _M14 21 GOTOF _M21 22 GOTOF _M22 23 GOTOF _M23 423 GOTOF _M423 24 GOTOF _M24 25 GOTOF _M25 26 GOTOF _M26 27 GOTOF _M27 28 GOTOF _M28 29 GOTOF _M29 30 GOTOF _M30
  CASE _MODE OF 41 GOTOF _M41 42 GOTOF _M42 61 GOTOF _M61 62 GOTOF _M62 63 GOTOF _M63 64 GOTOF _M64 65 GOTOF _M65 66 GOTOF _M66 67 GOTOF _M67 68 GOTOF _M68
  CASE _MODE OF 100 GOTOF _M100 101 GOTOF _M101 102 GOTOF _M102 103 GOTOF _M103 110 GOTOF _M110 111 GOTOF _M111 112 GOTOF _M112 113 GOTOF _M113 114 GOTOF _M114 115 GOTOF _M115 116 GOTOF _M116 117 GOTOF _M117 118 GOTOF _M118 119 GOTOF _M119 120 GOTOF _M120 121 GOTOF _M121 122 GOTOF _M122 123 GOTOF _M123 125 GOTOF _M125 126 GOTOF _M126 131 GOTOF _M131 132 GOTOF _M132 135 GOTOF _M135 136 GOTOF _M136
  CASE _MODE OF 140 GOTOF _M140 141 GOTOF _M141 142 GOTOF _M142 150 GOTOF _M150 151 GOTOF _M151 152 GOTOF _M152 153 GOTOF _M153 154 GOTOF _M154 155 GOTOF _M155 156 GOTOF _M156 157 GOTOF _M157 160 GOTOF _M160 170 GOTOF _M170 171 GOTOF _M171
  CASE _MODE OF 231 GOTOF _M231 232 GOTOF _M232 235 GOTOF _M235 236 GOTOF _M236 300 GOTOF _M300 900 GOTOF _M900
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"DO_UPGRADE: Logic for compatibility if you upgrade software",0,0)
  ;BEGIN_DO_UPGRADE
  IF ($P_PATH[$P_STACK]<>"/_N_CST_DIR/")
    _SC_CUST_MODE[0]=REP(0)
    _SC_CUST_MODE[0]=_MODE
    N990 CALL "/_N_CST_DIR/_N_CUST_TECHCYC_SPF"
    GOTOF _MEND
  ELSE
     SETAL(61019,"_MODE="<<_MODE<<" (CUST_TECHCYC)" ) ; Parameter _MODE=n incorrectly defined
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M1 ... _M9: Main spindle",0,0)
GROUP_BEGIN(1001,"_M1: Main spindle: Change to C axis mode",0,0)
  _M1: ;
  ; Spindle is not in C axis mode or after block search
  IF(($P_SMODE[_F_S_NR[0]]<>2)AND($P_SMODE[_F_S_NR[0]]<>4))OR($P_PROG_EVENT==5)
    N10 SPOS[_F_S_NR[0]]=0       ; Spindle in C axis mode
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M2: Main spindle: Change to spindle mode",0,0)  
  _M2: ;
  IF($P_SMODE[_F_S_NR[0]]<>1); Spindle is not in spindle mode
    ;N20 M[_F_S_NR[0]]=           ; Change to spindle mode
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M3: Main spindle: C axis clamping",0,0) 
  _M3: ; Attention: The spindle must stay in C axis mode! Do not use M5!
  ;N30 M[_F_S_NR[0]]=             ; C axis clamping
  ;N35 $AC_PRTIME_A_INC=1.5       ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M403: Main spindle: damping brake on",0,0) 
  _M403: ;
  ;N4030 M[_F_S_NR[0]]=           ; damping brake on
  ;N4035 $AC_PRTIME_A_INC=1.5     ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M4: Main spindle: Release C axis clamping",0,0)
  _M4: ;
  ;N40 M[_F_S_NR[0]]=             ; Release C axis clamping
  ;N45 $AC_PRTIME_A_INC=1.5       ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M5: Main spindle: Flush chuck",0,0)
  _M5: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M6: Main spindle: Close chuck",0,0)
  _M6: ;
  IF(ISNUMBER($MCS_M_CODE_CHUCK_CLOSE[0]))
    N60 EXECSTRING("M"<<$MCS_M_CODE_CHUCK_CLOSE[0])
  ELSE
    N65 EXECSTRING($MCS_M_CODE_CHUCK_CLOSE[0])
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M7: Main spindle: Open chuck with selection 'spindle stationary'",0,0)
  _M7: ;
  IF(ISNUMBER($MCS_M_CODE_CHUCK_OPEN[0]))
    N70 EXECSTRING("M"<<$MCS_M_CODE_CHUCK_OPEN[0])
  ELSE
    N75 EXECSTRING($MCS_M_CODE_CHUCK_OPEN[0])
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M8: Main spindle: Open chuck with selection 'spindle rotating'",0,0)
  _M8: ;
  IF(ISNUMBER($MCS_M_CODE_CHUCK_OPEN_ROT[0]))
    N80 EXECSTRING("M"<<$MCS_M_CODE_CHUCK_OPEN_ROT[0])
  ELSE
    N85 EXECSTRING($MCS_M_CODE_CHUCK_OPEN_ROT[0])
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M9: Main spindle: Flush chuck off",0,0)
  _M9: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M11 ... _M14: Tool spindle",0,0)
GROUP_BEGIN(1001,"_M11: Tool spindle: Change to C axis mode",0,0)
  _M11: ; 
  ; Spindle is not in C axis mode or after block search
  IF(($P_SMODE[_F_S_NR[1]]<>4)AND($P_SMODE[_F_S_NR[1]]<>2))OR($P_PROG_EVENT==5)
    N110 SPOS[_F_S_NR[1]]=0       ;
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M12: Tool spindle: Change to spindle mode",0,0)
  _M12: ; 
  IF($P_SMODE[_F_S_NR[1]]<>1); Spindle is not in spindle mode
    ;N120 M[_F_S_NR[1]]=           ; Change to spindle mode 
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M13: Tool spindle: C axis clamping",0,0)
  _M13: ; 
  ;N130 M[_F_S_NR[1]]=             ; C axis clamping
  ;N135 $AC_PRTIME_A_INC=1.5       ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M14: Tool spindle: Release C axis clamping",0,0)
  _M14: ; 
  ;N140 M[_F_S_NR[1]]=             ; Release C axis clamping
  ;N145 $AC_PRTIME_A_INC=1.5       ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M21 ... _M29: Sub spindle",0,0)
GROUP_BEGIN(1001,"_M21: Sub spindle: Change to C axis mode",0,0)
  _M21: ;
  ; Spindle is not in C axis mode or after block search
  IF(($P_SMODE[_F_S_NR[2]]<>2)AND($P_SMODE[_F_S_NR[2]]<>4))OR($P_PROG_EVENT==5)
    N210 SPOS[_F_S_NR[2]]=0       ; Spindle in C axis mode
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M22: Sub spindle: Change to spindle mode",0,0)
  _M22: ;
  IF($P_SMODE[_F_S_NR[2]]<>1); Spindle is not is spindle mode
    ;N220 M[_F_S_NR[2]]=           ; Change to spindle mode
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M23: Sub spindle: C axis clamping",0,0)
  _M23: ; Attention: The spindle must stay in C axis mode! Do not use M5!
  ;N230 M[_F_S_NR[2]]=             ; C axis clamping
  ;N235 $AC_PRTIME_A_INC=1.5       ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M423: Sub spindle: damping brake on",0,0) 
  _M423: ;
  ;N4230 M[_F_S_NR[0]]=            ; damping brake on
  ;N4235 $AC_PRTIME_A_INC=1.5      ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M24: Sub spindle: Release C axis clamping",0,0)
  _M24: ;
  ;N240 M[_F_S_NR[2]]=             ; Release C axis clamping
  ;N245 $AC_PRTIME_A_INC=1.5       ; increase auxillary time by 1.5 seconds
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M25: Sub spindle: Flush chuck",0,0)
  _M25: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M26: Sub spindle: Close chuck",0,0)
  _M26: ;
  IF(ISNUMBER($MCS_M_CODE_CHUCK_CLOSE[1]))
    N260 EXECSTRING("M"<<$MCS_M_CODE_CHUCK_CLOSE[1])
  ELSE
    N265 EXECSTRING($MCS_M_CODE_CHUCK_CLOSE[1])
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M27: Sub spindle: Open chuck with selection 'spindle stationary'",0,0)
  _M27: ;
  IF(ISNUMBER($MCS_M_CODE_CHUCK_OPEN[1]))
    N270 EXECSTRING("M"<<$MCS_M_CODE_CHUCK_OPEN[1])
  ELSE
    N275 EXECSTRING($MCS_M_CODE_CHUCK_OPEN[1])
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M28: Sub spindle: Open chuck with selection 'spindle rotating'",0,0)
  _M28: ;
  IF(ISNUMBER($MCS_M_CODE_CHUCK_OPEN_ROT[1]))
    N280 EXECSTRING("M"<<$MCS_M_CODE_CHUCK_OPEN_ROT[1])
  ELSE
    N285 EXECSTRING($MCS_M_CODE_CHUCK_OPEN_ROT[1])
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M29: Sub spindle: Flush chuck off",0,0)
  _M29: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M30: 4th axes after block search (e.g. sub spindle linear axis, tailstock, steady rest)",0,0)
  _M30: ;
  IF(_F_AX_EXISTS[3]) ; axis exists
    ; Factor 1 for conversion of system variables into actual inch/metric system:
    IF($P_GG[13]<3)                     
      _FAK1=1
      IF($MN_SCALING_SYSTEM_IS_METRIC)  
        IF($P_GG[13]==1)                
         _FAK1=1/$MN_SCALING_VALUE_INCH 
        ENDIF
      ELSE                              
        IF($P_GG[13]==2)                
          _FAK1=$MN_SCALING_VALUE_INCH  
        ENDIF
      ENDIF
    ELSE                                
      _FAK1=1
    ENDIF
    IF($AA_FXS[_F_S_AX[3]]==0)    ; no travel to fixed stop
      IF($MA_BASE_FUNCTION_MASK[_F_S_AX[3]] B_AND 'H100') ; Positioning axis (bit 8)
        FPRAOF(_F_S_AX[3])          ; Feedrate per revoluion axial off
        N300 G0 POS[_F_S_AX[3]]=$AC_RETPOINT[_F_S_AX[3]]*_FAK1
      ELSE ; NC axis
        N301 G0 AX[_F_S_AX[3]]=$AC_RETPOINT[_F_S_AX[3]]*_FAK1
      ENDIF
    ENDIF
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M41 ... _M42: Driven tool",0,0)
GROUP_BEGIN(1001,"_M41: Engage driven tool",0,0)
  _M41: ;
  ;N410 M[_F_S_NR[1]]=             ; Engage driven tool
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M42: Disengage driven tool",0,0)
  _M42: ;
  N420 M[_F_S_NR[1]]=5            ; Stop spindle
  ;N425 M[_F_S_NR[1]]=             ; Disengage driven tool
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M61 ... _M68: Machining surface",0,0)
GROUP_BEGIN(1001,"_M61: Change to turning",0,0)
  _M61: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M62: Change to peripheral surface machining C",0,0)
  _M62: ; Change to peripheral surface machining C
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M63: Change to face machining C",0,0)
  _M63: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M64: Change to peripheral surface machining Y",0,0)
  _M64: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M65: Change to face machining Y",0,0)
  _M65: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M66: Change to face machining B (swiveling)",0,0)
  _M66: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M67: Deselect face machining B (swiveling)",0,0)
  _M67: ;
  ;N670 CYCLE800()
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M68: After block search on ST-block before swiveling",0,0)
  _M68: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M100 ... _M103: Cut-off",0,0)
GROUP_BEGIN(1001,"_M100: Position receptacle before cut-off",0,0)
  _M100: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M101: Open receptacle for cut-off",0,0)
  _M101: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M102: Close receptacle after cut-off",0,0)
  _M102: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M103: End of cut-off",0,0)
  _M103: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M110 ... _M119: Tool change",0,0)
GROUP_BEGIN(1001,"_M110: Tool change",0,0)
  _M110: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M111: After tool change cycle (with tool change)",0,0)
  _M111: ;
  ; if ShopTurn program is active and tool change with M6
  IF(_E_ST_PRG)AND($MC_TOOL_CHANGE_MODE==1)
    _I=0                           ; not tool type
    IF($P_TOOL>0)                  ; D > 0
      _I=$P_AD[1]                  ; tool type
    ENDIF
    IF(_I<>731)AND(_I<>732)        ; not Par quill or Steady rest
      N1110 F_HOME                 ; Go home to tool change point
    ENDIF
  ENDIF                       
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M112: Before tool change at release plane",0,0)
  _M112: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M113: Before cutting edge change",0,0)
  _M113: ;
  ; the new cutting edge is available in the GUD _F_D_NO
  ; if ShopTurn program is active and tool change with M6
  IF(_E_ST_PRG)
    _I=0                           ; not tool type
    IF($P_TOOL>0)                  ; D > 0
      _I=$P_AD[1]                  ; tool type
    ENDIF
    IF(_I<>731)AND(_I<>732)        ; not Par quill or Steady rest
      N1130 F_HOME                 ; Go home to tool change point
    ENDIF
  ENDIF                       
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M114: After tool change cycle (without tool change)",0,0)
  _M114: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M115: After tool preselection",0,0)
  _M115: ;
  ; the tool number of the preselected tool is available in GUD _F_TFI
  ; the tool name of the preselected tool is available in GUD _F_TF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M116: At tool change point",0,0)
  _M116: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M117: Before tool change T",0,0)
  _M117: ;
  IF(_E_SM_PRG)                  ; ShopMill program
    ;N1170 F_HOME(1)              ; Retract (after turning)
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M118: Output of M and H functions after tool change",0,0)
  _M118: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M119: Before tool preselection",0,0)
  _M119: ;
  ; the tool number of the preselected tool is available in GUD _F_TFI
  ; the tool name of the preselected tool is available in GUD _F_TF
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M120 ... _M126: Coupling counterspindle/main spindle",0,0)
GROUP_BEGIN(1001,"_M120: Definition: coupling counterspindle/main spindle",0,0)
  _M120: ;
  N1200 COUPOF(SPI(_F_S_NR[0]),SPI(_F_S_NR[2]))
  N1201 COUPDEL(SPI(_F_S_NR[0]),SPI(_F_S_NR[2]))
  N1202 COUPDEF(SPI(_F_S_NR[2]),SPI(_F_S_NR[0]),1,1,"NOC","DV")
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M121: Delete definition: coupling counterspindle/main spindle",0,0)
  _M121: ;
  N1210 COUPDEL(SPI(_F_S_NR[2]),SPI(_F_S_NR[0]))
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M122: Definition: coupling main spindle/counterspindle",0,0)
  _M122: ;
  N1220 COUPOF(SPI(_F_S_NR[2]),SPI(_F_S_NR[0]))
  N1221 COUPDEL(SPI(_F_S_NR[2]),SPI(_F_S_NR[0]))
  N1222 COUPDEF(SPI(_F_S_NR[0]),SPI(_F_S_NR[2]),1,1,"NOC","DV")
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M123: Delete definition: coupling main spindle/counterspindle",0,0)
  _M123: ;
  N1230 COUPDEL(SPI(_F_S_NR[0]),SPI(_F_S_NR[2]))
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M125: Change to main spindle",0,0)
  _M125: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M126: Change to sub spindle",0,0)
  _M126: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M131 ... _M136: ShopTurn-Program",0,0)
GROUP_BEGIN(1001,"_M131: Program start (ShopTurn-Program)",0,0)
  _M131: ;
  _TC_N_WZ=0                     ; initialization
  _TC_A_WZ=0                     ; initialization
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M132: End program header (ShopTurn-Program)",0,0)
  _M132: ;
  _I=0                           ; not tool type
  IF($P_TOOL>0)                  ; D > 0
    _I=$P_AD[1]                  ; tool type
  ENDIF
  IF(_I<>731)AND(_I<>732)        ; not Par quill or Steady rest
    N1320 F_HOME                 ; Go home to tool change point
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M135: End program loop (ShopTurn-Program)",0,0)
  _M135: ;
    N1350 F_HOME                 ; Go home to tool change point
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M136: Program end (ShopTurn-Program)",0,0)
  _M136: ;
  _I=0                           ; not tool type
  IF($P_TOOL>0)                  ; D > 0
    _I=$P_AD[1]                  ; tool type
  ENDIF
  IF(_I<>731)AND(_I<>732)        ; not Par quill or Steady rest
    N1360 F_HOME                 ; Go home to tool change point
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M140 ... _M142: Blocksearch and tool change",0,0)
GROUP_BEGIN(1001,"_M140: Blocksearch before tool change",0,0)
  _M140: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M141: Blocksearch after tool change (collected tool)",0,0)
  _M141: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M142: Blocksearch after tool change (new tool from ShopTurn)",0,0)
  _M142: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M150 ... _M157: 2-channel roughing",0,0)
GROUP_BEGIN(1001,"_M150: 2-channel roughing: leading channel before balance cutting",0,0)
  _M150: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M151: 2-channel roughing: leading channel after balance cutting",0,0)
  _M151: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M152: 2-channel roughing: following channel before balance cutting",0,0)
  _M152: ;
  ; axis couplings activate (example for channel axis: X1, Z1, X2, Z2, ...)
  _STR="CPLON[X"<<_SC_ROU_CHAN[1]<<"]=(X"<<_SC_ROU_CHAN[0]<<") CPSETTYPE[X"<<_SC_ROU_CHAN[1]<<"]="<<_CHR<<"TRAIL"<<_CHR<<" CPLNUM[X"<<_SC_ROU_CHAN[1]<<",X"<<_SC_ROU_CHAN[0]<<"]=1"
  EXECSTRING(_STR) ; CPLON[X2]=(X1) CPSETTYPE[X2]="TRAIL" CPLNUM[X2,X1]=1
  _STR="CPLON[Z"<<_SC_ROU_CHAN[1]<<"]=(Z"<<_SC_ROU_CHAN[0]<<") CPSETTYPE[Z"<<_SC_ROU_CHAN[1]<<"]="<<_CHR<<"TRAIL"<<_CHR<<" CPLNUM[Z"<<_SC_ROU_CHAN[1]<<",Z"<<_SC_ROU_CHAN[0]<<"]=1"
  EXECSTRING(_STR) ; CPLON[Z2]=(Z1) CPSETTYPE[Z2]="TRAIL" CPLNUM[Z2,Z1]=1
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M153: 2-channel roughing: following channel after balance cutting",0,0)
  _M153: ;
  ; axis couplings deactivate (example for channel axis: X1, Z1, X2, Z2, ...)
  _STR="CPLOF[X"<<_SC_ROU_CHAN[1]<<"]=(X"<<_SC_ROU_CHAN[0]<<")"
  EXECSTRING(_STR) ; CPLOF[X2]=(X1)
  _STR="CPLOF[Z"<<_SC_ROU_CHAN[1]<<"]=(Z"<<_SC_ROU_CHAN[0]<<")"
  EXECSTRING(_STR) ; CPLOF[Z2]=(Z1)
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M154: 2-channel roughing: start roughing in leading channel",0,0)
  _M154: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M155: 2-channel roughing: end roughing in leading channel",0,0)
  _M155: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M156: 2-channel roughing: start roughing in following channel",0,0)
  _M156: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M157: 2-channel roughing: end roughing in following channel",0,0)
  _M157: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M160: Start multichannel programming",0,0)
  _M160: ;
  ; Start of all other channels of the joblist (up to channel 9) from the first programmed channel
  ;IF(_SC_CHAN<>"")AND(NOT $P_SIM)AND(NOT $AC_SERUPRO) ; not in simulation and block search
    ; only in the first programmed channel
    ;IF(NUMBER(SUBSTR(_SC_CHAN,0,1))==$P_CHANNO)
      ;_I=2
      ; loop over all channels
      ;WHILE(_I<STRLEN(_SC_CHAN))
        ;START(NUMBER(SUBSTR(_SC_CHAN,_I,1)))
        ;_I=_I+2
      ;ENDWHILE
    ;ENDIF
  ;ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M170 ... _M171: Group with spindle",0,0)
GROUP_BEGIN(1001,"_M170: Start group with spindle",0,0)
  _M170: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M171: End group with spindle",0,0)
  _M171: ;
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M231 ... _M236: ShopMill-Program",0,0)
GROUP_BEGIN(1001,"_M231: Program start (ShopMill-Program)",0,0)
  _M231: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M232: End program header (ShopMill-Program)",0,0)
  _M232: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M235: End program loop (ShopMill-Program)",0,0)
  _M235: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M236: Program end (ShopMill-Program)",0,0)
  _M236: ;
  ;N2360 F_HOME(2)                ; Retract to release plane (after turning)
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M300: CYCLE86 - position of spindle align to tool orientation (SD 55216 Bit6=1)",0,0)
  _M300: ;
  ;_MEA_CORR_ANGLE[0]=                    ; set user correction angle for retract when boring. Acts as an offset.
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M900: Before setting the WORKPIECE (only ShopMill + ShopTurn)",0,0)
  _M900: ;
  ; The name of the channel axis for clamping is available in the GUD _E_WP_SOCKET.
  GOTOF _MEND
GROUP_END(1000,0)
;
_MEND:
RET
;----------------------------------------------------------------
; END
;----------------------------------------------------------------

;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_800_SPF
N800 PROC CUST_800(INT _MODE,INT _TC1,REAL _A1,REAL _A2,INT _TC2,REAL _T_POS) SBLOF DISPLOF
;customer cycle to cycle800
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.007 ;DATE: 2024-04-24
;-----------------------------------------------------------
; Inclinable head/table cycle for machine manufacturer
;
; PARAMETERS:
;
; _MODE    :   Mode:
;    ShopMill/ShopTurn   2 = Change magazine tool
;    ShopMill/ShopTurn   3 = Change hand tool
;    ShopMill            4 = Change new swivel head automatically
;    ShopMill            5 = Change new swivel head manually
;    ShopMill            6 = Change old swivel head automatically
;    ShopMill            7 = Change old swivel head manually
;    ShopMill            8 = Change swivel heads automatically
;    ShopMill            9 = Change swivel heads manually
;    ShopMill           10 = Angle adapted to angle grid
;    ShopMill/ShopTurn  11 = Initialize angles at program start
;    ShopMill           12 = Swivel after tool change (AUTO)
;    ShopMill           13 = Swivel after tool change (JOG)
;    ShopMill           14 = Retract after swivel
;    ShopMill           15 = Retract after block search
;                       16 = Change old swivel in JOG
;                       20 = Swivel Round axes 1,2 automatic. Tracking with TRAORI(1)
;                       21 = Swivel Round axis 1 manual, Round axis 2 automatic swivel. Tracking with TRAORI(1)
;                       22 = Swivel Round axis 1 automatic. Tracking with TRAORI(1)
;                       23 = Swivel Round axis 1 manual 
;                       30 = Swivel Round axis 1 automatic, Round axis 2 manual . Tracking with TRAORI(1) 
;                       31 = Swivel Round axes 1,2 manual
;                       34 = Block search Round axis 1 and/or Round axis 2 automatic 
;                       35 = Block search Round axis 1 and/or Round axis 2 manual 
;                       40 = User Init
;                       41 = axis Z MCS-Fixpoint
;                       42 = axis Z and after axes XY MCS-Fixpoint
;                      440 = Tool direction retract zero 
;                       44 = Tool direction retract maximal
;                      450 = Tool direction retract zero
;                       45 = Tool direction retract incrementel
;    ShopMill           46 = Tool retract modal after block search
;                       47 = Axis Z MCS-Fixpoint before align tool
;                       48 = Axis Z and after axes XY MCS-Fixpoint before align tool
;                       57,58,59 = JOG Swivel + TRAORI (Area G17,G18,G19)
;                       70 = Align tool: Initialization
;                       71 = Align tool: Swivel round axis
;                       72 = Align tool: End
;                       75 = Align tool: Deselection
;                       80 = Interpolationturning: Initialization
;                       81 = Interpolationturning: Before transformation selection
;                       82 = Interpolationturning: After transformation selection
;                       83 = Interpolationturning: End of selection
;                       85 = Interpolationturning: Deselection
;                      996 = Position Roundaxes with measure kinematic (Call by CYCLE9960)
; re. 40 --> User Init
;  1. Before 1st calculation of the frame, the user can incorporate his own initialization in the CUST_800 
;  2. In CUST_800 the user can interrogate the variables _TC_N_WZ and _TC_A_WZ and switch on e.g. TRAORI.
; re. 41,42
;  The user can modify as appropriate the NC blocks for tool retraction before swivelling
;  This means that the tool retraction positions (see IBN screen SWIVEL) can be traversed absolutely or incrementally.
;
; _TC1     :   Number of the swivel head / swivel bench 
; _A1      :   Angle of the 1st turning axis 
; _A2      :   Angle of the 2st turning axis
; _TC2     :   Feed overide % for JOG swivel, only for ShopMill: Number of new swivel head/table when changing
; _T_POS   :   incremental position for incremental retraction in tool direction (MODE 44,45)
;
; Global Data:
; _TC_FR   : ones' place:
;              0 = No tool retraction
;              1 = Tool retraction axis Z MCS-Fixpoint
;              2 = Tool retraction axis Z and after axes XY MCS-Fixpoint
;              3 = reserved
;              4 = Tool direction retract maximal
;              5 = Tool direction retract incrementel
;            thousands' place:
;              0 = Swivel in AUTO
;              1 = Swivel in JOG
; _TC_N_WZ : Tracking tool
; _TC_A_WZ : Align tool
; _TC_POS_DIR : table positioning direction (for _MODE=20 and 21)
;               (Only toggle state from mask(note SD 55221 Bit 10). The function must be implemented by manufacturer.)
;                  0 = automatic (shortest way)
;                 -1 = direction -
;                 +1 = direction +
; _F_S_NR[0]:  Number of turn spindle (table)
; _F_S_NR[1]:  Number of tool spindle
;----------------------------------------------------------
DEF INT _M345=5,_SPINU=1,_DD,_UI_ACT,_TCRD,_MD21104,_TC_OLD
DEF INT S_G_1,S_G_10,S_G_25,S_G_51,S_G_14,S_G_15,S_G_49,_MEA_COLL,_MEA_IN,_ALARM,_MODE216
DEF REAL _A1_DIFF,_A2_DIFF,_FAK1,_FAK2,_TOOLL[3],_TOOLO[4],_LEN[11],_CAL[10]
DEF AXIS _AX1,_AX2,_MOVAX
DEF STRING[60] _SERR       
;
GROUP_BEGIN(1000, "DO_UPGRADE: Logic for compatibility if you upgrade software", 0,0)
  ;BEGIN_DO_UPGRADE
  ; logic for compatibility if you upgrade software
  IF (($P_PATH[$P_STACK]=="/_N_CST_DIR/") AND ($P_SUBPAR[1]==0))
    _MODE=_SC_CUST_MODE[0]
    _TC1=_SC_CUST_MODE[1]
    _A1=_SC_CUST_MODE[2]
    _A2=_SC_CUST_MODE[3]
    _TC2=_SC_CUST_MODE[4]
    _T_POS=_SC_CUST_MODE[5]
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "Swivel Round axes", 0,0)
CYCLE213(_TC1)
  IF ((_MODE>=21)AND(_MODE<=31))
    IF _TC2                                   
      _SPINU=$AC_MSNUM _M345=$AC_SDIR[_SPINU] 
    ELSE                                      
      _SPINU=$P_MSNUM _M345=$P_SDIR[_SPINU]   
    ENDIF
  ENDIF
  ;
  IF ((_MODE>=20)AND(_MODE<=31))
    IF ISVAR("$MC_ORI_IPO_WITH_G_CODE") 
      _MD21104=$MC_ORI_IPO_WITH_G_CODE  
    ELSE
      _MD21104=0
    ENDIF
  ENDIF
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "Factor for Inch/Metric-conversion of system variables", 0,0)
  _FAK1=1 _FAK2=1
  IF($MN_SCALING_SYSTEM_IS_METRIC)  
    IF(($P_GG[13]==1) OR ($P_GG[13]==3)) 
      _FAK2=1/$MN_SCALING_VALUE_INCH 
    ENDIF
    IF($P_GG[13]==1)
      _FAK1=1/$MN_SCALING_VALUE_INCH 
    ENDIF
  ELSE                              
    IF(($P_GG[13]==2) OR ($P_GG[13]==4)) 
      _FAK2=$MN_SCALING_VALUE_INCH  
    ENDIF
    IF($P_GG[13]==2)                
      _FAK1=$MN_SCALING_VALUE_INCH  
    ENDIF
  ENDIF
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "Read tool length for MCS-Fixpoint", 0,0)
  IF (_MODE==41)OR(_MODE==42)OR(_MODE==47)OR(_MODE==48) 
  
    TRAFOOF
    IF $P_TOOLNO==0 
      _LEN[2]=SET(-$AC_ACT_ORI_TOOL_LENGTH[1],-$AC_ACT_ORI_TOOL_LENGTH[2],-$AC_ACT_ORI_TOOL_LENGTH[3])
      IF ($MN_G53_TOOLCORR B_AND 'H01') 
        _LEN[2]=SET(_LEN[2]-$P_TOOLO[1]*$P_TOFFL[1],_LEN[3]-$P_TOOLO[2]*$P_TOFFL[1],_LEN[4]-$P_TOOLO[3]*$P_TOFFL[1])
      ENDIF
    ELSE
      IF ($MN_G53_TOOLCORR B_AND 'H01')
        _ALARM=GETTCOR(_LEN,"T:M")
      ELSE
        _ALARM=GETTCOR(_LEN,":M")
        _LEN[2]=SET(_LEN[2]+$P_TOOLO[1]*$P_TOFFL[1],_LEN[3]+$P_TOOLO[2]*$P_TOFFL[1],_LEN[4]+$P_TOOLO[3]*$P_TOFFL[1])
      ENDIF
    ENDIF
    IF $P_GG[6]==1 
      _TOOLL[0]=SET(_LEN[2],_LEN[3],_LEN[4])
    ELSE
      IF $P_GG[6]==2 
        _TOOLL[0]=SET(_LEN[3],_LEN[4],_LEN[2])
      ELSE 
        _TOOLL[0]=SET(_LEN[4],_LEN[2],_LEN[3])
      ENDIF
    ENDIF 
    _UI_ACT=$P_GG[8] 
  ENDIF
  ;
  IF (_MODE==44)OR(_MODE==45)
    _ALARM=GETTCOR(_LEN,"-T:M")
    
    _CAL[0]=SET($P_TOOLBIN[1],$P_TOOLBIN[2],$P_TOOLBIN[3],0,1)
    _MODE216=11
    CYCLE216(_CAL,_MODE216)
    IF $P_GG[6]==1 ;G17 XY Z
      _CAL[3]=SET(_CAL[0],_CAL[1],_CAL[2])
    ELSE
      IF $P_GG[6]==2 ;G18 ZX Y
        _CAL[3]=SET(_CAL[2],_CAL[0],_CAL[1])
      ELSE 
        _CAL[3]=SET(_CAL[1],_CAL[2],_CAL[0])
      ENDIF
    ENDIF
  ENDIF
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "Save particular G groups", 0,0)
  S_G_1=$P_GG[1]   ; G0, ...
  S_G_10=$P_GG[10] ; G60, ...
  S_G_14=$P_GG[14] ; G90, ..
  S_G_15=$P_GG[15] ; G94, ..
  S_G_25=$P_GG[25] ; ORIMKS, ...
  IF(_MD21104==1) 
    S_G_51=$P_GG[51] ; ORIAXES, ...
  ENDIF
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "CASE _MODE OF ...", 0,0)
  N800 CASE _MODE OF 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 5 GOTOF _M5 6 GOTOF _M6 7 GOTOF _M7 8 GOTOF _M8 9 GOTOF _M9 10 GOTOF _M10 11 GOTOF _M11 12 GOTOF _M12 13 GOTOF _M13 14 GOTOF _M14 15 GOTOF _M15 16 GOTOF _M16 20 GOTOF _M20 21 GOTOF _M21 22 GOTOF _M22 23 GOTOF _M23 30 GOTOF _M30 31 GOTOF _M31 34 GOTOF _M34 35 GOTOF _M35 40 GOTOF _M40 41 GOTOF _M41 42 GOTOF _M42 44 GOTOF _M44 45 GOTOF _M45 46 GOTOF _M46 57 GOTOF _M57 58 GOTOF _M58 59 GOTOF _M59 
  N809 CASE _MODE OF 47 GOTOF _M47 48 GOTOF _M48 70 GOTOF _M70 71 GOTOF _M71 72 GOTOF _M72 75 GOTOF _M75 80 GOTOF _M80 81 GOTOF _M81 82 GOTOF _M82 83 GOTOF _M83 85 GOTOF _M85 90 GOTOF _M90 91 GOTOF _M91 92 GOTOF _M92 95 GOTOF _M95 440 GOTOF _M440 450 GOTOF _M450 996 GOTOF _M996
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "DO_UPGRADE: Logic for compatibility if you upgrade software", 0,0)
  ;BEGIN_DO_UPGRADE
  IF ($P_PATH[$P_STACK]<>"/_N_CST_DIR/")
    _SC_CUST_MODE[0]=REP(0)
    _SC_CUST_MODE[0]=SET(_MODE,_TC1,_A1,_A2,_TC2,_T_POS)
    N990 CALL "/_N_CST_DIR/_N_CUST_800_SPF"
    GOTOF _MEND
  ELSE
     SETAL(61019,"_MODE="<<_MODE<<" (CUST_800)" ); Parameter _MODE=n incorrectly defined
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_M2: Change magazine tool",0,0)
  _M2: ;
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    N80020 E_SWIV_H(_TC1,0,0)      ; swivel axes to 0 degree
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M3: Change hand tool", 0,0) 
  _M3: ;
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    N80030 E_SWIV_H(_TC1,0,0)      ; swivel axes to 0 degree
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M4 ... _M9: Change swivel head", 0,0) 
GROUP_BEGIN(1001, "_M4: Change new swivel head automatically", 0,0) 
  _M4: ;
  ;STORE_TOOL                      ; Store tool
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M5: Change new swivel head manually", 0,0) 
  _M5: ;
  ;STORE_TOOL                      ; Store tool
  N80050 M0                        ; wait for NC start
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M6: Change old swivel head automatically", 0,0) 
  _M6: ;
  ;N800060 STORE_TOOL              ; Store tool
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    IF(NOT _E_MAN)                 ; not JOG
      N80060 E_SWIV_H(_TC1,0,0)    ; swivel axes to 0 degree
    ENDIF
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M7: Change old swivel head manually", 0,0) 
  _M7: ;
  ;STORE_TOOL                      ; Store tool
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    IF(NOT _E_MAN)                 ; not JOG
      N80070 E_SWIV_H(_TC1,0,0)    ; swivel axes to 0 degree
    ENDIF
  ENDIF
  N80072 M0                        ; wait for NC start
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M8: Change swivel heads automatically", 0,0) 
  _M8: ;
  ;STORE_TOOL                      ; Store tool
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    N80080 E_SWIV_H(_TC1,0,0)      ; swivel axes to 0 degree
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M9: Change swivel heads manually", 0,0) 
  _M9: ;
  ;STORE_TOOL                      ; Store tool
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    N80090 E_SWIV_H(_TC1,0,0)      ; swivel axes to 0 degree
  ENDIF
  N80092 M0                        ; wait for NC start
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M10: Angle adapted to angle grid", 0,0) 
  _M10: ;
  _A1_DIFF=ROUND(1000*$P_TCDIFF[1])/1000
  IF $TC_CARR36[_TC1]==""          ; 1 axis kinematics
    _SERR=<<$TC_CARR34[_TC1]<<"  "<<$TC_CARR35[_TC1]<<": "<<_A1_DIFF
  ELSE
    _A2_DIFF=ROUND(1000*$P_TCDIFF[2])/1000
    _SERR=<<$TC_CARR34[_TC1]<<"  "<<$TC_CARR35[_TC1]<<": "<<_A1_DIFF<<"  "<<$TC_CARR36[_TC1]<<": "<<_A2_DIFF
  ENDIF
  SETAL(62185,_SERR)               ; angle adapted to angle grid
  M0                               ; wait for NC start
  STOPRE
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M11: Initialize angles at program start", 0,0) 
  _M11: ;
  IF(TRUNC($TC_CARR37[_TC1]/10) MOD 10 == 0)AND($TC_CARR35[_TC1]<>"")
    _AX1=AXNAME($TC_CARR35[_TC1]) 
    _TC_A1=$P_EP[_AX1]       
  ELSE                       
    _TC_A1=_SC_A_NO_VAL      
  ENDIF
  IF(TRUNC($TC_CARR37[_TC1]/100) MOD 10 == 0)AND($TC_CARR36[_TC1]<>"")
    _AX2=AXNAME($TC_CARR36[_TC1]) 
    _TC_A2=$P_EP[_AX2]       
  ELSE                       
    _TC_A2=_SC_A_NO_VAL      
  ENDIF
  ;
  ; Initialize toolcarrier for actual angles
  IF(_TC_A1<>_SC_A_NO_VAL)
    $TC_CARR13[$P_TC]=_TC_A1
  ENDIF  
  IF(_TC_A2<>_SC_A_NO_VAL)
    $TC_CARR14[$P_TC]=_TC_A2
  ENDIF  
  TCOABS TCARR=$P_TC
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M12 Swivel after tool change (AUTO))", 0,0) 
  _M12: ;
  IF($MCS_TECHNOLOGY==2)           ; milling
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    N800120 E_SWIV_H(_TC1,_A1,_A2) ; swivel
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M13: Swivel after tool change (JOG)", 0,0) 
  _M13: ;
  IF($MCS_TECHNOLOGY==2)           ; milling
    CUST_800(41,_TC1)              ; tool retract Z
    N800130 E_SWIV_H(_TC1,_A1,_A2) ; swivel
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M14: Retract after swivel", 0,0) 
  _M14: ;
  IF($MCS_TECHNOLOGY==2)           ; milling
    N800140 E_SP_RP(30)            ; retract to retraction plane
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M15: Retract after block search", 0,0) 
  _M15: ;
  IF($MCS_TECHNOLOGY==2)           ; milling
    N800150 E_SP_RP(30)            ; retract to retraction plane
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M16 Change old swivel data in JOG", 0,0) 
  _M16: ;
  ;STORE_TOOL                      ; Store tool
  IF($MCS_TECHNOLOGY==2)     
    IF((_TC_FR MOD 10)AND(_TC1))   ; tool retract
      ;CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
    ENDIF
    ;N8006 E_SWIV_H(_TC1,0,0)      ; swivel axes to 0 degree
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M20 ... _M31: Swivel Round axes", 0,0) 
GROUP_BEGIN(1001, "_M20: Swivel Round axes 1 and 2 automatic. Tracking with TRAORI(1)", 0,0) 
  _M20: ;
  _UI_ACT=$P_GG[8] 
  IF ((_TC_N_WZ==1) AND (NOT $P_SEARCH) AND (NOT $P_ISTEST))
    IF($P_GG[49]==3) ; if PTPG0 is active
       S_G_49=1 ; memorize PTPG0
       CP ; activate CP
    ELSE
       S_G_49=0 ; PTPG0 ist no active
    ENDIF
    TCARR=0 PAROTOF
    ORIMKS
    IF _MD21104==1 
      ORIAXES
    ENDIF        
    TRAORI(1)          
    G[8]=_UI_ACT 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800200 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1 AX[AXNAME($TC_CARR36[ _TC1])]=_A2
    SBLOF
    TRAFOOF
    G[8]=_UI_ACT 
    TCARR=_TC1
    PAROT
    IF(S_G_49==1) ;  if PTPG0 was active
      PTPG0 ; reset PTPG0
    ENDIF
  ELSE 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800201 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1 AX[AXNAME($TC_CARR36[ _TC1])]=_A2
    SBLOF
  ENDIF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M21 Swivel Round axis 2 automatic, Round axis 1 manual or semi automatic. Tracking with TRAORI(1)", 0,0) 
  _M21: ;
  _UI_ACT=$P_GG[8] 
  IF ((_TC_N_WZ==1) AND (NOT $P_SEARCH) AND (NOT $P_ISTEST)) 
    IF($P_GG[49]==3) ; if PTPG0 is active
       S_G_49=1 ; memorize PTPG0
       CP ; activate CP
    ELSE
       S_G_49=0 ; PTPG0 ist no active
    ENDIF
    TCARR=0 PAROTOF
    ORIMKS
    IF _MD21104==1 
      ORIAXES
    ENDIF        
    TRAORI(1)          
    G[8]=_UI_ACT 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800210 G0 G90 AX[AXNAME($TC_CARR36[_TC1])]=_A2
    SBLOF
    TRAFOOF
    G[8]=_UI_ACT 
    TCARR=_TC1
    PAROT
    IF(S_G_49==1) ;  if PTPG0 was active
      PTPG0 ; reset PTPG0
    ENDIF
  ELSE 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800211 G0 G90 AX[AXNAME($TC_CARR36[_TC1])]=_A2
    SBLOF
  ENDIF
  IF ((_M345==3) OR (_M345==4)) 
    M[_SPINU]=5 
    M0                             ; wait for NC start
    M[_SPINU]=_M345 
  ELSE
    M0                             ; wait for NC start
  ENDIF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M22: Swivel Round axis 1 automatic. Tracking with TRAORI(1)", 0,0) 
  _M22: ;
  _UI_ACT=$P_GG[8] 
  IF ((_TC_N_WZ==1) AND (NOT $P_SEARCH) AND (NOT $P_ISTEST)) 
    IF($P_GG[49]==3) ; if PTPG0 is active
       S_G_49=1 ; memorize PTPG0
       CP ; activate CP
    ELSE
       S_G_49=0 ; PTPG0 ist no active
    ENDIF
    TCARR=0 PAROTOF
    ORIMKS
    IF _MD21104==1 
      ORIAXES
    ENDIF        
    TRAORI(1)          
    G[8]=_UI_ACT 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800220 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1
    SBLOF
    TRAFOOF
    G[8]=_UI_ACT 
    TCARR=_TC1
    PAROT
    IF(S_G_49==1) ;  if PTPG0 was active
      PTPG0 ; reset PTPG0
    ENDIF
  ELSE 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800221 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1
    SBLOF
  ENDIF
  ;STOPRE     
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M23: Swivel Round axis 1 manual or semi automatic", 0,0) 
  _M23: ;
  GOTOF _M31
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M30: Swivel Round axis 1 automatic swivel, Round axis 2 manual or semi automatic. Tracking with TRAORI(1)", 0,0) 
  _M30: ;
  _UI_ACT=$P_GG[8] 
  IF ((_TC_N_WZ==1) AND (NOT $P_SEARCH) AND (NOT $P_ISTEST)) 
    IF($P_GG[49]==3) ; if PTPG0 is active
       S_G_49=1 ; memorize PTPG0
       CP ; activate CP
    ELSE
       S_G_49=0 ; PTPG0 ist no active
    ENDIF
    TCARR=0 PAROTOF
    ORIMKS
    IF _MD21104==1 
      ORIAXES
    ENDIF        
    TRAORI(1)          
    G[8]=_UI_ACT 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800300 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1
    SBLOF
    TRAFOOF
    G[8]=_UI_ACT 
    TCARR=_TC1
    PAROT
    IF(S_G_49==1) ;  if PTPG0 was active
      PTPG0 ; reset PTPG0
    ENDIF
  ELSE 
    IF _TC2>0
      DO $AC_OVR=_TC2 
    ENDIF
    SBLON
    N800301 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1
    SBLOF
  ENDIF
  IF ((_M345==3) OR (_M345==4)) 
    M[_SPINU]=5 
    IF $MCS_TECHNOLOGY<>3 
      M0                             ; wait for NC start
    ENDIF
    M[_SPINU]=_M345 
  ELSE
    IF $MCS_TECHNOLOGY<>3 
      M0                             ; wait for NC start
    ENDIF                            
  ENDIF
  ;STOPRE     
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M31: Swivel Round axis 1 and 2 manual or semi automatic", 0,0) 
  _M31: ;
  IF ((_M345==3) OR (_M345==4)) 
    M[_SPINU]=5 
    M0                             ; wait for NC start
    M[_SPINU]=_M345 
  ELSE
    M0                             ; wait for NC start
  ENDIF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M34: Block Search Round axis automatic", 0,0) 
  _M34: ;
  IF (($TC_CARR37[_TC1] _DEC2)==0) 
    N800340 G0 G90 AX[AXNAME($TC_CARR35[_TC1])]=_A1
  ENDIF
  IF ((($TC_CARR37[_TC1] _DEC3)==0)AND($TC_CARR36[_TC1]<>"")) 
    N800341 G0 G90 AX[AXNAME($TC_CARR36[_TC1])]=_A2
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M35: Block Search Round axis manual", 0,0) 
  _M35: ;
  _TCRD=0 _SERR=<<"" 
  IF (($TC_CARR37[_TC1] _DEC2)==1) 
    _SERR=<<(SUBSTR($TC_CARR35[_TC1],0,5))<<": "<<_TC_A1
    _TCRD=1
  ENDIF
  IF ((($TC_CARR37[_TC1] _DEC3)==1)AND($TC_CARR36[_TC1]<>"")) 
    IF _SERR=="" 
      _SERR=<<(SUBSTR($TC_CARR36[_TC1],0,5))<<": "<<_TC_A2
      _TCRD=1
    ELSE  
      _SERR=<<(SUBSTR($TC_CARR35[_TC1],0,5))<<": "<<_TC_A1<<"  "<<(SUBSTR($TC_CARR36[_TC1],0,5))<<": "<<_TC_A2
      _TCRD=_TCRD+1
    ENDIF
  ENDIF    
  STOPRE 
  IF (_TCRD==2)
    N800350 SETAL(62180,_SERR) 
  ENDIF
  IF (_TCRD==1)
    N800351 SETAL(62181,_SERR)  
  ENDIF
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M40: User Init", 0,0) 
  _M40: ;
  ;N800400 SETMS(1)                ; set tool spindle as master spindle
  ;N800401 DIAMOF                  ; no plane axis as diameter for milling
  STOPRE
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M41x ... _M48x: Retract tool", 0,0) 
GROUP_BEGIN(1001, "_M41: Axis Z MCS-Fixpoint", 0,0) 
  _M41: ;
  SBLON
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  N800410 SUPA G0 G40 G60 G90 Z=$TC_CARR40[_TC1]*_FAK1-_TOOLL[2]*_FAK2 
  SBLOF
  G[8]=_UI_ACT 
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M42: Axis Z and after axes XY MCS-Fixpoint", 0,0) 
  _M42: ;
  SBLON
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  N800420 SUPA G0 G40 G60 G90 Z=$TC_CARR40[_TC1]*_FAK1-_TOOLL[2]*_FAK2 
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  N800421 SUPA X=$TC_CARR38[_TC1]*_FAK1-_TOOLL[0]*_FAK2 Y=$TC_CARR39[_TC1]*_FAK1-_TOOLL[1]*_FAK2 
  SBLOF
  G[8]=_UI_ACT 
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M440 Tool direction retract zero", 0,0) 
  _M440:  ;
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M44: Tool direction retract maximal", 0,0) 
  _M44: ;
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  IF($P_SUBPAR[6]==0)
    CYCLE202(2,_T_POS)
  ENDIF
  SBLON
  IF ((_LEN[0]<600) AND (_LEN[0]>399) AND ($SC_TOOL_ORI_CONST_T==18)) 
  
  
    N800440 G0 G60 G90 AX[$P_AXN1]=IC(_T_POS*_CAL[3]) AX[$P_AXN2]=IC(_T_POS*_CAL[4]) AX[$P_AXN3]=IC(_T_POS*_CAL[5])  
  ELSE 
    N800441 G0 G60 G90 AX[$P_AXN3]=_T_POS 
  ENDIF
  SBLOF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M450: Tool direction retract zero", 0,0) 
  _M450:  ;
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M45: Tool direction retract incremental", 0,0) 
  _M45: ;
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  IF($P_SUBPAR[6]==0)
    CYCLE202(2,_T_POS)
  ENDIF
  SBLON
  IF ((_LEN[0]<600) AND (_LEN[0]>399) AND ($SC_TOOL_ORI_CONST_T==18)) 
    
    
    N800450 G0 G60 G90 AX[$P_AXN1]=IC(_T_POS*_CAL[3]) AX[$P_AXN2]=IC(_T_POS*_CAL[4]) AX[$P_AXN3]=IC(_T_POS*_CAL[5])    
  ELSE 
    N800451 G0 G60 G90 AX[$P_AXN3]=_T_POS 
  ENDIF
  SBLOF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M46: Tool retract modal after block search", 0,0) 
  _M46: ;
  IF((_TC_FR MOD 10)AND(_TC1))     ; tool retract
    N800460 CUST_800(40+(_TC_FR MOD 10),_TC1) ; tool retract modal
  ENDIF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M47: Axis Z MCS-Fixpoint before align tool", 0,0) 
  _M47: ;
  SBLON
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  N800470 SUPA G0 G40 G60 G90 Z=$NT_AUX_POS[_TC1,2]*_FAK1-_TOOLL[2]*_FAK2 
  SBLOF
  TRAFOON($NT_NAME[_TC1])
  G[8]=_UI_ACT
  SBLOF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M48: Axis Z and after axes XY MCS-Fixpoint before align tool", 0,0) 
  _M48: ;
  SBLON
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  N800480 SUPA G0 G40 G60 G90 Z=$NT_AUX_POS[_TC1,2]*_FAK1-_TOOLL[2]*_FAK2 
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  N800481 SUPA X=$NT_AUX_POS[_TC1,0]*_FAK1-_TOOLL[0]*_FAK2 Y=$NT_AUX_POS[_TC1,1]*_FAK1-_TOOLL[1]*_FAK2 
  SBLOF
  TRAFOON($NT_NAME[_TC1])
  G[8]=_UI_ACT
  SBLOF
  ;STOPRE
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M57 ... _M59: JOG Swivel + TRAORI", 0,0) 
GROUP_BEGIN(1001, "_M57: JOG Swivel + TRAORI (Area G17)", 0,0) 
  _M57: ;
  IF $P_TC<>0 GOTOF _MEND
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  SBLON
  ORIWKS ORIVECT 
  N800570 G0 G40 G60 A3=0 B3=0 C3=1 
  SBLOF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M58: JOG Swivel + TRAORI (Area G18)",  0,0) 
  _M58: ;
  IF $P_TC<>0 GOTOF _MEND
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  SBLON
  ORIWKS ORIVECT 
  N800580 G0 G40 G60 A3=0 B3=1 C3=0 
  SBLOF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M59: JOG Swivel + TRAORI (Area G19)",  0,0) 
  _M59: ;
  IF $P_TC<>0 GOTOF _MEND
  IF _TC2>0
    DO $AC_OVR=_TC2 
  ENDIF
  SBLON
  ORIWKS ORIVECT 
  N800590 G0 G40 G60 A3=1 B3=0 C3=0 
  SBLOF
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M70 ... _M75: Align tool",  0,0) 
GROUP_BEGIN(1001, "_M70: Align tool: Intitialize",  0,0) 
  _M70: ;
  IF($P_SMODE[_F_S_NR[1]]==1)      ; tool spindle is in spindle mode
    N800700 M[_F_S_NR[1]]=70       ; tool spindle in C axis mode
  ENDIF
  N800701 SETMS(_F_S_NR[0])        ; set table as master spindle
  N800702 DIAM90                   ; plane axis as diameter for turning (abs)
  GOTOF _MEND
GROUP_END(1001,0)
;
GROUP_BEGIN(1001, "_M71: Align tool: Swivel round axis",  0,0) 
  _M71: ;
  _AX1=$PC_TRAFO_ROT_CHAN_AX_IN[1] ; B axis
  _AX2=$PC_TRAFO_ROT_CHAN_AX_IN[2] ; tool spindle
  IF(_TC_N_WZ==0)                  ; no tooltip tracking 
    N800710 TRAFOOF
  ENDIF
  SBLON
  N800711 G0 G40 G60 G90 AX[_AX1]=_A1 AX[_AX2]=_A2
  SBLOF
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M72: Align tool: End",  0,0) 
  _M72: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, " _M75: Align tool: Deselection",  0,0) 
  _M75: ;
  N800750 G17                     ; default plane for milling
  N800751 SETMS(_F_S_NR[1])       ; set tool spindle as master spindle
  N800752 DIAMOF                  ; no plane axis as diameter for milling
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M80 ... _M85: Interpolationturning",  0,0) 
GROUP_BEGIN(1001, "_M80: Interpolationturning: Initialization",  0,0) 
  _M80: ;
  N800800 DIAM90                   ; plane axis as diameter for turning (abs)
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M81: Interpolationturning: Befor transformation selection ",  0,0) 
  _M81: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, " _M82: Interpolationturning: After transformation selection",  0,0) 
  _M82: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, " _M83: Interpolationturning: End of selection",  0,0) 
  _M83: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, " _M85: Interpolationturning: Deselection",  0,0) 
  _M85: ;
  IF($MCS_TECHNOLOGY==2) 
    N800850 DIAMOF                 ; no plane axis as diameter for milling
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M90 ... _M95: Y-turning",  0,0) 
GROUP_BEGIN(1001, "_M90: Y-turning: Initialization",  0,0) 
  _M90: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, "_M91: Y-turning: Selection: after align tool, before approach the starting position ",  0,0) 
  _M91: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, " _M92: Y-turning: Selection: after approach the starting position",  0,0) 
  _M92: ;
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001, " _M95: Y-turning: Deselection",  0,0) 
  _M95: ;
  ENDIF
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "_M996: Position Roundaxes with measure kinematic (Call by CYCLE9960)",  0,0) 
  _M996: ;
; determine rotary axes
  IF $P_TRAFO_PARSET>1000
    _AX1=$PC_TRAFO_ROT_CHAN_AX_IN[0] 
    _AX2=$PC_TRAFO_ROT_CHAN_AX_IN[1]
  ELSE
    _AX1=AXNAME($TC_CARR35[_TC1])
    IF $TC_CARR36[_TC1]==""
      _AX2=NO_AXIS
    ELSE
      _AX2=AXNAME($TC_CARR36[_TC1])
    ENDIF
  ENDIF
  _MEA_COLL=1 
  IF NOT($SCS_MEA_FUNCTION_MASK B_AND 'B1')  ; SD 55740 Bit0 without/with collision monitoring
    _MEA_COLL=0
  ENDIF
  IF _OVI[18]==1
    _MEA_COLL=0
  ENDIF
  _MEA_IN=($MCS_MEA_FUNCTION_MASK B_AND 'B1')+1    
  IF $P_TRAFO_PARSET<>0    ; TRAORI_DYN active 
    IF AXSTRING(_AX2)<>"NO_AXIS" ; two Roundaxes
      IF _MEA_COLL==0   ; whith Measure-Collision
        G1 G40 G60 G90 G94 AX[_AX2]=(_A2) AX[_AX1]=(_A1) F=$SCS_MEA_FEED_POS_DEG 
      ELSE
        MEAS=_MEA_IN G1 G40 G60 G90 G94 AX[_AX1]=(_A1) AX[_AX2]=(_A2) F=$SCS_MEA_FEED_POS_DEG
        STOPRE
        IF $AC_MEA[_MEA_IN]<>0 GOTOF _ERR0   
      ENDIF
    ELSE ; one Roundaxis
      IF _MEA_COLL==0   ; whith Measure-Collision
        G1 G40 G60 G90 G94 AX[_AX1]=(_A1) F=$SCS_MEA_FEED_POS_DEG 
      ELSE
        MEAS=_MEA_IN G1 G40 G60 G90 G94 AX[_AX1]=(_A1) F=$SCS_MEA_FEED_POS_DEG 
        STOPRE
        IF $AC_MEA[_MEA_IN]<>0 GOTOF _ERR0  
      ENDIF
    ENDIF
  ELSE      ; Movement with TCARR
    IF AXSTRING(_AX2)<>"NO_AXIS"   ; two Rotary axes
      _CAL[0]=SET(_TC1,0,_A1)
      _MOVAX=_AX1
      _MOV_A:
      _MODE216=10
      CYCLE216(_CAL,_MODE216)  ; Calculation of the positions for compensation movement
      IF _CAL[9]<0.001  ; no compensation movement of the linear axes
        IF _CAL[2]>0
          IF _MEA_COLL==0  
            G1 G40 G60 G90 G94 AX[_MOVAX]=IC(_CAL[2]) F=$SCS_MEA_FEED_POS_DEG
          ELSE   ; whith Measure-Collision
            MEAS=_MEA_IN G1 G40 G60 G90 G94 AX[_MOVAX]=IC(_CAL[2]) F=$SCS_MEA_FEED_POS_DEG
            STOPRE
            IF $AC_MEA[_MEA_IN]<>0 GOTOF _ERR0   
          ENDIF
        ENDIF
      ELSE  ; Linear axes traverse a circle while the rotary axis is positioned
        IF _MEA_COLL==0   
          CIP G40 G60 G90 G94 AX[$P_AXN1]=_CAL[3] AX[$P_AXN2]=_CAL[4] AX[$P_AXN3]=_CAL[5] I1=AC(_CAL[6]) J1=AC(_CAL[7]) K1=AC(_CAL[8]) AX[_MOVAX]=IC(_CAL[2]) F=$SCS_MEA_FEED_POS_DEG
        ELSE  ; whith Measure-Collision
          MEAS=_MEA_IN CIP G40 G60 G90 G94 AX[$P_AXN1]=_CAL[3] AX[$P_AXN2]=_CAL[4] AX[$P_AXN3]=_CAL[5] I1=AC(_CAL[6]) J1=AC(_CAL[7]) K1=AC(_CAL[8]) AX[_MOVAX]=IC(_CAL[2]) F=$SCS_MEA_FEED_POS_DEG
          STOPRE
          IF $AC_MEA[_MEA_IN]<>0 GOTOF _ERR0   
        ENDIF
      ENDIF
      _MOV_E:
      _CAL[0]=SET(_TC1,1,_A2)  ; TCARR number and rotary axis position
      _MOVAX=_AX2  ; Round axis name
      REPEAT _MOV_A _MOV_E  ; Repetition for rotary axis 2
    ELSE  ; Only one rotary axis
      _CAL[0]=SET(_TC1,0,_A1)  ; TCARR number and rotary axis position
      _MOVAX=_AX1  ; Round axis name
      REPEAT _MOV_A _MOV_E  ; Repetition for rotary axis 2
    ENDIF
  ENDIF
  GOTOF _MEND
  ;
  _ERR0: _ALARM=61302 _OVI[9]=_ALARM
  STOPRE
  N699600 SETAL(_ALARM) 
  RET
GROUP_END(1000,0)
;
_MEND:
;
GROUP_BEGIN(1000,"Restore particular G groups", 0,0)
  G[1]=S_G_1   ; G0, ...
  G[10]=S_G_10 ; G60, ...
  G[14]=S_G_14 ; G90, ...
  G[15]=S_G_15 ; G94, ...
  G[25]=S_G_25 ; ORIMKS, ...
  IF(_MD21104==1) 
    G[51]=S_G_51 ; ORIAXES, ...
  ENDIF
GROUP_END(1000,0)
;
N800990 RET

;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_832_SPF
PROC CUST_832(INT _MCASE,VAR REAL _FACTOR,VAR REAL _FGREF) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.005 ;DATE: 2023-10-18
;customer cycle to cycle High Speed Settings (CYCLE832)
; The user can modify marks _M_INIT, and _M_NORM to _M_ROUGH
; _M_INIT       = Init CYCLE832
; _M_NORM       = Deselect CYCLE832 (_OFF)
; _M_FINISH     = Machining Finish  (_FINISH or _ORI_FINISH)
; _M_SEMIFINISH = Machining Semifinish (_SEMIFIN or _ORI_SEMIFIN)  
; _M_ROUGH      = Machining Rough (_ROUGH or _ORI_ROUGH) 
; Tolerance of orientation see parameter CYCLE832 S_OTOL
; or _FACTOR for orientation see setting data from SD 55441 to 55443
; Multi-axis programming see CUST_832 parameter _MOTOL 0=no 1=yes
DEF INT _MOTOL, _I 
;_MOTOL Parameter Multi-axis programming 0=no 1=yes (Advanced Surface) 2=yes (Top Surface) 
;_I     Hilfsvariable
GROUP_BEGIN(1000, "CASE _MCASE OF ...", 0,0)
  _MCASE=ABS(_MCASE)
  IF ((_MCASE _DEC2)==2)         
    _MOTOL=1 _MCASE=_MCASE - 10  
  ENDIF
  IF ((_MCASE _DEC2)==4)         
    _MOTOL=2 _MCASE=_MCASE - 10  
  ENDIF
  N83201 CASE _MCASE OF 31 GOTOF _M_TOP_SURFACE_FINISH 32 GOTOF _M_TOP_SURFACE_SEMIFINISH 33 GOTOF _M_TOP_SURFACE_ROUGH 34 GOTOF _M_TOP_SURFACE_PRECISION
  N83202 CASE _MCASE OF 0 GOTOF _M0 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 10 GOTOF _M_NORM 11 GOTOF _M_FINISH 12 GOTOF _M_SEMIFINISH 13 GOTOF _M_ROUGH 14 GOTOF _M_INIT 15 GOTOF _M_STD_ROUGH 16 GOTOF _M_STD_FINISH
GROUP_END(1000,0)
;
GROUP_BEGIN(1000, "DO_UPGRADE: Logic for compatibility if you upgrade software", 0,0)
  ;BEGIN_DO_UPGRADE
  ; logic for compatibility if you upgrade software
  IF ($P_PATH[$P_STACK]<>"/_N_CST_DIR/")
    N990 PCALL /_N_CST_DIR/CUST_832(_MCASE,_FACTOR,_FGREF)
    GOTOF _MEND
  ELSE
     SETAL(61019,"_MCASE="<<_MCASE<<" (CUST_832)" ); Parameter _MCASE=n incorrectly defined
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1000,0)
;
RET
;
;Top Surface or Advanced Surface
GROUP_BEGIN(1000,"INIT: Initialization of Cycle832",0,0)
  _M_INIT:
  ; set default FGREF for all rotary axis
  FOR _I=0 TO 19                         
    IF($MC_AXCONF_MACHAX_USED[_I])       
      
      IF($MA_IS_ROT_AX[AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_I])]) 
        FGREF[AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_I])]=_FGREF    ;default=180/$PI 
      ENDIF
    ENDIF   
  ENDFOR
  _FGREF=10 
  GOTOF _MEND
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"NORM: Deselection of Cycle832",0,0)
  _M_NORM:                               
  GOTOF _MEND 
GROUP_END(1000,0)
;
;Top Surface
GROUP_BEGIN(1000,"TOP_SURFACE: Only used with Top Surface",0,0)
GROUP_BEGIN(1001,"TOP_SURFACE_PRECISION: Finefinishing with Top Surface",0,0)
_M_TOP_SURFACE_PRECISION:
  CP
  SOFT 
  COMPSURF
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNPREC
  ;CALCFIR
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"TOP_SURFACE_FINISH: Finishing with Top Surface",0,0)
  _M_TOP_SURFACE_FINISH:
  CP
  SOFT 
  COMPSURF
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNFINISH
  ;CALCFIR
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"TOP_SURFACE_SEMIFINISH: Semifinishing with Top Surface",0,0)
  _M_TOP_SURFACE_SEMIFINISH:
  CP
  SOFT 
  COMPSURF
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNSEMIFIN
	;CALCFIR
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"TOP_SURFACE_ROUGH: Roughing with Top Surface",0,0)
  _M_TOP_SURFACE_ROUGH:
  CP
  SOFT 
  COMPSURF
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNROUGH
	;CALCFIR
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
  ;
GROUP_BEGIN(1000,"Standard",0,0)
GROUP_BEGIN(1001,"STD_ROUGH: Roughing for standard",0,0)
  _M_STD_ROUGH:
  CP
  SOFT 
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNROUGH
	;CALCFIR
  GOTOF _MEND
GROUP_END(1001,0)
;
GROUP_BEGIN(1001,"STD_FINISH: finishing for standard",0,0)
  _M_STD_FINISH:
  CP
  SOFT 
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNFINISH
	;CALCFIR
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
;Advanced Surface
GROUP_BEGIN(1000,"ADVANCED_SURFACE: Only used with Advanced Surface",0,0)
GROUP_BEGIN(1001,"FINISH: Finishing with Advanced Surface",0,0)
  _M_FINISH:
  SOFT 
  COMPCAD
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNFINISH
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"SEMIFINISH: Semifinishing with Advanced Surface",0,0)
  _M_SEMIFINISH:
  SOFT 
  COMPCAD
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNSEMIFIN
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"ROUGH: Roughing with Advanced Surface",0,0)
  _M_ROUGH:
  SOFT 
  COMPCAD
  G645
  FIFOCTRL
  UPATH
  ;FFWON
  DYNROUGH
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
;------ compatible with CYC_832T and Advanced Surface 
GROUP_BEGIN(1000,"COMPATIBLE_CYC_832T: Only used with old CYC_832T Cycle",0,0)
GROUP_BEGIN(1001,"M4: Initialization of Cycle832 (with old CYC_832T Cycle)",0,0)
  _M4: 
  ;Parameter _FACTOR see Setting Data 55441 $SCS_MILL_TOL_FACTOR_ROUGH and following  
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"M0: Deselection of Cycle832 (with old CYC_832T Cycle)",0,0)
  _M0: 
  DYNNORM
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"M1: Finishing with old CYC_832T Cycle",0,0)
  _M1: 
  SOFT 
  ;COMPCAD
  ;G645
  ;FIFOCTRL
  ;UPATH
  ;FFWON
  DYNFINISH
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"M2: Semifinishing with old CYC_832T Cycle",0,0)
  _M2: 
  SOFT 
  ;COMPCAD
  ;G645
  ;FIFOCTRL
  ;UPATH
  ;FFWON
  DYNSEMIFIN
  GOTOF _MEND
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"M3: Roughing with old CYC_832T Cycle",0,0)
  _M3: 
  SOFT 
  ;COMPCAD
  ;G645
  ;FIFOCTRL
  ;UPATH
  ;FFWON
  DYNROUGH
  GOTOF _MEND
GROUP_END(1001,0)
GROUP_END(1000,0)
;
_MEND:
RET ;M17

;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_MULTICHAN_SPF
PROC CUST_MULTICHAN(INT _S_NR,VAR INT _RET) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.42.00 ;DATE: 2010-01-15
; Machine Manufacturer Cycle for Multi Channel
;----------------------------------------------------------------
; PARAMETER:
;
; _S_NR    :   spindel number
;                 0 = no spindle
; _RET     :   return value:
;                 1 = jump to the end of the whole block
;----------------------------------------------------------------
IF(_S_NR>0)   ; if spindle
  SETMS(_S_NR) ; set master spindle
ENDIF
;
_RET=0        ; normal block work
;----------------------------------------------------------------
RET

;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_CLAMP_SPF
PROC CUST_CLAMP(INT _NPV,INT _PREV,INT _ACT,INT _NEXT) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.05.01.00 ;DATE: 2011-05-11
; Machine Manufacturer Cycle for multiple-workpiece clamping
;----------------------------------------------------------------
; PARAMETER:
;
; _NPV     :   Number of the 1st work offset
;                0 = G500
;                1 = G54
;                ...
; _PREV    :   Number of the previous clamping position (-1 = none)
; _ACT     :   Number of the actual clamping position (1, ...)
; _NEXT    :   Number of the next clamping position (-1 = none)
;----------------------------------------------------------------
DEF INT _NV        ;  helper variable
;----------------------------------------------------------------
_NV=_NPV+_ACT      ;  calculate the number of the actual work offset
;
N10 G[8]=_NV       ;  here is no calculation allowed
;----------------------------------------------------------------
RET
;----------------------------------------------------------------
; END
;----------------------------------------------------------------

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_GROUP_ADDEND_SPF
PROC GROUP_ADDEND(INT _LEVEL,INT _SP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.93.00.00.004 ;DATE: 2019-09-04
;Group additiv end
DEF INT _S_NR=0
DEF STRING[40] _SERR
IF(_SP<>0)
IF(_SP<0)OR(_SP>2) GOTOF _FEHL1
CYCLE210(1)
_S_NR=_F_S_NR[(_SP-1)*2]
IF(_SP==1)AND(_S_NR==0) GOTOF _FEHL2
IF(_SP==2)AND(_S_NR==0) GOTOF _FEHL3
IF(NOT $P_ISTEST)AND($AA_AX_DISABLE_SRC[SPI(_S_NR)] B_AND 'B010000' == 'B010000')
RET("GROUP_END("<<_LEVEL)
ENDIF
ELSE
GOTOF _FEHL5
ENDIF
RET
_FEHL1: STOPRE
N731301 SETAL(61169)
RET
_FEHL2: STOPRE
N731302 SETAL(61288)
RET
_FEHL3: STOPRE
N731303 SETAL(61289)
RET
_FEHL5: STOPRE
N731305 SETAL(61173,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_GROUP_BEGIN_SPF
PROC GROUP_BEGIN(INT _LEVEL,STRING[128] _NAME,INT _SP,INT _MODE,STRING[32] S_ICON) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.95.00.00.018 ;DATE: 2021-06-07
;Group begin
DEF INT _RET,_S_NR=0,_WTYP=0
DEF STRING[40] _SERR
IF(_LEVEL<1000)
S_GROUP_LEVEL=_LEVEL
S_GROUP_NAME[_LEVEL]=_NAME
S_GROUP_SP[_LEVEL]=_SP
ENDIF
IF(_SP>0)
IF(_LEVEL>=0)AND(_LEVEL<=1)
_SC_GROUP_MODE[_LEVEL]=_MODE
_SC_GROUP_MODE[_LEVEL]=_SC_GROUP_MODE[_LEVEL]+'H1000'
IF(_SP)
_SC_GROUP_MODE[_LEVEL]=_SC_GROUP_MODE[_LEVEL]+'H2000'
ENDIF
ELSE
ENDIF
G4 F0
SEFORM(_NAME,0,"")
G4 F0
IF(_SP<>0)
IF(_SP<0)OR(_SP>2) GOTOF _FEHL1
CYCLE210(1)
_S_NR=_F_S_NR[(_SP-1)*2]
IF(_SP==1)AND(_S_NR==0) GOTOF _FEHL2
IF(_SP==2)AND(_S_NR==0) GOTOF _FEHL3
ENDIF
CUST_MULTICHAN(_S_NR,_RET)
IF(_RET==1)
RET("GROUP_END("<<_LEVEL)
ENDIF
IF(_SP>0)
IF(_E_PRG_TYPE[$P_STACK-1]==2)
IF(_SP==1)
F_SUB_SP(5,,,,,,,,,_F_NPV[0])
ELSE
F_SUB_SP(6,,,,,,,,,_F_NPV[1])
ENDIF
IF(_MODE B_AND 'B10')
IF($P_TOOL>0)
_WTYP=$P_AD[1]
ENDIF
IF(_WTYP<>731)AND(_WTYP<>732)
N100 F_HOME
ENDIF
ENDIF
ELSE
WORKPIECE(,,,"SET_FOCUS",_SP)
ENDIF
CUST_TECHCYC(170)
IF(NOT $P_ISTEST)AND($AA_AX_DISABLE_SRC[SPI(_S_NR)] B_AND 'B010000' == 'B010000')
IF(_MODE B_AND 'B1' == 0)
RET("GROUP_END("<<_LEVEL)
ENDIF
ELSE
IF(_MODE B_AND 'B1')
RET("GROUP_ADDEND("<<_LEVEL)
ENDIF
ENDIF
ENDIF
ENDIF
RET
_FEHL1: STOPRE
N731201 SETAL(61169)
RET
_FEHL2: STOPRE
N731202 SETAL(61288)
RET
_FEHL3: STOPRE
N731203 SETAL(61289)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_GROUP_END_SPF
PROC GROUP_END(INT _LEVEL,INT _SP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.95.00.00.018 ;DATE: 2021-06-07
;Group end
DEF INT _WTYP=0
DEF STRING[40] _SERR
IF(_SP>0)
IF(_E_PRG_TYPE[$P_STACK-1]==2)
F_SP_TRA(4044)
IF(_LEVEL >= 0)AND(_LEVEL < 1)
IF(_SC_GROUP_MODE[_LEVEL] B_AND 'B10')
IF($P_TOOL>0)
_WTYP=$P_AD[1]
ENDIF
IF(_WTYP<>731)AND(_WTYP<>732)
N100 F_HOME
ENDIF
ELSE
IF(_SP>0)
IF($P_TOOL>0)
_WTYP=$P_AD[1]
ENDIF
IF(_WTYP<>731)AND(_WTYP<>732)
N200 F_HOME(3)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_SP>0)
CUST_TECHCYC(171)
ENDIF
_SC_GROUP_MODE[_LEVEL]=0
ENDIF
IF(_LEVEL<1000)
S_GROUP_NAME[_LEVEL]=""
S_GROUP_SP[_LEVEL]=0
S_GROUP_LEVEL=_LEVEL-1
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CAM_OP_BEGIN_SPF
PROC CAM_OP_BEGIN(STRING[50] S_CAM_OP_NAME,STRING[10] S_NX_VERSION, REAL S_FLAG) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.37.00 ;DATE: 2014-11-21
;CAM operation begin
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CAM_OP_END_SPF
PROC CAM_OP_END SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.37.00 ;DATE: 2014-11-21
;CAM operation end
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE60_SPF
PROC CYCLE60(STRING[200] _TEXT, REAL _RTP, REAL _RFP, REAL _SDIS, REAL _DP, REAL _DPR, REAL _PA, REAL _PO, REAL _STA, REAL _CP1, REAL _CP2, REAL _WID, REAL _DF, REAL _FFD, REAL _FFP1, INT _VARI, INT _CODEP, INT _UMODE,INT _GMODE,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Engraving cycle
DEF AXIS _XX,_YY,_ZZ
DEF INT _I,_L,_ZNR,_VI[8],_G15G,_G15T,_IS_CYCFR,_ERR=0,_II,_ZZSD[15],_L1,_FFD_TYPE,_WTYP,_GG10
DEF CHAR _ZW
DEF REAL _R[40],_SCL,_MP[4],_FAK=1,_TL,_LWID,_BW,_AW, _NCK, _SDISI,_TB[256],_DFI,_RAD,_HH1,_HH2,_ABHZ, _DPI
DEF REAL _BWF, _BWL, _BWFU, _BWLU, _PKT_RAD, _RAD1
DEF STRING[17] _ZEZA
DEF STRING[62] _TS
DEF STRING[200] _TEXTV
DEF BOOL _TA[256]
DEF FRAME _RE_CYCFR
DEF INT _LEN,_IV,_IV2,_GET_A=0,_FOUND,_VAR_ANF,_LEER,_VOR,_PKT,_NACH,_START,_ZNEG,_ZVOR,_ZPKT,_ZNACH,_ZLEN
DEF INT _D,_M,_Y,_HH,_MM,_TC2[64]
DEF REAL _NUM,_FAK1
DEF STRING[2] _D_STR,_D2_STR,_M_STR,_M2_STR,_Y_STR,_Y2_STR,_HH_STR,_MM_STR,_HH12_STR,_AM_PM
DEF STRING[4] _Y4_STR
DEF STRING[5] _T24_STR
DEF STRING[8] _T12_STR
DEF STRING[20] _Z_STR,_Z_STR2
DEF STRING[200] _STRING
DEF INT _ARTIS[16]
DEF INT _TEMP,_DMODE1,_AMODE1
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE60_MPF",_SERR
DEF STRING[30] _S_FFP1,_S_FFD
DEF STRING[10] _TEXTLAENGE="_TEXT:"
DEF INT _IDX1,_IDX2,_IDX3,_IDX4,_ZNR1
DEF INT _HH3,_MIRR_X,_MIRR_Y,_MIRR_Z,_DIR_MI
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE60_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[3]="<<_ZSD[3]<<" _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"CYCLE60("<<_TEXT<<","<<_RTP<<","<<_RFP<<","<<_SDIS<<","<<_DP<<","<<_DPR<<","<<_PA<<","<<_PO<<","<<_STA<<","<<_CP1<<","<<_CP2<<","<<_WID<<","<<_DF<<","<<_FFD<<","<<_FFP1<<","<<_VARI<<","<<_CODEP<<","<<_UMODE<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (_DPR==0)
IF NOT($P_SUBPAR[5])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
DIAMCYCOF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL21
IF _CODEP==0
_CODEP=1252
ENDIF
IF _CODEP<>1252 GOTOF _FEHL4
_TA[0]=SET(1)
_TA[32]=SET(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
_TA[72]=SET(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1)
_TA[138]=SET(1,0,1,0,1)
_TA[154]=SET(1,0,1,1,1,1,0,0,1,1,0,1,0,1,0,1)
_TA[174]=SET(1,0,1,0,0,0,1,1)
_TA[192]=SET(1,1,1,1,1,1,1,1,1,1,1)
_TA[203]=SET(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1)
_TB[32] =SET(0.5,0,0.3,0.44,0.5,0.9,0.62,0,0.25,0.25,0.37,0.4,0.1,0.4,0,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0,0.1,0.35,0.4,0.35,0.38)
_TB[64] =SET(0.9,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0,0.5,0.5,0.5,0.7,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.1,0.5,0.1,0.2,0.5)
_TB[96] =SET(0.1,0.35,0.35,0.35,0.35,0.35,0.3,0.35,0.35,0,0.15,0.35,0.15,0.65,0.35,0.35,0.35,0.35,0.25,0.35,0.3,0.35,0.35,0.5,0.35,0.35,0.35,0.2,0,0.2,1,0,0.7)
_TB[138]=SET(0.5,0,1,0,0.5)
_TB[154]=SET(0.35,0,1,1.5,0.35,0.5,0,0,0.35,0.6,0,0.5,0,0.6,0,0.625)
_TB[174]=SET(0.625,0,0.2,0,0,0,0.1,0.5)
_TB[192]=SET(0.5,0.5,0.5,0.5,0.5,0.5,1,0.5,0.5,0.5,0.5)
_TB[203]=SET(0.5,0.1,0.1,0.2,0.3,0.6,0.5,0.5,0.5,0.5,0.5,0.5,0.35,0.7,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.35,0.35,0.35,0.35,0.35,0.35,0.95,0.35,0.35,0.35,0.35,0.35,0.1,0.1,0.2,0.3,0.6,0.35,0.35,0.35,0.35,0.35,0.35,0.4,0.6,0.35,0.35,0.35,0.35,0.35,0.35,0.35)
_TC2[0]=SET(128)
_TC2[10]=SET(1,0,1,0,1)
_TC2[26]=SET(1,0,1,0,1,1,0,0,1,1,0,1,0,1,0,1)
_TC2[46]=SET(1,0,1,0,0,0,1,1)
_DMODE1=_DMODE _DEC1
IF((_DMODE1>0)AND(_DMODE1<4))
G[6]=_DMODE1
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3 _NCK=$AN_NCK_VERSION
_NCK=_NCK DIV 100
_HH3=$P_TRAFO
CYCLE210(0)
_MIRR_X=$P_ACTFRAME[_XX,MI] _MIRR_Y=$P_ACTFRAME[_YY,MI] _MIRR_Z=$P_ACTFRAME[_ZZ,MI]
IF (((_MIRR_X+_MIRR_Y+_MIRR_Z)<>2) AND ((_MIRR_X+_MIRR_Y+_MIRR_Z)<>0))
_DIR_MI=-1*_SC_KODIR
ELSE
_DIR_MI=1*_SC_KODIR
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
;IF($P_GG[13]==1)OR($P_GG[13]==3)
IF (($MN_SCALING_SYSTEM_IS_METRIC==1)AND(($P_GG[13]==1)OR($P_GG[13])==3))
_FAK=1/$MN_SCALING_VALUE_INCH
ENDIF
IF (($MN_SCALING_SYSTEM_IS_METRIC==0)AND(($P_GG[13]==2)OR($P_GG[13])==4))
_FAK=$MN_SCALING_VALUE_INCH
ENDIF
IF ISVAR("$SCS_MILL_ENGRAVE_POINT_RAD")==FALSE
_RAD1=0
ELSE
_RAD1=$SCS_MILL_ENGRAVE_POINT_RAD
ENDIF
_WID=ABS(_WID) _DF=ABS(_DF)
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_IS_CYCFR=1
_RE_CYCFR=$P_CYCFRAME
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_GRAV_ANF:
_TEXTV=_TEXT
_IV=MATCH(_TEXTV,"<TEXT,")
WHILE(_IV>=0)
_VAR_ANF=_IV+6
_FOUND=INDEX(SUBSTR(_TEXTV,_VAR_ANF),">")
IF(_FOUND>=0)
_STRING="_TEXTV=SUBSTR(_TEXTV,0,_IV)<<"<<SUBSTR(_TEXTV,_VAR_ANF,_FOUND)<<"<<SUBSTR(_TEXTV,_IV+7+_FOUND)"
N50 EXECSTRING (_STRING)
_IV=MATCH(_TEXTV,"<TEXT,")
ENDIF
ENDWHILE
_FOUND=1
WHILE(_FOUND)
_LEN=STRLEN(_TEXTV)
_FOUND=0
_IV=MATCH(_TEXTV,"<D>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_D_STR<<SUBSTR(_TEXTV,_IV+3,)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<DD>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_D2_STR<<SUBSTR(_TEXTV,_IV+4)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<M>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_M_STR<<SUBSTR(_TEXTV,_IV+3)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<MM>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_M2_STR<<SUBSTR(_TEXTV,_IV+4)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<Y>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_Y_STR<<SUBSTR(_TEXTV,_IV+3)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<YY>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_Y2_STR<<SUBSTR(_TEXTV,_IV+4)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<YYYY>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_Y4_STR<<SUBSTR(_TEXTV,_IV+6)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<TIME12>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_T12_STR<<SUBSTR(_TEXTV,_IV+8)
_FOUND=1
ENDIF
_IV=MATCH(_TEXTV,"<TIME24>")
IF(_IV>=0)
REPEAT _GET_A1 _GET_A2
_TEXTV=SUBSTR(_TEXTV,0,_IV)<<_T24_STR<<SUBSTR(_TEXTV,_IV+8)
_FOUND=1
ENDIF
ENDWHILE
_FOUND=INDEX(_TEXTV,"<")
_START=_FOUND
WHILE(_FOUND>=0)
_LEER=0
_VOR=0
_PKT=0
_NACH=0
_IV=_START+1
WHILE(_TEXTV[_IV]==" ")
_LEER=_LEER+1
_IV=_IV+1
ENDWHILE
WHILE(_TEXTV[_IV]=="#")
_VOR=_VOR+1
_IV=_IV+1
ENDWHILE
IF(_TEXTV[_IV]==".")
_PKT=1
_IV=_IV+1
ENDIF
WHILE(_TEXTV[_IV]=="#")
_NACH=_NACH+1
_IV=_IV+1
ENDWHILE
IF(_TEXTV[_IV]==",")AND(_VOR>0)
_VAR_ANF=_IV+1
_FOUND=INDEX(SUBSTR(_TEXTV,_VAR_ANF),">")
IF(_FOUND>=0)
_STRING=SUBSTR(_TEXTV,_VAR_ANF,_FOUND)
_VAR_ANF=MATCH(_STRING,"_E_PART[0]")
IF(_VAR_ANF>=0)
_STRING=SUBSTR(_STRING,0,_VAR_ANF)<<"$AC_ACTUAL_PARTS"<<SUBSTR(_STRING,_VAR_ANF+10,STRLEN(_STRING)-10-_VAR_ANF)
ENDIF
_VAR_ANF=MATCH(_STRING,"_F_PART[0]")
IF(_VAR_ANF>=0)
_STRING=SUBSTR(_STRING,0,_VAR_ANF)<<"$AC_ACTUAL_PARTS"<<SUBSTR(_STRING,_VAR_ANF+10,STRLEN(_STRING)-10-_VAR_ANF)
ENDIF
_STRING="_NUM="<<_STRING
N60 EXECSTRING (_STRING) ; generierten String ausfuehren!
_LEN=_IV-_START+_FOUND+2
IF(_NUM<0)AND(_VOR>1)
_TEXTV=SUBSTR(_TEXTV,0,_START)<<_NUM<<SUBSTR(_TEXTV,_START+_LEN)
ELSE
IF(_PKT)AND(_NACH==0)
_NACH=20
ENDIF
_Z_STR=<<(ROUND(_NUM*EXP(_NACH*LN(10)))/EXP(_NACH*LN(10)))
IF(_PKT)AND(INDEX(_Z_STR,".")==-1)
_Z_STR=_Z_STR<<"."
ENDIF
_ZLEN=STRLEN(_Z_STR)
_ZNEG=0
_ZVOR=0
_ZPKT=0
_ZNACH=0
_IV=0
IF(MINDEX(_Z_STR,"EX")>=0)
_TEXTV=SUBSTR(_TEXTV,0,_START)<<_Z_STR<<SUBSTR(_TEXTV,_START+_LEN)
ELSE
IF(_Z_STR[_IV]=="-")
_ZNEG=1
_IV=_IV+1
ENDIF
_FOUND=1
WHILE(_ZLEN>_IV)AND(_FOUND)
IF(MINDEX("0123456789",_Z_STR[_IV])>=0)
_FOUND=1
_ZVOR=_ZVOR+1
_IV=_IV+1
ELSE
_FOUND=0
ENDIF
ENDWHILE
IF(_ZLEN>_IV)
IF(_Z_STR[_IV]==".")
_ZPKT=1
_IV=_IV+1
_FOUND=1
WHILE(_ZLEN>_IV)
IF(MINDEX("0123456789",_Z_STR[_IV])>=0)
_FOUND=1
_ZNACH=_ZNACH+1
_IV=_IV+1
ELSE
_FOUND=0
ENDIF
ENDWHILE
ENDIF
ENDIF
IF(_NACH==20)
_NACH=_ZNACH
ENDIF
_Z_STR2=""
WHILE(_LEER)AND(_LEER>_ZVOR+_ZNEG-_VOR)
_Z_STR2=_Z_STR2<<" "
_LEER=_LEER-1
ENDWHILE
WHILE(_VOR>_ZVOR)
_Z_STR2=_Z_STR2<<"0"
_VOR=_VOR-1
ENDWHILE
_Z_STR2=_Z_STR2<<SUBSTR(_Z_STR,0,_ZVOR+_ZNEG)
IF(_ZPKT)AND(_PKT)
_Z_STR2=_Z_STR2<<"."
ENDIF
IF(_NACH<=_ZNACH)
_Z_STR2=_Z_STR2<<SUBSTR(_Z_STR,_ZVOR+_ZNEG+_ZPKT,_NACH)
ELSE
_Z_STR2=_Z_STR2<<SUBSTR(_Z_STR,_ZVOR+_ZNEG+_ZPKT)
WHILE(_NACH>_ZNACH)AND(_ZPKT)
_Z_STR2=_Z_STR2<<"0"
_NACH=_NACH-1
ENDWHILE
ENDIF
_TEXTV=SUBSTR(_TEXTV,0,_START)<<_Z_STR2<<SUBSTR(_TEXTV,_START+_LEN)
ENDIF
ENDIF
ENDIF
ENDIF
_FOUND=INDEX(SUBSTR(_TEXTV,_START+1),"<")
_START=_FOUND+_START+1
ENDWHILE
_GRAV_END:
_VI[7]=_VARI DIV 10000000
_VI[6]=_VARI DIV 1000000 MOD 10 _VI[5]=(_VARI DIV 100000) MOD 10 _VI[4]=(_VARI DIV 10000) MOD 10 _VI[3]=(_VARI DIV 1000) MOD 10 _VI[2]=(_VARI DIV 100) MOD 10 _VI[1]=(_VARI DIV 10) MOD 10 _VI[0]=_VARI MOD 10
IF ( (_VI[7]<0 ) AND (_VI[7] > 2) ) GOTOF _FEHL5
IF ( (_VI[5]<0 ) AND (_VI[5] > 2) ) GOTOF _FEHL5 IF ( (_VI[4]<0 ) AND (_VI[4] > 2) ) GOTOF _FEHL5 IF ( (_VI[3]<0 ) AND (_VI[3] > 2) ) GOTOF _FEHL5
IF ( (_VI[2]<>0 ) AND (_VI[2] <> 2) ) GOTOF _FEHL5 IF ( (_VI[1]<0 ) AND (_VI[1] > 2) ) GOTOF _FEHL5 IF ( (_VI[0]<0 ) AND (_VI[0] > 1) ) GOTOF _FEHL5
IF ((_VI[1]==0) AND (_VI[5]==2)) GOTOF _FEHL5
IF ((_VI[1]<>0) AND (_VI[5]==1)) GOTOF _FEHL5
_L=STRLEN(_TEXTV)
IF _L==0 GOTOF _END
_IDX1=MINDEX(_TEXTV,"") +1
_IDX3=MINDEX(_TEXTV,"") +1
_I=0
REPEAT
_ZNR=_ZNR+1
_ZEZA=""<<_ZNR
IF _ZNR>100 GOTOF _FEHL32
IF _TA[_TEXTV[_I]]==FALSE GOTOF _FEHL2
_ZW=_TEXTV[_I]
IF ((_ZW<128) AND (_IDX1<>0))
_IDX1=1 _IDX2=0
ENDIF
IF ((_ZW<128) AND (_IDX1==0) AND (_IDX3==0))
_IDX1=1 _IDX2=0
ENDIF
IF ((_ZW>127) AND (_IDX1==0) AND (_IDX3<>0))
IF (_TEXTV[_I]==194)
_I=_I+1
_ZW=_TEXTV[_I]
IF (((_ZW>127) AND (_ZW<160)) OR (_ZW>191) OR (_ZW<128))
_IDX1=_I
_I=_I-1
ENDIF
IF ((_ZW>161) AND (_ZW<192))
_ZW=_ZW-128
IF (_IDX2<>0) AND (_IDX1==0)
IF _TC2[_ZW]==FALSE GOTOF _FEHL2
ENDIF
IF (_IDX2==0) AND (_IDX1<>0)
IF _TA[_TEXTV[_I]]==FALSE GOTOF _FEHL2
ENDIF
ENDIF
ENDIF
IF (_TEXTV[_I]==195)
_I=_I+1
_ZW=_TEXTV[_I]
IF ((_ZW>191) OR (_ZW<128))
_IDX1=_I
IF _TA[_TEXTV[_I]]==FALSE GOTOF _FEHL2
_I=_I-1
ENDIF
IF ((_ZW>128) AND (_ZW<138))
_IDX2=_I
GOTOF _MA1
ENDIF
IF (_ZW==139) OR (_ZW==141) OR (_ZW==155) OR (_ZW==160) OR (_ZW==161) OR (_ZW==164) OR (_ZW==166) OR (_ZW==168)
_IDX2=_I
GOTOF _MA1
ENDIF
IF ((_ZW>142) AND (_ZW<154))
_IDX2=_I
GOTOF _MA1
ENDIF
IF (((_ZW>169) AND (_ZW<174)) OR (_ZW==175))
_IDX2=_I
GOTOF _MA1
ENDIF
IF ((_ZW>176) AND (_ZW<180))
_IDX2=_I
GOTOF _MA1
ENDIF
IF ((_ZW>181) AND (_ZW<192))
_IDX2=_I
GOTOF _MA1
ENDIF
IF (_IDX2<>0) AND (_IDX1==0)
IF ((_ZW<128) OR (_ZW>191)) GOTOF _FEHL2
_ZW=_ZW+64
ENDIF
IF (_IDX2==0) AND (_IDX1<>0)
IF _TA[_TEXTV[_I]]==FALSE GOTOF _FEHL2
ENDIF
_MA1:
ENDIF
IF (_TEXTV[_I]==197)
_I=_I+1
_ZW=_TEXTV[_I]
IF ((_ZW==184) OR (_ZW==160) OR (_ZW==161) OR (_ZW==189) OR (_ZW==190) OR (_ZW==146) OR (_ZW==147))
IF (_ZW==184)
_ZW=159 _IDX2=_I
ENDIF
IF (_ZW==160)
_ZW=138 _IDX2=_I
ENDIF
IF (_ZW==161)
_ZW=154 _IDX2=_I
ENDIF
IF (_ZW==189)
_ZW=142 _IDX2=_I
ENDIF
IF (_ZW==190)
_ZW=158 _IDX2=_I
ENDIF
IF (_ZW==146)
_ZW=140 _IDX2=_I
ENDIF
IF (_ZW==147)
_ZW=156 _IDX2=_I
ENDIF
ENDIF
ENDIF
IF (_TEXTV[_I]==226)
_I=_I+1
_ZW=_TEXTV[_I]
IF NOT(_ZW==130)
_I=_I-1
ELSE
_I=_I+1
_ZW=_TEXTV[_I]
IF NOT(_ZW==172) GOTOF _FEHL2
_ZW=128 _IDX2=_I
ENDIF
ENDIF
IF (_TEXTV[_I]==238)
_I=_I+1
_ZW=_TEXTV[_I]
IF NOT(_ZW==160)
_I=_I-1
ELSE
_I=_I+1
_ZW=_TEXTV[_I]
IF NOT(_ZW==128) GOTOF _FEHL2
_ZW=157 _IDX2=_I
ENDIF
ENDIF
IF (_IDX2==0) AND (_IDX1==0)
_ZNR1=_ZNR
ENDIF
ENDIF
_I=_I+1
IF (_I==_L)
IF (_IDX1==0) AND (_IDX2==0)
_IDX2=999
_I=0
_ZNR=0
ENDIF
ENDIF
UNTIL _I==_L
IF _VI[2]==2
_STCCMA: _HH1=$P_TRAFO
IF ($P_TRAFO B_AND 'H1300')
GOTOF _FEHL5
ENDIF
SBLOF
N200 CUST_TECHCYC(_UMODE)
SBLON
ENDIF
IF(_FFP1<=0) GOTOF _FEHL9
IF(_FFD<=0)
_FFD=_FFP1
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL31
ENDIF
_S_FFP1="G95 FZ="<<_FFP1
ELSE
_S_FFP1="G94 F"<<_FFP1
ENDIF
ENDIF
IF(_DMODE _DEC2 == 0)
IF(_ZSD[3]==-1)OR(_ZSD[3]==0)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=1
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ELSE
IF(_DMODE _DEC2 == 1)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=11
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ENDIF
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_S_FFD="G95 F"<<_FFD
ELSE
IF(_FFD_TYPE==11)OR(_FFD_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL31
ENDIF
_S_FFD="G95 FZ="<<_FFD
ELSE
_S_FFD="G94 F"<<_FFD
ENDIF
ENDIF
_I=0 _TL=0 _BW=0
IF _VI[1]==0
REPEAT
IF (((_TEXTV[_I]==194) OR (_TEXTV[_I]==195) OR (_TEXTV[_I]==197) OR (_TEXTV[_I]==226) OR (_TEXTV[_I]==238)) AND ((_IDX1==0) AND (_IDX2<>0)))
IF (_TEXTV[_I]==194)
_I=_I+1
_ZW=_TEXTV[_I]
ENDIF
IF (_TEXTV[_I]==195)
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=_ZW+64
ENDIF
IF (_TEXTV[_I]==197)
_I=_I+1
_ZW=_TEXTV[_I]
IF (_ZW==184)
_ZW=159
ENDIF
IF (_ZW==160)
_ZW=138
ENDIF
IF (_ZW==161)
_ZW=154
ENDIF
IF (_ZW==189)
_ZW=142
ENDIF
IF (_ZW==190)
_ZW=158
ENDIF
IF (_ZW==146)
_ZW=140
ENDIF
IF (_ZW==147)
_ZW=156
ENDIF
ENDIF
IF (_TEXTV[_I]==226)
_I=_I+1
_ZW=_TEXTV[_I]
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=128
ENDIF
IF (_TEXTV[_I]==238)
_I=_I+1
_ZW=_TEXTV[_I]
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=157
ENDIF
ELSE
_ZW=_TEXTV[_I]
ENDIF
_LWID=(_TB[_ZW]/_FAK)*_WID _TL=_TL+_LWID _I=_I+1
UNTIL _I==_L
IF _VI[5]==0
_DFI=_DF _TL=_TL+(_ZNR*_DFI)-_DFI
ELSE
IF _TL>_DF/_FAK
GOTOF _FEHL7
ENDIF
IF _ZNR>1
_DFI=(_DF/_FAK-_TL)/(_ZNR-1) _TL=_DF
ELSE
_DFI=0 _TL=_LWID
ENDIF
ENDIF
ELSE
IF _VI[6]==0
_MP[2]=_CP1 _MP[3]=_CP2
ELSE
_MP[2]=_CP1 * COS(_CP2) _MP[3]=_CP1 * SIN(_CP2)
ENDIF
IF _VI[0]==0
_MP[0]=_PA _MP[1]=_PO _RAD=SQRT((_MP[0]-_MP[2])*(_MP[0]-_MP[2]) + (_MP[1]-_MP[3])*(_MP[1]-_MP[3]))
ELSE
_MP[0]=_MP[2] * COS(_PO) _MP[1]=_MP[3]+_PA * SIN(_PO) _RAD=_PA
ENDIF
IF NOT (_VI[4]==0)
IF _VI[1]==1
IF _VI[4]==1
_RAD=_RAD - _WID/2
ELSE
_RAD=_RAD - _WID
ENDIF
ELSE
IF _VI[4]==1
_RAD=_RAD + _WID/2
ELSE
_RAD=_RAD + _WID
ENDIF
ENDIF
ENDIF
_ZNR=0
REPEAT
_ZNR=_ZNR+1
IF (((_TEXTV[_I]==194) OR (_TEXTV[_I]==195) OR (_TEXTV[_I]==197) OR (_TEXTV[_I]==226) OR (_TEXTV[_I]==238)) AND ((_IDX1==0) AND (_IDX2<>0)))
IF (_TEXTV[_I]==194)
_I=_I+1
_ZW=_TEXTV[_I]
ENDIF
IF (_TEXTV[_I]==195)
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=_ZW+64
ENDIF
IF (_TEXTV[_I]==197)
_I=_I+1
_ZW=_TEXTV[_I]
IF (_ZW==184)
_ZW=159
ENDIF
IF (_ZW==160)
_ZW=138
ENDIF
IF (_ZW==161)
_ZW=154
ENDIF
IF (_ZW==189)
_ZW=142
ENDIF
IF (_ZW==190)
_ZW=158
ENDIF
IF (_ZW==146)
_ZW=140
ENDIF
IF (_ZW==147)
_ZW=156
ENDIF
ENDIF
IF (_TEXTV[_I]==226)
_I=_I+1
_ZW=_TEXTV[_I]
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=128
ENDIF
IF (_TEXTV[_I]==238)
_I=_I+1
_ZW=_TEXTV[_I]
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=157
ENDIF
ELSE
_ZW=_TEXTV[_I]
ENDIF
_LWID=(_TB[_ZW]/_FAK)*_WID
IF ( _LWID/2/ABS(_RAD) > 1)
GOTOF _FEHL10
ENDIF
IF (_VI[1]==1)
_BW=_BW+(2*ASIN(_LWID/2/ABS(_RAD)))
ELSE
_BW=_BW+(2*ASIN(_LWID/2/ABS(_RAD-_WID)))
ENDIF
_I=_I+1
IF _ZNR == 1
IF _VI[1]==1
_BWF=(2*ASIN(_LWID/2/ABS(_RAD)))/2
ELSE
_BWFU=(2*ASIN(_LWID/2/ABS(_RAD)))/2
_BWF =(2*ASIN(_LWID/2/ABS(_RAD-_WID)))/2
ENDIF
ENDIF
IF _I == _L
IF _VI[1]==1
_BWL=(2*ASIN(_LWID/2/ABS(_RAD)))/2
ELSE
_BWLU=(2*ASIN(_LWID/2/ABS(_RAD)))/2
_BWL =(2*ASIN(_LWID/2/ABS(_RAD-_WID)))/2
ENDIF
ENDIF
UNTIL _I==_L
IF _VI[5]==0
IF _VI[1]==1
_AW=180/$PI/_RAD*_DF
ELSE
_AW=180/$PI/(_RAD-_WID)*_DF
ENDIF
ELSE
IF ((_BW>=ABS(_DF)) AND (_ZNR>1))
GOTOF _FEHL8
ENDIF
IF _ZNR>1
IF (_DF==360)
_AW=(ABS(_DF)-_BW)/_ZNR
ELSE
_AW=(ABS(_DF+_BWF+_BWL)-_BW)/(_ZNR-1)
ENDIF
ELSE
_AW=0
ENDIF
ENDIF
_BW=_BW+((_ZNR-1)*_AW)
IF NOT ((_DF==360) AND (_VI[5]==2))
IF(_BW>360)
GOTOF _FEHL6
ENDIF
ENDIF
ENDIF
_SCL=($P_ACTFRAME[_ZZ,SC])
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL3
_SDIS=ABS(_SDIS)/_SCL
_DPI=_DP _AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[6]==0)) GOTOF _FEHL30
IF (_AMODE1==1) OR ((_AMODE==0) AND (_DPR<>0)) GOTOF _MA261501
IF (((_RFP-_DP)<>0) AND (_RTP-_RFP))
IF ( (_RFP-_DP)/ABS(_RFP-_DP)<> (_RTP-_RFP)/ABS(_RTP-_RFP) )
GOTOF _FEHL1
ENDIF
ENDIF
_MA261501:
IF(((_DPR<>0) AND (_AMODE1==0)) OR (_AMODE1==1))
IF _RTP==_RFP
GOTOF _FEHL1
ELSE
IF _RTP>_RFP
_DPI=_RFP-ABS(_DPR)
ELSE
_DPI=_RFP+ABS(_DPR)
ENDIF
ENDIF
ENDIF
IF _RFP==_DPI GOTOF _END
_SDISI=_SDIS*((_RFP-_DPI)/ABS(_RFP-_DPI))
_ABHZ=_RFP+_SDISI
IF _VI[1]==0
_MP[2]=0 _MP[3]=0
IF _VI[0]==0
_MP[0]=_PA _MP[1]=_PO
ELSE
_MP[0]=_PA * COS(_PO) _MP[1]=_PA * SIN(_PO)
ENDIF
IF NOT (_VI[3]==0)
IF _VI[3]==1
_MP[2]=- _TL/2
ELSE
_MP[2]=- _TL
ENDIF
ENDIF
IF NOT (_VI[4]==0)
IF _VI[4]==1
_MP[3]=- _WID/2
ELSE
_MP[3]=- _WID
ENDIF
ENDIF
IF (_IS_CYCFR==1)
IF (_VI[7]<>1)
N300 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[0]*1/_FAK1,_YY,_MP[1]*1/_FAK1):CROT(_ZZ,_STA):CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1)
IF(_DIR_MI<0) AND (_VI[7]>0)
N301 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_TL*1/_FAK1):CMIRROR(_XX)
ENDIF
ELSE
N300 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[0]*1/_FAK1,_YY,_MP[1]*1/_FAK1):CROT(_ZZ,_STA):CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1)
N301 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_TL*1/_FAK1):CMIRROR(_XX)
IF(_DIR_MI<0)
N301 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_TL*1/_FAK1):CMIRROR(_XX)
ENDIF
ENDIF
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
ELSE
N300 ATRANS AX[_XX]=_MP[0] AX[_YY]=_MP[1]
N301 AROT RPL=_STA
N302 ATRANS AX[_XX]=_MP[2] AX[_YY]=_MP[3]
ENDIF
N303 G90 G0 AX[_XX]=0 AX[_YY]=0
ELSE
IF _VI[0]==0
_HH1=_MP[0] _HH2=_MP[1]
_MP[0]=SQRT((_MP[2]-_HH1)*(_MP[2]-_HH1) + (_MP[3]-_HH2) * (_MP[3]-_HH2)) _MP[1]=ATAN2((_HH2-_MP[3]),(_HH1-_MP[2]))
ELSE
_MP[0]=_PA _MP[1]=_PO
ENDIF
IF NOT (_VI[3]==0)
IF _VI[1]==1
IF _VI[3]==1
_MP[1]=_MP[1] + (_BW-_BWF-_BWL)/2 + _BWF
ELSE
_MP[1]=_MP[1] + _BW - _BWL
ENDIF
ELSE
IF _VI[3]==1
_MP[1]=_MP[1] - (_BW-_BWFU-_BWLU)/2 - _BWFU
ELSE
_MP[1]=_MP[1] - _BW + _BWL
ENDIF
ENDIF
ELSE
IF _VI[1]==1
_MP[1]=_MP[1] + _BWF
ELSE
_MP[1]=_MP[1] - _BWF
ENDIF
ENDIF
IF NOT (_VI[4]==0)
IF _VI[4]==1
_MP[0]=_MP[0] - _WID/2
ELSE
_MP[0]=_MP[0] - _WID
ENDIF
ENDIF
IF _VI[1]==1
IF (_IS_CYCFR==1)
IF (_VI[7]==0)
N309 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1):CROT(_ZZ,_MP[1]-90):CTRANS(_YY,ABS(_RAD)*1/_FAK1)
N313 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,-1*_BWF)
ELSE
IF ((_VI[7]==2) AND (_DIR_MI>0)) OR ((_VI[7]==1) AND (_DIR_MI<0))
N309 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1):CROT(_ZZ,_MP[1]-90):CTRANS(_YY,ABS(_RAD)*1/_FAK1)
N313 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,-1*_BWF)
ELSE
N309 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1):CROT(_ZZ,_MP[1]-90-_BW):CTRANS(_YY,ABS(_RAD)*1/_FAK1)
N313 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,1*_BWF)
N3133 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_XX)
ENDIF
ENDIF
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N312 G90 G0 AX[_XX]=0 AX[_YY]=0
ELSE
N309 ATRANS AX[_XX]=_MP[2] AX[_YY]=_MP[3]
N310 AROT RPL=(_MP[1]-90)
N311 ATRANS AX[_YY]=ABS(_RAD)
N313 AROT RPL=-1*_BWF
N312 G90 G0 AX[_XX]=0 AX[_YY]=0
ENDIF
ELSE
IF (_IS_CYCFR==1)
IF (_VI[7] ==0)
N309 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1):CROT(_ZZ,_MP[1]-90):CTRANS(_YY,ABS(_RAD-_WID)*1/_FAK1)
N3131 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY):CMIRROR(_XX):CROT(_ZZ,_BWF):CTRANS(_YY,-_WID*1/_FAK1)
ELSE
IF ((_VI[7]==2) AND (_DIR_MI>0)) OR ((_VI[7]==1) AND (_DIR_MI<0))
N309 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1):CROT(_ZZ,_MP[1]-90):CTRANS(_YY,ABS(_RAD-_WID)*1/_FAK1)
N3131 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY):CMIRROR(_XX):CROT(_ZZ,_BWF):CTRANS(_YY,-_WID*1/_FAK1)
ELSE
N309 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_MP[2]*1/_FAK1,_YY,_MP[3]*1/_FAK1):CROT(_ZZ,_MP[1]-90+_BW):CTRANS(_YY,ABS(_RAD-_WID)*1/_FAK1)
N3131 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY):CMIRROR(_XX):CROT(_ZZ,-1*_BWF):CTRANS(_YY,-_WID*1/_FAK1)
N3134 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_XX)
ENDIF
ENDIF
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N312 G90 G0 AX[_XX]=0 AX[_YY]=0
ELSE
N309 ATRANS AX[_XX]=_MP[2] AX[_YY]=_MP[3]
N310 AROT RPL=(_MP[1]-90)
N311 ATRANS AX[_YY]=ABS(_RAD-_WID)
N3131 AMIRROR AX[_YY]=1
N3132 AMIRROR AX[_XX]=1
N313 AROT RPL=_BWF
N314 ATRANS AX[_YY]=-_WID
N312 G90 G0 AX[_XX]=0 AX[_YY]=0
ENDIF
ENDIF
ENDIF
_BW=_BWF
SBLON
N330 G0 G[10]=_GG10 G90 AX[_ZZ]=_ABHZ
SBLOF
_I=0 _ZNR=0
REPEAT
_ZNR=_ZNR+1
IF (((_TEXTV[_I]==194) OR (_TEXTV[_I]==195) OR (_TEXTV[_I]==197) OR (_TEXTV[_I]==226) OR (_TEXTV[_I]==238)) AND ((_IDX1==0) AND (_IDX2<>0)))
IF (_TEXTV[_I]==194)
_I=_I+1 _IDX4=2
_ZW=_TEXTV[_I]
ENDIF
IF (_TEXTV[_I]==195)
_I=_I+1 _IDX4=2
_ZW=_TEXTV[_I]
_ZW=_ZW+64
ENDIF
IF (_TEXTV[_I]==197)
_I=_I+1 _IDX4=2
_ZW=_TEXTV[_I]
IF (_ZW==184)
_ZW=159
ENDIF
IF (_ZW==160)
_ZW=138
ENDIF
IF (_ZW==161)
_ZW=154
ENDIF
IF (_ZW==189)
_ZW=142
ENDIF
IF (_ZW==190)
_ZW=158
ENDIF
IF (_ZW==146)
_ZW=140
ENDIF
IF (_ZW==147)
_ZW=156
ENDIF
ENDIF
IF (_TEXTV[_I]==226)
_I=_I+1 _IDX4=3
_ZW=_TEXTV[_I]
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=128
ENDIF
IF (_TEXTV[_I]==238)
_I=_I+1 _IDX4=3
_ZW=_TEXTV[_I]
_I=_I+1
_ZW=_TEXTV[_I]
_ZW=157
ENDIF
ELSE
_ZW=_TEXTV[_I] _IDX4=1
ENDIF
IF(_I<61)
IF (_IDX4==1)
_TS=_TS<<_TEXTV[_I]
ENDIF
IF (_IDX4==2)
_TS=_TS<<_TEXTV[_I-1]<<_TEXTV[_I]
ENDIF
IF (_IDX4==3)
_TS=_TS<<_TEXTV[_I-2]<<_TEXTV[_I-1]<<_TEXTV[_I]
ENDIF
ELSE
IF (((_TS[0]==194) OR (_TS[0]==195) OR (_TS[0]==197) OR (_TS[0]==226) OR (_TS[0]==238)) AND ((_IDX1==0) AND (_IDX2<>0)))
IF ((_TS[0]==194) OR (_TS[0]==195) OR (_TS[0]==197))
IF (_IDX4==1)
_TS=SUBSTR(_TS,2)<<_TEXTV[_I]
GOTOF _MA2
ENDIF
IF (_IDX4==2)
_TS=SUBSTR(_TS,2)<<_TEXTV[_I-1]<<_TEXTV[_I]
GOTOF _MA2
ENDIF
IF (_IDX4==3)
_TS=SUBSTR(_TS,2)<<_TEXTV[_I-2]<<_TEXTV[_I-1]<<_TEXTV[_I]
GOTOF _MA2
ENDIF
ENDIF
IF ((_TS[0]==226) OR (_TS[0]==238))
IF (_IDX4==1)
_TS=SUBSTR(_TS,3)<<_TEXTV[_I]
GOTOF _MA2
ENDIF
IF (_IDX4==2)
_TS=SUBSTR(_TS,3)<<_TEXTV[_I-1]<<_TEXTV[_I]
GOTOF _MA2
ENDIF
IF (_IDX4==3)
_TS=SUBSTR(_TS,3)<<_TEXTV[_I-2]<<_TEXTV[_I-1]<<_TEXTV[_I]
GOTOF _MA2
ENDIF
ENDIF
ELSE
IF (_IDX4==1)
_TS=SUBSTR(_TS,1)<<_TEXTV[_I]
ENDIF
IF (_IDX4==2)
_TS=SUBSTR(_TS,1)<<_TEXTV[_I-1]<<_TEXTV[_I]
ENDIF
IF (_IDX4==3)
_TS=SUBSTR(_TS,1)<<_TEXTV[_I-2]<<_TEXTV[_I-1]<<_TEXTV[_I]
ENDIF
ENDIF
_MA2:
ENDIF
MSG(" "<<_TS)
IF ((_ZNR>1) AND (_I<>_L) AND (_VI[1]>0))
IF _VI[1]==1
IF (_IS_CYCFR==1)
N350 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,_BW):CTRANS(_YY,(-1*ABS(_RAD))*1/_FAK1)
ELSE
N350 AROT RPL=_BW
N351 ATRANS AX[_YY]=-1*ABS(_RAD)
ENDIF
ELSE
IF (_IS_CYCFR==1)
N3499 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_YY,_WID*1/_FAK1):CROT(_ZZ,-_BW):CMIRROR(_YY):CTRANS(_YY,(-1*ABS(_RAD-_WID))*1/_FAK1)
ELSE
N3499 ATRANS AX[_YY]=_WID
N3500 AROT RPL=-_BW
N3501 AMIRROR AX[_YY]=0
N351 ATRANS AX[_YY]=-1*ABS(_RAD-_WID)
ENDIF
ENDIF
ENDIF
IF((_ZNR>1) AND (_I<>_L) AND ( NOT (_VI[1]==0)))
IF (_IS_CYCFR==1)
IF _VI[1]==1
N352 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,-(2*_BW+_AW)):CTRANS(_YY,ABS(_RAD)*1/_FAK1)
_LWID=(_TB[_ZW]/_FAK)*_WID
IF NOT( _RAD== 0 )
_BW=ASIN(_LWID/2/ABS(_RAD))
ENDIF
N354 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,-1*_BW)
ELSE
N352 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,-(2*_BW+_AW)):CTRANS(_YY,ABS(_RAD-_WID)*1/_FAK1)
_LWID=(_TB[_ZW]/_FAK)*_WID
IF NOT( _RAD== 0 )
_BW=ASIN(_LWID/2/ABS(_RAD-_WID))
ENDIF
N355 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY):CROT(_ZZ,_BW):CTRANS(_YY,-_WID*1/_FAK1)
ENDIF
ELSE
IF _VI[1]==1
N352 AROT RPL=-(2*_BW+_AW)
N353 ATRANS AX[_YY]=ABS(_RAD)
_LWID=(_TB[_ZW]/_FAK)*_WID
IF NOT( _RAD== 0 )
_BW=ASIN(_LWID/2/ABS(_RAD))
ENDIF
N354 AROT RPL=-1*_BW
ELSE
N352 AROT RPL=-(2*_BW+_AW)
N353 ATRANS AX[_YY]=ABS(_RAD-_WID)
_LWID=(_TB[_ZW]/_FAK)*_WID
IF NOT( _RAD== 0 )
_BW=ASIN(_LWID/2/ABS(_RAD-_WID))
ENDIF
N355 AMIRROR AX[_YY]=1
N356 AROT RPL=_BW
N357 ATRANS AX[_YY]=-_WID
ENDIF
ENDIF
ENDIF
GOTOF SCHREIB
_MR:
N335 REPEAT _ABA _ABE
_I=_I+1
IF(_VI[1]==0)
IF (_IS_CYCFR==1)
N340 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,(_WID*_TB[_ZW]+_DFI)*1/_FAK1)
ELSE
N340 ATRANS AX[_XX]=_WID*_TB[_ZW]+_DFI
ENDIF
ENDIF
UNTIL _I==_L
MSG(" ")
GOTOF _RUECK
SCHREIB:
IF _ZW==0 GOTOF _RUECK
IF (_ARTIS[11]==2)
_ARTIS[9]=_ARTIS[9]+1
IF (_ARTIS[3]<>0)
IF (_ARTIS[9]==_ARTIS[13])
_ARTIS[1]=_ARTIS[13] _ARTIS[2]=_ARTIS[13]
IF (_ARTIS[13]+_ARTIS[3]<=_SC_TOOL_VALI[2])
_ARTIS[13]=_ARTIS[13]+_ARTIS[3]
ENDIF
ENDIF
ENDIF
ENDIF
CASE _ZW OF 32 GOTOF _CH32 33 GOTOF _CH33 34 GOTOF _CH34 35 GOTOF _CH35 36 GOTOF _CH36 37 GOTOF _CH37 38 GOTOF _CH38 39 GOTOF _CH39 40 GOTOF _CH40
CASE _ZW OF 41 GOTOF _CH41 42 GOTOF _CH42 43 GOTOF _CH43 44 GOTOF _CH44 45 GOTOF _CH45 46 GOTOF _CH46 47 GOTOF _CH47 48 GOTOF _CH48 49 GOTOF _CH49 50 GOTOF _CH50
CASE _ZW OF 51 GOTOF _CH51 52 GOTOF _CH52 53 GOTOF _CH53 54 GOTOF _CH54 55 GOTOF _CH55 56 GOTOF _CH56 57 GOTOF _CH57 58 GOTOF _CH58 59 GOTOF _CH59 60 GOTOF _CH60
CASE _ZW OF 61 GOTOF _CH61 62 GOTOF _CH62 63 GOTOF _CH63 64 GOTOF _CH64 65 GOTOF _CH65 66 GOTOF _CH66 67 GOTOF _CH67 68 GOTOF _CH68 69 GOTOF _CH69 70 GOTOF _CH70
CASE _ZW OF 71 GOTOF _CH71 72 GOTOF _CH72 73 GOTOF _CH73 74 GOTOF _CH74 75 GOTOF _CH75 76 GOTOF _CH76 77 GOTOF _CH77 78 GOTOF _CH78 79 GOTOF _CH79 80 GOTOF _CH80
CASE _ZW OF 81 GOTOF _CH81 82 GOTOF _CH82 83 GOTOF _CH83 84 GOTOF _CH84 85 GOTOF _CH85 86 GOTOF _CH86 87 GOTOF _CH87 88 GOTOF _CH88 89 GOTOF _CH89 90 GOTOF _CH90
CASE _ZW OF 91 GOTOF _CH91 92 GOTOF _CH92 93 GOTOF _CH93 94 GOTOF _CH94 95 GOTOF _CH95 96 GOTOF _CH96 97 GOTOF _CH97 98 GOTOF _CH98 99 GOTOF _CH99 100 GOTOF _CH100
CASE _ZW OF 101 GOTOF _CH101 102 GOTOF _CH102 103 GOTOF _CH103 104 GOTOF _CH104 105 GOTOF _CH105 106 GOTOF _CH106 107 GOTOF _CH107 108 GOTOF _CH108 109 GOTOF _CH109
CASE _ZW OF 110 GOTOF _CH110 111 GOTOF _CH111 112 GOTOF _CH112 113 GOTOF _CH113 114 GOTOF _CH114 115 GOTOF _CH115 116 GOTOF _CH116 117 GOTOF _CH117 118 GOTOF _CH118
CASE _ZW OF 119 GOTOF _CH119 120 GOTOF _CH120 121 GOTOF _CH121 122 GOTOF _CH122 123 GOTOF _CH123 124 GOTOF _CH124 125 GOTOF _CH125 126 GOTOF _CH126
CASE _ZW OF 128 GOTOF _CH128 138 GOTOF _CH138 140 GOTOF _CH140 142 GOTOF _CH142 154 GOTOF _CH154
CASE _ZW OF 156 GOTOF _CH156 157 GOTOF _CH157 158 GOTOF _CH158 159 GOTOF _CH159 162 GOTOF _CH162 163 GOTOF _CH163 165 GOTOF _CH165 167 GOTOF _CH167 169 GOTOF _CH169 174 GOTOF _CH174
CASE _ZW OF 176 GOTOF _CH176 180 GOTOF _CH180 181 GOTOF _CH181 192 GOTOF _CH192 193 GOTOF _CH193 194 GOTOF _CH194 195 GOTOF _CH195 196 GOTOF _CH196
CASE _ZW OF 197 GOTOF _CH197 198 GOTOF _CH198 199 GOTOF _CH199 200 GOTOF _CH200 201 GOTOF _CH201 202 GOTOF _CH202 203 GOTOF _CH203 204 GOTOF _CH204 205 GOTOF _CH205
CASE _ZW OF 206 GOTOF _CH206 207 GOTOF _CH207 208 GOTOF _CH208 209 GOTOF _CH209
CASE _ZW OF 210 GOTOF _CH210 211 GOTOF _CH211 212 GOTOF _CH212 213 GOTOF _CH213
CASE _ZW OF 214 GOTOF _CH214 215 GOTOF _CH215 216 GOTOF _CH216 217 GOTOF _CH217 218 GOTOF _CH218 219 GOTOF _CH219
CASE _ZW OF 220 GOTOF _CH220 221 GOTOF _CH221 222 GOTOF _CH222 223 GOTOF _CH223
CASE _ZW OF 224 GOTOF _CH224 225 GOTOF _CH225 226 GOTOF _CH226 227 GOTOF _CH227 228 GOTOF _CH228 229 GOTOF _CH229 230 GOTOF _CH230
CASE _ZW OF 231 GOTOF _CH231 232 GOTOF _CH232 233 GOTOF _CH233 234 GOTOF _CH234 235 GOTOF _CH235 236 GOTOF _CH236 237 GOTOF _CH237 238 GOTOF _CH238 239 GOTOF _CH239
CASE _ZW OF 240 GOTOF _CH240 241 GOTOF _CH241 242 GOTOF _CH242 243 GOTOF _CH243 244 GOTOF _CH244 245 GOTOF _CH245 246 GOTOF _CH246 247 GOTOF _CH247
CASE _ZW OF 248 GOTOF _CH248 249 GOTOF _CH249 250 GOTOF _CH250 251 GOTOF _CH251 252 GOTOF _CH252 253 GOTOF _CH253 254 GOTOF _CH254 255 GOTOF _CH255
IF(_NCK < 4305)
SETAL(61179)
ELSE
_ZNR=_I+1
_ZEZA=""<<_ZNR
GOTOF _FEHL2
ENDIF
_CH32:
GOTOB _MR
_CH33:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
REPEAT _ABA _ABE
G91 AX[_YY]=0.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=0.7*_WID
GOTOB _MR
_CH34:
_R[0]=0.1*_WID _R[1]=0.3*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
REPEAT _ABA _ABE
G91 AX[_XX]=_WID/5
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH35:
_R[0]=_WID/5.672 _R[1]=0.2442*_WID _R[2]=0.6*_WID _R[3]=0.4*_WID
G90 G0 AX[_XX]=0.02*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_WID
REPEAT _ABA _ABE
G91 AX[_XX]=_WID/5
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=-_WID
REPEAT _ABA _ABE
AX[_XX]=_R[3] AX[_YY]=_R[2]-_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[3]
REPEAT _ABA _ABE
G91 AX[_XX]=0.04*_WID AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[3]
GOTOB _MR
_CH36:
_R[0]=_WID/4 _R[1]=_WID/10
G90 G0 AX[_XX]=0 AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=_R[0] IP[_YY]=0
G2 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=0 IP[_YY]=_R[0]
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[0] AX[_YY]=(-_R[0]*3)-_R[1]
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID+_R[1]*2
GOTOB _MR
_CH37:
_R[0]=0.1892*_WID _R[1]=0.7108*_WID _R[2]=0.5216*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.8108*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=_R[0] IP[_YY]=0
REPEAT _ABA _ABE
G91 AX[_XX]=_R[1] AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[2] AX[_YY]=-_WID
REPEAT _ABA _ABE
G91 AX[_XX]=_R[2] AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=0 IP[_YY]=_R[0]
GOTOB _MR
_CH38:
_R[0]=0.5676*_WID _R[1]=0.4685*_WID _R[2]=0.7062*_WID _R[3]=0.2873*_WID
_R[4]=0.0332*_WID _R[5]=0.1577*_WID _R[6]=0.1046*_WID _R[7]=0.3183*_WID
_R[8]=0.2992*_WID _R[9]=0.2641*_WID _R[10]=0.34*_WID _R[11]=0.1481*_WID
_R[12]=0.1575*_WID _R[13]=0.2878*_WID _R[14]=0.2757*_WID _R[15]=0.5435*_WID
_R[16]=0.8554*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[1] AX[_YY]=_R[2]
G2 AX[_XX]=_R[3] AX[_YY]=-_R[4] IP[_XX]=_R[5] IP[_YY]=_R[6]
G1 AX[_XX]=-_R[7] AX[_YY]=-_R[8]
G3 AX[_XX]=_R[9] AX[_YY]=-_R[10] IP[_XX]=_R[11] IP[_YY]=-_R[12]
AX[_XX]=_R[13] AX[_YY]=_R[14] IP[_XX]=-_R[15] IP[_YY]=_R[16]
GOTOB _MR
_CH39:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.15*_WID
GOTOB _MR
_CH40:
G90 G0 AX[_XX]=_WID/4 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=1.3*_WID IP[_XX]=0.75*_WID IP[_YY]=0.65*_WID
GOTOB _MR
_CH41:
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=0 AX[_YY]=1.3*_WID IP[_XX]=-0.75*_WID IP[_YY]=0.65*_WID
GOTOB _MR
_CH42:
_R[0]=0.35*_WID _R[1]=0.37*_WID _R[2]=1.7321*_R[1]/4 _R[3]=_R[1]/4
G90 G0 AX[_XX]=0 AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[1]
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[3] AX[_YY]=_R[2]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-2*_R[3] AX[_YY]=-2*_R[2]
REPEAT _ABA _ABE
G91 AX[_YY]=2*_R[2]
REPEAT _ZUA _ZUE
G91 AX[_XX]=2*_R[3] AX[_YY]=-2*_R[2]
GOTOB _MR
_CH43:
G90 G0 AX[_XX]=0 AX[_YY]=0.35*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.4*_WID
REPEAT _ABA _ABE
G91 AX[_XX]=-0.2*_WID AX[_YY]=0.2*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.4*_WID
GOTOB _MR
_CH44:
G90 G0 AX[_XX]=0 AX[_YY]=-0.1*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.1*_WID AX[_YY]=0.2*_WID
GOTOB _MR
_CH45:
G90 G0 AX[_XX]=0 AX[_YY]=0.35*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.4*_WID
GOTOB _MR
_CH46:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
GOTOB _MR
_CH47:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/2 AX[_YY]=_WID
GOTOB _MR
_CH48:
_R[0]=0.1423*_WID _R[1]=0.093*_WID _R[2]=0.1554*_WID _R[3]=0.814*_WID
_R[4]=0.9282*_WID _R[5]=0.407*_WID _R[6]=0.2846*_WID _R[7]=0.0624*_WID
G90 G0 AX[_XX]=(0.2297+0.02)*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-_R[0] AX[_YY]=_R[1] IP[_XX]=0 IP[_YY]=_R[2]
AX[_XX]=0 AX[_YY]=_R[3] IP[_XX]=_R[4] IP[_YY]=_R[5]
AX[_XX]=_R[6] AX[_YY]=0 IP[_XX]=_R[0] IP[_YY]=-_R[7]
AX[_XX]=0 AX[_YY]=-_R[3] IP[_XX]=-_R[4] IP[_YY]=-_R[5]
AX[_XX]=-_R[0] AX[_YY]=-_R[1] IP[_XX]=-_R[0] IP[_YY]=_R[7]
GOTOB _MR
_CH49:
G90 G0 AX[_XX]=_WID/8 AX[_YY]=0.75*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/4 AX[_YY]=_WID/4
AX[_YY]=-_WID
GOTOB _MR
_CH50:
G90 G0 AX[_XX]=0 AX[_YY]=0.75*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0.45*_WID AX[_YY]=-0.15*_WID IP[_XX]=_WID/4 IP[_YY]=0
G1 AX[_XX]=-0.45*_WID AX[_YY]=-0.6*_WID
AX[_XX]=_WID/2
GOTOB _MR
_CH51:
_R[0]=0.1622*_WID _R[1]=0.2027*_WID _R[2]=0.1892*_WID _R[3]=0.2297*_WID
G90 G0 AX[_XX]=0.05*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
G2 AX[_XX]=_R[1] AX[_YY]=-_R[1] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_YY]=-0.0946*_WID
G2 AX[_XX]=-_R[0] AX[_YY]=-_R[0] IP[_XX]=-_R[0] IP[_YY]=0
G1 AX[_XX]=-_R[2]
AX[_XX]=_R[2]
G2 AX[_XX]=_R[2] AX[_YY]=-_R[2] IP[_XX]=0 IP[_YY]=-_R[2]
G1 AX[_YY]=-0.1216*_WID
G2 AX[_XX]=-_R[3] AX[_YY]=-_R[3] IP[_XX]=-_R[3] IP[_YY]=0
G1 AX[_XX]=-_R[0]
GOTOB _MR
_CH52:
_R[0]=_WID/2 _R[1]=1.5*_R[0]
G90 G0 AX[_XX]=_R[0] AX[_YY]=_WID/4
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0]
AX[_XX]=_WID*0.35 AX[_YY]=_R[1]
AX[_YY]=-_WID
GOTOB _MR
_CH53:
_R[0]=0.1486*_WID _R[1]=0.2432*_WID
G90 G0 AX[_XX]=0.0541*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
G3 AX[_XX]=_R[1] AX[_YY]=_R[1] IP[_XX]=0 IP[_YY]=_R[1]
G1 AX[_YY]=0.05405*_WID
G3 AX[_XX]=-_R[1] AX[_YY]=_R[1] IP[_XX]=-_R[1] IP[_YY]=0
G1 AX[_XX]=-_R[0]
AX[_YY]=0.4595*_WID
AX[_XX]=0.3514*_WID
GOTOB _MR
_CH54:
_R[0]=0.2027*_WID _R[1]=0.2973*_WID _R[2]=0.4595*_WID _R[3]=0.2297*_WID
_R[4]=0.4658*_WID _R[5]=0.5135*_WID
G90 G0 AX[_XX]=0.02*_WID AX[_YY]=0.5405*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.2568*_WID
G2 AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[0]
G1 AX[_XX]=0 AX[_YY]=-0.1081*_WID
G2 AX[_XX]=-_R[2] AX[_YY]=0 IP[_XX]=-_R[3] IP[_YY]=0
G1 AX[_XX]=0 AX[_YY]=0.3045*_WID
G2 AX[_XX]=_R[1] AX[_YY]=_R[4] IP[_XX]=_R[5] IP[_YY]=0
GOTOB _MR
_CH55:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/2
AX[_XX]=-_WID/4 AX[_YY]=-_WID
GOTOB _MR
_CH56:
_R[0]=0.2297*_WID _R[1]=0.08108*_WID _R[2]=0.1959*_WID _R[3]=0.06757*_WID _R[4]=0.3919*_WID
G90 G0 AX[_XX]=_R[0]+0.02*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-_R[0] AX[_YY]=_R[0] IP[_XX]=0 IP[_YY]=_R[0]
G1 AX[_YY]=_R[1]
G2 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=_R[0] IP[_YY]=0
G3 AX[_XX]=_R[2] AX[_YY]=_R[2] IP[_XX]=0 IP[_YY]=_R[2]
G1 AX[_YY]=_R[3]
G3 AX[_XX]=-_R[4] AX[_YY]=0 IP[_XX]=-_R[2] IP[_YY]=0
G1 AX[_YY]=-_R[3]
G3 AX[_XX]=_R[2] AX[_YY]=-_R[2] IP[_XX]=_R[2] IP[_YY]=0
G2 AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[0]
G1 AX[_YY]=-_R[1]
G2 AX[_XX]=-_R[0] AX[_YY]=-_R[0] IP[_XX]=-_R[0] IP[_YY]=0
GOTOB _MR
_CH57:
_R[0]=0.2973*_WID _R[1]=0.4658*_WID _R[2]=0.2162*_WID _R[3]=0.4595*_WID
_R[4]=0.2297*_WID _R[5]=0.2027*_WID
G90 G0 AX[_XX]=(0.1622+0.02)*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=-_R[2] IP[_YY]=_R[1]
G1 AX[_YY]=0.3045*_WID
G3 AX[_XX]=-_R[3] AX[_YY]=0 IP[_XX]=-_R[4] IP[_YY]=0
G1 AX[_YY]=-0.1081*_WID
G3 AX[_XX]=_R[5] AX[_YY]=-_R[5] IP[_XX]=_R[5] IP[_YY]=0
G1 AX[_XX]=0.2568*_WID
GOTOB _MR
_CH58:
G90 G0 AX[_XX]=0 AX[_YY]=0.175*_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
REPEAT _ABA _ABE
G91 AX[_YY]=0.35*_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
GOTOB _MR
_CH59:
G90 G0 AX[_XX]=0 AX[_YY]=-0.1*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.1*_WID AX[_YY]=0.2*_WID
REPEAT _ABA _ABE
G91 AX[_YY]=_WID/4
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
GOTOB _MR
_CH60:
_R[0]=0.35*_WID _R[1]=0.25*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=0.6*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=-_R[1]
AX[_XX]=_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH61:
G90 G0 AX[_XX]=0 AX[_YY]=0.475*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.4*_WID
REPEAT _ABA _ABE
G91 AX[_YY]=-_WID/4
REPEAT _ZUA _ZUE
G91 AX[_XX]=-0.4*_WID
GOTOB _MR
_CH62:
_R[0]=0.35*_WID _R[1]=0.25*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.6*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[1]
AX[_XX]=-_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH63:
_R[0]=0.3196*_WID _R[1]=0.2442*_WID _R[2]=0.1753*_WID _R[3]=0.1018*_WID
_R[4]=0.158*_WID _R[5]=0.3849*_WID _R[6]=0.39*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.899*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=_R[0] AX[_YY]=-_R[1] IP[_XX]=_R[2] IP[_YY]=-_R[3]
G3 AX[_XX]=-_R[4] AX[_YY]=-_R[5] IP[_XX]=_R[6] IP[_YY]=-_R[5]
REPEAT _ABA _ABE
G91 AX[_YY]=-0.2699*_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
GOTOB _MR
_CH64:
_R[0]=0.4197*_WID _R[1]=0.1949*_WID _R[2]=0.3851*_WID _R[3]=0.2801*_WID
_R[4]=0.0922*_WID _R[5]=0.9819*_WID _R[6]=0.0363*_WID _R[7]=0.4987*_WID
_R[8]=0.4054*_WID _R[9]=0.6936*_WID _R[10]=0.1071*_WID _R[11]=0.4027*_WID
_R[12]=0.1794*_WID _R[13]=0.1052*_WID _R[14]=0.0767*_WID _R[15]=0.0748*_WID
_R[16]=0.1013*_WID _R[17]=0.3418*_WID _R[18]=0.0626*_WID _R[19]=0.2114*_WID
_R[20]=0.1703*_WID _R[21]=0.2453*_WID _R[22]=0.4566*_WID _R[23]=0.1352*_WID
_R[24]=0.1673*_WID _R[25]=0.0558*_WID _R[26]=0.0644*_WID _R[27]=0.0856*_WID
_R[28]=0.2102*_WID _R[29]=0.4311*_WID _R[30]=0.343*_WID _R[31]=0.0995*_WID
_R[32]=0.147*_WID _R[33]=0.0975*_WID _R[34]=0.0398*_WID _R[35]=0.0995*_WID
_R[36]=0.0195*_WID _R[37]=0.144*_WID _R[38]=0.4761*_WID _R[39]=0.0088*_WID
G90 G0 AX[_XX]=0.885*_WID AX[_YY]=0.2024*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-_R[0] AX[_YY]=-_R[1] IP[_XX]=-_R[2] IP[_YY]=_R[3]
G2 AX[_XX]=-_R[4] AX[_YY]=_R[5] IP[_XX]=_R[6] IP[_YY]=_R[7]
AX[_XX]=_R[8] AX[_YY]=-_R[9] IP[_XX]=_R[10] IP[_YY]=-_R[11]
AX[_XX]=-_R[12] AX[_YY]=_R[13] IP[_XX]=-_R[14] IP[_YY]=_R[15]
G1 AX[_XX]=_R[16] AX[_YY]=_R[17]
AX[_XX]=-_R[18] AX[_YY]=-_R[19]
G2 AX[_XX]=-_R[20] AX[_YY]=-_R[21] IP[_XX]=-_R[22] IP[_YY]=_R[23]
AX[_XX]=-_R[24] AX[_YY]=_R[25] IP[_XX]=-_R[26] IP[_YY]=_R[27]
AX[_XX]=_R[28] AX[_YY]=_R[29] IP[_XX]=_R[30] IP[_YY]=_R[31]
AX[_XX]=_R[32] AX[_YY]=-_R[33] IP[_XX]=_R[34] IP[_YY]=-_R[35]
AX[_XX]=-_R[36] AX[_YY]=-_R[37] IP[_XX]=-_R[38] IP[_YY]=-_R[39]
GOTOB _MR
_CH65:
_R[0]=_WID/4 _R[1]=_WID/3.333 _R[2]=_WID/2.857 _R[3]=_WID/13.333
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_WID
AX[_XX]=_R[0] AX[_YY]=-_WID
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[3] AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[2]
_CH65E:
GOTOB _MR
_CH66:
_R[0]=_WID/2 _R[1]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_R[1]
G2 AX[_XX]=0 AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_XX]=-_R[1]
AX[_XX]=_R[1]
G2 AX[_XX]=0 AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_XX]=-_R[1]
GOTOB _MR
_CH67:
G90 G0 AX[_XX]=(0.5-0.0025)*_WID AX[_YY]=0.2*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-0.495*_WID AX[_YY]=0.05*_WID IP[_XX]=-0.245*_WID IP[_YY]=0.05*_WID
G1 AX[_YY]=0.5*_WID
G2 AX[_XX]=0.495*_WID AX[_YY]=0.05*_WID IP[_XX]=0.25*_WID IP[_YY]=0
GOTOB _MR
_CH68:
_R[0]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_R[0]
G2 AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[0]
G1 AX[_YY]=-_WID/2
G2 AX[_XX]=-_R[0] AX[_YY]=-_R[0] IP[_XX]=-_R[0] IP[_YY]=0
G1 AX[_XX]=-_R[0]
GOTOB _MR
_CH69:
G90 G0 AX[_XX]=0 AX[_YY]=0.5*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.5*_WID
REPEAT _ABA _ABE
AX[_XX]=0.5*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
AX[_XX]=0
AX[_YY]=_WID
AX[_XX]=_WID/2
_CH69E:
GOTOB _MR
_CH70:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_WID/2
REPEAT _ABA _ABE
G91 AX[_XX]=-_WID/2 AX[_YY]=-_WID/2
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/2
GOTOB _MR
_CH71:
_R[1]=_WID/4
G90 G0 AX[_XX]=0.495*_WID AX[_YY]=0.8*_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=-0.495*_WID AX[_YY]=-0.05*_WID CR=_R[1]
G1 AX[_YY]=-_WID/2
G3 AX[_XX]=_WID/2 AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=_R[1]
AX[_XX]=-_R[1]
GOTOB _MR
_CH72:
_R[0]=_WID/2
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=_WID
REPEAT _ABA _ABE
G91 AX[_XX]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_WID
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[0] AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
GOTOB _MR
_CH73:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=_WID
GOTOB _MR
_CH74:
G90 G0 AX[_XX]=(0.5-0.0025)*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.75*_WID
G2 AX[_XX]=-0.495*_WID AX[_YY]=-0.05*_WID IP[_XX]=-0.25*_WID IP[_YY]=0
GOTOB _MR
_CH75:
_R[0]=_WID/2
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
REPEAT _ABA _ABE
G91 AX[_XX]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=-_R[0]
AX[_XX]=_R[0] AX[_YY]=-_R[0]
GOTOB _MR
_CH76:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_WID
AX[_XX]=_WID/2
GOTOB _MR
_CH77:
_R[0]=_WID/2 _R[1]=0.35*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_R[1] AX[_YY]=-_R[0]
AX[_XX]=_R[1] AX[_YY]=_R[0]
AX[_YY]=-_WID
GOTOB _MR
_CH78:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_WID/2 AX[_YY]=-_WID
AX[_YY]=_WID
_CH78E:
GOTOB _MR
_CH79:
_R[0]=_WID/2 _R[1]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_YY]=_R[0]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
_CH79E:
GOTOB _MR
_CH80:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_WID/4
G2 AX[_XX]=0 AX[_YY]=-_WID/2 IP[_XX]=0 IP[_YY]=-_WID/4
G1 AX[_XX]=-_WID/4
GOTOB _MR
_CH81:
_R[0]=_WID/2 _R[1]=_WID/4 _R[2]=_R[0]/4
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_YY]=_R[0]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
REPEAT _ABA _ABE
G91 AX[_XX]=_R[1]+_R[2] AX[_YY]=-_R[2]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[2] AX[_YY]=-_R[2]
GOTOB _MR
_CH82:
_R[0]=_WID/2 _R[1]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_R[1]
G2 AX[_XX]=0 AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_XX]=-_R[1]
AX[_XX]=_R[1]
AX[_XX]=_R[1] AX[_YY]=-_R[0]
GOTOB _MR
_CH83:
G90 G0 AX[_XX]=0.005*_WID AX[_YY]=0.2*_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=0.245*_WID AX[_YY]=0.3*_WID IP[_XX]=0.245*_WID IP[_YY]=0.05*_WID
G2 AX[_XX]=0.245*_WID AX[_YY]=0.3*_WID IP[_XX]=0 IP[_YY]=0.25*_WID
_CH83E:
GOTOB _MR
_CH84:
G90 G0 AX[_XX]=_WID/4 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
REPEAT _ABA _ABE
G91 AX[_XX]=-_WID/4
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/2
GOTOB _MR
_CH85:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.75*_WID
G3 AX[_XX]=_WID/2 AX[_YY]=0 IP[_XX]=_WID/4 IP[_YY]=0
G1 AX[_YY]=0.75*_WID
_CH85E:
GOTOB _MR
_CH86:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/4 AX[_YY]=-_WID
AX[_XX]=_WID/4 AX[_YY]=_WID
GOTOB _MR
_CH87:
_R[0]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_WID
AX[_XX]=_R[0] AX[_YY]=_WID
AX[_XX]=_R[0] AX[_YY]=-_WID
AX[_XX]=_R[0] AX[_YY]=_WID
GOTOB _MR
_CH88:
_R[0]=_WID/2
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_WID
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_WID
GOTOB _MR
_CH89:
_R[0]=_WID/2 _R[1]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[1] AX[_YY]=-_R[0]
AX[_XX]=_R[1] AX[_YY]=_R[0]
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[1] AX[_YY]=-_R[0]
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_R[0]
_CH89E:
GOTOB _MR
_CH90:
_R[0]=_WID/2
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
AX[_XX]=-_R[0] AX[_YY]=-_WID
AX[_XX]=_R[0]
_CH90E:
GOTOB _MR
_CH91:
_R[0]=_WID/10
G90 G0 AX[_XX]=_R[0] AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0]
AX[_YY]=-1.3*_WID
AX[_XX]=_R[0]
GOTOB _MR
_CH92:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.5*_WID AX[_YY]=-_WID
GOTOB _MR
_CH93:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/10
AX[_YY]=-1.3*_WID
AX[_XX]=-_WID/10
GOTOB _MR
_CH94:
_R[0]=0.1*_WID _R[1]=0.15*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
AX[_XX]=_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH95:
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_WID/2
GOTOB _MR
_CH96:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.1*_WID AX[_YY]=-0.15*_WID
GOTOB _MR
_CH97:
_R[0]=_WID/4 _R[1]=0.15*_WID _R[2]=_R[0]/5 _R[3]=0.4*_WID
G90 G0 AX[_XX]=_WID/2.8570 AX[_YY]=_R[1]+_R[3]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=-_R[1] AX[_YY]=_R[1] IP[_XX]=-_R[1] IP[_YY]=0
G1 AX[_XX]=-_R[2]
G3 AX[_XX]=-_R[1] AX[_YY]=-_R[1] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_YY]=-_R[3]
G3 AX[_XX]=_R[1] AX[_YY]=-_R[1] IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_XX]=_R[2]
G3 AX[_XX]=_R[1] AX[_YY]=_R[1] IP[_XX]=0 IP[_YY]=_R[1]
G1 AX[_YY]=_R[3]
AX[_YY]=_R[1]
AX[_YY]=-0.7*_WID
_CH97E:
GOTOB _MR
_CH98:
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_WID
AX[_YY]=_R[1]
G3 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=_R[0]
G3 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
GOTOB _MR
_CH99:
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=_R[0]+_R[1]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G3 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
_CH99E:
GOTOB _MR
_CH100:
_R[0]=0.35*_WID _R[1]=0.15*_WID _R[2]=0.175*_WID _R[3]=0.525*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=_R[3]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[2] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G3 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[2] IP[_YY]=0
REPEAT _ABA _ABE
G91 AX[_YY]=0.825*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_WID
GOTOB _MR
_CH101:
_R[0]=_WID/4 _R[1]=0.35*_WID _R[2]=0.15*_WID _R[3]=_R[0]/5
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[1]
AX[_YY]=0.2*_WID
G3 AX[_XX]=-_R[2] AX[_YY]=_R[2] IP[_XX]=-_R[2] IP[_YY]=0
G1 AX[_XX]=-_R[3]
G3 AX[_XX]=-_R[2] AX[_YY]=-_R[2] IP[_XX]=0 IP[_YY]=-_R[2]
G1 AX[_YY]=-0.4*_WID
G3 AX[_XX]=_R[2] AX[_YY]=-_R[2] IP[_XX]=_R[2] IP[_YY]=0
G1 AX[_XX]=_R[3]
G3 AX[_XX]=_R[2] AX[_YY]=_R[2] IP[_XX]=0 IP[_YY]=_R[2]
_CH101E:
GOTOB _MR
_CH102:
_R[0]=_WID/3.333 _R[1]=0.15*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
REPEAT _ABA _ABE
G91 AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=-_R[1] AX[_YY]=-_R[1] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_YY]=-0.85*_WID
GOTOB _MR
_CH103:
_R[0]=0.15*_WID _R[1]=0.05*_WID
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.2*_WID
G3 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=0 IP[_YY]=_R[0]
G1 AX[_YY]=0.85*_WID
AX[_YY]=-_R[0]
G3 AX[_XX]=-_R[0] AX[_YY]=_R[0] IP[_XX]=-_R[0] IP[_YY]=0
G1 AX[_XX]=-_R[1]
G3 AX[_XX]=-_R[0] AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[0]
G1 AX[_YY]=-0.4*_WID
G3 AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=_R[0] IP[_YY]=0
G1 AX[_XX]=_R[1]
G3 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=0 IP[_YY]=_R[0]
GOTOB _MR
_CH104:
_R[0]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_YY]=-0.475*_WID
G2 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=_R[0] IP[_YY]=0
AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[0]
G1 AX[_YY]=-0.525*_WID
GOTOB _MR
_CH105:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=0.7*_WID
REPEAT _ABA _ABE
AX[_YY]=_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
GOTOB _MR
_CH106:
_R[0]=0.1556*_WID
G90 G0 AX[_XX]=0 AX[_YY]=-0.3033*_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=0 IP[_YY]=_R[0]
G1 AX[_XX]=0 AX[_YY]=0.8556*_WID
REPEAT _ABA _ABE
AX[_YY]=_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
GOTOB _MR
_CH107:
_R[0]=0.35*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
REPEAT _ABA _ABE
G91 AX[_XX]=_R[0] AX[_YY]=-_WID/3.333
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=-_R[0]
AX[_XX]=_R[0] AX[_YY]=-_R[0]
GOTOB _MR
_CH108:
_R[0]=0.15*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.85*_WID
G3 AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=_R[0] IP[_YY]=0
GOTOB _MR
_CH109:
_R[0]=0.325*_WID _R[1]=0.1625*_WID _R[2]=0.5375*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.7*_WID
AX[_YY]=_R[2]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[2]
AX[_YY]=_R[2]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[2]
GOTOB _MR
_CH110:
_R[0]=0.175*_WID _R[1]=0.525*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.7*_WID
AX[_YY]=_R[1]
G2 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=_R[0] IP[_YY]=0
AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[0]
G1 AX[_YY]=-_R[1]
_CH110E:
GOTOB _MR
_CH111:
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_YY]=_R[0]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
_CH111E:
GOTOB _MR
_CH112:
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_YY]=-_R[1]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
GOTOB _MR
_CH113:
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
G1 AX[_YY]=_R[0]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=_R[1]
AX[_YY]=-_WID
GOTOB _MR
_CH114:
_R[0]=0.25*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.7*_WID
AX[_YY]=0.45*_WID
G2 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=_R[0] IP[_YY]=0
GOTOB _MR
_CH115:
_R[0]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=_R[0] IP[_YY]=0
G2 AX[_XX]=_R[0] AX[_YY]=_R[0] IP[_XX]=0 IP[_YY]=_R[0]
_CH115E:
GOTOB _MR
_CH116:
_R[0]=_WID/3.333 _R[1]=0.15*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[1] AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_YY]=-0.85*_WID
G3 AX[_XX]=_R[1] AX[_YY]=-_R[1] IP[_XX]=_R[1] IP[_YY]=0
GOTOB _MR
_CH117:
_R[0]=0.15*_WID _R[1]=0.525*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.7*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_R[1]
G3 AX[_XX]=0.35*_WID AX[_YY]=0 IP[_XX]=0.175*_WID IP[_YY]=0
G1 AX[_YY]=_R[1]
AX[_YY]=-0.7*_WID
_CH117E:
GOTOB _MR
_CH118:
_R[0]=0.7*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[1] AX[_YY]=-_R[0]
AX[_XX]=_R[1] AX[_YY]=_R[0]
GOTOB _MR
_CH119:
_R[0]=_WID/8 _R[1]=0.7*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[1]
AX[_XX]=_R[0] AX[_YY]=_R[1]
AX[_XX]=_R[0] AX[_YY]=-_R[1]
AX[_XX]=_R[0] AX[_YY]=_R[1]
GOTOB _MR
_CH120:
_R[0]=0.35*_WID _R[1]=0.7*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH121:
_R[0]=0.7*_WID _R[1]=0.1982*_WID _R[2]=0.1487*_WID _R[3]=0.1143*_WID _R[4]=0.1538*_WID
G90 AX[_XX]=0 AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[1] AX[_YY]=-_R[0]
REPEAT _ABA _ABE
G91 AX[_XX]=-_R[1] AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=_R[2] AX[_YY]=_R[3] IP[_XX]=0 IP[_YY]=_R[4]
G90 G1 AX[_XX]=_R[1] AX[_YY]=0
AX[_XX]=0.35*_WID AX[_YY]=_R[0]
_CH121E:
GOTOB _MR
_CH122:
_R[0]=0.35*_WID _R[1]=0.7*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
AX[_XX]=-_R[0] AX[_YY]=-_R[1]
AX[_XX]=_R[0]
_CH122E:
GOTOB _MR
_CH123:
G90 G0 AX[_XX]=0.2*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=-0.1*_WID AX[_YY]=-0.1*_WID IP[_YY]=-0.1*_WID
G1 AX[_YY]=-0.45*_WID
G2 AX[_XX]=-0.1*_WID AX[_YY]=-0.1*_WID IP[_XX]=-0.1*_WID
AX[_XX]=0.1*_WID AX[_YY]=-0.1*_WID IP[_YY]=-0.1*_WID
G1 AX[_YY]=-0.45*_WID
G3 AX[_XX]=0.1*_WID AX[_YY]=-0.1*_WID IP[_XX]=0.1*_WID
GOTOB _MR
_CH124:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-1.3*_WID
GOTOB _MR
_CH125:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0.1*_WID AX[_YY]=-0.1*_WID IP[_YY]=-0.1*_WID
G1 AX[_YY]=-0.45*_WID
G3 AX[_XX]=0.1*_WID AX[_YY]=-0.1*_WID IP[_XX]=0.1*_WID
AX[_XX]=-0.1*_WID AX[_YY]=-0.1*_WID IP[_YY]=-0.1*_WID
G1 AX[_YY]=-0.45*_WID
G2 AX[_XX]=-0.1*_WID AX[_YY]=-0.1*_WID IP[_XX]=-0.1*_WID
GOTOB _MR
_CH126:
_R[0]=0.41*_WID _R[1]=0.1129*_WID _R[2]=0.2292*_WID _R[3]=0.0313*_WID
_R[4]=0.1799*_WID _R[5]=0.2257*_WID _R[6]=0.1809*_WID _R[7]=0.1442*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.35*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=_R[2] IP[_YY]=-_R[3]
G1 AX[_XX]=_R[4] AX[_YY]=-_R[5]
G3 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=_R[6] IP[_YY]=_R[7]
GOTOB _MR
_CH128:
G90 G0 AX[_XX]=0 AX[_YY]=0.4*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.55*_WID
REPEAT _ABA _ABE
AX[_XX]=0.6*_WID AX[_YY]=0.6*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0
REPEAT _ABA _ABE
AX[_XX]=0.7*_WID AX[_YY]=0.977*_WID
REPEAT _ZUA _ZUE
G3 AX[_XX]=0.195*_WID AX[_YY]=0.8521*_WID IP[_XX]=AC(0.55*_WID) IP[_YY]=AC(0.5*_WID) RND=0.4*_WID
AX[_YY]=0.1479*_WID IP[_XX]=AC(0.8*_WID) IP[_YY]=AC(0.5*_WID) RND=0.4*_WID
AX[_XX]=0.7*_WID AX[_YY]=0.023*_WID IP[_XX]=AC(0.55*_WID) IP[_YY]=AC(0.5*_WID)
GOTOB _MR
_CH138:
REPEAT _CH83 _CH83E
REPEAT _OA13 _OE13
GOTOB _MR
_CH140:
_R[0]=_WID/2 _R[1]=_WID/4
G90 G0 AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_YY]=_R[0]
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
REPEAT _ABA _ABE
AX[_XX]=0.5*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_R[0]
REPEAT _ABA _ABE
G91 AX[_YY]=-_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0]
REPEAT _ABA _ABE
G91 AX[_YY]=-_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
GOTOB _MR
_CH142:
REPEAT _CH90 _CH90E
REPEAT _OA13 _OE13
GOTOB _MR
_CH154:
REPEAT _CH115 _CH115E
REPEAT _OA14 _OE14
GOTOB _MR
_CH156:
_R[0]=0.5376*_WID _R[1]=0.3606*_WID _R[2]=0.4567*_WID _R[3]=0.1273*_WID
_R[4]=0.2283*_WID _R[5]=0.046*_WID _R[6]=0.216*_WID _R[7]=0.5303*_WID
_R[8]=0.4456*_WID _R[9]=0.2228*_WID _R[10]=0.0994*_WID _R[11]=0.4321*_WID
_R[12]=0.4843*_WID _R[13]=0.1167*_WID _R[14]=0.09817*_WID _R[15]=0.2439*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[2] AX[_YY]=0
AX[_XX]=0 AX[_YY]=_R[3]
G3 AX[_XX]=-_R[2] AX[_YY]=0 IP[_XX]=-_R[4] IP[_YY]=0
G1 AX[_XX]=0 AX[_YY]=-_R[3]
G2 AX[_XX]=-_R[5] AX[_YY]=-_R[6] IP[_XX]=-_R[7] IP[_YY]=0
AX[_XX]=-_R[8] AX[_YY]=0 IP[_XX]=-_R[9] IP[_YY]=_R[10]
AX[_XX]=0 AX[_YY]=_R[11] IP[_XX]=_R[12] IP[_YY]=_R[6]
AX[_XX]=_R[8] AX[_YY]=0 IP[_XX]=_R[9] IP[_YY]=-_R[10]
AX[_XX]=_R[5] AX[_YY]=-_R[6] IP[_XX]=-_R[12] IP[_YY]=-_R[6]
G1 AX[_XX]=0 AX[_YY]=-_R[13]
G3 AX[_XX]=_R[2] AX[_YY]=-_R[14] CR=_R[15]
GOTOB _MR
_CH157:
_R[0]=0.5*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=_WID IP[_XX]=0 IP[_YY]=_R[0]
REPEAT _ABA _ABE
G91 AX[_XX]=0.85*_WID AX[_YY]=-_R[0]
REPEAT _ZUA _ZUE
G91 AX[_XX]=-0.35*_WID
REPEAT _ABA _ABE
G91 AX[_XX]=_R[0] AX[_YY]=_R[0]
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=0 AX[_YY]=-_WID IP[_XX]=0 IP[_YY]=-_R[0]
GOTOB _MR
_CH158:
REPEAT _CH122 _CH122E
REPEAT _OA14 _OE14
GOTOB _MR
_CH159:
REPEAT _CH89 _CH89E
REPEAT _OA1 _OE1
GOTOB _MR
_CH162:
REPEAT _CH99 _CH99E
REPEAT _ABA _ABE
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.35*_WID AX[_YY]=_WID
GOTOB _MR
_CH163:
G90 G0 AX[_XX]=0 AX[_YY]=0.5*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.4*_WID
REPEAT _ABA _ABE
AX[_XX]=0.5949*_WID AX[_YY]=0.8*_WID
REPEAT _ZUA _ZUE
G3 AX[_XX]=0.1012*_WID AX[_YY]=0.7749*_WID IP[_XX]=AC(0.35*_WID) IP[_YY]=AC(0.75*_WID)
AX[_XX]=0.1496*_WID AX[_YY]=0.5407*_WID IP[_XX]=AC(0.4993*_WID) IP[_YY]=AC(0.7351*_WID)
G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=AC(-0.2*_WID) IP[_YY]=AC(0.3464*_WID)
AX[_XX]=0.3439*_WID AX[_YY]=0.0268*_WID IP[_XX]=AC(0.2*_WID) IP[_YY]=AC(-0.3464*_WID)
G3 AX[_XX]=0.6*_WID AX[_YY]=0.016*_WID IP[_XX]=AC(0.4879*_WID) IP[_YY]=AC(0.4*_WID)
GOTOB _MR
_CH165:
REPEAT _CH89 _CH89E
REPEAT _ABA _ABE
G90 G0 AX[_XX]=0.5*_WID AX[_YY]=0.5*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=-0.5*_WID
REPEAT _ABA _ABE
G91 AX[_YY]=-0.2*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.5*_WID
GOTOB _MR
_CH167:
G90 G0 AX[_XX]=0.1121*_WID AX[_YY]=-0.1684*_WID
REPEAT _ZUA _ZUE
G3 AX[_XX]=0.3909*_WID AX[_YY]=0.0782*_WID IP[_XX]=AC(0.3*_WID) IP[_YY]=AC(-0.1*_WID)
G1 AX[_XX]=0.1091*_WID AX[_YY]=0.2218*_WID
G2 AX[_XX]=0.3*_WID AX[_YY]=0.5732*_WID IP[_XX]=AC(0.2*_WID) IP[_YY]=AC(0.4*_WID)
REPEAT _ABA _ABE
AX[_XX]=0.3*_WID AX[_YY]=0.1268*_WID
REPEAT _ZUA _ZUE
G3 AX[_XX]=0.4909*_WID AX[_YY]=0.4782*_WID IP[_XX]=AC(0.4*_WID) IP[_YY]=AC(0.3*_WID)
G1 AX[_XX]=0.2091*_WID AX[_YY]=0.6218*_WID
G2 AX[_XX]=0.4879*_WID AX[_YY]=0.8684*_WID IP[_XX]=AC(0.3*_WID) IP[_YY]=AC(0.8*_WID)
GOTOB _MR
_CH169:
G90 G0 AX[_XX]=0 AX[_YY]=0.5*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=0.3125*_WID IP[_YY]=0
REPEAT _ABA _ABE
AX[_XX]=0.4125*_WID AX[_YY]=0.6*_WID
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=0 AX[_YY]=-0.2*_WID IP[_XX]=-0.1*_WID IP[_YY]=-0.1*_WID
GOTOB _MR
_CH174:
_R[0]=0.3125*_WID _R[1]=0.2167*_WID _R[2]=0.1542*_WID _R[3]=0.3167*_WID
_R[4]=0.1563*_WID _R[5]=0.1625*_WID _R[6]=0.0812*_WID _R[7]=0.089*_WID
G90 G0 AX[_XX]=0 AX[_YY]=_WID/2
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=_R[0] IP[_YY]=0
REPEAT _ABA _ABE
G91 AX[_XX]=_R[1] AX[_YY]=-_R[2]
REPEAT _ZUA _ZUE
G91 AX[_YY]=_R[3]
AX[_XX]=_R[4] AX[_YY]=0
G2 AX[_XX]=0 AX[_YY]=-_R[5] IP[_XX]=0 IP[_YY]=-_R[6]
G1 AX[_XX]=-_R[4]
REPEAT _ABA _ABE
G91 AX[_XX]=0.128*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[7] AX[_YY]=-_R[2]
GOTOB _MR
_CH176:
G90 G0 AX[_XX]=0.1*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=0 IP[_YY]=-0.1*_WID
GOTOB _MR
_CH180:
G90 G0 AX[_XX]=0 AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.1*_WID AX[_YY]=0.15*_WID
GOTOB _MR
_CH181:
_R[0]=0.15*_WID _R[1]=0.525*_WID
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
AX[_YY]=0.7*_WID
G91 AX[_YY]=-_R[1]
G3 AX[_XX]=0.35*_WID AX[_YY]=0 IP[_XX]=0.175*_WID IP[_YY]=0
G1 AX[_YY]=_R[1]
AX[_YY]=-0.55*_WID
G3 AX[_XX]=_R[0] AX[_YY]=-_R[0] IP[_XX]=_R[0] IP[_YY]=0
GOTOB _MR
_CH192:
REPEAT _CH65 _CH65E
REPEAT _OA3 _OE3
GOTOB _MR
_CH193:
REPEAT _CH65 _CH65E
REPEAT _OA5 _OE5
GOTOB _MR
_CH194:
REPEAT _CH65 _CH65E
REPEAT _OA7 _OE7
GOTOB _MR
_CH195:
REPEAT _CH65 _CH65E
REPEAT _OA9 _OE9
GOTOB _MR
_CH196:
REPEAT _CH65 _CH65E
REPEAT _OA1 _OE1
GOTOB _MR
_CH197:
REPEAT _CH65 _CH65E
REPEAT _OA11 _OE11
GOTOB _MR
_CH198:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
AX[_XX]=0.3*_WID AX[_YY]=_WID
AX[_XX]=_WID
REPEAT _ABA _ABE
AX[_YY]=0.5*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.5*_WID
REPEAT _ABA _ABE
AX[_YY]=0.3*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.09*_WID
REPEAT _ABA _ABE
AX[_XX]=0.5*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
AX[_YY]=0
AX[_XX]=_WID
GOTOB _MR
_CH199:
_R[0]=0.0909*_WID _R[1]=0.14*_WID _R[2]=0.0611*_WID _R[3]=_R[2]+_R[1]
_R[4]=_WID/2 _R[5]=_WID/4
G90 G0 AX[_XX]=_R[5]-_R[0] AX[_YY]=-_R[3]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
AX[_YY]=_R[2]
REPEAT _ABA _ABE
G90 G0 AX[_XX]=_R[4] AX[_YY]=_R[5]
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-_R[4] AX[_YY]=0 IP[_XX]=-_R[5] IP[_YY]=0
G1 AX[_YY]=_R[4]
G2 AX[_XX]=_R[4] AX[_YY]=0 IP[_XX]=_R[5] IP[_YY]=0
GOTOB _MR
_CH200:
REPEAT _CH69 _CH69E
REPEAT _OA3 _OE3
GOTOB _MR
_CH201:
REPEAT _CH69 _CH69E
REPEAT _OA5 _OE5
GOTOB _MR
_CH202:
REPEAT _CH69 _CH69E
REPEAT _OA7 _OE7
GOTOB _MR
_CH203:
REPEAT _CH69 _CH69E
REPEAT _OA1 _OE1
GOTOB _MR
_CH204:
_R[0]=0.1*_WID _R[1]=0.15*_WID
G90 G0 AX[_XX]=_R[0]/2 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=1.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH205:
_R[0]=0.1*_WID _R[1]=0.15*_WID
G90 G0 AX[_XX]=_R[0]/2 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=1.15*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
GOTOB _MR
_CH206:
_R[0]=0.1*_WID _R[1]=0.15*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=1.15*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
AX[_XX]=_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH207:
G90 G0 AX[_XX]=0.15*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=1.3*_WID
REPEAT _ZUA _ZUE
REPEAT _ABA _ABE
G91 AX[_XX]=0.3*_WID
REPEAT _ZUA _ZUE
GOTOB _MR
_CH208:
_R[0]=_WID/2 _R[1]=_WID/4
G90 G0 AX[_XX]=0.1*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=_WID
AX[_XX]=_R[1]
G2 AX[_XX]=_R[1] AX[_YY]=-_R[1] IP[_XX]=0 IP[_YY]=-_R[1]
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[1] AX[_YY]=-_R[1] IP[_XX]=-_R[1] IP[_YY]=0
G1 AX[_XX]=-_R[1]
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=0.5*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.3*_WID
GOTOB _MR
_CH209:
REPEAT _CH78 _CH78E
REPEAT _OA9 _OE9
GOTOB _MR
_CH210:
REPEAT _CH79 _CH79E
REPEAT _OA3 _OE3
GOTOB _MR
_CH211:
REPEAT _CH79 _CH79E
REPEAT _OA5 _OE5
GOTOB _MR
_CH212:
REPEAT _CH79 _CH79E
REPEAT _OA7 _OE7
GOTOB _MR
_CH213:
REPEAT _CH79 _CH79E
REPEAT _OA9 _OE9
GOTOB _MR
_CH214:
REPEAT _CH79 _CH79E
REPEAT _OA1 _OE1
GOTOB _MR
_CH215:
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=0.35*_WID-_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[0]
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=0.35*_WID+_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[0]
GOTOB _MR
_CH216:
G90 G0 AX[_XX]=0 AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.7*_WID AX[_YY]=_WID
REPEAT _ABA _ABE
AX[_XX]=0.7*_WID AX[_YY]=_WID/2
REPEAT _ZUA _ZUE
G91 G3 AX[_XX]=0 AX[_YY]=0 IP[_XX]=-0.35*_WID IP[_YY]=0
GOTOB _MR
_CH217:
REPEAT _CH85 _CH85E
REPEAT _OA3 _OE3
GOTOB _MR
_CH218:
REPEAT _CH85 _CH85E
REPEAT _OA5 _OE5
GOTOB _MR
_CH219:
REPEAT _CH85 _CH85E
REPEAT _OA7 _OE7
GOTOB _MR
_CH220:
REPEAT _CH85 _CH85E
REPEAT _OA1 _OE1
GOTOB _MR
_CH221:
REPEAT _CH89 _CH89E
REPEAT _OA5 _OE5
GOTOB _MR
_CH222:
G90 G0 AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=-_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=0.75*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.25*_WID
G2 AX[_XX]=0 AX[_YY]=-0.5*_WID IP[_XX]=0 IP[_YY]=-0.25*_WID
G90 G1 AX[_XX]=0
GOTOB _MR
_CH223:
_R[0]=_WID/2 _R[1]=_R[0]/2
G90 G0 AX[_XX]=0 AX[_YY]=-0.15*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=0.9*_WID
G2 AX[_XX]=_R[1] AX[_YY]=-_R[1] IP[_XX]=_R[1] IP[_YY]=0
AX[_XX]=0 AX[_YY]=-_R[0] IP[_XX]=0 IP[_YY]=-_R[1]
GOTOB _MR
_CH224:
REPEAT _CH97 _CH97E
REPEAT _OA4 _OE4
GOTOB _MR
_CH225:
REPEAT _CH97 _CH97E
REPEAT _OA6 _OE6
GOTOB _MR
_CH226:
REPEAT _CH97 _CH97E
REPEAT _OA8 _OE8
GOTOB _MR
_CH227:
REPEAT _CH97 _CH97E
REPEAT _OA10 _OE10
GOTOB _MR
_CH228:
REPEAT _CH97 _CH97E
REPEAT _OA2 _OE2
GOTOB _MR
_CH229:
REPEAT _CH97 _CH97E
REPEAT _OA12 _OE12
GOTOB _MR
_CH230:
_R[0]=0.4561*_WID _R[1]=0.1205*_WID _R[2]=0.2121*_WID _R[3]=0.3182*_WID
_R[4]=0.3606*_WID _R[5]=0.1803*_WID _R[6]=0.0742*_WID _R[7]=0.2439*_WID
_R[8]=0.2651*_WID _R[9]=0.4216*_WID _R[10]=0.0332*_WID _R[11]=0.0288*_WID
_R[12]=0.1817*_WID _R[13]=0.4504*_WID _R[14]=0.3837*_WID _R[15]=0.1247*_WID
G90 G0 AX[_XX]=0.0424*_WID AX[_YY]=0.5977*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=_R[0] AX[_YY]=-_R[1] IP[_XX]=_R[2] IP[_YY]=-_R[1]
G1 AX[_XX]=0 AX[_YY]=-0.1167*_WID
AX[_XX]=-_R[3] AX[_YY]=0
G3 AX[_XX]=0 AX[_YY]=-_R[4] IP[_XX]=0 IP[_YY]=-_R[5]
G1 AX[_XX]=_R[6] AX[_YY]=0
G3 AX[_XX]=_R[7] AX[_YY]=_R[7] IP[_XX]=0 IP[_YY]=_R[7]
G1 AX[_XX]=0 AX[_YY]=_R[8]
G2 AX[_XX]=_R[9] AX[_YY]=_R[10] IP[_XX]=_R[2] IP[_YY]=0
G1 AX[_XX]=_R[11] AX[_YY]=-_R[12]
AX[_XX]=-_R[13] AX[_YY]=0
AX[_XX]=0 AX[_YY]=-0.1485*_WID
G3 AX[_XX]=_R[14] AX[_YY]=-_R[15] IP[_XX]=_R[2] IP[_YY]=0
G1 AX[_XX]=0.0667*_WID AX[_YY]=0.0918*_WID
GOTOB _MR
_CH231:
_R[0]=0.0909*_WID _R[1]=0.175*_WID _R[2]=0.35*_WID
G90 G0 AX[_XX]=0.1041*_WID AX[_YY]=-0.2*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=0.14*_WID
AX[_YY]=0.0611*_WID
REPEAT _ABA _ABE
G91 AX[_XX]=0.155*_WID AX[_YY]=0.1738*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=-_R[2] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
G1 AX[_XX]=0 AX[_YY]=_R[2]
G2 AX[_XX]=_R[2] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
GOTOB _MR
_CH232:
REPEAT _CH101 _CH101E
REPEAT _OA4 _OE4
GOTOB _MR
_CH233:
REPEAT _CH101 _CH101E
REPEAT _OA6 _OE6
GOTOB _MR
_CH234:
REPEAT _CH101 _CH101E
REPEAT _OA8 _OE8
GOTOB _MR
_CH235:
REPEAT _CH101 _CH101E
REPEAT _OA2 _OE2
GOTOB _MR
_CH236:
G90 G0 AX[_XX]=0.05*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_YY]=0.7*_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.1*_WID AX[_YY]=-0.15*_WID
GOTOB _MR
_CH237:
G90 G0 AX[_XX]=0.05*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=0.7*_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.1*_WID AX[_YY]=0.15*_WID
GOTOB _MR
_CH238:
_R[0]=0.1*_WID _R[1]=0.15*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=0.7*_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=_R[1]
AX[_XX]=_R[0] AX[_YY]=-_R[1]
GOTOB _MR
_CH239:
G90 G0 AX[_XX]=0.15*_WID AX[_YY]=0
REPEAT _ZUA _ZUE
G91 G1 AX[_YY]=0.7*_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
REPEAT _ABA _ABE
G91 AX[_XX]=0.3*_WID
REPEAT _ZUA _ZUE
GOTOB _MR
_CH240:
G90 G0 AX[_XX]=0.25*_WID AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
AX[_XX]=0.5*_WID AX[_YY]=0.95*_WID
REPEAT _ABA _ABE
AX[_XX]=0.3*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G2 AX[_XX]=0.6*_WID AX[_YY]=0.35*_WID IP[_XX]=AC(-0.2542*_WID) IP[_YY]=AC(0.35*_WID)
AX[_XX]=0.4271*_WID AX[_YY]=0.0207*_WID IP[_XX]=AC(0.2*_WID) IP[_YY]=AC(0.35*_WID) RND=0.25*_WID
AX[_XX]=0.1729*_WID IP[_XX]=AC(0.3*_WID) IP[_YY]=AC(0.4*_WID) RND=0.25*_WID
AX[_YY]=0.6793*_WID IP[_XX]=AC(0.4*_WID) IP[_YY]=AC(0.35*_WID) RND=0.25*_WID
AX[_XX]=0.4271*_WID IP[_XX]=AC(0.3*_WID) IP[_YY]=AC(0.3*_WID) RND=0.25*_WID
AX[_XX]=0.6*_WID AX[_YY]=0.35*_WID IP[_XX]=AC(0.2*_WID) IP[_YY]=AC(0.35*_WID)
GOTOB _MR
_CH241:
REPEAT _CH110 _CH110E
REPEAT _OA10 _OE10
GOTOB _MR
_CH242:
REPEAT _CH111 _CH111E
REPEAT _OA4 _OE4
GOTOB _MR
_CH243:
REPEAT _CH111 _CH111E
REPEAT _OA6 _OE6
GOTOB _MR
_CH244:
REPEAT _CH111 _CH111E
REPEAT _OA8 _OE8
GOTOB _MR
_CH245:
REPEAT _CH111 _CH111E
REPEAT _OA10 _OE10
GOTOB _MR
_CH246:
REPEAT _CH111 _CH111E
REPEAT _OA2 _OE2
GOTOB _MR
_CH247:
_R[0]=0.4*_WID _R[1]=0.35*_WID _R[2]=0.25*_WID
G90 G0 AX[_XX]=_R[0]/2 AX[_YY]=_R[1]+_R[2]
REPEAT _ZUA _ZUE
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=_R[1]
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0]
REPEAT _ABA _ABE
AX[_XX]=_R[0]/2 AX[_YY]=_R[1]-_R[2]
REPEAT _ZUA _ZUE
GOTOB _MR
_CH248:
_R[0]=0.166*_WID _R[1]=0.2116*_WID _R[2]=0.7898*_WID _R[3]=0.0776*_WID
_R[4]=0.2898*_WID _R[5]=0.0563*_WID _R[6]=0.2102*_WID
G90 G0 AX[_XX]=_R[0] AX[_YY]=0
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[1] AX[_YY]=_R[2]
G3 AX[_XX]=0 AX[_YY]=0 IP[_XX]=-_R[3] IP[_YY]=-_R[4]
G1 AX[_XX]=_R[5] AX[_YY]=_R[6]
GOTOB _MR
_CH249:
REPEAT _CH117 _CH117E
REPEAT _OA4 _OE4
GOTOB _MR
_CH250:
REPEAT _CH117 _CH117E
REPEAT _OA6 _OE6
GOTOB _MR
_CH251:
REPEAT _CH117 _CH117E
REPEAT _OA8 _OE8
GOTOB _MR
_CH252:
REPEAT _CH117 _CH117E
REPEAT _OA2 _OE2
GOTOB _MR
_CH253:
REPEAT _CH121 _CH121E
REPEAT _OA6 _OE6
GOTOB _MR
_CH254:
REPEAT _CH111 _CH111E
REPEAT _ABA _ABE
_R[0]=0.35*_WID _R[1]=0.175*_WID
G90 G0 AX[_XX]=0 AX[_YY]=-0.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_YY]=0.825*_WID
G2 AX[_XX]=_R[0] AX[_YY]=0 IP[_XX]=_R[1] IP[_YY]=0
G1 AX[_YY]=-_R[0]
G2 AX[_XX]=-_R[0] AX[_YY]=0 IP[_XX]=-_R[1] IP[_YY]=0
G1 G90 AX[_YY]=_WID
GOTOB _MR
_CH255:
REPEAT _CH121 _CH121E
REPEAT _OA2 _OE2
GOTOB _MR
_OA1:
REPEAT _ABA _ABE
AX[_XX]=0.075*_WID AX[_YY]=1.3*_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
REPEAT _ABA _ABE
G91 AX[_XX]=0.35*_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
_OE1:
_OA2:
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
REPEAT _ABA _ABE
G91 AX[_XX]=0.35*_WID
REPEAT _ZUA _ZUE
REPEAT _PKT_A _PKT_E
_OE2:
_OA3:
REPEAT _ABA _ABE
AX[_XX]=(0.25-0.0433)*_WID AX[_YY]=1.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.0866*_WID AX[_YY]=-0.15*_WID
_OE3:
_OA4:
REPEAT _ABA _ABE
AX[_XX]=0.1317*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.0866*_WID AX[_YY]=-0.15*_WID
_OE4:
_OA5:
REPEAT _ABA _ABE
AX[_XX]=(0.25-0.0433)*_WID AX[_YY]=1.15*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.0866*_WID AX[_YY]=0.15*_WID
_OE5:
_OA6:
REPEAT _ABA _ABE
AX[_XX]=0.1317*_WID AX[_YY]=0.85*_WID
;AX[_XX]=(0.25-0.0433)*_WID AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=0.0866*_WID AX[_YY]=0.15*_WID
_OE6:
_OA7:
_R[0]=0.0866*_WID _R[1]=0.15*_WID
REPEAT _ABA _ABE
AX[_XX]=(0.25+0.0866)*_WID AX[_YY]=1.15*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=_R[1]
AX[_XX]=-_R[0] AX[_YY]=-_R[1]
_OE7:
_OA8:
_R[0]=0.0866*_WID _R[1]=0.15*_WID
REPEAT _ABA _ABE
AX[_XX]=0.2616*_WID AX[_YY]=0.85*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=-_R[0] AX[_YY]=_R[1]
AX[_XX]=-_R[0] AX[_YY]=-_R[1]
_OE8:
_OA9:
_R[0]=0.1137*_WID _R[1]=0.0526*_WID _R[2]=0.0825*_WID _R[3]=0.0292*_WID
_R[4]=0.1226*_WID _R[5]=0.0468*_WID _R[6]=0.0312*_WID _R[7]=0.0817*_WID
REPEAT _ABA _ABE
AX[_XX]=0.075*_WID AX[_YY]=1.24*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=_R[2] IP[_YY]=-_R[3]
G1 AX[_XX]=_R[4] AX[_YY]=-_R[5]
G3 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=_R[6] IP[_YY]=_R[7]
_OE9:
_OA10:
_R[0]=0.1137*_WID _R[1]=0.0526*_WID _R[2]=0.0825*_WID _R[3]=0.0292*_WID
_R[4]=0.1226*_WID _R[5]=0.0468*_WID _R[6]=0.0312*_WID _R[7]=0.0817*_WID
REPEAT _ABA _ABE
AX[_XX]=0 AX[_YY]=0.94*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=_R[2] IP[_YY]=-_R[3]
G1 AX[_XX]=_R[4] AX[_YY]=-_R[5]
G3 AX[_XX]=_R[0] AX[_YY]=_R[1] IP[_XX]=_R[6] IP[_YY]=_R[7]
_OE10:
_OA11:
REPEAT _ABA _ABE
AX[_XX]=0.25*_WID AX[_YY]=1.3*_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=0 IP[_YY]=-0.075*_WID
_OE11:
_OA12:
REPEAT _ABA _ABE
AX[_XX]=0.175*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=0 IP[_YY]=-0.075*_WID
_OE12:
_OA13:
_R[0]=0.0866*_WID _R[1]=0.15*_WID
REPEAT _ABA _ABE
AX[_XX]=(0.25-0.0866)*_WID AX[_YY]=1.3*_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[1]
AX[_XX]=_R[0] AX[_YY]=_R[1]
_OE13:
_OA14:
_R[0]=0.0866*_WID _R[1]=0.15*_WID
REPEAT _ABA _ABE
AX[_XX]=(0.175-0.0866)*_WID AX[_YY]=_WID
REPEAT _ZUA _ZUE
G91 AX[_XX]=_R[0] AX[_YY]=-_R[1]
AX[_XX]=_R[0] AX[_YY]=_R[1]
_OE14:
_ZUA:
IF (_ARTIS[11]==2)
IF (_ARTIS[9]==_ARTIS[1])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N399 EXECSTRING(_S_FFD)
N400 G1 G90 AX[_ZZ]=_DPI
N401 G09
N402 EXECSTRING(_S_FFP1)
_ZUE:
_PKT_A:
IF _RAD1<>0
_PKT_RAD=_RAD1*_FAK1
IF (_ZW==33)OR(_ZW==46)OR(_ZW==58)OR(_ZW==59)OR(_ZW==63)
_PKT_RAD=ABS(_PKT_RAD)
ENDIF
N403 G91 G2 AX[_XX]=0 AX[_YY]=0 IP[_XX]=0 IP[_YY]=_PKT_RAD
ENDIF
_PKT_E:
_ABA:
N500 G09
IF (_ARTIS[11]==2)
IF (_ARTIS[9]==_ARTIS[2])
M=QU(_ARTIS[8])
ENDIF
ENDIF
SBLON
N502 G90 G0 AX[_ZZ]=_ABHZ
SBLOF
_ABE:
_GET_A1:
IF(NOT _GET_A)
_GET_A=1
_D=$A_DAY _M=$A_MONTH _Y=$A_YEAR _HH=$A_HOUR _MM=$A_MINUTE
_D_STR=<<_D
IF(_D<=9)
_D2_STR="0"<<_D
ELSE
_D2_STR=_D_STR
ENDIF
_M_STR=<<_M
IF(_M<=9)
_M2_STR="0"<<_M
ELSE
_M2_STR=_M_STR
ENDIF
_Y_STR=<<_Y
IF(_Y<=9)
_Y2_STR="0"<<_Y
ELSE
_Y2_STR=_Y_STR
ENDIF
_Y4_STR="20"<<_Y2_STR
IF(_HH<=9)
_HH_STR="0"<<_HH
ELSE
_HH_STR=<<_HH
ENDIF
IF(_MM<=9)
_MM_STR="0"<<_MM
ELSE
_MM_STR=<<_MM
ENDIF
_T24_STR=_HH_STR<<":"<<_MM_STR
IF(_HH>=12)
_AM_PM="PM"
ELSE
_AM_PM="AM"
ENDIF
_HH=_HH MOD 12
IF(_HH==0)
_HH=12
ENDIF
IF(_HH<=9)
_HH12_STR="0"<<_HH
ELSE
_HH12_STR=<<_HH
ENDIF
_T12_STR=_HH12_STR<<":"<<_MM_STR<<" "<<_AM_PM
ENDIF
_GET_A2:
_RUECK:
SBLON
N610 G90 G0 AX[_ZZ]=_RTP
_END:
IF _VI[2]==2
SBLOF
N620 CUST_TECHCYC(_UMODE+1)
SBLON
ENDIF
MSG()
IF (_IS_CYCFR==1)
$P_CYCFRAME=_RE_CYCFR
ENDIF
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_XX]=0
$AA_MEAS_POINT1[_YY]=0
$AA_MEAS_POINT1[_ZZ]=_ABHZ
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_XX])+POT($AA_MEAS_POINT2[_YY])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_ZZ,_ABHZ)
_SC_POS[0]=$P_CYCFRAME[_XX,TR]
_SC_POS[1]=$P_CYCFRAME[_YY,TR]
_SC_POS[2]=$P_CYCFRAME[_ZZ,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_FEHL1:STOPRE
N706001 SETAL(61101)
RET
_FEHL2:STOPRE
N706002 SETAL(61179,_ZEZA)
RET
_FEHL3:STOPRE
N706003 SETAL(61012)
RET
_FEHL4:STOPRE
N706004 SETAL(61178)
RET
_FEHL5:STOPRE
N706005 SETAL(61002)
RET
_FEHL6:STOPRE
N706006 SETAL(61177)
RET
_FEHL7:STOPRE
N706007 SETAL(61176)
RET
_FEHL8:STOPRE
N706008 SETAL(61175)
RET
_FEHL9: STOPRE
N706009 SETAL(61003)
RET
_FEHL10: STOPRE
N706010 SETAL(61019)
RET
_FEHL11: STOPRE
N706011 SETAL(62106)
RET
_FEHL12: STOPRE
N706012 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL18: STOPRE
N706018 SETAL(61019,_SERR)
RET
_FEHL21: STOPRE
N707621 SETAL(61019,"(_GMODE: dec3/_ZSD[8])")
RET
_FEHL24: STOPRE
N706024 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL29: STOPRE
N706029 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N706030 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N706031 SETAL(61216)
RET
_FEHL32:STOPRE
N706032 SETAL(61021,"(_TEXT)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE61_SPF
PROC CYCLE61(REAL __RTP,REAL _RFP,REAL __SDIS,REAL __DP,REAL _PA,REAL _PO,REAL __LENG,REAL __WID,REAL __MID,REAL __MIDA,REAL __FALD,REAL _FFP1,INT _VARI,INT _LIM,INT _DMODE,INT _AMODE,INT _GMODE,REAL _STA,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Extended face milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_HX,_HY,_HZ,_IX,_IZ,_PMX,_PMY,_PMYY,_MODI,_M_ROT,_M_MIRROR_X,_M_MIRROR_Y,_ROT_Z,_WTYP
DEF INT _LIM1,_LIM2,_LIM3,_LIM4,_LIM_NUM,_TYP,_H_INT,_PMX_KA,_PMY_KA,_DMODE1,_AMODE1,_AMODE2,_AMODE4,_AMODE5,_GMODE3,_ZZSD[2]
DEF INT _II,_ARTIS[16],_ERR=0
DEF REAL _DP,_FALD,_LENG,_WID,_MID,_MIDA,_RTP,_SDIS
DEF REAL _APX,_APY,_AY1,_AY2,_AX,_DPA,_DPR,_DPZ,_EX,_EY,_FAK1,_FDP,_FDP1,_HEX,_HEY,_HEZ,_H_RE,_LX,_LY1,_MAX,_W_FREI
DEF REAL _LY2,_LY,_PMZ,_SDZ,_SKX,_SKY,_SKZ,_WZR,_WZX,_WZY,_XS,_YS,_VER_X,_VER_Y,_MIDA_Y,_WZRIN,_WZXIN,_WZYIN,_WZZIN,_WANG
DEF STRING[30] _S_FFP1
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE61_MPF",_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE61_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1])
WRITE(_TEMP,_TEMP_FILE,"CYCLE61("<<__RTP<<","<<_RFP<<","<<__SDIS<<","<<__DP<<","<<_PA<<","<<_PO<<","<<__LENG<<","<<__WID<<","<<__MID<<","<<__MIDA<<","<<__FALD<<","<<_FFP1<<","<<_VARI<<","<<_LIM<<","<<_DMODE<<","<<_AMODE<<","<<_GMODE<<","<<_STA<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
_DP=__DP _FALD=__FALD _LENG=__LENG _MID=__MID _MIDA=__MIDA _RTP=__RTP _SDIS=__SDIS _WID=__WID
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_MODI=0 _M_ROT=0 _M_MIRROR_X=0 _M_MIRROR_Y=0 _ROT_Z=0 _VER_X=0 _VER_Y=0
_SDIS=ABS(_SDIS) _FALD=ABS(_FALD) _VARI=ABS(_VARI)
_FDP=_SDIS
_FDP1=_SDIS
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3) GOTOF _FEHL6
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
_SKZ=$P_ACTFRAME[_ZZ,SC]
_SDIS=_SDIS/_SKZ _MID=_MID/_SKZ _FALD=_FALD/_SKZ
_LIM1=_LIM MOD 10 _LIM2=TRUNC(_LIM/10) MOD 10
_LIM3=TRUNC(_LIM/100) MOD 10 _LIM4=TRUNC(_LIM/1000) MOD 10
IF(_LIM1<0)OR(_LIM1>1)OR(_LIM2<0)OR(_LIM2>1)OR(_LIM3<0)OR(_LIM3>1)OR(_LIM4<0)OR(_LIM4>1) GOTOF _FEHL2
_LIM_NUM=_LIM1+_LIM2+_LIM3+_LIM4
IF(_LIM_NUM==4) GOTOF _FEHL12
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL22
ENDIF
IF(_ZZSD[1]==0)
_SDZ=_SDIS
ELSE
_SDZ=0
ENDIF
IF(_AMODE<0)
_SERR=<<"(_AMODE)"
GOTOF _FEHL23
ENDIF
_AMODE1=_AMODE _DEC1
IF(_AMODE1>1)
_SERR=<<"(_AMODE: dec1)"
GOTOF _FEHL21
ENDIF
IF(_AMODE1==1)
IF(_RTP==_RFP) GOTOF _FEHL3
IF(_RTP>_RFP)
_DP=_RFP-ABS(_DP)
ELSE
_DP=_RFP+ABS(_DP)
ENDIF
ENDIF
_AMODE4=_AMODE _DEC4 _AMODE5=_AMODE _DEC5
IF(_AMODE4>1)
_SERR=<<"(_AMODE: dec4)"
GOTOF _FEHL21
ENDIF
IF(_STA==0)
IF(_AMODE4==1)
_LENG=_LENG-_PA
ENDIF
IF(_AMODE5==1)
_WID=_WID-_PO
ENDIF
ELSE
IF(_AMODE4==1)
IF(_AMODE5==1)
_LENG=(__LENG-_PA)*COS(_STA)+(__WID-_PO)*SIN(_STA)
_WID=(__WID-_PO)*COS(_STA)-(__LENG-_PA)*SIN(_STA)
ELSE
IF(COS(_STA)==0) GOTOF _FEHL29
_LENG=(__LENG-_PA+__WID*SIN(_STA))/COS(_STA)
ENDIF
ELSE
IF(_AMODE5==1)
IF(COS(_STA)==0) GOTOF _FEHL29
_WID=(__WID-_PO-__LENG*SIN(_STA))/COS(_STA)
ENDIF
ENDIF
ENDIF
_GMODE3=_GMODE _DEC3
IF(_GMODE3<0)OR(_GMODE3>2)
_SERR=<<"(_GMODE: dec3)"
GOTOF _FEHL28
ENDIF
_RE_CYCFR=$P_CYCFRAME
IF $P_SDIR[$P_MSNUM]==5
SETAL(61102)
RET
ENDIF
IF($P_TOOLNO==0) GOTOF _FEHL0
IF($P_TOOL==0) GOTOF _FEHL1
IF($P_TOOLR<=0) GOTOF _FEHL4
_BA1=_VARI MOD 10 _BA10=TRUNC(_VARI/10)
IF(_BA1<1) OR (_BA1>2) GOTOF _FEHL2
IF(_BA10<1) OR (_BA10>4) GOTOF _FEHL2
IF(_LENG==0) OR (_WID==0) GOTOF _FEHL5
IF(_FFP1<=0) GOTOF _FEHL8
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL26
ENDIF
_S_FFP1="G95 FZ="<<_FFP1
ELSE
_S_FFP1="G94 F"<<_FFP1
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
IF(_SC_TOOL_VALI[0]<>0)
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF(_ARTIS[0] MOD 10 <>1)
GOTOF _FEHL25
ENDIF
_II=_ARTIS[0] DIV 10
IF((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL25
ELSE
_ARTIS[11]=_II MOD 10
IF(_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF(_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL25
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
IF(((_VARI MOD 10 )- 1)<>_ARTIS[12]) AND (_ARTIS[11]<>1)
_ARTIS[0]=0 _ARTIS[11]=0
ENDIF
ENDIF
IF(_BA10==1)OR(_BA10==3)
IF((_LIM1+_LIM2)==1)AND((_LIM3+_LIM4)==0) GOTOF _FEHL15
IF((_LIM1+_LIM2)==2) GOTOF _FEHL13
ENDIF
IF(_BA10==2)OR(_BA10==4)
IF((_LIM3+_LIM4)==1)AND((_LIM1+_LIM2)==0) GOTOF _FEHL15
IF((_LIM3+_LIM4)==2) GOTOF _FEHL13
ENDIF
_DPR=ABS(_RFP-_DP)
_PMZ=_RTP-_RFP
IF(_RFP==_DP) GOTOF _RET
IF(_RTP<>_RFP)
IF(_PMZ/ABS(_PMZ) <> (_RFP-_DP)/_DPR) GOTOF _FEHL3
ENDIF
_PMZ=(_RFP-_DP)/_DPR
IF(_RFP==_RTP)
_RTP=_RFP+_SDIS*_PMZ
ENDIF
IF(_LIM_NUM==0)
_MODI=0
ENDIF
IF(_LIM_NUM==1)
_MODI=1
ENDIF
IF(_LIM_NUM==2)
IF((_LIM1+_LIM2)<>1)
_MODI=2
ELSE
_MODI=3
ENDIF
ENDIF
IF(_LIM_NUM==3)
_MODI=4
ENDIF
IF(_LENG>0)
_PMX=1
ELSE
_PMX=-1
ENDIF
IF(_WID>0)
_PMY=1
ELSE
_PMY=-1
ENDIF
_LX=ABS(_LENG) _LY=ABS(_WID)
_APX=_PA _APY=_PO
IF(_LIM2==0)AND(_LIM4==1)
_ROT_Z=90
_LX=ABS(_WID) _LY=ABS(_LENG)
_H_INT=_PMX _PMX=_PMY _PMY=-_H_INT
_M_ROT=1
ENDIF
IF(_LIM1==1)AND(_LIM4==0)
_ROT_Z=-180
_PMX=-_PMX _PMY=-_PMY
ENDIF
IF(_LIM1==0)AND(_LIM3==1)AND(_M_ROT==0)
_ROT_Z=-90
_LX=ABS(_WID) _LY=ABS(_LENG)
_H_INT=_PMX _PMX=-_PMY _PMY=_H_INT
_M_ROT=1
ENDIF
IF(_PMX==-1)
IF(_MODI==0)OR(_MODI==2)OR(_MODI==4)
_VER_X=0 _M_MIRROR_X=1
ENDIF
IF(_MODI==1)OR(_MODI==3)
_VER_X=-_LX _M_MIRROR_X=0
ENDIF
ENDIF
IF(_PMY==-1)
IF(_MODI==0)OR(_MODI==1)OR(_MODI==2)
_VER_Y=0 _M_MIRROR_Y=1
ENDIF
IF(_MODI==3)OR(_MODI==4)
_VER_Y=-_LY _M_MIRROR_Y=0
ENDIF
ENDIF
N10 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_APX*1/_FAK1,_YY,_APY*1/_FAK1)
N20 $P_CYCFRAME=$P_CYCFRAME:CRPL(0,_STA+_ROT_Z)
N30 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_VER_X*1/_FAK1,_YY,_VER_Y*1/_FAK1)
IF(_M_MIRROR_X==1)
N40 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_XX)
ENDIF
IF(_M_MIRROR_Y==1)
N50 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
ENDIF
IF((_BA10==1)OR(_BA10==3))XOR(_M_ROT==1)
_XX=$P_AXN2 _YY=$P_AXN1
_H_RE=_LX _LX=_LY _LY=_H_RE
ENDIF
_SKX=$P_ACTFRAME[_XX,SC] _SKY=$P_ACTFRAME[_YY,SC]
IF(_SKX<>_SKY)AND(_STA<>0)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL9
ENDIF
IF(_FALD>=_DPR)
_FALD=_DPR
ENDIF
_DPA=_DPR-_FALD
IF((_MID<=0) AND (_BA1==1))
_SERR=<<"(DZ)"
GOTOF _FEHL23
ENDIF
IF(((_SDZ+_DPA)>_MID) AND (_BA1==1))
_HZ=(_SDZ+_DPA)/_MID+0.4999
ELSE
_HZ=1
ENDIF
_HEZ=(_SDZ+_DPA)/_HZ
IF(_HZ==1)
_HEZ=_DPA
ENDIF
IF(_BA1==2)
_HEZ=_FALD _HZ=1
ENDIF
_TYP=$P_ADT[1]
_WZRIN=$P_TOOLR*_FAK1
IF(_TYP==140)
_WZR=$P_ADT[7]*_FAK1
_WANG=$P_ADT[11]
IF(_WZR>_WZRIN)AND(_WANG>90)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL19
ENDIF
IF ((_WANG<0) OR (_WANG>90))
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL27
ENDIF
IF(_WZR==0)
IF(_MODI==0)
IF(_WANG==0)
_WZR=_WZRIN
GOTOF _END_WZR
ENDIF
IF(_WANG<90)
_WZR=_WZRIN+_HEZ/TAN(_WANG)
ELSE
_WZR=_WZRIN
ENDIF
ELSE
IF(_WANG<90)AND(_WANG>0)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL17
ELSE
_WZR=_WZRIN
ENDIF
ENDIF
ELSE
IF(_WZR<>_WZRIN)AND(_WANG==90)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL20
ENDIF
IF((_WANG<90)AND(_WANG>0)AND(_WZR==_WZRIN))OR(_WZR<_WZRIN)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL16
ENDIF
IF((_WANG>0)AND(_WANG<90))
_WZZIN=(_WZR-_WZRIN)*TAN(_WANG)
IF(_WZZIN<_HEZ)
_SERR=<<"(DZ, und WZ-Eingabedaten)"
GOTOF _FEHL24
ENDIF
ENDIF
ENDIF
_FDP1=_WZR-_WZRIN
ELSE
_WZR=_WZRIN
ENDIF
_END_WZR:
IF(_LIM_NUM>0)
_FDP1=0
ENDIF
_AMODE2=_AMODE _DEC2
IF(_AMODE2<0)OR(_AMODE2>1) GOTOF _FEHL11
IF(_MIDA<=0)
_SERR=<<"(DXY)"
GOTOF _FEHL23
ENDIF
IF(_AMODE2==1)
IF(_MIDA>100)
_SERR=<<"(DXY [%])"
GOTOF _FEHL21
ELSE
_MIDA=_MIDA/100*(2*_WZRIN)
ENDIF
ENDIF
_FDP=_FDP/_SKY _MIDA_Y=_MIDA/_SKY _FDP1=_FDP1/_SKX _MIDA=_MIDA/_SKX
_WZXIN=_WZRIN/_SKX _WZX=_WZR/_SKX
_WZYIN=_WZRIN/_SKY _WZY=_WZR/_SKY
IF(_MODI>0)
IF(_MODI==1)OR(_MODI==2)
_LX=_LX-_MODI*(_WZX-_WZXIN)
ENDIF
IF(_MODI==3)OR(_MODI==4)
_LX=_LX-(_MODI-2)*(_WZX-_WZXIN) _LY=_LY-(_WZY-_WZYIN)
ENDIF
IF(_MODI==2)OR(_MODI==4)
IF(2*_WZXIN>_LX)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL18
ENDIF
ENDIF
ENDIF
IF(_MIDA>2*_WZXIN)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL7
ENDIF
_YS=-(_FDP+_WZY)
_AY1=-(_FDP+_WZY)
IF(_BA10==1)OR(_BA10==2)
_AY2=-(_FDP+_WZY)
ENDIF
IF(_BA1==2)
_EX=-(_FDP+_WZX) _EY=-(_FDP+_WZY)
ELSE
_EX=0 _EY=0
ENDIF
IF(_MODI==0)
IF(_FDP1==0)
_FDP1=_SDIS
ENDIF
IF(_LX<=_MIDA)OR((_LX+_FDP1)<=_MIDA)
_HX=0 _HEX=0
ELSE
_HX=(_LX-_MIDA+_FDP1)/_MIDA+0.4999
_HEX=(_LX-_MIDA+_FDP1)/_HX
ENDIF
IF(_HX==0)
_XS=_LX/2
ELSE
_XS=(_MIDA-_WZX)
ENDIF
ENDIF
IF(_MODI==1)
IF(_LX>_MIDA)
_HX=_LX/_MIDA+0.4999
ELSE
_HX=1
ENDIF
_HEX=_LX/_HX
_XS=(_HEX-_WZXIN)
_HX=_HX-1
ENDIF
IF(_MODI==2)
IF((_LX-2*_WZXIN)>_MIDA)
_HX=(_LX-2*_WZXIN)/_MIDA+0.4999
ELSE
_HX=1
ENDIF
_HEX=(_LX-2*_WZXIN)/_HX
IF(_HEX==0)
_HX=0
ENDIF
_XS=_WZX
ENDIF
IF(_MODI<=2)
IF(_BA1==2)
_LY1=_LY+2*(_FDP+_WZY)
_LY2=_LY+2*(_FDP+_WZY)
ELSE
IF(_BA10==1) OR (_BA10==2)
_LY1=_LY+_FDP+_WZY
ELSE
IF(_MIDA>_WZXIN)
_LY1=_LY+_FDP+_WZY
_LY2=_LY
ELSE
_LY1=_LY+_FDP+_WZY+_WZYIN-_MIDA*_SKX/_SKY
_LY2=_LY+2*(_WZYIN-_MIDA*_SKX/_SKY)
ENDIF
ENDIF
IF(_HX==0)
_LY1=_LY+_FDP+_WZY _LY2=_LY+_FDP+_WZY
ENDIF
ENDIF
ENDIF
IF(_MODI==3)
IF(_LY*_SKY>=_LX*_SKX)
IF(_LX>_MIDA)
_HX=_LX/_MIDA+0.4999
ELSE
_HX=1
ENDIF
_HEX=_LX/_HX
_HEY=_HEX*_SKX/_SKY
_XS=(_HEX-_WZXIN)
_LY1=_LY-_WZYIN-(_HX-1)*_HEY
IF(_LY1<0)
IF(_LX>_WZXIN)
_XS=0
IF((_LX-_WZXIN)>_MIDA)
_HX=(_LX-_WZXIN)/_MIDA+0.4999
ELSE
_HX=1
ENDIF
_HEX=(_LX-_WZXIN)/_HX
_HEY=_HEX*_SKX/_SKY
_LY1=_LY-_WZYIN-_HEY*_HX
_HX=_HX+1
ELSE
_XS=_LX-_WZXIN
_LY1=_LY-_WZYIN
_HX=1
ENDIF
ENDIF
ELSE
IF(_LY>_MIDA)
_HY=_LY/_MIDA+0.4999
ELSE
_HY=1
ENDIF
_HEY=_LY/_HY
_HX=_HY _HEX=_HEY*_SKY/_SKX
_XS=(_LX-_WZXIN-(_HX-1)*_HEX)
_LY1=_HEY-_WZYIN
IF(_XS<0)
IF(_LY>_WZYIN)
IF((_LY-_WZYIN)>_MIDA)
_HY=(_LY-_WZYIN)/_MIDA+0.4999
ELSE
_HY=1
ENDIF
_HEY=(_LY-_WZYIN)/_HY
_HEX=_HEY*_SKY/_SKX
_XS=_LX-_WZXIN-_HY*_HEX
_HX=_HY+1
_LY1=0
ELSE
_XS=_LX-_WZXIN
_LY1=_LY-_WZYIN
_HX=1
ENDIF
ENDIF
ENDIF
ENDIF
IF(_MODI==4)
IF((_LX-2*_WZXIN)>_MIDA)
_HX=((_LX-2*_WZXIN)/_MIDA+1)/2+0.4999
ELSE
_HX=1
ENDIF
IF(_LY>_MIDA_Y)
_HY=_LY/_MIDA_Y+0.4999
ELSE
_HY=1
ENDIF
IF(_HX<=_HY)
_HEX=(_LX/2-_WZXIN)/(_HX-0.5)
_HEY=_HEX*_SKX/_SKY
_XS=-_HEX/2
ELSE
_HEY=_LY/_HY
_HX=_HY
_HEX=_HEY*_SKY/_SKX
_XS=-(_LX/2-_WZXIN-(_HX-1)*_HEX)
ENDIF
_LY1=_LY-_WZYIN-_HEY*(_HX-1)
ENDIF
IF(_MODI==3)OR(_MODI==4)
IF(_HX>1)
_MAX=(1+1/SQRT(2))/2
IF((_MIDA/(2*_WZXIN))>_MAX)
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
GOTOF _FEHL14
ENDIF
ENDIF
ENDIF
IF(_MODI==4)
N60 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,(_LX/2+(_WZX-_WZXIN))*1/_FAK1)
ENDIF
;
IF(_GMODE3==2) GOTOF _M_ST_POS
N100 SBLON
IF($P_EP[_ZZ]*_FAK1<_RTP)
N110 G0 G40 G90 AX[_ZZ]=_RTP
ENDIF
N120 G0 G40 G90 AX[_XX]=_XS AX[_YY]=_YS
N130 AX[_ZZ]=_RFP+_SDIS*_PMZ
N140 SBLOF
IF(_MODI>=3)AND(_BA1==2)
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
ENDIF
FOR _IZ=1 TO _HZ
IF(_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF(_ARTIS[6]<>0)
IF(_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF(_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF (_BA1==1)AND(_HZ>1)
IF(_IZ==1)
ENDIF
IF(_IZ==_HZ)
ENDIF
ENDIF
_AX=_XS
_DPZ=_DP+(_DPR+_SDZ-_IZ*_HEZ)*_PMZ
IF(_HZ==1)
_DPZ=_DP+_FALD*_PMZ
ENDIF
IF(_BA1==2)
_DPZ=_DP
ENDIF
N150 SBLON
N160 G0 G90 AX[_XX]=_AX AX[_YY]=_AY1
IF(_BA10==1)OR(_BA10==2)
CASE _MODI OF 0 GOTOF _MB10 1 GOTOF _MB10 2 GOTOF _MB10 3 GOTOF _MB11 4 GOTOF _MB12
_MB10:
FOR _IX=1 TO _HX+1
N200 G90 AX[_ZZ]=_DPZ
N210 SBLOF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N220 G1 G91 AX[_YY]=_LY1
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<=_HX)
IF((_VARI==12)OR(_VARI==22))AND(_FALD==0)
N230 G0 G90 AX[_ZZ]=_RFP+_SDIS*_PMZ
ELSE
N240 G0 G91 AX[_ZZ]=(_HEZ+_SDIS)*_PMZ
ENDIF
_AX=_XS+_HEX*_IX
N250 G0 G90 AX[_XX]=_AX AX[_YY]=_AY2
ENDIF
ENDFOR
GOTOF _MABH
_MB11:
_LY2=_LY1
FOR _IX=1 TO _HX
N300 G90 AX[_ZZ]=_DPZ
N310 SBLOF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N320 G1 G90 AX[_YY]=_LY2
IF((_BA1==1)AND(_AX>0))OR(_BA1==2)
N330 G1 G90 AX[_XX]=_EX
ENDIF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<_HX)
IF((_VARI==12)OR(_VARI==22))AND(_FALD==0)
N340 G0 G90 AX[_ZZ]=_RFP+_SDIS*_PMZ
ELSE
N350 G0 G91 AX[_ZZ]=(_HEZ+_SDIS)*_PMZ
ENDIF
_LY2=_LY2+_HEY
_AX =_AX+_HEX
N360 G90 AX[_XX]=_AX AX[_YY]=_AY2
ENDIF
ENDFOR
GOTOF _MABH
_MB12:
_LY2=_LY1
FOR _IX=1 TO _HX
N400 G90 AX[_ZZ]=_DPZ
N410 SBLOF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N420 G1 G90 AX[_YY]=_LY2
N430 AX[_XX]=-_AX
IF((_BA1==1)AND(_LY2>0))OR(_BA1==2)
N440 G90 AX[_YY]=_EY
ENDIF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<_HX)
G00
IF(_BA1==1)
N460 G91 AX[_ZZ]=(_HEZ+_SDIS)*_PMZ
ENDIF
_LY2=_LY2+_HEY
IF(_XS<0)
_AX =_AX-_HEX
ELSE
_AX =_AX+_HEX
ENDIF
N470 G90 AX[_XX]=_AX AX[_YY]=_AY2
ENDIF
ENDFOR
GOTOF _MABH
ELSE
CASE _MODI OF 0 GOTOF _MB20 1 GOTOF _MB20 2 GOTOF _MB20 3 GOTOF _MB21 4 GOTOF _MB22
_MB20:
N500 G90 AX[_ZZ]=_DPZ
_PMYY=1
_H_RE=_LY1
N510 SBLOF
FOR _IX=1 TO _HX+1
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N520 G1 G91 AX[_YY]=_LY1*_PMYY
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<=_HX)
_AX=_XS+_HEX*_IX
IF(_BA1==2)
G00
ENDIF
N530 G90 AX[_XX]=_AX
_LY1=_LY2
_PMYY=-_PMYY
ENDIF
ENDFOR
_LY1=_H_RE
GOTOF _MABH
_MB21:
N600 G90 AX[_ZZ]=_DPZ
N610 SBLOF
_LY2=_LY1
FOR _IX=1 TO _HX
IF((_IX MOD 2)==1)
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N620 G1 G90 AX[_YY]=_LY2
IF((_BA1==1)AND(_AX>0))OR(_BA1==2)
N630 G1 G90 AX[_XX]=_EX
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<_HX)
IF(_BA1==2)
G00
ENDIF
ENDIF
ENDIF
IF(_IX<_HX)
_LY2=_LY2+_HEY
N640 G90 AX[_YY]=_LY2
ENDIF
ENDIF
IF((_IX MOD 2)==0)
_AX=_AX+_HEX
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N650 G1 G90 AX[_XX]=_AX
IF((_BA1==1)AND(_LY2>0))OR(_BA1==2)
N660 G90 AX[_YY]=_EY
IF(_IX<_HX)
IF(_BA1==2)
G00
ENDIF
ENDIF
ENDIF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<_HX)
_AX=_AX+_HEX
N670 G90 AX[_XX]=_AX
_LY2=_LY2+_HEY
ENDIF
ENDIF
ENDFOR
GOTOF _MABH
_MB22:
_PMYY=1
N700 G90 AX[_ZZ]=_DPZ
N710 SBLOF
_LY2=_LY1
FOR _IX=1 TO _HX
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N720 G1 G90 AX[_YY]=_LY2
N730 AX[_XX]=-_AX*_PMYY
IF((_BA1==1)AND(_LY2>0))OR(_BA1==2)
N740 G90 AX[_YY]=_EY
ENDIF
IF(_ARTIS[11]==3)
IF(_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IX<_HX)
_LY2=_LY2+_HEY
IF(_XS<0)
_AX =_AX-_HEX
ELSE
_AX =_AX+_HEX
ENDIF
IF(_BA1==2)
G00
ENDIF
N750 G90 AX[_XX]=-_AX*_PMYY
_PMYY=-_PMYY
ENDIF
ENDFOR
_MABH:
REPEAT _SDIS_FREIFAHREN_A _SDIS_FREIFAHREN_E
IF(_IZ<_HZ)
N800 G0 G91 AX[_ZZ]=_SDIS*_PMZ
N810 SBLON
N820 G90 AX[_XX]=_XS AX[_YY]=_AY1
N830 SBLOF
ENDIF
ENDIF
ENDFOR
_MRTP:
N900 SBLON
N910 G0 G90 AX[_ZZ]=_RTP
N920 SBLOF
IF(_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
IF(_LIM_NUM==3)
N930 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-(_LX/2+(_WZX-_WZXIN))*1/_FAK1)
ENDIF
REPEAT _TRANS_LOESCHEN_A _TRANS_LOESCHEN_E
_RET:
SBLON
$P_CYCFRAME=_RE_CYCFR
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_XX]=_XS
$AA_MEAS_POINT1[_YY]=_YS
$AA_MEAS_POINT1[_ZZ]=_RFP+_SDIS*_PMZ
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_XX])+POT($AA_MEAS_POINT2[_YY])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_XX,_XS,_YY,_YS,_ZZ,_RFP+_SDIS*_PMZ)
IF((_BA10==1)OR(_BA10==3))XOR(_M_ROT==1)
_SC_POS[0]=$P_CYCFRAME[_YY,TR]
_SC_POS[1]=$P_CYCFRAME[_XX,TR]
ELSE
_SC_POS[0]=$P_CYCFRAME[_XX,TR]
_SC_POS[1]=$P_CYCFRAME[_YY,TR]
ENDIF
_SC_POS[2]=$P_CYCFRAME[_ZZ,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_TRANS_LOESCHEN_A:
IF((_BA10==1)OR(_BA10==3))XOR(_M_ROT==1)
_XX=$P_AXN1 _YY=$P_AXN2
ENDIF
IF(_M_MIRROR_X==1)
N940 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_XX)
ENDIF
IF(_M_MIRROR_Y==1)
N950 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
ENDIF
N960 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-_VER_X*1/_FAK1,_YY,-_VER_Y*1/_FAK1)
N970 $P_CYCFRAME=$P_CYCFRAME:CRPL(0,-(_STA+_ROT_Z))
N980 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-_APX*1/_FAK1,_YY,-_APY*1/_FAK1)
_TRANS_LOESCHEN_E:
_SDIS_FREIFAHREN_A:
_PMX_KA=0 _PMY_KA=0 _W_FREI=_SDIS
IF(_MODI>0)
IF(_MODI==3)
IF(_BA10==1)OR(_BA10==2)
_PMY_KA=-1
ELSE
IF((_HX MOD 2)==1)
_PMY_KA=-1
ELSE
_PMX_KA=-1
ENDIF
ENDIF
ELSE
_PMX_KA=-1
IF(_MODI==4)
IF(_BA10==3)OR(_BA10==4)
_PMX_KA=-_PMYY
ELSE
IF(_XS>0)
_PMX_KA=1
ENDIF
ENDIF
ENDIF
IF((_LX-2*_WZXIN)<=_SDIS)AND((_MODI MOD 2)==0)
_W_FREI=(_LX-2*_WZXIN)/2
ENDIF
ENDIF
N910 G1 G91 AX[_XX]=_PMX_KA*_W_FREI AX[_YY]=_PMY_KA*_W_FREI
ENDIF
_SDIS_FREIFAHREN_E:
_FEHL0: STOPRE
N706100 SETAL(61009)
RET
_FEHL1: STOPRE
N706101 SETAL(61000)
RET
_FEHL2: STOPRE
N706102 SETAL(61002)
RET
_FEHL3: STOPRE
N706103 SETAL(61101)
RET
_FEHL4: STOPRE
N706104 SETAL(61117)
RET
_FEHL5: STOPRE
N706105 SETAL(61118)
RET
_FEHL6: STOPRE
N706106 SETAL(61158)
RET
_FEHL7: STOPRE
N706107 SETAL(61111)
RET
_FEHL8: STOPRE
N706108 SETAL(61003)
RET
_FEHL9: STOPRE
N706109 SETAL(61012)
RET
_FEHL10: STOPRE
N706110 SETAL(61124)
RET
_FEHL11: STOPRE
N706111 SETAL(61155)
RET
_FEHL12: STOPRE
N706112 SETAL(61265)
RET
_FEHL13: STOPRE
N706113 SETAL(61266)
RET
_FEHL14: STOPRE
N706114 SETAL(61267)
RET
_FEHL15: STOPRE
N706115 SETAL(61268)
RET
_FEHL16: STOPRE
N706116 SETAL(61269)
RET
_FEHL17: STOPRE
N706117 SETAL(61276)
RET
_FEHL18: STOPRE
N706118 SETAL(61277)
RET
_FEHL19: STOPRE
N706119 SETAL(61278)
RET
_FEHL20: STOPRE
N706120 SETAL(61279)
RET
_FEHL21: STOPRE
N706121 SETAL(61021,_SERR)
RET
_FEHL22: STOPRE
N706122 SETAL(61156)
RET
_FEHL23: STOPRE
N706123 SETAL(61022,_SERR)
RET
_FEHL24: STOPRE
N706124 SETAL(61024,_SERR)
RET
_FEHL25: STOPRE
N706125 SETAL(62106)
RET
_FEHL26: STOPRE
N706126 SETAL(61216)
RET
_FEHL27: STOPRE
N706126 SETAL(61274)
RET
_FEHL28: STOPRE
N706128 SETAL(61019,_SERR)
RET
_FEHL29: STOPRE
N706129 SETAL(61100)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE62_SPF
PROC CYCLE62(STRING[140] _KNAME,INT _TYPE,STRING[31] _LAB1,STRING[31] _LAB2,REAL S_C3D) SAVE DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.20.00.00.008 ;DATE: 2022-03-09
;Cycle support HMIsl
;Contour definitions for Roughing and Pockets
DEF BOOL _EES,S_GRIND=0,S_CONT_DA=0
DEF INT _MAX_ANZAHL_CONT=31,_II
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE62_MPF",_PROG
DEF STRING[160] _PFADAUFRUF,_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE62_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<"    Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,"CYCLE62("<<"'"'"<<_KNAME<<"'"'"<<","<<_TYPE<<","<<"'"'"<<_LAB1<<"'"'"<<","<<"'"'"<<_LAB2<<"'"'"<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF ($P_EXTBUF[$P_STACK-1]=="")
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
ELSE
_PROG=SUBSTR($P_EXTBUF[$P_STACK-1],3,STRLEN($P_EXTBUF[$P_STACK-1])-7)
ENDIF
IF(_PROG=="CYCLE950")OR(_PROG=="E_CON")OR(_PROG=="F_CON")
IF ($P_IS_EES_PATH[$P_STACK-2])
_EES=1
ENDIF
IF ($P_EXTPATH[$P_STACK-2]=="")
_PFADAUFRUF=$P_PATH[$P_STACK-2]
ELSE
_PFADAUFRUF=$P_EXTPATH[$P_STACK-2]
ENDIF
ELSE
IF ($P_IS_EES_PATH[$P_STACK-1])
_EES=1
ENDIF
IF ($P_EXTPATH[$P_STACK-1]=="")
_PFADAUFRUF=$P_PATH[$P_STACK-1]
ELSE
_PFADAUFRUF=$P_EXTPATH[$P_STACK-1]
ENDIF
ENDIF
IF (_SC_FIRST_CONT==0)
_SC_FIRST_CONT=1 _SC_LAST_CONT=1
_SC_CONT_NAME[0]=REP("") _SC_CONT_LAB1[0]=REP("") _SC_CONT_LAB2[0]=REP("")
_SC_TMI_STAT[0]=REP(0)
ELSE
IF (_SC_LAST_CONT<_SC_FIRST_CONT)
_SC_LAST_CONT=_SC_FIRST_CONT
ELSE
_SC_LAST_CONT=_SC_LAST_CONT+1 _II=_SC_LAST_CONT-1
ENDIF
ENDIF
IF (_SC_LAST_CONT>_MAX_ANZAHL_CONT)
_SC_FIRST_CONT=0 _SC_LAST_CONT=0
GOTOF _FEHL1
ENDIF
CASE _TYPE OF 0 GOTOF _MA1_UP 1 GOTOF _MA2_KNAME 2 GOTOF _MA3_LABS 3 GOTOF _MA4_UP_AND_LABS
GOTOF _FEHL2
_MA1_UP:
IF (($P_SUBPAR[1]==0) OR (_KNAME==""))
GOTOF _FEHL3
ENDIF
_SC_CONT_NAME[_II]=_KNAME
_SC_CONT_LAB1[_II]=""
_SC_CONT_LAB2[_II]=""
GOTOF _FINE
_MA2_KNAME:
IF (STRLEN(_KNAME)>23)
_SERR=<<"CON: "<<_KNAME
GOTOF _FEHL7
ENDIF
IF ( ($P_SUBPAR[1]==0)OR(_KNAME=="")OR((MATCH(_KNAME,":"))<>-1) )
GOTOF _FEHL3
ENDIF
REPEAT _PFAD_A _PFAD_E
_SC_CONT_LAB1[_II]="E_LAB_A_"<<_KNAME
_SC_CONT_LAB2[_II]="E_LAB_E_"<<_KNAME
GOTOF _FINE
_MA3_LABS:
IF (STRLEN(_LAB1)>31)
_SERR=<<"LAB1: "<<_LAB1
GOTOF _FEHL8
ENDIF
IF (STRLEN(_LAB2)>31)
_SERR=<<"LAB2: "<<_LAB2
GOTOF _FEHL8
ENDIF
IF ( ($P_SUBPAR[3]==0)OR(_LAB1=="")OR((MATCH(_LAB1,":"))<>-1) )
GOTOF _FEHL4
ENDIF
IF ( ($P_SUBPAR[4]==0)OR(_LAB2=="")OR((MATCH(_LAB2,":"))<>-1) )
GOTOF _FEHL5
ENDIF
REPEAT _PFAD_A _PFAD_E
_SC_CONT_LAB1[_II]=_LAB1
_SC_CONT_LAB2[_II]=_LAB2
GOTOF _FINE
_MA4_UP_AND_LABS:
IF (($P_SUBPAR[1]==0) OR (_KNAME==""))
GOTOF _FEHL3
ENDIF
IF (STRLEN(_LAB1)>31)
_SERR=<<"LAB1: "<<_LAB1
GOTOF _FEHL8
ENDIF
IF (STRLEN(_LAB2)>31)
_SERR=<<"LAB2: "<<_LAB2
GOTOF _FEHL8
ENDIF
IF ( ($P_SUBPAR[3]==0)OR(_LAB1=="")OR((MATCH(_LAB1,":"))<>-1) )
GOTOF _FEHL4
ENDIF
IF ( ($P_SUBPAR[4]==0)OR(_LAB2=="")OR((MATCH(_LAB2,":"))<>-1) )
GOTOF _FEHL5
ENDIF
_SC_CONT_NAME[_II]=_KNAME
_SC_CONT_LAB1[_II]=_LAB1
_SC_CONT_LAB2[_II]=_LAB2
_FINE:
IF ( (_TYPE==0)OR(_TYPE==3) )
IF (SUBSTR(_SC_CONT_NAME[_II],0,4)=="/_N_")
IF ( NOT ISFILE(_SC_CONT_NAME[_II]) )
GOTOF _FEHL6
ENDIF
ELSE
IF (SUBSTR(_PFADAUFRUF,0,12)=="/_N_SYF_DIR/") GOTOF _FEHL9
IF (($MCS_TECHNOLOGY==3)OR($MCS_TECHNOLOGY==4))
S_GRIND=1
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_SPF_DIR/" )
IF NOT(ISFILE(_SC_CONT_NAME[_II]<<"_SPF"))
IF NOT(ISFILE(_SC_CONT_NAME[_II]<<"_MPF"))
IF (S_GRIND)
REPEAT _DRS_A _DRS_E
IF (S_CONT_DA)
GOTOF _CONT_DA
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_MPF_DIR/" )
IF NOT((ISFILE(_SC_CONT_NAME[_II]<<"_SPF"))OR(ISFILE(_SC_CONT_NAME[_II]<<"_MPF")))
IF NOT(ISFILE("/_N_SPF_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_SPF"))
IF (S_GRIND)
REPEAT _DRS_A _DRS_E
IF (S_CONT_DA)
GOTOF _CONT_DA
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_WKS_DIR/" )
IF NOT((ISFILE(_SC_CONT_NAME[_II]<<"_SPF"))OR(ISFILE(_SC_CONT_NAME[_II]<<"_MPF")))
IF NOT(ISFILE("/_N_SPF_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_SPF"))
IF (S_GRIND)
REPEAT _DRS_A _DRS_E
IF (S_CONT_DA)
GOTOF _CONT_DA
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ENDIF
ENDIF
IF (SUBSTR(_PFADAUFRUF,0,12)=="/_N_EXT_DIR/")
IF NOT((ISFILE(_PFADAUFRUF<<_SC_CONT_NAME[_II]<<"_SPF"))OR(ISFILE(_PFADAUFRUF<<_SC_CONT_NAME[_II]<<"_MPF")))
IF (S_GRIND)
REPEAT _DRS_A _DRS_E
IF (S_CONT_DA)
GOTOF _CONT_DA
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ENDIF
IF ( (SUBSTR(_PFADAUFRUF,0,2)=="//")AND(_EES) )
IF ( (NOT((ISFILE(_PFADAUFRUF<<_SC_CONT_NAME[_II]<<".SPF"))))AND(NOT((ISFILE(_PFADAUFRUF<<_SC_CONT_NAME[_II]<<".MPF")))) )
IF (S_GRIND)
REPEAT _DRS_A _DRS_E
IF (S_CONT_DA)
GOTOF _CONT_DA
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _FEHL6
ENDIF
ELSE
GOTOF _CONT_DA
ENDIF
ENDIF
IF ( (S_GRIND)AND(SUBSTR(_PFADAUFRUF,0,12)=="/_N_DRS_DIR/") )
IF (ISFILE("/_N_SPF_DIR/"<<_SC_CONT_NAME[_II]<<"_SPF"))
_SC_CONT_NAME[_II]=<<"/_N_SPF_DIR/"<<_SC_CONT_NAME[_II]<<"_SPF"
ELSE
IF (ISFILE("/_N_MPF_DIR/"<<_SC_CONT_NAME[_II]<<"_MPF"))
_SC_CONT_NAME[_II]=<<"/_N_MPF_DIR/"<<_SC_CONT_NAME[_II]<<"_MPF"
ELSE
IF (ISFILE(_PFADAUFRUF<<_SC_CONT_NAME[_II]<<"_DRS"))
_SC_CONT_NAME[_II]=<<_PFADAUFRUF<<_SC_CONT_NAME[_II]<<"_DRS"
ELSE
GOTOF _FEHL6
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_CONT_DA:
RET
_PFAD_A:
IF(_PROG=="CYCLE950")OR(_PROG=="E_CON")OR(_PROG=="F_CON")
IF ($P_EXTBUF[$P_STACK-3]=="")
_SC_CONT_NAME[_II]=_PFADAUFRUF<<$P_PROG[$P_STACK-3]
ELSE
_SC_CONT_NAME[_II]=_PFADAUFRUF<<$P_EXTBUF[$P_STACK-3]
ENDIF
ELSE
IF ($P_EXTBUF[$P_STACK-2]=="")
_SC_CONT_NAME[_II]=_PFADAUFRUF<<$P_PROG[$P_STACK-2]
ELSE
_SC_CONT_NAME[_II]=_PFADAUFRUF<<$P_EXTBUF[$P_STACK-2]
ENDIF
ENDIF
_PFAD_E:
_DRS_A:
IF (ISFILE("/_N_DRS_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_SPF"))
S_CONT_DA=1
_SC_CONT_NAME[_II]="/_N_DRS_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_SPF"
ELSE
IF (ISFILE("/_N_DRS_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_MPF"))
S_CONT_DA=1
_SC_CONT_NAME[_II]="/_N_DRS_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_MPF"
ELSE
IF (ISFILE("/_N_DRS_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_DRS"))
S_CONT_DA=1
_SC_CONT_NAME[_II]="/_N_DRS_DIR/_N_"<<_SC_CONT_NAME[_II]<<"_DRS"
ENDIF
ENDIF
ENDIF
_DRS_E:
_FEHL1:STOPRE
N706201 SETAL(61914)
RET
_FEHL2:STOPRE
N706202 SETAL(61024,"_TYPE")
RET
_FEHL3:STOPRE
N706203 SETAL(61024,"CON")
RET
_FEHL4:STOPRE
N706204 SETAL(61024,"LAB1")
RET
_FEHL5:STOPRE
N706205 SETAL(61024,"LAB2")
RET
_FEHL6:STOPRE
N706206 SETAL(61027,_SC_CONT_NAME[_II])
RET
_FEHL7:STOPRE
N706207 SETAL(61028,_SERR)
RET
_FEHL8:STOPRE
N706208 SETAL(61047,_SERR)
RET
_FEHL9:STOPRE
N706209 SETAL(61071)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE63_SPF
PROC CYCLE63(STRING[100] _PRG,INT _VARI,REAL _RP,REAL _Z0,REAL _SC,REAL _Z1,REAL _F,REAL _FZ,REAL _DXY,REAL _DZ,REAL _UXY,REAL _UZ,INT _CDIR,REAL _XS,REAL _YS,REAL _ER,REAL _EP,REAL _EW,REAL _FS,REAL _ZFS,STRING[32] _TR,INT _DR,INT _UMODE,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;dismantle cycle
DEF BOOL _FIRSTCALL=1,_M_CHAN=0,_HOST=0,_EES=0
DEF INT _H_GMODE[3],_H_DMODE[6],_H_AMODE[4],_H_VARI[5],_H_MSNUM,_GG15,_GG06,_M3_M4,_G2_G3,_MIRR,_ANUM,_H_TMI_STA[2],_F_TYPE,_WTYP,_PMZ
DEF INT _WZT,_I,_III,_T,_FILEA=0,_FILEB=0,_INCOAP_I_0,_TEMP=0,_ERR,_TRAFO,_CONT_ERR=0,_ANZ_Z1=24,_ANZ_Z2=100,_GEO_D=1,_VER_D=1
DEF INT _CI=0,_BFC=0,_BCIF=1,_BA=2,_BLFR=3,_BR2=4,_BIS=5,_BDIP=6,_BSCOO=7,_BCDP=8,_BCODP=9,_BSPTC=10
DEF INT _IEM=0,_INC=1,_INEIF=2,_IDRM=3,_IDRI=4,_ITT=5,_ISP=6,_IOC=7,_ISC=8,_ISPMOI=9,_ICDA=10,_IOL=11
DEF INT _IMT=12,_IWD=13,_ISL=14,_II=15,_ISAIZ=16
DEF INT _RTCH=0,_RTCA=1,_RTT=2,_RSITM=3,_RPDZ=4,_RSC=5,_RTA=6,_RDSPA=7,_RDSPO=8,_RSFP=9,_RSF3=10,_RZ0=11
DEF INT _RZ1=12,_RID=13,_RMCR=14,_RRR=15,_RPDXY=16,_RFAB=17,_RFABO=18,_RIA=19,_RIG=20,_RIR=21,_RBC=22,_RPR=23,_RSR=24
DEF INT _RTED=25,_RMDR=26,_RSPXM=27,_RSPYM=28,_S16NAX=0,_S16NAY=1,_S16NAZ=2,_S16NAI=3,_S16NAJ=4,_S16NAK=5
DEF INT _S32SFC=0,_S32EFC=1,_S32CC=2,_S32SFI=3,_S32EFI=4,_S160WAE=0,_S160NGNF=1,_S160NFWFC=2,_S160NC=3,_S160CC=4,_S160NDF=5
DEF INT _S160RFP=6,_S160RFW=7,_S160RCON=8,_S160RCOFF=9,_S160RDC=10,_S160RW40=11,_S160RW41=12,_S160RW42=13,_S160NFWFIC=14
DEF REAL _LCIRF,__FZ,_KONTAB[600,6],_FAK,__Z1,_R_RUND,_TANGO=0,_DEEP=0,__ZFS,_SKFE
DEF STRING[255] _ZEILE[21]
DEF STRING[250] _SERR
DEF STRING[160] _DATEINAME1[11],_PFADAUFRUF,_PFAD,_ERR_AND_WARN,_STR[3],_ROU_PRG
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE63_MPF",_TEMP_FILEA="//NC:/_N_MPF_DIR/_N_LOG_CYCLE63A_MPF",_TEMP_FILEB="//NC:/_N_MPF_DIR/_N_LOG_CYCLE63B_MPF"
DEF STRING[35] _PROG,_PROGS
DEF STRING[32] _CS[1]
DEF STRING[4] _PTYP="_MPF",_EES_PTYP=".MPF",_CHANNU=""
DEF STRING[30] _S_F,_S_FZ
DEF AXIS _XX,_YY,_ZZ
CYCLE218(1)
IF (ISVAR("$MN_MACHGEN_DEBUG_MASK"))
_HOST=1
ENDIF
IF ( $ON_NUM_CHANNELS>1 )
_TEMP=0
FOR _I=0 TO 9
IF ( $MN_ASSIGN_CHAN_TO_MODE_GROUP[_I]>0 )
_TEMP=_TEMP+1
ENDIF
ENDFOR
IF (_TEMP>1)
_M_CHAN=1 _TEMP=0 _ANZ_Z1=20 _ANZ_Z2=96
ENDIF
ENDIF
IF ( ($P_INCOAP_SIZE[2]==0)AND(_HOST==0) )
_SERR=<<"Advanced contour cycle"
GOTOF _FEHL66
ENDIF
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE63_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_SC_LAST_CONT="<<_SC_LAST_CONT)
FOR _I=0 TO _SC_LAST_CONT-1
IF(_SC_CONT_NAME[_I]<>"")
WRITE(_TEMP,_TEMP_FILE,"_SC_CONT_NAME["<<_I<<"]="<<"'"'"<<_SC_CONT_NAME[_I]<<"'"'")
ENDIF
IF(_SC_CONT_LAB1[_I]<>"")
WRITE(_TEMP,_TEMP_FILE,"_SC_CONT_LAB1["<<_I<<"]="<<"'"'"<<_SC_CONT_LAB1[_I]<<"'"'")
ENDIF
IF(_SC_CONT_LAB2[_I]<>"")
WRITE(_TEMP,_TEMP_FILE,"_SC_CONT_LAB2["<<_I<<"]="<<"'"'"<<_SC_CONT_LAB2[_I]<<"'"'")
ENDIF
ENDFOR
WRITE(_TEMP,_TEMP_FILE,"CYCLE63("<<"'"'"<<_PRG<<"'"'"<<","<<_VARI<<","<<_RP<<","<<_Z0<<","<<_SC<<","<<_Z1<<","<<_F<<","<<_FZ<<","<<_DXY<<","<<_DZ<<","<<_UXY<<","<<_UZ<<","<<_CDIR<<","<<_XS<<","<<_YS<<","<<_ER<<","<<_EP<<","<<_EW<<","<<_FS<<","<<_ZFS<<","<<"'"'"<<_TR<<"'"'"<<","<<_DR<<","<<_UMODE<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF($P_GG[13]<3)
_FAK=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK=1
ENDIF
_LCIRF=$SCS_MILL_CONT_INITIAL_RAD_FIN*_FAK
_H_VARI[0]=(_VARI _DEC1) _H_VARI[1]=(_VARI _DEC2) _H_VARI[2]=(_VARI _DEC3) _H_VARI[3]=(_VARI _DEC4) _H_VARI[4]=(_VARI _DEC5)
_H_GMODE[2]=(_GMODE _DEC3)
_H_DMODE[0]=(_DMODE _DEC1) _H_DMODE[1]=(_DMODE _DEC2) _H_DMODE[2]=(_DMODE _DEC3) _H_DMODE[3]=(_DMODE _DEC4) _H_DMODE[4]=(_DMODE _DEC5)
_H_DMODE[5]=(_DMODE _DEC6)
_H_AMODE[0]=(_AMODE _DEC1) _H_AMODE[1]=(_AMODE _DEC2) _H_AMODE[2]=(_AMODE _DEC3) _H_AMODE[3]=(_AMODE _DEC4)
_H_TMI_STA[0]=(_SC_TMI_STAT[0] _DEC1) _H_TMI_STA[1]=(_SC_TMI_STAT[0] _DEC2)
IF (_H_DMODE[4]<0)OR(_H_DMODE[4]>1)
_SERR=<<"(_DMODE: dec5)"
GOTOF _FEHL2
ENDIF
IF (_H_DMODE[4]==1)
IF ($P_EXTBUF[$P_STACK-1]=="")
_PROGS=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
ELSE
_PROGS=SUBSTR($P_EXTBUF[$P_STACK-1],3,STRLEN($P_EXTBUF[$P_STACK-1])-7)
ENDIF
IF ( (_PROGS=="E_CP_")OR(_PROGS=="F_CP_") )
_SC=$SCS_EASY_SAFETY_CLEARANCE
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_H_DMODE[0]=($MCS_DISP_PLANE_MILL-16)
_GG06=_H_DMODE[0]
G[6]=_GG06
ELSE
_H_DMODE[0]=0
ENDIF
_H_VARI[3]=0
_H_VARI[4]=0
ENDIF
IF ( (_H_VARI[0]<>1)AND(_H_VARI[0]<>3)AND(_H_VARI[0]<>4)AND(_H_VARI[0]<>5) )
_SERR=<<"(_VARI: dec1)"
GOTOF _FEHL2
ENDIF
IF ( (_H_VARI[1]<0)OR(_H_VARI[1]>2) )
_SERR=<<"(_VARI: dec2)"
GOTOF _FEHL2
ENDIF
IF ( (_H_VARI[3]<0)OR(_H_VARI[3]>1) )
_SERR=<<"(_VARI: dec4)"
GOTOF _FEHL2
ENDIF
IF ( (_H_VARI[4]<0)OR(_H_VARI[4]>1) )
_SERR=<<"(_VARI: dec5)"
GOTOF _FEHL2
ENDIF
IF ( (_H_GMODE[2]<0)OR(_H_GMODE[2]>2) )
_SERR=<<"(_GMODE: dec3)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[0]<0)OR(_H_DMODE[0]>3) )
_SERR=<<"(_DMODE: dec1)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[2]<1)OR(_H_DMODE[2]>2) )
_SERR=<<"(_DMODE: dec3)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[3]<0)OR(_H_DMODE[3]>1) )
_SERR=<<"(_DMODE: dec4)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[5]<0)OR(_H_DMODE[5]>1) )
_SERR=<<"(_DMODE: dec6)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[0]<0)OR(_H_AMODE[0]>1) )
_SERR=<<"(_AMODE: dec1)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[1]<0)OR(_H_AMODE[1]>1) )
_SERR=<<"(_AMODE: dec2)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[2]<0)OR(_H_AMODE[2]>1) )
_SERR=<<"(_AMODE: dec3)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[3]<0)OR(_H_AMODE[3]>1) )
_SERR=<<"(_AMODE: dec4)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[2]==1)AND(_SC_LAST_CONT==0) ) GOTOF _FEHL23
IF ( (_H_DMODE[2]==2)AND(_SC_LAST_CONT==0) ) GOTOF _FEHL22
IF ($P_TOOL>0)
_WZT=$P_ADT[1]
IF (_H_VARI[0]==5)
IF (_H_AMODE[2]==1)
IF (_RP==_Z0) GOTOF _FEHL9
_PMZ=(_RP-_Z0)/ABS(_RP-_Z0)
_Z1=_Z0-ABS(_ZFS)*_PMZ
__ZFS=ABS(_ZFS)
ELSE
IF (_Z0==_ZFS) GOTOF _FEHL60
_Z1=_ZFS
_PMZ=(_Z0-_ZFS)/ABS(_Z0-_ZFS)
__ZFS=ABS(_Z0-_ZFS) _H_AMODE[2]=1
IF (_RP<>_Z0)
IF (_RP-_Z0)/ABS(_RP-_Z0)<>(_Z0-_ZFS)/ABS(_Z0-_ZFS) GOTOF _FEHL9
ENDIF
ENDIF
IF (_FS<=0) GOTOF _FEHL59
IF (__ZFS<=0) GOTOF _FEHL60
IF(_WZT==200)OR(_WZT==220)OR(_WZT==230)
IF(_FS>$P_TOOLR*_FAK) GOTOF _FEHL61
IF(__ZFS>$P_TOOLR*_FAK) GOTOF _FEHL62
_TANGO=$P_ADT[24]/2
REPEAT _FASAN_A _FASAN_E
IF(_TANGO)
_DEEP=$P_TOOLR*_FAK/_TANGO
ENDIF
ENDIF
IF(_WZT==140)
IF($P_ADT[7]>0)
IF(_FS>($P_ADT[7]-$P_TOOLR)*_FAK) GOTOF _FEHL61
ENDIF
IF($P_ADT[11])
_TANGO=90-$P_ADT[11]
ENDIF
REPEAT _FASAN_A _FASAN_E
IF(_TANGO)
_DEEP=($P_ADT[7]-$P_TOOLR)*_FAK/_TANGO
ENDIF
ENDIF
IF(_WZT==155)OR(_WZT==156)
_TANGO=$P_ADT[11]
REPEAT _FASAN_A _FASAN_E
ENDIF
IF(_TANGO)
IF(__ZFS*_TANGO<=_FS) GOTOF _FEHL60
IF(_DEEP)
IF(__ZFS>_DEEP) GOTOF _FEHL62
ENDIF
ENDIF
ELSE
IF ( (_WZT<100)OR(_WZT>199) )
GOTOF _FEHL1
ENDIF
ENDIF
ELSE
GOTOF _FEHL0
ENDIF
IF ( _SC<0 )
_SERR=<<"SC"
GOTOF _FEHL2
ENDIF
IF ( (_CDIR<0)OR(_CDIR>1) )
GOTOF _FEHL53
ENDIF
IF ( (_H_DMODE[2]==1)AND(_H_TMI_STA[0]<>0)AND(_H_TMI_STA[1]<>_CDIR) )
GOTOF _FEHL53
ENDIF
IF ( (_H_DMODE[2]==2)AND(_H_TMI_STA[0]<>0) )
GOTOF _FEHL54
ENDIF
IF ( (_H_VARI[0]==1)AND(_UZ<0) )
_SERR=<<"UZ"
GOTOF _FEHL2
ENDIF
IF ( (_H_VARI[0]==3)AND(_UZ<=0) )
_SERR=<<"UZ"
GOTOF _FEHL2
ENDIF
IF ( ($P_SUBPAR[1]==0)OR(_PRG=="") )
GOTOF _FEHL3
ELSE
_ERR=MINDEX(_PRG,"(,),[,],{,},<,>,:,=,*,+,-,.,,,;,%,&,$,?,!,^,@,#,\, ,|,'H22','H27'")
IF (SUBSTR(TOUPPER(_PRG),0,5)=="//NC:")
_ERR=MINDEX(_PRG,"(,),[,],{,},<,>,=,*,+,-,.,,,;,%,&,$,?,!,^,@,#,\, ,|,'H22','H27'")
ENDIF
IF (_ERR<>(-1))
_SERR=<<"PRG, "<<_PRG[_ERR]
GOTOF _FEHL72
ENDIF
IF (_H_DMODE[5]==1)
_PRG="//NC:/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_PRG<<"_MPF"
ENDIF
IF ( (NOT(SUBSTR(TOUPPER(_PRG),0,4)=="/_N_"))AND(NOT(SUBSTR(TOUPPER(_PRG),0,2)=="//")) )
_ERR=MINDEX(_PRG,"/")
IF (_ERR<>(-1))
_SERR=<<"PRG, "<<_PRG[_ERR]
GOTOF _FEHL72
ENDIF
IF (STRLEN(_PRG)>_ANZ_Z1)
_SERR=<<"PRG: "<<_PRG
GOTOF _FEHL73
ENDIF
IF ( ((STRLEN($P_PROG[0])-7)>0)OR((STRLEN($P_PROG[0])-4)>0) )
IF (SUBSTR($P_PROG[0],0,3)=="_N_")
_STR[0]=SUBSTR($P_PROG[0],3,STRLEN($P_PROG[0])-7)
ELSE
_STR[0]=SUBSTR($P_PROG[0],0,STRLEN($P_PROG[0])-4)
ENDIF
IF (_STR[0]==TOUPPER(_PRG))
GOTOF _FEHL74
ENDIF
ENDIF
ELSE
IF (STRLEN(_PRG)>_ANZ_Z2)
_SERR=<<"PRG: "<<_PRG
GOTOF _FEHL73
ENDIF
_STR[0]=$P_PATH[0]<<$P_PROG[0]
IF (_STR[0]==TOUPPER(_PRG))
GOTOF _FEHL74
ENDIF
ENDIF
ENDIF
IF ( (_H_VARI[0]==1)OR(_H_VARI[0]==3) )
IF ( _DXY<=0 )
_SERR=<<"DXY"
GOTOF _FEHL2
ENDIF
IF ( _UXY<0 )
_SERR=<<"UXY"
GOTOF _FEHL2
ENDIF
IF ( _H_VARI[1]==1 )
IF ( _ER<=0 )
_SERR=<<"ER"
GOTOF _FEHL2
ENDIF
IF ( _EP<=0 )
_SERR=<<"EP"
GOTOF _FEHL2
ENDIF
ENDIF
IF ( _H_VARI[1]==2 )
IF ( _EW<=0 )
_SERR=<<"EW"
GOTOF _FEHL2
ENDIF
ENDIF
ENDIF
IF ( (_H_VARI[0]==1)OR(_H_VARI[0]==4) )
IF ( _DZ<=0 )
_SERR=<<"DZ"
GOTOF _FEHL2
ENDIF
ENDIF
IF ( (_H_VARI[0]==4)AND(_UXY<0) )
_SERR=<<"UXY"
GOTOF _FEHL2
ENDIF
IF ( _F<=0 ) GOTOF _FEHL64
IF ( (_H_DMODE[2]==1)AND((_H_VARI[0]==1)OR(_H_VARI[0]==3))AND(_H_DMODE[3]==0)AND(_H_VARI[1]==0)AND(_FZ<=0) ) GOTOF _FEHL65
IF (_M_CHAN)
IF ($P_CHANNO<10)
_CHANNU="_C0"<<$P_CHANNO
ELSE
_CHANNU="_C"<<$P_CHANNO
ENDIF
ENDIF
IF ($P_EXTBUF[$P_STACK-1]=="")
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7) _PROGS=SUBSTR($P_PROG[$P_STACK-1],3,5)
ELSE
_PROG=SUBSTR($P_EXTBUF[$P_STACK-1],3,STRLEN($P_EXTBUF[$P_STACK-1])-7) _PROGS=SUBSTR($P_EXTBUF[$P_STACK-1],3,5)
ENDIF
IF ( (_PROGS=="E_CP_")OR(_PROGS=="F_CP_")OR(_PROG=="CYCLE73") )
IF ($P_IS_EES_PATH[$P_STACK-2])
_EES=1
ENDIF
IF ($P_EXTPATH[$P_STACK-2]=="")
_PFADAUFRUF=$P_PATH[$P_STACK-2]
ELSE
_PFADAUFRUF=$P_EXTPATH[$P_STACK-2]
ENDIF
IF ( (_PROGS=="E_CP_")OR(_PROGS=="F_CP_") )
IF (SUBSTR(TOUPPER(_PRG),0,4)=="/_N_")
_PRG="//NC:"<<_PRG
ENDIF
ENDIF
ELSE
_H_DMODE[1]=0
IF ($P_IS_EES_PATH[$P_STACK-1])
_EES=1
ENDIF
IF ($P_EXTPATH[$P_STACK-1]=="")
_PFADAUFRUF=$P_PATH[$P_STACK-1]
ELSE
_PFADAUFRUF=$P_EXTPATH[$P_STACK-1]
ENDIF
ENDIF
IF ((SUBSTR(_PFADAUFRUF,0,12)=="/_N_SPF_DIR/")AND(_EES==0))
_PTYP="_SPF"
ENDIF
IF ( (SUBSTR(TOUPPER(_PRG),0,4)=="/_N_")OR(SUBSTR(TOUPPER(_PRG),0,2)=="//") )
_ROU_PRG=(SUBSTR(_PRG,0,STRLEN(_PRG)-4))<<_CHANNU<<(SUBSTR(_PRG,STRLEN(_PRG)-4))
ELSE
IF ( (SUBSTR(_PFADAUFRUF,0,12)=="/_N_SYF_DIR/")OR(SUBSTR(_PFADAUFRUF,0,12)=="/_N_EXT_DIR/") )
_ROU_PRG="//NC:/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_PRG<<_CHANNU<<_PTYP
ELSE
IF (_EES)
_ROU_PRG=_PFADAUFRUF<<_PRG<<_CHANNU<<_EES_PTYP
ELSE
_ROU_PRG=_PFADAUFRUF<<"_N_"<<_PRG<<_CHANNU<<_PTYP
ENDIF
ENDIF
ENDIF
IF (_M_CHAN)
IF (_EES)
IF ( (STRLEN($P_PROG[0])-8)>=0)
_STR[0]=SUBSTR($P_PROG[0],STRLEN($P_PROG[0])-8,4)
_STR[1]=SUBSTR(_STR[0],0,2) _STR[2]=SUBSTR(_STR[0],2)
IF ( (_STR[1]=="_C") AND (ISNUMBER(_STR[2])) )
_SERR=$P_PROG[0]
GOTOF _FEHL71
ENDIF
ENDIF
ELSE
IF ( (STRLEN($P_PROG[0])-8)>=3)
_STR[0]=SUBSTR($P_PROG[0],STRLEN($P_PROG[0])-8,4)
_STR[1]=SUBSTR(_STR[0],0,2) _STR[2]=SUBSTR(_STR[0],2)
IF ( (_STR[1]=="_C") AND (ISNUMBER(_STR[2])) )
_SERR=$P_PROG[0]
GOTOF _FEHL71
ENDIF
ENDIF
ENDIF
ENDIF
IF (_HOST) GOTOF _SYNC
$P_INCOAP_S32[_S32SFC]=_SC_CONT_LAB1[0] $P_INCOAP_S32[_S32EFC]=_SC_CONT_LAB2[0]
FOR _I=1 TO _SC_LAST_CONT-1
$P_INCOAP_S32[_S32SFI+2*(_I-1)]=_SC_CONT_LAB1[_I] $P_INCOAP_S32[_S32EFI+2*(_I-1)]=_SC_CONT_LAB2[_I]
ENDFOR
FOR _I=0 TO _SC_LAST_CONT-1
IF ( (NOT(SUBSTR(TOUPPER(_SC_CONT_NAME[_I]),0,4)=="/_N_"))AND(NOT(SUBSTR(TOUPPER(_SC_CONT_NAME[_I]),0,2)=="//")) )
IF (STRLEN(_SC_CONT_NAME[_I])>24)
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL77
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_SPF_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_MPF_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD="/_N_SPF_DIR/" _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_WKS_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD="/_N_SPF_DIR/" _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_EXT_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_SYF_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( (SUBSTR(_PFADAUFRUF,0,2)=="//")AND(_EES) )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<_SC_CONT_NAME[_I]<<".SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<_SC_CONT_NAME[_I]<<".MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
_PFADFOUND:
IF (_I==0)
$P_INCOAP_S160[_S160NFWFC]=_PFAD<<_DATEINAME1[_I]
ELSE
$P_INCOAP_S160[_S160NFWFIC+(_I-1)]=_PFAD<<_DATEINAME1[_I]
ENDIF
ELSE
IF (STRLEN(_SC_CONT_NAME[_I])>100)
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL77
ENDIF
IF (_I==0)
$P_INCOAP_S160[_S160NFWFC]=_SC_CONT_NAME[_I]
ELSE
$P_INCOAP_S160[_S160NFWFIC+(_I-1)]=_SC_CONT_NAME[_I]
ENDIF
ENDIF
ENDFOR
IF ( (_H_DMODE[2]==1)AND(_H_TMI_STA[0]<>0) )
_H_TMI_STA[0]=0 _SC_TMI_STAT[0]=10*_H_TMI_STA[1]+_H_TMI_STA[0]
ENDIF
IF ( (_H_DMODE[0]>0)AND($P_GG[6]<>_H_DMODE[0]) )
_GG06=(_H_DMODE[0])
G[6]=_GG06
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL5
_MIRR=$P_ACTFRAME[_XX,MI]+$P_ACTFRAME[_YY,MI]+$P_ACTFRAME[_ZZ,MI]
IF (_H_VARI[2]<>0)
IF ( (_UMODE<>0)AND(_UMODE<>20) )
GOTOF _FEHL7
ENDIF
IF (_H_VARI[2]==2)
_TRAFO=$P_TRAFO
IF (_TRAFO B_AND 'H1300')
GOTOF _FEHL7
ENDIF
ENDIF
ENDIF
_H_MSNUM=$P_MSNUM
IF (_H_MSNUM==0) GOTOF _FEHL6
IF ( ($P_SMODE[0]==1) OR ($P_SMODE[0]==3) )
_M3_M4=$P_SDIR[$P_MSNUM]
IF(_M3_M4<3)OR(_M3_M4>4)
GOTOF _FEHL8
ENDIF
ELSE
GOTOF _FEHL8
ENDIF
IF (_PROG=="CYCLE73")
IF ( (_H_AMODE[0]==1)AND(_RP==_Z0) ) GOTOF _FEHL9
ELSE
IF (_RP==_Z0) GOTOF _FEHL9
ENDIF
IF (_H_VARI[0]<>5)
IF(_H_AMODE[0]==1)
__Z1=ABS(_Z1)
IF(_RP==_Z0) GOTOF _FEHL9
IF(__Z1==0) GOTOF _FEHL10
_PMZ=(_RP-_Z0)/ABS(_RP-_Z0)
__Z1=_Z0-(_RP-_Z0)/ABS(_RP-_Z0)*__Z1
_H_AMODE[0]=0
ELSE
IF(_Z1==_Z0) GOTOF _FEHL10
__Z1=_Z1
_PMZ=(_Z0-_Z1)/ABS(_Z0-_Z1)
IF(_RP<>_Z0)
IF (_RP-_Z0)/ABS(_RP-_Z0)<>(_Z0-_Z1)/ABS(_Z0-_Z1) GOTOF _FEHL9
ENDIF
ENDIF
ENDIF
_SC_FIRST_CONT=0
$P_INCOAP_C[_CI]="M"
$P_INCOAP_B[_BCIF]=1
$P_INCOAP_B[_BA]=0
$P_INCOAP_B[_BLFR]=$ON_TECHNO_FUNCTION_MASK B_AND 'B10000000000000000'
$P_INCOAP_B[_BR2]=0
$P_INCOAP_B[_BIS]=_H_VARI[4]
$P_INCOAP_B[_BDIP]=_H_AMODE[1]
$P_INCOAP_B[_BCDP]=1
$P_INCOAP_B[_BCODP]=0
IF ( (_H_VARI[2]==1)OR(_H_VARI[2]==3) )
$P_INCOAP_B[_BSCOO]=1
ELSE
$P_INCOAP_B[_BSCOO]=0
ENDIF
$P_INCOAP_B[_BSPTC]=_H_AMODE[3]
IF _H_DMODE[2]==2
$P_INCOAP_B[_BSPTC]=0
ENDIF
IF (_H_DMODE[2]==1) AND (_H_VARI[1]==1)
$P_INCOAP_B[_BSPTC]=1
ENDIF
IF (_H_DMODE[2]==1) AND (_H_VARI[1]==2)
$P_INCOAP_B[_BSPTC]=0
ENDIF
$P_INCOAP_I[_INC]=_SC_LAST_CONT
$P_INCOAP_I[_INEIF]=0
$P_INCOAP_I[_IDRM]=$MNS_DISP_RES_MM
$P_INCOAP_I[_IDRI]=$MNS_DISP_RES_INCH
$P_INCOAP_I[_ITT]=$P_ADT[1]
$P_INCOAP_I[_ISP]=$P_GG[6]
$P_INCOAP_I[_IOC]=100+_H_DMODE[3]*10+_H_DMODE[2]
CASE (_H_VARI[0]) OF 1 GOTOF _MARK1 3 GOTOF _MARK2 4 GOTOF _MARK3 5 GOTOF _MARK4
_MARK1:
$P_INCOAP_I[_ISC]=1
GOTOF _END
_MARK2:
$P_INCOAP_I[_ISC]=4
GOTOF _END
_MARK3:
$P_INCOAP_I[_ISC]=8
GOTOF _END
_MARK4:
$P_INCOAP_I[_ISC]=16
_END:
$P_INCOAP_I[_ISPMOI]=$P_GG[13]
$P_INCOAP_I[_ICDA]=0
IF (ISFILE(_TEMP_FILEA))
_FILEA=1
ENDIF
IF (ISFILE(_TEMP_FILEB))
_FILEB=2
ENDIF
$P_INCOAP_I[_IOL]=_FILEA+_FILEB
$P_INCOAP_I[_IMT]=0
IF (_H_DMODE[2]==1)
IF (_CDIR==0)
IF (_M3_M4==3)
_G2_G3=3
ELSE
_G2_G3=2
ENDIF
ENDIF
IF (_CDIR==1)
IF (_M3_M4==3)
_G2_G3=2
ELSE
_G2_G3=3
ENDIF
ENDIF
ENDIF
IF (_H_DMODE[2]==2)
IF (_CDIR==0)
IF (_M3_M4==3)
_G2_G3=2
ELSE
_G2_G3=3
ENDIF
ENDIF
IF (_CDIR==1)
IF (_M3_M4==3)
_G2_G3=3
ELSE
_G2_G3=2
ENDIF
ENDIF
ENDIF
IF(_PMZ==-1)
IF(_G2_G3==2)
_G2_G3=_G2_G3+1
ELSE
_G2_G3=_G2_G3-1
ENDIF
ENDIF
IF (_MIRR MOD 2)
IF (_G2_G3==2)
_G2_G3=_G2_G3+1
ELSE
_G2_G3=_G2_G3-1
ENDIF
ENDIF
$P_INCOAP_I[_IWD]=_G2_G3
CASE (_H_VARI[1]) OF 0 GOTOF _MI 1 GOTOF _HE 2 GOTOF _PE
_MI:
_H_VARI[1]=1
GOTOF _E_EINTAUCHEN
_HE:
_H_VARI[1]=3
GOTOF _E_EINTAUCHEN
_PE:
_H_VARI[1]=2
_E_EINTAUCHEN:
$P_INCOAP_I[_II]=_H_VARI[1]
$P_INCOAP_I[_ISAIZ]=_H_AMODE[2]*2+_H_AMODE[0]
$P_INCOAP_I[_ISL]=_H_VARI[3]
$P_INCOAP_R[_RSITM]=$MN_SCALING_VALUE_INCH
$P_INCOAP_R[_RPDZ]=_DZ
$P_INCOAP_R[_RSC]=_SC*_PMZ
IF ( (_WZT==155)OR(_WZT==156)OR(_WZT==140) )
$P_INCOAP_R[_RTA]=$P_ADT[11]
ELSE
IF ( (_WZT==200)OR(_WZT==220)OR(_WZT==230) )
$P_INCOAP_R[_RTA]=$P_ADT[24]
ELSE
$P_INCOAP_R[_RTA]=0
ENDIF
ENDIF
IF ( (_H_VARI[4]==1)AND((_H_VARI[0]==1)OR(_H_VARI[0]==3)) )
$P_INCOAP_R[_RDSPA]=_XS $P_INCOAP_R[_RDSPO]=_YS
ELSE
$P_INCOAP_R[_RDSPA]=0 $P_INCOAP_R[_RDSPO]=0
ENDIF
$P_INCOAP_R[_RSFP]=$P_ACTFRAME[_XX,SC] _SKFE=$P_ACTFRAME[_XX,SC]
$P_INCOAP_R[_RSF3]=$P_ACTFRAME[_ZZ,SC]
$P_INCOAP_R[_RZ0]=_Z0
$P_INCOAP_R[_RZ1]=__Z1
IF (_H_VARI[0]==5)
$P_INCOAP_R[_RID]=__ZFS*_PMZ
ELSE
$P_INCOAP_R[_RID]=0
ENDIF
$P_INCOAP_R[_RMCR]=$P_TOOLR*_FAK
IF ($P_INCOAP_R[_RMCR]<=0) GOTOF _FEHL57
IF (_H_DMODE[3]==1)
_T=GETT(_TR,0)
IF (_T<0)
_SERR=_TR
GOTOF _FEHL70
ENDIF
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H800')
_GEO_D=2
ENDIF
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H1000')
_VER_D=2
ENDIF
$P_INCOAP_R[_RRR]=(($TC_DP6[_T,_DR]/_GEO_D)+($TC_DP15[_T,_DR]/_VER_D))*_FAK
IF ($P_INCOAP_R[_RRR]<=0) GOTOF _FEHL56
IF ($P_INCOAP_R[_RMCR]>=$P_INCOAP_R[_RRR]) GOTOF _FEHL55
ELSE
$P_INCOAP_R[_RRR]=0
ENDIF
$P_INCOAP_R[_RPDXY]=_DXY
IF ( (_H_VARI[0]==1)OR(_H_VARI[0]==3) )
$P_INCOAP_R[_RFAB]=_UZ*_PMZ
ELSE
$P_INCOAP_R[_RFAB]=0
ENDIF
IF ( (_H_VARI[0]>=1)OR(_H_VARI[0]<=4) )
$P_INCOAP_R[_RFABO]=_UXY
ELSE
$P_INCOAP_R[_RFABO]=0
ENDIF
IF (_H_VARI[1]==2)
$P_INCOAP_R[_RIA]=_EW
ELSE
$P_INCOAP_R[_RIA]=0
ENDIF
IF (_H_VARI[1]==3)
$P_INCOAP_R[_RIG]=_EP $P_INCOAP_R[_RIR]=_ER
ELSE
$P_INCOAP_R[_RIG]=0 $P_INCOAP_R[_RIR]=0
ENDIF
IF (_H_VARI[0]==5)
$P_INCOAP_R[_RBC]=_FS*_PMZ
ELSE
$P_INCOAP_R[_RBC]=0
ENDIF
$P_INCOAP_R[_RPR]=_RP
IF ( (_H_VARI[0]==4)OR(_H_VARI[0]==5) )
$P_INCOAP_R[_RSR]=_LCIRF
ELSE
$P_INCOAP_R[_RSR]=0
ENDIF
IF ($P_INCOAP_I[_ITT]==140)
$P_INCOAP_R[_RTED]=$P_ADT[7]*_FAK
ELSE
$P_INCOAP_R[_RTED]=0
ENDIF
FOR _I=30 TO 42
$P_INCOAP_R[_I]=0
ENDFOR
$P_INCOAP_S16[_S16NAX]=$MC_AXCONF_GEOAX_NAME_TAB[0]
$P_INCOAP_S16[_S16NAY]=$MC_AXCONF_GEOAX_NAME_TAB[1]
$P_INCOAP_S16[_S16NAZ]=$MC_AXCONF_GEOAX_NAME_TAB[2]
$P_INCOAP_S16[_S16NAI]=$MN_IPO_PARAM_NAME_TAB[0]
$P_INCOAP_S16[_S16NAJ]=$MN_IPO_PARAM_NAME_TAB[1]
$P_INCOAP_S16[_S16NAK]=$MN_IPO_PARAM_NAME_TAB[2]
$P_INCOAP_S160[_S160NGNF]=_ROU_PRG
$P_INCOAP_S160[_S160NDF]=""
__FZ=_FZ
IF ( (_H_DMODE[2]==1)AND(_H_DMODE[3]==0) )
IF (_H_VARI[1]==1)
__FZ=_FZ
ELSE
__FZ=_F
ENDIF
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_F_TYPE=1
_S_F="G95 F"<<_F
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL68
ENDIF
_F_TYPE=11
_S_F="G95 FZ="<<_F
ELSE
_F_TYPE=2
_S_F="G94 F"<<_F
ENDIF
ENDIF
IF ((_VARI _DEC1 == 4)OR(_VARI _DEC1 == 5)OR(_H_DMODE[2]==2) )
_S_FZ=_S_F
ELSE
IF(_DMODE _DEC2<2)
_F_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_F_TYPE=11
ELSE
_F_TYPE=0
ENDIF
ENDIF
IF(_F_TYPE==1)OR(_F_TYPE==3)
_S_FZ="G95 F"<<__FZ
ELSE
IF(_F_TYPE==11)OR(_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL68
ENDIF
_S_FZ="G95 FZ="<<__FZ
ELSE
_S_FZ="G94 F"<<__FZ
ENDIF
ENDIF
ENDIF
$P_INCOAP_S160[_S160RFW]=_S_F
IF ( ((_H_DMODE[2]==1)AND(_H_DMODE[3]==0))OR(_H_DMODE[2]==2) )
$P_INCOAP_S160[_S160RFP]=_S_FZ
ELSE
$P_INCOAP_S160[_S160RFP]=""
ENDIF
$P_INCOAP_S160[_S160RCOFF]=""
$P_INCOAP_S160[_S160RCON]=""
IF (_H_VARI[2]==1)
$P_INCOAP_S160[_S160RCON]="CUST_TECHCYC("<<(3+_UMODE)<<")"
$P_INCOAP_S160[_S160RCOFF]="CUST_TECHCYC("<<(4+_UMODE)<<")"
ENDIF
IF (_H_VARI[2]==3)
$P_INCOAP_S160[_S160RCON]="CUST_TECHCYC("<<(3+_UMODE)<<")"
$P_INCOAP_S160[_S160RCOFF]="CUST_TECHCYC("<<(403+_UMODE)<<")"
ENDIF
$P_INCOAP_S160[_S160RDC]=""
IF (_H_VARI[0]>=3)
$P_INCOAP_S160[_S160RW40]="G40 G340 G348 DISR="<<_SC/2/_SKFE<<" DISCL="<<_SC/2/_SKFE
$P_INCOAP_S160[_S160RW41]="G140 G41 G340 G347 DISR="<<_SC/2/_SKFE<<" DISCL="<<_SC/2/_SKFE
$P_INCOAP_S160[_S160RW42]="G140 G42 G340 G347 DISR="<<_SC/2/_SKFE<<" DISCL="<<_SC/2/_SKFE
ELSE
$P_INCOAP_S160[_S160RW40]="" $P_INCOAP_S160[_S160RW41]="" $P_INCOAP_S160[_S160RW42]=""
ENDIF
REPEAT
IF _FIRSTCALL
$P_INCOAP_B[_BFC]=1 _FIRSTCALL=0
ELSE
IF ( _INCOAP_I_0==2000 )
G4 F0
$P_INCOAP_B[_BFC]=1
ELSE
_INCOAP_I_0=_INCOAP_I_0-1000
IF (_INCOAP_I_0==0)
CONTDCON(_KONTAB)
IF ( ($P_INCOAP_S160[_S160NFWFC]<>"")AND($P_INCOAP_S32[_S32SFC]<>"")AND($P_INCOAP_S32[_S32EFC]<>"") )
CALL $P_INCOAP_S160[_S160NFWFC] BLOCK $P_INCOAP_S32[_S32SFC] TO $P_INCOAP_S32[_S32EFC]
ELSE
CALL $P_INCOAP_S160[_S160NFWFC]
ENDIF
ELSE
CONTDCON(_KONTAB)
IF ( ($P_INCOAP_S160[_S160NFWFIC+(_INCOAP_I_0-1)]<>"")AND($P_INCOAP_S32[_S32SFI+2*(_INCOAP_I_0-1)]<>"")AND($P_INCOAP_S32[_S32EFI+2*(_INCOAP_I_0-1)]<>"") )
CALL $P_INCOAP_S160[_S160NFWFIC+(_INCOAP_I_0-1)] BLOCK $P_INCOAP_S32[_S32SFI+2*(_INCOAP_I_0-1)] TO $P_INCOAP_S32[_S32EFI+2*(_INCOAP_I_0-1)]
ELSE
CALL $P_INCOAP_S160[_S160NFWFIC+(_INCOAP_I_0-1)]
ENDIF
ENDIF
EXECUTE(_ERR)
IF _ERR<>0
$P_INCOAP_B[_BCIF]=0
IF (_INCOAP_I_0==0)
_CONT_ERR=-1
ELSE
_CONT_ERR=_INCOAP_I_0
ENDIF
ELSE
_ERR=CHECKSUM(_CS[0],"_KONTAB",0,_KONTAB[0,5])
IF _ERR<>0
_SERR=<<_ERR
GOTOF _FEHL12
ENDIF
$P_INCOAP_S160[_S160NC]="_KONTAB" $P_INCOAP_S160[_S160CC]=_CS[0] $P_INCOAP_I[_INEIF]=_KONTAB[0,5]
$P_INCOAP_S32[_S32CC]=""
ENDIF
ENDIF
ENDIF
MACHGEN
_INCOAP_I_0=$P_INCOAP_I[_IEM]
UNTIL ( _INCOAP_I_0<1000 )
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_XX]=$P_INCOAP_R[_RSPXM]
$AA_MEAS_POINT1[_YY]=$P_INCOAP_R[_RSPYM]
$AA_MEAS_POINT1[_ZZ]=$P_INCOAP_R[_RZ0]+$P_INCOAP_R[_RSC]
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_XX])+POT($AA_MEAS_POINT2[_YY])))
_SC_POS[0]=$P_INCOAP_R[_RSPXM] _SC_POS[1]=$P_INCOAP_R[_RSPYM]
_ERR_AND_WARN=$P_INCOAP_S160[_S160WAE]
WHILE ((_ERR_AND_WARN<>"")OR(_CONT_ERR<>0))
IF (_ERR_AND_WARN<>"")
_I=MATCH(_ERR_AND_WARN,",")
IF (_I<>-1)
_ANUM=NUMBER(SUBSTR(_ERR_AND_WARN,0,_I))
_ERR_AND_WARN=SUBSTR(_ERR_AND_WARN,_I+1)
ELSE
_ANUM=NUMBER(_ERR_AND_WARN) _ERR_AND_WARN=""
ENDIF
ENDIF
IF ( _ANUM==(-19) )
GOTOF _FEHL69
ENDIF
IF ( _ANUM==(-20) )
GOTOF _FEHL13
ENDIF
IF ( _ANUM==(-18) )
_SERR=<<"License ?"
GOTOF _FEHL67
ENDIF
IF ( (_ANUM==(-1))OR(_ANUM==(-9))OR(_ANUM==(-10))OR(_ANUM==(-12))OR(_ANUM==(-15))OR(_ANUM==3002)OR(_ANUM==3003)OR(_ANUM==3028)OR(_ANUM==3030)OR(_ANUM==3042)OR(_ANUM==3100) )
_SERR=<<_ANUM
GOTOF _FEHL12
ENDIF
IF ( (_ANUM==3103)OR(_ANUM==3104)OR(_ANUM==3106)OR(_ANUM==3108)OR(_ANUM==3126)OR(_ANUM==3356) )
_SERR=<<_ANUM
GOTOF _FEHL12
ENDIF
IF ( ((_ANUM>=3020)AND(_ANUM<=3026))OR((_ANUM>=3113)AND(_ANUM<=3115))OR((_ANUM>=3117)AND(_ANUM<=3119))OR((_ANUM>=3128)AND(_ANUM<=3132)) )
_SERR=<<_ANUM
GOTOF _FEHL12
ENDIF
IF ( (_ANUM==(-1000))OR(_ANUM==(-2000)) )
IF (_ANUM==(-1000))
_SERR=<<_SC_CONT_LAB1[ABS(_ANUM+1000)]
ELSE
_SERR=<<_SC_CONT_LAB2[ABS(_ANUM+2000)]
ENDIF
IF (_H_DMODE[2]==1)
GOTOF _FEHL14
ELSE
GOTOF _FEHL15
ENDIF
ENDIF
IF ( (_ANUM<(-1000))AND(_ANUM>(-3000)) )
IF (_ANUM<(-1000))AND(_ANUM>(-2000))
_SERR=<<_SC_CONT_LAB1[ABS(_ANUM+1000)]
ELSE
_SERR=<<_SC_CONT_LAB2[ABS(_ANUM+2000)]
ENDIF
IF (_H_DMODE[2]==1)
GOTOF _FEHL16
ELSE
GOTOF _FEHL17
ENDIF
ENDIF
IF ( (_ANUM==(-3000))OR(_ANUM==(-4000))OR(_ANUM==(-5000))OR(_ANUM==(-6000))OR(_CONT_ERR==(-1)) )
_I=RINDEX(_SC_CONT_NAME[0],"/")+1 _SERR=SUBSTR(_SC_CONT_NAME[0],_I)
IF (_SC_CONT_LAB1[0]<>"")
_SERR=_SERR<<", "<<_SC_CONT_LAB1[0]
ENDIF
IF (_H_DMODE[2]==1)
GOTOF _FEHL18
ELSE
GOTOF _FEHL19
ENDIF
ENDIF
IF ( ((_ANUM<(-3000))AND(_ANUM>(-4000)))OR((_ANUM<(-4000))AND(_ANUM>(-5000)))OR((_ANUM<(-5000))AND(_ANUM>(-6000)))OR((_ANUM<(-6000))AND(_ANUM>(-7000)))OR((_CONT_ERR<>(-1))AND(_CONT_ERR<>0)) )
IF ((_CONT_ERR<>(-1))AND(_CONT_ERR<>0))
_I=RINDEX($P_INCOAP_S160[_S160NFWFIC-1+_CONT_ERR],"/")+1 _SERR=SUBSTR($P_INCOAP_S160[_S160NFWFIC-1+_CONT_ERR],_I)
IF (_SC_CONT_LAB1[_CONT_ERR]<>"")
_SERR=_SERR<<", "<<_SC_CONT_LAB1[_CONT_ERR]
ENDIF
ELSE
_I=RINDEX($P_INCOAP_S160[_S160NFWFIC-1+ABS(_ANUM MOD 1000)], "/")+1 _SERR=SUBSTR($P_INCOAP_S160[_S160NFWFIC-1+ABS(_ANUM MOD 1000)],_I)
IF (_SC_CONT_LAB1[ABS(_ANUM MOD 1000)]<>"")
_SERR=_SERR<<", "<<_SC_CONT_LAB1[ABS(_ANUM MOD 1000)]
ENDIF
ENDIF
IF (_H_DMODE[2]==1)
GOTOF _FEHL20
ELSE
GOTOF _FEHL21
ENDIF
ENDIF
CASE (_ANUM) OF -2 GOTOF _FEHL3 3111 GOTOF _FEHL3 -6 GOTOF _FEHL22 -7 GOTOF _FEHL23 -13 GOTOF _FEHL24 3041 GOTOF _FEHL24 -5 GOTOF _FEHL25 3040 GOTOF _FEHL25
CASE (_ANUM) OF -14 GOTOF _FEHL26 -8 GOTOF _FEHL27 -11 GOTOF _FEHL28 3001 GOTOF _FEHL29 3011 GOTOF _FEHL30 3105 GOTOF _FEHL30 3120 GOTOF _FEHL30
CASE (_ANUM) OF 3027 GOTOF _FEHL31 3029 GOTOF _FEHL32 3101 GOTOF _FEHL33 3102 GOTOF _FEHL34 3107 GOTOF _FEHL35 3110 GOTOF _FEHL36 3112 GOTOF _FEHL37
CASE (_ANUM) OF 3116 GOTOF _FEHL38 3121 GOTOF _FEHL39 3122 GOTOF _FEHL40 3123 GOTOF _FEHL41 3342 GOTOF _FEHL41 3124 GOTOF _FEHL42 3125 GOTOF _FEHL43
CASE (_ANUM) OF 3127 GOTOF _FEHL44 3133 GOTOF _FEHL45 3134 GOTOF _FEHL46 3313 GOTOF _FEHL47 3353 GOTOF _FEHL50 3357 GOTOF _FEHL51 3109 GOTOF _FEHL52
IF ( (_ANUM<3200)OR(_ANUM>3299) )
_SERR=<<_ANUM
GOTOF _FEHL12
ENDIF
ENDWHILE
_SYNC:
IF (_HOST)
IF NOT(ISFILE(_ROU_PRG))
_SERR=<<_ROU_PRG
GOTOF _FEHL75
ENDIF
IF (_H_GMODE[2]==2)
_ZEILE[0]=REP("")
READ(_TEMP,_ROU_PRG,1,20,_ZEILE)
IF (_TEMP<>0)
_SERR=<<_TEMP
GOTOF _FEHL76
ENDIF
_STR[0]=REP("")
_STR[0]=";startpoint first axis :" _STR[1]=";startpoint second axis:"
FOR _I=0 TO 1
FOR _III=0 TO 20
_TEMP=MATCH(_ZEILE[_III],_STR[_I])
IF (_TEMP<>(-1))
GOTOF _M1
ENDIF
ENDFOR
_M1:
_TEMP=INDEX(_ZEILE[_III],":")
IF (_TEMP==-1)
_SERR=<<_TEMP
GOTOF _FEHL76
ENDIF
_ZEILE[_III]=SUBSTR(_ZEILE[_III],_TEMP+1)
_SC_POS[_I]=NUMBER(_ZEILE[_III])
ENDFOR
GOTOF _ENDE
ELSE
GOTOF _AUSRAEUM
ENDIF
ENDIF
IF ( (_INCOAP_I_0>=0)AND(_INCOAP_I_0<1000)AND(_H_GMODE[2]<>2) )
_AUSRAEUM:
IF (_H_VARI[2]==2)
CUST_TECHCYC(3+_UMODE)
ENDIF
IF (_H_VARI[2]==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
IF ($P_GG[10]<2)
G[10]=2
ENDIF
CALL _ROU_PRG
IF ( (_PROGS<>"E_CP_")AND(_PROGS<>"F_CP_") )
G0 AX[_ZZ]=_RP
ENDIF
ENDIF
_ENDE:
IF (($SCS_FUNCTION_MASK_TECH_SET B_AND 'B1000') AND (_H_GMODE[2]<>2))
WHILE (ISFILE(_ROU_PRG))
DELETE(_TEMP,_ROU_PRG)
ENDWHILE
ENDIF
RET
_FASAN_A:
IF(_TANGO>=0)AND(_TANGO<90)
_TANGO=TAN(_TANGO)
ELSE
GOTOF _FEHL63
ENDIF
_FASAN_E:
_FEHL0: STOPRE
N706300 SETAL(61000)
RET
_FEHL1: STOPRE
N706301 SETAL(61212)
RET
_FEHL2: STOPRE
N706302 SETAL(61019,_SERR)
RET
_FEHL3: STOPRE
N706303 SETAL(61900)
RET
_FEHL4: STOPRE
N706304 SETAL(61901,_SERR)
RET
_FEHL5: STOPRE
N706405 SETAL(61012)
RET
_FEHL6: STOPRE
N706306 SETAL(61287)
RET
_FEHL7: STOPRE
N706307 SETAL(61002)
RET
_FEHL8: STOPRE
N706308 SETAL(61102)
RET
_FEHL9: STOPRE
N706309 SETAL(61101)
RET
_FEHL10: STOPRE
N706310 SETAL(61154)
RET
_FEHL11: STOPRE
N706311 SETAL(61240)
RET
_FEHL12: STOPRE
N706312 SETAL(61920,_SERR)
RET
_FEHL13: STOPRE
N706313 SETAL(61006)
RET
_FEHL14: STOPRE
N706314 SETAL(61902,_SERR)
RET
_FEHL15: STOPRE
N706315 SETAL(61903,_SERR)
RET
_FEHL16: STOPRE
N706316 SETAL(61904,_SERR)
RET
_FEHL17: STOPRE
N706317 SETAL(61905,_SERR)
RET
_FEHL18: STOPRE
N706318 SETAL(61909,_SERR)
RET
_FEHL19: STOPRE
N706319 SETAL(61910,_SERR)
RET
_FEHL20: STOPRE
N706320 SETAL(61911,_SERR)
RET
_FEHL21: STOPRE
N706321 SETAL(61912,_SERR)
RET
_FEHL22: STOPRE
N706322 SETAL(61908)
RET
_FEHL23: STOPRE
N706323 SETAL(61907)
RET
_FEHL24: STOPRE
N706324 SETAL(61914)
RET
_FEHL25: STOPRE
N706325 SETAL(61915)
RET
_FEHL26: STOPRE
N706326 SETAL(61916)
RET
_FEHL27: STOPRE
N706327 SETAL(61519)
RET
_FEHL28: STOPRE
N706328 SETAL(61158)
RET
_FEHL29: STOPRE
N706329 SETAL(61930)
RET
_FEHL30: STOPRE
N706330 SETAL(61931)
RET
_FEHL31: STOPRE
N706331 SETAL(61932)
RET
_FEHL32: STOPRE
N706332 SETAL(61933)
RET
_FEHL33: STOPRE
N706333 SETAL(61934)
RET
_FEHL34: STOPRE
N706334 SETAL(61935)
RET
_FEHL35: STOPRE
N706335 SETAL(61936)
RET
_FEHL36: STOPRE
N706336 SETAL(61937)
RET
_FEHL37: STOPRE
N706337 SETAL(61938)
RET
_FEHL38: STOPRE
N706338 SETAL(61939)
RET
_FEHL39: STOPRE
N706339 SETAL(61940)
RET
_FEHL40: STOPRE
N706340 SETAL(61941)
RET
_FEHL41: STOPRE
N706341 SETAL(61942)
RET
_FEHL42: STOPRE
N706342 SETAL(61943)
RET
_FEHL43: STOPRE
N706343 SETAL(61944)
RET
_FEHL44: STOPRE
N706344 SETAL(61945)
RET
_FEHL45: STOPRE
N706345 SETAL(61946)
RET
_FEHL46: STOPRE
N706346 SETAL(61947)
RET
_FEHL47: STOPRE
N706347 SETAL(61948)
RET
_FEHL48: STOPRE
N706348 SETAL(61949)
RET
_FEHL49: STOPRE
N706349 SETAL(61950)
RET
_FEHL50: STOPRE
N706350 SETAL(61951)
RET
_FEHL51: STOPRE
N706351 SETAL(61952)
RET
_FEHL52: STOPRE
N706352 SETAL(61157)
RET
_FEHL53: STOPRE
N706353 SETAL(61109)
RET
_FEHL54: STOPRE
N706354 SETAL(61917)
RET
_FEHL55: STOPRE
N706355 SETAL(61918)
RET
_FEHL56: STOPRE
N706356 SETAL(61919)
RET
_FEHL57: STOPRE
N706357 SETAL(61117)
RET
_FEHL58: STOPRE
N706358 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL59: STOPRE
N706359 SETAL(61270)
RET
_FEHL60: STOPRE
N706360 SETAL(61272)
RET
_FEHL61: STOPRE
N706361 SETAL(61271)
RET
_FEHL62: STOPRE
N706362 SETAL(61273)
RET
_FEHL63: STOPRE
N706363 SETAL(61274)
RET
_FEHL64: STOPRE
N706364 SETAL(61003)
RET
_FEHL65: STOPRE
N706365 SETAL(61564)
RET
_FEHL66: STOPRE
N706366 SETAL(61017,_SERR)
RET
_FEHL67: STOPRE
N706367 SETAL(61099,_SERR)
RET
_FEHL68: STOPRE
N706368 SETAL(61216)
RET
_FEHL69: STOPRE
N706369 SETAL(61357)
RET
_FEHL70: STOPRE
N706370 SETAL(61343,_SERR)
RET
_FEHL71: STOPRE
N706371 SETAL(61042,_SERR)
RET
_FEHL72: STOPRE
N706372 SETAL(61044,_SERR)
RET
_FEHL73: STOPRE
N706373 SETAL(61029,_SERR)
RET
_FEHL74: STOPRE
N706374 SETAL(61051)
RET
_FEHL75: STOPRE
N706375 SETAL(61032,_SERR)
RET
_FEHL76: STOPRE
N706376 SETAL(61038,_SERR)
RET
_FEHL77: STOPRE
N706377 SETAL(61028,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE64_SPF
PROC CYCLE64(STRING[100] _PRG,INT _VARI,REAL _RP,REAL _Z0,REAL _SC,REAL _Z1,REAL _F,REAL _DXY,REAL _UXY,REAL _UZ,INT _CDIR,STRING[32] _TR,INT _DR,INT _UMODE,INT _GMODE,INT _DMODE,INT _AMODE,REAL _XS,REAL _YS) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;pre-drill-/centre cycle
DEF BOOL _FIRSTCALL=1,_M_CHAN=0,_HOST=0,_EES=0
DEF INT _H_GMODE[3],_H_DMODE[6],_H_AMODE[4],_H_VARI[5],_H_MSNUM,_MA_NR_SP,_KA_NR_SP,_GG06,_GG15,_WZT,_T,_FILEA=0,_FILEB=0,_ANUM
DEF INT _INCOAP_I_0,_G94,_TEMP,_MI_AXIS[3],_ERR,_I,_III,_CONT_ERR=0,_M3_M4,_G2_G3,_MIRR,_ANZ_Z1=24,_ANZ_Z2=100,_GEO_D=1,_VER_D=1
DEF INT _CI=0,_BFC=0,_BCIF=1,_BA=2,_BLFR=3,_BR2=4,_BIS=5,_BDIP=6,_BSCOO=7,_BCDP=8,_BCODP=9,_BSPTC=10
DEF INT _IEM=0,_INC=1,_INEIF=2,_IDRM=3,_IDRI=4,_ITT=5,_ISP=6,_IOC=7,_ISC=8,_ISPMOI=9,_ICDA=10,_IOL=11
DEF INT _IMT=12,_IWD=13,_ISL=14,_II=15,_ISAIZ=16
DEF INT _RTCH=0,_RTCA=1,_RTT=2,_RSITM=3,_RPDZ=4,_RSC=5,_RTA=6,_RDSPA=7,_RDSPO=8,_RSFP=9,_RSF3=10,_RZ0=11
DEF INT _RZ1=12,_RID=13,_RMCR=14,_RRR=15,_RPDXY=16,_RFAB=17,_RFABO=18,_RIA=19,_RIG=20,_RIR=21,_RBC=22,_RPR=23,_RSR=24
DEF INT _RTED=25,_RMDR=26,_RSPXM=27,_RSPYM=28,_S16NAX=0,_S16NAY=1,_S16NAZ=2,_S16NAI=3,_S16NAJ=4,_S16NAK=5
DEF INT _S32SFC=0,_S32EFC=1,_S32CC=2,_S32SFI=3,_S32EFI=4,_S160WAE=0,_S160NGNF=1,_S160NFWFC=2,_S160NC=3,_S160CC=4,_S160NDF=5
DEF INT _S160RFP=6,_S160RFW=7,_S160RCON=8,_S160RCOFF=9,_S160RDC=10,_S160RW40=11,_S160RW41=12,_S160RW42=13,_S160NFWFIC=14
DEF INT _TRAFO
DEF REAL _KONTAB[600,6],_FAK,__Z1,_LSPITZE,_R_THEO,_R_RUND
DEF STRING[255] _ZEILE[21]
DEF STRING[160] _DATEINAME1[11],_PFADAUFRUF,_PFAD,_ERR_AND_WARN,_SERR,_STR[3],_ROU_PRG
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE64_MPF",_TEMP_FILEA="//NC:/_N_MPF_DIR/_N_LOG_CYCLE64A_MPF",_TEMP_FILEB="//NC:/_N_MPF_DIR/_N_LOG_CYCLE64B_MPF"
DEF STRING[35] _AX,_PROG,_PROGS
DEF STRING[32] _CS[1]
DEF STRING[4] _PTYP="_MPF",_EES_PTYP=".MPF",_CHANNU=""
DEF AXIS _XX,_YY,_ZZ,_MAX
CYCLE218(1)
IF (ISVAR("$MN_MACHGEN_DEBUG_MASK"))
_HOST=1
ENDIF
IF ( $ON_NUM_CHANNELS>1 )
_TEMP=0
FOR _I=0 TO 9
IF ( $MN_ASSIGN_CHAN_TO_MODE_GROUP[_I]>0 )
_TEMP=_TEMP+1
ENDIF
ENDFOR
IF (_TEMP>1)
_M_CHAN=1 _TEMP=0 _ANZ_Z1=20 _ANZ_Z2=96
ENDIF
ENDIF
IF ( ($P_INCOAP_SIZE[2]==0)AND(_HOST==0) )
_SERR=<<"Advanced contour cycle"
GOTOF _FEHL42
ENDIF
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE64_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_SC_LAST_CONT="<<_SC_LAST_CONT)
FOR _I=0 TO _SC_LAST_CONT-1
IF(_SC_CONT_NAME[_I]<>"")
WRITE(_TEMP,_TEMP_FILE,"_SC_CONT_NAME["<<_I<<"]="<<"'"'"<<_SC_CONT_NAME[_I]<<"'"'")
ENDIF
IF(_SC_CONT_LAB1[_I]<>"")
WRITE(_TEMP,_TEMP_FILE,"_SC_CONT_LAB1["<<_I<<"]="<<"'"'"<<_SC_CONT_LAB1[_I]<<"'"'")
ENDIF
IF(_SC_CONT_LAB2[_I]<>"")
WRITE(_TEMP,_TEMP_FILE,"_SC_CONT_LAB2["<<_I<<"]="<<"'"'"<<_SC_CONT_LAB2[_I]<<"'"'")
ENDIF
ENDFOR
WRITE(_TEMP,_TEMP_FILE,"CYCLE64("<<"'"'"<<_PRG<<"'"'"<<","<<_VARI<<","<<_RP<<","<<_Z0<<","<<_SC<<","<<_Z1<<","<<_F<<","<<_DXY<<","<<_UXY<<","<<_UZ<<","<<_CDIR<<","<<"'"'"<<_TR<<"'"'"<<","<<_DR<<","<<_UMODE<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_H_VARI[2]=(_VARI _DEC3) _H_VARI[3]=(_VARI _DEC4) _H_VARI[4]=(_VARI _DEC5)
_H_GMODE[2]=(_GMODE _DEC3)
_H_DMODE[0]=(_DMODE _DEC1) _H_DMODE[1]=(_DMODE _DEC2) _H_DMODE[5]=(_DMODE _DEC6)
_H_AMODE[0]=(_AMODE _DEC1) _H_AMODE[1]=(_AMODE _DEC2) _H_AMODE[3]=(_AMODE _DEC4)
IF ($P_TOOL>0)
_WZT=$P_ADT[1]
IF ( (_WZT<100)OR(_WZT>299) )
GOTOF _FEHL1
ENDIF
ELSE
GOTOF _FEHL0
ENDIF
IF ( (_H_VARI[3]<0)OR(_H_VARI[3]>1) )
_SERR=<<"(_VARI: dec4)"
GOTOF _FEHL2
ENDIF
IF ( (_H_VARI[4]<0)OR(_H_VARI[4]>1) )
_SERR=<<"(_VARI: dec5)"
GOTOF _FEHL2
ENDIF
IF ( (_H_GMODE[2]<0)OR(_H_GMODE[2]>2) )
_SERR=<<"(_GMODE: dec3)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[0]<0)OR(_H_DMODE[0]>3) )
_SERR=<<"(_DMODE: dec1)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[1]<1)OR(_H_DMODE[1]>2) )
_SERR=<<"(_DMODE: dec2)"
GOTOF _FEHL2
ENDIF
IF ( (_H_DMODE[5]<0)OR(_H_DMODE[5]>1) )
_SERR=<<"(_DMODE: dec6)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[0]<0)OR(_H_AMODE[0]>1) )
_SERR=<<"(_AMODE: dec1)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[1]<0)OR(_H_AMODE[1]>1) )
_SERR=<<"(_AMODE: dec2)"
GOTOF _FEHL2
ENDIF
IF ( (_H_AMODE[3]<0)OR(_H_AMODE[3]>1) )
_SERR=<<"(_AMODE: dec4)"
GOTOF _FEHL2
ENDIF
IF (_SC_LAST_CONT==0) GOTOF _FEHL16
IF ( (_H_DMODE[1]==1)AND(_UZ<0) )
_SERR=<<"UZ"
GOTOF _FEHL2
ENDIF
IF ( _SC<0 )
_SERR=<<"SC"
GOTOF _FEHL2
ENDIF
IF ( _UXY<0 )
_SERR=<<"UXY"
GOTOF _FEHL2
ENDIF
IF ( _DXY<0 )
_SERR=<<"DXY"
GOTOF _FEHL2
ENDIF
IF ( ($P_SUBPAR[1]==0)OR(_PRG=="") )
GOTOF _FEHL3
ELSE
_ERR=MINDEX(_PRG,"(,),[,],{,},<,>,:,=,*,+,-,.,,,;,%,&,$,?,!,^,@,#,\, ,|,'H22','H27'")
IF (SUBSTR(TOUPPER(_PRG),0,5)=="//NC:")
_ERR=MINDEX(_PRG,"(,),[,],{,},<,>,=,*,+,-,.,,,;,%,&,$,?,!,^,@,#,\, ,|,'H22','H27'")
ENDIF
IF (_ERR<>(-1))
_SERR=<<"PRG, "<<_PRG[_ERR]
GOTOF _FEHL46
ENDIF
IF (_H_DMODE[5]==1)
_PRG="//NC:/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_PRG<<"_MPF"
ENDIF
IF ( (NOT(SUBSTR(TOUPPER(_PRG),0,4)=="/_N_"))AND(NOT(SUBSTR(TOUPPER(_PRG),0,2)=="//")) )
_ERR=MINDEX(_PRG,"/")
IF (_ERR<>(-1))
_SERR=<<"PRG, "<<_PRG[_ERR]
GOTOF _FEHL46
ENDIF
IF (STRLEN(_PRG)>_ANZ_Z1)
_SERR=<<"PRG: "<<_PRG
GOTOF _FEHL47
ENDIF
IF ( ((STRLEN($P_PROG[0])-7)>0)OR((STRLEN($P_PROG[0])-4)>0) )
IF (SUBSTR($P_PROG[0],0,3)=="_N_")
_STR[0]=SUBSTR($P_PROG[0],3,STRLEN($P_PROG[0])-7)
ELSE
_STR[0]=SUBSTR($P_PROG[0],0,STRLEN($P_PROG[0])-4)
ENDIF
IF (_STR[0]==TOUPPER(_PRG))
GOTOF _FEHL48
ENDIF
ENDIF
ELSE
IF (STRLEN(_PRG)>_ANZ_Z2)
_SERR=<<"PRG: "<<_PRG
GOTOF _FEHL47
ENDIF
_STR[0]=$P_PATH[0]<<$P_PROG[0]
IF (_STR[0]==TOUPPER(_PRG))
GOTOF _FEHL48
ENDIF
ENDIF
ENDIF
IF ( (_CDIR<0)OR(_CDIR>1) )
GOTOF _FEHL37
ENDIF
IF ( _F<=0 ) GOTOF _FEHL39
IF ( _H_DMODE[1]==2 )
_H_AMODE[0]=1
ENDIF
IF (_M_CHAN)
IF ($P_CHANNO<10)
_CHANNU="_C0"<<$P_CHANNO
ELSE
_CHANNU="_C"<<$P_CHANNO
ENDIF
ENDIF
IF ($P_EXTBUF[$P_STACK-1]=="")
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7) _PROGS=SUBSTR($P_PROG[$P_STACK-1],3,5)
ELSE
_PROG=SUBSTR($P_EXTBUF[$P_STACK-1],3,STRLEN($P_EXTBUF[$P_STACK-1])-7) _PROGS=SUBSTR($P_EXTBUF[$P_STACK-1],3,5)
ENDIF
IF ( (_PROGS=="E_CP_")OR(_PROGS=="F_CP_")OR(_PROG=="CYCLE73") )
IF ($P_IS_EES_PATH[$P_STACK-2])
_EES=1
ENDIF
IF ($P_EXTPATH[$P_STACK-2]=="")
_PFADAUFRUF=$P_PATH[$P_STACK-2]
ELSE
_PFADAUFRUF=$P_EXTPATH[$P_STACK-2]
ENDIF
IF ( (_PROGS=="E_CP_")OR(_PROGS=="F_CP_") )
IF (SUBSTR(TOUPPER(_PRG),0,4)=="/_N_")
_PRG="//NC:"<<_PRG
ENDIF
ENDIF
ELSE
IF ($P_IS_EES_PATH[$P_STACK-1])
_EES=1
ENDIF
IF ($P_EXTPATH[$P_STACK-1]=="")
_PFADAUFRUF=$P_PATH[$P_STACK-1]
ELSE
_PFADAUFRUF=$P_EXTPATH[$P_STACK-1]
ENDIF
ENDIF
IF ((SUBSTR(_PFADAUFRUF,0,12)=="/_N_SPF_DIR/")AND(_EES==0))
_PTYP="_SPF"
ENDIF
IF ( (SUBSTR(TOUPPER(_PRG),0,4)=="/_N_")OR(SUBSTR(TOUPPER(_PRG),0,2)=="//") )
_ROU_PRG=(SUBSTR(_PRG,0,STRLEN(_PRG)-4))<<_CHANNU<<(SUBSTR(_PRG,STRLEN(_PRG)-4))
ELSE
IF ( (SUBSTR(_PFADAUFRUF,0,12)=="/_N_SYF_DIR/")OR(SUBSTR(_PFADAUFRUF,0,12)=="/_N_EXT_DIR/") )
_ROU_PRG="//NC:/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_PRG<<_CHANNU<<_PTYP
ELSE
IF (_EES)
_ROU_PRG=_PFADAUFRUF<<_PRG<<_CHANNU<<_EES_PTYP
ELSE
_ROU_PRG=_PFADAUFRUF<<"_N_"<<_PRG<<_CHANNU<<_PTYP
ENDIF
ENDIF
ENDIF
IF (_M_CHAN)
IF (_EES)
IF ( (STRLEN($P_PROG[0])-8)>=0)
_STR[0]=SUBSTR($P_PROG[0],STRLEN($P_PROG[0])-8,4)
_STR[1]=SUBSTR(_STR[0],0,2) _STR[2]=SUBSTR(_STR[0],2)
IF ( (_STR[1]=="_C") AND (ISNUMBER(_STR[2])) )
_SERR=$P_PROG[0]
GOTOF _FEHL45
ENDIF
ENDIF
ELSE
IF ( (STRLEN($P_PROG[0])-8)>=3)
_STR[0]=SUBSTR($P_PROG[0],STRLEN($P_PROG[0])-8,4)
_STR[1]=SUBSTR(_STR[0],0,2) _STR[2]=SUBSTR(_STR[0],2)
IF ( (_STR[1]=="_C") AND (ISNUMBER(_STR[2])) )
_SERR=$P_PROG[0]
GOTOF _FEHL45
ENDIF
ENDIF
ENDIF
ENDIF
IF (_HOST) GOTOF _SYNC
$P_INCOAP_S32[_S32SFC]=_SC_CONT_LAB1[0] $P_INCOAP_S32[_S32EFC]=_SC_CONT_LAB2[0]
FOR _I=1 TO _SC_LAST_CONT-1
$P_INCOAP_S32[_S32SFI+2*(_I-1)]=_SC_CONT_LAB1[_I] $P_INCOAP_S32[_S32EFI+2*(_I-1)]=_SC_CONT_LAB2[_I]
ENDFOR
FOR _I=0 TO _SC_LAST_CONT-1
IF ( (NOT(SUBSTR(TOUPPER(_SC_CONT_NAME[_I]),0,4)=="/_N_"))AND(NOT(SUBSTR(TOUPPER(_SC_CONT_NAME[_I]),0,2)=="//")) )
IF (STRLEN(_SC_CONT_NAME[_I])>24)
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL51
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_SPF_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_MPF_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD="/_N_SPF_DIR/" _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_WKS_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD="/_N_SPF_DIR/" _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_EXT_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( SUBSTR(_PFADAUFRUF,0,12)=="/_N_SYF_DIR/" )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<"_N_"<<_SC_CONT_NAME[_I]<<"_MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
IF ( (SUBSTR(_PFADAUFRUF,0,2)=="//")AND(_EES) )
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<_SC_CONT_NAME[_I]<<".SPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_PFAD=_PFADAUFRUF _DATEINAME1[_I]=<<_SC_CONT_NAME[_I]<<".MPF"
IF NOT(ISFILE(_PFAD<<_DATEINAME1[_I]))
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
ELSE
GOTOF _PFADFOUND
ENDIF
ELSE
GOTOF _PFADFOUND
ENDIF
ENDIF
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL4
_PFADFOUND:
IF (_I==0)
$P_INCOAP_S160[_S160NFWFC]=_PFAD<<_DATEINAME1[_I]
ELSE
$P_INCOAP_S160[_S160NFWFIC+(_I-1)]=_PFAD<<_DATEINAME1[_I]
ENDIF
ELSE
IF (STRLEN(_SC_CONT_NAME[_I])>100)
_SERR=<<_SC_CONT_NAME[_I]
GOTOF _FEHL51
ENDIF
IF (_I==0)
$P_INCOAP_S160[_S160NFWFC]=_SC_CONT_NAME[_I]
ELSE
$P_INCOAP_S160[_S160NFWFIC+(_I-1)]=_SC_CONT_NAME[_I]
ENDIF
ENDIF
ENDFOR
IF ( (_H_DMODE[0]>0)AND($P_GG[6]<>_H_DMODE[0]) )
_GG06=(_H_DMODE[0])
G[6]=_GG06
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL5
_MIRR=$P_ACTFRAME[_XX,MI]+$P_ACTFRAME[_YY,MI]+$P_ACTFRAME[_ZZ,MI]
IF($P_GG[13]<3)
_FAK=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK=1
ENDIF
IF (_H_VARI[2]<>0)
IF ( (_UMODE<>3)AND(_UMODE<>23) )
GOTOF _FEHL7
ENDIF
IF (_H_VARI[2]==2)
_TRAFO=$P_TRAFO
IF (_TRAFO B_AND 'H1300')
GOTOF _FEHL7
ENDIF
ENDIF
ENDIF
_H_MSNUM=$P_MSNUM
IF (_H_MSNUM==0) GOTOF _FEHL6
IF ( ($P_SMODE[0]==1) OR ($P_SMODE[0]==3) )
_M3_M4=$P_SDIR[$P_MSNUM]
IF(_M3_M4<3)OR(_M3_M4>4)
GOTOF _FEHL36
ENDIF
ELSE
GOTOF _FEHL36
ENDIF
IF (_PROG=="CYCLE73")
IF ( (_H_AMODE[0]==1)AND(_RP==_Z0) ) GOTOF _FEHL8
ELSE
IF (_RP==_Z0) GOTOF _FEHL8
ENDIF
IF (_H_DMODE[1]==1)
IF (_H_AMODE[0]==1)
__Z1=ABS(_Z1)-_UZ
ELSE
IF (_RP>_Z0)
__Z1=_Z1+_UZ
ELSE
__Z1=_Z1-_UZ
ENDIF
ENDIF
ELSE
IF (_H_AMODE[0]==1)
__Z1=ABS(_Z1)
ELSE
__Z1=_Z1
ENDIF
ENDIF
IF(_H_AMODE[0]==1)
IF(__Z1==0) GOTOF _FEHL9
__Z1=_Z0-(_RP-_Z0)/ABS(_RP-_Z0)*__Z1
_H_AMODE[0]=0
ENDIF
_SC_TMI_STAT[0]=10*_CDIR+_H_DMODE[1]
_SC_FIRST_CONT=0
$P_INCOAP_C[_CI]="M"
$P_INCOAP_B[_BCIF]=1
$P_INCOAP_B[_BA]=0
$P_INCOAP_B[_BLFR]=$ON_TECHNO_FUNCTION_MASK B_AND 'B10000000000000000'
$P_INCOAP_B[_BR2]=0
IF ( (_PROGS=="E_CP_")OR(_PROGS=="F_CP_") )
$P_INCOAP_B[_BIS]=_H_VARI[4]
ELSE
$P_INCOAP_B[_BIS]=0
ENDIF
$P_INCOAP_B[_BDIP]=_H_AMODE[1]
$P_INCOAP_B[_BCDP]=1
$P_INCOAP_B[_BCODP]=1
IF ( (_H_VARI[2]==0)OR(_H_VARI[2]==2) )
$P_INCOAP_B[_BSCOO]=0
ELSE
$P_INCOAP_B[_BSCOO]=1
ENDIF
$P_INCOAP_B[_BSPTC]=_H_AMODE[3]
$P_INCOAP_I[_INC]=_SC_LAST_CONT
$P_INCOAP_I[_INEIF]=0
$P_INCOAP_I[_IDRM]=$MNS_DISP_RES_MM
$P_INCOAP_I[_IDRI]=$MNS_DISP_RES_INCH
$P_INCOAP_I[_ITT]=$P_ADT[1]
$P_INCOAP_I[_ISP]=$P_GG[6]
$P_INCOAP_I[_IOC]=101
_GG15=$P_GG[15]
IF ( (_GG15==1)OR(_GG15==6) ) GOTOF _FEHL10
IF ( (_GG15==2)OR(_GG15==7)OR(_GG15==8) )
_G94=1
ELSE
_G94=0
ENDIF
$P_INCOAP_I[_ISC]=0
$P_INCOAP_I[_ISPMOI]=$P_GG[13]
$P_INCOAP_I[_ICDA]=0
IF (ISFILE(_TEMP_FILEA))
_FILEA=1
ENDIF
IF (ISFILE(_TEMP_FILEB))
_FILEB=2
ENDIF
$P_INCOAP_I[_IOL]=_FILEA+_FILEB
$P_INCOAP_I[_IMT]=0
$P_INCOAP_I[_II]=0
$P_INCOAP_I[_ISAIZ]=_H_AMODE[0]
IF (_CDIR==0)
IF (_M3_M4==3)
_G2_G3=3
ELSE
_G2_G3=2
ENDIF
ELSE
IF (_M3_M4==3)
_G2_G3=2
ELSE
_G2_G3=3
ENDIF
ENDIF
IF (_MIRR MOD 2)
IF (_G2_G3==2)
_G2_G3=_G2_G3+1
ELSE
_G2_G3=_G2_G3-1
ENDIF
ENDIF
$P_INCOAP_I[_IWD]=_G2_G3
$P_INCOAP_I[_ISL]=_H_VARI[3]
$P_INCOAP_R[_RSITM]=$MN_SCALING_VALUE_INCH
$P_INCOAP_R[_RPDZ]=1
$P_INCOAP_R[_RSC]=_SC
IF ( (_WZT>=200)AND(_WZT<=299) )
$P_INCOAP_R[_RTA]=$P_ADT[24]
ELSE
$P_INCOAP_R[_RTA]=0
ENDIF
IF ( (_H_VARI[4]==1)AND((_PROGS=="E_CP_")OR(_PROGS=="F_CP_")) )
$P_INCOAP_R[_RDSPA]=_XS $P_INCOAP_R[_RDSPO]=_YS
ELSE
$P_INCOAP_R[_RDSPA]=0
$P_INCOAP_R[_RDSPO]=0
ENDIF
$P_INCOAP_R[_RSFP]=$P_ACTFRAME[_XX,SC]
$P_INCOAP_R[_RSF3]=$P_ACTFRAME[_ZZ,SC]
$P_INCOAP_R[_RZ0]=_Z0
$P_INCOAP_R[_RZ1]=__Z1
$P_INCOAP_R[_RID]=0
_T=GETT(_TR,0)
IF (_T<0)
_SERR=_TR
GOTOF _FEHL44
ENDIF
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H800')
_GEO_D=2
ENDIF
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H1000')
_VER_D=2
ENDIF
$P_INCOAP_R[_RMCR]=(($TC_DP6[_T,_DR]/_GEO_D)+($TC_DP15[_T,_DR]/_VER_D))*_FAK
IF ($P_INCOAP_R[_RMCR]<=0) GOTOF _FEHL40
$P_INCOAP_R[_RRR]=0
$P_INCOAP_R[_RPDXY]=_DXY
IF (_H_DMODE[1]==1)
$P_INCOAP_R[_RFAB]=_UZ
ELSE
$P_INCOAP_R[_RFAB]=0
ENDIF
$P_INCOAP_R[_RFABO]=_UXY
$P_INCOAP_R[_RIA]=0 $P_INCOAP_R[_RIG]=0 $P_INCOAP_R[_RIR]=0 $P_INCOAP_R[_RBC]=0
$P_INCOAP_R[_RPR]=_RP
$P_INCOAP_R[_RSR]=0 $P_INCOAP_R[_RTED]=0
FOR _I=30 TO 42
$P_INCOAP_R[_I]=0
ENDFOR
$P_INCOAP_S16[_S16NAX]=$MC_AXCONF_GEOAX_NAME_TAB[0]
$P_INCOAP_S16[_S16NAY]=$MC_AXCONF_GEOAX_NAME_TAB[1]
$P_INCOAP_S16[_S16NAZ]=$MC_AXCONF_GEOAX_NAME_TAB[2]
$P_INCOAP_S16[_S16NAI]=$MN_IPO_PARAM_NAME_TAB[0]
$P_INCOAP_S16[_S16NAJ]=$MN_IPO_PARAM_NAME_TAB[1]
$P_INCOAP_S16[_S16NAK]=$MN_IPO_PARAM_NAME_TAB[2]
$P_INCOAP_S160[_S160NGNF]=_ROU_PRG
$P_INCOAP_S160[_S160NDF]=_ROU_PRG
$P_INCOAP_S160[_S160RFP]=""
IF(_G94==1)
$P_INCOAP_S160[_S160RFW]="G94 F="<<_F
ELSE
$P_INCOAP_S160[_S160RFW]="G95 F="<<_F
ENDIF
IF (_H_VARI[2]==1)
$P_INCOAP_S160[_S160RCON]="CUST_TECHCYC("<<_UMODE<<")"
$P_INCOAP_S160[_S160RCOFF]="CUST_TECHCYC("<<_UMODE+1<<")"
ELSE
$P_INCOAP_S160[_S160RCOFF]=""
$P_INCOAP_S160[_S160RCON]=""
ENDIF
$P_INCOAP_S160[_S160RDC]="CYCLE82("<<_RP<<","<<_Z0<<","<<_SC<<","<<__Z1<<",,0,0,"<<_H_DMODE[0]<<",12)"
$P_INCOAP_S160[_S160RW40]="" $P_INCOAP_S160[_S160RW41]="" $P_INCOAP_S160[_S160RW42]=""
REPEAT
IF _FIRSTCALL
$P_INCOAP_B[_BFC]=1 _FIRSTCALL=0
ELSE
IF ( _INCOAP_I_0==2000 )
G4 F0
$P_INCOAP_B[_BFC]=1
ELSE
_INCOAP_I_0=_INCOAP_I_0-1000
IF (_INCOAP_I_0==0)
CONTDCON(_KONTAB)
IF ( ($P_INCOAP_S160[_S160NFWFC]<>"")AND($P_INCOAP_S32[_S32SFC]<>"")AND($P_INCOAP_S32[_S32EFC]<>"") )
CALL $P_INCOAP_S160[_S160NFWFC] BLOCK $P_INCOAP_S32[_S32SFC] TO $P_INCOAP_S32[_S32EFC]
ELSE
CALL $P_INCOAP_S160[_S160NFWFC]
ENDIF
ELSE
CONTDCON(_KONTAB)
IF ( ($P_INCOAP_S160[_S160NFWFIC+(_INCOAP_I_0-1)]<>"")AND($P_INCOAP_S32[_S32SFI+2*(_INCOAP_I_0-1)]<>"")AND($P_INCOAP_S32[_S32EFI+2*(_INCOAP_I_0-1)]<>"") )
CALL $P_INCOAP_S160[_S160NFWFIC+(_INCOAP_I_0-1)] BLOCK $P_INCOAP_S32[_S32SFI+2*(_INCOAP_I_0-1)] TO $P_INCOAP_S32[_S32EFI+2*(_INCOAP_I_0-1)]
ELSE
CALL $P_INCOAP_S160[_S160NFWFIC+(_INCOAP_I_0-1)]
ENDIF
ENDIF
EXECUTE(_ERR)
IF _ERR<>0
$P_INCOAP_B[_BCIF]=0
IF (_INCOAP_I_0==0)
_CONT_ERR=-1
ELSE
_CONT_ERR=_INCOAP_I_0
ENDIF
ELSE
_ERR=CHECKSUM(_CS[0],"_KONTAB",0,_KONTAB[0,5])
IF _ERR<>0
_SERR=<<_ERR
GOTOF _FEHL11
ENDIF
$P_INCOAP_S160[_S160NC]="_KONTAB" $P_INCOAP_S160[_S160CC]=_CS[0] $P_INCOAP_I[_INEIF]=_KONTAB[0,5]
$P_INCOAP_S32[_S32CC]=""
ENDIF
ENDIF
ENDIF
MACHGEN
_INCOAP_I_0=$P_INCOAP_I[_IEM]
UNTIL ( _INCOAP_I_0<1000 )
_SC_POS[0]=$P_INCOAP_R[_RSPXM] _SC_POS[1]=$P_INCOAP_R[_RSPYM]
_ERR_AND_WARN=$P_INCOAP_S160[_S160WAE]
WHILE ((_ERR_AND_WARN<>"")OR(_CONT_ERR<>0))
IF (_ERR_AND_WARN<>"")
_I=MATCH(_ERR_AND_WARN,",")
IF (_I<>-1)
_ANUM=NUMBER(SUBSTR(_ERR_AND_WARN,0,_I))
_ERR_AND_WARN=SUBSTR(_ERR_AND_WARN,_I+1)
ELSE
_ANUM=NUMBER(_ERR_AND_WARN) _ERR_AND_WARN=""
ENDIF
ENDIF
IF ( _ANUM==(-19) )
GOTOF _FEHL43
ENDIF
IF ( _ANUM==(-20) )
GOTOF _FEHL12
ENDIF
IF ( (_ANUM==(-1))OR(_ANUM==(-9))OR(_ANUM==(-10))OR(_ANUM==(-12))OR(_ANUM==(-15))OR(_ANUM==(-16))OR(_ANUM==3002)OR(_ANUM==3003)OR(_ANUM==3028)OR(_ANUM==3030)OR(_ANUM==3042)OR(_ANUM==3100) )
_SERR=<<_ANUM
GOTOF _FEHL11
ENDIF
IF ( (_ANUM==3103)OR(_ANUM==3104)OR(_ANUM==3106)OR(_ANUM==3108)OR(_ANUM==3126) )
_SERR=<<_ANUM
GOTOF _FEHL11
ENDIF
IF ( ((_ANUM>=3020)AND(_ANUM<=3026))OR((_ANUM>=3113)AND(_ANUM<=3115))OR((_ANUM>=3117)AND(_ANUM<=3119))OR((_ANUM>=3128)AND(_ANUM<=3132)) )
_SERR=<<_ANUM
GOTOF _FEHL11
ENDIF
IF ( (_ANUM==(-1000))OR(_ANUM==(-2000)) )
IF (_ANUM==(-1000))
_SERR=<<_SC_CONT_LAB1[ABS(_ANUM+1000)]
ELSE
_SERR=<<_SC_CONT_LAB2[ABS(_ANUM+2000)]
ENDIF
GOTOF _FEHL13
ENDIF
IF ( (_ANUM<(-1000))AND(_ANUM>(-3000)) )
IF (_ANUM<(-1000))AND(_ANUM>(-2000))
_SERR=<<_SC_CONT_LAB1[ABS(_ANUM+1000)]
ELSE
_SERR=<<_SC_CONT_LAB2[ABS(_ANUM+2000)]
ENDIF
GOTOF _FEHL13
ENDIF
IF ( (_ANUM==(-3000))OR(_ANUM==(-4000))OR(_ANUM==(-5000))OR(_ANUM==(-6000))OR(_CONT_ERR==(-1)) )
_I=RINDEX($P_INCOAP_S160[_S160NFWFC], "/")+1 _SERR=SUBSTR($P_INCOAP_S160[_S160NFWFC],_I)
IF (_SC_CONT_LAB1[0]<>"")
_SERR=_SERR<<", "<<_SC_CONT_LAB1[0]
ENDIF
GOTOF _FEHL14
ENDIF
IF ( ((_ANUM<(-3000))AND(_ANUM>(-4000)))OR((_ANUM<(-4000))AND(_ANUM>(-5000)))OR((_ANUM<(-5000))AND(_ANUM>(-6000)))OR((_ANUM<(-6000))AND(_ANUM>(-7000)))OR((_CONT_ERR<>(-1))AND(_CONT_ERR<>0)) )
IF ((_CONT_ERR<>(-1))AND(_CONT_ERR<>0))
_I=RINDEX($P_INCOAP_S160[_S160NFWFIC-1+_CONT_ERR], "/")+1 _SERR=SUBSTR($P_INCOAP_S160[_S160NFWFIC-1+_CONT_ERR],_I)
IF (_SC_CONT_LAB1[_CONT_ERR]<>"")
_SERR=_SERR<<", "<<_SC_CONT_LAB1[_CONT_ERR]
ENDIF
ELSE
_I=RINDEX($P_INCOAP_S160[_S160NFWFIC-1+ABS(_ANUM MOD 1000)], "/")+1 _SERR=SUBSTR($P_INCOAP_S160[_S160NFWFIC-1+ABS(_ANUM MOD 1000)],_I)
IF (_SC_CONT_LAB1[ABS(_ANUM MOD 1000)]<>"")
_SERR=_SERR<<", "<<_SC_CONT_LAB1[ABS(_ANUM MOD 1000)]
ENDIF
ENDIF
GOTOF _FEHL14
ENDIF
CASE (_ANUM) OF -2 GOTOF _FEHL3 3111 GOTOF _FEHL3 -6 GOTOF _FEHL15 -7 GOTOF _FEHL16 -13 GOTOF _FEHL17 3041 GOTOF _FEHL17 -5 GOTOF _FEHL18 3040 GOTOF _FEHL18
CASE (_ANUM) OF -14 GOTOF _FEHL19 -8 GOTOF _FEHL20 -11 GOTOF _FEHL21 3001 GOTOF _FEHL22 3011 GOTOF _FEHL23 3105 GOTOF _FEHL23 3120 GOTOF _FEHL23
CASE (_ANUM) OF 3027 GOTOF _FEHL24 3029 GOTOF _FEHL25 3101 GOTOF _FEHL26 3102 GOTOF _FEHL27 3107 GOTOF _FEHL28 3116 GOTOF _FEHL29 3124 GOTOF _FEHL30
CASE (_ANUM) OF 3133 GOTOF _FEHL31 3134 GOTOF _FEHL32 3313 GOTOF _FEHL33 3109 GOTOF _FEHL35 3127 GOTOF _FEHL41
IF ( (_ANUM<3200)OR(_ANUM>3299) )
_SERR=<<_ANUM
GOTOF _FEHL11
ENDIF
ENDWHILE
_SYNC:
IF (_HOST)
IF NOT(ISFILE(_ROU_PRG))
_SERR=<<_ROU_PRG
GOTOF _FEHL49
ENDIF
IF (_H_GMODE[2]==2)
_ZEILE[0]=REP("")
READ(_TEMP,_ROU_PRG,1,20,_ZEILE)
IF (_TEMP<>0)
_SERR=<<_TEMP
GOTOF _FEHL50
ENDIF
_STR[0]=REP("")
_STR[0]=";startpoint first axis :" _STR[1]=";startpoint second axis:"
FOR _I=0 TO 1
FOR _III=0 TO 20
_TEMP=MATCH(_ZEILE[_III],_STR[_I])
IF (_TEMP<>(-1))
GOTOF _M1
ENDIF
ENDFOR
_M1:
_TEMP=INDEX(_ZEILE[_III],":")
IF (_TEMP==-1)
_SERR=<<_TEMP
GOTOF _FEHL50
ENDIF
_ZEILE[_III]=SUBSTR(_ZEILE[_III],_TEMP+1)
_SC_POS[_I]=NUMBER(_ZEILE[_III])
ENDFOR
GOTOF _ENDE
ELSE
GOTOF _BOHR
ENDIF
ENDIF
IF ( (_INCOAP_I_0>=0)AND(_INCOAP_I_0<1000)AND(_H_GMODE[2]<>2) )
_BOHR:
IF (_H_VARI[2]==2)
CUST_TECHCYC(_UMODE)
ENDIF
IF ($P_GG[10]<2)
G[10]=2
ENDIF
CALL _ROU_PRG
IF ( (_PROGS<>"E_CP_")AND(_PROGS<>"F_CP_") )
G0 AX[_ZZ]=_RP
ENDIF
IF (_H_VARI[2]==2)
CUST_TECHCYC(_UMODE+1)
ENDIF
ENDIF
_ENDE:
IF (($SCS_FUNCTION_MASK_TECH_SET B_AND 'B1000') AND (_H_GMODE[2]<>2))
WHILE (ISFILE(_ROU_PRG))
DELETE(_TEMP,_ROU_PRG)
ENDWHILE
ENDIF
RET
_FEHL0: STOPRE
N706400 SETAL(61000)
RET
_FEHL1: STOPRE
N706401 SETAL(61212)
RET
_FEHL2: STOPRE
N706402 SETAL(61019,_SERR)
RET
_FEHL3: STOPRE
N706403 SETAL(61900)
RET
_FEHL4: STOPRE
N706404 SETAL(61901,_SERR)
RET
_FEHL5: STOPRE
N706405 SETAL(61012)
RET
_FEHL6: STOPRE
N706406 SETAL(61287)
RET
_FEHL7: STOPRE
N706407 SETAL(61002)
RET
_FEHL8: STOPRE
N706408 SETAL(61101)
RET
_FEHL9: STOPRE
N706409 SETAL(61154)
RET
_FEHL10: STOPRE
N706410 SETAL(61240)
RET
_FEHL11: STOPRE
N706411 SETAL(61920,_SERR)
RET
_FEHL12: STOPRE
N706412 SETAL(61006)
RET
_FEHL13: STOPRE
N706413 SETAL(61906,_SERR)
RET
_FEHL14: STOPRE
N706414 SETAL(61913,_SERR)
RET
_FEHL15: STOPRE
N706415 SETAL(61908)
RET
_FEHL16: STOPRE
N706416 SETAL(61907)
RET
_FEHL17: STOPRE
N706417 SETAL(61914)
RET
_FEHL18: STOPRE
N706418 SETAL(61915)
RET
_FEHL19: STOPRE
N706419 SETAL(61916)
RET
_FEHL20: STOPRE
N706420 SETAL(61519)
RET
_FEHL21: STOPRE
N706421 SETAL(61158)
RET
_FEHL22: STOPRE
N706422 SETAL(61930)
RET
_FEHL23: STOPRE
N706423 SETAL(61931)
RET
_FEHL24: STOPRE
N706424 SETAL(61932)
RET
_FEHL25: STOPRE
N706425 SETAL(61933)
RET
_FEHL26: STOPRE
N706426 SETAL(61934)
RET
_FEHL27: STOPRE
N706427 SETAL(61935)
RET
_FEHL28: STOPRE
N706428 SETAL(61936)
RET
_FEHL29: STOPRE
N706429 SETAL(61939)
RET
_FEHL30: STOPRE
N706431 SETAL(61943)
RET
_FEHL31: STOPRE
N706431 SETAL(61946)
RET
_FEHL32: STOPRE
N706432 SETAL(61947)
RET
_FEHL33: STOPRE
N706433 SETAL(61948)
RET
_FEHL34: STOPRE
N706434 SETAL(61949)
RET
_FEHL35: STOPRE
N706435 SETAL(61157)
RET
_FEHL36: STOPRE
N706436 SETAL(61102)
RET
_FEHL37: STOPRE
N706437 SETAL(61109)
RET
_FEHL38: STOPRE
N706438 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL39: STOPRE
N706439 SETAL(61003)
RET
_FEHL40: STOPRE
N706440 SETAL(61919)
RET
_FEHL41: STOPRE
N706441 SETAL(61945)
RET
_FEHL42: STOPRE
N706442 SETAL(61017,_SERR)
RET
_FEHL43: STOPRE
N706443 SETAL(61357)
RET
_FEHL44: STOPRE
N706444 SETAL(61343,_SERR)
RET
_FEHL45: STOPRE
N706445 SETAL(61042,_SERR)
RET
_FEHL46: STOPRE
N706446 SETAL(61044,_SERR)
RET
_FEHL47: STOPRE
N706447 SETAL(61029,_SERR)
RET
_FEHL48: STOPRE
N706448 SETAL(61051)
RET
RET
_FEHL49: STOPRE
N706449 SETAL(61032,_SERR)
RET
_FEHL50: STOPRE
N706450 SETAL(61038,_SERR)
RET
_FEHL51: STOPRE
N706451 SETAL(61028,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE70_SPF
PROC CYCLE70(REAL __RTP,REAL _RFP,REAL __SDIS,REAL __DP,REAL _DIATH,REAL _H1,REAL __FAL,REAL __PIT,INT _NT,REAL __MID,REAL __FFR,INT _TYPTH,REAL __PA,REAL __PO,REAL __NSP,INT __VARI,INT _PITA,STRING[15] _PITM,STRING[20] _PTAB,STRING[20] _PTABA,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.005 ;DATE: 2024-04-03
;Cycle support HMIsl
;Thread milling
DEF AXIS _X,_Y,_Z
DEF INT _VARI,_GG10
DEF INT _AMODE1,_DMODE1,_ERR=0,_ZZSD[9]
DEF INT _ANZG,_BA1,_BA10,_BA100,_DIR,_HX,_HZ,_IX,_IZ,_RIFX,_RIFZ,_SDIR,_MIRR,_WTYP
DEF INT _II,_ARTIS[16]
DEF REAL _DP,_DPR,_FAL,_FFR,_KDIAM,_MID,_NSP,_PA,_PO,_PIT,_RTP,_SDIS,_SDX
DEF REAL _ADX,_ADZ,_AGZ,_ANM,_ANR,_DIA,_DPA,_DPX,_DZ,_DZL,_DZLN,_EGZ,_EPZ,_FAK1,_FAK3,_FMA,_FMB,_HEX,_HH2,_NSPL,_NSPR,_NSPV,_RB,_RBM,_SDZ,_SPX,_SPY,_SPZ,_SKX,_SKZ,_WZR,_GAENGE,_REWIDZ,_ENDW,_EGR,_EGX,_EGY,_EPR,_EPX,_EPY
DEF STRING[30] _S_FMA,_S_FMB
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE70_MPF"
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE70_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE70("<<__RTP<<","<<_RFP<<","<<__SDIS<<","<<__DP<<","<<_DIATH<<","<<_H1<<","<<__FAL<<","<<__PIT<<","<<_NT<<","<<__MID<<","<<__FFR<<","<<_TYPTH<<","<<__PA<<","<<__PO<<","<<__NSP<<","<<__VARI<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_DP=__DP _FAL=ABS(__FAL) _FFR=__FFR _MID=__MID _PA=__PA _PO=__PO
_NSP=__NSP _PIT=__PIT _RTP=__RTP _SDIS=ABS(__SDIS) _VARI=ABS(__VARI) _SDX=_SDIS
_KDIAM=_H1
_RE_CYCFR=$P_CYCFRAME
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3) GOTOF _FEHL17
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
_PA=$P_EP[_X]*_FAK1 _PO=$P_EP[_Y]*_FAK1
ELSE
GOTOF _FEHL21
ENDIF
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
_AMODE1=_AMODE _DEC1
IF(_AMODE1<0)OR(_AMODE1>1) GOTOF _FEHL18
IF(_AMODE1==0)
_DPR=0
ELSE
_DPR=ABS(_DP)
_DP=0
ENDIF
_ZZSD[8]=_GMODE _DEC3
IF(_ZZSD[8]<0)OR(_ZZSD[8]>2) GOTOF _FEHL19
IF(_ZZSD[8]==2)
_ZZSD[8]=1
ELSE
_ZZSD[8]=0
ENDIF
_BA1=_VARI MOD 10 _BA10=TRUNC(_VARI/10) MOD 10 _BA100=TRUNC(_VARI/100) _SDIR=$P_SDIR[$P_MSNUM]
_MIRR=0
_MIRR=0
IF($P_ACTFRAME[_X,MI])
_MIRR=_MIRR B_OR 'B0001'
_MIRR=_MIRR B_XOR 'B1000'
ENDIF
IF($P_ACTFRAME[_Y,MI])
_MIRR=_MIRR B_OR 'B0010'
_MIRR=_MIRR B_XOR 'B1000'
ENDIF
IF($P_ACTFRAME[_Z,MI])
_MIRR=_MIRR B_OR 'B0100'
_MIRR=_MIRR B_XOR 'B1000'
ENDIF
IF($P_ACTFRAME[_X,SC]<>$P_ACTFRAME[_Y,SC]) GOTOF _FEHL12
_SKX=$P_ACTFRAME[_X,SC] _SKZ=$P_ACTFRAME[_Z,SC]
IF(_BA1<1)OR(_BA1>2)OR(_BA10<1)OR(_BA10>2)OR(_BA100>1) GOTOF _FEHL0
IF($P_TOOLNO==0) GOTOF _FEHL1
IF($P_TOOL==0) GOTOF _FEHL2
IF($P_TOOLR<=0) GOTOF _FEHL3
IF(_DIATH<=0) GOTOF _FEHL4
IF(_FFR<=0) GOTOF _FEHL5
IF(_TYPTH<0)OR(_TYPTH>1) GOTOF _FEHL6
IF(_PIT<=0) GOTOF _FEHL7
IF(_PITA<0)OR(_PITA>4) GOTOF _FEHL20
IF(_NT<=0) GOTOF _FEHL8
IF((_MID<=0) AND (_BA1<2)) GOTOF _FEHL10
IF(_SDX<=0) GOTOF _FEHL14
IF(_SDIR<3) OR (_SDIR>4) GOTOF _FEHL15
IF(_H1<=0)OR(2*_H1>=_DIATH) GOTOF _FEHL16
_KDIAM=_DIATH-2*_H1
IF(_PITA==2)
_PIT=$MN_SCALING_VALUE_INCH/_PIT
ENDIF
IF(_PITA==3)
_PIT=_PIT*$MN_SCALING_VALUE_INCH
ENDIF
IF(_PITA==4)
_PIT=_PIT*$PI
ENDIF
_PIT=_PIT*_FAK3
IF(_SC_TOOL_VALI[0]<>0)
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF(_ARTIS[0] MOD 10 <>1)
GOTOF _FEHL22
ENDIF
_II=_ARTIS[0] DIV 10
IF((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL22
ELSE
_ARTIS[11]=_II MOD 10
IF(_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF(_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL22
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
_MID=_MID/_SKX _FAL=_FAL/_SKX _PIT=_PIT/_SKZ _SDIS=_SDIS/_SKZ _SDX=_SDX/_SKX
_WZR=$P_TOOLR*_FAK1/_SKX
IF(_TYPTH==0)AND((2*_WZR)>=_KDIAM) GOTOF _FEHL9
IF(_MIRR B_AND 'B1000')
_BA100=1-_BA100
ENDIF
IF(_MIRR B_AND 'B0001')
_NSP=180-_NSP
ENDIF
IF(_MIRR B_AND 'B0010')
_NSP=-_NSP
ENDIF
IF(_BA100==0)
IF(_BA10==1)
_DIR=2
ELSE
_DIR=3
ENDIF
ELSE
IF(_BA10==1)
_DIR=3
ELSE
_DIR=2
ENDIF
ENDIF
IF(_DPR==0)GOTOF _MM1
IF(_RTP==_RFP)GOTOF _FEHL11
_RIFZ=(_RTP-_RFP)/ABS(_RTP-_RFP)
_HH2=_RFP-_RIFZ*_DPR
IF(_DP==0)GOTOF _MM0
IF(_DP==_HH2)GOTOF _MM1
_MM0: _DP=_HH2
_MM1: _HH2=_RTP-_RFP
IF(_RFP==_DP) GOTOF _RET
_RIFZ=(_RFP-_DP)/ABS(_RFP-_DP)
IF(_HH2==0)
_HH2=_SDIS*_RIFZ _RTP=_RFP+_SDIS*_RIFZ
ENDIF
IF(_HH2/ABS(_HH2)<>_RIFZ)GOTOF _FEHL11
_DZ=ABS(_RFP-_DP)
_DPX=(_DIATH-_KDIAM)/2
IF(_BA1==2)
_FAL=0 _MID=0
ENDIF
IF(_FAL>=_DPX) GOTOF _FEHL13
_DPA=_DPX-_FAL
IF(_MID>=_DPA)OR(_MID==0)
_MID=_DPA
ENDIF
_HX=_DPA/_MID+0.4999 _HEX=_DPA/_HX
IF(_TYPTH==0)
_RIFX=-1 _DIA=_KDIAM
ELSE
_RIFX=1 _DIA=_DIATH
ENDIF
_GAENGE=_DZ/_PIT
IF(_NT>1)OR(_HX>1)
_GAENGE=ROUND(_GAENGE+0.4999)
ENDIF
_DZL=_GAENGE*_PIT
IF(_DZ+_PIT/2>_DZL)
_DZL=_DZ+_PIT/2
ENDIF
IF(_NT>1)OR(_HX>1)
_DZL=ROUND(_DZL/_PIT+0.4999)*_PIT
ENDIF
_GAENGE=_DZL/_PIT
IF(_NT>1)
_HZ=ROUND(_GAENGE/_NT+0.4999)
_GAENGE=1
ELSE
_HZ=1
ENDIF
_ANZG=ROUND(_GAENGE-1+0.4999)
_REWIDZ=(_DZ/_PIT*360) MOD 360
IF(_BA10>1)
_NSPR=_REWIDZ
ELSE
_NSPR=(_REWIDZ-_DZL/_PIT*360) MOD 360
ENDIF
IF(_BA100==0)
_NSPR=-_NSPR
ENDIF
_NSPV=(_NSP+_NSPR) MOD 360
IF(_NSPV>180)
_NSPV=_NSPV-360
ENDIF
IF(_TYPTH==0)
IF(_SDX>(_DIA/2-_WZR))
_SDX=_DIA/2-_WZR
ENDIF
ENDIF
_SPX=_DIA/2+(_WZR+_SDX)*_RIFX _SPY=0
N10 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_PA*1/_FAK1,_Y,_PO*1/_FAK1)
N20 $P_CYCFRAME=$P_CYCFRAME:CRPL(0,_NSPV)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
SBLON
N30 G0 G40 G90 G[10]=_GG10 G9 AX[_Z]=_RTP
N40 G9 AX[_X]=_SPX AX[_Y]=_SPY
SBLOF
FOR _IX=1 TO _HX
_RB=_DIA/2+_IX*_HEX*(-_RIFX)
IF(_HX==1)
_RB=_DIA/2+(_DPX-_FAL)*(-_RIFX)
ENDIF
_RBM=_RB+_WZR*_RIFX
_ANR=(2*_WZR+_SDX+_IX*_HEX)/2
_ANM=_ANR-_WZR _ADZ=_ANM*_PIT/(2*_RBM)
IF(_TYPTH==0)
_FMB=_FFR*(_RB-_WZR*_SKX)/_RB
ELSE
_FMB=_FFR*_RBM/_RB
ENDIF
_FMA=_FMB
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FMA="G95 F"<<_FMA
_S_FMB="G95 F"<<_FMB
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==31)
_WTYP=$P_ADT[1]
IF(_WTYP<100)OR(_WTYP>199) GOTOF _FEHL23
_S_FMA="G95 FZ="<<_FMA
_S_FMB="G95 FZ="<<_FMB
ELSE
_S_FMA="G94 F"<<_FMA
_S_FMB="G94 F"<<_FMB
ENDIF
ENDIF
_ENDW=(_DZL/_PIT*360) MOD 360
IF(_DIR==2)
_ENDW=-_ENDW
ENDIF
_EGR=_RBM _EPR=_RBM+2*_ANM*_RIFX
_EGX=_EGR*COS(_ENDW) _EGY=_EGR*SIN(_ENDW)
_EPX=_EPR*COS(_ENDW) _EPY=_EPR*SIN(_ENDW)
FOR _IZ=0 TO _HZ-1
IF(_HX>1)OR(_HZ>0)
IF(_IX==1)AND(_IZ==0)
ENDIF
IF(_IX==_HX)AND(_IZ==_HZ-1)
WRTPR("TMP_BLK_END()")
ENDIF
ENDIF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[7])
ENDIF
IF(_NT==1)
IF(_BA10==1)
_AGZ=_DP+_DZL*_RIFZ _EGZ=_DP
_SPZ=_DP+(_DZL+_ADZ)*_RIFZ _EPZ=_DP-_ADZ*_RIFZ
ELSE
_AGZ=_DP _EGZ=_DP+_DZL*_RIFZ
_SPZ=_DP-_ADZ*_RIFZ _EPZ=_DP+(_DZL+_ADZ)*_RIFZ
ENDIF
ELSE
IF(_BA10==1)
_DZLN=(_IZ+1)*_NT*_PIT
_AGZ=_DP+(_PIT+_HZ*_NT*_PIT-_DZLN)*_RIFZ _EGZ=_DP+(_HZ*_NT*_PIT-_DZLN)*_RIFZ
_SPZ=_AGZ+_ADZ*_RIFZ _EPZ=_EGZ-_ADZ*_RIFZ
ELSE
_DZLN=_IZ*_NT*_PIT
_AGZ=_DP+_DZLN*_RIFZ _EGZ=_DP+(_PIT+_DZLN)*_RIFZ
_SPZ=_AGZ-_ADZ*_RIFZ _EPZ=_EGZ+_ADZ*_RIFZ
ENDIF
ENDIF
SBLON
N50 G0 G9 AX[_Z]=_SPZ
SBLOF
EXECSTRING(_S_FMA)
IF(_TYPTH==0)
IF(_DIR==2)
N60 G2 AX[_X]=_RBM AX[_Y]=0 AX[_Z]=_AGZ CR=_ANM
EXECSTRING(_S_FMB)
N62 AX[_X]=_EGX AX[_Y]=_EGY AX[_Z]=_EGZ IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_ANZG
EXECSTRING(_S_FMA)
SBLON
N64 G9 AX[_X]=_EPX AX[_Y]=_EPY AX[_Z]=_EPZ CR=_ANM
SBLOF
ELSE
N70 G3 AX[_X]=_RBM AX[_Y]=0 AX[_Z]=_AGZ CR=_ANM
EXECSTRING(_S_FMB)
N72 AX[_X]=_EGX AX[_Y]=_EGY AX[_Z]=_EGZ IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_ANZG
EXECSTRING(_S_FMA)
SBLON
N74 G9 AX[_X]=_EPX AX[_Y]=_EPY AX[_Z]=_EPZ CR=_ANM
SBLOF
ENDIF
ELSE
IF(_DIR==2)
N80 G3 AX[_X]=_RBM AX[_Y]=0 AX[_Z]=_AGZ CR=_ANM
EXECSTRING(_S_FMB)
N82 G2 AX[_X]=_EGX AX[_Y]=_EGY AX[_Z]=_EGZ IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_ANZG
EXECSTRING(_S_FMA)
SBLON
N84 G9 G3 AX[_X]=_EPX AX[_Y]=_EPY AX[_Z]=_EPZ CR=_ANM
SBLOF
ELSE
N90 G2 AX[_X]=_RBM AX[_Y]=0 AX[_Z]=_AGZ CR=_ANM
EXECSTRING(_S_FMB)
N92 G3 AX[_X]=_EGX AX[_Y]=_EGY AX[_Z]=_EGZ IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_ANZG
EXECSTRING(_S_FMA)
SBLON
N94 G9 G2 AX[_X]=_EPX AX[_Y]=_EPY AX[_Z]=_EPZ CR=_ANM
SBLOF
ENDIF
ENDIF
ENDFOR
ENDFOR
SBLON
N500 G0 G60 G90 AX[_Z]=_RTP
SBLOF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[8])
ENDIF
N550 $P_CYCFRAME=$P_CYCFRAME:CRPL(0,-_NSPV)
N560 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,-_PA*1/_FAK1,_Y,-_PO*1/_FAK1)
IF $P_MC
N600 AX[_X]=_PA AX[_Y]=_PO
ENDIF
_RET:
IF(_HX>1)OR(_HZ>0)
ENDIF
SBLON
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_X]=0
$AA_MEAS_POINT1[_Y]=0
$AA_MEAS_POINT1[_Z]=_RFP+_RIFZ*_SDIS
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_X])+POT($AA_MEAS_POINT2[_Y])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_Z,_RFP+_RIFZ*_SDIS)
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
$P_CYCFRAME=_RE_CYCFR
RET
;==================
_FEHL0: STOPRE
N707000 SETAL(61002)
RET
_FEHL1: STOPRE
N707001 SETAL(61009)
RET
_FEHL2: STOPRE
N707002 SETAL(61000)
RET
_FEHL3: STOPRE
N707003 SETAL(61117)
RET
_FEHL4: STOPRE
N707004 SETAL(61119)
RET
_FEHL5: STOPRE
N707005 SETAL(61003)
RET
_FEHL6: STOPRE
N707006 SETAL(61120)
RET
_FEHL7: STOPRE
N707007 SETAL(61001)
RET
_FEHL8: STOPRE
N707008 SETAL(61121)
RET
_FEHL9: STOPRE
N707009 SETAL(61105)
RET
_FEHL10: STOPRE
N707010 SETAL(61248)
RET
_FEHL11: STOPRE
N707011 SETAL(61101)
RET
_FEHL12: STOPRE
N707012 SETAL(61012)
RET
_FEHL13: STOPRE
N707013 SETAL(61010)
RET
_FEHL14: STOPRE
N707014 SETAL(61246)
RET
_FEHL15:STOPRE
N707015 SETAL(61102)
RET
_FEHL16:STOPRE
N707016 SETAL(61019," H1 ")
RET
_FEHL17: STOPRE
N707017 SETAL(61158)
RET
_FEHL18: STOPRE
N707018 SETAL(61019,"(_AMODE dec1)")
RET
_FEHL19: STOPRE
N707019 SETAL(61019,"(_GMODE dec3)")
RET
_FEHL20: STOPRE
N707020 SETAL(61019,"(_PITA)")
RET
_FEHL21: STOPRE
N707021 SETAL(61159)
RET
_FEHL22: STOPRE
N707022 SETAL(62106)
RET
_FEHL23: STOPRE
N707023 SETAL(61216)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE71_SPF
PROC CYCLE71(REAL _RTP,REAL _RFP,REAL _SDIS,REAL _DP,REAL _PA,REAL _PO,REAL _LENG,REAL _WID,REAL _STA,REAL _MID,REAL _MIDA,REAL _FDP,REAL _FALD,REAL _FFP1,INT _VARI,REAL _FDP1) SAVE SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Face milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_HY,_HZ,_IY,_IZ,_PMX,_PMXX,_PMY,_IS_CYCFR,_II,_ZZSD[2]
DEF REAL _APX,_APY,_AX1,_AX2,_AY,_DPA,_DPR,_DPZ,_FAK1,_HEY,_HEZ,_LX,_LX1,_LX2,_LY,_PMZ,_SDZ,_SKX,_SKY,_SKZ,_WZR,_WZX,_WZY,_XS,_YS
DEF INT _ARTIS[16]
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
_SDIS=ABS(_SDIS) _MID=ABS(_MID) _FALD=ABS(_FALD) _MIDA=ABS(_MIDA) _FDP=ABS(_FDP) _VARI=ABS(_VARI) _FDP1=ABS(_FDP1)
_ZZ=$P_AXN3
_VS1:
IF($P_TOOLNO==0) GOTOF _FEHL0
IF($P_TOOL==0) GOTOF _FEHL1
IF($P_TOOLR<=0) GOTOF _FEHL4
_BA1=_VARI MOD 10 _BA10=TRUNC(_VARI/10)
IF(_BA1<1) OR (_BA1>2) GOTOF _FEHL2
IF(_BA10<1) OR (_BA10>4) GOTOF _FEHL2
IF(_LENG==0) OR (_WID==0) GOTOF _FEHL5
IF(_FFP1<=0) GOTOF _FEHL8
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_IS_CYCFR=1
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
IF (((_VARI MOD 10 )- 1)<>_ARTIS[12]) AND (_ARTIS[11]<>1)
_ARTIS[0]=0 _ARTIS[11]=0
ENDIF
ENDIF
_SKZ=$P_ACTFRAME[_ZZ,SC]
_SDIS=_SDIS/_SKZ _MID=_MID/_SKZ _FALD=_FALD/_SKZ
_DPR=ABS(_RFP-_DP)
_PMZ=_RTP-_RFP
IF(_RFP==_DP) GOTOF _RET
IF(_RTP==_RFP) GOTOF _M1
IF(_PMZ/ABS(_PMZ) <> (_RFP-_DP)/_DPR) GOTOF _FEHL3
_M1: _PMZ=(_RFP-_DP)/_DPR
IF(_RFP==_RTP)
_RTP=_RFP+_SDIS*_PMZ
ENDIF
IF(_LENG>0)
_PMX=1
ELSE
_PMX=-1
ENDIF
IF(_WID>0)
_PMY=1
ELSE
_PMY=-1
ENDIF
IF(_BA10==1) OR (_BA10==3)
_XX=$P_AXN1 _YY=$P_AXN2
_APX=_PA _APY=_PO _LX=_LENG _LY=_WID
_PMXX=_PMX
ELSE
_XX=$P_AXN2 _YY=$P_AXN1
_APX=_PO _APY=_PA _LX=_WID _LY=_LENG
_PMXX=_PMY _PMY=_PMX _PMX=_PMXX
ENDIF
_SKX=$P_ACTFRAME[_XX,SC] _SKY=$P_ACTFRAME[_YY,SC]
IF(_SKX<>_SKY)AND(_STA<>0) GOTOF _FEHL9
_FDP=_FDP/_SKX _FDP1=_FDP1/_SKY _MIDA=_MIDA/_SKY
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_WZR=$P_TOOLR*_FAK1
_WZX=_WZR/_SKX _WZY=_WZR/_SKY
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL12
ENDIF
IF(_ZZSD[1]==0)
_SDZ=_SDIS
ELSE
_SDZ=0
ENDIF
IF(_FALD>=_DPR)
_FALD=_DPR _DPA=_DPR
ELSE
_DPA=_DPR-_FALD
ENDIF
IF(_MID) GOTOF _M3
_MID=_SDZ+_DPA
_M3: _HZ=(_SDZ+_DPA)/_MID+0.4999
IF _HZ==0
_HZ=1
ENDIF
_HEZ=(_SDZ+_DPA)/_HZ
IF(_HZ==1)
_HEZ=_DPA
ENDIF
IF(_BA1==2)
_HEZ=_FALD _HZ=1
ENDIF
IF(_MIDA>2*_WZY) AND (NOT(($P_TOOL==0))) GOTOF _FEHL7
IF(_MIDA==0)
_MIDA=0.8*2*_WZY
ENDIF
IF(ABS(_LY)+_FDP1>_MIDA)
_HY=(ABS(_LY)-_MIDA+_FDP1)/_MIDA+0.4999
_HEY=(ABS(_LY)-_MIDA+_FDP1)/_HY
ELSE
_HY=0 _HEY=0
ENDIF
_XS=-(_FDP+_WZX)*_PMX _YS=(_MIDA-_WZY)*_PMY
_AX1=-(_FDP+_WZX)*_PMX
IF (_IS_CYCFR==1)
N11 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_APX*1/_FAK1,_YY,_APY*1/_FAK1)
N13 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,_STA)
ELSE
N15 ATRANS AX[_XX]=_APX AX[_YY]=_APY
N20 AROT RPL=_STA
ENDIF
N25 SBLON
IF($P_EP[_ZZ]*_FAK1<_RTP)
N30 G0 G40 G90 G60 AX[_ZZ]=_RTP
ENDIF
N40 G0 G40 G90 G60 AX[_XX]=_XS AX[_YY]=_YS
N50 AX[_ZZ]=_RFP+_SDIS*_PMZ
N55 SBLOF
FOR _IZ=1 TO _HZ
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF (_BA1==1)AND(_HZ>1)
IF(_IZ==1)
ENDIF
IF(_IZ==_HZ)
ENDIF
ENDIF
_AY=_YS _PMXX=_PMX
IF(_BA1==2)
_AX2=-_FDP*_PMX-_WZX*_PMX
_LX1=ABS(_LX)+2*(_FDP+_WZX)
_LX2=ABS(_LX)+2*(_FDP+_WZX)
ELSE
IF(_BA10==1) OR (_BA10==2)
_AX2=-(_FDP+_WZX)*_PMX
_LX1=ABS(_LX)+_FDP+_WZX
ELSE
IF(_MIDA>_WZY)
_LX1=ABS(_LX)+_FDP+_WZX
_LX2=ABS(_LX)
ELSE
_LX1=ABS(_LX)+_FDP-_MIDA*_SKY/_SKX+2*_WZX
_LX2=ABS(_LX)+2*(_WZX-_MIDA*_SKY/_SKX)
ENDIF
IF(_HY==0)
_LX1=ABS(_LX)+_FDP+_WZX _LX2=ABS(_LX)+_FDP+_WZX
ENDIF
ENDIF
ENDIF
_DPZ=_DP+(_DPR+_SDZ-_IZ*_HEZ)*_PMZ
IF(_HZ==1)
_DPZ=_DP+_FALD*_PMZ
ENDIF
IF(_BA1==2)
_DPZ=_DP
ENDIF
N58 SBLON
N60 G0 G90 AX[_XX]=_AX1 AX[_YY]=_AY
IF(_BA10==3) OR (_BA10==4) GOTOF _MB2
_MB1:
FOR _IY=1 TO _HY+1
N70 G90 AX[_ZZ]=_DPZ
N75 SBLOF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N80 G1 G91 AX[_XX]=_LX1*_PMX F=_FFP1
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_IY<=_HY)
IF((_VARI==12)OR(_VARI==22))AND(_FALD==0)
N90 G0 G90 AX[_ZZ]=_RFP+_SDIS*_PMZ
ELSE
N100 G0 G91 AX[_ZZ]=(_HEZ+_SDIS)*_PMZ
ENDIF
_AY=_YS+_HEY*_IY*_PMY
N110 G0 G90 AX[_XX]=_AX2 AX[_YY]=_AY
ENDIF
ENDFOR
GOTOF _MABH
_MB2:
N120 G90 AX[_ZZ]=_DPZ
N125 SBLOF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
FOR _IY=1 TO _HY+1
N130 G1 G91 AX[_XX]=_LX1*_PMXX F=_FFP1
IF(_IY<=_HY)
_AY=_YS+_HEY*_IY*_PMY
IF(_BA1==2)
G00
ENDIF
N140 G90 AX[_YY]=_AY
_LX1=_LX2
_PMXX=-_PMXX
ENDIF
ENDFOR
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
_MABH:
IF(_IZ<_HZ)
N150 G0 G91 AX[_ZZ]=_SDIS*_PMZ
N155 SBLON
N160 G90 AX[_XX]=_AX1 AX[_YY]=_YS
N165 SBLOF
ENDIF
ENDFOR
_MRTP:
N165 SBLON
N170 G0 G90 AX[_ZZ]=_RTP
N175 SBLOF
_RET:
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
SBLON
IF (_IS_CYCFR==1)
N180 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,-_STA)
N185 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-_APX*1/_FAK1,_YY,-_APY*1/_FAK1)
ENDIF
RET
_FEHL0: STOPRE
N707100 SETAL(61009)
RET
_FEHL1: STOPRE
N707101 SETAL(61000)
RET
_FEHL2: STOPRE
N707102 SETAL(61002)
RET
_FEHL3: STOPRE
N707103 SETAL(61101)
RET
_FEHL4: STOPRE
N707104 SETAL(61117)
RET
_FEHL5: STOPRE
N707105 SETAL(61118)
RET
_FEHL7: STOPRE
N707107 SETAL(61111)
RET
_FEHL8: STOPRE
N707108 SETAL(61003)
RET
_FEHL9: STOPRE
N707109 SETAL(61012)
RET
_FEHL10: STOPRE
N707110 SETAL(61124)
RET
_FEHL11:
N707111 SETAL(62106)
RET
_FEHL12: STOPRE
N707112 SETAL(61156)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE72_SPF
PROC CYCLE72(STRING[141] _KNAME,REAL _RTP,REAL _RFP,REAL _SDIS,REAL _DP,REAL _MID,REAL _FAL,REAL _FALD,REAL _FFP1,REAL _FFD,INT _VARI,INT _RL,INT _AS1,REAL __LP1,REAL _FF3,INT _AS2,REAL __LP2,INT _UMODE,REAL _FS, REAL _ZFS,INT _GMODE,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.002 ;DATE: 2023-09-06
;Cycle support HMIsl
;Contour milling
; Fehlerhandling mit ACTBLOCNO
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_BA100,_HZ,_IZ,_AS11,_GZW,_G15T,_G15K,_H8,_SPIND,_H10,_H11,_P49=0,_BACK,_I,_I_MAX,_Z1,_Z2,_ERR,_FFD_TYPE,_WTYP
DEF INT _ERROR,II,IH1,IH2,_II,_VARI1,_VARI7,_ZZSD[15],_ARTIS[16],_TEMP,_DMODE1,_DMODE4,_AMODE1,_AMODE3,_GG10,_HELIKAL,_FRK,_LOG_ON=0
DEF REAL _LP1,_LP2
DEF REAL _HEZ,_DIS1,_DIS2,_DPA,_DPR,_DPZ,_FAK1,_FAK2,_PMZ,_SDZ,_WEZ,_OFFN,_OFFN1,_XXS,_YYS,_XAP=0,_YAP=0,_ALPHA,_L,_VORZ,_WR,_SKF,_SKF1,_SKF2
DEF REAL _RDF=0,_LPM=0.001,_LPI=0.0001,_EPS,_RADIUS,_OEW,_DIR,_VECT1[2],_VECT2[2]
DEF REAL _KTS[600,6],_KTL[600]
DEF STRING[32] _SLA,_SLE
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE72_MPF",_LOG_FILE
DEF STRING[100] _PNAME
DEF STRING[200] _CMD
DEF STRING[250] _SERR
DEF STRING[30] _S_FFP1,_S_FFD,_S_FF3
DEF STRING[35] _PROG
DEF BOOL _ZV[2], _SOWZ,_PENDELN
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE72_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<< _ZSD[1]<<" _ZSD[3]="<<_ZSD[3]<<" _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"CYCLE72("<<_KNAME<<","<<_RTP<<","<<_RFP<<","<<_SDIS<<","<<_DP<<","<<_MID<<","<<_FAL<<","<<_FALD<<","<<_FFP1<<","<<_FFD<<","<<_VARI<<","<<_RL<<","<<_AS1<<","<<__LP1<<","<<_FF3<<","<<_AS2<<","<<__LP2<<","<<_UMODE<<","<<_FS<<","<<_ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE72_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_TEMP,_LOG_FILE)
WRITE(_TEMP,_LOG_FILE,"-------------------")
WRITE(_TEMP,_LOG_FILE,"Logfile CYCLE72: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
DIAMCYCOF
IF ((($P_GG[30]>1)AND($P_GG[30]<>6))AND((_RL==41)OR(_RL==42)))
COMPOF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_EPS=1/$MN_INT_INCR_PER_MM
IF ( ($P_GG[13]==1)OR($P_GG[13]==3) )
_EPS=_EPS/10
ENDIF
_LP1=__LP1 _LP2=__LP2
_LP1=ABS(_LP1) _LP2=ABS(_LP2)
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL21
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_OFFN1=$P_OFFN*_FAK2
_VARI1=_VARI _DEC1
IF(_VARI1 == 5)
_AMODE3=_AMODE _DEC3
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(_RTP==_RFP) GOTOF _FEHL3
_PMZ=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_ZFS)*_PMZ
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
IF (_RFP<>_DP)
_PMZ=(_RFP-_DP)/ABS(_RFP-_DP)
ENDIF
_ZFS=ABS(_RFP-_ZFS) _AMODE3=1
ENDIF
_DPR=ABS(_ZFS)
IF (_RTP<>_RFP) AND (_RFP<>_DP)
IF ((_RFP-_DP)/ABS(_RFP-_DP))<>((_RTP-_RFP)/ABS(_RTP-_RFP)) GOTOF _FEHL3
ELSE
ENDIF
IF(_ZZSD[1]==0)
_MID=ABS(_ZFS)+ABS(_SDIS)
ELSE
_MID=ABS(_ZFS)
ENDIF
_FALD=0 _FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_OFFN=$P_OFFN*_FAK2 _VARI=_VARI-3
ENDIF
IF(_FFP1<=0) GOTOF _FEHL7
IF(_FF3<=0)
_FF3=_FFP1
ENDIF
IF(_FFD<=0)
_FFD=_FFP1
ENDIF
IF(_FF3==0)OR((_VARI _DEC3)==3)
_FF3=_FFP1
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
G95 F=_FFP1
_S_FF3 ="G95 F"<<_FF3
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL32
ENDIF
_S_FFP1="G95 FZ="<<_FFP1
G95 FZ=_FFP1
_S_FF3 ="G95 FZ="<<_FF3
ELSE
_S_FFP1="G94 F"<<_FFP1
G94 F=_FFP1
_S_FF3 ="G94 F"<<_FF3
ENDIF
ENDIF
IF(_DMODE _DEC2 == 0)
IF(_ZSD[3]==-1)OR(_ZSD[3]==0)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=1
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ELSE
IF(_DMODE _DEC2 == 1)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=11
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ENDIF
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_S_FFD="G95 F"<<_FFD
ELSE
IF(_FFD_TYPE==11)OR(_FFD_TYPE==33)
_S_FFD="G95 FZ="<<_FFD
_WTYP=$P_ADT[1]
IF NOT(((_WTYP<300)AND(_WTYP>199))AND((_AS1 _DEC2==1)AND(_AS2 _DEC2==1)))
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL32
ENDIF
ENDIF
IF ((_AS1 _DEC2<>1)OR(_AS2 _DEC2<>1))
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL32
ENDIF
IF((_WTYP>99)AND(_WTYP<200)AND(_SC_TEETH==0)) GOTOF _FEHL31
ENDIF
ELSE
_S_FFD="G94 F"<<_FFD
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_TEMP,_LOG_FILE,"Vorschbe:")
WRITE(_TEMP,_LOG_FILE,";_S_FFP1="<<_S_FFP1)
WRITE(_TEMP,_LOG_FILE,";_S_FFD="<<_S_FFD)
WRITE(_TEMP,_LOG_FILE,";_S_FF3="<<_S_FF3)
ENDIF
_DMODE4=_DMODE _DEC4
IF ((_DMODE4<0) OR (_DMODE4>1)) GOTOF _FEHL19
IF (((_KNAME<>"") AND (_DMODE4==1)) OR ((_KNAME=="") AND (_DMODE4==0))) GOTOF _FEHL25
IF (_DMODE4==1) GOTOF _CONTNEW62
IH2=STRLEN(_KNAME) IH1=0
FOR II=0 TO IH2
IF SUBSTR(_KNAME,II,1)==":"
IF IH1<>0
GOTOF _M5201
ENDIF
IH1=II
ENDIF
ENDFOR
_M5201:
IF IH1==0 GOTOF _M5202
IF (IH1<>0) AND (II==STRLEN(_KNAME))
_SLA=SUBSTR(_KNAME,0,IH1) _SLE=SUBSTR(_KNAME,IH1+1,IH2-IH1-1)
ELSE
_PNAME=SUBSTR(_KNAME,0,IH1)
_SLA=SUBSTR(_KNAME,IH1+1,II-IH1-1)
_SLE=SUBSTR(_KNAME,II+1,STRLEN(_KNAME)-II-1)
ENDIF
_M5202: GOTOF _ENDCONTNEW
_CONTNEW62:
IF ISVAR("_SC_LAST_CONT")
IF (_SC_LAST_CONT>1)
GOTOF _FEHL9
ELSE
IF (_SC_LAST_CONT<1) GOTOF _FEHL16
IF (STRLEN(_SC_CONT_NAME[_SC_LAST_CONT-1])>100)
_SERR=<<_SC_CONT_NAME[_SC_LAST_CONT-1]
GOTOF _FEHL33
ENDIF
_PNAME=_SC_CONT_NAME[_SC_LAST_CONT-1]
_SLA=_SC_CONT_LAB1[_SC_LAST_CONT-1]
_SLE=_SC_CONT_LAB2[_SC_LAST_CONT-1]
ENDIF
_SC_FIRST_CONT=0
ELSE
ENDIF
_ENDCONTNEW:
IF ISVAR("_SC_FIRST_CONT")
_SC_FIRST_CONT=0
ENDIF
_SDIS=ABS(_SDIS) _MID=ABS(_MID) _FALD=ABS(_FALD) _RL=ABS(_RL) _AS1=ABS(_AS1) _AS2=ABS(_AS2) _VARI=ABS(_VARI)
_DMODE1=_DMODE _DEC1
IF((_DMODE1>0)AND(_DMODE1<4))
G[6]=_DMODE1
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL15
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL15
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL15
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
IF($P_ACTFRAME[_ZZ,SC]<>1) GOTOF _FEHL10
IF(_AS1 MOD 10 <> 4)
IF(_LP1==0)
IF($P_GG[13]==2)OR($P_GG[13]==4)
_LP1=_LPM
ELSE
_LP1=_LPI
ENDIF
ENDIF
IF(_LP2==0)
IF($P_GG[13]==2)OR($P_GG[13]==4)
_LP2=_LPM
ELSE
_LP2=_LPI
ENDIF
ENDIF
ENDIF
IF(_RL==40)AND(_AS1 MOD 10 == 1)
_LP1=_LP1+$P_TOOLR*_FAK1 _LP2=_LP2+$P_TOOLR*_FAK1
ENDIF
IF($P_TOOLNO==0) GOTOF _FEHL0
IF($P_TOOL==0) GOTOF _FEHL1
_WR=($P_TOOLR*_FAK1+_OFFN)
IF(_ZZSD[8]==0)
IF((_AS1 MOD 10 == 2)OR(_AS1 == 3))AND(_LP1<=(-_WR)) GOTOF _FEHL17
IF((_AS2 MOD 10 == 2)OR(_AS2 == 3))AND(_LP2<=(-_WR)) GOTOF _FEHL18
ENDIF
_SOWZ=FALSE
_BA1=_VARI _DEC1
_BA10=(_VARI _DEC2) _BA100=(_VARI _DEC3)
_SPIND=(_VARI _DEC4)
_BACK=(_VARI _DEC5)
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL27
_VARI7=(_VARI _DEC7)
IF ( (_HELIKAL==1)AND(_VARI7<>0) )
IF (_VARI7==1)
_HELIKAL=2
ELSE
_HELIKAL=3
ENDIF
ENDIF
IF ( (_HELIKAL>0)AND(_VARI1==5) ) GOTOF _FEHL2
IF(_BA1<1)OR(_BA1>5)OR(_BA1==3)OR(_BA1==4)OR(_BA100>3)OR(_SPIND>4)OR(_BACK>1) GOTOF _FEHL2
_STCCMA:
_H8=$P_TRAFO
IF ((_SPIND==2) AND (_H8 B_AND 'H1300') ) GOTOF _FEHL2
IF(_RL<40) OR (_RL>42) GOTOF _FEHL4
_AS11=_AS1 MOD 10
IF((_AS11<1)OR(_AS11>4))AND(_HELIKAL==0) GOTOF _FEHL5
IF(_AS11<4)AND(_AS2 MOD 10 >3) GOTOF _FEHL5
IF(_RL==40)AND((_AS11==2)OR(_AS11==3)) GOTOF _FEHL5
IF(_AS11==4)AND(_RL<>40) GOTOF _FEHL11
IF(TRUNC(_AS1/10)>1) GOTOF _FEHL5
IF(_AS11<4)
IF(TRUNC(_AS2/10)>1) GOTOF _FEHL5
IF(_AS2==10)OR(_AS2 MOD 10 > 3) GOTOF _FEHL5
IF(_AS2==0)
_AS2=_AS1 _LP2=_LP1
ENDIF
IF(_RL==40)AND(_AS2 MOD 10 >1) GOTOF _FEHL5
ENDIF
IF(_RL==40)AND(_VARI MOD 10 == 1)
_FAL=0
ENDIF
IF(_VARI1<>5)
IF(_RTP<>_RFP)
_PMZ=(_RTP-_RFP)/ABS(_RTP-_RFP)
ELSE
IF (_RTP==_RFP) AND (_RFP==_DP) GOTOF _FEHL3
ENDIF
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>1) GOTOF _FEHL24
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL29
IF(_AMODE1==1)
_DP=ABS(_DP)
IF _DP
_DPR=ABS(_DP)
_DP=_RFP-_DP*_PMZ
ELSE
GOTOF _FEHL30
ENDIF
ELSE
_DPR=ABS(_RFP-_DP)
IF (_RFP<>_DP)
_PMZ= (_RFP-_DP)/ABS(_RFP-_DP)
ENDIF
ENDIF
IF (_RFP<>_DP) AND (_RTP<>_RFP)
IF (_RTP-_RFP)/ABS(_RTP-_RFP) <> (_RFP-_DP)/ABS(_RFP-_DP) GOTOF _FEHL3
ENDIF
ENDIF
IF(_RFP==_DP) GOTOF _RET
IF(_RFP==_RTP)
_RTP=_RFP+_SDIS*_PMZ
ENDIF
IF(_PMZ==1)
IF((_RFP+_SDIS) > _RTP) GOTOF _FEHL12
ELSE
IF((_RFP-_SDIS) < _RTP) GOTOF _FEHL12
ENDIF
IF($P_EP[_ZZ]*_FAK1<_RTP)AND(_ZZSD[8]==0)AND(_AS1>0)
N4 SBLON
N5 G0 G90 AX[_ZZ]=_RTP
N6 SBLOF
ENDIF
IF(_ZZSD[1]==0)
_SDZ=_SDIS
ELSE
_SDZ=0
ENDIF
IF(_BA1==2)
_FALD=0 _FAL=0
ENDIF
IF(_FALD>=_DPR) GOTOF _FEHL8
_DPA=_DPR-_FALD
IF(_MID>=_DPA)OR(_MID==0)
_MID=_DPA+_SDZ
ENDIF
_HZ=(_DPA+_SDZ)/_MID+0.4999
_HEZ=(_DPA+_SDZ)/_HZ
_ZV[1]=0 _G15T=3
IF ((_ZSD[3])AND($P_GG[15]==3))OR((_ZSD[3]==0)AND($P_GG[15]==2) OR ($P_GG[15]==8))
_ZV[1]=1 _G15T=2
ENDIF
IF(_AS11==4)OR(_BACK)OR(_ZZSD[8]==1)OR(_HELIKAL>0)
IF($P_GG[49]==3)
CP
_P49=3
ENDIF
IF($P_GG[7]>1)
_FRK=$P_GG[7]
G40
ENDIF
IF ($AN_NCK_VERSION<510300)OR(_BACK)
N398 CONTDCON(_KTS)
ELSE
N399 CONTDCON(_KTS,1)
ENDIF
IF ((_PNAME=="") AND (_SLA=="") AND (_SLE==""))
N400 CALL _KNAME
ELSE
IF (_PNAME=="")
N402 CALL $P_PROG[$P_STACK-1] BLOCK _SLA TO _SLE
ELSE
IF ((_SLA=="") AND (_SLE==""))
N404 CALL _PNAME
ELSE
N405 CALL _PNAME BLOCK _SLA TO _SLE
ENDIF
ENDIF
ENDIF
N406 EXECUTE(_ERROR)
IF(_ERROR)GOTOF _FEHL14
IF(_FRK>1)
G[7]=_FRK
ENDIF
IF(_P49==3)
PTPG0
ENDIF
ENDIF
IF(_ZZSD[8]==1)
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL34
_SKF1=$P_ACTFRAME[_XX,SC]
_SKF2=$P_ACTFRAME[_YY,SC]
_SKF=MINVAL(_SKF1,_SKF2)
_WR=($P_TOOLR*_FAK1)/_SKF+_OFFN
_LP1=_LP1/_SKF
_FAL=_FAL/_SKF
IF(NOT _BACK)
_Z1=1 _Z2=_Z1+1
_XXS=_KTS[_Z1,1] _YYS=_KTS[_Z1,2]
IF((_KTS[_Z2,0]MOD 10)<=1)
_ALPHA=ATAN2(_KTS[_Z2,2]-_KTS[_Z1,2],_KTS[_Z2,1]-_KTS[_Z1,1])
ELSE
_ALPHA=ATAN2(_KTS[_Z2,4]-_KTS[_Z1,2],_KTS[_Z2,3]-_KTS[_Z1,1])
IF((_KTS[_Z2,0]MOD 10)==2)
_ALPHA=_ALPHA+90
ELSE
_ALPHA=_ALPHA-90
ENDIF
ENDIF
ELSE
_Z1=_KTS[0,5] _Z2=_Z1-1
_XXS=_KTS[_KTS[0,5],1] _YYS=_KTS[_KTS[0,5],2]
IF((_KTS[_Z1,0]MOD 10)<=1)
_ALPHA=ATAN2(_KTS[_Z2,2]-_KTS[_Z1,2],_KTS[_Z2,1]-_KTS[_Z1,1])
ELSE
_ALPHA=ATAN2(_KTS[_Z1,4]-_KTS[_Z1,2],_KTS[_Z1,3]-_KTS[_Z1,1])
IF((_KTS[_Z1,0]MOD 10)==2)
_ALPHA=_ALPHA-90
ELSE
_ALPHA=_ALPHA+90
ENDIF
ENDIF
ENDIF
IF(_AS11==4)
_XAP=_XXS
_YAP=_YYS
ELSE
IF(_RL==40)
_XAP=_XXS-_LP1*COS(_ALPHA)
_YAP=_YYS-_LP1*SIN(_ALPHA)
ELSE
IF(_RL==41)
_VORZ=1
ELSE
_VORZ=-1
ENDIF
IF((_AS1 MOD 10)==3)
_XAP=_XXS-_VORZ*(_WR+_FAL+2*_LP1)*SIN(_ALPHA)
_YAP=_YYS+_VORZ*(_WR+_FAL+2*_LP1)*COS(_ALPHA)
ELSE
IF((_AS1 MOD 10)==1)
_XAP=_XXS-(_LP1+_WR)*COS(_ALPHA)-_VORZ*(_WR+_FAL)*SIN(_ALPHA)
_YAP=_YYS-(_LP1+_WR)*SIN(_ALPHA)+_VORZ*(_WR+_FAL)*COS(_ALPHA)
ELSE
_XAP=_XXS-_VORZ*(_WR+_FAL+_LP1)*SIN(_ALPHA)-_LP1*COS(_ALPHA)
_YAP=_YYS+_VORZ*(_WR+_FAL+_LP1)*COS(_ALPHA)-_LP1*SIN(_ALPHA)
ENDIF
ENDIF
ENDIF
ENDIF
GOTOF _M_ST_POS
ENDIF
IF(_AS11==4)
IF(_ZZSD[3]==1)
IF(_G15T==3)
_G15K=2
ELSE
_G15K=3
ENDIF
ELSE
_G15K=_G15T
ENDIF
IF(NOT _BACK)
_XXS=_KTS[1,1] _YYS=_KTS[1,2]
ELSE
_XXS=_KTS[_KTS[0,5],1] _YYS=_KTS[_KTS[0,5],2]
ENDIF
ENDIF
IF(_SPIND==2)
N410 CUST_TECHCYC(3+_UMODE)
_H11=1
ENDIF
IF(_SPIND==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
IF(_HELIKAL>0)
IF(_LOG_ON)
WRITE(_TEMP,_LOG_FILE,"Helikale Bearbeitung:")
WRITE(_TEMP,_LOG_FILE,"_HELIKAL="<<_HELIKAL)
WRITE(_TEMP,_LOG_FILE,"Konturtabelle:")
ENDIF
_I_MAX=_KTS[0,5]
IF(_HELIKAL==1)
_HZ=_HZ+1
ENDIF
IF(_HELIKAL==3)
_HZ=1
_KTL[0]=1
GOTOF _NOTIEF
ENDIF
_KTL[0]=0
FOR _I=0 TO _I_MAX
_OEW=0 _DIR=0
IF((_KTS[_I,0] MOD 10)>0)AND(_I>1)
_KTL[_I]=SQRT(POT(_KTS[_I,1]-_KTS[_I-1,1])+POT(_KTS[_I,2]-_KTS[_I-1,2]))
IF((_KTS[_I,0] MOD 10)==2)OR((_KTS[_I,0] MOD 10)==3)
_RADIUS=SQRT(POT(_KTS[_I,1]-_KTS[_I,3])+POT(_KTS[_I,2]-_KTS[_I,4]))
IF(_KTL[_I]==0)
_OEW=360
_KTL[_I]=_RADIUS*2*$PI
ELSE
_OEW=2*ASIN(_KTL[_I]/(_RADIUS*2))
IF(_RADIUS>0)
_VECT1[0]=(_KTS[_I-1,1]-_KTS[_I,3])/_RADIUS
_VECT1[1]=(_KTS[_I-1,2]-_KTS[_I,4])/_RADIUS
_VECT2[0]=(_KTS[_I,1]-_KTS[_I,3])/_RADIUS
_VECT2[1]=(_KTS[_I,2]-_KTS[_I,4])/_RADIUS
_DIR=ASIN(_VECT1[0]*_VECT2[1]-_VECT1[1]*_VECT2[0])
IF (_DIR<>0)
_DIR=_DIR/ABS(_DIR)
ENDIF
IF((_DIR<0)AND((_KTS[_I,0] MOD 10)==3))OR((_DIR>0)AND((_KTS[_I,0] MOD 10)==2))
_OEW=360-_OEW
ENDIF
ENDIF
_KTL[_I]=_RADIUS*2*$PI*_OEW/360
ENDIF
ENDIF
_KTL[0]=_KTL[0]+_KTL[_I]
ENDIF
IF(_LOG_ON)
IF((_KTS[_I,0] MOD 10)==2)OR((_KTS[_I,0] MOD 10)==3)
WRITE(_TEMP,_LOG_FILE,"I="<<_I<<" G"<<_KTS[_I,0] MOD 10<<" "<<_KTS[_I,1]<<" "<<_KTS[_I,2]<<" "<<_KTS[_I,3]<<" "<<_KTS[_I,4]<<" F="<<_KTS[_I,5]<<" L="<<ROUND(100*_KTL[_I])/100<<" DIR="<<_DIR<<" OEW="<<ROUND(100*_OEW)/100)
ELSE
WRITE(_TEMP,_LOG_FILE,"I="<<_I<<" G"<<_KTS[_I,0] MOD 10<<" "<<_KTS[_I,1]<<" "<<_KTS[_I,2]<<" "<<_KTS[_I,3]<<" "<<_KTS[_I,4]<<" F="<<_KTS[_I,5]<<" L="<<ROUND(100*_KTL[_I])/100)
ENDIF
ENDIF
ENDFOR
_NOTIEF:
IF(_PENDELN==0)
IF ($P_EXTBUF[$P_STACK-1]=="")
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
ELSE
_PROG=SUBSTR($P_EXTBUF[$P_STACK-1],3,STRLEN($P_EXTBUF[$P_STACK-1])-7)
ENDIF
IF((_PROG=="CYCLE76")OR(_PROG=="CYCLE77")OR(_PROG=="SLOT1")OR(_PROG=="SLOT2")OR(_PROG=="POCKET3"))
GOTOF _NOPEN
ENDIF
IF(ABS(SQRT(POT(_KTS[_I_MAX,1]-_KTS[1,1])+POT(_KTS[_I_MAX,2]-_KTS[1,2])))>_EPS)
_PENDELN=1
ENDIF
_NOPEN:
ENDIF
IF(_LOG_ON)
WRITE(_TEMP,_LOG_FILE,"PENDELN="<<_PENDELN<<" HZ="<<_HZ<<" HEZ="<<_HEZ<<" LGES="<<ROUND(100*_KTL[0])/100)
WRITE(_TEMP,_LOG_FILE,"EPS="<<_EPS<<" PROG="<<_PROG)
ENDIF
ENDIF
FOR _IZ=1 TO _HZ
IF _SOWZ==TRUE
_IZ=_HZ
ENDIF
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF(_BA1==1)AND(_HZ>1)
IF(_IZ==1)
ENDIF
IF(_IZ==_HZ)
ENDIF
ENDIF
IF(_BA10==0)
_GZW=1
N430 G0 G90 G[10]=_GG10
ELSE
_GZW=2
EXECSTRING(_S_FF3)
N435 G1 G90 G[10]=_GG10
ENDIF
_DPZ=_DP+(_DPR+_SDZ-_IZ*_HEZ)*_PMZ
IF(_HELIKAL>0)AND((_IZ==1)OR(_IZ==_HZ))
_DPZ=_DP+(_DPR+_SDZ-(_IZ-1)*_HEZ)*_PMZ
ENDIF
IF _ZZSD[1]==0
_DIS1=_HEZ*_PMZ
ELSE
_DIS1=(_HEZ+_SDIS)*_PMZ
ENDIF
IF(ABS(_DIS1)>ABS(_RTP-_DPZ))
_DIS1=ABS(_RTP-_DPZ)*_PMZ
ENDIF
IF(_IZ>1)
IF(_BA100==1)
IF(_PMZ==1)
IF((_DPZ+_DIS1)>(_RFP+_SDIS*_PMZ))
_DIS1=((_RFP+_SDIS*_PMZ)-_DPZ)
ENDIF
ELSE
IF((_DPZ+_DIS1)<(_RFP+_SDIS*_PMZ))
_DIS1=((_RFP+_SDIS*_PMZ)-_DPZ)
ENDIF
ENDIF
ENDIF
IF(_BA100==3)
_DIS1=_HEZ*_PMZ
ENDIF
ENDIF
IF(_AS11<>4)
IF(_BA1==1) AND (_RL<>40)
CFTCP
ENDIF
IF (($P_GG[1]==1)AND($P_GG[49]==3)AND($P_TRAFO B_AND 'H1100')AND(_IZ>1)AND(_HELIKAL==0))
IF(_RL==40)
_XAP=$P_APR[_XX]
_YAP=$P_APR[_YY]
ELSE
IF((_AS1 MOD 10)==3)
_L=(_WR+_FAL)/(2*(_FAL+_LP1+_WR))
_XAP=$P_APR[_XX]-($P_APR[_XX]-$P_AEP[_XX])*_L
_YAP=$P_APR[_YY]-($P_APR[_YY]-$P_AEP[_YY])*_L
ELSE
IF(_RL==41)
_VORZ=1
ELSE
_VORZ=-1
ENDIF
IF((_AS1 MOD 10)==1)
_ALPHA=ATAN2(($P_APR[_YY]-$P_AEP[_YY]),($P_APR[_XX]-$P_AEP[_XX]))
_XAP=$P_APR[_XX]+(_WR+_FAL)*SIN(_ALPHA)*_VORZ
_YAP=$P_APR[_YY]-(_WR+_FAL)*COS(_ALPHA)*_VORZ
ELSE
_ALPHA=ATAN2(($P_APR[_YY]-$P_AEP[_YY]),($P_APR[_XX]-$P_AEP[_XX]))
_XAP=$P_APR[_XX]-(_WR+_FAL)*SIN(45-_ALPHA*_VORZ)
_YAP=$P_APR[_YY]-(_WR+_FAL)*COS(45-_ALPHA*_VORZ)*_VORZ
ENDIF
ENDIF
ENDIF
N21 G0 AX[_XX]=_XAP AX[_YY]=_YAP
ENDIF
IF(_RL==40)
N18 _CMD="G140 G40"
GOTOF _MAN
ELSE
IF(_BA1==1)
N19 OFFN=_OFFN1+_FAL
ENDIF
NORM
IF(_RL==41)
N20 _CMD="G140 G41"
ELSE
N30 _CMD="G140 G42"
ENDIF
ENDIF
_MAN:
_CMD="N35 "<<_CMD<<" G34"<<1-(_AS1 _DEC2)
_CMD=_CMD<<" G"<<_AS1 _DEC1<<"47"
_CMD=_CMD<<" AX[_ZZ]="<<_DPZ<<" DISR="<<_LP1<<" DISCL="<<_DIS1
_CMD=_CMD<<" "<<_S_FFP1
IF(_AS1 _DEC2 == 0)
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_CMD=_CMD<<" FAD=PR("<<_FFD<<")"
ELSE
IF(_FFD_TYPE==0)OR(_FFD_TYPE==2)
_CMD=_CMD<<" FAD=PM("<<_FFD<<")"
ELSE
IF(_SC_TEETH==0) GOTOF _FEHL31
_CMD=_CMD<<" FAD=PZ("<<_FFD<<")"
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
;WRITE(_TEMP,_LOG_FILE,";Anfahren: "<<_CMD)
ENDIF
N32 SBLON
IF(_HELIKAL>0)AND((_IZ>1)OR(_AS1==0)) GOTOF _NEXT1
N35 EXECSTRING(_CMD)
_NEXT1:
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N34 SBLOF
IF(NOT _BACK)
IF(_HELIKAL>0) GOTOF _FORTH_1
IF ((_PNAME=="") AND (_SLA=="") AND (_SLE==""))
N91 CALL _KNAME
ELSE
IF (_PNAME=="")
N92 CALL $P_PROG[$P_STACK-1] BLOCK _SLA TO _SLE
ELSE
IF ((_SLA=="") AND (_SLE==""))
N93 CALL _PNAME
ELSE
N93 CALL _PNAME BLOCK _SLA TO _SLE
ENDIF
ENDIF
ENDIF
GOTOF _FORTH_2
_FORTH_1:
_I_MAX=_KTS[0,5]
IF(_HELIKAL>0)
IF(_IZ>1)AND(NOT _PENDELN) GOTOF _SKIP1
IF((_IZ==1)AND(_AS1==0)AND(_BA1==2))OR(_PENDELN)
IF(_RL==40)
G1 G40 AX[_XX]=_KTS[1,1] AX[_YY]=_KTS[1,2]
ENDIF
IF(_RL==41)
G1 G41 AX[_XX]=_KTS[1,1] AX[_YY]=_KTS[1,2]
ENDIF
IF(_RL==42)
G1 G42 AX[_XX]=_KTS[1,1] AX[_YY]=_KTS[1,2]
ENDIF
GOTOF _SKIP1
ENDIF
ENDIF
G0 AX[_XX]=_KTS[1,1] AX[_YY]=_KTS[1,2]
_SKIP1:
_I=2
WHILE(_I<=_I_MAX)
_CMD="G"<<_KTS[_I,0] MOD 10
_CMD=_CMD<<" "<<AXSTRING(_XX)<<"="<<_KTS[_I,1]<<" "<<AXSTRING(_YY)<<"="<<_KTS[_I,2]
IF(_HELIKAL>0)AND(_HELIKAL<3)AND((_HELIKAL==2)OR(_IZ<>_HZ))
_CMD=_CMD<<" "<<AXSTRING(_ZZ)<<"=IC(-"<<_HEZ*_KTL[_I]/_KTL[0]<<")"
ENDIF
IF((_KTS[_I,0]MOD 10)>=2)
_CMD=_CMD<<" IP["<<AXSTRING(_XX)<<"]=AC("<<_KTS[_I,3]<<") IP["<<AXSTRING(_YY)<<"]=AC("<<_KTS[_I,4]<<")"
ENDIF
IF(_KTS[_I,5])
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_CMD=_CMD<<" FZ="<<_KTS[_I,5]
ELSE
_CMD=_CMD<<" F="<<_KTS[_I,5]
ENDIF
ENDIF
EXECSTRING(_CMD)
_I=_I+1
ENDWHILE
IF(_PENDELN)
_BACK=1
IF(_RL<>40)
_RL=83-_RL
ENDIF
ENDIF
_FORTH_2:
ELSE
_BACK_1:
_I_MAX=_KTS[0,5]
IF(_HELIKAL>0)
IF(_IZ>1)AND(NOT _PENDELN) GOTOF _SKIP2
IF((_IZ==1)AND(_AS1==0)AND(_BA1==2))OR(_PENDELN)
IF(_RL==40)
G1 G40 AX[_XX]=_KTS[_I_MAX,1] AX[_YY]=_KTS[_I_MAX,2]
ENDIF
IF(_RL==41)
G1 G41 AX[_XX]=_KTS[_I_MAX,1] AX[_YY]=_KTS[_I_MAX,2]
ENDIF
IF(_RL==42)
G1 G42 AX[_XX]=_KTS[_I_MAX,1] AX[_YY]=_KTS[_I_MAX,2]
ENDIF
GOTOF _SKIP2
ENDIF
ENDIF
G0 AX[_XX]=_KTS[_I_MAX,1] AX[_YY]=_KTS[_I_MAX,2]
_SKIP2:
_I=_I_MAX
WHILE(_I>1)
IF((_KTS[_I,0]MOD 10)>=2)
_CMD="G"<<5-(_KTS[_I,0]MOD 10)
ELSE
_CMD="G"<<_KTS[_I,0]MOD 10
ENDIF
_CMD=_CMD<<" "<<AXSTRING(_XX)<<"="<<_KTS[_I-1,1]<<" "<<AXSTRING(_YY)<<"="<<_KTS[_I-1,2]
IF(_HELIKAL>0)AND(_HELIKAL<3)AND((_HELIKAL==2)OR(_IZ<>_HZ))
_CMD=_CMD<<" "<<AXSTRING(_ZZ)<<"=IC(-"<<_HEZ*_KTL[_I]/_KTL[0]<<")"
ENDIF
IF((_KTS[_I,0]MOD 10)>=2)
_CMD=_CMD<<" IP["<<AXSTRING(_XX)<<"]=AC("<<_KTS[_I,3]<<") IP["<<AXSTRING(_YY)<<"]=AC("<<_KTS[_I,4]<<")"
ENDIF
IF(_KTS[_I,5])
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_CMD=_CMD<<" FZ="<<_KTS[_I,5]
ELSE
_CMD=_CMD<<" F="<<_KTS[_I,5]
ENDIF
ENDIF
EXECSTRING(_CMD)
_I=_I-1
ENDWHILE
IF(_PENDELN)
_BACK=0
IF(_RL<>40)
_RL=83-_RL
ENDIF
ENDIF
_BACK_2:
ENDIF
IF(_BA100==0)
_WEZ=_RTP
IF(_AS2<10)
_DIS2=_RDF*_PMZ
ELSE
_DIS2=(_HEZ+_SDIS)*_PMZ
IF(_PMZ==1)
IF((_DPZ+_DIS2)>_WEZ)
_DIS2=_WEZ-_DPZ
ENDIF
ELSE
IF((_DPZ+_DIS2)<_WEZ)
_DIS2=_WEZ-_DPZ
ENDIF
ENDIF
ENDIF
ENDIF
IF(_BA100==1)
_WEZ=_RFP+_SDIS*_PMZ+_RDF*_PMZ
IF(_AS2<10)
_DIS2=_RDF*_PMZ
ELSE
_DIS2=(_HEZ+_SDIS)*_PMZ
IF(_PMZ==1)
IF((_DPZ+_DIS2)>_WEZ)
_DIS2=_WEZ-_DPZ
ENDIF
ELSE
IF((_DPZ+_DIS2)<_WEZ)
_DIS2=_WEZ-_DPZ
ENDIF
ENDIF
ENDIF
ENDIF
IF(_BA100==2)
_WEZ=_DPZ+_SDIS*_PMZ+_RDF*_PMZ _DIS2=_SDIS*_PMZ
ENDIF
IF(_BA100==3)
_WEZ=_DPZ+_RDF*_PMZ _DIS2=0 _BA10=1
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
_CMD="N100 G34"<<1-(_AS2 _DEC2)
_CMD=_CMD<<" G"<<_AS2 _DEC1<<"48"
_CMD=_CMD<<" G90 G40 AX[_ZZ]="<<_WEZ<<" DISR="<<_LP2<<" DISCL="<<_DIS2
IF(_BA10==0)AND(_BA100<>3)
ELSE
IF(_BA100==3)
_CMD=_CMD<<" "<<_S_FFP1
ELSE
_CMD=_CMD<<" "<<_S_FF3
ENDIF
ENDIF
N94 SBLON
IF(_BA10==0)AND(_BA100<>3)
N95 G0
ELSE
N140 G1
ENDIF
IF(_HELIKAL>0)AND((_IZ<_HZ)OR(_AS2==0)) GOTOF _NEXT2
N100 EXECSTRING(_CMD)
_NEXT2:
IF(_LOG_ON)
;WRITE(_TEMP,_LOG_FILE,";Abfahren: "<<_CMD)
ENDIF
N176 SBLOF
ELSE
IF(_HELIKAL>0)AND(_IZ>1) GOTOF _NEXT3
IF(_GZW==2)
EXECSTRING(_S_FF3)
ENDIF
IF(_P49==3)AND($MN_SIM_ENVIRONMENT B_AND 'B100')
G1
ENDIF
SBLON
N200 AX[_XX]=_XXS AX[_YY]=_YYS
SBLOF
IF(_P49==3)AND($MN_SIM_ENVIRONMENT B_AND 'B100')
G0
ENDIF
IF(((_SPIND==1)OR(_SPIND==3))AND(_BA1==1))
N202 CUST_TECHCYC(3+_UMODE)
_H10=1
ENDIF
SBLON
N205 AX[_ZZ]=_DPZ+_DIS1
SBLOF
EXECSTRING(_S_FFD)
N210 G1 AX[_ZZ]=_DPZ
IF(_H10==1)
IF(_SPIND==1)
N215 CUST_TECHCYC(4+_UMODE)
ENDIF
IF(_SPIND==3)
N216 CUST_TECHCYC(403+_UMODE)
ENDIF
_H10=0
ENDIF
EXECSTRING(_S_FFP1)
_NEXT3:
IF(NOT _BACK)
IF(_HELIKAL>0)
REPEAT _FORTH_1 _FORTH_2
GOTOF _NEXT4
ENDIF
IF ((_PNAME=="") AND (_SLA=="") AND (_SLE==""))
N220 CALL _KNAME
ELSE
IF (_PNAME=="")
N225 CALL $P_PROG[$P_STACK-1] BLOCK _SLA TO _SLE
ELSE
IF ((_SLA=="") AND (_SLE==""))
N230 CALL _PNAME
ELSE
N230 CALL _PNAME BLOCK _SLA TO _SLE
ENDIF
ENDIF
ENDIF
_NEXT4:
ELSE
REPEAT _BACK_1 _BACK_2
ENDIF
IF(_BA100==0)
_WEZ=_RTP
ENDIF
IF(_BA100==1)
_WEZ=_RFP+_SDIS*_PMZ
ENDIF
IF(_BA100==2)
_WEZ=_DPZ+_SDIS*_PMZ
ENDIF
IF(_BA100==3)
_WEZ=_DPZ _GZW=2 _BA10=1
ENDIF
IF(_HELIKAL>0) GOTOF _SKIP_G0
IF(_GZW==1)AND(_BA100<>3)
N235 G0
ELSE
N236 G1
N240 EXECSTRING(_S_FFP1)
ENDIF
_SKIP_G0:
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_HELIKAL>0)AND(_IZ<_HZ) GOTOF _SKIP_WEZ
SBLON
N250 G90 G40 AX[_ZZ]=_WEZ
SBLOF
_SKIP_WEZ:
ENDIF
ENDFOR
IF (_ARTIS[1]<>0)
M=QU(_ARTIS[8])
ENDIF
IF(_HELIKAL>0)AND(_AS2==0) GOTOF _SKIP_RTP
N298 SBLON
N300 G0 AX[_ZZ]=_RTP
N310 AX[_XX]=IC(0) AX[_YY]=IC(0)
N312 SBLOF
_SKIP_RTP:
_RET:
IF(_ZZSD[8]==0)
OFFN=_OFFN1
ENDIF
SBLON
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_XX]=_XAP
$AA_MEAS_POINT1[_YY]=_YAP
$AA_MEAS_POINT1[_ZZ]=_RFP+_SDIS*_PMZ
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_XX])+POT($AA_MEAS_POINT2[_YY])))
_SC_POS[0]=_XAP
_SC_POS[1]=_YAP
_SC_POS[2]=_RFP+_SDIS*_PMZ
RET
_FEHL0: STOPRE
N707200 SETAL(61009)
RET
_FEHL1: STOPRE
N707201 SETAL(61000)
RET
_FEHL2: STOPRE
N707202 SETAL(61002)
RET
_FEHL3: STOPRE
N707203 SETAL(61101)
RET
_FEHL4: STOPRE
N707204 SETAL(61114)
RET
_FEHL5: STOPRE
N707205 SETAL(61115)
RET
_FEHL6: STOPRE
N707206 SETAL(61116)
RET
_FEHL7: STOPRE
N707207 SETAL(61003)
RET
_FEHL8: STOPRE
N707208 SETAL(61010)
RET
_FEHL9:STOPRE
N707209 SETAL(61914)
RET
_FEHL10: STOPRE
N707210 SETAL(61011)
RET
_FEHL11: STOPRE
N707211 SETAL(61129)
RET
_FEHL12: STOPRE
N707212 SETAL(61014)
RET
_FEHL13:STOPRE
N707213 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL14:STOPRE
N707214 SETAL(61606)
RET
_FEHL15:
N707215 SETAL(62106)
RET
_FEHL16:
N707216 SETAL(61906)
RET
_FEHL17: STOPRE
N707217 SETAL(61223)
RET
_FEHL18: STOPRE
N707218 SETAL(61224)
RET
_FEHL19: STOPRE
N707219 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL20: STOPRE
N707220 SETAL(61156)
RET
_FEHL21: STOPRE
N707221 SETAL(61019,"(_GMODE: dec3/_ZSD[8])")
RET
_FEHL22: STOPRE
N707222 SETAL(61158)
RET
_FEHL23: STOPRE
N707223 SETAL(61159)
RET
_FEHL24: STOPRE
N707224 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N707225 SETAL(61019,"(_DMODE: dec4/_KNAME)")
RET
_FEHL26: STOPRE
N707226 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL27: STOPRE
N707227 SETAL(61019,"(_VARI: dec6)")
RET
_FEHL29: STOPRE
N707229 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N707230 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL31: STOPRE
N707231 SETAL(61218)
RET
_FEHL32: STOPRE
N707232 SETAL(61216)
RET
_FEHL33: STOPRE
N707233 SETAL(61029,_SERR)
RET
_FEHL34: STOPRE
N707234 SETAL(61012)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE94_SPF
PROC CYCLE94(REAL SPD,REAL SPL,CHAR FORM,INT _VARI) SAVE DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Undercut cycle
DEF AXIS _XX,_ZZ
DEF INT SL,_II,_ARTIS[16],_TEMP,PLAN=1,_ZAF=1,_XAF=1,_TYP,_GG10
DEF REAL SPZ,SPX,FAK=1,FWI,_DELT,DELTA,DELTB,HMFA,HMFO,HSPD,RR1=0.6,FF1=2,GG=1.4,TT1=0.2,TT2=0.1,RFZ=1,RFX=1,SPD_ABS
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE94_MPF"
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE94_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE99("<<SPD<<","<<SPL<<","<<FORM<<","<<_VARI<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
CYCLE218(10,0)
_ZZ=$P_AXN1 _XX=$P_AXN2 HMFA=$P_ACTFRAME[_ZZ,SC] HMFO=$P_ACTFRAME[_XX,SC]
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
PLAN=1
ELSE
PLAN=2
DIAMON
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _XAF=1
DIAMOF
ELSE
IF _ZZ==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=PLAN
ENDIF
IF _XX==AXNAME($MC_DIAMETER_AX_DEF)
_XAF=PLAN
ENDIF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL6
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL6
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL6
ENDIF
ENDIF
IF ($P_GG[13]==2) OR ($P_GG[13]==4) GOTOF _MM1
FAK=$MN_SCALING_VALUE_INCH
_MM1:HMFA=HMFA*FAK HMFO=HMFO*FAK
HSPD=SPD/2 SPD=SPD*HMFO
SPD_ABS=ABS(SPD)
IF SPD_ABS<=3 GOTOF FEHL1
_TYP=$P_ADT[1]
IF(_TYP<500)OR(_TYP>599) GOTOF _FEHL7
IF _VARI==0
IF $P_TOOL==0
GOTOF FEHL2
ENDIF
SL=$P_ADT[2] FWI=$P_ADT[24]
IF (SL>4)OR(SL<1)
GOTOF FEHL3
ENDIF
ELSE
IF ((_VARI>4) OR (_VARI<1))
GOTOF _FEHL5
ELSE
SL=_VARI
ENDIF
ENDIF
IF (FORM<>"E")AND(FORM<>"F")GOTOF FEHL4
IF FWI==0 GOTOF _MA2 IF FWI >=15 GOTOF _MA2
_MA2:IF SL<3 GOTOF _MB2
RFX=-1
_MB2:IF (SL==1)OR(SL==4) GOTOF _MC2
RFZ=-1
_MC2:
IF _VARI==0
IF $P_ACTFRAME[_ZZ,MI]<>0
RFZ=RFZ * (-1)
ENDIF
IF $P_ACTFRAME[_XX,MI]<>0
RFX=RFX * (-1)
ENDIF
ENDIF
IF (SPD_ABS>10)AND(SPD_ABS<=18) GOTOF _MA3 IF (SPD_ABS>=3)AND(SPD_ABS<=10) GOTOF _MD2 IF (SPD_ABS>18)AND(SPD_ABS<=80) GOTOF _ME2
RR1=1 TT1=0.4 FF1=4 GG=3.2 TT2=0.3
GOTOF _MA3
_MD2:RR1=0.4 GG=1.1
GOTOF _MA3
_ME2:TT1=0.3 FF1=2.5 GG=2.1 TT2=0.2
_MA3:TT1=TT1/HMFO TT2=TT2/HMFA RR1=RR1/HMFA GG=GG/HMFO FF1=FF1/HMFA
SPD=HSPD _DELT=(1/HMFA+TT1)/TAN(15)*RFZ FF1=FF1*RFZ TT2=TT2*RFZ TT1=TT1*RFX
SPZ=SPL-10*RFZ/HMFA SPX=HSPD-1*RFX/HMFO
DELTB=RR1*COS(8)+TAN(8)*RR1*(SIN(8)+1) DELTA=(DELTB-RR1+ABS(TT2))/TAN(8)
_MA4:
N10 G0 G40 G90 G[10]=_GG10 AX[_ZZ]=SPZ*_ZAF AX[_XX]=SPX*_XAF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF (SL MOD 2)==1 GOTOF _MB4
N11 G41 AX[_ZZ]=(SPL-FF1-1/HMFA*RFZ/TAN(15))*_ZAF
GOTOF _MC4
N12 _MB4:G42 AX[_ZZ]=(SPL-FF1-1/HMFA*RFZ/TAN(15))*_ZAF AX[_XX]=SPX*_XAF
N13 _MC4:G1 G91 AX[_ZZ]=_DELT*_ZAF AX[_XX]=(TT1+1/HMFO*RFX)*_XAF RND=RR1
IF FORM=="F" GOTOF _ME4
N14 G90 AX[_ZZ]=SPL*_ZAF RND=RR1
N15 G91 AX[_XX]=(-2*(TT1+RFX/HMFO))*_XAF
GOTOF _MF4
N16 _ME4:G90 AX[_ZZ]=(SPL+TT2-RR1*RFZ+DELTB*RFZ)*_ZAF RND=RR1
N17 AX[_ZZ]=SPL*_ZAF AX[_XX]=(HSPD+TT1-DELTA*RFX)*_XAF
_MF4:
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
N18 G0 G90 G40 G60 AX[_ZZ]=SPZ*_ZAF AX[_XX]=SPX*_XAF
RET
FEHL1: STOPRE
N709401 SETAL(61601)
RET
FEHL2: STOPRE
N709402 SETAL(61000)
RET
FEHL3: STOPRE
N709403 SETAL(61608)
RET
FEHL4: STOPRE
N709404 SETAL(61609)
RET
_FEHL5: STOPRE
N709405 SETAL(61613)
RET
_FEHL6: STOPRE
N709406 SETAL(62106)
RET
_FEHL7: STOPRE
N709407 SETAL(61212)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE940_SPF
PROC CYCLE940(REAL __SPD,REAL _SPL,CHAR _FORM,INT _LAGE,REAL _SDIS,REAL _FFP,INT _VARI,REAL __EPD,REAL __EPL,REAL __R1,REAL __R2,REAL _STA,REAL __VRT,REAL __MID,REAL __FAL,REAL __FALX,REAL __FALZ,INT _PITI,STRING[20] _PTAB,STRING[20] _PTABA,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Thread undercut like DIN76 or Undercut like DIN509
DEF AXIS _XX,_ZZ
DEF INT _AMODE1,_AMODE2,_AMODE3,_AMODE4,_AI,_DMODE1,_G2_3,_I,_LF[4],_PLAN,_PM,_SL,_SN,_TYP,_VARI1,_VARI2,_XAF,_ZUG,_GG10
DEF INT _SLT[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,2,1,4,3,7,6,5,8,9)
DEF INT _SLX[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,4,3,2,1,5,8,7,6,9)
DEF INT _II,_ARTIS[16]
DEF REAL _EPD,_EPL,_FAL,_FALX,_FALZ,_MID,_R1,_R2,_SPD,_VRT,_VX
DEF REAL _FAK1,_FAK2,_FAK3,_FFP2,_OFK,_OFX,_OFZ,_STX,_STZ,_TR,_WF,_WH,_WR,_ZUT
DEF REAL _PG[4,2],_PF[6,2],_PR[2,3],_P[6,2]
DEF REAL _R[24],_G[24],_T2[24],_S2[24],_G2,_T1,_H3
DEF REAL _R_EF[10],_T2_EF[10],_FF[10],_G_EF[10],_R1_EF,_F1,_G1,_SPX,_SPZ,_P1Z,_P2X,_P2Z,_P3Z,_P4X,_P4Z,_P5X,_P6X,_P6Z
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE940_MPF",_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE940_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE940("<<__SPD<<","<<_SPL<<","<<_FORM<<","<<_LAGE<<","<<_SDIS<<","<<_FFP<<","<<_VARI<<","<<__EPD<<","<<__EPL<<","<<__R1<<","<<__R2<<","<<_STA<<","<<__VRT<<","<<__MID<<","<<__FAL<<","<<__FALX<<","<<__FALZ<<","<<_PITI<<","<<_PTAB<<","<<_PTABA<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_EPD=__EPD _EPL=__EPL _FAL=__FAL _FALX=__FALX _FALZ=__FALZ _MID=__MID _R1=__R1 _R2=__R2 _SPD=__SPD _VRT=__VRT
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF(_FORM<>"A")AND(_FORM<>"B")AND(_FORM<>"C")AND(_FORM<>"D")AND(_FORM<>"E")AND(_FORM<>"F")AND(_FORM<>"T") GOTOF _FEHL9
IF(_LAGE<0)OR(_LAGE>3) GOTOF _FEHL13
IF(_SPD<=0) GOTOF _FEHL16
IF(_SDIS<=0) GOTOF _FEHL5
IF(_FFP<=0) GOTOF _FEHL8
IF(_AMODE<0) GOTOF _FEHL12
_AMODE1=_AMODE _DEC1 _AMODE2=_AMODE _DEC2 _AMODE3=_AMODE _DEC3 _AMODE4=_AMODE _DEC4
IF(_FORM=="A")OR(_FORM=="B")OR(_FORM=="C")OR(_FORM=="D")OR(_FORM=="T")
IF(_VARI<1)
_SERR=<<"(_VARI)"
GOTOF _FEHL10
ENDIF
_VARI1=_VARI _DEC1
_VARI2=_VARI _DEC2
IF(_VARI1>3)
_SERR=<<"(_VARI: dec1)"
GOTOF _FEHL11
ENDIF
IF(_VARI1==1)OR(_VARI1==3)
IF(_VARI2>1)
_SERR=<<"(_VARI: dec2)"
GOTOF _FEHL11
ENDIF
ENDIF
IF(_VARI1==2)OR(_VARI1==3)
IF(_AMODE3==0)
IF(_LAGE<2)
IF(_VRT<_SPD) GOTOF _FEHL20
ELSE
IF(_VRT>_SPD) GOTOF _FEHL20
ENDIF
_VX=ABS(_SPD-_VRT)
_VRT=_VX/2 _AMODE3=1
ELSE
_VRT=ABS(_VRT)
ENDIF
ENDIF
ENDIF
_SPD=_SPD/2
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_FAK3=1
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ENDIF
IF(_SC_TOOL_VALI[0]<>0)
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF(_ARTIS[0] MOD 10 <>1)
GOTOF _FEHL22
ENDIF
_II=_ARTIS[0] DIV 10
IF((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL22
ELSE
_ARTIS[11]=_II MOD 10
IF(_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF(_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL22
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3) GOTOF _FEHL3
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
_XX=$P_AXN2 _ZZ=$P_AXN1
_TYP=$P_ADT[1]
IF(_TYP<500)OR(_TYP>599) GOTOF _FEHL4
IF (_SC_Y_TURN==0)
IF ((_TYP _DEC1)==5) GOTOF _FEHL4
ELSE
IF ((_TYP _DEC1)<>5) GOTOF _FEHL4
IF ( (_FORM=="F")OR((_LAGE<>0)AND(_LAGE<>1)) )
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
ENDIF
N10 G40 G90
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_PLAN=1
ELSE
_PLAN=2
DIAMON
ENDIF
IF(($MC_DIAMETER_AX_DEF=="")OR($MC_DIAMETER_AX_DEF==" "))
_XAF=1
DIAMOF
ELSE
IF(_XX==AXNAME($MC_DIAMETER_AX_DEF))
_XAF=_PLAN
ENDIF
ENDIF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[7])
ENDIF
IF(_FORM=="T") GOTOF _KONT_T
IF(_FORM=="E")OR(_FORM=="F") GOTOF _KONT_EF
IF(_PITI<0)OR(_PITI>23) GOTOF _FEHL23
_R[ 0]=0.1 _R[ 1]=0.12 _R[ 2]=0.16 _R[ 3]=0.16 _R[ 4]=0.2 _R[ 5]=0.2
_R[ 6]=0.2 _R[ 7]=0.4 _R[ 8]=0.4 _R[ 9]=0.4 _R[10]=0.4 _R[11]=0.6
_R[12]=0.6 _R[13]=0.8 _R[14]=1.0 _R[15]=1.0 _R[16]=1.2 _R[17]=1.6
_R[18]=1.6 _R[19]=2.0 _R[20]=2.0 _R[21]=2.5 _R[22]=3.2 _R[23]=3.2
IF(_FORM=="A")OR(_FORM=="B")
IF(_FORM=="A")
_G[0]=0.7 _G[1]=0.9 _G[2]=1.05 _G[3]=1.2 _G[4]=1.4 _G[5]=1.6
_G[6]=1.75 _G[7]=2.1 _G[8]=2.45 _G[9]=2.6 _G[10]=2.8 _G[11]=3.5
_G[12]=4.4 _G[13]=5.2 _G[14]=6.1 _G[15]=7.0 _G[16]=8.7 _G[17]=10.5
_G[18]=12.0 _G[19]=14.0 _G[20]=16.0 _G[21]=17.5 _G[22]=19.0 _G[23]=21.0
ELSE
_G[0]=0.5 _G[1]=0.6 _G[2]=0.75 _G[3]=0.9 _G[4]=1.0 _G[5]=1.1
_G[6]=1.25 _G[7]=1.5 _G[8]=1.75 _G[9]=1.9 _G[10]=2.0 _G[11]=2.5
_G[12]=3.2 _G[13]=3.8 _G[14]=4.3 _G[15]=5.0 _G[16]=6.3 _G[17]=7.5
_G[18]=9.0 _G[19]=10.0 _G[20]=11.0 _G[21]=12.5 _G[22]=14.0 _G[23]=15.0
ENDIF
_T2[ 0]=0.3 _T2[ 1]=0.4 _T2[ 2]=0.5 _T2[ 3]=0.6 _T2[ 4]=0.7 _T2[ 5]=0.7
_T2[ 6]=0.8 _T2[ 7]=1.0 _T2[ 8]=1.1 _T2[ 9]=1.2 _T2[10]=1.3 _T2[11]=1.6
_T2[12]=2.0 _T2[13]=2.3 _T2[14]=2.6 _T2[15]=3.0 _T2[16]=3.6 _T2[17]=4.4
_T2[18]=5.0 _T2[19]=5.7 _T2[20]=6.4 _T2[21]=7.0 _T2[22]=7.7 _T2[23]=8.3
ELSE
IF(_FORM=="C")
_G[0]=1.2 _G[1]=1.4 _G[2]=1.6 _G[3]=1.9 _G[4]=2.2 _G[5]=2.4
_G[6]=2.7 _G[7]=3.3 _G[8]=3.8 _G[9]=4.0 _G[10]=4.2 _G[11]=5.2
_G[12]=6.7 _G[13]=7.8 _G[14]=9.1 _G[15]=10.3 _G[16]=13.0 _G[17]=15.2
_G[18]=17.7 _G[19]=20.0 _G[20]=23.0 _G[21]=26.0 _G[22]=28.0 _G[23]=30.0
ELSE
_G[0]=0.9 _G[1]=1.0 _G[2]=1.25 _G[3]=1.4 _G[4]=1.6 _G[5]=1.7
_G[6]=2.0 _G[7]=2.4 _G[8]=2.75 _G[9]=2.9 _G[10]=3.0 _G[11]=3.7
_G[12]=4.9 _G[13]=5.6 _G[14]=6.4 _G[15]=7.3 _G[16]=9.3 _G[17]=10.7
_G[18]=12.7 _G[19]=14.0 _G[20]=16.0 _G[21]=18.5 _G[22]=20.0 _G[23]=21.0
ENDIF
_T2[ 0]=0.1 _T2[ 1]=0.1 _T2[ 2]=0.1 _T2[ 3]=0.2 _T2[ 4]=0.2 _T2[ 5]=0.2
_T2[ 6]=0.3 _T2[ 7]=0.3 _T2[ 8]=0.3 _T2[ 9]=0.3 _T2[10]=0.3 _T2[11]=0.5
_T2[12]=0.5 _T2[13]=0.5 _T2[14]=0.5 _T2[15]=0.5 _T2[16]=0.5 _T2[17]=0.5
_T2[18]=0.5 _T2[19]=0.5 _T2[20]=0.5 _T2[21]=0.5 _T2[22]=0.5 _T2[23]=0.5
ENDIF
; Steigung: _S2
_S2[ 0]=0.2 _S2[ 1]=0.25 _S2[ 2]=0.3 _S2[ 3]=0.35 _S2[ 4]=0.4 _S2[ 5]=0.45
_S2[ 6]=0.5 _S2[ 7]=0.6 _S2[ 8]=0.7 _S2[ 9]=0.75 _S2[10]=0.8 _S2[11]=1.0
_S2[12]=1.25 _S2[13]=1.5 _S2[14]=1.75 _S2[15]=2.0 _S2[16]=2.5 _S2[17]=3.0
_S2[18]=3.5 _S2[19]=4.0 _S2[20]=4.5 _S2[21]=5.0 _S2[22]=5.5 _S2[23]=6.0
IF(_LAGE>=2)
_AI=-1
ELSE
_AI=1
ENDIF
_R1=_R[_PITI]*_FAK3
_R2=_R1
_G2=_G[_PITI]*_FAK3
_T1=_T2[_PITI]/2*_FAK3
IF(_LAGE>=2)
_H3=0.61343*_S2[_PITI]*_FAK3
_SPD=_SPD+_H3*_AI
_T1=_T1+_H3
_VRT=_VRT-_H3
IF(_VRT<0)
_VRT=0
ENDIF
ENDIF
_EPL=_G2 _AMODE2=1 _EPD=_T1 _AMODE1=1
_KONT_T:
IF(_AMODE1>1)OR(_AMODE2>1) GOTOF _FEHL12
IF(_R1<=0)OR(_R2<=0) GOTOF _FEHL17
IF(_VARI1==1)OR(_VARI1==3)
IF(_AMODE4>1)GOTOF _FEHL15
IF(_AMODE4==1)
IF(_FALX>_FALZ)
_FAL=_FALZ
ELSE
_FAL=_FALX
ENDIF
_FALX=_FALX-_FAL
_FALZ=_FALZ-_FAL
ELSE
_FALX=0 _FALZ=0
ENDIF
ENDIF
IF(_VARI1==2)
_FAL=0 _FALX=0 _FALZ=0
ENDIF
IF(_LAGE==1)OR(_LAGE==2)
_G2_3=2+1
ELSE
_G2_3=3+1
ENDIF
_PM=1-(_LAGE MOD 2)*2
_AI=1-(_LAGE DIV 2)*2
IF(_FORM=="T")
IF(_AMODE1==0)
_EPD=_EPD/2
IF(_LAGE<2)
IF(_SPD<_EPD) GOTOF _FEHL18
ELSE
IF(_SPD>_EPD) GOTOF _FEHL18
ENDIF
_EPD=ABS(_SPD-_EPD)
ENDIF
ENDIF
IF(_EPD<=0) GOTOF _FEHL18
IF(_AMODE2==0)
_EPL=-(_EPL-_SPL)*_PM
ENDIF
IF(_EPL<=0) GOTOF _FEHL19
IF($P_TOOLNO>0)
_SL=$P_ADT[2]
IF(NOT(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H00200000')AND($P_CUTMOD))AND NOT(($P_CUTMODK==$PC_TRAFO_NAME)AND($P_CUTMODK<>""))AND(NOT _SC_Y_TURN))
_SL=_SLT[$P_ACTFRAME[_ZZ,MI],_SL]
_SL=_SLX[$P_ACTFRAME[_XX,MI],_SL]
ENDIF
IF(_SL>0)
_LF[0]=4 _LF[1]=3 _LF[2]=1 _LF[3]=2
IF(_LF[_LAGE]<>_SL) GOTOF _FEHL1
ENDIF
_WR=$P_TOOLR*_FAK1
ELSE
_WR=0
ENDIF
_SN=$P_ADT[11]
IF(_SN==1)OR(_SN==2)
_WF=$P_ADT[10]-90
_WH=$P_ADT[24]
ELSE
_WF=$P_ADT[24]
_WH=$P_ADT[10]-90
ENDIF
IF(_WF<=_STA) GOTOF _FEHL7
IF(_WH<=0) GOTOF _FEHL7
_TR=0.0000001
IF(_WR>_R1)OR(_WR>_R2) GOTOF _FEHL2
IF(_EPD<0)OR(_EPL<0) GOTOF _FEHL2
IF(_STA<=0)OR(_STA>=90) GOTOF _FEHL2
IF(_FAL+_FALX>_EPD) GOTOF _FEHL6
IF(_R2>_EPD) GOTOF _FEHL21
IF _EPL<_R2+_R1*SIN(_STA)+(_EPD-_R1*(1-COS(_STA)))/TAN(_STA)-_TR GOTOF _FEHL2
IF(_VARI1==1)OR(_VARI1==3)
IF(_MID<=0) GOTOF _FEHL14
_ZUT=_EPD-(_FAL+_FALX)
_ZUG=TRUNC(_ZUT/_MID)
IF(_ZUG*_MID<_ZUT)
_ZUG=_ZUG+1
ENDIF
_MID=_ZUT/_ZUG
ENDIF
IF(_VARI1==1)OR(_VARI==3)
IF(_VARI2==1)
_STZ=_SPL+((_FAL+_WR)/SIN(_STA)+_FALZ+_FALX/TAN(_STA)-((_EPL+(_SDIS+_WR)/TAN(_STA))-_WR))*_PM
ELSE
_STZ=_SPL-(_EPL-(_FAL+_WR+_MID*(_ZUG-1))/SIN(_STA)-_FALZ-_FALX/TAN(_STA)+(_SDIS+_WR)/TAN(_STA)-_WR)*_PM
ENDIF
ELSE
_STZ=_SPL-(_EPL-_WR/SIN(_STA)+(_SDIS+_WR)/TAN(_STA)-_WR)*_PM
ENDIF
_STX=_SPD+_SDIS*_AI
IF(_VARI1==1)OR(_VARI1==3)
IF(_VARI2==1)
_M_GROB_A:
_PG[0,0]=0
_PG[0,1]=_EPL
_PG[1,0]=-_EPD
_PG[1,1]=_EPL-_EPD/TAN(_STA)
_PG[2,0]=-_EPD
_PG[2,1]=0
_PG[3,0]=0
_PG[3,1]=0
_PR[0,2]=_R1
_PR[1,2]=_R2
_M_GROB_E:
_OFK=_FAL+_WR
_OFX=_FALX
_OFZ=_FALZ
_M_GROB_WR_FAL_A:
_PG[0,0]=_PG[0,0]
_PG[0,1]=_PG[0,1]-_OFK/SIN(_STA)-_OFZ-_OFX/TAN(_STA)
_PG[1,0]=_PG[1,0]+_OFK+_OFX
_PG[1,1]=_PG[1,1]-_OFK*TAN(_STA/2)-_OFZ
_PG[2,0]=_PG[2,0]+_OFK+_OFX
_PG[2,1]=_PG[2,1]+_OFK+_OFZ
_PG[3,0]=_PG[3,0]
_PG[3,1]=_PG[3,1]+_OFK+_OFZ
_PR[0,2]=_PR[0,2]-_OFK
_PR[1,2]=_PR[1,2]-_OFK
IF(_PR[0,2]<0)
_PR[0,2]=0
ENDIF
IF(_PR[1,2]<0)
_PR[1,2]=0
ENDIF
_PR[0,0]=_PG[1,0]+_PR[0,2]
_PR[0,1]=_PG[1,1]-_PR[0,2]*TAN(_STA/2)
_PR[1,0]=_PG[2,0]+_PR[1,2]
_PR[1,1]=_PG[2,1]+_PR[1,2]
_M_GROB_WR_FAL_E:
IF(_PR[1,1]>_PR[0,1])GOTOF _FEHL6
_M_GROB_WR_FAL_CHECK_E:
_M_FEIN_A:
_PF[0,0]=_PG[0,0]
_PF[0,1]=_PG[0,1]
_PF[1,0]=_PG[1,0]+_PR[0,2]*TAN(_STA/2)*SIN(_STA)
_PF[1,1]=_PG[1,1]+_PR[0,2]*TAN(_STA/2)*COS(_STA)
_PF[2,0]=_PG[1,0]
_PF[2,1]=_PR[0,1]
_PF[3,0]=_PG[2,0]
_PF[3,1]=_PR[1,1]
_PF[4,0]=_PR[1,0]
_PF[4,1]=_PG[3,1]
_PF[5,0]=_PG[3,0]
_PF[5,1]=_PG[3,1]
_M_FEIN_E:
FOR _I=1 TO _ZUG
IF(_I==1)
_P[0,0]=_SDIS+_WR
_P[2,0]=-_MID+_WR
ELSE
_P[0,0]=_P[2,0]
IF(_I==_ZUG)
_P[2,0]=-_ZUT+_WR
ELSE
_P[2,0]=_P[2,0]-_MID
ENDIF
ENDIF
_P[3,0]=_P[2,0]
_P[5,0]=_P[0,0]
IF(_P[0,0]>=_PF[1,0])
_P[0,1]=_PF[0,1]+_P[0,0]/TAN(_STA)
IF(_P[2,0]>=_PF[1,0])
_P[2,1]=_PF[0,1]+_P[2,0]/TAN(_STA)
_P[1,0]=_P[2,0]
_P[1,1]=_P[2,1]
ELSE
_P[2,1]=_PF[2,1]+SQRT(ABS(POT(_PR[0,2])-POT(_PR[0,0]-_P[2,0])))
_P[1,0]=_PF[1,0]
_P[1,1]=_PF[1,1]
ENDIF
ELSE
_P[0,1]=_PF[2,1]+SQRT(ABS(POT(_PR[0,2])-POT(_PR[0,0]-_P[0,0])))
_P[2,1]=_PF[2,1]+SQRT(ABS(POT(_PR[0,2])-POT(_PR[0,0]-_P[2,0])))
_P[1,0]=_P[0,0]
_P[1,1]=_P[0,1]
ENDIF
IF(_P[5,0]>=_PF[4,0])
_P[5,1]=_PF[4,1]
IF(_P[3,0]>=_PF[4,0])
_P[3,1]=_PF[4,1]
_P[4,0]=_P[3,0]
_P[4,1]=_P[3,1]
ELSE
_P[3,1]=_PF[3,1]-SQRT(ABS(POT(_PR[1,2])-POT(_PR[1,0]-_P[3,0])))
_P[4,0]=_PF[4,0]
_P[4,1]=_PF[4,1]
ENDIF
ELSE
_P[5,1]=_PF[3,1]-SQRT(ABS(POT(_PR[1,2])-POT(_PR[1,0]-_P[5,0])))
_P[3,1]=_PF[3,1]-SQRT(ABS(POT(_PR[1,2])-POT(_PR[1,0]-_P[3,0])))
_P[4,0]=_P[5,0]
_P[4,1]=_P[5,1]
ENDIF
N100 G0 F=_FFP AX[_ZZ]=_SPL-(_P[0,1]-_WR)*_PM
IF(_I==1)
N110 G0 AX[_XX]=(_SPD+(_P[0,0]-_WR)*_AI)*_XAF
ELSE
IF(_MID>_SDIS)
N120 G0 AX[_XX]=(_SPD+(_P[0,0]+_SDIS-_WR)*_AI)*_XAF
ENDIF
ENDIF
N130 G1 AX[_XX]=(_SPD+(_P[0,0]-_WR)*_AI)*_XAF
IF(_P[0,0]<>_P[1,0])
N140 G1 AX[_XX]=(_SPD+(_P[1,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[1,1]-_WR)*_PM
ENDIF
IF(_P[1,0]<>_P[2,0])
N150 G[1]=_G2_3 AX[_XX]=(_SPD+(_P[2,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[2,1]-_WR)*_PM CR=_PR[0,2]
ENDIF
N160 G1 AX[_XX]=(_SPD+(_P[3,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[3,1]-_WR)*_PM
IF(_P[3,0]<>_P[4,0])
N170 G[1]=_G2_3 AX[_XX]=(_SPD+(_P[4,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[4,1]-_WR)*_PM CR=_PR[1,2]
ENDIF
IF(_P[4,0]<>_P[5,0])
N180 G1 AX[_XX]=(_SPD+(_P[5,0]-_WR)*_AI)*_XAF
ENDIF
ENDFOR
ELSE
FOR _I=1 TO _ZUG
REPEAT _M_GROB_A _M_GROB_E
_OFK=_FAL+_WR
_OFX=_FALX
_OFZ=_FALZ
REPEAT _M_GROB_WR_FAL_A _M_GROB_WR_FAL_CHECK_E
_OFK=_MID*(_ZUG-_I)
_OFX=0
_OFZ=0
REPEAT _M_GROB_WR_FAL_A _M_GROB_WR_FAL_E
REPEAT _M_FEIN_A _M_FEIN_E
_P[0,0]=_SDIS+_WR
_P[0,1]=_PF[0,1]+_P[0,0]/TAN(_STA)
_P[1,0]=_PF[1,0]
_P[1,1]=_PF[1,1]
_P[2,0]=_PF[2,0]
_P[2,1]=_PF[2,1]
_P[3,0]=_PF[3,0]
_P[3,1]=_PF[3,1]
_P[4,0]=_PF[4,0]
_P[4,1]=_PF[4,1]
_P[5,0]=_PF[5,0]
_P[5,1]=_PF[5,1]
IF(_P[1,1]<_P[4,1])
_P[1,0]=_P[0,0]-(_P[0,1]-_P[4,1])*TAN(_STA)
_P[1,1]=_P[4,1]
_P[2,0]=_P[1,0]
_P[2,1]=_P[1,1]
_P[3,0]=_P[1,0]
_P[3,1]=_P[1,1]
_P[4,0]=_P[1,0]
ENDIF
IF(_P[2,1]<_P[4,1])
_P[2,0]=_PR[0,0]-SQRT(ABS(POT(_PR[0,2])-POT(_PR[0,1]-_P[4,1])))
_P[2,1]=_P[4,1]
_P[3,0]=_P[2,0]
_P[3,1]=_P[2,1]
_P[4,0]=_P[2,0]
ENDIF
_M_CHECK_R1_A:
IF(_P[1,0]>_P[0,0])
_P[1,1]=_PR[0,1]+SQRT(ABS(POT(_PR[0,2])-POT(_PR[0,0]-_P[0,0])))
_P[1,0]=_P[0,0]
_P[0,1]=_P[1,1]
ENDIF
_M_CHECK_R1_E:
IF(_P[2,0]>_WR) GOTOF _M_ENDFOR
N200 G0 F=_FFP AX[_XX]=(_SPD+(_P[0,0]-_WR)*_AI)*_XAF
N210 G0 AX[_ZZ]=_SPL-(_P[0,1]-_WR)*_PM
IF(_P[0,0]<>_P[1,0])
N220 G1 AX[_XX]=(_SPD+(_P[1,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[1,1]-_WR)*_PM
ENDIF
IF(_P[1,0]<>_P[2,0])
N230 G[1]=_G2_3 AX[_XX]=(_SPD+(_P[2,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[2,1]-_WR)*_PM CR=_PR[0,2]
ENDIF
IF(_P[2,1]<>_P[3,1])
N240 G1 AX[_XX]=(_SPD+(_P[3,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[3,1]-_WR)*_PM
ENDIF
IF(_P[3,0]<>_P[4,0])
N250 G[1]=_G2_3 AX[_XX]=(_SPD+(_P[4,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[4,1]-_WR)*_PM CR=_PR[1,2]
ENDIF
IF(_P[4,0]<_P[5,0])
N260 G1 AX[_XX]=(_SPD+(_P[5,0]-_WR)*_AI)*_XAF
ENDIF
_M_ENDFOR:
ENDFOR
ENDIF
IF(_P[5,1]==_PF[5,1])
N280 G0 AX[_XX]=(_SPD+(_P[5,0]+_SDIS*SIN(_STA)-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[5,1]+_SDIS*COS(_STA)-_WR)*_PM
ENDIF
IF(_VARI1==1)
SBLON
N290 G0 AX[_XX]=(_SPD+_SDIS*_AI)*_XAF
SBLOF
ENDIF
ENDIF
IF(_VARI1==2)OR(_VARI1==3)
_FFP2=_FFP*$SCS_TURN_FIN_FEED_PERCENT/100
REPEAT _M_GROB_A _M_GROB_E
_OFK=_WR _OFX=0 _OFZ=0
REPEAT _M_GROB_WR_FAL_A _M_GROB_WR_FAL_E
REPEAT _M_FEIN_A _M_FEIN_E
_P[0,0]=_SDIS+_WR
_P[0,1]=_PF[0,1]+_P[0,0]/TAN(_STA)
_P[1,0]=_PF[1,0]
_P[1,1]=_PF[1,1]
_P[2,0]=_PF[2,0]
_P[2,1]=_PF[2,1]
_P[3,0]=_PF[3,0]
_P[3,1]=_PF[3,1]
_P[4,0]=_PF[4,0]
_P[4,1]=_PF[4,1]
_P[5,0]=_PF[5,0]+_VRT
_P[5,1]=_PF[5,1]
REPEAT _M_CHECK_R1_A _M_CHECK_R1_E
N300 G0 F=_FFP2 AX[_XX]=(_SPD+(_P[0,0]-_WR)*_AI)*_XAF
N310 G0 AX[_ZZ]=_SPL-(_P[0,1]-_WR)*_PM
IF(_P[0,0]<>_P[1,0])
N320 G1 AX[_XX]=(_SPD+(_P[1,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[1,1]-_WR)*_PM
ENDIF
IF(_P[1,0]<>_P[2,0])
N330 G[1]=_G2_3 AX[_XX]=(_SPD+(_P[2,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[2,1]-_WR)*_PM CR=_PR[0,2]
ENDIF
N340 G1 AX[_XX]=(_SPD+(_P[3,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[3,1]-_WR)*_PM
IF(_P[3,0]<>_P[4,0])
N350 G[1]=_G2_3 AX[_XX]=(_SPD+(_P[4,0]-_WR)*_AI)*_XAF AX[_ZZ]=_SPL-(_P[4,1]-_WR)*_PM CR=_PR[1,2]
ENDIF
IF(_P[4,0]<>_P[5,0])
N360 G1 AX[_XX]=(_SPD+(_P[5,0]-_WR)*_AI)*_XAF
ENDIF
SBLON
N370 G0 AX[_XX]=(_SPD+(_P[5,0]-_WR+_SDIS)*_AI)*_XAF
SBLOF
ENDIF
GOTOF _FERTIG
_KONT_EF:
IF(_PITI<0)OR(_PITI>9) GOTOF _FEHL24
IF(_AMODE3==0)
IF(_VRT<0) GOTOF _FEHL20
_VRT=_VRT/2
ENDIF
_R_EF[0]=0.6 _R_EF[1]=1.0 _R_EF[2]=1.0 _R_EF[3]=1.6 _R_EF[4]=2.5 _R_EF[5]=4.0 _R_EF[6]=0.4 _R_EF[7]=0.6 _R_EF[8]=0.1 _R_EF[9]=0.2
_T2_EF[0]=0.3 _T2_EF[1]=0.4 _T2_EF[2]=0.2 _T2_EF[3]=0.3 _T2_EF[4]=0.4 _T2_EF[5]=0.5 _T2_EF[6]=0.2 _T2_EF[7]=0.2 _T2_EF[8]=0.1 _T2_EF[9]=0.1
_FF[0]=2.5 _FF[1]=4 _FF[2]=2.5 _FF[3]=4 _FF[4]=5 _FF[5]=7 _FF[6]=2 _FF[7]=2 _FF[8]=0.5 _FF[9]=1
_G_EF[0]=2.1 _G_EF[1]=3.2 _G_EF[2]=1.8 _G_EF[3]=3.1 _G_EF[4]=4.8 _G_EF[5]=6.4 _G_EF[6]=1.1 _G_EF[7]=1.4 _G_EF[8]=0.8 _G_EF[9]=0.9
_PM=1-(_LAGE MOD 2)*2
_AI=1-((_LAGE DIV 2) MOD 2)*2
IF(_AMODE1==0)
IF(_EPD<0)
_SERR=<<"(_EPD)"
GOTOF _FEHL25
ENDIF
_EPD=_EPD/2
_EPD=(_EPD-_SPD)*_AI
IF(_EPD<0)
_SERR=<<"(_EPD)"
GOTOF _FEHL25
ENDIF
ELSE
_EPD=ABS(_EPD)
ENDIF
IF(_FORM=="F")
IF(_AMODE2==0)
IF(_EPL<0)
_SERR=<<"(_EPL)"
GOTOF _FEHL25
ENDIF
_EPL=-(_EPL-_SPL)*_PM
IF(_EPL<0)
_SERR=<<"(_EPL)"
GOTOF _FEHL25
ENDIF
ELSE
_EPL=ABS(_EPL)
ENDIF
ENDIF
IF($P_TOOLNO>0)
_SL=$P_ADT[2]
IF(NOT(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H00200000')AND($P_CUTMOD))AND NOT(($P_CUTMODK==$PC_TRAFO_NAME)AND($P_CUTMODK<>""))AND(NOT _SC_Y_TURN))
_SL=_SLT[$P_ACTFRAME[_ZZ,MI],_SL]
_SL=_SLX[$P_ACTFRAME[_XX,MI],_SL]
ENDIF
IF(_SL>0)
_LF[0]=4 _LF[1]=3 _LF[2]=1 _LF[3]=2
IF(_LF[_LAGE]<>_SL) GOTOF _FEHL1
ENDIF
_WR=$P_TOOLR*_FAK1
IF(_WR>_R_EF[_PITI]) GOTOF _FEHL26
ELSE
_WR=0
ENDIF
_SN=$P_ADT[11]
IF(_SN==1)OR(_SN==2)
_WF=$P_ADT[10]-90
_WH=$P_ADT[24]
ELSE
_WF=$P_ADT[24]
_WH=$P_ADT[10]-90
ENDIF
IF(_WF<=15) GOTOF _FEHL7
IF(_FORM=="E")
IF(_WH<=0) GOTOF _FEHL7
ELSE
IF(_WH<=8) GOTOF _FEHL7
ENDIF
_R1_EF=_R_EF[_PITI]*_FAK3
_T1=_T2_EF[_PITI]*_FAK3
_F1=_FF[_PITI]*_FAK3
_G1=_G_EF[_PITI]*_FAK3
_P2X=-_T1
_P2Z=_F1-_T1/TAN(15)
_P1Z=_P2Z+(_T1+_EPD+_SDIS)/TAN(15)
_SPX=_EPD+_SDIS
_SPZ=_P1Z+1*_FAK3
IF(_FORM=="E")
IF(_AMODE3==0)
_VRT=(_VRT-_SPD)*_AI
IF(_VRT<0) GOTOF _FEHL20
ELSE
_VRT=ABS(_VRT)
ENDIF
_P3Z=0
_P4X=_VRT
_P4Z=0
ELSE
_P3Z=-_G1*TAN(8)
_P4X=_EPL/TAN(8)+_G1-_T1
_P4Z=_EPL
ENDIF
_SPX=_SPD+_SPX*_AI _SPZ=_SPL-_SPZ*_PM
_P1Z=_SPL-_P1Z*_PM
_P2Z=_SPL-_P2Z*_PM _P2X=_SPD+_P2X*_AI
_P3Z=_SPL-_P3Z*_PM
_P4Z=_SPL-_P4Z*_PM _P4X=_SPD+_P4X*_AI
IF(_FORM=="F")
IF(_AMODE3==0)
_P5X=_VRT
IF(_P5X*_AI<_P4X*_AI) GOTOF _FEHL20
ELSE
_P5X=_P4X+ABS(_VRT)*_AI
ENDIF
_P6Z=_P4Z
_P6X=_P5X+_SDIS*_AI
ELSE
_P6Z=_P4Z-_SDIS*SIN(8)*_PM
_P6X=_P4X+_SDIS*COS(8)*_AI
ENDIF
SBLON
N35 G0 G40 G[10]=_GG10 AX[_XX]=_SPX*_XAF AX[_ZZ]=_SPZ
SBLOF
IF(_LAGE==1)OR(_LAGE==2)
N50 G42 AX[_ZZ]=_P1Z
ELSE
N52 G41 AX[_ZZ]=_P1Z
ENDIF
N60 G1 AX[_ZZ]=_P2Z AX[_XX]=_P2X*_XAF RND=_R1_EF F=_FFP
N70 AX[_ZZ]=_P3Z RND=_R1_EF
N80 AX[_ZZ]=_P4Z AX[_XX]=_P4X*_XAF
IF(_FORM=="F")
N90 AX[_XX]=_P5X*_XAF
ENDIF
SBLON
N100 G0 G40 G60 AX[_XX]=_P6X*_XAF AX[_ZZ]=_P6Z
_FERTIG:
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[8])
ENDIF
SBLON
RET
_FEHL1: STOPRE
N794001 SETAL(61608)
RET
_FEHL2: STOPRE
N794002 SETAL(61605)
RET
_FEHL3: STOPRE
N794003 SETAL(61158)
RET
_FEHL4: STOPRE
N794004 SETAL(61212)
RET
_FEHL5:STOPRE
N794005 SETAL(61246)
RET
_FEHL6: STOPRE
N794006 SETAL(61010)
RET
_FEHL7: STOPRE
N794007 SETAL(61286)
RET
_FEHL8:STOPRE
N794008 SETAL(61003)
RET
_FEHL9: STOPRE
N794009 SETAL(61019,"(_FORM)")
RET
_FEHL10: STOPRE
N794010 SETAL(61022,_SERR)
RET
_FEHL11: STOPRE
N794011 SETAL(61021,_SERR)
RET
_FEHL12: STOPRE
N794012 SETAL(61019,"(_AMODE)")
RET
_FEHL13: STOPRE
N794013 SETAL(61019,"(_LAGE)")
RET
_FEHL14:STOPRE
N794014 SETAL(61248)
RET
_FEHL15: STOPRE
N794015 SETAL(61019,"(_AMODE4: dec4)")
RET
_FEHL16: STOPRE
N794016 SETAL(61019,"(_SPD)")
RET
_FEHL17: STOPRE
N794017 SETAL(61019," R1/R2 ")
RET
_FEHL18: STOPRE
N794018 SETAL(61019,"(_EPD)")
RET
_FEHL19: STOPRE
N794019 SETAL(61019,"(_EPL)")
RET
_FEHL20: STOPRE
N794020 SETAL(61019,"(_VRT)")
RET
_FEHL21: STOPRE
N794021 SETAL(61019," R2 ")
RET
_FEHL22: STOPRE
N794022 SETAL(62106)
RET
_FEHL23: STOPRE
N794023 SETAL(61019,"(_PITI)")
RET
_FEHL24: STOPRE
N794024 SETAL(61019,"(_PITI)")
RET
_FEHL25: STOPRE
N794025 SETAL(61019,_SERR)
RET
_FEHL26: STOPRE
N794026 SETAL(61006)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE95_SPF
PROC CYCLE95(STRING[140] NPP,REAL MID,REAL FALZ,REAL FALX,REAL FAL,REAL FF1,REAL FF2,REAL FF3,INT VARI,REAL DT,REAL DAM,REAL _VRT,INT _GMODE,INT _DMODE) SAVE DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;
N10 DEF AXIS _ZA,_SA
N11 DEF REAL _KT[201,11]
N12 DEF INT _KTL=200,_ZRF=1,_SRF=1,IA=1,LP,SLR,AKE,AZI,ZLE,FMX,ZMX,ZUA,ZUE,ZHN,_NS,_LS,ZFE,IH1,IH2,IH3,IH4=2,IH5=0,IH6,IH7,IH8,II,PLAN,_MK[15],_PTABA=0,_PTABE,_VR,_LSNEU
N13 DEF INT _ZMXN,_MERKIH1=1,_MSPL=20,_IH1,_II,_MERK_CDON,_IS_CYCFR,_ZZSD[15],_DMODE1,_DMODE4,_TYP,_GG10,_GG29,_GG7=1,_ZSD13I
N14 DEF INT _ARTIS[16]
N15 DEF REAL TAK[6]=(0,0,1,1,0),ATT,HH1,HH2,HH3,HH4,HH5,HH6,ZT[2,11],ZSP[4],HEA[6],SEC[2],LSP[3,2],SM[2],SAB[7],_DB,_ATTAB,_EPS=0.001
N16 DEF REAL _MERKSP[20,6],_MERKWZR,_NZP[2],_DH,_RE_TR[2],_FAK1,S_DELTAZ
N17 DEF STRING[32] _SLA,_SLE
N18 DEF STRING[100] _PNAME
N19 DEF STRING[250] _SERR
N20 DEF BOOL FLAG
N21 DEF CHAR BTA="L"
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE95_MPF"
DEF STRING[40] _LOG_FILE
DEF INT _LOG,_LOG_ON=0
DEF INT JJ
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE95_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1] ="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1] ="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1] ="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1] ="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1] ="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1] ="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1] ="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"   ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"   ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"   ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"   ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"   ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"   ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[0]="<<_ZSD[0]<<"  ; Bewertung Zustelltiefe MID")
WRITE(_TEMP,_TEMP_FILE,"_ZSD[13]="<<_ZSD[13]<<"  ; Schalter G40 oder G41/42 beim Schruppen")
WRITE(_TEMP,_TEMP_FILE,"CYCLE95("<<"'"'"<<NPP<<"'"'"<<","<<MID<<","<<FALZ<<","<<FALX<<","<<FAL<<","<<FF1<<","<<FF2<<","<<FF3<<","<<VARI<<","<<DT<<","<<DAM<<","<<_VRT<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (_SC_Y_TURN<>0)
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE95_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE95: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"Aufrufendes Programm: "<<$P_PROG[$P_STACK-1])
WRITE(_LOG,_LOG_FILE,"-----------------------------------")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (_ZSD[13]<>-1)
_ZSD13I=_ZSD[13]
ENDIF
IF (_ZSD13I==1)
IF VARI MOD 1000 < 100
VARI=VARI+200
ENDIF
ENDIF
IH1=VARI DIV 100 IH1=IH1 MOD 10
IF IH1>2 GOTOF FEHL6
IF IH1>0
_MK[10]=IH1 VARI=VARI - (100*IH1)
ENDIF
IH1=VARI DIV 1000
IF IH1>1 GOTOF FEHL6
IF IH1==1
_MK[9]=1 VARI=VARI MOD 100
ENDIF
IF (VARI==0)OR(VARI>12) GOTOF FEHL6
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_IS_CYCFR=1
ENDIF
IF $P_TOOL==0
GOTOF FEHL1
ENDIF
N11 ATT=$P_TOOLR
N12 IF $P_TOOLNO<>0
_MK[4]=$P_ADT[2]
ENDIF
_DMODE1=_DMODE _DEC1
IF ((_DMODE1<0) OR (_DMODE1)>3) GOTOF _FEHL9
IF((_DMODE1>0)AND(_DMODE1<4))
G[6]=_DMODE1
ENDIF
IF _VRT==0
IF ($P_GG[13]==2) OR ($P_GG[13]==4)
_VRT=1
ELSE
_VRT=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_ZA=$P_AXN2 _SA=$P_AXN1 ZT[0,2]=11 ZT[1,2]=11 IH1=(VARI-1) MOD 4 II=VARI-IH1 SM[0]=FALZ+FAL SM[1]=FALX+FAL LP=VARI MOD 2 VARI=II _PTABE=_KTL
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_GG29=$P_GG[29]
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
PLAN=1
ELSE
PLAN=2
DIAMON
ENDIF
IF LP GOTOF _MAX1
_ZA=$P_AXN1 _SA=$P_AXN2 BTA="P" SM[0]=FALX+FAL SM[1]=FALZ+FAL
_MAX1:IF IH1<2 GOTOF _M1
IA=-1 BTA="G"
IF LP GOTOF _M1
BTA="N"
_M1:_DMODE4=_DMODE _DEC4
IF ((_DMODE4<0) OR (_DMODE4>1)) GOTOF _FEHL8
IF (((NPP<>"") AND (_DMODE4==1)) OR ((NPP=="") AND (_DMODE4==0))) GOTOF _FEHL10
IF (_DMODE4==1) GOTOF _CONTNEW62
IH2=STRLEN(NPP) IH1=0
FOR II=0 TO IH2
IF SUBSTR(NPP,II,1)==":"
IF IH1<>0
GOTOF _M5201
ENDIF
IH1=II
ENDIF
ENDFOR
_M5201:
IF IH1==0 GOTOF _M5202
IF (IH1<>0) AND (II==STRLEN(NPP))
_SLA=SUBSTR(NPP,0,IH1) _SLE=SUBSTR(NPP,IH1+1,IH2-IH1-1)
ELSE
_PNAME=SUBSTR(NPP,0,IH1)
_SLA=SUBSTR(NPP,IH1+1,II-IH1-1)
_SLE=SUBSTR(NPP,II+1,STRLEN(NPP)-II-1)
ENDIF
_M5202: GOTOF _ENDCONTNEW
_CONTNEW62:
IF ISVAR("_SC_LAST_CONT")
IF (_SC_LAST_CONT>1) OR (_SC_FIRST_CONT<>1)
GOTOF _FEHL16
ELSE
IF (STRLEN(_SC_CONT_NAME[_SC_FIRST_CONT-1])>100)
_SERR=<<_SC_CONT_NAME[_SC_FIRST_CONT-1]
GOTOF _FEHL20
ENDIF
_PNAME=_SC_CONT_NAME[_SC_FIRST_CONT-1]
_SLA=_SC_CONT_LAB1[_SC_FIRST_CONT-1]
_SLE=_SC_CONT_LAB2[_SC_FIRST_CONT-1]
ENDIF
ELSE
ENDIF
_ENDCONTNEW:
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF $MN_SCALING_SYSTEM_IS_METRIC
IF $P_GG[13]==1
TAK[3]=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF $P_GG[13]==2
TAK[3]=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF _EPS<1/$MN_INT_INCR_PER_MM
_EPS=1/$MN_INT_INCR_PER_MM
ENDIF
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
_EPS=_EPS/10
ENDIF
_MERK_CDON=$P_GG[23]
CDOF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL15
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL15
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL15
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
G[29]=_GG29
N2 CONTPRON(_KT,BTA,IH2,1)
IF ((_PNAME=="") AND (_SLA=="") AND (_SLE==""))
N20 CALL NPP
ELSE
IF (_PNAME=="")
N20 CALL $P_PROG[$P_STACK-1] BLOCK _SLA TO _SLE
ELSE
IF ((_SLA=="") AND (_SLE==""))
N20 CALL _PNAME
ELSE
N20 CALL _PNAME BLOCK _SLA TO _SLE
ENDIF
ENDIF
ENDIF
N21 EXECUTE(II)
IF II==1 GOTOF FEHL4
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";Konturaufbereitung mit   BTA="<<BTA)
WRITE(_LOG,_LOG_FILE,";Status Konturaufbereitung II="<<II)
WRITE(_LOG,_LOG_FILE,"-----------------------------------")
WRITE(_LOG,_LOG_FILE,";Konturtabelle:")
FOR JJ=0 TO _KTL
WRITE(_LOG,_LOG_FILE,";_KT["<<JJ<<",0]=SET("<<_KT[JJ,0]<<","<<_KT[JJ,1]<<","<<_KT[JJ,2]<<","<<_KT[JJ,3]<<","<<_KT[JJ,4]<<","<<_KT[JJ,5]<<","<<_KT[JJ,6]<<","<<_KT[JJ,7]<<","<<_KT[JJ,8]<<","<<_KT[JJ,9]<<","<<_KT[JJ,10]<<")")
IF _KT[JJ,7]>0
WRITE(_LOG,_LOG_FILE,";Max: "<<JJ)
ENDIF
IF _KT[JJ,7]<0
WRITE(_LOG,_LOG_FILE,";Min: "<<JJ)
ENDIF
ENDFOR
WRITE(_LOG,_LOG_FILE,"-----------------------------------")
ENDIF
IF $P_GG[29]==3
N22 DIAMON
ENDIF
HH1=_KT[0,5+LP] HH2=_KT[_PTABE,1] HH2=_KT[HH2,3+LP] HH3=HH2-HH1
IF ABS(HH3)<_EPS
ZLE=_KT[0,0] AKE=_KT[0,1] _KT[0,1]=1 _KT[ZLE,1]=0 _PTABA=0 _VR=0
_MK[0]=_KT[AKE+1,0]
GOTOF _AUSWE
ELSE
IF (HH3*IA>0)
ZLE=_KT[0,0] AKE=_KT[0,1] _KT[0,1]=1 _KT[ZLE,1]=0 _PTABA=0 _VR=0
_MK[0]=_KT[AKE+1,0]
GOTOF _AUSWE
ELSE
ZLE=_PTABE-1 AKE=_PTABE-_KT[_PTABE,0] _PTABA=_KT[_PTABE,1] _VR=1 _MK[0]=_KT[0,1]+1 _MK[0]=_KT[_MK[0],1]
_SZLE:
IF _KT[ZLE,1]==0
GOTOF _AUSWE
ENDIF
ZLE=_KT[ZLE,1]
GOTOB _SZLE
GOTOF _AUSWE
ENDIF
ENDIF
_AUSWE:
IH1=$P_GG[13] IH1=IH1 MOD 2
IF IH1==1
ZT[0,2]=1 ZT[1,2]=1
ENDIF
HH6=1/$MN_INT_INCR_PER_MM
IF ($MN_INT_INCR_PER_MM==1000)
HH6=0.0001
ENDIF
_SUCHEPS:
IF NOT _VR
II=1
ELSE
II=_PTABA
ENDIF
_NEXT_II:
IF (ABS(_KT[II,5+LP]-_KT[II,3+LP])<HH6)
IH7=_KT[II,1]
_KT[II,5+LP]=_KT[II,3+LP] _KT[IH7,3+LP]=_KT[II,5+LP]
ENDIF
IF (ABS(_KT[II,5+LP]-_KT[II,3+LP])<_EPS) AND (NOT (_KT[II,3+LP]==_KT[II,5+LP]))
_EPS=_EPS/10
GOTOB _SUCHEPS
ENDIF
II=_KT[II,1]
IF NOT (II==ZLE) GOTOB _NEXT_II
_MAX3:ZFE=ZLE HH1=_KT[0,4-LP]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";Rechengenauigkeit:   MD 10200="<<$MN_INT_INCR_PER_MM)
WRITE(_LOG,_LOG_FILE,";interne Schranke :       _EPS="<<_EPS)
WRITE(_LOG,_LOG_FILE,";Konturrichtung   :        _VR="<<_VR<<" ;0=vorwrts, 1=rckwrts")
WRITE(_LOG,_LOG_FILE,";Anzahl Hinterschnitte: _MK[0]="<<_MK[0])
ENDIF
IF NOT _VR
HH2=_KT[0,6-LP] HH3=_KT[ZLE,6-LP]
ELSE
HH2=_KT[_PTABA,4-LP] HH3=_KT[ZLE,6-LP]
ENDIF
IF $P_SUBPAR[13]
IF ((_GMODE _DEC1 >1) OR (_GMODE <0))
GOTOF _FEHL17
ENDIF
_ZZSD[0]=_GMODE _DEC1
ELSE
IF (_ZSD[0]<>-1)
_ZZSD[0]=_ZSD[0]
ENDIF
ENDIF
IF _ZZSD[0]==0 GOTOF _MY30
IF NOT(($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
IF _ZA==AXNAME($MC_DIAMETER_AX_DEF)
MID=MID*PLAN/_ZZSD[0]
ENDIF
ENDIF
_MY30:IF ((HH1-HH2)*(HH1-HH3)<0) AND ((_KT[0,3+LP]-_KT[0,5+LP])*(_KT[0,3+LP]-_KT[ZLE,5+LP])<0) GOTOF FEHL5
IF PLAN==1 GOTOF _MQ3
IF NOT(($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
IF _ZA==AXNAME($MC_DIAMETER_AX_DEF)
MID=MID/2 SM[1]=SM[1]/2 _ZRF=PLAN
GOTOF _MQ3
ENDIF
ENDIF
IF NOT(($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
IF _SA==AXNAME($MC_DIAMETER_AX_DEF)
SM[0]=SM[0]/2 _SRF=PLAN
ENDIF
ENDIF
N30 _MQ3:ATT=ATT*TAK[3] HH4=1/$P_ACTFRAME[_ZA,SC] HH5=1/$P_ACTFRAME[_SA,SC]
IF NOT((HH2-HH3)==0)
SLR=(HH2-HH3)/ABS(HH2-HH3)
ELSE
SLR=1
ENDIF
SAB[LP]=_VRT*IA*HH4 SAB[1-LP]=_VRT*SLR*HH5
SAB[2+LP]=IA*ATT*HH4+SAB[LP] SAB[3-LP]=SLR*ATT*HH5+SAB[1-LP] SAB[4]=2*IA*ATT*HH4
_MERKWZR=ATT
ZSP[1-LP]=HH2+SLR*HH5*(_VRT+2*ATT) ZSP[LP]=_KT[ZLE,5+LP]+SAB[2+LP]
ZSP[3-LP]=HH2+SLR*HH5*(_VRT) ZSP[2+LP]=_KT[ZLE,5+LP]+SAB[LP]
SM[0]=SM[0]*SLR*_SRF SM[1]=SM[1]*IA*_ZRF _MK[5]=42
IF LP AND(IA*SLR>0)OR(LP==0)AND(IA*SLR<0) GOTOF _YA3
_MK[5]=41
_YA3:
IF ((VARI==5) AND (_VR==1))
_MK[13]=1
ZLE=_KT[0,0] AKE=_KT[0,1] _KT[0,1]=1 _KT[ZLE,1]=0 _PTABA=0 _VR=0
_MK[0]=_KT[AKE+1,0]
IF _MK[5]==41
_MK[5]=42
ELSE
_MK[5]=41
ENDIF
ENDIF
IF _ZSD13I==0
_GG7=_MK[5]-39
ELSE
_GG7=1
ENDIF
_MBX3:ZT[0,4-LP]=ZSP[1-LP] ZT[0,6-LP]=HH3-SLR*10 ZMX=ZLE II=_PTABA
_DB=2*SLR*ATT+2*SM[0] _DH=ABS(SM[1])
IF _MK[0]==0 GOTOF _MAX4
_MCX3:FMX=_KT[II,7] II=_KT[II,1]
IF FMX==0 GOTOB _MCX3 IF FMX>0 GOTOF _MDX3
FMX=ABS(FMX)
GOTOF _MEX3
_MDX3:FMX=_KT[II,0]
_MEX3:II=1 HH3=FMX ZMX=FMX HH4=_KT[ZLE,5+LP] HH1=ABS(HH4-_KT[FMX,3+LP])
IF II==_MK[0] GOTOF _MAX4
_MFX3:HH3=ABS(_KT[HH3,7]) HH3=ABS(_KT[HH3,7]) HH2=ABS(HH4-_KT[HH3,3+LP]) II=II+1
IF HH2>=HH1 GOTOF _MHX3 IF HH2>=_EPS GOTOF _MXG3
ZFE=HH3
GOTOF _MAX4
_MXG3:ZMX=HH3 HH1=HH2
_MHX3:IF II<_MK[0] GOTOB _MFX3
_MAX4:HH1=0 II=_PTABA IH1=IA*SLR IH2=1 HH4=0
IF _VR==0
II=_KT[II,1]
ENDIF
_TYP=$P_ADT[1]
IF(_TYP<500)OR(_TYP>599) GOTOF _FEHL18
IF ((_TYP _DEC1)==5) GOTOF _FEHL18
N40 IF $P_TOOLNO==0 GOTOF _MBX4
HH1=$P_ADT[24]
IF _MK[13]==1
HH1=0
ENDIF
_MBX4:HH2=_KT[II,8] HH3=_KT[II,7] HH5=(90-HH2)*IH1
IH6=_KT[II,2]
IF ( (IH6 MOD 10)==0 )
_KT[II,2]=_KT[II,2]+1
ENDIF
IF ( (IH6 MOD 10)>1)
IF SQRT((_KT[II,3]-_KT[II,5])*(_KT[II,3]-_KT[II,5])+(_KT[II,4]-_KT[II,6])*(_KT[II,4]-_KT[II,6]))<=0.0015
IF (IH6 MOD 10)==2
_KT[II,2]=_KT[II,2]-1
ELSE
_KT[II,2]=_KT[II,2]-2
ENDIF
ENDIF
ENDIF
IF (((IH6 MOD 10)>1) AND ((VARI<5) OR (VARI>8)))
IF ABS( _KT[II,3+LP]-_KT[II,5+LP] ) < _EPS
IH6=_KT[II,0]
IF ((_KT[IH6,8]<90)AND(_KT[II,8]>90)AND(_KT[IH6,2]==_KT[II,2]))
_KT[IH6,5+LP]=_KT[II,5+LP] _KT[II,3+LP]=_KT[II,5+LP]
IH6=_KT[II,2] _KT[II,2]=( IH6 DIV 10) * 10 + 1
ENDIF
ENDIF
ENDIF
IF ((ABS( _KT[II,3+LP]-_KT[II,5+LP] )<_EPS) AND ((_KT[II,3+LP]-_KT[II,5+LP])*IA>0))
IH6=_KT[II,0]
IF ( (_KT[II,2]==_KT[IH6,2]) AND (_KT[II,9]==_KT[IH6,9]) AND (_KT[II,10]==_KT[IH6,10]) )
_KT[IH6,5]=_KT[II,5] _KT[IH6,6]=_KT[II,6]
_KT[IH6,1]=_KT[II,1]
IH6=_KT[II,1] _KT[IH6,0]=_KT[II,0]
ENDIF
ENDIF
IF (HH3<0) AND NOT (HH3==-1111)
IH7=ABS(HH3) IH8=_KT[IH7,7]
IF ABS(_KT[IH7,3+LP]-_KT[IH8,3+LP])<=0.0015
_MK[0]=_MK[0]-1
_KT[II,7]=_KT[IH8,7] _KT[IH7,7]=0 _KT[IH8,7]=0 _KT[IH7,8]=0
IF IH7==FMX
FMX=ABS(_KT[II,7])
ENDIF
ENDIF
ENDIF
IF (_MK[0]==0) OR (ABS(HH1)<_EPS) GOTOF _A4
IF IH1>=0 GOTOF _MCX4
HH2=180-HH2
_MCX4:IF HH3<=0 GOTOF _MDX4
IH2=1
GOTOF _MEX4
_MDX4:IF HH3==0 GOTOF _MEX4
IH2=0
_MEX4:IF (HH2>90)OR(HH1==0)OR(HH2==0) GOTOF _MXG4
IF HH2==90
IF (_KT[II,3+LP]-_KT[II,5+LP])*IA>0
IF ((_KT[II,2]==1) OR (_KT[II,2]==11) OR (_KT[II,2]==0) OR (_KT[II,2]==10) OR (_KT[II,2]==21) OR (_KT[II,2]==20) OR (_KT[II,2]==31) OR (_KT[II,2]==30))
GOTOF FEHL2
ENDIF
ENDIF
GOTOF _MXG4
ENDIF
IF HH1-HH2<=0 GOTOF FEHL2
_MXG4:IF IH2==1 GOTOF _A4 IF (HH5<=0)OR(HH5>=90) GOTOF _A4 IF HH4>=HH5 GOTOF _A4
HH4=HH5
_A4:
IF ((_KT[II,2] MOD 10 < 2) AND (_KT[II,3+LP]==_KT[II,5+LP]))
IH6=_KT[II,1]
IF ((_KT[IH6,2] MOD 10 < 2) AND (_KT[IH6,3+LP]==_KT[IH6,5+LP]) AND (_KT[II,5+LP]==_KT[IH6,5+LP]))
IH6=II II=_KT[II,1] _KT[IH6,1]=_KT[II,1] _KT[IH6,6-LP]=_KT[II,6-LP]
ENDIF
ENDIF
II=_KT[II,1]
IF II<>ZLE GOTOB _MBX4
IH6=0
IF (_KT[II,2]==0) OR (_KT[II,2]==10) OR (_KT[II,2]==20) OR (_KT[II,2]==30)
_KT[II,2]=_KT[II,2]+1
ENDIF
IF VARI==5
IF HH4==0
GOTOF _MXX4
ENDIF
IF SM[1]==0
GOTOF _MXX4
ENDIF
IF HH4>=45
GOTOF FEHL3
ENDIF
ENDIF
_MXX4:
IF (ABS( _KT[ZLE,3+LP]-_KT[ZLE,5+LP])<=SAB[2+LP])
_II=_KT[ZLE,0]
IF (ABS(_KT[_II,3+LP]-_KT[_II,5+LP])<_EPS)
IF (ABS(_KT[_II,4-LP]-_KT[_II,6-LP])>2*ABS(SAB[3-LP]))
_MK[11]=1
ENDIF
ENDIF
ENDIF
IF (VARI==5)
IF (_KT[ZLE,7]<0)
IF (_KT[ZLE,2] MOD 10 == 1)
_KT[ZLE,2]=_KT[ZLE,2]-1
ENDIF
ENDIF
ENDIF
_MAX5:IF VARI==5 GOTOF _MAX7
IF MID==0
GOTOF _FEHL19
ENDIF
ZT[1,3+LP]=-9999 ZT[1,5+LP]=9999
IF (_IS_CYCFR==1)
N32 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_ZA,SM[1]*1/_FAK1,_SA,SM[0]*1/_FAK1)
_RE_TR[0]=_RE_TR[0]+SM[1] _RE_TR[1]=_RE_TR[1]+SM[0]
ELSE
N5 ATRANS AX[_ZA]=SM[1] AX[_SA]=SM[0]
ENDIF
ATT=ZSP[LP]-SAB[2+LP] ZSP[LP]=ZSP[LP]*_ZRF ZSP[1-LP]=ZSP[1-LP]*_SRF ZSP[2+LP]=ZSP[2+LP]*_ZRF ZSP[3-LP]=ZSP[3-LP]*_SRF
IF _VR==0
HH1=ABS(ATT-_KT[_PTABA,5+LP])-ABS(SM[1])
ELSE
HH1=ABS(ATT-_KT[_PTABA,3+LP])-ABS(SM[1])
ENDIF
IF HH1<=_EPS GOTOF _MAX6
_MK[7]=1 AZI=HH1/MID+0.499 TAK[0]=HH1/AZI IH1=0 _NS=ZLE
_MERKIH1=TRUNC(ABS(SAB[4])/IH4/TAK[0])
IF _MERKIH1>=_MSPL
_MERKIH1=_MSPL-1
ENDIF
IF ((_MERKIH1==0) OR (_MK[10]>0))
_MERKIH1=1
ENDIF
IF ZFE==ZLE GOTOF _MXX5
_NS=_KT[ZFE,0]
_MXX5:SEC[0]=_KT[_NS,5] SEC[1]=_KT[_NS,6] _MK[1]=1
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF _ZSD13I==1
ZSP[0]=ZSP[2] ZSP[1]=ZSP[3]
ENDIF
N50 G0 G90 G[10]=_GG10 G[7]=_GG7 NORM F=FF1 AX[_ZA]=ZSP[LP] AX[_SA]=ZSP[1-LP]
_MBX5:_MK[1]=0 ATT=ATT-TAK[0]*IA IH1=IH1+1
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF (IH1==1)
LSP[1,0]=SEC[0] LSP[1,1]=SEC[1] _LS=_NS
_MERKSP[0,0]=SEC[0] _MERKSP[0,1]=SEC[1] _MERKSP[0,2]=_NS
IF _MK[10]==2
_MERKSP[1,0]=SEC[0] _MERKSP[1,1]=SEC[1] _MERKSP[1,2]=_NS
ENDIF
ENDIF
IF (IH1>=_MERKIH1)
IH3=(IH1-_MERKIH1) MOD _MSPL
LSP[1,0]=_MERKSP[IH3,0] LSP[1,1]=_MERKSP[IH3,1] _LS=_MERKSP[IH3,2]
ENDIF
IH3=IH1 MOD _MSPL
_MERKSP[IH3,0]=SEC[0] _MERKSP[IH3,1]=SEC[1] _MERKSP[IH3,2]=_NS
IF IH1==1
ATT=ATT-SM[1]
ENDIF
IF IH1<=_MERKIH1
_ATTAB=_KT[ZLE,5+LP]
_MK[8]=1
ELSE
_ATTAB=LSP[1,LP]+SAB[4]
IF (_ATTAB-_KT[ZLE,5+LP])*IA>0
_ATTAB=_KT[ZLE,5+LP]
_MK[8]=1
ENDIF
IF (_ATTAB-_KT[ZLE,5+LP])*IA>0
_ATTAB=_KT[ZLE,5+LP]
_MK[8]=1
ENDIF
ENDIF
IF _VR==0
_NS=_KT[_PTABA,1]
ELSE
_NS=_PTABA
ENDIF
IF IH1<>AZI GOTOF _MCX5
IF _KT[_PTABA,7]>0 GOTOF _MCX5
IF _VR==0
_NS=_KT[_PTABA,1]
ELSE
_NS=_PTABA
ENDIF
SEC[0]=_KT[_NS,3] SEC[1]=_KT[_NS,4]
IF _KT[_NS,7]>0
_MK[1]=1 _NS=_KT[_NS,0]
ENDIF
GOTOF _MEX5
_MCX5:HH3=_KT[_NS,3+LP] HH4=_KT[_NS,5+LP]
IF IA==1
IF ((HH4-ATT)>0)AND((HH3-ATT)<0)
GOTOF _C5
ENDIF
IF (ABS(HH4-ATT)<_EPS) AND ((HH3-ATT)<0)
SEC[0]=_KT[_NS,5] SEC[1]=_KT[_NS,6] _MK[1]=1
IF _KT[_NS,7]>0
_NS=_KT[_NS,0]
ENDIF
GOTOF _MEX5
ENDIF
IF ((HH4-ATT)>0) AND (ABS(HH3-ATT)<_EPS)
SEC[0]=_KT[_NS,3] SEC[1]=_KT[_NS,4]
IF NOT((_VR==1)AND(IH1==AZI))
_MK[1]=1 _NS =_KT[_NS,0]
ENDIF
GOTOF _MEX5
ENDIF
ENDIF
IF IA==-1
IF ((HH4-ATT)<0)AND((HH3-ATT)>0)
GOTOF _C5
ENDIF
IF (ABS(HH4-ATT)<_EPS) AND ((HH3-ATT)>0)
SEC[0]=_KT[_NS,5] SEC[1]=_KT[_NS,6] _MK[1]=1
IF _KT[_NS,7]>0
_NS=_KT[_NS,0]
ENDIF
GOTOF _MEX5
ENDIF
IF ((HH4-ATT)<0) AND (ABS(HH3-ATT)<_EPS)
SEC[0]=_KT[_NS,3] SEC[1]=_KT[_NS,4]
IF NOT((_VR==1)AND(IH1==AZI))
_NS=_KT[_NS,0] _MK[1]=1
ENDIF
GOTOF _MEX5
ENDIF
ENDIF
_NS=_KT[_NS,1]
GOTOB _MCX5
_C5:ZT[0,3+LP]=ATT ZT[0,5+LP]=ATT SEC[0]=SEC[0] SEC[1]=SEC[1] FLAG=INTERSEC(_KT[_NS],ZT[0],SEC)
IF FLAG==0 GOTOF FEHL7
IF (((SEC[1-LP]-_KT[_NS,6-LP])*SLR<0) AND (ABS(SEC[1-LP]-_KT[_NS,6-LP])<_EPS) AND (ABS(SEC[LP]-_KT[_NS,5+LP])<_EPS) )
SEC[0]=_KT[_NS,5] SEC[1]=_KT[_NS,6]
ENDIF
_MEX5:
IF (NOT(IH1==1))
IF (_ATTAB-_KT[ZLE,5+LP])*IA>0
LSP[2,0]=_KT[ZLE,5] LSP[2,1]=_KT[ZLE,6] _LSNEU=ZLE
ENDIF
ENDIF
IF ((_ARTIS[11]==3) AND (_ARTIS[12]<>1) AND (_ARTIS[10]==_ARTIS[4]))
M=QU(_ARTIS[7])
ENDIF
N51 G0 G90 AX[_ZA]=_ZRF*ATT
_ME544:IF DAM==0 GOTOF _MXG5
HH1=ZSP[1-LP]/_SRF
_MFX5:IF ABS(HH1-SEC[1-LP])<=DAM GOTOF _MXG5
HH1=HH1-SLR*DAM
IF ABS(HH1-SEC[1-LP])<=ABS(SAB[3-LP]) GOTOF _MXG5
N52 G1 AX[_SA]=_SRF*HH1 AX[_ZA]=_ZRF*SEC[LP]
N53 G4 F=DT
GOTOB _MFX5
_MXG5:
IF (IH1==AZI) AND ( LP==1 )
_IH1=_KT[_PTABA,1] _II=_KT[_IH1,2] _II=_II MOD 10 HH1=_KT[_IH1,8] HH5=_MERKWZR
IF _II<2
IF (HH1==0) OR (HH1==90)
IF HH1==0
SAB[5+LP]=0 SAB[6-LP]=_MERKWZR*SLR
ELSE
SAB[5+LP]=0 SAB[6-LP]=_MERKWZR*SLR
ENDIF
ELSE
HH5=HH5/2
IF _KT[_IH1,7]<=0
SAB[5+LP]=-IA*HH5*ABS(SIN(HH1))
ELSE
SAB[5+LP]=IA*HH5*ABS(SIN(HH1))
ENDIF
SAB[6-LP]=SLR*HH5*ABS(COS(HH1))
ENDIF
ELSE
IF NOT(ABS(_KT[_IH1,3]-_KT[_IH1,9]))<_EPS
HH5=HH5/2
HH2=(_KT[_IH1,4]-_KT[_IH1,10])/(_KT[_IH1,3]-_KT[_IH1,9]) HH3=HH5*HH5/(1+HH2*HH2) HH4=SQRT(HH3)
IF _KT[_IH1,7]<=0
SAB[5+LP]=-IA*(HH4)
ELSE
SAB[5+LP]=IA*(HH4)
ENDIF
SAB[6-LP]=SLR*(ABS(HH2)*HH4)
ELSE
SAB[5+LP]=0 SAB[6-LP]=_MERKWZR*SLR
ENDIF
ENDIF
IF NOT( _VR )
N541 G1 F=FF1 AX[_ZA]=_ZRF*(_KT[_PTABA,5+LP]+SAB[5+LP]) AX[_SA]=_SRF*(_KT[_PTABA,6-LP]+SAB[6-LP])
ELSE
N541 G1 F=FF1 AX[_ZA]=_ZRF*(_KT[_PTABA,3+LP]+SAB[5+LP]) AX[_SA]=_SRF*(_KT[_PTABA,4-LP]+SAB[6-LP])
ENDIF
ENDIF
N54 G1 AX[_SA]=_SRF*SEC[1-LP] AX[_ZA]=_ZRF*SEC[LP]
IF ABS(SEC[1-LP]-LSP[1,1-LP])>ABS(SAB[4])
IH5=IH5+1
ELSE
IH5=0
ENDIF
IF _MK[10]<>2
IF IH5>1
IH3=(IH1-1) MOD _MSPL
LSP[1,0]=_MERKSP[IH3,0] LSP[1,1]=_MERKSP[IH3,1] _LS=_MERKSP[IH3,2]
ENDIF
ELSE
IH3=IH1 MOD _MSPL
LSP[1,0]=_MERKSP[IH3,0] LSP[1,1]=_MERKSP[IH3,1] _LS=_MERKSP[IH3,2]
_ATTAB=LSP[1,LP]+SAB[4]
ENDIF
IF _MK[10]==1 GOTOF _M5301
IF _MK[1]==0 GOTOF _B5
_NS=_KT[_NS,1]
IF _KT[_NS,7]<=0 GOTOF _B5
_MK[1]=0 _NS=_KT[_NS,0]
_B5:HH4=_KT[_NS,3] HH5=_KT[_NS,4] _KT[_NS,3]=SEC[0] _KT[_NS,4]=SEC[1] HH1=_KT[_LS,5] HH2=_KT[_LS,6] _KT[_LS,5]=LSP[1,0] _KT[_LS,6]=LSP[1,1]
IH2=_NS
N501 IF SQRT((_KT[_NS,3]-_KT[_NS,5])*(_KT[_NS,3]-_KT[_NS,5])+(_KT[_NS,4]-_KT[_NS,6])*(_KT[_NS,4]-_KT[_NS,6]))>=_EPS GOTOF _MHX5
N55 G1 G90 AX[_ZA]=_ZRF*_KT[_NS,5+LP] AX[_SA]=_SRF*_KT[_NS,6-LP]
GOTOF _MJX5
_MHX5:IF DAM==0 GOTOF _MH5
IF ((_KT[IH2,2]>1)AND(_KT[IH2,2]<10) OR (_KT[IH2,2]>11)AND(_KT[IH2,2]<20) OR (_KT[IH2,2]>21)AND(_KT[IH2,2]<30) OR (_KT[IH2,2]>31)) GOTOF _MH5
IF ABS(_KT[IH2,8]>_EPS) GOTOF _MH5 IF ABS(_KT[IH2,4-LP]-_KT[IH2,6-LP])<=DAM GOTOF _MH5
HH3=_KT[IH2,4-LP]
_MF5:IF ABS(HH3-_KT[IH2,6-LP])<=DAM GOTOF _MG5
N552 G1 G91 AX[_SA]=_SRF*(-SLR*DAM)
N554 G4 F=DT
HH3=HH3-SLR*DAM
IF ABS(HH3-_KT[IH2,6-LP])<=ABS(SAB[3-LP]) GOTOF _MG5
GOTOB _MF5
_MG5:G1 G90 AX[_SA]=_SRF*_KT[IH2,6-LP]
GOTOF _MJX5
_MH5:_KT[IH2,3+LP]=_KT[IH2,3+LP]*_ZRF _KT[IH2,5+LP]=_KT[IH2,5+LP]*_ZRF _KT[IH2,4-LP]=_KT[IH2,4-LP]*_SRF _KT[IH2,6-LP]=_KT[IH2,6-LP]*_SRF _KT[IH2,9+LP]=_KT[IH2,9+LP]*_ZRF _KT[IH2,10-LP]=_KT[IH2,10-LP]*_SRF
IF NOT((ABS(_KT[IH2,3]-_KT[IH2,5])<_EPS) AND (ABS(_KT[IH2,4]-_KT[IH2,6])<_EPS))
IF ABS($P_EP[_ZA]*TAK[3]-_KT[IH2,5+LP])<_EPS
TAK[5]=_KT[IH2,5+LP]/_ZRF
ENDIF
N510 EXECTAB(_KT[IH2])
ENDIF
_KT[IH2,3+LP]=_KT[IH2,3+LP]/_ZRF _KT[IH2,5+LP]=_KT[IH2,5+LP]/_ZRF _KT[IH2,4-LP]=_KT[IH2,4-LP]/_SRF _KT[IH2,6-LP]=_KT[IH2,6-LP]/_SRF _KT[IH2,9+LP]=_KT[IH2,9+LP]/_ZRF _KT[IH2,10-LP]=_KT[IH2,10-LP]/_SRF
_MJX5:IF (_LS==IH2)OR(IH2==ZLE) GOTOF _MSX5
_MXM5:IF (IH2==1) AND (_KT[IH2,7]>0) GOTOF _MPP5
IH2=_KT[IH2,1]
IF _MK[10]==2 GOTOF _M5203
IF (IH5>1) AND (ABS(LSP[1,LP]-_KT[IH2,3+LP])<=ABS(TAK[0]))
ZT[1,4-LP]=_KT[IH2,4-LP]-SLR*_MERKWZR ZT[1,6-LP]=ZT[1,4-LP] IH3=IH2
_M5210:
IF _KT[IH3,7]>0
_KT[_LS,5]=HH1 _KT[_LS,6]=HH2 IH3=_KT[IH3,0] LSP[1,0]=_KT[IH3,5] LSP[1,1]=_KT[IH3,6] _LS=IH3 HH1=_KT[_LS,5] HH2=_KT[_LS,6]
IF (ABS(_KT[IH3,5+LP]-$P_EP[_ZA]*TAK[3]/_ZRF)<_EPS) AND (ABS(_KT[IH3,6-LP]-$P_EP[_SA]*TAK[3]/_SRF)<_EPS)
_LS=IH2 HH1=_KT[_LS,5] HH2=_KT[_LS,6]
GOTOF _MSX5
ENDIF
ELSE
IF ( (_KT[IH3,2] MOD 10 <= 1 ) OR ( (_KT[IH3,2] MOD 10 > 1 ) AND ( ( ABS(_KT[IH3,3]-_KT[IH3,5])>0.001) OR (ABS(_KT[IH3,4]-_KT[IH3,6])>0.001) )) )
FLAG=INTERSEC(_KT[IH3],ZT[1],_NZP)
ENDIF
IF FLAG==1
_KT[_LS,5]=HH1 _KT[_LS,6]=HH2 LSP[1,0]=_NZP[0] LSP[1,1]=_NZP[1] _LS=IH3
HH1=_KT[_LS,5] HH2=_KT[_LS,6] _KT[_LS,5]=LSP[1,0] _KT[_LS,6]=LSP[1,1]
ELSE
IF IH3==_LS
GOTOF _M5203
ENDIF
IH3=_KT[IH3,1]
IF IH3<>_LS
GOTOB _M5210
ENDIF
ENDIF
ENDIF
ENDIF
_M5203:
IF _KT[IH2,7]<=0 GOTOF _MKX5
_MPP5:
HH6=_KT[IH2,3+LP] IH2=ABS(_KT[IH2,1]) TAK[4]=1
_MPX5:IF ABS(_KT[IH2,3+LP]-HH6)<=_EPS GOTOF _MQ5
IF IH2==ZLE
IF ABS(_KT[IH2,5+LP]-HH6)<=_EPS
GOTOF _MKX5
ELSE
IF ($P_GG[13] MOD 2 == 1) AND (_MK[14]==0)
_EPS=0.001 _MK[14]=1
ENDIF
ENDIF
ENDIF
IH2=ABS(_KT[IH2,1])
GOTOB _MPX5
_MQ5:
IF DAM==0
N56 G1 G[10]=_GG10 G90 AX[_SA]=_SRF*_KT[IH2,4-LP] AX[_ZA]=_ZRF*_KT[IH2,3+LP]
GOTOF _M6203
ENDIF
HH3=$P_EP[_SA]/_SRF
_M6201:IF ABS(HH3-_KT[IH2,4-LP])<=DAM GOTOF _M6202
N552 G1 G91 AX[_SA]=_SRF*(-SLR*DAM)
N554 G4 F=DT
HH3=HH3-SLR*DAM
IF ABS(HH3-_KT[IH2,4-LP])<=ABS(SAB[3-LP]) GOTOF _M6202
GOTOB _M6201
_M6202:G1 G90 AX[_SA]=_SRF*_KT[IH2,4-LP]
_M6203:
TAK[5]=_KT[IH2,3+LP]
IF _KT[IH2,7]>0
IF ABS(_KT[IH2,3+LP]-_KT[IH2,5+LP]<_EPS)
IH2=_KT[IH2,1] IH2=_KT[IH2,1]
IF NOT((IH2==ZLE)OR(IH2==0))
GOTOB _MPX5
ENDIF
ELSE
IH2=_KT[IH2,1]
IF NOT(IH2==ZLE)
GOTOB _MPX5
ENDIF
ENDIF
ENDIF
N562 _MKX5:IF SQRT((_KT[IH2,3]-_KT[IH2,5])*(_KT[IH2,3]-_KT[IH2,5])+(_KT[IH2,4]-_KT[IH2,6])*(_KT[IH2,4]-_KT[IH2,6]))>=_EPS GOTOB _MHX5
N57 G1 G90 AX[_ZA]=_ZRF*_KT[IH2,5+LP] AX[_SA]=_SRF*_KT[IH2,6-LP]
ML5:IF (_LS<>IH2)AND(IH2<>ZLE) GOTOB _MXM5
_MSX5:_KT[_NS,3]=HH4 _KT[_NS,4]=HH5 _KT[_LS,5]=HH1 _KT[_LS,6]=HH2
IF _MK[1]==0 GOTOF _MTX5
_NS=_KT[_NS,0]
_MTX5:
_M5301:
IF (IA==-1) AND (IH1==1) AND (_MK[10]==2)
IF NOT (AZI==1)
IF ABS(SAB[4])>ABS(TAK[0])
N579 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4]-TAK[0]*IA)*_ZRF
ELSE
N579 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4])*_ZRF
ENDIF
ELSE
N5801 G1 G91 AX[_ZA]=_ZRF*SAB[4]
ENDIF
N5802 G0 G91 AX[_ZA]=_ZRF*SAB[LP] AX[_SA]=_SRF*SAB[1-LP]
G90
GOTOF _MY55
ENDIF
IF _MK[10]==1
IF NOT((IH1==AZI) AND (_MK[0]<>0))
N5801 G1 G91 AX[_ZA]=_ZRF*SAB[4]
N5802 G0 G91 AX[_ZA]=_ZRF*SAB[LP] AX[_SA]=_SRF*SAB[1-LP]
N5803 G90
ENDIF
GOTOF _MY55
ENDIF
IF ABS(LSP[1,LP]-_KT[ZLE,5+LP])<=_EPS
IF (ABS(SAB[4])>0)
IF (ABS(_KT[ZLE,3+LP]-_KT[ZLE,5+LP])<_EPS)
N577 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4])*_ZRF
GOTOF _MT55
ENDIF
IF (TAK[4]==1) AND ((TAK[5]-LSP[1,LP])*IA>=0)
N577 G1 G90 AX[_ZA]=(TAK[5]+SAB[4])*_ZRF
GOTOF _MT55
ENDIF
ENDIF
IF ABS(SAB[4])-ABS(TAK[0])>=0
IF ABS(SAB[4]/2)-ABS(TAK[0])<0
IF _ZSD13I==0
N578 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4]/2)*_ZRF
ENDIF
ELSE
N579 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4]-TAK[0]*IA)*_ZRF
ENDIF
ENDIF
ENDIF
IF AZI==1
N5780 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4])*_ZRF
ENDIF
IF ((IH1==AZI) AND ( _MK[0]>0))
HEA[LP]=_KT[ZMX,3+LP] HEA[1-LP]=_KT[ZMX,4-LP]
IF ((ABS($P_EP[_ZA]/_ZRF-HEA[LP])<0.001) AND (ABS($P_EP[_SA]/_SRF-HEA[1-LP])<_EPS))
GOTOF _MAX6
ENDIF
ENDIF
IF (_ATTAB-LSP[1,LP])*IA>0
IF (IH1<>AZI) OR ((IH1==AZI) AND (_MK[0])==0)
IF _ZSD13I==0
IF _MK[8]==0
N580 G1 G90 AX[_ZA]=_ATTAB*_ZRF
ELSE
N580 G1 G91 AX[_ZA]=SAB[4]*_ZRF
G90
_MK[8]=0
ENDIF
ENDIF
ELSE
IF (LSP[1,1-LP]-_KT[ZMX,4-LP])*SLR<0
N581 G1 G90 AX[_ZA]=_ATTAB*_ZRF
ELSE
IF NOT($P_EP[_ZA]/_ZRF==_KT[FMX,3+LP])
_MK[12]=0
IF ABS(LSP[1,1-LP]-_KT[FMX,4-LP])<_MERKWZR
N5821 G0 G90 AX[_ZA]=(_KT[ZMX,3+LP]+SAB[LP])*_ZRF AX[_SA]=(_KT[FMX,4-LP]+SLR*_MERKWZR)*_SRF
ELSE
N5822 G0 G90 AX[_ZA]=(_KT[ZMX,3+LP]+SAB[LP])*_ZRF
ENDIF
ELSE
_MK[12]=1
ENDIF
GOTOF _MY55
ENDIF
ENDIF
ENDIF
_MT55:TAK[4]=0 TAK[5]=0
IF ABS($P_EP[_SA]*TAK[3]-ZSP[1-LP])>ABS(_SRF*SAB[3-LP])
IF ( (IH1==1) AND (_VRT<_MERKWZR) AND ( _MK[11]==1) )
N5851 G0 G91 AX[_ZA]=_ZRF*SAB[LP]*_MERKWZR/_VRT AX[_SA]=_SRF*SAB[1-LP]*_MERKWZR/_VRT
ELSE
N5852 G0 G91 AX[_ZA]=_ZRF*SAB[LP] AX[_SA]=_SRF*SAB[1-LP]
ENDIF
ELSE
N586 G0 G91 AX[_ZA]=_ZRF*SAB[2+LP]
N587 G0 G91 AX[_SA]=_SRF*SAB[3-LP]
ENDIF
_MY55:
IF IH1>=AZI
IF _MK[0]==0
IF ABS(SAB[4])>ABS($P_EP[_SA]*TAK[3]-ZSP[3-LP])
IF VARI==1
N590 G90 AX[_SA]=ZSP[3-LP] AX[_ZA]=$P_EP[_ZA]*TAK[3]+SAB[4]*_ZRF
ELSE
N590 G90 AX[_SA]=ZSP[1-LP] AX[_ZA]=$P_EP[_ZA]*TAK[3]+SAB[4]*_ZRF+SM[1]
ENDIF
ELSE
IF VARI==1
N591 G90 AX[_SA]=ZSP[3-LP]
ELSE
N591 G90 AX[_SA]=ZSP[1-LP]
ENDIF
IF ((_ARTIS[11]==3) AND (_ARTIS[12]<>1) AND (_ARTIS[10]==_ARTIS[5]))
M=QU(_ARTIS[8])
ENDIF
IF VARI==1
N591 G90 AX[_SA]=ZSP[3-LP]
ELSE
N591 G90 AX[_SA]=ZSP[1-LP]
ENDIF
ENDIF
ENDIF
GOTOF _MVX5
ELSE
IF ((_ARTIS[11]==3) AND (_ARTIS[12]<>1) AND (_ARTIS[10]==_ARTIS[5]))
M=QU(_ARTIS[8])
ENDIF
N59 G90 AX[_SA]=ZSP[1-LP]
_MK[8]=0
GOTOB _MBX5
ENDIF
_MVX5:IF _MK[0]<>0 GOTOF _MAX6
IF VARI==1
N599 G0 G90 G40 AX[_ZA]=ZSP[2+LP]
ENDIF
_MK[0]=-1
IF _MERK_CDON==2
CDON
ENDIF
GOTOF _MAX7
_MAX6:ZMX=FMX ZT[1,3+LP]=-9999 ZT[1,5+LP]=9999
YA6:IF _MK[0]==0 GOTOF _MAX7
IF _MK[0]>1
_ZMXN=ABS(_KT[ZMX,7]) _ZMXN=ABS(_KT[_ZMXN,7])
ENDIF
_MBX6:HEA[LP]=_KT[ZMX,3+LP] HEA[1-LP]=_KT[ZMX,4-LP] ZHN=ZMX IH1=ABS(_KT[ZMX,7])
_MERKSP[0,0]=REP(0)
_MERKSP[0,5]=ZMX _MERKSP[0,3]=_KT[ZMX,3] _MERKSP[0,4]=_KT[ZMX,4]
LSP[0,0]=_KT[ZMX,3] LSP[0,1]=_KT[ZMX,4] TAK[1]=LSP[0,1-LP] ZUA=ZMX
SEC[LP]=_KT[IH1,3+LP] II=_KT[ZUA,1]
HH1=0 _MK[2]=1 _MK[3]=_KT[IH1,0] HEA[2+LP]=SEC[LP] HEA[3-LP]=_KT[_MK[3],6-LP]
_YXY6:IF ABS(_KT[_MK[3],3+LP]-_KT[_MK[3],5+LP])>=_EPS GOTOF _MCX6
HH1=ABS(_KT[_MK[3],4-LP]-HEA[3-LP]) _MK[3]=_KT[_MK[3],0] HEA[3-LP]=_KT[_MK[3],6-LP]
GOTOB _YXY6
_MCX6:
IF ABS(_KT[II,3+LP]-HEA[LP])<=_EPS
_NS=_KT[II,0]
GOTOF _MDX6
ENDIF
IF II==ZLE
_NS=II
GOTOF _MDX6
ENDIF
II=_KT[II,1]
GOTOB _MCX6
_MDX6:HH2=HEA[1-LP]
IF _MK[0]>1
ZT[0,3+LP]=_KT[_ZMXN,3+LP] ZT[0,5+LP]=ZT[0,3+LP]
FLAG=INTERSEC(_KT[ZUA],ZT[0],SEC)
HH3=ABS(SEC[1-LP]-_KT[_ZMXN,4-LP])
SEC[LP]=_KT[IH1,3+LP]
ENDIF
IF ABS(_DB)==0 GOTOF _YQD6 IF ABS(HH2-_KT[_NS,6-LP])<=ABS(_DB) GOTOF _MQ6 IF (0<HH1)AND(HH1>ABS(_DB)) GOTOF _YQD6
IF _MK[0]==1 GOTOF _M53161
IH1=ABS(_KT[ZUA,7]) IH1=ABS(_KT[IH1,7])
IF ABS(SEC[LP]-_KT[IH1,3+LP]) < _DH
HH1=ABS(HEA[LP]-_KT[IH1,3+LP])
GOTOF _M53160
ENDIF
_M53161:
_MK[2]=0 IH1=ZUA IH2=_NS
_AA60:IF ABS(_KT[IH2,8]>_EPS) GOTOF _AA6
IH2=_KT[IH2,0]
GOTOB _AA60
_AA6:HH2=_KT[IH2,3+LP] HH1=_KT[IH1,5+LP]
IF _MK[0]==1 GOTOF _AE6
IF _ZMXN>IH2
GOTOF _AE6
ELSE
IF (_KT[IH1,8]*_KT[_ZMXN,8]>0)
IF (HH3<=_DB)
_MK[2]=-1
GOTOF _AE6
ELSE
IH2=_ZMXN HH2=_KT[IH2,3+LP]
GOTOF _AE6
ENDIF
ENDIF
IH2=_ZMXN HH2=_KT[IH2,3+LP]
GOTOF _AE6
ENDIF
_MAB6:IF ABS(_KT[IH1,6-LP]-_KT[IH2,4-LP])<=ABS(_DB) GOTOF _AM6
IH1=_KT[IH1,1] IH2=_KT[IH2,0]
GOTOB _AA6
_AE6:IF ABS(HEA[LP]-HH2)>ABS(HEA[LP]-HH1) GOTOF _AH6
ZT[0,3+LP]=HH2 ZT[0,5+LP]=HH2 SEC[0]=SEC[0] SEC[1]=SEC[1] FLAG=INTERSEC(_KT[IH1],ZT[0],SEC)
IF FLAG==0 GOTOB _MAB6
IF ABS(SEC[1-LP]-_KT[IH2,4-LP])<=ABS(_DB) GOTOF _AM6
IH2=_KT[IH2,0]
GOTOB _AA6
_AH6:ZT[0,3+LP]=HH1 ZT[0,5+LP]=HH1 SEC[0]=SEC[0] SEC[1]=SEC[1] FLAG=INTERSEC(_KT[IH2],ZT[0],SEC)
IF FLAG==0 GOTOB _MAB6
IF ABS(SEC[1-LP]-_KT[IH1,6-LP])<=ABS(_DB) GOTOF _AM6
_AB6:HH1=_KT[IH1,3+LP]-_KT[IH1,5+LP] IH1=_KT[IH1,1]
IF NOT(HH1*(_KT[IH1,3+LP]-_KT[IH1,5+LP])<0) GOTOB _AA6
IH2=IH1 IH1=_KT[IH1,0]
_AM6:II=_KT[IH1,2] II=II MOD 10 _MK[6]=_KT[IH2,2] _MK[6]=_MK[6] MOD 10
IF II>1 GOTOF _K6 IF _MK[6]>1 GOTOF _GK6
_GG6:
IF NOT ( (_KT[IH1,8] ==90) )
HH1=TAN(_KT[IH1,8]) HH2=TAN(_KT[IH2,8]) HH3=_KT[IH1,3+LP]-HH1*_KT[IH1,4-LP] HH4=_KT[IH2,3+LP]-HH2*_KT[IH2,4-LP]
SEC[1-LP]=(HH4-HH3-HH2*_DB)/(HH1-HH2) SEC[LP]=HH1*SEC[1-LP]+HH3 HEA[4]=SEC[0] HEA[5]=SEC[1]
ELSE
HH2=TAN(_KT[IH2,8])
SEC[1-LP]=_KT[IH1,6-LP] SEC[LP]=_KT[IH1,5+LP]-HH2*_DB
ENDIF
GOTOF _YQD6
_GK6:HH1=TAN(_KT[IH1,8]) HH3=_KT[IH1,3+LP]-HH1*_KT[IH1,4-LP] HH2=_KT[IH2,5]-_KT[IH2,9] HH4=_KT[IH2,6]-_KT[IH2,10] HH5=HH2*HH2+HH4*HH4 HH3=HH3-_KT[IH2,9+LP] HH2=_DB+_KT[IH2,10-LP] HH4=HH1*HH1+1 SEC[0]=(HH3*HH1-HH2)/HH4
SEC[1]=(HH3*HH3+HH2*HH2-HH5)/HH4 HEA[4]=SEC[0] HEA[5]=SEC[1]
GOTOF _KK60
_K6:IF _MK[6]>1 GOTOF _KK6
_KG6:HH1=TAN(_KT[IH2,8]) HH3=_KT[IH2,3+LP]-HH1*_KT[IH2,4-LP] HH2=_KT[IH1,5]-_KT[IH1,9] HH4=_KT[IH1,6]-_KT[IH1,10] HH5=HH2*HH2+HH4*HH4 HH3=HH3-HH1*_DB-_KT[IH1,9+LP] HH4=HH1*HH1+1
HH2=_KT[IH1,10-LP] SEC[0]=(HH3*HH1-HH2)/HH4 SEC[1]=(HH3*HH3+HH2*HH2-HH5)/HH4 HEA[4]=SEC[0] HEA[5]=SEC[1]
GOTOF _KK60
_KK6:HH1=_KT[IH1,9]-_KT[IH1,3] HH2=_KT[IH1,10]-_KT[IH1,4] SEC[0]=HH1*HH1+HH2*HH2 HH1=_KT[IH2,9]-_KT[IH2,3] HH2=_KT[IH2,10]-_KT[IH2,4] SEC[1]=HH1*HH1+HH2*HH2 HH1=_KT[IH1,9+LP]-_KT[IH2,9+LP] HH1=HH1*HH1 HH5=_KT[IH1,10-LP] HH4=-HH5*HH5
HH3=_DB+_KT[IH2,10-LP] HH2=HH1+SEC[0]-SEC[1]+HH3*HH3+HH4 HH1=HH1*4 HH4=(HH4+SEC[0])*HH1 HH3=(-HH3+HH5)*2 SEC[0]=(HH2*HH3-HH1*HH5)/(HH3*HH3+HH1) SEC[1]=(HH2*HH2-HH4)/(HH3*HH3+HH1) HEA[4]=SEC[0] HEA[5]=SEC[1]
_KK60:HH4=-SEC[0] HH2=SEC[1] HH5=HH4*HH4-HH2
IF ABS(HH5)>0.0005 GOTOF _KK62
HH5=0
GOTOF _KK63
N601 _KK62:HH5=SQRT(ABS(HH5))
_KK63:HH2=HH4-HH5 HH4=HH4+HH5 ZT[1,4-LP]=HH4
IF (HH2-_KT[IH1,4-LP])*(HH2-_KT[IH1,6-LP])>0 GOTOF _KK61
ZT[1,4-LP]=HH2
_KK61:ZT[1,6-LP]=ZT[1,4-LP] SEC[0]=SEC[0] SEC[1]=SEC[1]
IF (_KT[IH1,8]==90) AND ((_KT[IH1,2]==0)OR(_KT[IH1,2]==1)OR(_KT[IH1,2]==10)OR(_KT[IH1,2]==11)OR(_KT[IH1,2]==20)OR(_KT[IH1,2]==21)OR(_KT[IH1,2]==30)OR(_KT[IH1,2]==31))
_KT[IH2,4-LP]=_KT[IH2,4-LP]+_DB _KT[IH2,6-LP]=_KT[IH2,6-LP]+_DB _KT[IH2,10-LP]=_KT[IH2,10-LP]+_DB
FLAG=INTERSEC(_KT[IH2],ZT[1],SEC)
_KT[IH2,4-LP]=_KT[IH2,4-LP]-_DB _KT[IH2,6-LP]=_KT[IH2,6-LP]-_DB _KT[IH2,10-LP]=_KT[IH2,10-LP]-_DB
IF FLAG==0
GOTOF FEHL72
ENDIF
ELSE
FLAG=INTERSEC(_KT[IH1],ZT[1],SEC)
IF FLAG==0
IF ABS(_KT[IH1,6-LP]-ZT[1,4-LP])<_EPS
SEC[0]=_KT[IH1,5] SEC[1]=_KT[IH1,6]
ELSE
GOTOF FEHL72
ENDIF
ENDIF
ENDIF
_YQD6:
IF _MK[2]==-1
IF (_KT[_ZMXN,3+LP]-SEC[LP])*IA>0
SEC[0]=_KT[_NS,3] SEC[1]=_KT[_NS,4] IH2=_NS
ENDIF
_MK[2]=0
ENDIF
HH1=ABS(HEA[LP]-SEC[LP])
_M53160: AZI=HH1/MID+0.499
IF AZI==0 GOTOF _MQ6
TAK[0]=HH1/AZI ATT=HEA[LP] SEC[0]=_KT[_NS,5] SEC[1]=_KT[_NS,6] IH1=0 ZUE=ZUA
_MERKIH1=TRUNC(ABS(SAB[4])/IH4/TAK[0])
IF _MERKIH1>=_MSPL
_MERKIH1=_MSPL-1
ENDIF
IF ((_MERKIH1==0) OR (_MK[10]>0))
_MERKIH1=1
ENDIF
IF ($P_EP[_ZA]/_ZRF*TAK[3]-HEA[LP])*IA<0 GOTOF _YQE6
IF $P_GG[7]<>1
IF _mk[12]==0
N660 G0 G90 G[10]=_GG10 AX[_SA]=_SRF*(HEA[1-LP]-SM[0]*2+SLR*_MERKWZR)
ELSE
_mk[12]=0
ENDIF
IF NOT (($P_EP[_ZA]*TAK[3]/_ZRF-(HEA[LP]+IA*_MERKWZR+SAB[LP]))*IA<0)
N661 G0 AX[_ZA]=_ZRF*(HEA[LP]+IA*_MERKWZR+SAB[LP])
ENDIF
IF NOT (($P_EP[_ZA]*TAK[3]/_ZRF-(HEA[LP]+IA*_MERKWZR))*IA<0)
N662 G1 F=FF2 AX[_ZA]=_ZRF*(HEA[LP]+IA*_MERKWZR)
ENDIF
N664 G1 F=FF2 AX[_ZA]=_ZRF*HEA[LP] RND=_MERKWZR
N666 AX[_SA]=_SRF*(HEA[1-LP]-SM[0]*2)
ELSE
N601 G0 G[7]=_GG7 G90 G[10]=_GG10 AX[_SA]=_SRF*(HEA[1-LP]-SM[0]*2)
IF _MK[7]==1
N604 G1 F=FF2 AX[_ZA]=_ZRF*HEA[LP]
ELSE
N603 G0 AX[_ZA]=_ZRF*(HEA[LP]+SAB[2+LP])
N604 G1 F=FF2 AX[_ZA]=_ZRF*HEA[LP]
ENDIF
ENDIF
GOTOF _YQF6
_YQE6:
IF $P_GG[7]<>1
N60 G0 G90 G[10]=_GG10 AX[_ZA]=_ZRF*(HEA[LP]+SAB[LP])
ELSE
N601 G0 G[7]=_GG7 G90 G[10]=_GG10 AX[_ZA]=_ZRF*(HEA[LP]+SAB[LP])
ENDIF
N61 AX[_SA]=_SRF*(HEA[1-LP]-SM[0]*2)
N62 _YE44:G1 G91 F=FF2 AX[_ZA]=_ZRF*(-SAB[LP])
_YQF6:ATT=ATT-TAK[0]*IA IH1=IH1+1
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF (IH1==1)
LSP[1,0]=SEC[0] LSP[1,1]=SEC[1] _LS=_NS
_MERKSP[0,0]=SEC[0] _MERKSP[0,1]=SEC[1] _MERKSP[0,2]=_NS
IF _MK[10]==2
_MERKSP[1,0]=SEC[0] _MERKSP[1,1]=SEC[1] _MERKSP[1,2]=_NS
ENDIF
ENDIF
IF (IH1>=_MERKIH1)
IH3=(IH1-_MERKIH1) MOD _MSPL
LSP[1,0]=_MERKSP[IH3,0] LSP[1,1]=_MERKSP[IH3,1] _LS=_MERKSP[IH3,2]
ENDIF
IH3=IH1 MOD _MSPL
_MERKSP[IH3,0]=SEC[0] _MERKSP[IH3,1]=SEC[1] _MERKSP[IH3,2]=_NS
_ATTAB=LSP[1,LP]+SAB[4]
_MFX6:IF IH1<>AZI GOTOF _YQG6 IF NOT _MK[2] GOTOF _YQG6
ZUE=_MK[3] SEC[0]=HEA[2] SEC[1]=HEA[3]
GOTOF _YQJ6
_YQG6:HH3=_KT[ZUE,3+LP] HH4=_KT[ZUE,5+LP]
IF (((HH4-ATT)>0) OR (ABS(HH4-ATT)<_EPS)) AND ((HH3-ATT)<0) GOTOF _YQH6 IF (((HH4-ATT)<0) OR (ABS(HH4-ATT)<_EPS)) AND ((HH3-ATT)>0) GOTOF _YQH6
ZUE=_KT[ZUE,1]
GOTOB _MFX6
_YQH6:ZT[0,3+LP]=ATT ZT[0,5+LP]=ATT SEC[0]=SEC[0] SEC[1]=SEC[1] FLAG=INTERSEC(_KT[ZUE],ZT[0],SEC)
IF FLAG==0 GOTOF FEHL73
IF IH1==AZI
IF (ABS(SEC[LP]-HEA[4+LP])>0) AND (ABS(SEC[LP]-HEA[4+LP])<_EPS)
SEC[0]=HEA[4] SEC[1]=HEA[5]
ENDIF
ENDIF
_YQJ6:
IF (_ATTAB-_KT[ZLE,5+LP])*IA>0
LSP[2,0]=_KT[ZLE,5] LSP[2,1]=_KT[ZLE,6] _LSNEU=ZLE
ENDIF
IF ((_ARTIS[11]==3) AND (_ARTIS[12]<>1) AND (_ARTIS[10]==_ARTIS[4]))
M=QU(_ARTIS[7])
ENDIF
HH5=SM[0]*2
IF ZUA<>ZUE GOTOF _YQK6
HH1=_KT[ZUA,3] HH2=_KT[ZUA,4] HH3=_KT[ZUA,5] HH4=_KT[ZUA,6]
_KT[ZUA,10-LP]=(_KT[ZUA,10-LP]-HH5)*_SRF _KT[ZUA,4-LP]=(LSP[0,1-LP]-HH5)*_SRF _KT[ZUA,3+LP]=LSP[0,LP]*_ZRF
_KT[ZUA,6-LP]=(SEC[1-LP]-HH5)*_SRF _KT[ZUA,5+LP]=SEC[LP]*_ZRF _KT[ZUA,9+LP]=_KT[ZUA,9+LP]*_ZRF
IF NOT((ABS(_KT[ZUA,3]-_KT[ZUA,5])<_EPS) AND (ABS(_KT[ZUA,4]-_KT[ZUA,6])<_EPS))
N63 EXECTAB(_KT[ZUA])
ENDIF
_KT[ZUA,9+LP]=_KT[ZUA,9+LP]/_ZRF _KT[ZUA,3]=HH1 _KT[ZUA,4]=HH2 _KT[ZUA,5]=HH3 _KT[ZUA,6]=HH4 _KT[ZUA,10-LP]=_KT[ZUA,10-LP]/_SRF+HH5
GOTOF _YQP6
_YQK6:HH1=_KT[ZUA,3] HH2=_KT[ZUA,4] HH3=_KT[ZUA,6-LP] HH4=_KT[ZUA,10-LP] _KT[ZUA,4-LP]=(LSP[0,1-LP]-HH5)*_SRF _KT[ZUA,3+LP]=LSP[0,LP]*_ZRF
_KT[ZUA,6-LP]=(_KT[ZUA,6-LP]-HH5)*_SRF _KT[ZUA,10-LP]=(_KT[ZUA,10-LP]-HH5)*_SRF _KT[ZUA,5+LP]=_KT[ZUA,5+LP]*_ZRF _KT[ZUA,9+LP]=_KT[ZUA,9+LP]*_ZRF
IF NOT((ABS(_KT[ZUA,3]-_KT[ZUA,5])<_EPS) AND (ABS(_KT[ZUA,4]-_KT[ZUA,6])<_EPS))
N630 EXECTAB(_KT[ZUA])
ENDIF
_KT[ZUA,5+LP]=_KT[ZUA,5+LP]/_ZRF _KT[ZUA,9+LP]=_KT[ZUA,9+LP]/_ZRF _KT[ZUA,3]=HH1 _KT[ZUA,4]=HH2 _KT[ZUA,6-LP]=HH3 _KT[ZUA,10-LP]=HH4 HH3=_KT[ZUE,5] HH4=_KT[ZUE,6] _KT[ZUE,6-LP]=SEC[1-LP]-HH5 _KT[ZUE,5+LP]=SEC[LP] IH2=ZUA
_YQL6:IH2=_KT[IH2,1]
IF IH2==ZUE GOTOF _YQM6
HH1=_KT[IH2,4-LP] HH2=_KT[IH2,6-LP] _KT[IH2,4-LP]=_KT[IH2,4-LP]-HH5 _KT[IH2,6-LP]=_KT[IH2,6-LP]-HH5 _KT[IH2,10-LP]=_KT[IH2,10-LP]-HH5
IF ABS(_KT[IH2,3+LP]-_KT[IH2,5+LP])>=_EPS GOTOF _A6
N64 G1 F=FF1
_A6:_KT[IH2,3+LP]=_KT[IH2,3+LP]*_ZRF _KT[IH2,5+LP]=_KT[IH2,5+LP]*_ZRF _KT[IH2,4-LP]=_KT[IH2,4-LP]*_SRF _KT[IH2,6-LP]=_KT[IH2,6-LP]*_SRF _KT[IH2,9+LP]=_KT[IH2,9+LP]*_ZRF _KT[IH2,10-LP]=_KT[IH2,10-LP]*_SRF
IF NOT((ABS(_KT[IH2,3]-_KT[IH2,5])<_EPS) AND (ABS(_KT[IH2,4]-_KT[IH2,6])<_EPS))
N640 EXECTAB(_KT[IH2])
ENDIF
_KT[IH2,3+LP]=_KT[IH2,3+LP]/_ZRF _KT[IH2,5+LP]=_KT[IH2,5+LP]/_ZRF _KT[IH2,4-LP]=_KT[IH2,4-LP]/_SRF _KT[IH2,6-LP]=_KT[IH2,6-LP]/_SRF _KT[IH2,9+LP]=_KT[IH2,9+LP]/_ZRF _KT[IH2,10-LP]=_KT[IH2,10-LP]/_SRF
N640 G1 F=FF2
_KT[IH2,10-LP]=_KT[IH2,10-LP]+HH5 _KT[IH2,4-LP]=HH1 _KT[IH2,6-LP]=HH2
GOTOB _YQL6
_YQM6:_KT[ZUE,4-LP]=_KT[ZUE,4-LP]-HH5 _KT[ZUE,10-LP]=_KT[ZUE,10-LP]-HH5
IF ABS(_KT[ZUE,3+LP]-_KT[ZUE,5+LP])>=_EPS GOTOF _B6
N65 G1 F=FF1
_B6:_KT[ZUE,3+LP]=_KT[ZUE,3+LP]*_ZRF _KT[ZUE,5+LP]=_KT[ZUE,5+LP]*_ZRF _KT[ZUE,4-LP]=_KT[ZUE,4-LP]*_SRF _KT[ZUE,6-LP]=_KT[ZUE,6-LP]*_SRF _KT[ZUE,9+LP]=_KT[ZUE,9+LP]*_ZRF _KT[ZUE,10-LP]=_KT[ZUE,10-LP]*_SRF
IF NOT((ABS(_KT[ZUE,3]-_KT[ZUE,5])<_EPS) AND (ABS(_KT[ZUE,4]-_KT[ZUE,6])<_EPS))
N650 EXECTAB(_KT[ZUE])
ENDIF
_KT[ZUE,3+LP]=_KT[ZUE,3+LP]/_ZRF _KT[ZUE,5+LP]=_KT[ZUE,5+LP]/_ZRF _KT[ZUE,4-LP]=_KT[ZUE,4-LP]/_SRF _KT[ZUE,6-LP]=_KT[ZUE,6-LP]/_SRF
_KT[ZUE,9+LP]=_KT[ZUE,9+LP]/_ZRF _KT[ZUE,10-LP]=_KT[ZUE,10-LP]/_SRF _KT[ZUE,4-LP]=_KT[ZUE,4-LP]+HH5 _KT[ZUE,10-LP]=_KT[ZUE,10-LP]+HH5 _KT[ZUE,5]=HH3 _KT[ZUE,6]=HH4
_YQP6:
IF (IH1>_MERKIH1)
IH3=(IH1-_MERKIH1) MOD _MSPL
LSP[0,0]=_MERKSP[IH3,3] LSP[0,1]=_MERKSP[IH3,4] ZUA=_MERKSP[IH3,5]
IF ABS(LSP[0,LP]-_KT[ZUA,5+LP])<_EPS
ZUA=_KT[ZUA,1]
ENDIF
ENDIF
IH3=IH1 MOD _MSPL
_MERKSP[IH3,3+LP]=SEC[LP] _MERKSP[IH3,4-LP]=SEC[1-LP]-HH5
_MERKSP[IH3,5]=ZUE TAK[1]=LSP[0,1-LP]
IF IH1<=_MERKIH1
TAK[1]=TAK[1]-HH5
ENDIF
II=ABS(_KT[ZHN,7])
IF IH1<>AZI GOTOF _MXG6 IF ABS(_DB)<>0 GOTOF _MXG6
_NS=II SEC[0]=_KT[II,3] SEC[1]=_KT[II,4]
GOTOF _YQQ6
_MXG6:HH3=_KT[II,3+LP] HH4=_KT[II,5+LP]
IF (IA==1)AND (ABS(HH3-HH4)>=_EPS)
IF ((HH4-ATT)>0) AND ((HH3-ATT)<0) GOTOF _MHX6
IF (ABS(HH4-ATT)<_EPS) AND ((HH3-ATT)<0)
SEC[0]=_KT[II,5] SEC[1]=_KT[II,6]
_NS=_KT[II,1]
IF _KT[_NS,7]>0
_NS=_KT[_NS,0]
ENDIF
GOTOF _E6
ENDIF
IF ((HH4-ATT)>0) AND (ABS(HH3-ATT)<_EPS)
SEC[0]=_KT[II,3] SEC[1]=_KT[II,4] _MK[1]=1
_NS=_KT[II,0]
GOTOF _E6
ENDIF
ENDIF
IF (IA==-1)AND(ABS(HH3-HH4)>=_EPS)
IF ((HH4-ATT)<0) AND ((HH3-ATT)>0) GOTOF _MHX6
IF (ABS(HH4-ATT)<_EPS) AND ((HH3-ATT)>0)
SEC[0]=_KT[II,5] SEC[1]=_KT[II,6]
_NS=_KT[II,1]
IF _KT[_NS,7]>0
_NS=_KT[_NS,0]
ENDIF
GOTOF _E6
ENDIF
IF ((HH4-ATT)<0) AND (ABS(HH3-ATT)<_EPS)
SEC[0]=_KT[II,3] SEC[1]=_KT[II,4] _MK[1]=1
_NS=_KT[II,0]
GOTOF _E6
ENDIF
ENDIF
II=_KT[II,1]
GOTOB _MXG6
_MHX6:_NS=II _MK[1]=0
_MJX6:SEC[0]=SEC[0] SEC[1]=SEC[1] ZT[0,3+LP]=ATT ZT[0,5+LP]=ATT FLAG=INTERSEC(_KT[_NS],ZT[0],SEC)
IF FLAG==0 GOTOF FEHL75
_E6:
IF ($P_EP[_SA]/_SRF-SEC[1-LP])*SLR<0
IF ABS($P_EP[_SA]/_SRF-SEC[1-LP])<0.001
GOTOF _M5304
ENDIF
II=_KT[_NS,1]
GOTOB _MXG6
ENDIF
_M5304:
IF DAM==0 GOTOF _YQQ6
HH1=$P_EP[_SA]/_SRF
_YXR6:IF ABS(HH1-SEC[1-LP])<=DAM GOTOF _YQQ6
HH1=HH1-SLR*DAM
IF ABS(HH1-SEC[1-LP])<=ABS(SAB[3-LP]) GOTOF _YQQ6
N66 G1 AX[_SA]=_SRF*HH1 AX[_ZA]=_ZRF*SEC[LP] F=FF1
N660 G4 F=DT
GOTOB _YXR6
_YQQ6: S_DELTAZ=ABS($P_EP[_SA]-_SRF*SEC[1-LP])
N66 G1 AX[_SA]=_SRF*SEC[1-LP] AX[_ZA]=_ZRF*SEC[LP] F=FF1
IF ABS(SEC[1-LP]-LSP[1,1-LP])>ABS(SAB[4])
IH5=IH5+1
ELSE
IH5=0
ENDIF
IF _MK[10]<>2
IF IH5>1
IH3=(IH1-1) MOD _MSPL
LSP[1,0]=_MERKSP[IH3,0] LSP[1,1]=_MERKSP[IH3,1] _LS=_MERKSP[IH3,2]
ENDIF
ELSE
IH3=IH1 MOD _MSPL
LSP[1,0]=_MERKSP[IH3,0] LSP[1,1]=_MERKSP[IH3,1] _LS=_MERKSP[IH3,2]
_ATTAB=LSP[1,LP]+SAB[4]
ENDIF
IF (IH1==1)
IH3=_LS IH6=0
IF (_LS==ZLE) AND (ABS(LSP[1,LP]-_KT[ZLE,5+LP])<_EPS)
GOTOF _M5231
ENDIF
_M5230: IH3=_KT[IH3,1]
IF NOT (_KT[IH3,7]<>0)
_NZP[0]=_KT[IH3,5] _NZP[1]=_KT[IH3,6]
IF SQRT( (_NZP[0]-LSP[1,0])*(_NZP[0]-LSP[1,0]) + (_NZP[1]-LSP[1,1])*(_NZP[1]-LSP[1,1]) ) - _MERKWZR <0
IF NOT(IH3==ZLE)
GOTOB _M5230
ELSE
_ATTAB=_ATTAB+(_NZP[LP]-LSP[1,LP])
_LS=IH3 LSP[1,0]=_KT[_LS,5] LSP[1,1]=_KT[_LS,6]
GOTOF _M5231
ENDIF
ELSE
IF NOT(IH3==ZLE)
IF (_KT[IH3,5+LP]-_ATTAB)* IA>0
ZT[0,3+LP]=LSP[0,LP]+SAB[4] ZT[0,5+LP]=ZT[0,3+LP] _LS=IH3
FLAG=INTERSEC(_KT[IH3],ZT[0],LSP[1])
IF FLAG==0 GOTOF FEHL76
ELSE
_ATTAB=_ATTAB+(_NZP[LP]-LSP[1,LP])
_LS=IH3 LSP[1,0]=_KT[_LS,5] LSP[1,1]=_KT[_LS,6]
ENDIF
ELSE
IF (_KT[ZLE,5+LP]-_ATTAB)* IA>0
ZT[0,3+LP]=LSP[0,LP]+SAB[4] ZT[0,5+LP]=ZT[0,3+LP]
FLAG=INTERSEC(_KT[ZLE],ZT[0],LSP[1])
IF NOT(AZI==1)
_LS=ZLE
ENDIF
IF FLAG==0 GOTOF FEHL76
ENDIF
ENDIF
ENDIF
ELSE
IF (_KT[IH3,7]<0) AND (_KT[IH3,7]>-99)
IH6=1
ENDIF
ENDIF
ELSE
IH6=0
ENDIF
_M5231:
IF _MK[10]==1 GOTOF _M5302
IF _MK[1]==0 GOTOF _D6
_NS=_KT[_NS,1]
_D6:HH4=_KT[_NS,3] HH5=_KT[_NS,4] _KT[_NS,3]=SEC[0] _KT[_NS,4]=SEC[1] HH1=_KT[_LS,5] HH2=_KT[_LS,6] _KT[_LS,5]=LSP[1,0] _KT[_LS,6]=LSP[1,1] IH2=_NS
GOTOF _YQW6
_YXS6:IH2=_KT[IH2,1]
IF _KT[IH2,7]<=0 GOTOF _YQW6
IF ABS(HEA[LP]-_KT[IH2,3+LP])<=_EPS
N684 G1 G90 AX[_ZA]=LSP[1,LP]*_ZRF
GOTOF _YQX6
ENDIF
HH3=_KT[IH2,3+LP] IH2=_KT[IH2,1]
_YQT6:IF (ABS(_KT[IH2,3+LP]-HH3)<=_EPS) AND (_KT[IH2,7]<=0) GOTOF _YQU6
IH2=_KT[IH2,1]
GOTOB _YQT6
N67 _YQU6:G1 G[10]=_GG10 G90 AX [_SA]=_SRF*_KT[IH2,4-LP] AX[_ZA]=_ZRF*_KT[IH2,3+LP]
IH3=(IH1+1) MOD _MSPL _MERKSP[IH3,0]=SEC[0] _MERKSP[IH3,1]=SEC[1] _MERKSP[IH3,2]=_NS
_ATTAB=LSP[1,LP]+SAB[4]
_YQW6:IF DAM==0 GOTOF _YW6
IF (_KT[IH2,2]>1)AND(_KT[IH2,2]<10) OR (_KT[IH2,2]>11)AND(_KT[IH2,2]<20) OR (_KT[IH2,2]>21)AND(_KT[IH2,2]<30) OR (_KT[IH2,2]>31) GOTOF _YW6
IF ABS(_KT[IH2,8]>_EPS) GOTOF _YW6 IF ABS(_KT[IH2,4-LP]-_KT[IH2,6-LP])<=DAM GOTOF _YW6
HH3=_KT[IH2,4-LP]
_MF6:IF ABS(HH3-_KT[IH2,6-LP])<=DAM GOTOF _MG6
N680 G1 G91 AX[_SA]=_SRF*(-SLR*DAM)
N681 G4 F=DT
HH3=HH3-SLR*DAM
IF ABS(HH3-_KT[IH2,6-LP])<=ABS(SAB[3-LP]) GOTOF _MG6
GOTOB _MF6
N682 _MG6:G1 G90 AX[_SA]=_SRF*_KT[IH2,6-LP]
GOTOF _YX6
_YW6:_KT[IH2,3+LP]=_KT[IH2,3+LP]*_ZRF _KT[IH2,5+LP]=_KT[IH2,5+LP]*_ZRF _KT[IH2,4-LP]=_KT[IH2,4-LP]*_SRF _KT[IH2,6-LP]=_KT[IH2,6-LP]*_SRF _KT[IH2,9+LP]=_KT[IH2,9+LP]*_ZRF _KT[IH2,10-LP]=_KT[IH2,10-LP]*_SRF
IF NOT((ABS(_KT[IH2,3]-_KT[IH2,5])<_EPS) AND (ABS(_KT[IH2,4]-_KT[IH2,6])<_EPS))
IF ABS($P_EP[_ZA]*TAK[3]-_KT[IH2,5+LP])<_EPS
TAK[5]=_KT[IH2,5+LP]/_ZRF TAK[4]=1
ENDIF
N683 EXECTAB(_KT[IH2])
ENDIF
_KT[IH2,3+LP]=_KT[IH2,3+LP]/_ZRF _KT[IH2,5+LP]=_KT[IH2,5+LP]/_ZRF _KT[IH2,4-LP]=_KT[IH2,4-LP]/_SRF _KT[IH2,6-LP]=_KT[IH2,6-LP]/_SRF _KT[IH2,9+LP]=_KT[IH2,9+LP]/_ZRF _KT[IH2,10-LP]=_KT[IH2,10-LP]/_SRF
_YX6:IF IH2==ZLE GOTOF _YQX6
IF _MK[10]==2 GOTOF _M5221
IF ( (AZI==1) AND (IH1==1) )
IF (ABS(_KT[_LS,3+LP]-_KT[_LS,5+LP])<_EPS )
LSP[1,LP]=_KT[_LS,3+LP] LSP[1,1-LP]=_KT[_LS,4-LP]
_KT[_LS,5]=HH1 _KT[_LS,6]=HH2
_LS=_KT[_LS,0]
HH1=_KT[_LS,5] HH2=_KT[_LS,6]
ENDIF
GOTOF _M5221
ENDIF
IF (IH5>1) AND (ABS(LSP[1,LP]-_KT[IH2,3+LP])<=ABS(TAK[0]))
ZT[1,4-LP]=_KT[IH2,4-LP]-SLR*_MERKWZR ZT[1,6-LP]=ZT[1,4-LP] IH3=IH2
_M5220:
IF _KT[IH3,7]>0
_KT[_LS,5]=HH1 _KT[_LS,6]=HH2 IH3=_KT[IH3,0] LSP[1,0]=_KT[IH3,5] LSP[1,1]=_KT[IH3,6] _LS=IH3 HH1=_KT[_LS,5] HH2=_KT[_LS,6]
IF (ABS(_KT[IH3,5+LP]-$P_EP[_ZA]*TAK[3]/_ZRF)<_EPS) AND (ABS(_KT[IH3,6-LP]-$P_EP[_SA]*TAK[3]/_SRF)<_EPS)
_LS=IH2 HH1=_KT[_LS,5] HH2=_KT[_LS,6]
GOTOF _YQX6
ENDIF
ELSE
IF ((_KT[IH3,3]==_KT[IH3,5])AND(_KT[IH3,4]==_KT[IH3,6]))
FLAG=0
ELSE
FLAG=INTERSEC(_KT[IH3],ZT[1],_NZP)
ENDIF
IF FLAG==1
_KT[_LS,5]=HH1 _KT[_LS,6]=HH2 LSP[1,0]=_NZP[0] LSP[1,1]=_NZP[1] _LS=IH3
HH1=_KT[_LS,5] HH2=_KT[_LS,6] _KT[_LS,5]=LSP[1,0] _KT[_LS,6]=LSP[1,1]
ELSE
IF IH3==_LS
GOTOF _M5221
ENDIF
IH3=_KT[IH3,1]
IF IH3<>_LS
GOTOB _M5220
ENDIF
ENDIF
ENDIF
ENDIF
_M5221:
IF _LS<>IH2 GOTOB _YXS6
_YQX6:_KT[_NS,3]=HH4 _KT[_NS,4]=HH5 _KT[_LS,5]=HH1 _KT[_LS,6]=HH2
IF _MK[1]==0 GOTOF _YQZ6
_NS=_KT[_NS,0]
_YQZ6:
_M5302:
IF _MK[10]==1
IF NOT((IH1==AZI) AND (_MK[0]<>0))
N6801 G1 G91 AX[_ZA]=_ZRF*SAB[4]
N6802 G0 G91 AX[_ZA]=_ZRF*SAB[2+LP] AX[_SA]=_SRF*SAB[3-LP]
N6803 G90
ENDIF
GOTOF _YZ6B
ENDIF
IF IH6==1
N684 G1 G90 AX[_SA]=_SRF*_KT[_LS,6-LP]-SAB[1-LP]/ABS(SAB[1-LP])*_MERKWZR
ENDIF
IF ABS(LSP[1,LP]-_KT[ZLE,5+LP])<=_EPS
IF (ABS(SAB[4])>0)
IF (ABS(_KT[ZLE,3+LP]-_KT[ZLE,5+LP])<_EPS)
N685 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4])*_ZRF
GOTOF _MT66
ENDIF
IF (TAK[4]==1) AND ((TAK[5]-LSP[1,LP])*IA>=0)
N685 G1 G90 AX[_ZA]=(TAK[5]+SAB[4])*_ZRF
GOTOF _MT66
ENDIF
ENDIF
IF ABS(SAB[4])-ABS(TAK[0])>=0
IF ABS(SAB[4]/2)-ABS(TAK[0])<0
N686 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4]/2)*_ZRF
ELSE
N687 G1 G90 AX[_ZA]=(LSP[1,LP]+SAB[4]-TAK[0]*IA)*_ZRF
ENDIF
ENDIF
ENDIF
IF (_ATTAB-LSP[1,LP])*IA>0
IF _ZSD13I==0
IF (IH1<>AZI) OR ((IH1==AZI) AND (_MK[0])==0)
N688 G1 G90 AX[_ZA]=_ATTAB*_ZRF
ELSE
IF (LSP[1,1-LP]-_KT[ZMX,4-LP])*SLR<0
N688 G1 G90 AX[_ZA]=_ATTAB*_ZRF
ELSE
N689 G1 G90 AX[_ZA]=(_KT[ZMX,3+LP]+SAB[LP])*_ZRF
GOTOF _MPX6
ENDIF
ENDIF
ENDIF
ENDIF
_MT66:TAK[4]=0 TAK[5]=0
IF _KT[IH2,8]==0 GOTOF _YZ6A
N693 G0 G91 AX[_ZA]=_ZRF*SAB[LP] AX[_SA]=_SRF*SAB[1-LP]
GOTOF _YZ6B
N692 _YZ6A:G0 G91 AX[_ZA]=_ZRF*SAB[LP] AX[_SA]=_SRF*SAB[1-LP]
N693 G91 AX[_SA]=_SRF*SAB[1-LP]
;_YZ6B: IF S_DELTAZ<_MERKWZR GOTOF _MQ6
_YZ6B:IF S_DELTAZ<(_MERKWZR+ABS(TAK[0])) GOTOF _MQ6
IF IH1==AZI GOTOF _MPX6
N695 G90 AX[_SA]=TAK[1]*_SRF
N696 G1 F=FF2 G90 AX[_ZA]=_ZRF*LSP[0,LP] AX[_SA]=_SRF*TAK[1]
_MPX6:
IF ((_ARTIS[11]==3) AND (_ARTIS[12]<>1) AND (_ARTIS[10]==_ARTIS[5]))
M=QU(_ARTIS[8])
ENDIF
IF IH1<AZI GOTOB _YQF6
_MQ6:_MK[0]=_MK[0]-1 ZMX=ABS(_KT[ZHN,7]) ZMX=ABS(_KT[ZMX,7])
IF _MK[0]>1
_ZMXN=ABS(_KT[ZMX,7]) _ZMXN=ABS(_KT[_ZMXN,7])
ENDIF
IF _MK[0]<>0 GOTOB _MBX6
IF VARI==1
IF (ZSP[2+LP]-$P_EP[_ZA])*IA>0
N696 G0 G90 G[10]=_GG10 AX[_ZA]=ZSP[LP]
ENDIF
IF _MK[4]<>9
N697 G40 G90 AX[_SA]=ZSP[3-LP] AX[_ZA]=ZSP[2+LP]
ELSE
N697 G40 G90 AX[_SA]=ZSP[3-LP] AX[_ZA]=ZSP[LP]
ENDIF
ELSE
IF (ZSP[2+LP]+SAB[4]-$P_EP[_ZA]*TAK[3])*IA>0
N698 G0 G90 G[10]=_GG10 AX[_ZA]=ZSP[LP]
ENDIF
IF _MK[4]>4
IF NOT _VR
N699 G0 G40 G90 G[10]=_GG10 F=FF3 AX[_SA]=_SRF*(_KT[_PTABA,6-LP]+SAB[3-LP])
ELSE
N699 G0 G40 G90 G[10]=_GG10 F=FF3 AX[_SA]=_SRF*(_KT[_PTABA,4-LP]+SAB[3-LP])
ENDIF
ELSE
IF NOT _VR
N699 G0 G40 G90 G[10]=_GG10 F=FF3 AX[_SA]=_SRF*(_KT[_PTABA,6-LP]+SAB[1-LP])
ELSE
N699 G0 G40 G90 G[10]=_GG10 F=FF3 AX[_SA]=_SRF*(_KT[_PTABA,4-LP]+SAB[1-LP])
ENDIF
ENDIF
ENDIF
IF _MERK_CDON==2
CDON
ENDIF
_MAX7:_GG7=_MK[5]-39
IF _MK[13]==1
ZSP[LP]=ZSP[LP]*_ZRF ZSP[1-LP]=ZSP[1-LP]*_SRF ZSP[2+LP]=ZSP[2+LP]*_ZRF ZSP[3-LP]=ZSP[3-LP]*_SRF
N760 G0 G90 G64 F=FF3 AX[_SA]=ZSP[3-LP] AX[_ZA]=ZSP[2+LP]
N761 G0 AX[_SA]=_SRF*_KT[_PTABA,6-LP]
N762 G1 G[7]=_GG7 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,5+LP]
GOTOF _MBX7
ENDIF
IF (VARI==5) AND (_MK[4]<5)
ZSP[LP]=ZSP[LP]*_ZRF ZSP[1-LP]=ZSP[1-LP]*_SRF ZSP[2+LP]=ZSP[2+LP]*_ZRF ZSP[3-LP]=ZSP[3-LP]*_SRF
N750 G0 G90 G[10]=_GG10 F=FF3 AX[_SA]=ZSP[3-LP] AX[_ZA]=ZSP[2+LP]
IH1=_KT[_PTABA,1] II=_KT[IH1,2] II=II MOD 10 HH1=_KT[IH1,8] HH5=_MERKWZR
IF II<2
IF (HH1==0) OR (HH1==90)
IF HH1==0
SAB[5+LP]=0 SAB[6-LP]=_MERKWZR*SLR
ELSE
SAB[5+LP]=0 SAB[6-LP]=_MERKWZR*SLR
ENDIF
ELSE
HH5=HH5/2
IF _KT[IH1,7]<=0
SAB[5+LP]=-IA*HH5*ABS(SIN(HH1))
ELSE
SAB[5+LP]=IA*HH5*ABS(SIN(HH1))
ENDIF
SAB[6-LP]=SLR*HH5*ABS(COS(HH1))
ENDIF
ELSE
IF NOT(ABS(_KT[IH1,3]-_KT[IH1,9]))<_EPS
HH5=HH5/2
HH2=(_KT[IH1,4]-_KT[IH1,10])/(_KT[IH1,3]-_KT[IH1,9]) HH3=HH5*HH5/(1+HH2*HH2) HH4=SQRT(HH3)
IF _KT[IH1,7]<=0
SAB[5+LP]=-IA*(HH4)
ELSE
SAB[5+LP]=IA*(HH4)
ENDIF
SAB[6-LP]=SLR*(ABS(HH2)*HH4)
ELSE
SAB[5+LP]=0 SAB[6-LP]=_MERKWZR*SLR
ENDIF
ENDIF
IF NOT _VR
HH2=ZSP[2+LP]-_ZRF*(_KT[_PTABA,5+LP]+SAB[5+LP]) HH3=ZSP[3-LP]-_SRF*(_KT[_PTABA,6-LP]+SAB[6-LP])
HH2=HH2/_ZRF HH3=HH3/_SRF
IF SQRT(HH2*HH2+HH3*HH3)>ABS(_MERKWZR)+ABS(SM[1])
IF HH2<>0
HH4=HH2/ABS(HH2)
ELSE
HH4=1
ENDIF
IF HH3<>0
HH5=HH3/ABS(HH3)
ELSE
HH5=1
ENDIF
HH1=ABS(HH3/HH2) HH2=(ABS(_MERKWZR)+ABS(SM[1]))*HH4 HH3=ABS(HH2)*HH5*HH1
ELSE
HH2=0 HH3=0
ENDIF
N751 G0 G[7]=_GG7 AX[_SA]=ZSP[1-LP] AX[_ZA]=ZSP[0+LP]
N752 AX[_SA]=_SRF*(_KT[_PTABA,6-LP]+SAB[1-LP]+ABS(SAB[4])*SLR) AX[_ZA]=_ZRF*(_KT[_PTABA,5+LP])
N7520 G1 F=FF3 AX[_ZA]=_ZRF*(_KT[_PTABA,5+LP]+SAB[5+LP]) AX[_SA]=_SRF*(_KT[_PTABA,6-LP]+SAB[6-LP])
N753 G1 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,5+LP] AX[_SA]=_SRF*_KT[_PTABA,6-LP]
ELSE
HH2=ZSP[2+LP]-_ZRF*(_KT[_PTABA,3+LP]+SAB[5+LP]) HH3=ZSP[3-LP]-_SRF*(_KT[_PTABA,4-LP]+SAB[6-LP])
HH2=HH2/_ZRF HH3=HH3/_SRF
IF SQRT(HH2*HH2+HH3*HH3)>ABS(_MERKWZR)+ABS(SM[1])
IF HH2<>0
HH4=HH2/ABS(HH2)
ELSE
HH4=1
ENDIF
IF HH3<>0
HH5=HH3/ABS(HH3)
ELSE
HH5=1
ENDIF
HH1=ABS(HH3/HH2) HH2=(ABS(_MERKWZR)+ABS(SM[1]))*HH4 HH3=ABS(HH2)*HH5*HH1
ELSE
HH2=0 HH3=0
ENDIF
N751 G0 G[7]=_GG7 AX[_SA]=ZSP[1-LP] AX[_ZA]=ZSP[0+LP]
N752 AX[_SA]=_SRF*(_KT[_PTABA,4-LP]+SAB[1-LP]+ABS(SAB[4])*SLR) AX[_ZA]=_ZRF*(_KT[_PTABA,3+LP])
N7520 G1 F=FF3 AX[_ZA]=_ZRF*(_KT[_PTABA,3+LP]+SAB[5+LP]) AX[_SA]=_SRF*(_KT[_PTABA,4-LP]+SAB[6-LP])
N753 G1 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,3+LP] AX[_SA]=_SRF*_KT[_PTABA,4-LP]
ENDIF
GOTOF _MBX7
ENDIF
IF VARI==5
ZSP[LP]=ZSP[LP]*_ZRF ZSP[1-LP]=ZSP[1-LP]*_SRF ZSP[2+LP]=ZSP[2+LP]*_ZRF ZSP[3-LP]=ZSP[3-LP]*_SRF
N750 G0 G90 G[10]=_GG10 G[7]=_GG7 NORM F=FF3 AX[_SA]=ZSP[1-LP] AX[_ZA]=ZSP[LP]
IF NOT _VR
N752 G0 G90 G[10]=_GG10 AX[_ZA]=_ZRF*(_KT[_PTABA,5+LP]+SAB[LP])+SM[1]
N753 G1 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,5+LP] AX[_SA]=_SRF*_KT[_PTABA,6-LP]
ELSE
N754 G0 G90 G[10]=_GG10 AX[_ZA]=_ZRF*(_KT[_PTABA,3+LP]+SAB[LP])+SM[1]
N755 G1 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,3+LP] AX[_SA]=_SRF*_KT[_PTABA,4-LP]
ENDIF
GOTOF _MBX7
ENDIF
IF VARI==1 GOTOF _MYX7
IF (_IS_CYCFR==1)
N756 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_ZA,-SM[1]*1/_FAK1,_SA,-SM[0]*1/_FAK1)
_RE_TR[0]=_RE_TR[0]-SM[1] _RE_TR[1]=_RE_TR[1]-SM[0]
ELSE
N757 ATRANS AX[_ZA]=-SM[1] AX[_SA]=-SM[0]
ENDIF
_M5205:
IF NOT _VR
N700 AX[_ZA]=_ZRF*(_KT[_PTABA,5+LP]+SAB[2+LP])+SM[1]
N711 G1 G[7]=_GG7 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,5+LP] AX[_SA]=_SRF*_KT[_PTABA,6-LP]
ELSE
N700 AX[_ZA]=_ZRF*(_KT[_PTABA,3+LP]+SAB[2+LP])+SM[1]
N711 G1 G[7]=_GG7 F=FF3 AX[_ZA]=_ZRF*_KT[_PTABA,3+LP] AX[_SA]=_SRF*_KT[_PTABA,4-LP]
ENDIF
_MBX7:
_MDX7:
IF (_ARTIS[12]>0)
M=QU(_ARTIS[7])
ENDIF
II=_PTABA
_NEXTII:
_NEXTII1: IH5=_KT[II,1] IH6=_KT[II,2] IH6=IH6 MOD 10
IF IH5==0
IF ( (ABS(_KT[II,3+LP]-_KT[II,5+LP])<_EPS) AND (ABS(_KT[II,4-LP]-_KT[II,6-LP])>_EPS) )
_KT[II,3+LP]=_KT[II,3+LP]*_ZRF _KT[II,5+LP]=_KT[II,5+LP]*_ZRF _KT[II,4-LP]=_KT[II,4-LP]*_SRF _KT[II,6-LP]=_KT[II,6-LP]*_SRF _KT[II,9+LP]=_KT[II,9+LP]*_ZRF _KT[II,10-LP]=_KT[II,10-LP]*_SRF
EXECTAB(_KT[II])
_KT[II,3+LP]=_KT[II,3+LP]/_ZRF _KT[II,5+LP]=_KT[II,5+LP]/_ZRF _KT[II,4-LP]=_KT[II,4-LP]/_SRF _KT[II,6-LP]=_KT[II,6-LP]/_SRF _KT[II,9+LP]=_KT[II,9+LP]/_ZRF _KT[II,10-LP]=_KT[II,10-LP]/_SRF
GOTOF _NEXTII2
ELSE
GOTOF _NEXTII2
ENDIF
ENDIF
IF _KT[II,2]==_KT[IH5,2]
IF IH6<2
IF _KT[II,8]==_KT[IH5,8]
II=_KT[II,1]
GOTOB _NEXTII1
ENDIF
ELSE
IF ((_KT[II,9]==_KT[IH5,9]) AND (_KT[II,10]==_KT[IH5,10]))
II=_KT[II,1]
GOTOB _NEXTII1
ENDIF
ENDIF
ENDIF
IF IH6<2
IF IH6==0
N720 G0 AX[_SA]=_SRF*_KT[II,6-LP] AX[_ZA]=_ZRF*_KT[II,5+LP]
ELSE
N721 G1 AX[_SA]=_SRF*_KT[II,6-LP] AX[_ZA]=_ZRF*_KT[II,5+LP]
ENDIF
ELSE
IF IH6==2
N723 G2 AX[_SA]=_SRF*_KT[II,6-LP] AX[_ZA]=_ZRF*_KT[II,5+LP] IP[_SA]=AC(_KT[II,10-LP]*_SRF) IP[_ZA]=AC(_KT[II,9+LP]*_ZRF)
ELSE
N724 G3 AX[_SA]=_SRF*_KT[II,6-LP] AX[_ZA]=_ZRF*_KT[II,5+LP] IP[_SA]=AC(_KT[II,10-LP]*_SRF) IP[_ZA]=AC(_KT[II,9+LP]*_ZRF)
ENDIF
ENDIF
II=_KT[II,1]
IF II<>0 GOTOB _NEXTII
_NEXTII2:
IF PLAN==1
DIAMOF
ELSE
DIAMON
ENDIF
IF ABS($P_EP[_ZA]/_ZRF*TAK[3]-_KT[ZLE,5+LP])<_EPS GOTOF _MFX7
_KT[ZLE,3+LP]=_KT[ZLE,3+LP]*_ZRF _KT[ZLE,5+LP]=_KT[ZLE,5+LP]*_ZRF _KT[ZLE,4-LP]=_KT[ZLE,4-LP]*_SRF _KT[ZLE,6-LP]=_KT[ZLE,6-LP]*_SRF _KT[ZLE,9+LP]=_KT[ZLE,9+LP]*_ZRF _KT[ZLE,10-LP]=_KT[ZLE,10-LP]*_SRF
N73 EXECTAB(_KT[ZLE])
_KT[ZLE,3+LP]=_KT[ZLE,3+LP]/_ZRF _KT[ZLE,5+LP]=_KT[ZLE,5+LP]/_ZRF _KT[ZLE,4-LP]=_KT[ZLE,4-LP]/_SRF _KT[ZLE,6-LP]=_KT[ZLE,6-LP]/_SRF _KT[ZLE,9+LP]=_KT[ZLE,9+LP]/_ZRF _KT[ZLE,10-LP]=_KT[ZLE,10-LP]/_SRF
_MFX7:
IF _VR==1
N77 G0 G40 G90 G64 AX[_ZA]=ZSP[LP]
ELSE
N77 G0 G90 G64 AX[_ZA]=ZSP[LP]
ENDIF
IF _MK[4]<>9
N777 G40 G90 AX[_SA]=ZSP[3-LP] AX[_ZA]=ZSP[2+LP]
ELSE
N777 G40 G90 AX[_SA]=ZSP[3-LP] AX[_ZA]=ZSP[LP]
ENDIF
IF (_IS_CYCFR==1)
N780 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_ZA,-_RE_TR[0]*1/_FAK1,_SA,-_RE_TR[1]*1/_FAK1)
ELSE
N781 ATRANS AX[_ZA]=-SM[1] AX[_SA]=-SM[0]
ENDIF
N78 _MYX7:G0 G90 AX[_SA]=ZSP[3-LP]
N79 AX[_ZA]=ZSP[2+LP]
MZ7:
IF (_IS_CYCFR==1)
N791 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_ZA,-_RE_TR[0]*1/_FAK1,_SA,-_RE_TR[1]*1/_FAK1)
ELSE
N792 ATRANS AX[_ZA]=-SM[1] AX[_SA]=-SM[0]
ENDIF
IF ( (_ARTIS[0]==11) OR (_ARTIS[11]==3) )
M=QU(_ARTIS[8])
ENDIF
_SC_LAST_CONT=_SC_LAST_CONT-1
RET
FEHL1:STOPRE
N709501 SETAL(61000)
RET
FEHL2:STOPRE
N709502 SETAL(61604)
RET
FEHL3:STOPRE
N709503 SETAL(61605)
RET
FEHL4:STOPRE
N709504 SETAL(61606)
RET
FEHL5:STOPRE
N709505 SETAL(61607)
RET
FEHL6:STOPRE
N709506 SETAL(61002)
RET
N709507 FEHL7:SETAL(61611)
RET
N709571 FEHL71:SETAL(61611)
RET
N709572 FEHL72:SETAL(61611)
RET
N709573 FEHL73:SETAL(61611)
RET
N709574 FEHL74:SETAL(61611)
RET
N709575 FEHL75:SETAL(61611)
RET
N709576 FEHL76:SETAL(61611)
RET
_FEHL8: STOPRE
N709508 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL9: STOPRE
N709509 SETAL(61158)
RET
_FEHL10: STOPRE
N709510 SETAL(61019,"(_DMODE: dec4/NPP)")
RET
_FEHL15:STOPRE
N709515 SETAL(62106)
RET
_FEHL16:STOPRE
N709516 SETAL(61906)
RET
_FEHL17: STOPRE
N709517 SETAL(61019,"(_GMODE: dec1)")
RET
_FEHL18: STOPRE
N709518 SETAL(61212)
RET
_FEHL19: STOPRE
N88 SETAL(61023,"MID")
RET
_FEHL20: STOPRE
N709520 SETAL(61029,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE950_SPF
PROC CYCLE950(STRING[70] _NP1,STRING[32] _NP2,STRING[32] _NP3,STRING[70] _NP4,INT _VARI,REAL _MID,REAL _FALZ,REAL _FALX,REAL _FF1,REAL _FF2,REAL _FF3,REAL _FF4,REAL _VRT,REAL _ANGB,REAL _SDIS,STRING[70] _NP5,STRING[32] _NP6,STRING[32] _NP7,STRING[70] _NP8,REAL _APZ,INT _APZA,REAL _APX,INT _APXA,REAL _TOL1) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Roughing cycle
DEF INT _H_TYPE,_H_VARI[9],_VARI952,_BL952,_GMODE952=0,_DMODE952,_H_AMODE[9],_AMODE952,_TEMP,_ERG
DEF REAL _F952
DEF STRING[70] __NP5
DEF STRING[40] _SERR,_TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE950_MPF"
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE950_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE950("<<_NP1<<","<<_NP2<<","<<_NP3<<","<<_NP4<<","<<_VARI<<","<<_MID<<","<<_FALZ<<","<<_FALX<<","<<_FF1<<","<<_FF2<<","<<_FF3<<","<<_FF4<<","<<_VRT<<","<<_ANGB<<","<<_SDIS<<","<<_NP5<<","<<_NP6<<","<<_NP7<<","<<_NP8<<","<<_APZ<<","<<_APZA<<","<<_APX<<","<<_APXA<<","<<_TOL1<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (_SC_Y_TURN<>0)
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_H_VARI[0]=(_VARI _DEC1) _H_VARI[1]=(_VARI _DEC2) _H_VARI[2]=(_VARI _DEC3) _H_VARI[3]=(_VARI _DEC4) _H_VARI[4]=(_VARI _DEC5)
_H_VARI[5]=(_VARI _DEC6)
IF (_H_VARI[2]>3)AND(_H_VARI[2]<=6)
_H_VARI[2]=_H_VARI[2]-3 _GMODE952=100
ENDIF
_VARI952=_H_VARI[0]+_H_VARI[2]*10+_H_VARI[5]*100+_H_VARI[1]*1000+0*10000+_H_VARI[3]*100000+_H_VARI[4]*1000000+_H_VARI[6]*10000000
__NP5=_NP5
IF (__NP5=="DEFAULT")
_BL952=1
ELSE
IF ( ((__NP5=="")OR(__NP5==" ")) AND ((_NP6=="")OR(_NP6==" ")) AND ((_NP7=="")OR(_NP7==" ")) )
_BL952=2
IF ( (_APZA<>91)OR(_APXA<>91) )
_SERR=<<"_APZA<>91 or _APXA<>91"
GOTOF _FEHL0
ENDIF
IF ( (_APZ<=0)OR(_APX<=0) )
_SERR=<<"_APZ<=0 or _APX<=0"
GOTOF _FEHL0
ENDIF
ELSE
_BL952=3
ENDIF
ENDIF
IF (_BL952==3)
IF ( ($P_SUBPAR[16]==0)OR(__NP5=="")OR(__NP5==" ") )
_H_TYPE=2
ELSE
IF ( (($P_SUBPAR[17]==0)OR(_NP6=="")OR(_NP6==" "))OR(($P_SUBPAR[18]==0)OR(_NP7=="")OR(_NP7==" ")) )
_H_TYPE=0
ELSE
_H_TYPE=3
ENDIF
ENDIF
CYCLE62(__NP5,_H_TYPE,_NP6,_NP7)
ENDIF
IF ( ($P_SUBPAR[1]==0)OR(_NP1=="")OR(_NP1==" ") )
_H_TYPE=2
ELSE
IF ( (($P_SUBPAR[2]==0)OR(_NP2=="")OR(_NP2==" "))OR(($P_SUBPAR[3]==0)OR(_NP3=="")OR(_NP3==" ")) )
_H_TYPE=0
ELSE
_H_TYPE=3
ENDIF
ENDIF
CYCLE62(_NP1,_H_TYPE,_NP2,_NP3)
IF ((_BL952==3)AND(_H_VARI[2]<3))
_DMODE952=110 __NP5=_SC_CONT_NAME[_SC_LAST_CONT-2]
ELSE
_DMODE952=10 __NP5=""
ENDIF
CASE _H_VARI[2] OF 1 GOTOF _F_SCHRUPP 2 GOTOF _F_SCHLICHT 3 GOTOF _F_KOMPLETT
_F_SCHRUPP:
_F952=_FF1
GOTOF _F_END
_F_SCHLICHT:
_F952=_FF3
GOTOF _F_END
_F_KOMPLETT:
_F952=_FF1
$SCS_TURN_FIN_FEED_PERCENT=_FF3/_FF1*100
_F_END:
IF _FF4<>0
FRCM=_FF4
ENDIF
_H_AMODE[0]=1 _H_AMODE[1]=1 _H_AMODE[2]=0 _H_AMODE[3]=0
IF ( ($P_SUBPAR[19]==0)OR(_NP8=="")OR(_NP8==" ") )
_H_AMODE[4]=0
ELSE
_H_AMODE[4]=1
ENDIF
IF (_APXA==90)
_H_AMODE[5]=0
ELSE
_H_AMODE[5]=1
ENDIF
IF (_APZA==90)
_H_AMODE[6]=0
ELSE
_H_AMODE[6]=1
ENDIF
_AMODE952=_H_AMODE[0]+_H_AMODE[1]*10+_H_AMODE[2]*100+_H_AMODE[3]*1000+_H_AMODE[4]*10000+_H_AMODE[5]*100000+_H_AMODE[6]*1000000
$SCS_TURN_CONT_RELEASE_DIST=_VRT
$SCS_TURN_CONT_RELEASE_ANGLE=_ANGB
$SCS_TURN_CONT_BLANK_OFFSET=_TOL1
CYCLE952(_NP4,__NP5,_NP8,_VARI952,_F952,_FF2,1010101010,_MID,,,_FALX,_FALZ,,,_BL952,_APX,_APZ,,,,,,,,,,_SDIS,,_GMODE952,_DMODE952,_AMODE952)
RET
_FEHL0: STOPRE
N795000 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE951_SPF
PROC CYCLE951(REAL _SPD,REAL _SPL,REAL _EPD,REAL _EPL,REAL _ZPD,REAL _ZPL,INT _LAGE,REAL _MID,REAL _FALX,REAL _FALZ,INT _VARI,REAL __RF1,REAL __RF2,REAL __RF3,REAL _SDIS,REAL _FF1,INT _NR,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Roughing edge cycle
DEF INT _L,_IJ,_BA,_PM,_AI,_LP,_P29,_TYP,_I,_N,_LF[8],_BA1000,_SL,_BA10000,_SN,_M_NACHZIEHEN=0,_PLAN=1,_ZAF=1,_XAF=1,_ARTIS[16]
DEF INT _SLT[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,2,1,4,3,7,6,5,8,9)
DEF INT _SLX[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,4,3,2,1,5,8,7,6,9)
DEF INT _MERKER,_MERKER_GERADE1=0,_MERKER_GERADE2=0,_MERKER_GR_AN=0,_MERKER_GR_AB=0,_MERKER_SON=0,_H_DMODE[2],_TEMP,_H_AMODE[8],_GG06
DEF REAL _EPS=0.000001,_K_M[2,2],_M_RADIUS[3],_RESTWI=0,_HALTERWINKEL,_DM1,_PO1,_DM2,_PO2,_DM3,_PO3,_ZM_INC,_XM_INC,_A_DIAG,_RF1,_RF2,_RF3,_RANG
DEF REAL _ZUSTELL,_DISTANCE,_ALPHA,_ALPHA_1,_ALPHA_2,_ALPHA_3,_WINKEL,_XPM,_ZPM
DEF REAL _RF01,_RF02,_RF03,_PG[3,2],_PF[9,2],_PGK[4,2],_KP[6,2]
DEF REAL _WURZEL,_K_GERADE1_A,_K_GERADE1_B,_K_GERADE2_A,_K_GERADE2_B,_BERX,_BERZ
DEF REAL _K_FASE1_A,_K_FASE1_B,_K_FASE2_A,_K_FASE2_B,_K_FASE3_A,_K_FASE3_B
DEF REAL _DUMMY,_H[3,2],_REST_AB_X,_REST_AB_Z,_WRA,_FAK1,_FAK3
DEF REAL _KP_SCHL[6,2],_KP_MI[3,2],_KP_FT[2,2]
DEF REAL _FREIWINKEL,_FREISTICHWINKEL,_FREISTICH_X,_FREISTICH_Z,_K_FREISTICH_A,_K_FREISTICH_B
DEF REAL _AN_KP_SCHL[1,2],_AN_KP_MI[1,2],_AB_KP_SCHL[2,2],_AB_KP_MI[1,2],_K_DUMMY_A,_K_DUMMY_B
DEF REAL _K_S_GERADE1_A,_K_S_GERADE1_B,_K_S_GERADE2_A,_K_S_GERADE2_B
DEF REAL _K_S_FASE1_A,_K_S_FASE1_B,_K_S_FASE3_A,_K_S_FASE3_B,_ROUND_FAKTOR
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE951_MPF",_SERR
DEF AXIS _XX,_ZZ
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE951_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE951("<<_SPD<<","<<_SPL<<","<<_EPD<<","<<_EPL<<","<<_ZPD<<","<<_ZPL<<","<<_LAGE<<","<<_MID<<","<<_FALX<<","<<_FALZ<<","<<_VARI<<","<<__RF1<<","<<__RF2<<","<<__RF3<<","<<_SDIS<<","<<_FF1<<","<<_NR<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_I=_ARTIS[0] DIV 10
IF ((_I MOD 10 > 3) OR (_I MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_I MOD 10
ENDIF
_I=_I DIV 10
IF ((_I MOD 10 > 2) OR (_I MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_I MOD 10
ENDIF
ENDIF
_END_ARTIS_STAT:
IF(_NR>0)
_RF1=__RF1 _RF2=__RF2 _RF3=__RF3
ELSE
_RF1=0 _RF2=0 _RF3=0
ENDIF
_H_DMODE[0]=(_DMODE _DEC1) _H_DMODE[1]=(_DMODE _DEC2)
IF(_H_DMODE[0]<0)OR(_H_DMODE[0]>3) GOTOF _FEHL10
IF ( (_H_DMODE[1]<0)OR(_H_DMODE[1]>5) )
_SERR=<<"(_DMODE: dec2)"
GOTOF _FEHL9
ENDIF
_H_AMODE[0]=(_AMODE _DEC1) _H_AMODE[1]=(_AMODE _DEC2) _H_AMODE[2]=(_AMODE _DEC3) _H_AMODE[3]=(_AMODE _DEC4)
_H_AMODE[4]=(_AMODE _DEC5) _H_AMODE[5]=(_AMODE _DEC6) _H_AMODE[6]=(_AMODE _DEC7)
IF ( (_H_AMODE[0]<0)OR(_H_AMODE[0]>1) )
_SERR=<<"(_AMODE: dec1)"
GOTOF _FEHL9
ENDIF
IF ( (_H_AMODE[1]<0)OR(_H_AMODE[1]>1) )
_SERR=<<"(_AMODE: dec2)"
GOTOF _FEHL9
ENDIF
IF ( (_H_AMODE[2]<0)OR(_H_AMODE[2]>1) )
_SERR=<<"(_AMODE: dec3)"
GOTOF _FEHL9
ENDIF
IF ( (_H_AMODE[3]<0)OR(_H_AMODE[3]>1) )
_SERR=<<"(_AMODE: dec4)"
GOTOF _FEHL9
ENDIF
IF ( (_H_AMODE[4]<0)OR(_H_AMODE[4]>1) )
_SERR=<<"(_AMODE: dec5)"
GOTOF _FEHL9
ENDIF
IF ( (_H_AMODE[5]<0)OR(_H_AMODE[5]>1) )
_SERR=<<"(_AMODE: dec6)"
GOTOF _FEHL9
ENDIF
IF ( (_H_AMODE[6]<0)OR(_H_AMODE[6]>1) )
_SERR=<<"(_AMODE: dec7)"
GOTOF _FEHL9
ENDIF
IF ( (_RF1<0)OR(_RF2<0)OR(_RF3<0) )
_SERR=<<"(R, FS)"
GOTOF _FEHL9
ENDIF
IF ( (_LAGE<0)OR(_LAGE>3) )
_SERR=<<"(Lage)"
GOTOF _FEHL9
ENDIF
IF ( (_NR<0)OR(_NR>2) )
_SERR=<<"(_NR)"
GOTOF _FEHL9
ENDIF
_PO1=_SPL
IF (_H_AMODE[2]==0)
IF ( (((_LAGE==0)OR(_LAGE==1))AND(_EPD>_SPD))OR (((_LAGE==2)OR(_LAGE==3))AND(_EPD<_SPD)) )
_SERR=<<"(X1)"
GOTOF _FEHL9
ENDIF
_DM1=_EPD
ELSE
IF ( (_LAGE==0)OR(_LAGE==1) )
_DM1=_SPD-2*ABS(_EPD)
ELSE
_DM1=_SPD+2*ABS(_EPD)
ENDIF
ENDIF
IF (_H_AMODE[3]==0)
IF ( (((_LAGE==1)OR(_LAGE==3))AND(_EPL>_SPL))OR (((_LAGE==0)OR(_LAGE==2))AND(_EPL<_SPL)) )
_SERR=<<"(Z1)"
GOTOF _FEHL9
ENDIF
_PO3=_EPL
ELSE
IF ( (_LAGE==1)OR(_LAGE==3) )
_PO3=_SPL-ABS(_EPL)
ELSE
_PO3=_SPL+ABS(_EPL)
ENDIF
ENDIF
_DM3=_SPD
IF ( (_NR==0) OR (_NR==1) )
_DM2=_DM1 _PO2=_PO3
ENDIF
_DM1=_DM1/2 _DM2=_DM2/2 _DM3=_DM3/2
IF (_NR==2)
IF ( (((_H_DMODE[1]==3)OR(_H_DMODE[1]==5))AND((_ZPD<0)OR(_ZPD>90))) OR ((_H_DMODE[1]==1)AND((_ZPL<0)OR(_ZPL>90))) )
_SERR=<<"(alpha1)"
GOTOF _FEHL9
ENDIF
IF ( (((_H_DMODE[1]==2)OR(_H_DMODE[1]==5))AND((_ZPL<0)OR(_ZPL>90))) OR ((_H_DMODE[1]==4)AND((_ZPD<0)OR(_ZPD>90))) )
_SERR=<<"(alpha2)"
GOTOF _FEHL9
ENDIF
IF (_H_DMODE[1]>=0)AND(_H_DMODE[1]<=2)
IF (_H_AMODE[0]==0)
_DM2=_ZPD
ELSE
IF ( (_LAGE==0)OR(_LAGE==1) )
_DM2=_SPD-(2*ABS(_ZPD))
ELSE
_DM2=_SPD+(2*ABS(_ZPD))
ENDIF
ENDIF
_DM2=_DM2/2
IF ( (((_LAGE==0)OR(_LAGE==1))AND((_DM2<_DM1)OR(_DM2>_DM3)))OR(((_LAGE==2)OR(_LAGE==3))AND((_DM2>_DM1)OR(_DM2<_DM3))) )
_SERR=<<"(XM)"
GOTOF _FEHL9
ENDIF
ENDIF
IF (_H_DMODE[1]==0)OR(_H_DMODE[1]==3)OR(_H_DMODE[1]==4)
IF (_H_AMODE[1]==0)
_PO2=_ZPL
ELSE
IF ( (_LAGE==1)OR(_LAGE==3) )
_PO2=_SPL-ABS(_ZPL)
ELSE
_PO2=_SPL+ABS(_ZPL)
ENDIF
ENDIF
IF ( (((_LAGE==1)OR(_LAGE==3))AND((_PO2>_PO1)OR(_PO2<_PO3)))OR(((_LAGE==0)OR(_LAGE==2))AND((_PO2<_PO1)OR(_PO2>_PO3))) )
_SERR=<<"(ZM)"
GOTOF _FEHL9
ENDIF
ENDIF
IF ( _H_DMODE[1]==0 ) GOTOF _END
CASE (_H_DMODE[1]) OF 1 GOTOF _MARK1 2 GOTOF _MARK2 3 GOTOF _MARK3 4 GOTOF _MARK4 5 GOTOF _MARK5
_MARK1:
IF ( (_ZPL==90)AND(_DM2<>_DM1) )
_SERR=<<"(XM, alpha1)"
GOTOF _FEHL9
ENDIF
IF (_ZPL==0)
_PO2=_PO1
ELSE
_ZM_INC=TAN(_ZPL)*ABS(_DM1-_DM2)
IF (_LAGE==1)OR(_LAGE==3)
_PO2=_PO1-_ZM_INC
ELSE
_PO2=_PO1+_ZM_INC
ENDIF
ENDIF
GOTOF _END
_MARK2:
IF ( (_ZPL==0)AND(_DM2<>_DM3) )
_SERR=<<"(XM, alpha2)"
GOTOF _FEHL9
ENDIF
IF (_ZPL==90)
_PO2=_PO3
ELSE
_ZM_INC=ABS(_PO1-_PO3)-ABS(_DM2-_DM3)/TAN(_ZPL)
IF ( (_LAGE==1)OR(_LAGE==3) )
_PO2=_PO1-_ZM_INC
ELSE
_PO2=_PO1+_ZM_INC
ENDIF
ENDIF
GOTOF _END
_MARK3:
IF ( (_ZPD==0)AND(_PO2<>_PO1) )
_SERR=<<"(alpha1, ZM)"
GOTOF _FEHL9
ENDIF
IF (_ZPD==90)
_DM2=_DM1
ELSE
_XM_INC=ABS(_DM3-_DM1)-ABS(_PO2-_PO1)/TAN(_ZPD)
IF ( (_LAGE==0)OR(_LAGE==1) )
_DM2=_DM3-_XM_INC
ELSE
_DM2=_DM3+_XM_INC
ENDIF
ENDIF
GOTOF _END
_MARK4:
IF ( (_ZPD==90)AND(_PO2<>_PO3) )
_SERR=<<"(alpha2, ZM)"
GOTOF _FEHL9
ENDIF
IF (_ZPD==0)
_DM2=_DM3
ELSE
_XM_INC=ABS(_PO3-_PO2)*TAN(_ZPD)
IF ( (_LAGE==0)OR(_LAGE==1) )
_DM2=_DM3-_XM_INC
ELSE
_DM2=_DM3+_XM_INC
ENDIF
ENDIF
GOTOF _END
_MARK5:
IF (_ZPD==90)
_DM2=_DM1
ENDIF
IF (_ZPL==90)
_PO2=_PO3
ENDIF
IF ( (_ZPD==90)AND(_ZPL<>90) )
_ZM_INC=ABS(_PO1-_PO3)-ABS(_DM3-_DM1)/TAN(_ZPL)
IF ( (_LAGE==1)OR(_LAGE==3) )
_PO2=_PO1-_ZM_INC
ELSE
_PO2=_PO1+_ZM_INC
ENDIF
ENDIF
IF ( (_ZPD<>90)AND(_ZPL==90) )
_XM_INC=ABS(_DM3-_DM1)-ABS(_PO1-_PO3)/TAN(_ZPD)
IF ( (_LAGE==0)OR(_LAGE==1) )
_DM2=_DM3-_XM_INC
ELSE
_DM2=_DM3+_XM_INC
ENDIF
ENDIF
IF ( (_ZPD<>90)AND(_ZPL<>90) )
IF ( ABS(1-TAN(_ZPD)*TAN(_ZPL))==0 )
IF ( ((_DM1-_DM3)<>0)AND((_PO3-_PO1)<>0) )
_A_DIAG=(_PO3-_PO1)/(_DM1-_DM3)
IF (_A_DIAG==TAN(_ZPD))
_DM2=_DM3+(_DM1-_DM3)/2 _PO2=_PO1+(_PO3-_PO1)/2
ELSE
_SERR=<<"(alpha1, alpha2)"
GOTOF _FEHL9
ENDIF
ENDIF
ELSE
_XM_INC=(TAN(_ZPL)*ABS(_PO3-_PO1)-ABS(_DM1-_DM3)*TAN(_ZPD)*TAN(_ZPL))/(1-TAN(_ZPD)*TAN(_ZPL))
IF ( (_LAGE==0)OR(_LAGE==1) )
_DM2=_DM3-_XM_INC
ELSE
_DM2=_DM3+_XM_INC
ENDIF
_ZM_INC=ABS(_DM1-_DM2)*TAN(_ZPD)
IF ( (_LAGE==1)OR(_LAGE==3) )
_PO2=_PO1-_ZM_INC
ELSE
_PO2=_PO1+_ZM_INC
ENDIF
ENDIF
ENDIF
_END:
ENDIF
IF (_H_AMODE[4]==1)
_RF1=-_RF1
ENDIF
IF (_H_AMODE[5]==1)
_RF2=-_RF2
ENDIF
IF (_H_AMODE[6]==1)
_RF3=-_RF3
ENDIF
_RANG=$SCS_TURN_CONT_TRACE_ANGLE
_SDIS=ABS(_SDIS)
IF(_H_DMODE[0]>0)AND($P_GG[6]<>_H_DMODE[0])
_GG06=_H_DMODE[0]
G[6]=_GG06
ENDIF
_XX=$P_AXN2 _ZZ=$P_AXN1
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_PLAN=1
ELSE
_PLAN=2
DIAMON
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK3=1
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ENDIF
_EPS=_EPS*_FAK3
IF(_SDIS==0)
_SDIS=0.001*_FAK3
ENDIF
_IJ=_VARI MOD 10
_BA=TRUNC(_VARI/10) MOD 10
_BA1000=TRUNC(_VARI/1000) MOD 10
_BA10000=TRUNC(_VARI/10000) MOD 10
IF ( (_BA>2)OR(_BA<1)OR(_IJ==0)OR(_IJ>2)OR(_BA1000>1) )
GOTOF _FEHL8
ENDIF
IF(_BA<>2)AND(_BA1000==1)
GOTOF _FEHL8
ENDIF
IF ( (_BA==1) AND (_MID<=0) )
GOTOF _FEHL1
ENDIF
IF ( ((_BA==1) OR (_BA==2)) AND (_FF1<=0) )
GOTOF _FEHL2
ENDIF
F=_FF1
IF(_BA1000<>1)
IF(ABS(_DM1-_DM2)<_EPS)AND(ABS(_PO2-_PO3)<_EPS)
IF(ABS(_RF2)+ABS(_RF3)>ABS(_DM3-_DM2))
GOTOF _FEHL6
ENDIF
IF(ABS(_RF2)+ABS(_RF1)>ABS(_PO2-_PO1))
GOTOF _FEHL6
ENDIF
ENDIF
ENDIF
_DUMMY=(_PO2-_PO3)*(_DM1-_DM3)/(_PO1-_PO3)+_DM3
IF(ABS(_DM2-_DUMMY)<_EPS)AND(_RF2<>0)
_RF2=0
ENDIF
IF(_DM3>_DM1+_EPS)AND(_PO3+_EPS<_PO1)
IF(_PO2+_EPS<_PO3)OR(_DM2+_EPS<_DM1)
GOTOF _FEHL6
ENDIF
IF(_IJ==1)
_L=1
ELSE
_L=5
ENDIF
ENDIF
IF(_DM1>_DM3+_EPS)AND(_PO3+_EPS<_PO1)
IF(_PO2+_EPS<_PO3)OR(_DM2>_DM1+_EPS)
GOTOF _FEHL6
ENDIF
IF(_IJ==1)
_L=3
ELSE
_L=4
ENDIF
ENDIF
IF(_DM1>_DM3+_EPS)AND(_PO3>_PO1+_EPS)
IF(_PO2>_PO3+_EPS)OR(_DM2>_DM1+_EPS)
GOTOF _FEHL6
ENDIF
IF(_IJ==1)
_L=2
ELSE
_L=6
ENDIF
ENDIF
IF(_DM3>_DM1+_EPS)AND(_PO3>_PO1+_EPS)
IF(_PO2>_PO3+_EPS)OR(_DM2+_EPS<_DM1)
GOTOF _FEHL6
ENDIF
IF(_IJ==1)
_L=0
ELSE
_L=7
ENDIF
ENDIF
IF($P_TOOLNO==0)
GOTOF _FEHL0
ENDIF
_TYP=$P_ADT[1]
IF(_TYP<500)OR(_TYP>599) GOTOF _FEHL3
IF (_SC_Y_TURN==0)
IF ((_TYP _DEC1)==5) GOTOF _FEHL3
ELSE
IF ((_TYP _DEC1)<>5) GOTOF _FEHL3
IF ( (_LAGE<>0)AND(_LAGE<>1) )
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
ENDIF
_WRA=$P_TOOLR*_FAK1
IF($P_TOOLNO>0)
_SL=$P_ADT[2]
IF(NOT(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H00200000')AND($P_CUTMOD))AND NOT(($P_CUTMODK==$PC_TRAFO_NAME)AND($P_CUTMODK<>""))AND(NOT _SC_Y_TURN))
_SL=_SLT[$P_ACTFRAME[_ZZ,MI],_SL]
_SL=_SLX[$P_ACTFRAME[_XX,MI],_SL]
ENDIF
IF(_SL>0)
_LF[0]=4 _LF[1]=3 _LF[2]=1 _LF[3]=2
_LF[7]=4 _LF[5]=3 _LF[6]=1 _LF[4]=2
IF(_LF[_L]<>_SL)
_SERR=<<_SL
GOTOF _FEHL5
ENDIF
ENDIF
ENDIF
IF((_RF2==0)AND(_WRA==0))
_BA1000=0
ENDIF
_HALTERWINKEL=$P_ADT[10]
_I=_L
_PM=1-(_I MOD 2)*2
_I=_I DIV 2
_AI=1-(_I MOD 2)*2
_LP=1-(_I DIV 2)
IF(_BA1000==1)
_FREIWINKEL=$P_ADT[24]
_SN=$P_ADT[11]
IF(_SN==3)OR(_SN==4)
IF(_LP)
_FREISTICHWINKEL=_FREIWINKEL-1
ELSE
_FREISTICHWINKEL=_HALTERWINKEL-90-1
ENDIF
ENDIF
IF(_SN==1)OR(_SN==2)
IF(_LP)
_FREISTICHWINKEL=_HALTERWINKEL-90-1
ELSE
_FREISTICHWINKEL=_FREIWINKEL-1
ENDIF
ENDIF
IF(_FREISTICHWINKEL<0)
GOTOF _FEHL6
ENDIF
IF((ABS(TAN(45-_FREISTICHWINKEL/2))>_EPS)AND(ABS(TAN(_FREISTICHWINKEL))>_EPS))
_FREISTICH_X=ABS(_RF2)+_WRA/TAN(45-_FREISTICHWINKEL/2)
_FREISTICH_Z=_FREISTICH_X/TAN(_FREISTICHWINKEL)
_RF2=0
ELSE
_FREISTICH_X=0
_FREISTICH_Z=0
_RF2=0
_BA1000=0
ENDIF
ELSE
_FREISTICH_X=0
_FREISTICH_Z=0
ENDIF
_DM1=ROUND(_DM1*100000)/100000 _PO1=ROUND(_PO1*100000)/100000
_DM2=ROUND(_DM2*100000)/100000 _PO2=ROUND(_PO2*100000)/100000
_DM3=ROUND(_DM3*100000)/100000 _PO3=ROUND(_PO3*100000)/100000
IF(_LP==1)
_XX=$P_AXN2 _ZZ=$P_AXN1
_XPM=-_AI _ZPM=_PM
ELSE
_XX=$P_AXN1 _ZZ=$P_AXN2
IF(_L==5)OR(_L==6)
_XPM=_PM _ZPM=-_AI
ELSE
_XPM=-_PM _ZPM=_AI
ENDIF
ENDIF
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _XAF=1
DIAMOF
ELSE
IF _ZZ==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=_PLAN
ENDIF
IF _XX==AXNAME($MC_DIAMETER_AX_DEF)
_XAF=_PLAN
ENDIF
ENDIF
IF(_LP)
_PG[0,0]=-_XPM*_DM1 _PGK[0,0]=-_XPM*_DM1
_PG[0,1]=-_ZPM*_PO1 _PGK[0,1]=-_ZPM*_PO1
_PG[1,0]=-_XPM*_DM2 _PGK[1,0]=-_XPM*_DM2 _PGK[2,0]=-_XPM*_DM2
_PG[1,1]=-_ZPM*_PO2 _PGK[1,1]=-_ZPM*_PO2 _PGK[2,1]=-_ZPM*_PO2
_PG[2,0]=-_XPM*_DM3 _PGK[3,0]=-_XPM*_DM3
_PG[2,1]=-_ZPM*_PO3 _PGK[3,1]=-_ZPM*_PO3
ELSE
_PG[0,0]=-_XPM*_PO3 _PGK[0,0]=-_XPM*_PO3
_PG[0,1]=-_ZPM*_DM3 _PGK[0,1]=-_ZPM*_DM3
_PG[1,0]=-_XPM*_PO2 _PGK[1,0]=-_XPM*_PO2 _PGK[2,0]=-_XPM*_PO2
_PG[1,1]=-_ZPM*_DM2 _PGK[1,1]=-_ZPM*_DM2 _PGK[2,1]=-_ZPM*_DM2
_PG[2,0]=-_XPM*_PO1 _PGK[3,0]=-_XPM*_PO1
_PG[2,1]=-_ZPM*_DM1 _PGK[3,1]=-_ZPM*_DM1
_H[0,0]=_RF1 _H[1,0]=_RF3
_RF3=_H[0,0] _RF1=_H[1,0]
_H[0,0]=_FALX _FALX=_FALZ _FALZ=_H[0,0]
ENDIF
IF (_BA==1)
IF ( (ABS(_PG[0,0]-_PG[2,0])<=ABS(_FALX))OR(ABS(_PG[0,1]-_PG[2,1])<=ABS(_FALZ)) ) GOTOF _FEHL12
ENDIF
IF(_BA1000==1)
_KP_FT[0,0]=_PG[1,0]-_FREISTICH_X
_KP_FT[0,1]=_PG[1,1]
_KP_FT[1,0]=_PG[1,0]
_KP_FT[1,1]=_PG[1,1]+_FREISTICH_Z
ENDIF
IF(ABS(_PG[1,1]-_PG[0,1])<_EPS)AND(ABS(_PG[1,0]-_PG[2,0])<_EPS)
_MERKER_SON=3
_RF1=0 _RF3=0
GOTOF _MERKER_END
ENDIF
_K_M[1,0]=_PG[1,0] _K_M[1,1]=_PG[1,1]
_M_RADIUS[0]=_RF1 _M_RADIUS[1]=_RF2 _M_RADIUS[2]=_RF3
IF(ABS(_PG[1,1]-_PG[0,1])<_EPS)
_MERKER_SON=1
_RF1=_RF2
_K_M[0,0]=_PG[0,0]
_PG[0,0]=_PG[1,0]
_PG[1,0]=(_PG[0,0]+_PG[2,0])/2 _PG[1,1]=(_PG[0,1]+_PG[2,1])/2
_RF2=0
_PGK[1,0]=_PG[1,0] _PGK[1,1]=_PG[1,1]
_PGK[2,0]=_PG[1,0] _PGK[2,1]=_PG[1,1]
_PGK[0,0]=_PG[0,0] _PGK[0,1]=_PG[0,1]
ENDIF
IF(ABS(_PG[1,0]-_PG[2,0])<_EPS)
_MERKER_SON=2
_RF3=_RF2
_K_M[0,1]=_PG[2,1]
_PG[2,1]=_PG[1,1]
_PG[1,0]=(_PG[0,0]+_PG[2,0])/2 _PG[1,1]=(_PG[0,1]+_PG[2,1])/2
_RF2=0
_PGK[1,0]=_PG[1,0] _PGK[1,1]=_PG[1,1]
_PGK[2,0]=_PG[1,0] _PGK[2,1]=_PG[1,1]
_PGK[3,0]=_PG[2,0] _PGK[3,1]=_PG[2,1]
ENDIF
_MERKER_END:
IF(_PG[2,1] <>_PG[1,1])
_ALPHA_1=ATAN2(ABS(_PG[2,0]-_PG[1,0]),ABS(_PG[2,1]-_PG[1,1]))
ELSE
_ALPHA_1=90
ENDIF
IF(_PG[0,0] <>_PG[1,0])
_ALPHA_2=ATAN2(ABS(_PG[0,1]-_PG[1,1]),ABS(_PG[0,0]-_PG[1,0]))
ELSE
_ALPHA_2=90
ENDIF
_ALPHA=45-(_ALPHA_1-_ALPHA_2)/2 _ALPHA_3=135-(_ALPHA_1+_ALPHA_2)/2
_PGK[0,0] =_PGK[0,0] + _WRA*SIN(_ALPHA_2) _PGK[0,1] =_PGK[0,1] + _WRA*COS(_ALPHA_2)
_PGK[1,0] =_PGK[1,0] + _WRA*SIN(_ALPHA_2) _PGK[1,1] =_PGK[1,1] + _WRA*COS(_ALPHA_2)
_PGK[2,0] =_PGK[2,0] + _WRA*COS(_ALPHA_1) _PGK[2,1] =_PGK[2,1] + _WRA*SIN(_ALPHA_1)
_PGK[3,0] =_PGK[3,0] + _WRA*COS(_ALPHA_1) _PGK[3,1] =_PGK[3,1] + _WRA*SIN(_ALPHA_1)
IF(_PGK[1,0] <> _PGK[0,0])
_K_S_GERADE1_A=(_PGK[1,1]-_PGK[0,1])/(_PGK[1,0]-_PGK[0,0])
_K_S_GERADE1_B=_PGK[0,1]-_PGK[0,0]*_K_S_GERADE1_A
ENDIF
IF(_PGK[3,0] <> _PGK[2,0])
_K_S_GERADE2_A=(_PGK[3,1]-_PGK[2,1])/(_PGK[3,0]-_PGK[2,0])
_K_S_GERADE2_B=_PGK[3,1]-_PGK[3,0]*_K_S_GERADE2_A
ENDIF
_PGK[0,0] =_PGK[0,0]-_WRA+_FALX _PGK[0,1] =_PGK[0,1]-_WRA+_FALZ
_PGK[1,0] =_PGK[1,0]-_WRA+_FALX _PGK[1,1] =_PGK[1,1]-_WRA+_FALZ
_PGK[2,0] =_PGK[2,0]-_WRA+_FALX _PGK[2,1] =_PGK[2,1]-_WRA+_FALZ
_PGK[3,0] =_PGK[3,0]-_WRA+_FALX _PGK[3,1] =_PGK[3,1]-_WRA+_FALZ
IF(_PGK[1,0] <> _PGK[0,0])
_K_GERADE1_A=(_PGK[1,1]-_PGK[0,1])/(_PGK[1,0]-_PGK[0,0])
_K_GERADE1_B=_PGK[0,1]-_PGK[0,0]*_K_GERADE1_A
ELSE
_MERKER_GERADE1=1
ENDIF
IF(_PGK[3,0] <> _PGK[2,0])
_K_GERADE2_A=(_PGK[3,1]-_PGK[2,1])/(_PGK[3,0]-_PGK[2,0])
_K_GERADE2_B=_PGK[3,1]-_PGK[3,0]*_K_GERADE2_A
ELSE
_MERKER_GERADE2=1
ENDIF
IF(_RF3>0)
_RF03=_RF3
_PF[7,0]=_PG[2,0]-_RF03 _PF[7,1]=_PG[2,1]-_RF03*TAN(_ALPHA_1/2)
_PF[6,0]=_PG[2,0] _PF[6,1]=_PF[7,1]
IF(_ALPHA_1<>90)
_PF[8,0]=_PG[2,0]-_RF03*TAN(_ALPHA_1/2)*SIN(_ALPHA_1) _PF[8,1]=_PG[2,1]+_RF03*TAN(_ALPHA_1/2)*COS(_ALPHA_1)
ELSE
_PF[8,0]=_PG[2,0]-_RF03 _PF[8,1]=_PG[2,1]
ENDIF
_KP_SCHL[0,0]=_PF[6,0] _KP_SCHL[0,1]=_PF[6,1]
_KP_MI[0,0]=_PF[7,0] _KP_MI[0,1]=_PF[7,1]
_KP_SCHL[2,0]=_PF[8,0] _KP_SCHL[2,1]=_PF[8,1]
_PF[6,0]=_PF[6,0]+_WRA
IF(_PF[7,1]<>_PF[8,1])
_WINKEL=ATAN2(ABS(_PF[7,0]-_PF[8,0]), ABS(_PF[7,1]-_PF[8,1]))
ELSE
_WINKEL=90
ENDIF
_PF[8,0]=_PF[8,0]+_WRA*SIN(_WINKEL) _PF[8,1]=_PF[8,1]+_WRA*COS(_WINKEL)
_PF[6,0]=_PF[6,0]-_WRA+_FALX _PF[6,1]=_PF[6,1]-_WRA+_FALZ
_PF[7,0]=_PF[7,0]-_WRA+_FALX _PF[7,1]=_PF[7,1]-_WRA+_FALZ
_PF[8,0]=_PF[8,0]-_WRA+_FALX _PF[8,1]=_PF[8,1]-_WRA+_FALZ
_RF03=_RF03+_WRA
_KP[0,0]=_PF[6,0] _KP[0,1]=_PF[6,1]
_KP[2,0]=_PF[8,0] _KP[2,1]=_PF[8,1]
ENDIF
IF(_RF3<0)
_PF[6,0]=_PG[2,0] _PF[6,1]=_PG[2,1]+_RF3
IF(_PG[2,1]==_PG[1,1])
_PF[8,0]=_PG[2,0]+_RF3 _PF[8,1]=_PG[2,1]
ELSE
_PF[8,0]=_PG[2,0]+_RF3*SIN(_ALPHA_1) _PF[8,1]=_PG[2,1]-_RF3*COS(_ALPHA_1)
ENDIF
_KP_SCHL[0,0]=_PF[6,0] _KP_SCHL[0,1]=_PF[6,1]
_KP_SCHL[2,0]=_PF[8,0] _KP_SCHL[2,1]=_PF[8,1]
IF(_PF[8,1]<>_PF[6,1])
_WINKEL=ATAN2(ABS(_PF[8,0]-_PF[6,0]), ABS(_PF[8,1]-_PF[6,1]))
ELSE
_WINKEL=90
ENDIF
_PF[6,0]=_PF[6,0]+_WRA*COS(_WINKEL) _PF[6,1]=_PF[6,1]+_WRA*SIN(_WINKEL)
_PF[8,0]=_PF[8,0]+_WRA*COS(_WINKEL) _PF[8,1]=_PF[8,1]+_WRA*SIN(_WINKEL)
IF(_PF[8,0]<>_PF[6,0])
_K_S_FASE3_A=(_PF[8,1]-_PF[6,1])/(_PF[8,0]-_PF[6,0])
_K_S_FASE3_B= _PF[6,1]-_PF[6,0]*_K_S_FASE3_A
ENDIF
_PF[6,0]=_PF[6,0]-_WRA+_FALX _PF[6,1]=_PF[6,1]-_WRA+_FALZ
_PF[8,0]=_PF[8,0]-_WRA+_FALX _PF[8,1]=_PF[8,1]-_WRA+_FALZ
IF(_PF[8,0]<>_PF[6,0])
_K_FASE3_A=(_PF[8,1]-_PF[6,1])/(_PF[8,0]-_PF[6,0])
_K_FASE3_B= _PF[6,1]-_PF[6,0]*_K_FASE3_A
ENDIF
IF( _MERKER_GERADE2<>1)
_DUMMY=_K_GERADE2_A-_K_FASE3_A
_H[1,0]=-(_K_GERADE2_B-_K_FASE3_B)/_DUMMY _H[1,1]=(_K_GERADE2_A*_K_FASE3_B-_K_GERADE2_B*_K_FASE3_A)/_DUMMY
ELSE
_H[1,0]=_PG[2,0] _H[1,1]=_H[1,0]*_K_FASE3_A+_K_FASE3_B
ENDIF
IF(_PF[6,0]<_PG[2,0])
_H[0,0]=_PG[2,0] _H[0,1]=_H[0,0]*_K_FASE3_A+_K_FASE3_B
ELSE
_H[0,0]=_PF[6,0] _H[0,1]=_PF[6,1]
ENDIF
_KP[0,0]=_H[0,0] _KP[0,1]=_H[0,1]
_KP[2,0]=_H[1,0] _KP[2,1]=_H[1,1]
ENDIF
IF(_RF3==0)
_KP_SCHL[0,0]=_PG[2,0] _KP_SCHL[0,1]=_PG[2,1]
_KP_SCHL[2,0]=_PG[2,0] _KP_SCHL[2,1]=_PG[2,1]
IF(_MERKER_SON<>3)
IF(_PGK[3,0]<_PG[2,0])
_H[0,0]=_PG[2,0]
ELSE
_H[0,0]=_PGK[3,0]
ENDIF
IF(_MERKER_GERADE2<>1)
_H[0,1]=_H[0,0]*_K_GERADE2_A+_K_GERADE2_B
ELSE
_H[0,1]=_PGK[3,1]
ENDIF
ENDIF
_KP[0,0]=_H[0,0] _KP[0,1]=_H[0,1]
_KP[2,0]=_KP[0,0] _KP[2,1]=_KP[0,1]
ENDIF
IF(_RF2>0)
_RF02=_RF2
IF(_ALPHA_3<90)
_MERKER=1
IF(_BA1000==0)
IF(_RF2<_WRA)
GOTOF _FEHL4
ENDIF
ENDIF
_PF[4,0]=_PG[1,0]+_RF02*SIN(_ALPHA)/SIN(_ALPHA_3) _PF[4,1]=_PG[1,1]+_RF02*COS(_ALPHA)/SIN(_ALPHA_3)
_PF[3,0]=_PG[1,0]+_RF02*SIN(_ALPHA_1)/TAN(_ALPHA_3) _PF[3,1]=_PG[1,1]-_RF02*COS(_ALPHA_1)/TAN(_ALPHA_3)
_PF[5,0]=_PG[1,0]-_RF02*COS(_ALPHA_2)/TAN(_ALPHA_3) _PF[5,1]=_PG[1,1]+_RF02*SIN(_ALPHA_2)/TAN(_ALPHA_3)
_KP_SCHL[3,0]=_PF[3,0] _KP_SCHL[3,1]=_PF[3,1]
_KP_MI[1,0]=_PF[4,0] _KP_MI[1,1]=_PF[4,1]
_KP_SCHL[4,0]=_PF[5,0] _KP_SCHL[4,1]=_PF[5,1]
IF(_PF[4,1]<>_PF[3,1])
_WINKEL=ATAN2(ABS(_PF[4,0]-_PF[3,0]), ABS(_PF[4,1]-_PF[3,1]))
ELSE
_WINKEL=90
ENDIF
_PF[3,0]=_PF[3,0]+_WRA*SIN(_WINKEL) _PF[3,1]=_PF[3,1]+_WRA*COS(_WINKEL)
IF(_PF[4,1]<>_PF[5,1])
_WINKEL=ATAN2(ABS(_PF[4,0]-_PF[5,0]), ABS(_PF[4,1]-_PF[5,1]))
ELSE
_WINKEL=90
ENDIF
_PF[5,0]=_PF[5,0]+_WRA*SIN(_WINKEL) _PF[5,1]=_PF[5,1]+_WRA*COS(_WINKEL)
_PF[3,0]=_PF[3,0]-_WRA+_FALX _PF[3,1]=_PF[3,1]-_WRA+_FALZ
_PF[4,0]=_PF[4,0]-_WRA+_FALX _PF[4,1]=_PF[4,1]-_WRA+_FALZ
_PF[5,0]=_PF[5,0]-_WRA+_FALX _PF[5,1]=_PF[5,1]-_WRA+_FALZ
_RF02=_RF02-_WRA
_KP[3,0]=_PF[3,0] _KP[3,1]=_PF[3,1]
_KP[4,0]=_PF[5,0] _KP[4,1]=_PF[5,1]
ELSE
_MERKER=2
_ALPHA=(90+_ALPHA_2-_ALPHA_1)/2 _ALPHA_3=(90+_ALPHA_1+_ALPHA_2)/2
_PF[4,0]=_PG[1,0]-_RF02*SIN(_ALPHA)/SIN(_ALPHA_3) _PF[4,1]=_PG[1,1]-_RF02*COS(_ALPHA)/SIN(_ALPHA_3)
_PF[3,0]=_PG[1,0]+_RF02*SIN(_ALPHA_1)/TAN(_ALPHA_3) _PF[3,1]=_PG[1,1]-_RF02*COS(_ALPHA_1)/TAN(_ALPHA_3)
_PF[5,0]=_PG[1,0]-_RF02*COS(_ALPHA_2)/TAN(_ALPHA_3) _PF[5,1]=_PG[1,1]+_RF02*SIN(_ALPHA_2)/TAN(_ALPHA_3)
_KP_SCHL[3,0]=_PF[3,0] _KP_SCHL[3,1]=_PF[3,1]
_KP_MI[1,0]=_PF[4,0] _KP_MI[1,1]=_PF[4,1]
_KP_SCHL[4,0]=_PF[5,0] _KP_SCHL[4,1]=_PF[5,1]
IF(_PF[4,1]<>_PF[3,1])
_WINKEL=ATAN2(ABS(_PF[4,0]-_PF[3,0]), ABS(_PF[4,1]-_PF[3,1]))
ELSE
_WINKEL=90
ENDIF
_PF[3,0]=_PF[3,0]+_WRA*SIN(_WINKEL) _PF[3,1]=_PF[3,1]+_WRA*COS(_WINKEL)
IF(_PF[4,1] <>_PF[5,1])
_WINKEL=ATAN2(ABS(_PF[4,0]-_PF[5,0]), ABS(_PF[4,1]-_PF[5,1]))
ELSE
_WINKEL=90
ENDIF
_PF[5,0]=_PF[5,0]+_WRA*SIN(_WINKEL) _PF[5,1]=_PF[5,1]+_WRA*COS(_WINKEL)
_PF[3,0]=_PF[3,0]-_WRA+_FALX _PF[3,1]=_PF[3,1]-_WRA+_FALZ
_PF[4,0]=_PF[4,0]-_WRA+_FALX _PF[4,1]=_PF[4,1]-_WRA+_FALZ
_PF[5,0]=_PF[5,0]-_WRA+_FALX _PF[5,1]=_PF[5,1]-_WRA+_FALZ
_RF02 =_RF02 +_WRA
_KP[3,0]=_PF[3,0] _KP[3,1]=_PF[3,1]
_KP[4,0]=_PF[5,0] _KP[4,1]=_PF[5,1]
ENDIF
ENDIF
IF(_RF2<0)
IF(_PG[2,1]==_PG[1,1])
_PF[3,0]=_PG[1,0]-_RF2 _PF[3,1]=_PG[1,1]
ELSE
_PF[3,0]=_PG[1,0]-_RF2*SIN(_ALPHA_1) _PF[3,1]=_PG[1,1]+_RF2*COS(_ALPHA_1)
ENDIF
IF(_PG[0,0]==_PG[1,0])
_PF[5,0]=_PG[1,0] _PF[5,1]=_PG[1,1]-_RF2
ELSE
_PF[5,0]=_PG[1,0]+_RF2*COS(_ALPHA_2) _PF[5,1]=_PG[1,1]-_RF2*SIN(_ALPHA_2)
ENDIF
_KP_SCHL[3,0]=_PF[3,0] _KP_SCHL[3,1]=_PF[3,1]
_KP_SCHL[4,0]=_PF[5,0] _KP_SCHL[4,1]=_PF[5,1]
IF(_PF[5,1]<>_PF[3,1])
_WINKEL=ATAN2(ABS(_PF[5,0]-_PF[3,0]), ABS(_PF[5,1]-_PF[3,1]))
ELSE
_WINKEL=90
ENDIF
_PF[5,0]=_PF[5,0]+_WRA*COS(_WINKEL) _PF[5,1]=_PF[5,1]+_WRA*SIN(_WINKEL)
_PF[3,0]=_PF[3,0]+_WRA*COS(_WINKEL) _PF[3,1]=_PF[3,1]+_WRA*SIN(_WINKEL)
_PF[5,0]=_PF[5,0]-_WRA+_FALX _PF[5,1]=_PF[5,1]-_WRA+_FALZ
_PF[3,0]=_PF[3,0]-_WRA+_FALX _PF[3,1]=_PF[3,1]-_WRA+_FALZ
IF(_PF[5,0]<>_PF[3,0])
_K_FASE2_A=(_PF[5,1]-_PF[3,1])/(_PF[5,0]-_PF[3,0])
_K_FASE2_B=_PF[5,1]-_PF[5,0]*_K_FASE2_A
ENDIF
IF(_MERKER_SON<>3)
IF(_MERKER_GERADE2<>1)
_DUMMY=_K_GERADE2_A-_K_FASE2_A
_H[0,0]=-(_K_GERADE2_B-_K_FASE2_B)/_DUMMY
_H[0,1]=(_K_GERADE2_A*_K_FASE2_B-_K_GERADE2_B*_K_FASE2_A)/_DUMMY
ELSE
_H[0,0]=_PGK[2,0]
_H[0,1]=_H[0,0]*_K_FASE2_A+_K_FASE2_B
ENDIF
IF( _MERKER_GERADE1<>1)
_DUMMY=_K_GERADE1_A-_K_FASE2_A
_H[1,0]=-(_K_GERADE1_B-_K_FASE2_B)/_DUMMY
_H[1,1]=(_K_GERADE1_A*_K_FASE2_B-_K_GERADE1_B*_K_FASE2_A)/_DUMMY
ELSE
_H[1,0]=_PGK[1,0]
_H[1,1]=_H[1,0]*_K_FASE2_A+_K_FASE2_B
ENDIF
ELSE
_DUMMY=_PF[3,0]+_PF[3,1]
_H[0,0]=_PG[1,0]+_FALX _H[0,1]=-(_PG[1,0]+_FALX)+_DUMMY
_H[1,0]=-(_PG[1,1]+_FALZ)+_DUMMY _H[1,1]=_PG[1,1]+_FALZ
ENDIF
_KP[3,0]=_H[0,0] _KP[3,1]=_H[0,1]
_KP[4,0]=_H[1,0] _KP[4,1]=_H[1,1]
ENDIF
IF(_RF2==0)
_KP_SCHL[3,0]=_PG[1,0] _KP_SCHL[3,1]=_PG[1,1]
_KP_SCHL[4,0]=_PG[1,0] _KP_SCHL[4,1]=_PG[1,1]
IF(_MERKER_GERADE1<>1)AND(_MERKER_GERADE2<>1)
IF(ABS(_K_GERADE1_A-_K_GERADE2_A)<_EPS)
_H[0,0]=_PGK[1,0] _H[0,1]=_PGK[1,1]
ELSE
_DUMMY=_K_GERADE1_A-_K_GERADE2_A
_H[0,0]=-(_K_GERADE1_B-_K_GERADE2_B)/_DUMMY
_H[0,1]=(_K_GERADE1_A*_K_GERADE2_B-_K_GERADE1_B*_K_GERADE2_A)/_DUMMY
ENDIF
ELSE
IF(_MERKER_GERADE1==1)
_H[0,0]=_PGK[1,0] _H[0,1]=_H[0,0]*_K_GERADE2_A+_K_GERADE2_B
ENDIF
IF(_MERKER_GERADE2==1)
_H[0,0]=_PGK[2,0] _H[0,1]=_H[0,0]*_K_GERADE1_A+_K_GERADE1_B
ENDIF
ENDIF
_KP[3,0]=_H[0,0] _KP[3,1]=_H[0,1]
_KP[4,0]=_H[0,0] _KP[4,1]=_H[0,1]
ENDIF
IF(_RF1>0)
_RF01=_RF1
_PF[1,0]=_PG[0,0]-_RF01*TAN(_ALPHA_2/2) _PF[1,1]=_PG[0,1]-_RF01
IF(_ALPHA_2<>90)
_PF[0,0]=_PG[0,0]+_RF01*TAN(_ALPHA_2/2)*COS(_ALPHA_2) _PF[0,1]=_PG[0,1]-_RF01*TAN(_ALPHA_2/2)*SIN(_ALPHA_2)
ELSE
_PF[0,0]=_PG[0,0] _PF[0,1]=_PG[0,1]-_RF01
ENDIF
_PF[2,0]=_PF[1,0] _PF[2,1]=_PG[0,1]
_KP_SCHL[5,0]=_PF[0,0] _KP_SCHL[5,1]=_PF[0,1]
_KP_MI[2,0]=_PF[1,0] _KP_MI[2,1]=_PF[1,1]
_KP_SCHL[1,0]=_PF[2,0] _KP_SCHL[1,1]=_PF[2,1]
IF(_PF[1,1]<>_PF[0,1])
_WINKEL=ATAN2(ABS(_PF[1,0]-_PF[0,0]), ABS(_PF[1,1]-_PF[0,1]))
ELSE
_WINKEL=90
ENDIF
_PF[0,0]=_PF[0,0]+_WRA*SIN(_WINKEL) _PF[0,1]=_PF[0,1]+_WRA*COS(_WINKEL)
_PF[2,1]=_PF[2,1]+_WRA
_PF[0,0]=_PF[0,0]-_WRA+_FALX _PF[0,1]=_PF[0,1]-_WRA+_FALZ
_PF[1,0]=_PF[1,0]-_WRA+_FALX _PF[1,1]=_PF[1,1]-_WRA+_FALZ
_PF[2,0]=_PF[2,0]-_WRA+_FALX _PF[2,1]=_PF[2,1]-_WRA+_FALZ
_RF01 =_RF01 +_WRA
_KP[5,0]=_PF[0,0] _KP[5,1]=_PF[0,1]
_KP[1,0]=_PF[2,0] _KP[1,1]=_PF[2,1]
ENDIF
IF(_RF1<0)
_PF[2,0]=_PG[0,0]+_RF1 _PF[2,1]=_PG[0,1]
IF(_PG[0,0]==_PG[1,0])
_PF[0,0]=_PG[0,0] _PF[0,1]=_PG[0,1]+_RF1
ELSE
_PF[0,0]=_PG[0,0]-_RF1*COS(_ALPHA_2) _PF[0,1]=_PG[0,1]+_RF1*SIN(_ALPHA_2)
ENDIF
_KP_SCHL[5,0]=_PF[0,0] _KP_SCHL[5,1]=_PF[0,1]
_KP_SCHL[1,0]=_PF[2,0] _KP_SCHL[1,1]=_PF[2,1]
IF(_PF[2,1]<>_PF[0,1])
_WINKEL=ATAN2(ABS(_PF[2,0]-_PF[0,0]), ABS(_PF[2,1]-_PF[0,1]))
ELSE
_WINKEL=90
ENDIF
_PF[2,0]=_PF[2,0]+_WRA*COS(_WINKEL) _PF[2,1]=_PF[2,1]+_WRA*SIN(_WINKEL)
_PF[0,0]=_PF[0,0]+_WRA*COS(_WINKEL) _PF[0,1]=_PF[0,1]+_WRA*SIN(_WINKEL)
IF(_PF[2,0]<>_PF[0,0])
_K_S_FASE1_A=(_PF[2,1]-_PF[0,1])/(_PF[2,0]-_PF[0,0])
_K_S_FASE1_B=_PF[2,1]-_PF[2,0]*_K_S_FASE1_A
ENDIF
_PF[2,0]=_PF[2,0]-_WRA+_FALX _PF[2,1]=_PF[2,1]-_WRA+_FALZ
_PF[0,0]=_PF[0,0]-_WRA+_FALX _PF[0,1]=_PF[0,1]-_WRA+_FALZ
IF(_PF[2,0]<>_PF[0,0])
_K_FASE1_A=(_PF[2,1]-_PF[0,1])/(_PF[2,0]-_PF[0,0])
_K_FASE1_B=_PF[2,1]-_PF[2,0]*_K_FASE1_A
ENDIF
IF ( _MERKER_GERADE1<>1)
_DUMMY=_K_GERADE1_A-_K_FASE1_A
_H[0,0]=-(_K_GERADE1_B-_K_FASE1_B)/_DUMMY
_H[0,1]=(_K_GERADE1_A*_K_FASE1_B-_K_GERADE1_B*_K_FASE1_A)/_DUMMY
ELSE
_H[0,0]=_PGK[1,0] _H[0,1]=_H[0,0]*_K_FASE1_A+_K_FASE1_B
ENDIF
IF(_PF[2,1]<_PG[0,1])
_H[1,1]=_PG[0,1] _H[1,0]=(_H[1,1]-_K_FASE1_B)/_K_FASE1_A
ELSE
_H[1,1]=_PF[2,1] _H[1,0]=_PF[2,0]
ENDIF
_KP[5,0]=_H[0,0] _KP[5,1]=_H[0,1]
_KP[1,0]=_H[1,0] _KP[1,1]=_H[1,1]
ENDIF
IF(_RF1==0)
_KP_SCHL[5,0]=_PG[0,0] _KP_SCHL[5,1]=_PG[0,1]
_KP_SCHL[1,0]=_PG[0,0] _KP_SCHL[1,1]=_PG[0,1]
IF(_MERKER_SON<>3)
IF(_PGK[0,1]<_PG[0,1])
_H[1,1]=_PG[0,1]
ELSE
_H[1,1]=_PGK[0,1]
ENDIF
IF(_MERKER_GERADE1<>1)
_H[1,0]=(_H[1,1]-_K_GERADE1_B)/_K_GERADE1_A
ELSE
_H[1,0]=_PGK[0,0]
ENDIF
ELSE
_H[1,0]=_KP[4,0] _H[1,1]=_KP[4,1]
_KP[2,0]=_KP[3,0] _KP[2,1]=_KP[3,1]
_KP[0,0]=_KP[3,0] _KP[0,1]=_KP[3,1]
ENDIF
_KP[1,0]=_H[1,0] _KP[1,1]=_H[1,1]
_KP[5,0]=_KP[1,0] _KP[5,1]=_KP[1,1]
ENDIF
IF(_MERKER_SON==1)
IF(_KP_SCHL[1,0]+_EPS<_K_M[0,0])
GOTOF _FEHL6
ENDIF
ENDIF
IF(_MERKER_SON==2)
IF(_KP_SCHL[0,1]+_EPS<_K_M[0,1])
GOTOF _FEHL6
ENDIF
ENDIF
IF(_MERKER_SON==2)OR(_MERKER_SON==1)
_KP[3,0]=(_KP[2,0]+_KP[5,0])/2 _KP[4,0]=_KP[3,0]
_KP[3,1]=(_KP[2,1]+_KP[5,1])/2 _KP[4,1]=_KP[3,1]
_KP_SCHL[3,0]=(_KP_SCHL[2,0]+_KP_SCHL[5,0])/2 _KP_SCHL[4,0]=_KP_SCHL[3,0]
_KP_SCHL[3,1]=(_KP_SCHL[2,1]+_KP_SCHL[5,1])/2 _KP_SCHL[4,1]=_KP_SCHL[3,1]
ENDIF
IF(_LP)
IF((_KP_SCHL[3,0]>_KP_SCHL[2,0]+_EPS) OR (_KP_SCHL[5,0]>_KP_SCHL[4,0]+_EPS))
GOTOF _FEHL6
ENDIF
ELSE
IF((_KP_SCHL[4,1]>_KP_SCHL[5,1]+_EPS) OR (_KP_SCHL[2,1]>_KP_SCHL[3,1]+_EPS))
GOTOF _FEHL6
ENDIF
ENDIF
IF(_MERKER_SON==0)
IF(_LP)
IF((_KP[3,0]>_KP[2,0]+_EPS))
IF(_RF3<0)
IF(_MERKER_GERADE1<>1)AND((_KP[4,0]>_KP[2,0]+_EPS))
IF(ABS(_K_GERADE1_A-_K_FASE3_A)>_EPS)
_DUMMY=_K_GERADE1_A-_K_FASE3_A
_KP[2,0]=-(_K_GERADE1_B-_K_FASE3_B)/_DUMMY
_KP[2,1]=(_K_GERADE1_A*_K_FASE3_B-_K_GERADE1_B*_K_FASE3_A)/_DUMMY
ENDIF
ELSE
_KP[2,0]=_KP[3,0] _KP[2,1]=_KP[2,0]*_K_FASE3_A+_K_FASE3_B
ENDIF
ENDIF
IF(_RF3>0)
IF(_MERKER_GERADE1<>1)AND((_KP[4,0]>_KP[2,0]+_EPS))
_DUMMY=POT(_K_GERADE1_A)+1
_H[0,0]=2*(_K_GERADE1_A*_K_GERADE1_B-_K_GERADE1_A*_PF[7,1]-_PF[7,0])/_DUMMY
_H[0,1]=(POT(_K_GERADE1_B)-2*_K_GERADE1_B*_PF[7,1]+POT(_PF[7,1])+POT(_PF[7,0])-POT(_RF03))/_DUMMY
_DUMMY=POT(_H[0,0])-4*_H[0,1]
IF(_DUMMY>=0)
_H[1,0]=SQRT(_DUMMY)
ELSE
_H[1,0]=0
ENDIF
_KP[2,0]=(-_H[0,0]-_H[1,0])/2
_KP[2,1]=_K_GERADE1_A*_KP[2,0]+_K_GERADE1_B
ELSE
_KP[2,0]=_KP[3,0]
_DUMMY=POT(_RF03)-POT(_KP[2,0]-_PF[7,0])
IF(_DUMMY>=0)
_H[0,0]=SQRT(_DUMMY)
ELSE
_H[0,0]=0
ENDIF
_KP[2,1]=_PF[7,1]+_H[0,0]
ENDIF
ENDIF
IF ((_KP[4,0]>_KP[2,0]+_EPS))
_KP[4,0]=_KP[3,0] _KP[4,1]=_KP[3,1]
ENDIF
ENDIF
IF ( (_NR==1)OR((_NR==2)AND((_ALPHA_1==90)AND(_ALPHA_2==90))) )
IF ( (_RF1<>0)AND(((ABS(ABS(_PG[0,1]-_PG[1,1])-ABS(_RF1))-$P_TOOLR)<_EPS)AND(ABS(ABS(_PG[2,1]-_PG[1,1])-ABS(_RF3))>_EPS)) )
IF(_RF1<0)
_H[0,1]=_PGK[2,1] _H[0,0]=_H[0,1]*_K_FASE1_A+_K_FASE1_B
_KP[5,0]=_H[0,0] _KP[5,1]=_H[0,1]
ELSE
_KP[5,1]=_PGK[2,1]
_DUMMY=POT(_RF01)-POT(_KP[5,1]-_PF[1,1])
IF(_DUMMY>=0)
_H[0,0]=SQRT(_DUMMY)
ELSE
_H[0,0]=0
ENDIF
_KP[5,0]=_PF[1,0]+_H[0,0]
ENDIF
ENDIF
ENDIF
ELSE
IF((_KP[4,1]>_KP[5,1]+_EPS))
IF(_RF1<0)
IF(_MERKER_GERADE1<>1)AND((_KP[3,1]>_KP[5,1]+_EPS))
IF(ABS(_K_GERADE1_A-_K_FASE1_A)>_EPS)
_DUMMY=_K_GERADE1_A-_K_FASE1_A
_KP[5,0]=-(_K_GERADE1_B-_K_FASE1_B)/_DUMMY
_KP[5,1]=(_K_GERADE1_A*_K_FASE1_B-_K_GERADE1_B*_K_FASE1_A)/_DUMMY
ENDIF
ELSE
_KP[5,1]=_KP[4,1] _KP[5,0]=_KP[5,1]*_K_FASE1_A+_K_FASE1_B
IF(_RF2==0)
_KP[3,0]=_KP[5,0] _KP[3,1]=_KP[5,1]
_KP[4,0]=_KP[5,0] _KP[4,1]=_KP[5,1]
ENDIF
ENDIF
ENDIF
IF(_RF1>0)
IF(_MERKER_GERADE1<>1)AND((_KP[3,1]>_KP[5,1]+_EPS))
_DUMMY=POT(_K_GERADE2_A)+1
_H[0,0]=2*(_K_GERADE2_A*_K_GERADE2_B-_K_GERADE2_A*_PF[1,1]-_PF[1,0])/_DUMMY
_H[0,1]=(POT(_K_GERADE2_B)-2*_K_GERADE2_B*_PF[1,1]+POT(_PF[1,1])+POT(_PF[1,0])-POT(_RF01))/_DUMMY
_DUMMY=POT(_H[0,0])-4*_H[0,1]
IF(_DUMMY>=0)
_H[1,0]=SQRT(_DUMMY)
ELSE
_H[1,0]=0
ENDIF
_KP[5,0]=(-_H[0,0]-_H[1,0])/2 _KP[5,1]=_K_GERADE2_A*_KP[5,0]+_K_GERADE2_B
ELSE
_KP[5,1]=_KP[4,1]
_DUMMY=POT(_RF01)-POT(_KP[5,1]-_PF[1,1])
IF(_DUMMY>=0)
_H[0,0]=SQRT(_DUMMY)
ELSE
_H[0,0]=0
ENDIF
_KP[5,0]=_PF[1,0]+_H[0,0]
ENDIF
ENDIF
IF ((_KP[3,1]>_KP[5,1]+_EPS))
_K_GERADE1_A=_K_GERADE2_A _K_GERADE1_B=_K_GERADE2_B
_KP[3,0]=_KP[4,0] _KP[3,1]=_KP[4,1]
ENDIF
ENDIF
IF ( (_NR==1)OR((_NR==2)AND((_ALPHA_1==90)AND(_ALPHA_2==90))) )
IF ( (_RF3<>0)AND(((ABS(ABS(_PG[1,0]-_PG[2,0])-ABS(_RF3))-$P_TOOLR)<_EPS)AND(ABS(ABS(_PG[0,1]-_PG[1,1])-ABS(_RF1))>_EPS)) )
IF(_RF3<0)
_H[1,0]=_PGK[1,0] _H[1,1]=_H[1,0]*_K_FASE3_A+_K_FASE3_B
_KP[2,0]=_H[1,0] _KP[2,1]=_H[1,1]
ELSE
_KP[2,0]=_PGK[1,0]
_DUMMY=POT(_RF03)-POT(_KP[2,0]-_PF[7,0])
IF(_DUMMY>=0)
_H[0,0]=SQRT(_DUMMY)
ELSE
_H[0,0]=0
ENDIF
_KP[2,1]=_PF[7,1]+_H[0,0]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_BA==1)
_DISTANCE=ABS(_KP[0,0]-_KP[1,0])
_N=ROUND(ABS(_DISTANCE)/_MID)
IF(_N<ABS(_DISTANCE)/_MID)
_N=_N+1
ENDIF
IF(_N==0)
_N=1
ENDIF
_ZUSTELL=ABS(_DISTANCE)/_N
ENDIF
_ROUND_FAKTOR=$MN_INT_INCR_PER_MM/_FAK3
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
IF(_BA==1)
IF(NOT((_MERKER_SON==3)AND(_RF2==0)))
SBLON
N10 G0 G90 AX[_XX]=(-_XPM*(_KP[0,0]+_SDIS))*_XAF AX[_ZZ]=(-_ZPM*(_KP[1,1]+_SDIS))*_ZAF
SBLOF
FOR _I=1 TO _N
_BERX=_KP[0,0]-_I*_ZUSTELL _REST_AB_X=_KP[0,0]-(_I-1)*_ZUSTELL
IF(_ZUSTELL<>0)
WHILE(_BERX >_PG[2,0])
_I=_I+1
_BERX=_KP[0,0]-_I*_ZUSTELL
ENDWHILE
ENDIF
SBLON
N15 G0 G90 AX[_XX]=(-_XPM*_BERX)*_XAF
SBLOF
IF(_KP[2,0]<>_KP[0,0])
IF(_BERX<=_KP[0,0])AND(_BERX>=_KP[2,0])
IF(_RF3>0)
_WURZEL=POT(_RF03)-POT(_BERX-_PF[7,0])
_WURZEL=ROUND(_WURZEL*100000)/100000
IF(_WURZEL<0)
_WURZEL=0
ENDIF
_BERZ=_PF[7,1]+SQRT(_WURZEL)
N20 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_BERZ<>_PF[7,1])
_RESTWI=_HALTERWINKEL-90+ATAN2(ABS(_BERX-_PF[7,0]),ABS(_BERZ-_PF[7,1]))
ELSE
_RESTWI=_HALTERWINKEL
ENDIF
ENDIF
IF(_RF3<0)
_BERZ=_K_FASE3_A*_BERX+_K_FASE3_B
N25 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_K_FASE3_A<>0)
_RESTWI=_HALTERWINKEL-ATAN2(1,ABS(_K_FASE3_A))
ELSE
_RESTWI=_HALTERWINKEL-90
ENDIF
ENDIF
IF(_RESTWI>=_RANG)
GOTOF _ABSPAN1
ENDIF
GOTOF _BERENDE
ENDIF
ENDIF
IF(_KP[2,0]<>_KP[3,0])
IF(_BERX<=_KP[2,0])AND(_BERX>=_KP[3,0])
_BERZ=_K_GERADE2_A*_BERX+_K_GERADE2_B
N30 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_K_GERADE2_A<>0)
_RESTWI=_HALTERWINKEL-ATAN2(1,ABS(_K_GERADE2_A))
ELSE
_RESTWI=_HALTERWINKEL-90
ENDIF
IF(_REST_AB_X>_KP[2,0])
_M_NACHZIEHEN=1
ELSE
_M_NACHZIEHEN=0
ENDIF
IF(_RESTWI>=_RANG)OR(_M_NACHZIEHEN==1)
GOTOF _ABSPAN2
ENDIF
GOTOF _BERENDE
ENDIF
ENDIF
IF(_KP[3,0]<>_KP[4,0])
IF(_BERX<=_KP[3,0])AND(_BERX>=_KP[4,0])
IF(_RF2>0)
_WURZEL=POT(_RF02)-POT(_BERX-_PF[4,0])
_WURZEL=ROUND(_WURZEL*100000)/100000
IF(_WURZEL<0)
_WURZEL=0
ENDIF
IF(_MERKER==1)
_BERZ=_PF[4,1]-SQRT(_WURZEL)
ELSE
_BERZ=_PF[4,1]+SQRT(_WURZEL)
ENDIF
N35 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_BERZ<>_PF[4,1])
_RESTWI=_HALTERWINKEL-90+ATAN2(ABS(_BERX-_PF[4,0]),ABS(_BERZ-_PF[4,1]))
ELSE
_RESTWI=_HALTERWINKEL
ENDIF
ENDIF
IF(_RF2<0)
_BERZ=_K_FASE2_A*_BERX+_K_FASE2_B
N40 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_K_FASE2_A<>0)
_RESTWI=_HALTERWINKEL-ATAN2(1,ABS(_K_FASE2_A))
ELSE
_RESTWI=_HALTERWINKEL-90
ENDIF
ENDIF
IF(_REST_AB_X>_KP[3,0])
_M_NACHZIEHEN=1
ELSE
_M_NACHZIEHEN=0
ENDIF
IF(_RESTWI>=_RANG)OR(_M_NACHZIEHEN==1)
GOTOF _ABSPAN3
ENDIF
GOTOF _BERENDE
ENDIF
ENDIF
IF(_KP[4,0]<>_KP[5,0])
IF(_BERX<=_KP[4,0])AND(_BERX>=_KP[5,0])
_BERZ=_K_GERADE1_A*_BERX+_K_GERADE1_B
N45 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_K_GERADE1_A<>0)
_RESTWI=_HALTERWINKEL-ATAN2(1,ABS(_K_GERADE1_A))
ELSE
_RESTWI=_HALTERWINKEL-90
ENDIF
IF(_REST_AB_X>_KP[4,0])
_M_NACHZIEHEN=1
ELSE
_M_NACHZIEHEN=0
ENDIF
IF(_RESTWI>=_RANG)OR(_M_NACHZIEHEN==1)
GOTOF _ABSPAN4
ENDIF
GOTOF _BERENDE
ENDIF
ENDIF
IF(_KP[5,0]<>_KP[1,0])
IF(_BERX<=_KP[5,0])AND(_BERX>=_KP[1,0])
IF(_RF1>0)
_WURZEL=POT(_RF01)-POT(_BERX-_PF[1,0])
_WURZEL=ROUND(_WURZEL*100000)/100000
IF(_WURZEL<0)
_WURZEL=0
ENDIF
_BERZ=_PF[1,1]+SQRT(_WURZEL)
N50 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_BERZ<>_PF[1,1])
_RESTWI=_HALTERWINKEL-90+ATAN2(ABS(_BERX-_PF[1,0]),ABS(_BERZ-_PF[1,1]))
ELSE
_RESTWI=_HALTERWINKEL
ENDIF
ENDIF
IF(_RF1<0)
_BERZ=_K_FASE1_A*_BERX+_K_FASE1_B
N55 G1 AX[_ZZ]=(-_ZPM*_BERZ)*_ZAF
IF(_K_FASE1_A<>0)
_RESTWI=_HALTERWINKEL-ATAN2(1,ABS(_K_FASE1_A))
ELSE
_RESTWI=_HALTERWINKEL-90
ENDIF
ENDIF
IF(_REST_AB_X>_KP[5,0])
_M_NACHZIEHEN=1
ELSE
_M_NACHZIEHEN=0
ENDIF
IF(_RESTWI>=_RANG)OR(_M_NACHZIEHEN==1)
GOTOF _ABSPAN5
ENDIF
GOTOF _BERENDE
ENDIF
ENDIF
IF(_BERX<_KP[1,0])
N60 G1 AX[_ZZ]=(-_ZPM*_KP[1,1])*_ZAF
N65 G1 AX[_XX]=(-_XPM*_KP[1,0])*_XAF
_RESTWI=_HALTERWINKEL-90
IF(_REST_AB_X>_KP[1,0])
_M_NACHZIEHEN=1
ELSE
_M_NACHZIEHEN=0
ENDIF
IF(_RESTWI>=_RANG)OR(_M_NACHZIEHEN==1)
GOTOF _ABSPAN6
ENDIF
GOTOF _BERENDE
ENDIF
GOTOF _BERENDE
_ABSPAN6:
IF(_REST_AB_X <=_KP[1,0])
N70 G1 AX[_XX]=(-_XPM*_KP[1,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[1,1])*_ZAF
ENDIF
_ABSPAN5:
IF(_KP[1,0]<_REST_AB_X)AND(_REST_AB_X<=_KP[5,0])
IF(_RF1>0)
_WURZEL=POT(_RF01)-POT(_REST_AB_X-_PF[1,0])
_WURZEL=ROUND(_WURZEL*100000)/100000
IF(_WURZEL<0)
_WURZEL=0
ENDIF
_REST_AB_Z=_PF[1,1]+SQRT(_WURZEL)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N75 G3 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF IP[_XX]=AC((-_XPM*_PF[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[1,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N80 G2 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF IP[_XX]=AC((-_XPM*_PF[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[1,1])*_ZAF)
ENDIF
ENDIF
IF(_RF1<0)
_REST_AB_Z=_K_FASE1_A*_REST_AB_X+_K_FASE1_B
N85 G1 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF
ENDIF
ENDIF
IF(_KP[5,0]<_REST_AB_X)
IF((ROUND(_KP[5,0]*_ROUND_FAKTOR))<>(ROUND(_BERX*_ROUND_FAKTOR)))
IF(_RF1>0)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N90 G3 AX[_XX]=(-_XPM*_KP[5,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[5,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[1,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N95 G2 AX[_XX]=(-_XPM*_KP[5,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[5,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[1,1])*_ZAF)
ENDIF
ENDIF
ENDIF
IF(_RF1<0)
N100 G1 AX[_XX]=(-_XPM*_KP[5,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[5,1])*_ZAF
ENDIF
ENDIF
_ABSPAN4:
IF(_MERKER_GERADE1<>1)
IF(_REST_AB_X <=_KP[4,0])AND(_REST_AB_X >=_KP[5,0])
_REST_AB_Z=_K_GERADE1_A*_REST_AB_X+_K_GERADE1_B
N105 G1 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF
ENDIF
ENDIF
IF(_KP[4,0]<_REST_AB_X)
N110 G1 AX[_XX]=(-_XPM*_KP[4,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[4,1])*_ZAF
ENDIF
_ABSPAN3:
IF(_REST_AB_X <= _KP[3,0])AND(_REST_AB_X > _KP[4,0] )
IF(_RF2>0)
_WURZEL=POT(_RF02)-POT(_REST_AB_X-_PF[4,0])
_WURZEL=ROUND(_WURZEL*100000)/100000
IF(_WURZEL<0)
_WURZEL=0
ENDIF
IF(_MERKER==1)
_REST_AB_Z=_PF[4,1]-SQRT(_WURZEL)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N115 G2 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N120 G3 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
ELSE
_REST_AB_Z=_PF[4,1]+SQRT(_WURZEL)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N125 G3 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N130 G2 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
ENDIF
ENDIF
IF(_RF2<0)
_REST_AB_Z=_K_FASE2_A*_REST_AB_X+_K_FASE2_B
N135 G1 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF
ENDIF
ENDIF
IF(_KP[3,0]<_REST_AB_X)
IF((ROUND(_KP[3,0]*_ROUND_FAKTOR))<>(ROUND(_BERX*_ROUND_FAKTOR)))
IF(_RF2>0)
IF(_MERKER==1)
IF(_RF02>0)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N140 G2 AX[_XX]=(-_XPM*_KP[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[3,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N145 G3 AX[_XX]=(-_XPM*_KP[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[3,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
ENDIF
ELSE
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N150 G3 AX[_XX]=(-_XPM*_KP[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[3,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N155 G2 AX[_XX]=(-_XPM*_KP[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[3,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[4,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[4,1])*_ZAF)
ENDIF
ENDIF
ENDIF
ENDIF
IF(_RF2<0)
N160 G1 AX[_XX]=(-_XPM*_KP[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[3,1])*_ZAF
ENDIF
ENDIF
_ABSPAN2:
IF(_MERKER_GERADE2<>1)
IF(_REST_AB_X <= _KP[2,0])AND(_REST_AB_X >_KP[3,0] )
_REST_AB_Z=_K_GERADE2_A*_REST_AB_X+_K_GERADE2_B
N165 G1 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF
ENDIF
ENDIF
IF(_KP[2,0]<_REST_AB_X)
N170 G1 AX[_XX]=(-_XPM*_KP[2,0])*_XAF AX[_ZZ]=(-_ZPM*_KP[2,1])*_ZAF
ENDIF
_ABSPAN1:
IF(_KP[2,0]<_REST_AB_X)
IF(_MERKER_GERADE2<>1)
IF((ROUND(_KP[2,0]*_ROUND_FAKTOR))<>(ROUND(_REST_AB_X*_ROUND_FAKTOR)))
IF(_RF3>0)
IF(_REST_AB_X < _PF[7,0]+_RF03)
_WURZEL=POT(_RF03)-POT(_REST_AB_X-_PF[7,0])
_WURZEL=ROUND(_WURZEL*100000)/100000
IF(_WURZEL<0)
_WURZEL=0
ENDIF
_REST_AB_Z=_PF[7,1]+SQRT(_WURZEL)
_H[2,0]=_REST_AB_X _H[2,1]=_REST_AB_Z
ELSE
_H[2,0]=_PF[6,0] _H[2,1]=_PF[6,1]
_REST_AB_Z=_PF[6,1]
ENDIF
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N175 G3 AX[_XX]=(-_XPM*_H[2,0])*_XAF AX[_ZZ]=(-_ZPM*_H[2,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[7,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[7,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N180 G2 AX[_XX]=(-_XPM*_H[2,0])*_XAF AX[_ZZ]=(-_ZPM*_H[2,1])*_ZAF IP[_XX]=AC((-_XPM*_PF[7,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_PF[7,1])*_ZAF)
ENDIF
ENDIF
ENDIF
IF(_RF3<0)
_REST_AB_Z=_K_FASE3_A*_REST_AB_X+_K_FASE3_B
N185 G1 AX[_XX]=(-_XPM*_REST_AB_X)*_XAF AX[_ZZ]=(-_ZPM*_REST_AB_Z)*_ZAF
ENDIF
ENDIF
ENDIF
_BERENDE:
IF(_RESTWI<_RANG)AND(_M_NACHZIEHEN==0)
N190 G0 AX[_XX]=(-_XPM*(_BERX+_SDIS))*_XAF AX[_ZZ]=(-_ZPM*(_BERZ+_SDIS))*_ZAF
ENDIF
IF(_I<_N)OR(_M_NACHZIEHEN==1)
SBLON
N195 G0 AX[_ZZ]=(-_ZPM*(_KP[1,1]+_SDIS))*_ZAF
ELSE
IF(_RESTWI>=_RANG)
N196 G0 AX[_ZZ]=(-_ZPM*(_REST_AB_Z+_SDIS))*_ZAF
ENDIF
SBLOF
ENDIF
ENDFOR
ENDIF
ENDIF
IF(_BA==1)
IF ( ($SCS_FUNCTION_MASK_TURN_SET B_AND 'B10000') AND (_LAGE>1) )
IF (_IJ==1)
SBLON
N197 G0 G90 AX[_ZZ]=(-_ZPM*(_KP[1,1]+_SDIS))*_ZAF
SBLOF
ELSE
SBLON
N197 G0 G90 AX[_XX]=(-_XPM*(_KP[0,0]+_SDIS))*_XAF
SBLOF
ENDIF
ENDIF
IF(_BA10000==1)
SBLON
N197 G0 G90 AX[_XX]=(-_XPM*(_KP[0,0]+_SDIS))*_XAF AX[_ZZ]=(-_ZPM*(_KP[1,1]+_SDIS))*_ZAF
SBLOF
ENDIF
GOTOF _RET
ENDIF
IF(_BA==2)
IF(_BA1000==1)
IF(_KP_FT[1,1]>(_KP_SCHL[5,1]+_EPS))
GOTOF _FEHL6
ENDIF
ENDIF
IF(_MERKER_SON==1)
_RF1=0 _RF2=_M_RADIUS[1] _RF3=_M_RADIUS[2]
_KP_SCHL[3,0]=_KP_SCHL[5,0] _KP_SCHL[3,1]=_KP_SCHL[5,1]
_KP_SCHL[4,0]=_KP_SCHL[1,0] _KP_SCHL[4,1]=_KP_SCHL[1,1]
_KP_MI[1,0]=_KP_MI[2,0] _KP_MI[1,1]=_KP_MI[2,1]
_KP_SCHL[5,0]=_K_M[0,0] _KP_SCHL[5,1]=_PG[0,1]
_KP_SCHL[1,0]=_K_M[0,0] _KP_SCHL[1,1]=_PG[0,1]
ENDIF
IF(_MERKER_SON==2)
_RF1=_M_RADIUS[0] _RF2=_M_RADIUS[1] _RF3=0
_KP_SCHL[3,0]=_KP_SCHL[0,0] _KP_SCHL[3,1]=_KP_SCHL[0,1]
_KP_SCHL[4,0]=_KP_SCHL[2,0] _KP_SCHL[4,1]=_KP_SCHL[2,1]
_KP_MI[1,0]=_KP_MI[0,0] _KP_MI[1,1]=_KP_MI[0,1]
_KP_SCHL[0,0]=_PG[2,0] _KP_SCHL[0,1]=_K_M[0,1]
_KP_SCHL[2,0]=_PG[2,0] _KP_SCHL[2,1]=_K_M[0,1]
ENDIF
IF(_RF1>0)OR(_MERKER_SON==1)OR(_MERKER_SON==3)
_MERKER_GR_AN=2
_AN_KP_MI[0,0]=_KP_SCHL[1,0] _AN_KP_MI[0,1]=_KP_SCHL[1,1]+_SDIS+_WRA
_AN_KP_SCHL[0,0]=_AN_KP_MI[0,0]-ABS(_SDIS+_WRA) _AN_KP_SCHL[0,1]=_AN_KP_MI[0,1]
GOTOF _AN_ENDE
ENDIF
IF(_RF1<0)
_K_DUMMY_A=_K_S_FASE1_A _K_DUMMY_B=_K_S_FASE1_B _WINKEL=_ALPHA_2/2
ENDIF
IF(_RF1==0)
IF(_MERKER_GERADE1<>1)
_K_DUMMY_A=_K_S_GERADE1_A _K_DUMMY_B=_K_S_GERADE1_B _WINKEL=_ALPHA_2
ENDIF
IF(_MERKER_GERADE1==1)
_AN_KP_SCHL[0,0]=_PG[0,0] _AN_KP_SCHL[0,1]=_PG[0,1]+_SDIS+_WRA
_MERKER_GR_AN=1
GOTOF _AN_ENDE
ENDIF
ENDIF
IF((_WINKEL+_EPS)<45)
_MERKER_GR_AN=2
ELSE
_MERKER_GR_AN=1
ENDIF
IF(_MERKER_GR_AN==1)
_H[0,1]=_PG[0,1]+_SDIS+_WRA _H[0,0]=(_H[0,1]-_K_DUMMY_B)/_K_DUMMY_A
_AN_KP_SCHL[0,0]=_H[0,0]-_WRA*SIN(_WINKEL) _AN_KP_SCHL[0,1]=_H[0,1]-_WRA*COS(_WINKEL)
ENDIF
IF(_MERKER_GR_AN==2); Anfahren mit Kreisbogen
_H[0,0]=-1/_K_DUMMY_A _H[0,1]=_KP_SCHL[1,1]-_H[0,0]*_KP_SCHL[1,0]
_AN_KP_MI[0,1]=_KP_SCHL[1,1]+_SDIS+_WRA _AN_KP_MI[0,0]=(_AN_KP_MI[0,1]-_H[0,1])/_H[0,0]
_H[0,0]=_KP_SCHL[1,0]-_AN_KP_MI[0,0] _H[0,1]=_KP_SCHL[1,1]-_AN_KP_MI[0,1] _H[1,0]=SQRT(POT(_H[0,0])+POT(_H[0,1]))
_AN_KP_SCHL[0,0]=_AN_KP_MI[0,0]-_H[1,0] _AN_KP_SCHL[0,1]=_AN_KP_MI[0,1]
ENDIF
_AN_ENDE:
IF(_RF3>0)OR(_MERKER_SON==2)OR(_MERKER_SON==3)
_MERKER_GR_AB=2
_AB_KP_MI[0,0]=_KP_SCHL[0,0]+_SDIS+_WRA _AB_KP_MI[0,1]=_KP_SCHL[0,1]
_AB_KP_SCHL[0,0]=_AB_KP_MI[0,0] _AB_KP_SCHL[0,1]=_AB_KP_MI[0,1]-ABS(_SDIS+_WRA)
GOTOF _AB_ENDE
ENDIF
IF(_RF3<0)
_K_DUMMY_A=_K_S_FASE3_A _K_DUMMY_B=_K_S_FASE3_B _WINKEL=_ALPHA_1/2
ENDIF
IF(_RF3==0)
IF(_MERKER_GERADE2<>1)
_K_DUMMY_A=_K_S_GERADE2_A _K_DUMMY_B=_K_S_GERADE2_B _WINKEL=_ALPHA_1
ENDIF
IF(_MERKER_GERADE2==1)
_AB_KP_SCHL[0,0]=_PG[2,0]+_SDIS+_WRA _AB_KP_SCHL[0,1]=_PG[2,1]
_MERKER_GR_AB=1
GOTOF _AB_ENDE
ENDIF
ENDIF
IF((_WINKEL+_EPS)<45)
_MERKER_GR_AB=2
ELSE
_MERKER_GR_AB=1
ENDIF
IF(_MERKER_GR_AB==1)
_H[0,0]=_PG[2,0]+_SDIS+_WRA _H[0,1]=_H[0,0]*_K_DUMMY_A+_K_DUMMY_B
_AB_KP_SCHL[0,0]=_H[0,0]-_WRA*COS(_WINKEL) _AB_KP_SCHL[0,1]=_H[0,1]-_WRA*SIN(_WINKEL)
_AB_KP_SCHL[1,0]=_H[0,0]-_WRA _AB_KP_SCHL[1,1]=_H[0,1]-_WRA
ENDIF
IF(_MERKER_GR_AB==2); Abfahren mit Kreisbogen
_H[0,0]=-1/_K_DUMMY_A _H[0,1]=_KP_SCHL[0,1]-_H[0,0]*_KP_SCHL[0,0]
_AB_KP_MI[0,0]=_KP_SCHL[0,0]+_SDIS+_WRA _AB_KP_MI[0,1]=_AB_KP_MI[0,0]*_H[0,0]+_H[0,1]
_H[0,0]=_KP_SCHL[0,0]-_AB_KP_MI[0,0] _H[0,1]=_KP_SCHL[0,1]-_AB_KP_MI[0,1] _H[1,0]=SQRT(POT(_H[0,0])+POT(_H[0,1]))
_AB_KP_SCHL[0,0]=_AB_KP_MI[0,0] _AB_KP_SCHL[0,1]=_AB_KP_MI[0,1]-_H[1,0]
ENDIF
_AB_ENDE:
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
SBLON
N205 G0 G90 G42 AX[_XX]=(-_XPM*_AN_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_AN_KP_SCHL[0,1])*_ZAF
SBLOF
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
SBLON
N206 G0 G90 G41 AX[_XX]=(-_XPM*_AN_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_AN_KP_SCHL[0,1])*_ZAF
SBLOF
ENDIF
IF((_RF1==0)AND(_MERKER_GR_AN==1))OR(_MERKER_GR_AN==1)
N207 G1 AX[_XX]=(-_XPM*_KP_SCHL[1,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[1,1])*_ZAF
GOTOF _ENDE_ANFAHREN
ENDIF
IF(_MERKER_GR_AN==2)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N208 G2 AX[_XX]=(-_XPM*_KP_SCHL[1,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[1,1])*_ZAF IP[_XX]=AC((-_XPM*_AN_KP_MI[0,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_AN_KP_MI[0,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N209 G3 AX[_XX]=(-_XPM*_KP_SCHL[1,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[1,1])*_ZAF IP[_XX]=AC((-_XPM*_AN_KP_MI[0,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_AN_KP_MI[0,1])*_ZAF)
ENDIF
ENDIF
_ENDE_ANFAHREN:
IF(_RF1<>0)
IF(_RF1>0)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N215 G3 AX[_XX]=(-_XPM*_KP_SCHL[5,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[5,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[2,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[2,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N220 G2 AX[_XX]=(-_XPM*_KP_SCHL[5,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[5,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[2,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[2,1])*_ZAF)
ENDIF
ELSE
N225 G1 AX[_XX]=(-_XPM*_KP_SCHL[5,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[5,1])*_ZAF
ENDIF
ENDIF
IF(_BA1000==0)
N230 G1 AX[_XX]=(-_XPM*_KP_SCHL[4,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[4,1])*_ZAF
IF(_RF2<>0)
IF(_RF2>0)
IF(_MERKER==1)
IF(_RF2>_WRA)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N235 G2 AX[_XX]=(-_XPM*_KP_SCHL[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[3,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[1,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N240 G3 AX[_XX]=(-_XPM*_KP_SCHL[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[3,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[1,1])*_ZAF)
ENDIF
ENDIF
IF(_RF2==_WRA)
N242 G1 AX[_XX]=(-_XPM*_PG[1,0])*_XAF AX[_ZZ]=(-_ZPM*_PG[1,1])*_ZAF
ENDIF
ELSE
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N245 G3 AX[_XX]=(-_XPM*_KP_SCHL[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[3,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[1,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N250 G2 AX[_XX]=(-_XPM*_KP_SCHL[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[3,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[1,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[1,1])*_ZAF)
ENDIF
ENDIF
ELSE
N255 G1 AX[_XX]=(-_XPM*_KP_SCHL[3,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[3,1])*_ZAF
ENDIF
ENDIF
ELSE
N257 G1 AX[_XX]=(-_XPM*_KP_FT[1,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_FT[1,1])*_ZAF
N258 G1 AX[_XX]=(-_XPM*_KP_FT[0,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_FT[0,1])*_ZAF
ENDIF
N260 G1 AX[_XX]=(-_XPM*_KP_SCHL[2,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[2,1])*_ZAF
IF(_RF3<>0)
IF(_RF3>0)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N265 G3 AX[_XX]=(-_XPM*_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[0,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[0,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[0,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N270 G2 AX[_XX]=(-_XPM*_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[0,1])*_ZAF IP[_XX]=AC((-_XPM*_KP_MI[0,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_KP_MI[0,1])*_ZAF)
ENDIF
ELSE
N275 G1 AX[_XX]=(-_XPM*_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_KP_SCHL[0,1])*_ZAF
ENDIF
ENDIF
IF((_RF3==0)AND(_MERKER_GR_AB==1))OR(_MERKER_GR_AB==1)
N280 G1 AX[_XX]=(-_XPM*_AB_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_AB_KP_SCHL[0,1])*_ZAF
SBLON
N300 G1 G40 AX[_XX]=(-_XPM*(_AB_KP_SCHL[1,0]))*_XAF AX[_ZZ]=(-_ZPM*_AB_KP_SCHL[1,1])*_ZAF
SBLOF
GOTOF _RET
ENDIF
IF(_MERKER_GR_AB==2)
IF(_L==1)OR(_L==2)OR(_L==4)OR(_L==7)
N285 G2 AX[_XX]=(-_XPM*_AB_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_AB_KP_SCHL[0,1])*_ZAF IP[_XX]=AC((-_XPM*_AB_KP_MI[0,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_AB_KP_MI[0,1])*_ZAF)
ENDIF
IF(_L==0)OR(_L==3)OR(_L==5)OR(_L==6)
N290 G3 AX[_XX]=(-_XPM*_AB_KP_SCHL[0,0])*_XAF AX[_ZZ]=(-_ZPM*_AB_KP_SCHL[0,1])*_ZAF IP[_XX]=AC((-_XPM*_AB_KP_MI[0,0])*_XAF) IP[_ZZ]=AC((-_ZPM*_AB_KP_MI[0,1])*_ZAF)
ENDIF
SBLON
N300 G1 G40 AX[_XX]=(-_XPM*(_AB_KP_SCHL[0,0]-_WRA))*_XAF
SBLOF
GOTOF _RET
ENDIF
ENDIF
_RET:
IF (_BA==2)
IF ( ($SCS_FUNCTION_MASK_TURN_SET B_AND 'B10000') AND (_LAGE>1) )
IF (_IJ==1)
SBLON
N197 G0 G90 AX[_ZZ]=(-_ZPM*(_PG[0,1]+_SDIS))*_ZAF
SBLOF
ELSE
SBLON
N197 G0 G90 AX[_XX]=(-_XPM*(_PG[2,0]+_SDIS))*_XAF
SBLOF
ENDIF
ENDIF
IF (_BA10000==1)
SBLON
N310 G0 G90 AX[_XX]=(-_XPM*(_PG[2,0]+_SDIS))*_XAF AX[_ZZ]=(-_ZPM*(_PG[0,1]+_SDIS))*_ZAF
SBLOF
ENDIF
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[8])
ENDIF
SBLON
RET
_FEHL0: STOPRE
N795100 SETAL(61009)
RET
_FEHL1: STOPRE
N795101 SETAL(61610)
RET
_FEHL2: STOPRE
N795102 SETAL(61003)
RET
_FEHL3: STOPRE
N795103 SETAL(61212)
RET
_FEHL4: STOPRE
N795104 SETAL(61006)
RET
_FEHL5: STOPRE
N795105 SETAL(61616,_SERR)
RET
_FEHL6: STOPRE
N795106 SETAL(61605)
RET
_FEHL8: STOPRE
N795108 SETAL(61002)
RET
_FEHL9: STOPRE
N795109 SETAL(61019,_SERR)
RET
_FEHL10: STOPRE
N795110 SETAL(61158)
RET
_FEHL11:STOPRE
N795111 SETAL(62106)
RET
_FEHL12:STOPRE
N795112 SETAL(61732)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE96_SPF
PROC CYCLE96(REAL DIATH,REAL SPL,CHAR FORM,INT _VARI) SAVE DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Thread undercut cycle
DEF AXIS _XX,_ZZ
DEF INT SL,NDI,_II,_ARTIS[16],_TEMP,PLAN=1,_ZAF=1,_XAF=1,_TYP,_GG10,_LOG,_LOG_ON
DEF REAL FAK=1,FWI,_DELT,DELTA,WL1,WL2,HMFA,HMFO,RFZ=1,ND,GA1=14,GB1=8,GA2=21,GB2=15,GC1=24,GD1=15,GC2=30,GD2=21,RR1=3.2,DDG,DDIG,ND_ABS
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE96_MPF"
DEF STRING[35] _LOG_FILE,S_ZZ,S_XX
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE96_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE96("<<DIATH<<","<<SPL<<","<<FORM<<","<<_VARI<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
CYCLE218(10,0)
_ZZ=$P_AXN1 _XX=$P_AXN2 HMFA=$P_ACTFRAME[_ZZ,SC] HMFO=$P_ACTFRAME[_XX,SC] ND=DIATH ND_ABS=ABS(DIATH)
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
PLAN=1
ELSE
PLAN=2
DIAMON
ENDIF
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _XAF=1
DIAMOF
ELSE
IF _ZZ==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=PLAN
ENDIF
IF _XX==AXNAME($MC_DIAMETER_AX_DEF)
_XAF=PLAN
ENDIF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL7
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL7
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL7
ENDIF
ENDIF
IF ($P_GG[13]==2) OR ($P_GG[13]==4) GOTOF _MM1
FAK=$MN_SCALING_VALUE_INCH
_MM1:HMFA=HMFA*FAK HMFO=HMFO*FAK
_TYP=$P_ADT[1]
IF(_TYP<500)OR(_TYP>599) GOTOF _FEHL8
IF _VARI==0
IF $P_TOOL==0
GOTOF FEHL2
ENDIF
SL=$P_ADT[2] FWI=$P_ADT[24]
IF (SL>4)OR(SL<1)
GOTOF FEHL3
ENDIF
ELSE
IF ((_VARI>4) OR (_VARI<1))
GOTOF _FEHL6
ELSE
SL=_VARI
ENDIF
ENDIF
IF FWI==0 GOTOF _MA2 IF FWI>=30 GOTOF _MA2
_MA2:
_MA0: IF ABS(ND)<3 GOTOF FEHL1
IF ND_ABS>68 GOTOF FEHL5 IF (ND_ABS-TRUNC(ND_ABS)==0) GOTOF _MA1
IF (ND_ABS<>3.5)AND(ND_ABS<>4.5) GOTOF FEHL5
_MA1: DDIG=0.5 NDI=ND_ABS
IF ND_ABS<12 GOTOF _MM5 IF ND_ABS<=52 GOTOF _MM30 IF NDI MOD 4 GOTOF FEHL5
DDG=8.3
IF ND_ABS>60 GOTOF BEAB1
DDG=7.7GA1=12.5 GB1=7.5 GA2=19 GB2=14 GC1=22 GD1=14 GC2=28 GD2=20
GOTOF BEAB1
_MM3: DDG=0.8 GA1=1.1 GB1=0.5 GA2=1.75 GB2=1.25 GC1=2 GD1=1.25 GC2=2.7 GD2=2 RR1=0.2
GOTOF BEAB1
_MM3_5: DDIG=0.3
IF ND_ABS>3.5 GOTOF _MM4 IF ND_ABS==3 GOTOB _MM3
DDG=1GA1=1.2 GB1=0.6 GA2=2.1 GB2=1.5 GC1=2.4 GD1=1.5 GC2=3.3 GD2=2.4
GOTOF BEAB1
_MM4: IF ND_ABS>4 GOTOF _MM4_5
DDG=1.1 GA1=1.5 GB1=0.8 GA2=2.45 GB2=1.75 GC1=2.8 GD1=1.75 GC2=3.8 GD2=2.75
GOTOF BEAB1
_MM4_5: DDG=1.2 GA1=1.6 GB1=0.9 GA2=2.6 GB2=1.9 GC1=3 GD1=1.9 GC2=4 GD2=2.9
GOTOF BEAB1
_MM5: RR1=0.4
IF ND_ABS<5 GOTOB _MM3_5 IF ND_ABS>7 GOTOF _MM8 IF ND_ABS>5 GOTOF _MM6
DDG=1.3 DDIG=0.3 GA1=1.7 GB1=0.9 GA2=2.8 GB2=2 GC1=3.2 GD1=2 GC2=4.2 GD2=3
GOTOF BEAB1
_MM6: DDG=1.6 GA1=2.1 GB1=1.1 GA2=3.5 GB2=2.5 GC1=4 GD1=2.5 GC2=5.2 GD2=3.7 RR1=0.6
GOTOF BEAB1
_MM8:IF ND_ABS>8 GOTOF _MM10
DDG=2 GA1=2.7 GB1=1.5 GA2=4.4 GB2=3.2 GC1=5 GD1=3.2 GC2=6.7 GD2=4.9 RR1=0.6
GOTOF BEAB1
_MM10: IF ND_ABS<>10 GOTOF FEHL5
DDG=2.3 GA1=3.2 GB1=1.8 GA2=5.2 GB2=3.8 GC1=6 GD1=3.8 GC2=7.8 GD2=5.6 RR1=0.8
GOTOF BEAB1
_MM12: DDG=2.6 GA1=3.9 GB1=2.1 GA2=6.1 GB2=4.3 GC1=7 GD1=4.3 GC2=9.1 GD2=6.4 RR1=1
GOTOF BEAB1
_MM14: IF NDI MOD 2 GOTOF FEHL5 IF ND_ABS<14 GOTOB _MM12
DDG=3 GA1=4.5 GB1=2.5 GA2=7 GB2=5 GC1=8 GD1=5 GC2=10.3 GD2=7.3 RR1=1
GOTOF BEAB1
_MM18: IF ND_ABS<18 GOTOB _MM14 IF ND_ABS>22 GOTOF _MM24 IF NDI MOD 2 GOTOF FEHL5
DDG=3.6 GA1=5.6 GB1=3.2 GA2=8.7 GB2=6.3 GC1=10 GD1=6.3 GC2=13 GD2=9.3 RR1=1.2
GOTOF BEAB1
_MM24: IF NDI MOD 3 GOTOF FEHL5
DDG=4.4 GA1=6.7 GB1=3.7 GA2=10.5 GB2=7.5 GC1=12 GD1=7.5 GC2=15.2 GD2=10.7 RR1=1.6
GOTOF BEAB1
_MM30: IF ND_ABS<30 GOTOB _MM18 IF (ND_ABS<=48)AND(NDI MOD 3) GOTOF FEHL5 IF ND_ABS>39 GOTOF _MM42 IF ND_ABS> 33 GOTOF _MM36
DDG=5 GA1=7.7 GB1=4.7 GA2=12 GB2=9 GC1=14 GD1=9 GC2=17.7 GD2=12.7 RR1=1.6
GOTOF BEAB1
_MM36: DDG=5.7 GA1=9 GB1=5 GA2=14 GB2=10 GC1=16 GD1=10 GC2=20 GD2=14 RR1=2
GOTOF BEAB1
_MM42: IF ND_ABS>45 GOTOF _MM48
DDG=6.4 GA1=10.5 GB1=5.5 GA2=16 GB2=11 GC1=18 GD1=11 GC2=23 GD2=16 RR1=2
GOTOF BEAB1
_MM48:IF NDI MOD 4 GOTOF FEHL5
DDG=7 GA1=11.5 GB1=6.5 GA2=17.5 GB2=12.5 GC1=20 GD1=12.5 GC2=26 GD2=18.5 RR1=2.5
BEAB1:ND=ND/2 DDG=DDG/2 DDIG=DDIG/2
_MB1:IF (SL==3)OR(SL==2) GOTOF _MB2
RFZ=-1
_MB2:
IF _VARI==0
IF $P_ACTFRAME[_ZZ,MI]<>0
RFZ=RFZ*(-1)
ENDIF
ENDIF
IF (FORM=="C")OR(FORM=="D") GOTOF _MI1 IF (FORM<>"A")AND(FORM<>"B") GOTOF FEHL4
WL2=GA2
IF FORM=="A" GOTOF _MB3
WL2=GB2
_MB3: _DELT=(WL2+DDIG/TAN(30))*RFZ/HMFA DELTA=(WL2-DDG/TAN(30))*RFZ/HMFA
ND=ND/HMFO DDG=DDG/HMFO DDIG=DDIG/HMFO RR1=RR1/HMFA
N10 G0 G90 G60 AX[_ZZ]=(SPL+_DELT)*_ZAF AX[_XX]=(ND+DDIG)*_XAF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF SL==3 GOTOF _MB4 IF SL<>4 GOTOF FEHL3
N11 G1 G41 G[10]=_GG10 AX[_ZZ]=SPL+_DELT-((DDIG/TAN(30))*(RFZ/HMFA)) AX[_XX]=ND*PLAN
GOTOF _MB5
N12 _MB4:G42 G1 G[10]=_GG10 AX[_ZZ]=SPL+_DELT-((DDIG/TAN(30))*(RFZ/HMFA)) AX[_XX]=ND*PLAN
N13 _MB5:AX[_ZZ]=(SPL+DELTA)*_ZAF AX[_XX]=(ND-DDG)*_XAF RND=RR1
N14 AX[_ZZ]=SPL*_ZAF RND=RR1
N15 AX[_XX]=(ND+DDIG+$P_TOOLR/HMFO)*_XAF
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
N16 G0 G40 G60 AX[_ZZ]=(SPL+_DELT)*_ZAF AX[_XX]=(ND+DDIG)*_XAF
RET
_MI1:
WL1=GC1 WL2=GC2
IF FORM=="C" GOTOF _MI2
WL1=GD1 WL2=GD2
_MI2:DELTA=(DDG+DDIG-RR1*(1-COS(30))) _DELT=(RR1*SIN(30)+DELTA/TAN(30))/HMFA DELTA=DELTA/HMFO
ND=ND/HMFO DDG=DDG/HMFO DDIG=DDIG/HMFO RR1=RR1/HMFA WL1=WL1/HMFA WL2=WL2/HMFA
N20 G0 G90 G60 AX[_ZZ]=(SPL+(WL1+_DELT)*RFZ)*_ZAF AX[_XX]=(ND-DELTA)*_XAF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF SL==2 GOTOF _MI3 IF SL<>1 GOTOF FEHL3
N21 G42 G1 G[10]=_GG10 AX[_ZZ]=(SPL+WL2*RFZ)*_ZAF AX[_XX]=(ND-DELTA+(WL1+_DELT-WL2)*TAN(30))*_XAF
GOTOF _MI4
N22 _MI3:G41 G1 G[10]=_GG10 AX[_ZZ]=(SPL+WL2*RFZ)*_ZAF AX[_XX]=(ND-DELTA+(WL1+_DELT-WL2)*TAN(30))*_XAF
N23 _MI4:AX[_ZZ]=(SPL+(WL1+RR1*SIN(30))*RFZ)*_ZAF AX[_XX]=(ND+DDIG-RR1*(1-COS(30)))*_XAF
IF SL==2 GOTOF _MI5
N24 G2 AX[_ZZ]=(SPL+WL1*RFZ)*_ZAF AX[_XX]=(ND+DDIG)*_XAF CR=RR1
GOTOF _MI6
N25 _MI5:G3 AX[_ZZ]=(SPL+WL1*RFZ)*_ZAF AX[_XX]=(ND+DDIG)*_XAF CR=RR1
N26 _MI6:G1 AX[_ZZ]=SPL*_ZAF RND=RR1
N27 AX[_XX]=(ND-DELTA)*_XAF
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
N28 G0 G40 G60 AX[_ZZ]=(SPL+(WL1+_DELT)*RFZ)*_ZAF AX[_XX]=(ND-DELTA)*_XAF
RET
FEHL1: STOPRE
N709601 SETAL(61601)
RET
FEHL2: STOPRE
N709602 SETAL(61000)
RET
FEHL3: STOPRE
N709602 SETAL(61608)
RET
FEHL4: STOPRE
N709602 SETAL(61609)
RET
FEHL5: STOPRE
N709602 SETAL(61001)
RET
_FEHL6: STOPRE
N709602 SETAL(61613)
RET
_FEHL7: STOPRE
N709602 SETAL(62106)
RET
_FEHL8: STOPRE
N709608 SETAL(61212)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE97_SPF
PROC CYCLE97(REAL PIT,REAL MPIT,REAL SPL,REAL FPL,REAL DM1,REAL DM2,REAL APP,REAL ROP,REAL TDEP,REAL FAL,REAL IANG,REAL NSP,INT NRC,INT NID,INT VARI,INT NUMTH,REAL _VRT) SAVE DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Thread cutting cycle
DEF AXIS _ZA,_SA,_ZZ,_XX,_MAX
DEF INT IA,LP=1,RF=1,WI=90,II,JJ,KK,ZF=1,_NRCI,_INCHFAK,_PLAN=1,_ZAF=1,_SAF=1,_ALF,_AXZAHL=4,_AKTLFON,_SPIZAHL=4,_ARTIS[16],_TEMP,_GG10
DEF INT _ERR,_SP,_LP,_PM,_FRL,_CDIR,_H_MSNUM,_MA_NR_SP=0,_KA_NR_SP=-1,_TYP,S_SDIR_LOCAL
DEF REAL SAB=1,PP,SPV,DEL,TW1,TW2,RZP,SPS,SPZ,EPZ,EPX,HH1,HH2,HH3,HH4,_ZKOR,_ZANF,_HC1,_KSDIFF[2],_ANGPLUS=0
DEF REAL _SPD,_SPL,_PIT,_NSP,_UMQ,_D,_F,_C97_2,_C97_3,_GDIR,_C_M3
DEF REAL _FAK1,_FAK2,_FAK3,_FAK4
DEF BOOL _MDG
DEF STRING[35] _AX
DEF STRING[30] _S_KA_NR
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE97_MPF"
DEF STRING[40] _LOG_FILE
DEF INT _LOG,_LOG_ON=0
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE97_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
WRITE(_TEMP,_TEMP_FILE,";Spindel im Kanal=1 oder in anderem Kanal=0: Wert="<<$P_SMODE[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE99("<<PIT<<","<<MPIT<<","<<SPL<<","<<FPL<<","<<DM1<<","<<DM2<<","<<APP<<","<<ROP<<","<<TDEP<<","<<FAL<<","<<IANG<<","<<NSP<<","<<NRC<<","<<NID<<","<<VARI<<","<<NUMTH<<","<<_VRT<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (_SC_Y_TURN<>0)
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
CYCLE218(10,0)
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE97_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE97: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
_TYP=$P_AD[1]
IF ( (_TYP<500)OR(_TYP>599) ) GOTOF _FEHL19
IF ((_TYP _DEC1)==5) GOTOF _FEHL19
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_FAK4=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK4=$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK4=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF _VRT<=0
IF ($P_GG[13]==2) OR ($P_GG[13]==4)
SAB=1
ELSE
SAB=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
SAB=_VRT
ENDIF
_AKTLFON=(VARI/10) MOD 10
IF(_AKTLFON>1) GOTOF FEHL2
VARI=VARI MOD 10
_MA1:_ZA=$P_AXN2 _SA=$P_AXN1 _INCHFAK=$P_GG[13] IA=VARI MOD 2 PP=PIT TW2=TAN(ABS(IANG)) _NRCI=NRC _ZKOR=FAL*TW2 DM1=DM1/2 DM2=DM2/2
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL4
ENDIF
II=_ARTIS[0] DIV 10
IF ((II MOD 10 > 3) OR (II MOD 10 < 1))
GOTOF _FEHL4
ELSE
_ARTIS[11]=II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
II=II DIV 10
IF ((II MOD 10 > 2) OR (II MOD 10 < 0))
GOTOF _FEHL4
ELSE
_ARTIS[12]=II MOD 10
ENDIF
ENDIF
_INCHFAK=_INCHFAK MOD 2
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_PLAN=1
ELSE
_PLAN=2
DIAMON
ENDIF
IF _INCHFAK==1
ENDIF
IF (VARI<1)OR(VARI>4) GOTOF FEHL2 IF IA==1 GOTOF _MB1
IA=-1
_MB1:HH2=FPL-SPL
IF HH2==0 GOTOF _MC1
N710 TW1=(DM2-DM1)/HH2 WI=0
IF ABS(TW1)<=1 GOTOF _MD1
N720 _MC1:LP=0 HH2=DM2-DM1 TW1=(FPL-SPL)/HH2 _ZA=$P_AXN1 _SA=$P_AXN2
_MD1:
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _SAF=1
DIAMOF
ELSE
IF _ZA==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=_PLAN
ENDIF
IF _SA==AXNAME($MC_DIAMETER_AX_DEF)
_SAF=_PLAN
ENDIF
ENDIF
IF ABS(TW1)<0.00001 GOTOF _MY10
IANG=ABS(IANG)
N730 _MY10:RF=HH2/ABS(HH2) IA=IA/$P_ACTFRAME[_ZA,SC] SAB=SAB/$P_ACTFRAME[_ZA,SC]
IF NUMTH GOTOF _ML1
NUMTH=1
_ML1:IF MPIT==0 GOTOF _MM1 IF (MPIT<3)OR(MPIT>60) GOTOF FEHL1
N1 CYCLE204(PP,MPIT)
IF (PP<>PIT)AND(PIT<>0) GOTOF FEHL1
_MM1:IF (NRC<>0)OR(NID<>0) GOTOF _MA2
NRC=1 _NRCI=1
_MA2:IF LP==0 GOTOF _MG2
SPS=SPL-RF*APP SPZ=DM1+IA*SAB-TW1*RF*APP EPZ=FPL+RF*ROP EPX=DM2+IA*SAB+TW1*RF*ROP RZP=EPX HH3=EPZ
GOTOF _MA3
_MG2:SPS=DM1-RF*APP EPX=DM2+RF*ROP
IF WI GOTOF _MP2
SPZ=SPL+IA*SAB-RF*TW1*APP EPZ=FPL+IA*SAB+RF*TW1*ROP
GOTOF _MQ2
_MP2:SPZ=SPL+IA EPZ=FPL+IA
_MQ2:RZP=EPZ HH3=EPX
_MA3:IF NRC<>0 GOTOF _MC3
_NRCI=1
N740 _MC3:_ZANF=SPS _HC1=ABS((TDEP-FAL)/SQRT(_NRCI)*TW2) II=NRC JJ=-RF
IF IANG==0 GOTOF _MA4 IF IANG>0 GOTOF _MA4 IF VARI<3 GOTOF _MA4 IF _NRCI==1 GOTOF _MA4
N750 _MB3:HH1=(SQRT(II)-SQRT(II-1))*_HC1 II=II-1 JJ=-JJ
IF II>1 GOTOB _MB3
_MA4:
IF ($MCS_FUNCTION_MASK_TURN B_AND 'B1000000000000') GOTOF _M5304
_H_MSNUM=$P_MSNUM
IF(_H_MSNUM)
REPEAT
REPEAT
_KA_NR_SP=_KA_NR_SP+1
_S_KA_NR="$MC_AXCONF_MACHAX_USED["<<_KA_NR_SP<<"]"
IF ISVAR(_S_KA_NR)
_MA_NR_SP=$MC_AXCONF_MACHAX_USED[_KA_NR_SP]
ELSE
GOTOF _FEHL5
ENDIF
UNTIL(_MA_NR_SP>0)
_AX="AX"<<_MA_NR_SP
_MAX=(AXNAME(_AX))
UNTIL(_H_MSNUM==$MA_SPIND_ASSIGN_TO_MACHAX[_MAX])
IF(($MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]) B_AND 'B1000')
_CDIR=-1
ELSE
_CDIR=1
ENDIF
IF(($MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]) B_AND 'B100000')
_C_M3=-1
ELSE
_C_M3=1
ENDIF
ELSE
GOTOF _FEHL5
ENDIF
IF ($P_SMODE[$P_MSNUM]==1)
IF($P_SDIR[$P_MSNUM]==5)
GOTOF _FEHL6
ELSE
S_SDIR_LOCAL=$P_SDIR[$P_MSNUM]
ENDIF
ELSE
IF($AC_SDIR[$P_MSNUM]==5)
GOTOF _FEHL6
ELSE
S_SDIR_LOCAL=$AC_SDIR[$P_MSNUM]
ENDIF
ENDIF
_PM=RF
_GDIR=-(S_SDIR_LOCAL*2-7)*_PM*_CDIR*_C_M3
_FRL=-_CDIR*_GDIR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," M3/4: M"<<S_SDIR_LOCAL)
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," _CDIR:"<<_CDIR)
WRITE(_LOG,_LOG_FILE," _FRL: "<<_FRL)
ENDIF
_SP=-1
IF($MCS_AXIS_USAGE[_KA_NR_SP]==3)
_SP=0
ELSE
IF($MCS_AXIS_USAGE[_KA_NR_SP]==5)
_SP=1
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindel synchronisieren: _SP="<<_SP)
ENDIF
IF(_SP>=0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_SC_C97["<<_SP<<",0...3]= "<<_SC_C97[_SP,0]<<" , "<<_SC_C97[_SP,1]<<" , "<<_SC_C97[_SP,2]<<" , "<<_SC_C97[_SP,3])
WRITE(_LOG,_LOG_FILE,"$P_TC="<<$P_TC)
WRITE(_LOG,_LOG_FILE,"_FAK1="<<_FAK1<<" _FAK2="<<_FAK2<<" _FAK3="<<_FAK3<<" _FAK4="<<_FAK4)
WRITE(_LOG,_LOG_FILE,"$P_TOOLL[2]="<<$P_TOOLL[2]<<" $P_TOOLL[1]="<<$P_TOOLL[1])
ENDIF
IF(_SC_C97[_SP,0]==1)
IF ( ($P_ACTFRAME[_XX,RT]<>0) OR ($P_ACTFRAME[_ZZ,RT]<>0) OR (NOT($P_TRAFO==0)) OR ($P_TC) )
GOTOF _FEHL9
ENDIF
_ZZ=_SA
_XX=_ZA
_LP=LP
_SPD=DM1
_SPL=SPL
_PIT=PIT
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=2
$AC_MEAS_P2_COORD=0
$AA_MEAS_POINT1[_ZZ]=_SC_C97[_SP,2]*_FAK3-$P_TOOLL[2]*_FAK1
$AA_MEAS_POINT1[_XX]=_SC_C97[_SP,3]*_FAK3-$P_TOOLL[1]*_FAK1
_ERR=MEASURE()
IF(_ERR) GOTOF _FEHL14
_C97_2=$AA_MEAS_POINT2[_ZZ]
_C97_3=$AA_MEAS_POINT2[_XX]/_PLAN
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Z: "<<_SC_C97[_SP,2]<<"(MKS) = "<<_C97_2<<"(WKS)")
WRITE(_LOG,_LOG_FILE,"X: "<<_SC_C97[_SP,3]<<"(MKS) = "<<_C97_3<<"(WKS)")
WRITE(_LOG,_LOG_FILE,"Z MEAS_POINTS: "<<$AA_MEAS_POINT1[_ZZ]<<"(MKS) = "<<$AA_MEAS_POINT2[_ZZ]<<"(WKS)")
ENDIF
IF(_LP)
_D=_SPL-_C97_2
ELSE
_D=_C97_3-_SPD/2
ENDIF
_F=_PIT
_UMQ=_D/_F
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"UMQ= "<<_UMQ*360)
WRITE(_LOG,_LOG_FILE,"D  = "<<_D)
WRITE(_LOG,_LOG_FILE,"F  = "<<_F)
ENDIF
IF(_LP)
_UMQ=-(_UMQ-TRUNC(_UMQ))*_FRL
ELSE
_UMQ=(_UMQ-TRUNC(_UMQ))*_FRL
ENDIF
_NSP=_NSP+_SC_C97[_SP,1]+_UMQ*360
_NSP=((_NSP MOD 360)+360) MOD 360
_ANGPLUS=_NSP
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"NSP= "<<_NSP)
WRITE(_LOG,_LOG_FILE,"UMQ= "<<_UMQ*360)
WRITE(_LOG,_LOG_FILE,"SYNC="<<_SC_C97[_SP,1])
ENDIF
ENDIF
ENDIF
_M5304:
IF(LP==1)
IF(IA==1)
_ALF=3
ELSE
_ALF=7
ENDIF
ELSE
IF(IA==1)
_ALF=1
ELSE
_ALF=5
ENDIF
ENDIF
II=0
_MB4:HH1=ABS(TDEP-FAL)/_NRCI
IF VARI<3 GOTOF _MC4
N760 HH1=HH1*_NRCI/SQRT(_NRCI)
IF (NRC MOD 2)==0 GOTOF _MC4 IF IANG>=0 GOTOF _MC4
ZF=-1
_MC4:SPV=NSP+360/NUMTH*II JJ=1 HH2=0
IF (SPV+_ANGPLUS)>=360
_ANGPLUS=_ANGPLUS-360
ENDIF
SBLOF
IF(_AKTLFON==1)
$AC_LIFTFAST=0
ENDIF
SBLON
_MD4:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
DEL=HH1*SQRT(JJ)
IF NRC==0 GOTOF _MJ4 IF VARI>2 GOTOF _ME4
DEL=HH1*JJ
_ME4:HH4=-IA*(SAB+DEL)
IF IANG==0 GOTOF _MF4
_MQ4:HH2=-RF*ZF*((TDEP-DEL)*TW2-_ZKOR)
N40 _MF4:G0 G90 G60 AX[_SA]=(_ZANF+HH2)*_SAF AX[_ZA]=SPZ*_ZAF
IF(_AKTLFON==1)
IF($P_LIFTFAST==0)
GOTOF _XWEIT
ELSE
SBLOF
_MDG=1
SBLON
M0
STOPRE
SBLOF
SBLON
ENDIF
ENDIF
_XWEIT:
IF(_AKTLFON==1)
SBLOF
$AC_LIFTFAST=0
SBLON
ENDIF
IF IANG>0 GOTOF _MG4
ZF=-ZF
N41 _MG4:G91 AX[_ZA]=HH4*_ZAF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF(_AKTLFON==1)
N42 G33 G90 AX[_SA]=HH3*_SAF AX[_ZA]=(RZP+HH4)*_ZAF IP[_SA]=PP SF=SPV+_ANGPLUS LFON DILF=ABS(HH4) LFWP ALF=_ALF
LFOF G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5311
ENDIF
ELSE
N42 G33 G90 AX[_SA]=HH3*_SAF AX[_ZA]=(RZP+HH4)*_ZAF IP[_SA]=PP SF=SPV+_ANGPLUS
N43 G0
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
N43 _M5311: G[10]=_GG10
IF (_AKTLFON==0)
N44 G0 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
JJ=JJ+1
ELSE
IF ($P_LIFTFAST==0)
N44 G0 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
GOTOF _M531A
ELSE
GOTOB _MD4
ENDIF
ENDIF
_M531A:
IF (_AKTLFON==1)
STOPRE
IF ($AC_LIFTFAST==0)
N44 G0 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
JJ=JJ+1
ELSE
GOTOB _MD4
ENDIF
ENDIF
IF JJ<=NRC GOTOB _MD4 IF (NID==0)AND(FAL==0) GOTOF _MMP4
_MJ4:JJ=0 HH4=RZP-IA*(SAB+TDEP)
_M5310:
IF LP==1 GOTOF _MMJ4
HH4=EPZ-IA*(SAB+TDEP)
_MMJ4:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
N50 G0 G90 G60 AX[_SA]=SPS*_SAF AX[_ZA]=SPZ*_ZAF
IF(_AKTLFON==1)
IF($P_LIFTFAST==0)
GOTOF _XWEITS
ELSE
SBLOF
_MDG=1
SBLON
M0
STOPRE
SBLOF
SBLON
ENDIF
ENDIF
_XWEITS:
IF(_AKTLFON==1)
SBLOF
$AC_LIFTFAST=0
SBLON
ENDIF
N51 G91 AX[_ZA]=(-IA*(SAB+TDEP))*_ZAF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF(_AKTLFON==1)
N52 G33 G90 AX[_SA]=HH3*_SAF AX[_ZA]=HH4*_ZAF IP[_SA]=PP SF=SPV+_ANGPLUS LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
LFOF G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5312
ENDIF
ELSE
N52 G33 G90 AX[_SA]=HH3*_SAF AX[_ZA]=HH4*_ZAF IP[_SA]=PP SF=SPV+_ANGPLUS
N53 G0
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
N53 _M5312: G0
IF (_AKTLFON==0)
N54 G0 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
JJ=JJ+1
ELSE
IF ($P_LIFTFAST==0)
N54 G0 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
GOTOF _M531B
ELSE
GOTOB _M5310
ENDIF
ENDIF
_M531B:
IF (_AKTLFON==1)
STOPRE
IF ($AC_LIFTFAST==0)
N54 G0 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
JJ=JJ+1
ELSE
GOTOB _M5310
ENDIF
ENDIF
IF ((JJ<=NID) AND (FAL<>0)) GOTOB _MMJ4
IF ((JJ<NID) AND (FAL==0)) GOTOB _MMJ4
_MMP4:II=II+1
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
IF (II<NUMTH)AND(NRC==0) GOTOB _MC4 IF II<NUMTH GOTOB _MB4
N60 G0 G90 G60 AX[_SA]=SPS*_SAF AX[_ZA]=SPZ*_ZAF
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
RET
FEHL1: STOPRE
N709701 SETAL(61001)
RET
FEHL2: STOPRE
N709702 SETAL(61002)
RET
_FEHL3: STOPRE
N709703 SETAL(61612)
RET
_FEHL4: STOPRE
N709704 SETAL(62106)
RET
_FEHL5: STOPRE
N709705 SETAL(61287)
RET
_FEHL6: STOPRE
N709706 SETAL(61102)
RET
_FEHL9: STOPRE
N709709 SETAL(61612)
RET
_FEHL14: STOPRE
N709714 SETAL(61099,"MEASURE")
RET
_FEHL19: STOPRE
N709719 SETAL(61212)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE98_SPF
PROC CYCLE98(REAL _PO1,REAL _DM1,REAL _PO2,REAL _DM2,REAL _PO3,REAL _DM3,REAL _PO4,REAL _DM4,REAL APP,REAL ROP,REAL TDEP,REAL FAL,REAL _IANG,REAL _NSP,INT NRC,INT NID,REAL _PP1,REAL _PP2,REAL _PP3,INT _VARI,INT _NUMTH,REAL _VRT,REAL _MID,REAL _GDEP,REAL _IFLANK,INT _PITA,STRING[15] _PITM1,STRING[15] _PITM2,STRING[15] _PITM3,INT _DMODE,INT _AMODE) SAVE DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.009 ;DATE: 2024-05-22
;Cycle support HMIsl
;Thread chaining
N10 DEF AXIS _ZA,_SA,_IPAX,_ZZ,_XX,_MAX
N11 DEF INT IA,LP=1,RF=1,WI1=90,II,JJ,KK,ZF=1,_NRCI,_INCHFAK,PLAN=1,_ZAF=1,_SAF=1,_NULLWEG[3]=(1,1,1)
N12 DEF INT _ALF, _LIFTNR, _AXZAHL=4, _AKTLFON, _DIA,_ISO, _SPIZAHL=4,VARI,NUMTH,_VI[7],_AI[9],_NRCX,_DMODE1,_DMODE5,_GG10
DEF INT _ERR,_SP,_LP,_PM,_FRL,_CDIR,_H_MSNUM,_MA_NR_SP=0,_KA_NR_SP=-1,_PLAN,S_SDIR_LOCAL
N13 DEF INT _ARTIS[16]
N14 DEF REAL SAB=1,SPV,DEL,TW1,TW2,TW3,RZP,SPS,SPZ,EPZ,EPX,HH1,HH2,HH3,HH4,ZP[4,4],AEP[2,2],_ZKOR,_ZANF,_HC1,NSP
N15 DEF REAL _KSDIFF[2], _ANGPLUS=0, _KEGV, _EPS=0.001,PO1,DM1,PO2,DM2,PO3,DM3,PO4,DM4,IANG,_ZUG,_ZUA,PP1,PP2,PP3
DEF REAL _SPD,_SPL,_PIT,_UMQ,_D,_F,_C97_2,_C97_3,_GDIR,_C_M3
DEF REAL _FAK1,_FAK2,_FAK3,_FAK4,_SPV,_UM,_SPVALL,HH4_NEU
N16 DEF BOOL _MDG
N17 DEF STRING[32] _PAR_NAME
DEF STRING[35] _AX,_SERR
DEF STRING[30] _S_KA_NR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE98_MPF"
DEF STRING[40] _LOG_FILE
DEF INT _LOG,_LOG_ON=0,_TYP
CYCLE218(11)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE98_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
WRITE(_TEMP,_TEMP_FILE,";Spindel im Kanal=1 oder in anderem Kanal=0: Wert="<<$P_SMODE[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE98("<<_PO1<<","<<_DM1<<","<<_PO2<<","<<_DM2<<","<<_PO3<<","<<_DM3<<","<<_PO4<<","<<_DM4<<","<<APP<<","<<ROP<<","<<TDEP<<","<<FAL<<","<<_IANG<<","<<_NSP<<","<<NRC<<","<<NID<<","<<_PP1<<","<<_PP2<<","<<_PP3<<","<<_VARI<<","<<_NUMTH<<","<<_VRT<<","<<_MID<<","<<_GDEP<<","<<_IFLANK<<","<<_PITA<<","<<_PITM1<<","<<_PITM2<<","<<_PITM3<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (_SC_Y_TURN<>0)
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE98_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE98: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
_TYP=$P_AD[1]
IF ( (_TYP<500)OR(_TYP>599) ) GOTOF _FEHL19
IF ((_TYP _DEC1)==5) GOTOF _FEHL19
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_FAK4=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK4=$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK4=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_DMODE1=_DMODE _DEC1 _DMODE5=_DMODE _DEC5
_AI[0]=_AMODE _DEC1 _AI[1]=_AMODE _DEC2 _AI[2]=_AMODE _DEC3 _AI[3]=_AMODE _DEC4 _AI[4]=_AMODE _DEC5 _AI[5]=_AMODE _DEC6 _AI[6]=_AMODE _DEC7 _AI[7]=_AMODE _DEC8 _AI[8]=_AMODE _DEC9
IF (_DMODE5<0)OR(_DMODE5>1)
_SERR=<<"(_DMODE: dec5)"
GOTOF _FEHL15
ENDIF
IF (_DMODE5==1)
_VRT=$SCS_EASY_SAFETY_CLEARANCE
_VRT=_VRT*_FAK1
_AI[7]=1
_NSP=0
ENDIF
DM1=_DM1 PO1=_PO1 IANG=_IANG VARI=_VARI PP1=_PP1 PP2=_PP2 PP3=_PP3
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF _VARI<0 GOTOF _FEHL1
_VI[0]=VARI _DEC1 _VI[1]=VARI _DEC2 _VI[2]=VARI _DEC3 _VI[3]=VARI _DEC4 _VI[4]=VARI _DEC5 _VI[5]=VARI _DEC6 _VI[6]=VARI _DEC7
IF ((_VI[0]==0) OR (_VI[0]>4)) GOTOF _FEHL1
IF (_VI[1]>1) GOTOF _FEHL1
IF (_VI[2]>4) GOTOF _FEHL1
IF (_VI[3]>1) GOTOF _FEHL1
IF (_VI[4]>1) GOTOF _FEHL1
IF ((_VI[5]<0) OR (_VI[5]>3)) GOTOF _FEHL1
IF (_VI[6]>1) GOTOF _FEHL1
_ISO=_VI[3]
_AKTLFON=_VI[1]
IF _AMODE<0 GOTOF _FEHL2
FOR II=0 TO 6
IF _AI[II]>2 GOTOF _FEHL2
ENDFOR
II=1
IF (_AI[0]>1) GOTOF _FEHL2
II=3
IF (_AI[2]>1) GOTOF _FEHL2
II=5
IF (_AI[4]>1) GOTOF _FEHL2
II=7
IF (_AI[6]>1) GOTOF _FEHL2
II=8
IF (_AI[7]>2) GOTOF _FEHL2
II=9
IF (_AI[8]>1) GOTOF _FEHL2
IF APP<0
_PAR_NAME="LW"
GOTOF _FEHL5
ENDIF
IF ROP<0
_PAR_NAME="LR"
GOTOF _FEHL5
ENDIF
IF TDEP<0
_PAR_NAME="H1"
GOTOF _FEHL5
ENDIF
IF FAL<0
_PAR_NAME="U"
GOTOF _FEHL5
ENDIF
IF NSP<0
_PAR_NAME=" < alpha0 > "
GOTOF _FEHL5
ENDIF
IF NRC<0
_PAR_NAME="ND"
GOTOF _FEHL5
ENDIF
IF NID<0
_PAR_NAME="NN"
GOTOF _FEHL5
ENDIF
IF NUMTH<0
_PAR_NAME="N"
GOTOF _FEHL5
ENDIF
IF _MID<0
_PAR_NAME="D1"
GOTOF _FEHL5
ENDIF
IF _GDEP<0
_PAR_NAME="DA"
GOTOF _FEHL5
ENDIF
IF ((_DMODE1<0) OR (_DMODE1>3))
_PAR_NAME=" < _DMODE dec1>"
GOTOF _FEHL5
ENDIF
IF _AI[0]==0
PO2=_PO2
ELSE
PO2=PO1+_PO2
ENDIF
IF _AI[1]==0
DM2=_DM2
ELSE
IF _AI[1]==1
DM2=DM1+_DM2*2
ELSE
DM2=DM1+(TAN(_DM2)*ABS(PO2-PO1))*2
ENDIF
ENDIF
IF _AI[2]==0
PO3=_PO3
ELSE
PO3=PO2+_PO3
ENDIF
IF _AI[3]==0
DM3=_DM3
ELSE
IF _AI[3]==1
DM3=DM2+_DM3*2
ELSE
DM3=DM2+(TAN(_DM3)*ABS(PO3-PO2))*2
ENDIF
ENDIF
IF _AI[4]==0
PO4=_PO4
ELSE
PO4=PO3+_PO4
ENDIF
IF _AI[5]==0
DM4=_DM4
ELSE
IF _AI[5]==1
DM4=DM3+_DM4*2
ELSE
DM4=DM3+(TAN(_DM4)*ABS(PO4-PO3))*2
ENDIF
ENDIF
IF (DM1==DM2) AND (PO1==PO2)
_NULLWEG[0]=0
ENDIF
IF (DM2==DM3) AND (PO2==PO3)
_NULLWEG[1]=0
ENDIF
IF (DM3==DM4) AND (PO3==PO4)
_NULLWEG[2]=0
ENDIF
IF (DM1==DM4) AND (PO1==PO4)
GOTOF _FEHL8
ENDIF
IF _VRT<=0
IF ($P_GG[13]==2) OR ($P_GG[13]==4)
SAB=1
ELSE
SAB=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
SAB=_VRT
ENDIF
_DMODE1=_DMODE _DEC1
IF((_DMODE1>0)AND(_DMODE1<4))
G[6]=_DMODE1
ENDIF
VARI=_VI[0]
DM1=DM1/2 DM2=DM2/2 DM3=DM3/2 DM4=DM4/2
ZP[0,0]=PO2 ZP[0,1]=DM2 ZP[1,0]=PO3 ZP[1,1]=DM3 ZP[2,0]=PO1 ZP[2,1]=DM1 ZP[3,0]=PO4 ZP[3,1]=DM4
_ZA=$P_AXN2 _SA=$P_AXN1
IA=VARI MOD 2 TW2=TAN(ABS(IANG)) _NRCI=NRC _ZKOR=FAL*TW2
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL4
ENDIF
II=_ARTIS[0] DIV 10
IF ((II MOD 10 > 3) OR (II MOD 10 < 1))
GOTOF _FEHL4
ELSE
_ARTIS[11]=II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
II=II DIV 10
IF ((II MOD 10 > 2) OR (II MOD 10 < 0))
GOTOF _FEHL4
ELSE
_ARTIS[12]=II MOD 10
ENDIF
ENDIF
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
PLAN=1
ELSE
PLAN=2
DIAMON
ENDIF
_INCHFAK=$P_GG[13] _INCHFAK=_INCHFAK MOD 2
IF _INCHFAK==1
SAB=SAB/$MN_SCALING_VALUE_INCH
ENDIF
IF IA==1 GOTOF _MA1
IA=-1
_MA1:
IF _AI[7]==0
NUMTH=_NUMTH NSP=_NSP
ELSE
IF _AI[7]==1
_NUMTH=1 NUMTH=_NUMTH NSP=_NSP
ELSE
NUMTH=_NUMTH _NSP=0 NSP=_NSP
ENDIF
ENDIF
_MMB1:
IF (NRC==0)
_NRCI=1
ENDIF
_ZUG=ABS(TDEP-FAL)
IF(_VI[4]==1)AND(_VI[5]<>2)
IF(_MID<=0) GOTOF _FEHL6
IF(_VI[0]<=2)
_NRCI=_ZUG/_MID+0.499999
ELSE
IF (_AI[8]==1)
_NRCI=POT(_ZUG/_MID)+0.499999
ELSE
_NRCI=POT(_ZUG/_MID/2)+1.499999
ENDIF
ENDIF
ENDIF
IF _VI[5]<>1
IF FAL==0
NID=NID+1
ENDIF
ENDIF
_MC1:
IF NOT(_NULLWEG[0]==0)
HH2=PO2-PO1
IF HH2==0
GOTOF _MD1
ENDIF
N700 TW1=(DM2-DM1)/HH2 WI1=0
IF ABS(TW1)<=1
GOTOF _ME1
ENDIF
_MD1:LP=0
N701 HH2=DM2-DM1 TW1=(PO2-PO1)/HH2 _ZA=$P_AXN1 _SA=$P_AXN2
ELSE
HH2=PO3-PO2
IF HH2==0
GOTOF _MDD1
ENDIF
N700 TW1=(DM3-DM2)/HH2 WI1=0
IF ABS(TW1)<=1
GOTOF _ME1
ENDIF
_MDD1:LP=0
N701 HH2=DM3-DM2 _ZA=$P_AXN1 _SA=$P_AXN2
IF HH2==0
TW1=0
ELSE
TW1=(PO3-PO2)/HH2
ENDIF
ENDIF
_ME1:
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _SAF=1
DIAMOF
ELSE
IF _ZA==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=PLAN
ENDIF
IF _SA==AXNAME($MC_DIAMETER_AX_DEF)
_SAF=PLAN
ENDIF
ENDIF
HH3=PO4-PO3
IF HH3==0 GOTOF _MG1
N702 TW3=(DM4-DM3)/HH3
IF LP GOTOF _MJ1
_MG1:IF TW3==0 GOTOF _MJ1
N703 TW3=1/TW3
_MJ1:
IF NOT(HH2==0)
N704 RF=HH2/ABS(HH2)
ELSE
RF=1
ENDIF
IA=IA/$P_ACTFRAME[_ZA,SC] SAB=SAB/$P_ACTFRAME[_ZA,SC]
_ML1: IF _VI[2]>2 GOTOF _MA2
IF IANG>=0 GOTOF _MA2 IF (TW1==0)OR(WI1==90) GOTOF _MA2
IANG=ABS(IANG)
_MA2:IF(_PITA<0)OR(_PITA>4) GOTOF _FEHL7
IF(_PITA==2)
PP1=$MN_SCALING_VALUE_INCH/PP1 PP2=$MN_SCALING_VALUE_INCH/PP2 PP3=$MN_SCALING_VALUE_INCH/PP3
ENDIF
IF(_PITA==3)
PP1=PP1*$MN_SCALING_VALUE_INCH PP2=PP2*$MN_SCALING_VALUE_INCH PP3=PP3*$MN_SCALING_VALUE_INCH
ENDIF
IF(_PITA==4)
PP1=PP1*$PI PP2=PP2*$PI PP3=PP3*$PI
ENDIF
PP1=PP1*_FAK3 PP2=PP2*_FAK3 PP3=PP3*_FAK3
IF LP==0 GOTOF _MG2
SPS=PO1-RF*APP SPZ=DM1+IA*SAB-TW1*RF*APP EPZ=PO4+RF*ROP EPX=DM4+IA*SAB+TW3*RF*ROP RZP=EPX HH3=EPZ
AEP[0,0]=SPS AEP[0,1]=SPZ AEP[1,0]=EPZ AEP[1,1]=EPX
GOTOF _MA3
_MG2:SPS=DM1-RF*APP EPZ=DM4+RF*ROP
IF WI1 GOTOF _MP2
SPZ=PO1+IA*SAB-RF*TW1*APP EPX=PO4+IA*SAB+RF*TW3*ROP
GOTOF _MQ2
_MP2:SPZ=PO1+IA EPX=PO4+IA
_MQ2:RZP=EPX HH3=EPX AEP[0,0]=SPZ AEP[0,1]=SPS AEP[1,0]=EPX AEP[1,1]=EPZ
_MA3:IF ABS(ZP[1,1-LP]-ZP[0,1-LP])>=ABS(ZP[1,LP]-ZP[0,LP]) GOTOF _MMB3
ZP[0,2]=1
_MMB3:IF ABS(AEP[1,1-LP]-ZP[1,1-LP])>=ABS(AEP[1,LP]-IA*SAB-ZP[1,LP]) GOTOF _MC3
ZP[1,2]=1
N705 _MC3:
IF (ABS(ZP[3,LP]-ZP[0,LP])<_EPS) AND (ABS(ZP[2,LP]-ZP[0,LP])<_EPS) AND (ABS(ZP[1,LP]-ZP[0,LP])<_EPS)
ZP[0,3]=0 ZP[1,3]=0
GOTOF _MG3
ENDIF
ZP[0,3]=0 ZP[1,3]=0
IF ABS(ZP[3,1-LP]-ZP[1,1-LP])<_EPS
HH1=0
ELSE
HH1=IA*((ZP[3,LP]-ZP[1,LP])/(ZP[3,1-LP]-ZP[1,1-LP]))
ENDIF
IF ABS(ZP[1,1-LP]-ZP[0,1-LP])<_EPS
HH2=0
ELSE
HH2=IA*((ZP[1,LP]-ZP[0,LP])/(ZP[1,1-LP]-ZP[0,1-LP]))
ENDIF
IF ABS(ZP[0,1-LP]-ZP[2,1-LP])<_EPS
HH3=0
ELSE
HH3=IA*((ZP[0,LP]-ZP[2,LP])/(ZP[0,1-LP]-ZP[2,1-LP]))
ENDIF
IF (ZP[2,1-LP]<ZP[3,1-LP])
HH1=-HH1 HH2=-HH2 HH3=-HH3
ENDIF
IF (HH1>HH2)
ZP[1,3]=1
ENDIF
IF (HH2>HH3)
ZP[0,3]=1
ENDIF
_MG3:IF NRC<>0 GOTOF _MH3
_NRCI=1
N706 _MH3:_ZANF=SPS _HC1=ABS((TDEP-FAL)/SQRT(_NRCI)*TW2) II=_NRCI JJ=-RF
IF IANG>=0 GOTOF _MA4 IF VARI<3 GOTOF _MA4
N711 _MB3:HH1=(SQRT(II)-SQRT(II-1))*_HC1 II=II-1 JJ=-JJ
IF II>1 GOTOB _MB3
_MA4:
IF ($MCS_FUNCTION_MASK_TURN B_AND 'B1000000000000') GOTOF _M5304
_H_MSNUM=$P_MSNUM
IF(_H_MSNUM)
REPEAT
REPEAT
_KA_NR_SP=_KA_NR_SP+1
_S_KA_NR="$MC_AXCONF_MACHAX_USED["<<_KA_NR_SP<<"]"
IF ISVAR(_S_KA_NR)
_MA_NR_SP=$MC_AXCONF_MACHAX_USED[_KA_NR_SP]
ELSE
GOTOF _FEHL5
ENDIF
UNTIL(_MA_NR_SP>0)
_AX="AX"<<_MA_NR_SP
_MAX=(AXNAME(_AX))
UNTIL(_H_MSNUM==$MA_SPIND_ASSIGN_TO_MACHAX[_MAX])
IF(($MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]) B_AND 'B1000')
_CDIR=-1
ELSE
_CDIR=1
ENDIF
IF(($MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]) B_AND 'B100000')
_C_M3=-1
ELSE
_C_M3=1
ENDIF
ELSE
GOTOF _FEHL5
ENDIF
IF ($P_SMODE[$P_MSNUM]==1)
IF($P_SDIR[$P_MSNUM]==5)
GOTOF _FEHL6
ELSE
S_SDIR_LOCAL=$P_SDIR[$P_MSNUM]
ENDIF
ELSE
IF($AC_SDIR[$P_MSNUM]==5)
GOTOF _FEHL6
ELSE
S_SDIR_LOCAL=$AC_SDIR[$P_MSNUM]
ENDIF
ENDIF
_PM=RF
_GDIR=-(S_SDIR_LOCAL*2-7)*_PM*_CDIR*_C_M3
_FRL=-_CDIR*_GDIR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," M3/4: M"<<S_SDIR_LOCAL)
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," _CDIR:"<<_CDIR)
WRITE(_LOG,_LOG_FILE," _FRL: "<<_FRL)
ENDIF
_SP=-1
IF($MCS_AXIS_USAGE[_KA_NR_SP]==3)
_SP=0
ELSE
IF($MCS_AXIS_USAGE[_KA_NR_SP]==5)
_SP=1
ENDIF
ENDIF
IF _SP==-1
_SP=0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindel synchronisieren: _SP="<<_SP)
ENDIF
IF(_SP>=0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_SC_C97["<<_SP<<",0...3]= "<<_SC_C97[_SP,0]<<" , "<<_SC_C97[_SP,1]<<" , "<<_SC_C97[_SP,2]<<" , "<<_SC_C97[_SP,3])
WRITE(_LOG,_LOG_FILE,"$P_TC="<<$P_TC)
WRITE(_LOG,_LOG_FILE,"_FAK1="<<_FAK1<<" _FAK2="<<_FAK2<<" _FAK3="<<_FAK3)
WRITE(_LOG,_LOG_FILE,"$AC_ACT_ORI_TOOL_LENGTH="<<$AC_ACT_ORI_TOOL_LENGTH[1]<<" "<<$AC_ACT_ORI_TOOL_LENGTH[2]<<" "<<$AC_ACT_ORI_TOOL_LENGTH[3])
ENDIF
IF(_SC_C97[_SP,0]==1)
IF ( ($P_ACTFRAME[_XX,RT]<>0) OR ($P_ACTFRAME[_ZZ,RT]<>0) OR (NOT($P_TRAFO==0)) )
GOTOF _FEHL9
ENDIF
_ZZ=_SA
_XX=_ZA
_LP=LP
_SPD=DM1
_SPL=_PO1
_PIT=PP1
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_PLAN=1
ELSE
_PLAN=2
ENDIF
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=2
$AC_MEAS_P2_COORD=0
$AA_MEAS_POINT1[_ZZ]=_SC_C97[_SP,2]*_FAK3+$AC_ACT_ORI_TOOL_LENGTH[3]*_FAK1
$AA_MEAS_POINT1[_XX]=_SC_C97[_SP,3]*_FAK3+$AC_ACT_ORI_TOOL_LENGTH[1]*_FAK1
_ERR=MEASURE()
IF(_ERR) GOTOF _FEHL14
_C97_2=$AA_MEAS_POINT2[_ZZ]
_C97_3=$AA_MEAS_POINT2[_XX]/_PLAN
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Z: "<<_SC_C97[_SP,2]<<"(MKS) = "<<_C97_2<<"(WKS)")
WRITE(_LOG,_LOG_FILE,"X: "<<_SC_C97[_SP,3]<<"(MKS) = "<<_C97_3<<"(WKS)")
WRITE(_LOG,_LOG_FILE,"Z MEAS_POINTS: "<<$AA_MEAS_POINT1[_ZZ]<<"(MKS) = "<<$AA_MEAS_POINT2[_ZZ]<<"(WKS)")
ENDIF
IF(_LP)
_D=_SPL-_C97_2
ELSE
_D=_C97_3-_SPD/2
ENDIF
_F=_PIT
_UMQ=_D/_F
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"UMQ= "<<_UMQ*360)
WRITE(_LOG,_LOG_FILE,"D  = "<<_D)
WRITE(_LOG,_LOG_FILE,"F  = "<<_F)
ENDIF
IF(_LP)
_UMQ=-(_UMQ-TRUNC(_UMQ))*_FRL
ELSE
_UMQ=(_UMQ-TRUNC(_UMQ))*_FRL
ENDIF
_NSP=_NSP+_SC_C97[_SP,1]+_UMQ*360
_NSP=((_NSP MOD 360)+360) MOD 360
_ANGPLUS=_NSP
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"NSP= "<<_NSP)
WRITE(_LOG,_LOG_FILE,"UMQ= "<<_UMQ*360)
WRITE(_LOG,_LOG_FILE,"SYNC="<<_SC_C97[_SP,1])
ENDIF
ENDIF
ENDIF
_UM=APP/PP1 _SPV=_SPV+_FRL*_PM*_UM*360
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," Anteil aus Einlaufweg APP="<<_SPV<<" + Winkel="<<_FRL*_PM*_UM*360)
ENDIF
SPV=SPV+_SPV
SPV=((SPV MOD 360)+360) MOD 360
_M5304:
IF(LP==1)
IF(IA==1)
_ALF=3
ELSE
_ALF=7
ENDIF
ELSE
IF(IA==1)
_ALF=1
ELSE
_ALF=5
ENDIF
ENDIF
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_DIA=1
ELSE
_DIA=2
ENDIF
IF(_ISO==1)
_KEGV=_ZFPR[29]*_DIA*(-1)
ENDIF
II=0 _ZUA=0
_MMB4: _IPAX=_SA
IF (((NRC MOD 2)==0) AND (_VI[2]<=2)) GOTOF _MC4
IF ((_VI[2]<=2) AND (IANG>=0)) GOTOF _MC4
IF ((_VI[2]>2) AND (IANG>=0)) GOTOF _MC4
ZF=-1
N709 _MC4:SPV=NSP+360/NUMTH*II JJ=1 HH2=0
_SPVALL=SPV+_SPV+_ANGPLUS
IF ((_NUMTH==1) AND (_NSP<>0) AND (_SC_C97[0,0]==1))
_SPVALL=_SPVALL-SPV
ENDIF
_SPVALL=((_SPVALL MOD 360)+360) MOD 360
IF (_SPVALL)>=360
_SPVALL=_SPVALL-360
ENDIF
IF (_SPVALL)<0
_SPVALL=_SPVALL+360
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"      SPV="<<SPV)
WRITE(_LOG,_LOG_FILE,"     _SPV="<<_SPV)
WRITE(_LOG,_LOG_FILE," _ANGPLUS="<<_ANGPLUS)
WRITE(_LOG,_LOG_FILE,"  _SPVALL="<<_SPVALL)
ENDIF
SBLOF
IF(_AKTLFON==1)
$AC_LIFTFAST=0
ENDIF
SBLON
N712 _MD4: _LIFTNR=0
_IPAX=_SA
IF(_AKTLFON==1)
SBLOF
IF NOT $AC_LIFTFAST
_MDG=1
ENDIF
SBLON
ENDIF
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
HH1=_ZUG/_NRCI
IF (_VI[0]<=2)
HH1=_ZUG/_NRCI DEL=HH1*JJ
ELSE
IF _NRCI==1
DEL=_ZUG
ELSE
IF (_AI[8]==1)
_NRCX=TRUNC(_NRCI*_ZUA*_ZUA/(_ZUG*_ZUG))+1
DEL=_ZUG*SQRT(_NRCX/_NRCI)
ELSE
_NRCX=TRUNC((_NRCI-1)*_ZUA*_ZUA/(_ZUG*_ZUG)+1)+1
IF(_NRCX<=2)
_NRCX=TRUNC(_ZUA/_ZUG*2*SQRT(_NRCI-1))+1
DEL=_ZUG/2*_NRCX/SQRT(_NRCI-1)
ELSE
DEL=_ZUG*SQRT((_NRCX-1)/(_NRCI-1))
ENDIF
ENDIF
ENDIF
_ZUA=DEL
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Zustellung _ZUA="<<_ZUA)
ENDIF
IF NRC==0 GOTOF _MJ4
IF _VI[5]==2 GOTOF _MJ4
HH4=-IA*DEL
IF IANG==0 GOTOF _MF4
HH2=-RF*ZF*((TDEP-DEL)*TW2-_ZKOR)
_MF4:
IF(_ISO==0)
N40 G0 G90 G60 AX[_SA]=(_ZANF+HH2)*_SAF AX[_ZA]=SPZ*_ZAF
ELSE
N401 G0 G90 G60 AX[_SA]=(_ZANF+HH2)*_SAF AX[_ZA]=SPZ*_ZAF+_KEGV
ENDIF
IF(_AKTLFON==1)
IF($P_LIFTFAST==0)
GOTOF _XWEIT
ELSE
SBLOF
_MDG=1
SBLON
M0
STOPRE
SBLOF
_MDG=1
SBLON
ENDIF
ENDIF
_XWEIT:
IF(_AKTLFON==1)
SBLOF
$AC_LIFTFAST=0
SBLON
ENDIF
IF ((_VI[2]<=2) AND (IANG>0)) GOTOF _MG4
IF (_VI[2]==3) GOTOF _MG4
ZF=-ZF
_MG4:
HH4_NEU=HH4+TW1*HH2
IF _VI[2]<=2
HH4_NEU=HH4
ENDIF
IF(_ISO==0)
N42 G91 AX[_ZA]=(HH4_NEU-IA*SAB)*_ZAF
ELSE
N421 G91 AX[_ZA]=(HH4_NEU-IA*SAB)*_ZAF-_KEGV
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF _NULLWEG[0]
_LIFTNR=1
IF(_AKTLFON==0)
N43 G33 G90 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+HH4)*_ZAF IP[_SA]=PP1 SF=_SPVALL
ELSE
N43 G33 G90 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+HH4)*_ZAF IP[_SA]=PP1 SF=_SPVALL LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
N430 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5311
ENDIF
ENDIF
ENDIF
IF NOT(ZP[0,2]==0)
_IPAX=_ZA
ENDIF
IF _NULLWEG[1]
_LIFTNR=2
IF _NULLWEG[0]==1
IF(_AKTLFON==0)
N44 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH4)*_ZAF IP[_IPAX]=PP2
ELSE
N44 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH4)*_ZAF IP[_IPAX]=PP2 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
N440 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5311
ENDIF
ENDIF
ELSE
IF(_AKTLFON==0)
N44 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH4)*_ZAF IP[_IPAX]=PP2 SF=_SPVALL
ELSE
N44 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH4)*_ZAF IP[_IPAX]=PP2 SF=_SPVALL LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
N440 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5311
ENDIF
ENDIF
ENDIF
ENDIF
_IPAX=_SA
IF NOT(ZP[1,2]==0)
_IPAX=_ZA
ENDIF
IF _NULLWEG[2]
_LIFTNR=3
IF(_AKTLFON==0)
IF(_ISO==1)
IF(IA>0)
IF(((RZP-IA*SAB+HH4)*_ZAF)>=((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N451 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((RZP-IA*SAB+HH4)*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ELSE
N452 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((RZP-IA*SAB+HH4)*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ENDIF
ELSE
N453 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=(RZP-IA*SAB+HH4)*_ZAF IP[_IPAX]=PP3
ENDIF
ELSE
IF(((RZP-IA*SAB+HH4)*_ZAF)<((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N454 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((SPZ*_ZAF+_KEGV)-((RZP-IA*SAB+HH4)*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ELSE
N455 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((SPZ*_ZAF+_KEGV)-((RZP-IA*SAB+HH4)*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ENDIF
ELSE
N456 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=(RZP-IA*SAB+HH4)*_ZAF IP[_IPAX]=PP3
ENDIF
ENDIF
ELSE
N45 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=(RZP-IA*SAB+HH4)*_ZAF IP[_IPAX]=PP3
ENDIF
N450 G0
ELSE
IF(_ISO==1)
IF(IA>0)
IF(((RZP-IA*SAB+HH4)*_ZAF)>=((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N451 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((RZP-IA*SAB+HH4)*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ELSE
N452 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((RZP-IA*SAB+HH4)*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ENDIF
ELSE
N453 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=(RZP-IA*SAB+HH4)*_ZAF IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ENDIF
ELSE
IF(((RZP-IA*SAB+HH4)*_ZAF)<((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N454 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((SPZ*_ZAF+_KEGV)-((RZP-IA*SAB+HH4)*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ELSE
N455 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((SPZ*_ZAF+_KEGV)-((RZP-IA*SAB+HH4)*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ENDIF
ELSE
N456 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=(RZP-IA*SAB+HH4)*_ZAF IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ENDIF
ENDIF
ELSE
N45 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=(RZP-IA*SAB+HH4)*_ZAF IP[_IPAX]=PP3 LFON DILF=ABS(HH4-IA*SAB) LFWP ALF=_ALF
ENDIF
N450 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5311
ENDIF
ENDIF
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
_M5311: G0 G[10]=_GG10
IF (_AKTLFON==0)
IF(_ISO==0)
N46 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
IF ZP[1,3]==1
N47 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N48 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
ELSE
N461 G0 G[10]=_GG10 G90 AX[_ZA]=(SPZ*_ZAF)+_KEGV ;ISO
ENDIF
JJ=JJ+1
ELSE
IF ($P_LIFTFAST==0)
IF(_ISO==0)
N46 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
ELSE
N461 G0 G[10]=_GG10 G90 AX[_ZA]=(SPZ*_ZAF)+_KEGV ;ISO
ENDIF
GOTOF _M531A
ELSE
IF(_ISO==0)
IF _LIFTNR==1
GOTOB _MD4
ENDIF
IF _LIFTNR==2
IF ZP[0,3]==1
N460 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _MD4
ELSE
IF ZP[1,3]==1
N461 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N462 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _MD4
ENDIF
ELSE
N461 G0 G[10]=_GG10 G90 AX[_ZA]=(SPZ*_ZAF)+_KEGV ;ISO
GOTOB _MD4
ENDIF
ENDIF
ENDIF
_M531A:
IF (_AKTLFON==1)
STOPRE
IF ($AC_LIFTFAST==0)
IF(_ISO==0)
N46 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
IF ZP[1,3]==1
N47 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N48 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
ELSE
N461 G0 G[10]=_GG10 G90 AX[_ZA]=(SPZ*_ZAF)+_KEGV ;ISO
ENDIF
JJ=JJ+1
ELSE
IF(_ISO==0)
IF _LIFTNR==1
GOTOB _MD4
ENDIF
IF _LIFTNR==2
IF ZP[0,3]==1
N460 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _MD4
ELSE
IF ZP[1,3]==1
N461 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N462 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _MD4
ENDIF
ELSE
N461 G0 G[10]=_GG10 G90 AX[_ZA]=(SPZ*_ZAF)+_KEGV ;ISO
GOTOB _MD4
ENDIF
ENDIF
ENDIF
IF JJ<=_NRCI GOTOB _MD4 IF (NID==0)AND(FAL==0) GOTOF _MX4
IF _VI[5]==1 GOTOF _MX4
_MJ4:JJ=0 HH2=-IA*TDEP HH4=EPX-IA*(SAB+TDEP) _IPAX=_SA
_M5310:
IF LP>0 GOTOF _MM4
HH4=RZP-IA*(SAB+TDEP)
_MM4:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF(_ISO==0)
N50 G0 G90 G60 AX[_SA]=SPS*_SAF AX[_ZA]=SPZ*_ZAF
ELSE
N501 G0 G90 G60 AX[_SA]=SPS*_SAF AX[_ZA]=SPZ*_ZAF+_KEGV
ENDIF
IF(_AKTLFON==1)
IF($P_LIFTFAST==0)
GOTOF _XWEITS
ELSE
SBLOF
_MDG=1
SBLON
M0
STOPRE
SBLOF
_MDG=1
SBLON
ENDIF
ENDIF
_XWEITS:
IF(_AKTLFON==1)
SBLOF
$AC_LIFTFAST=0
SBLON
ENDIF
IF(_ISO==0)
N51 G91 AX[_ZA]=(-IA*(SAB+TDEP))*_ZAF
ELSE
N511 G91 AX[_ZA]=(-IA*(SAB+TDEP))*_ZAF-_KEGV
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF _NULLWEG[0]
_LIFTNR=1
IF(_AKTLFON==0)
N52 G33 G90 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+HH2)*_ZAF IP[_SA]=PP1 SF=_SPVALL
ELSE
N52 G33 G90 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+HH2)*_ZAF IP[_SA]=PP1 SF=_SPVALL LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
N520 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5312
ENDIF
ENDIF
ENDIF
_IPAX=_SA
IF NOT(ZP[0,2]==0)
_IPAX=_ZA
ENDIF
IF _NULLWEG[1]
_LIFTNR=2
IF _NULLWEG[0]
IF(_AKTLFON==0)
N53 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH2)*_ZAF IP[_IPAX]=PP2
ELSE
N53 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH2)*_ZAF IP[_IPAX]=PP2 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
N530 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5312
ENDIF
ENDIF
ELSE
IF(_AKTLFON==0)
N53 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH2)*_ZAF IP[_IPAX]=PP2 SF=_SPVALL
ELSE
N53 G33 G90 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+HH2)*_ZAF IP[_IPAX]=PP2 SF=_SPVALL LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
N530 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5312
ENDIF
ENDIF
ENDIF
ENDIF
_IPAX=_SA
IF NOT(ZP[1,2]==0)
_IPAX=_ZA
ENDIF
IF _NULLWEG[2]
_LIFTNR=3
IF(_AKTLFON==0)
IF(_ISO==1)
IF(IA>0)
IF(((HH4)*_ZAF)>=((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N541 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((HH4)*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ELSE
N542 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((HH4)*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ENDIF
ELSE
N543 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=HH4*_ZAF IP[_IPAX]=PP3
ENDIF
ELSE
IF(((HH4)*_ZAF)<((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N544 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((SPZ*_ZAF+_KEGV)-((HH4)*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ELSE
N545 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((SPZ*_ZAF+_KEGV)-((HH4)*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3
ENDIF
ELSE
N546 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=HH4*_ZAF IP[_IPAX]=PP3
ENDIF
ENDIF
ELSE
N54 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=HH4*_ZAF IP[_IPAX]=PP3
ENDIF
N540 G0
ELSE
IF(_ISO==1)
IF(IA>0)
IF((HH4*_ZAF)>=((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N541 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-(((HH4*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ELSE
N542 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+(((HH4*_ZAF)-(SPZ*_ZAF+_KEGV))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ENDIF
ELSE
N543 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=HH4*_ZAF IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ENDIF
ELSE
IF((HH4*_ZAF)<((SPZ*_ZAF)+_KEGV))
IF((AEP[1,1-LP]*_SAF)>(SPS*_SAF))
N544 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)-((((SPZ*_ZAF+_KEGV)-(HH4*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ELSE
N545 G33 G90 AX[_SA]=(AEP[1,1-LP]*_SAF)+((((SPZ*_ZAF+_KEGV)-(HH4*_ZAF)))/_DIA) AX[_ZA]=SPZ*_ZAF+_KEGV IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ENDIF
ELSE
N546 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=HH4*_ZAF IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ENDIF
ENDIF
ELSE
N54 G33 G90 AX[_SA]=AEP[1,1-LP]*_SAF AX[_ZA]=HH4*_ZAF IP[_IPAX]=PP3 LFON DILF=ABS(SAB+TDEP) LFWP ALF=_ALF
ENDIF
N540 LFOF ALF=0 G33
IF $P_LIFTFAST
_MDG=1
STOPRE
GOTOF _M5312
ENDIF
ENDIF
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
_M5312: G0 G[10]=_GG10
IF (_AKTLFON==0)
IF(_ISO==0)
N55 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
IF ZP[1,3]==1
N56 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N57 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
ELSE
N551 G0 AX[_ZA]=(SPZ*_ZAF)+_KEGV
ENDIF
JJ=JJ+1
ELSE
IF ($P_LIFTFAST==0)
IF(_ISO==0)
N55 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
ELSE
N551 G0 AX[_ZA]=(SPZ*_ZAF)+_KEGV
ENDIF
GOTOF _M531B
ELSE
IF(_ISO==0)
IF _LIFTNR==1
GOTOB _M5310
ENDIF
IF _LIFTNR==2
IF ZP[0,3]==1
N550 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _M5310
ELSE
IF ZP[1,3]==1
N551 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N552 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _M5310
ENDIF
ELSE
N551 G0 AX[_ZA]=(SPZ*_ZAF)+_KEGV
GOTOB _M5310
ENDIF
ENDIF
ENDIF
_M531B:
IF (_AKTLFON==1)
STOPRE
IF ($AC_LIFTFAST==0)
IF(_ISO==0)
N55 G[10]=_GG10 G90 AX[_ZA]=RZP*_ZAF
IF ZP[1,3]==1
N56 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N57 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
ELSE
N551 G0 AX[_ZA]=(SPZ*_ZAF)+_KEGV
ENDIF
JJ=JJ+1
ELSE
IF(_ISO==0)
IF _LIFTNR==1
GOTOB _M5310
ENDIF
IF _LIFTNR==2
IF ZP[0,3]==1
N550 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _M5310
ELSE
IF ZP[1,3]==1
N551 AX[_SA]=ZP[1,1-LP]*_SAF AX[_ZA]=(ZP[1,LP]+IA*SAB)*_ZAF
ENDIF
IF ZP[0,3]==1
N552 AX[_SA]=ZP[0,1-LP]*_SAF AX[_ZA]=(ZP[0,LP]+IA*SAB)*_ZAF
ENDIF
GOTOB _M5310
ENDIF
ELSE
N551 G0 AX[_ZA]=(SPZ*_ZAF)+_KEGV
GOTOB _M5310
ENDIF
ENDIF
ENDIF
IF ((JJ<=NID) AND (FAL<>0)) GOTOB _MM4 IF ((JJ<NID) AND (FAL==0)) GOTOB _MM4
_MX4:II=II+1
_ZUA=0
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
IF (II<NUMTH)AND(NRC==0) GOTOB _MC4 IF II<NUMTH GOTOB _MMB4
IF(_ISO==0)
N60 G0 G90 G60 AX[_SA]=SPS*_SAF AX[_ZA]=SPZ*_ZAF
ELSE
N601 G0 G90 G60 AX[_SA]=SPS*_SAF AX[_ZA]=SPZ*_ZAF+_KEGV
SBLOF
ENDIF
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
RET
_FEHL1:STOPRE
N709801 SETAL(61002)
RET
_FEHL2:STOPRE
N709802 SETAL(61019,"<_AMODE: dec"<<II<<"> ")
RET
_FEHL3:STOPRE
N709803 SETAL(61612)
RET
_FEHL4:
N709804 SETAL(62106)
RET
_FEHL5:STOPRE
N709805 SETAL(61019,_PAR_NAME)
RET
_FEHL6: STOPRE
N709806 SETAL(61102)
RET
_FEHL7: STOPRE
N709807 SETAL(61019," < _PITA > ")
RET
_FEHL8: STOPRE
N709808 SETAL(61126)
RET
_FEHL9: STOPRE
N709809 SETAL(61612)
RET
_FEHL14: STOPRE
N709814 SETAL(61099,"MEASURE")
RET
_FEHL15: STOPRE
N709815 SETAL(61019,_SERR)
RET
_FEHL19: STOPRE
N709819 SETAL(61212)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE99_SPF
PROC CYCLE99(REAL _SPL,REAL _SPD,REAL __FPL,REAL __FPD,REAL __APP,REAL _ROP,REAL _TDEP,REAL _FAL,REAL _IANG,REAL _NSP,INT _NRC,INT _NID,REAL _PIT,INT _VARI,INT _NUMTH,REAL _SDIS,REAL _MID,REAL _GDEP,REAL _PIT1,REAL _FDEP,INT _GST,INT _GUD,REAL _IFLANK,INT _PITA,STRING[15] _PITM,STRING[20] _PTAB,STRING[20] _PTABA,INT _DMODE,INT _AMODE,REAL S_XRS) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.005 ;DATE: 2024-04-03
;Cycle support HMIsl
;Thread cutting cycle
DEF AXIS _XX,_ZZ,_IP0,_IP1,_IP2,_IP3,_IP4,_MAX
DEF INT _AI,_BA[7],_LP,_PM,_NIDX,_NRCX,_II,_ZU,_SL,_RG,_NUX,_NUI,_ZUFX,_ZUFG,_SR,_ALF,_FFLZ,_FRL,_H_NUMTH,_GG06,_SP,_ERR,_BG=0
DEF INT _SHOPTURN,_PLAN=1,_ZAF=1,_XAF=1,_TEMP,_H_AMODE[8],_H_MSNUM,_MA_NR_SP=0,_KA_NR_SP=-1,_H_DMODE[5],_CDIR,_GDIR,_C_M3,_ARTIS[16],_ALARM
DEF REAL _P[8,2],_PG[7,2],_RS_BG,_R_BG,_XS_BG,_DRF=0,_DRF1=0,_HH,_GWT,_ZUAG,_ZUI,_ZUA,_ZUN,_ZU1,_ZUG,_ZUZ,_PP0,_PP1,_PP2,_PP3,_PPP1,_PPP2,_PPP3,_CAL[13]
DEF REAL _TA,_TA1,_TA2,_SPV,_SPVX,_SPVZ,_FK,_UM,_D,_F,_G,_UMQ,_KSDIFF[2],_C97_2,_C97_3,_WEG,_FPL,_FPD,_ALPHA,_APP,S_PP,S_QQ,_DIS,_D1,_D2,_OEFFWI
DEF INT S_SDIR_LOCAL
DEF REAL _FAK1,_FAK2,_FAK3,_FAK4,S_DITRB=0
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE99_MPF"
DEF STRING[40] _LOG_FILE,_PROG,_SERR,_AX,_S_KA_NR
DEF INT _LOG,_LOG_ON=0,_TYP
CYCLE218(11)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE99_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
WRITE(_TEMP,_TEMP_FILE,";Spindel im Kanal=1 oder in anderem Kanal=0: Wert="<<$P_SMODE[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE99("<<_SPL<<","<<_SPD<<","<<__FPL<<","<<__FPD<<","<<__APP<<","<<_ROP<<","<<_TDEP<<","<<_FAL<<","<<_IANG<<","<<_NSP<<","<<_NRC<<","<<_NID<<","<<_PIT<<","<<_VARI<<","<<_NUMTH<<","<<_SDIS<<","<<_MID<<","<<_GDEP<<","<<_PIT1<<","<<_FDEP<<","<<_GST<<","<<_GUD<<","<<_IFLANK<<","<<_PITA<<","<<_PITM<<","<<_PTAB<<","<<_PTABA<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (_SC_Y_TURN<>0)
SETAL(61058,"'"'Y-TURN'"'")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_TYP=$P_ADT[1]
IF ( (_TYP<500)OR(_TYP>599) ) GOTOF _FEHL19
IF ((_TYP _DEC1)==5) GOTOF _FEHL19
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_FAK4=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK4=$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK4=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_H_DMODE[0]=_DMODE _DEC1 _H_DMODE[1]=_DMODE _DEC2 _H_DMODE[4]=_DMODE _DEC5
_H_AMODE[0]=(_AMODE _DEC1) _H_AMODE[1]=(_AMODE _DEC2) _H_AMODE[2]=(_AMODE _DEC3) _H_AMODE[3]=(_AMODE _DEC4) _H_AMODE[4]=(_AMODE _DEC5) _H_AMODE[5]=(_AMODE _DEC6) _H_AMODE[6]=(_AMODE _DEC7)
_H_AMODE[7]=(_AMODE _DEC8)
IF (_H_DMODE[4]<0)OR(_H_DMODE[4]>1)
_SERR=<<"(_DMODE: dec5)"
GOTOF _FEHL11
ENDIF
IF (_H_DMODE[4]==1)
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
_PIT1=0
_NSP=0
_H_AMODE[4]=0
_PITM="" _PTAB="" _PTABA=""
ENDIF
IF ( (_H_DMODE[0]<0)OR(_H_DMODE[0]>3) ) GOTOF _FEHL10
IF ( (_H_DMODE[1]<0)OR(_H_DMODE[1]>2) )
_SERR=<<"(_DMODE: dec2)"
GOTOF _FEHL7
ENDIF
IF ( (_H_DMODE[0]>0)AND(($P_GG[6])<>(_H_DMODE[0])) )
_GG06=(_H_DMODE[0])
G[6]=_GG06
ENDIF
_XX=$P_AXN2 _ZZ=$P_AXN1
_NID=ABS(_NID) _GUD=ABS(_GUD)
$AC_LIFTFAST=0
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,8)
IF(_PROG=="F_TR_CON")
_SHOPTURN=1
ELSE
_SHOPTURN=0
ENDIF
IF NOT ($SCS_FUNCTION_MASK_TURN_SET B_AND 'B100000')
S_DITRB=-1
IF ($P_GG[10]<>7)
G642
ENDIF
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE99_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE99: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL13
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL13
ELSE
_ARTIS[11]=_II MOD 10
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL13
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_END_ARTIS_STAT:
IF _PTAB<>""
_PIT1=0
ENDIF
_BA[0]=(_VARI _DEC1) _BA[1]=(_VARI _DEC2) _BA[2]=(_VARI _DEC3) _BA[3]=(_VARI _DEC4) _BA[4]=(_VARI _DEC5) _BA[5]=(_VARI _DEC6) _BA[6]=(_VARI _DEC7)
IF(_BA[0]<1)OR(_BA[0]>4)OR(_BA[2]<1)OR(_BA[2]>2)OR(_BA[4]<0)OR(_BA[4]>1)OR(_BA[5]<1)OR(_BA[5]>3)OR(_BA[6]<0)OR(_BA[6]>1) GOTOF _FEHL1
IF(_PIT<=0) GOTOF _FEHL2
IF($P_ACTFRAME[_XX,SC]<>1)OR($P_ACTFRAME[_ZZ,SC]<>1)GOTOF _FEHL3
IF(_ROP<0)OR(_SDIS<0)OR(_TDEP<0)GOTOF _FEHL4
IF(_BA[4]==0)
IF(_BA[5]<>2)AND(_NRC<=0) GOTOF _FEHL6
ELSE
IF(_BA[5]<>2)AND(_MID<=0) GOTOF _FEHL6
ENDIF
IF ( (_H_AMODE[0]<0)OR(_H_AMODE[0]>1) )
_SERR=<<"(_AMODE: dec1)"
GOTOF _FEHL11
ENDIF
IF ( (_H_AMODE[1]<0)OR(_H_AMODE[1]>2) )
_SERR=<<"(_AMODE: dec2)"
GOTOF _FEHL11
ENDIF
IF ( (_H_AMODE[2]<0)OR(_H_AMODE[2]>2) )
_SERR=<<"(_AMODE: dec3)"
GOTOF _FEHL11
ENDIF
IF ( (_H_AMODE[3]<0)OR(_H_AMODE[3]>1) )
_SERR=<<"(_AMODE: dec4)"
GOTOF _FEHL11
ENDIF
IF ( (_H_AMODE[4]<0)OR(_H_AMODE[4]>1) )
_SERR=<<"(_AMODE: dec5)"
GOTOF _FEHL11
ENDIF
IF ( (_H_AMODE[5]<0)OR(_H_AMODE[5]>2) )
_SERR=<<"(_AMODE: dec6)"
GOTOF _FEHL11
ENDIF
IF (_NUMTH<0)
_SERR=<<"(N)"
GOTOF _FEHL11
ENDIF
IF _H_AMODE[4]==0
_H_NUMTH=1
ELSE
_H_NUMTH=_NUMTH
ENDIF
IF (_BA[5]==1)
_NID=0
ENDIF
IF ( (_H_DMODE[1]==2)AND(_H_AMODE[1]==2))
_ALPHA=__FPD
IF ((_ALPHA<=-90)OR(_ALPHA>=90))
_SERR=<<"("<<AXSTRING($P_AXN2)<<"1ALPHA)"
GOTOF _FEHL11
ENDIF
ENDIF
IF (__APP<0)
_SERR=<<"(LW)"
GOTOF _FEHL11
ENDIF
IF (_GST<0)
_SERR=<<"(GST)"
GOTOF _FEHL11
ENDIF
IF ( (_PITA<0)OR(_PITA>4) )
_SERR=<<"(P)"
GOTOF _FEHL11
ENDIF
IF ( (_H_DMODE[1]==0)AND((_BA[0]==1)OR(_BA[0]==3))AND(S_XRS<>0) )
IF (_PIT1<>0)
_BG=0
ELSE
_BG=1
ENDIF
ENDIF
IF ( (_H_DMODE[1]==0)OR(_H_DMODE[1]==2) )
IF (_H_AMODE[0]==0)
_FPL=__FPL
ELSE
_FPL=_SPL+__FPL
ENDIF
ELSE
__FPL=_SPL _FPL=__FPL
ENDIF
IF ( (_H_DMODE[1]==1)OR(_H_DMODE[1]==2) )
IF ( _H_AMODE[1]==0 )
_FPD=__FPD
ELSE
IF ( _H_AMODE[1]==1 )
_FPD=_SPD+(2*__FPD)
ELSE
_FPD=_SPD+(2*((ABS(_FPL-_SPL))*TAN(_ALPHA)))
ENDIF
ENDIF
ELSE
__FPD=_SPD _FPD=__FPD
ENDIF
IF ( _H_AMODE[2]<>0 )
IF ( _H_AMODE[2]==1 )
_APP=-_ROP
ELSE
_APP=-__APP
ENDIF
ELSE
_APP=__APP
ENDIF
IF ( _H_AMODE[5]==0 )
_GST=1
ELSE
IF ( _H_AMODE[5]==2 )
_GST=-_GST
ENDIF
ENDIF
IF ($MCS_FUNCTION_MASK_TURN B_AND 'B1000000000000') GOTOF _M53041
_H_MSNUM=$P_MSNUM
IF(_H_MSNUM)
REPEAT
REPEAT
_KA_NR_SP=_KA_NR_SP+1
_S_KA_NR="$MC_AXCONF_MACHAX_USED["<<_KA_NR_SP<<"]"
IF ISVAR(_S_KA_NR)
_MA_NR_SP=$MC_AXCONF_MACHAX_USED[_KA_NR_SP]
ELSE
GOTOF _FEHL5
ENDIF
UNTIL(_MA_NR_SP>0)
_AX="AX"<<_MA_NR_SP
_MAX=(AXNAME(_AX))
UNTIL(_H_MSNUM==$MA_SPIND_ASSIGN_TO_MACHAX[_MAX])
IF(($MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]) B_AND 'B1000')
_CDIR=-1
ELSE
_CDIR=1
ENDIF
IF(($MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]) B_AND 'B100000')
_C_M3=-1
ELSE
_C_M3=1
ENDIF
ELSE
GOTOF _FEHL12
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," $MCS_AXIS_USAGE["<<_KA_NR_SP<<"]="<<$MCS_AXIS_USAGE[_KA_NR_SP]*1)
WRITE(_LOG,_LOG_FILE," $MCS_AXIS_USAGE_ATTRIB["<<_KA_NR_SP<<"]="<<$MCS_AXIS_USAGE_ATTRIB[_KA_NR_SP]*1)
WRITE(_LOG,_LOG_FILE," ")
WRITE(_LOG,_LOG_FILE," S_DITRB="<<S_DITRB)
ENDIF
_M53041:
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_PLAN=1
ELSE
_PLAN=2
DIAMON
ENDIF
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _XAF=1
DIAMOF
ELSE
IF _ZZ==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=_PLAN
ENDIF
IF _XX==AXNAME($MC_DIAMETER_AX_DEF)
_XAF=_PLAN
ENDIF
ENDIF
IF(_PITA==2)
_PIT=$MN_SCALING_VALUE_INCH/_PIT
ENDIF
IF(_PITA==3)
_PIT=_PIT*$MN_SCALING_VALUE_INCH
ENDIF
IF(_PITA==4)
_PIT=_PIT*$PI
ENDIF
_PIT=_PIT*_FAK3
_ZU=(_BA[0]-1)DIV 2
IF(_BA[5]==2)
_FAL=0
ENDIF
_ZUG=_TDEP-_FAL
_SL=0
IF(_BA[5]<>2)
IF(_TDEP-_FAL-_FDEP<=0) GOTOF _FEHL6
ENDIF
IF(_BA[4]==1)AND(_BA[5]<>2)
IF(_MID<=0) GOTOF _FEHL6
IF(_ZU==0)
_NRC=_ZUG/_MID+0.499999
ELSE
IF(_ZU==1)
IF (_H_AMODE[7]==1)
_NRC=POT(_ZUG/_MID)+0.499999
ELSE
_NRC=POT(_ZUG/_MID/2)+1.499999
ENDIF
ENDIF
ENDIF
ENDIF
_SR=0
IF(_BA[5]<3)
_SR=1
IF(_BA[5]==2)
_NRC=1 _FAL=0 _FDEP=0 _GDEP=0
ENDIF
ENDIF
IF(_FAL<0)OR(_GDEP<0)OR(_FDEP<0) GOTOF _FEHL4
IF(_FAL+_FDEP>_TDEP) GOTOF _FEHL4
IF(_FAL>_TDEP) GOTOF _FEHL5
IF((ABS(_GDEP)>ABS(_TDEP)) AND (_H_AMODE[4]==1))
_SERR="DA>H1"
GOTOF _FEHL11
ENDIF
IF(_BA[5]<>2)
IF(_TDEP-_FAL-_FDEP<=0) GOTOF _FEHL6
ENDIF
IF(_SDIS<=0)
_SDIS=1*_FAK3
ENDIF
IF (_BA[6]==1)
_H_NUMTH=_H_NUMTH*(-1)
ENDIF
_RG=0 _H_NUMTH=_H_NUMTH MOD 360
IF(_H_NUMTH>=0)GOTOF _M101
_RG=1
_H_NUMTH=ABS(_H_NUMTH)
_M101:
IF(_H_NUMTH>0)GOTOF _M105
_H_NUMTH=1
_M105:
IF(ABS(_GST)>0)AND(ABS(_GST)<=ABS(_H_NUMTH)) GOTOF _M106
_GST=1
_M106:
_NUI=ABS(_GST)-1
IF(_RG==0) GOTOF _M108
_NUI=-1
_M107:
_NUI=_NUI+1
_II=_NUI*(_H_NUMTH-1)/2+1/4
_II=_II MOD _H_NUMTH
IF(_II<>ABS(_GST)-1) GOTOB _M107
_M108:
_P[3,0]=_SPD/2
_P[3,1]=_SPL
_P[5,0]=_FPD/2
_P[5,1]=_FPL
_AI=_BA[0] MOD 2
IF(_AI==1) GOTOF _M11
_AI=-1
_M11:
_LP=1
IF(ABS(_P[5,1]-_P[3,1])>=ABS(_P[5,0]-_P[3,0])) GOTOF _M12
_LP=0
_M12:
IF((ABS(_P[5,_LP]-_P[3,_LP])-_ROP)<=0) GOTOF _FEHL4
_HH=_P[5,_LP]-_P[3,_LP]
_PM=_HH/ABS(_HH)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," AI / LP / PM = "<<_AI<<" / "<<_LP<<" / "<<_PM)
ENDIF
IF ($P_SMODE[$P_MSNUM]==1)
IF($P_SDIR[$P_MSNUM]==5)
GOTOF _FEHL7
ELSE
S_SDIR_LOCAL=$P_SDIR[$P_MSNUM]
ENDIF
ELSE
IF($AC_SDIR[$P_MSNUM]==5)
GOTOF _FEHL7
ELSE
S_SDIR_LOCAL=$AC_SDIR[$P_MSNUM]
ENDIF
ENDIF
_GDIR=-(S_SDIR_LOCAL*2-7)*_PM*_CDIR*_C_M3
_FRL=-_CDIR*_GDIR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," M3/4: M"<<S_SDIR_LOCAL)
WRITE(_LOG,_LOG_FILE," _CDIR:"<<_CDIR)
WRITE(_LOG,_LOG_FILE," _C_M3:"<<_C_M3)
WRITE(_LOG,_LOG_FILE," _GDIR:"<<_GDIR)
WRITE(_LOG,_LOG_FILE," _FRL: "<<_FRL)
ENDIF
IF ($MCS_FUNCTION_MASK_TURN B_AND 'B1000000000000') GOTOF _M5304
_SP=-1
IF($MCS_AXIS_USAGE[_KA_NR_SP]==3)
_SP=0
ELSE
IF($MCS_AXIS_USAGE[_KA_NR_SP]==5)
_SP=1
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindel synchronisieren: _SP="<<_SP)
ENDIF
IF(_SP>=0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_SC_C97["<<_SP<<",0...3]= "<<_SC_C97[_SP,0]<<" , "<<_SC_C97[_SP,1]<<" , "<<_SC_C97[_SP,2]<<" , "<<_SC_C97[_SP,3])
WRITE(_LOG,_LOG_FILE,"$P_TC="<<$P_TC)
WRITE(_LOG,_LOG_FILE,"_FAK1="<<_FAK1<<" _FAK2="<<_FAK2<<" _FAK3="<<_FAK3)
WRITE(_LOG,_LOG_FILE,"$AC_ACT_ORI_TOOL_LENGTH="<<$AC_ACT_ORI_TOOL_LENGTH[1]<<" "<<$AC_ACT_ORI_TOOL_LENGTH[2]<<" "<<$AC_ACT_ORI_TOOL_LENGTH[3])
ENDIF
IF(_SC_C97[_SP,0]==1)
IF ( ($P_ACTFRAME[_XX,RT]<>0) OR ($P_ACTFRAME[_ZZ,RT]<>0) OR (NOT($P_TRAFO==0)) )
GOTOF _FEHL9
ENDIF
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=2
$AC_MEAS_P2_COORD=0
$AA_MEAS_POINT1[_ZZ]=_SC_C97[_SP,2]*_FAK3+$AC_ACT_ORI_TOOL_LENGTH[3]*_FAK1
$AA_MEAS_POINT1[_XX]=_SC_C97[_SP,3]*_FAK3+$AC_ACT_ORI_TOOL_LENGTH[1]*_FAK1
_ERR=MEASURE()
IF(_ERR) GOTOF _FEHL14
_C97_2=$AA_MEAS_POINT2[_ZZ]
_C97_3=$AA_MEAS_POINT2[_XX]/_PLAN
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Z: "<<_SC_C97[_SP,2]<<"(MKS) = "<<_C97_2<<"(WKS)")
WRITE(_LOG,_LOG_FILE,"X: "<<_SC_C97[_SP,3]<<"(MKS) = "<<_C97_3<<"(WKS)")
WRITE(_LOG,_LOG_FILE,"Z MEAS_POINTS: "<<$AA_MEAS_POINT1[_ZZ]<<"(MKS) = "<<$AA_MEAS_POINT2[_ZZ]<<"(WKS)")
ENDIF
IF(_LP)
_D=_SPL-_C97_2
ELSE
_D=_C97_3-_SPD/2
ENDIF
_F=_PIT _G=_PIT1
IF(_G==0)
_UMQ=_D/_F
ELSE
_UMQ=POT(_F/_G)+2*_D*(-_PM)/_G
IF(_UMQ>=0)
_UMQ=-_PM*(_G/ABS(_G)*SQRT(_UMQ)-_F/_G)
ELSE
_UMQ=0
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"UMQ= "<<_UMQ*360)
WRITE(_LOG,_LOG_FILE,"D  = "<<_D)
WRITE(_LOG,_LOG_FILE,"F  = "<<_F)
WRITE(_LOG,_LOG_FILE,"G  = "<<_G)
ENDIF
IF(_LP)
_UMQ=-(_UMQ-TRUNC(_UMQ))*_FRL
ELSE
_UMQ=(_UMQ-TRUNC(_UMQ))*_FRL
ENDIF
_NSP=_NSP+_SC_C97[_SP,1]+_UMQ*360
_NSP=((_NSP MOD 360)+360) MOD 360
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"NSP= "<<_NSP)
WRITE(_LOG,_LOG_FILE,"UMQ= "<<_UMQ*360)
WRITE(_LOG,_LOG_FILE,"SYNC="<<_SC_C97[_SP,1])
ENDIF
ENDIF
ENDIF
_M5304:
_TA=(_P[5,1-_LP]-_P[3,1-_LP])/ABS(_P[5,_LP]-_P[3,_LP])
_P[1,_LP]=_P[3,_LP]-ABS(_APP)*_PM
_P[1,1-_LP]=_P[3,1-_LP]-ABS(_APP)*_TA+_SDIS*_AI
_P[2,_LP]=_P[3,_LP]-ABS(_APP)*_PM
_P[2,1-_LP]=_P[3,1-_LP]-ABS(_APP)*_TA
_P[0,_LP]=_P[3,_LP]
_P[0,1-_LP]=_P[3,1-_LP]+_SDIS*_AI
_P[4,_LP]=_P[5,_LP]-_ROP*_PM
_P[4,1-_LP]=_P[5,1-_LP]-_ROP*_TA
_P[6,_LP]=_P[5,_LP]
_P[6,1-_LP]=_P[5,1-_LP]+_SDIS*_AI
IF (_BG)
_P[7,_LP]=(_P[3,_LP]+_P[4,_LP])/2
IF (_H_AMODE[6])
_RS_BG=ABS(S_XRS)
S_PP=(-2)*_P[3,1-_LP] S_QQ=POT(_P[3,1-_LP])+POT(_P[3,_LP])-2*_P[3,_LP]*_P[7,_LP]+POT(_P[7,_LP])-POT(_RS_BG)
IF ((POT(S_PP)/4-S_QQ)<0)
_SERR="-1"
GOTOF _FEHL15
ELSE
_DIS=SQRT(POT(S_PP)/4-S_QQ)
_D1=(-S_PP)/2+_DIS _D2=(-S_PP)/2-_DIS
IF (S_XRS<0)
IF (_P[3,1-_LP]<_D1)
_P[7,1-_LP]=_D1
ELSE
_P[7,1-_LP]=_D2
ENDIF
ELSE
IF (_P[3,1-_LP]>_D1)
_P[7,1-_LP]=_D1
ELSE
_P[7,1-_LP]=_D2
ENDIF
_XS_BG=_P[7,1-_LP]+_RS_BG-_P[3,1-_LP]
_P[0,1-_LP]=_P[3,1-_LP]+_SDIS*_AI+_XS_BG*_AI
_P[1,1-_LP]=_P[3,1-_LP]-ABS(_APP)*_TA+_SDIS*_AI+_XS_BG*_AI
_P[6,1-_LP]=_P[5,1-_LP]+_SDIS*_AI+_XS_BG*_AI
ENDIF
ENDIF
ELSE
_XS_BG=ABS(S_XRS)
_P[7,1-_LP]=_P[3,1-_LP]+S_XRS
_CAL[0]=3 _CAL[1]=_P[3,_LP] _CAL[2]=_P[3,1-_LP] _CAL[3]=_P[7,_LP] _CAL[4]=_P[7,1-_LP] _CAL[5]=_P[4,_LP] _CAL[6]=_P[4,1-_LP]
CYCLE116(_CAL,_ALARM)
_P[7,_LP]=_CAL[9] _P[7,1-_LP]=_CAL[10] _RS_BG=_CAL[11]
IF (S_XRS>0)
_P[0,1-_LP]=_P[3,1-_LP]+_SDIS*_AI+_XS_BG*_AI
_P[1,1-_LP]=_P[3,1-_LP]-ABS(_APP)*_TA+_SDIS*_AI+_XS_BG*_AI
_P[6,1-_LP]=_P[5,1-_LP]+_SDIS*_AI+_XS_BG*_AI
ENDIF
ENDIF
_ALPHA=ATAN2(ABS(_P[7,1-_LP]-_P[3,1-_LP]),ABS(_P[7,_LP]-_P[3,_LP])) _OEFFWI=180-2*_ALPHA
IF (_ALPHA<45)
_FEHL16
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"------------------------------------")
WRITE(_LOG,_LOG_FILE,"Balliges Gewinde")
WRITE(_LOG,_LOG_FILE,"Kreismittelpunkt: "<<_P[7,_LP]<<";"<<_P[7,1-_LP])
WRITE(_LOG,_LOG_FILE,"Radius: "<<_RS_BG)
WRITE(_LOG,_LOG_FILE,"ffnungswinkel: "<<_OEFFWI)
WRITE(_LOG,_LOG_FILE,"------------------------------------")
ENDIF
ENDIF
_ZUAG=_FDEP
_ZUFG=1
IF(_BA[2]==1)
_FFLZ=1
ELSE
_FFLZ=-1
ENDIF
_GWT=0
IF(_GDEP>0)AND(_H_NUMTH>1)GOTOF _M161
_GWT=_ZUG
GOTOF _M16
_M161:_GWT=_GWT+_GDEP
IF(_ZUAG>=_GWT)GOTOB _M161
_M16:
_L5:
_L4:
IF(_ZUAG>=_ZUG)GOTOF _ML4E
_L3:
_NUX=_NUI
IF(_RG==0)GOTOF _ML30
_NUX=_NUI*(_H_NUMTH-1)/2+1/4
_ML30:
_NUX=_NUX MOD _H_NUMTH
_ZUA=_ZUAG
_ZUFX=_ZUFG
IF(_GUD<>1)GOTOF _ML31
_C99[0]=_NUX+1
_ML31:
_L2:
IF(_ZUA>=_GWT)GOTOF _ML2E
IF(_SL==1)GOTOF _ML230
IF(_NRC<=1) GOTOF _ML220
CASE _ZU OF 1 GOTOF _ML221
_ML220:
_NRCX=TRUNC(_ZUA*_NRC/_ZUG)+1
_ZUN=_NRCX*_ZUG/_NRC
GOTOF _ML22
_ML221:
IF (_H_AMODE[7]==1)
_NRCX=TRUNC(_ZUA*_ZUA*_NRC/(_ZUG*_ZUG))+1
_ZUN=_ZUG*SQRT(_NRCX/_NRC)
GOTOF _ML22
ENDIF
_ML222:
_NRCX=TRUNC((_NRC-1)*_ZUA*_ZUA/(_ZUG*_ZUG)+1)+1
IF(_NRCX<=2)
_NRCX=TRUNC(_ZUA/_ZUG*2*SQRT(_NRC-1))+1
_ZUN=_ZUG/2*_NRCX/SQRT(_NRC-1)
ELSE
_ZUN=_ZUG*SQRT((_NRCX-1)/(_NRC-1))
ENDIF
_ML22:
_ZUA=_ZUN _R_BG=_RS_BG-_ZUN
IF(_ZUA<=_GWT)GOTOF _ML23
_ML230:
_ZUA=_GWT _R_BG=_RS_BG-_GWT
_ML23:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Zustellung _ZUA="<<_ZUA)
ENDIF
_PG[0,_LP]=_P[0,_LP] _PG[0,1-_LP]=_P[0,1-_LP]
_PG[3,_LP]=_P[3,_LP] _PG[3,1-_LP]=_P[3,1-_LP]-_ZUA*_AI
IF(_APP<0)
_PG[2,_LP]=_P[2,_LP]
_PG[2,1-_LP]=_P[2,1-_LP]
_PG[1,_LP]=_P[1,_LP]
_PG[1,1-_LP]=_P[1,1-_LP]
ELSE
_PG[2,_LP]=_P[2,_LP]
_PG[2,1-_LP]=_P[2,1-_LP]-_ZUA*_AI
_PG[1,_LP]=_P[1,_LP]
_PG[1,1-_LP]=_P[1,1-_LP]
ENDIF
_PG[4,_LP]=_P[4,_LP] _PG[4,1-_LP]=_P[4,1-_LP]-_ZUA*_AI
IF(_ROP>0)
_PG[5,_LP]=_P[5,_LP]
_PG[5,1-_LP]=_P[5,1-_LP]
_PG[6,_LP]=_P[6,_LP]
_PG[6,1-_LP]=_P[6,1-_LP]
ELSE
_PG[5,_LP]=_P[5,_LP]
_PG[5,1-_LP]=_P[5,1-_LP]-_ZUA*_AI
_PG[6,_LP]=_P[6,_LP]
_PG[6,1-_LP]=_P[6,1-_LP]
ENDIF
IF(_FFLZ>0)
_TA1=TAN(_IANG)*(2*_LP-1)*_AI
ELSE
_TA1=TAN(_IANG)*(2*_LP-1)*_AI*_ZUFX
ENDIF
_TA2=(_P[5,1-_LP]-_P[3,1-_LP])/(_P[5,_LP]-_P[3,_LP])
_ZUZ=(_TDEP-_ZUA)*_TA1/(1+_TA1*_TA2)
_SPVX=ABS(_PG[2,1-_LP]-_PG[1,1-_LP])
_SPVZ=ABS(_PG[3,_LP]-_PG[2,_LP])
_PP0=_PIT
IF(_PIT1<>0)
IF(_PIT==0)
_PP0=POT(_PIT)+_PIT1*2*ABS(_PG[4,_LP]-_PG[3,_LP])
IF(_PP0>=0)
_PP0=(SQRT(_PP0)+_PIT)/2
IF(_PP0<_PIT)
_PP0=_PIT
ENDIF
ELSE
_PP0=_PIT
ENDIF
ENDIF
ENDIF
_PP1=_PIT _PP2=_PIT _PP3=_PIT _PPP1=_PIT1 _PPP2=_PIT1 _PPP3=_PIT1
IF(_PIT1<>0)
IF(_APP<0)
_PP1=POT(_PIT)-_PIT1*2*(ABS(_PG[3,1]-_PG[2,1])-_ZUZ)
ELSE
_PP1=_PIT
ENDIF
_PP2=POT(_PIT)+_PIT1*2*_ZUZ
_PP3=POT(_PIT)+_PIT1*2*(ABS(_PG[4,1]-_PG[3,1])-_ZUZ)
IF(_PP1<0)OR(_PP2<0)OR(_PP3<0)GOTOF _FEHL8
_PP1=SQRT(_PP1)
_PP2=SQRT(_PP2)
_PP3=SQRT(_PP3)
ENDIF
IF(_H_NUMTH<=1)
_SPV=_NSP
ELSE
_SPV=_NSP+_NUX*360/_H_NUMTH
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," -----------------------------------")
WRITE(_LOG,_LOG_FILE," SPV(0)="<<_SPV)
ENDIF
IF(_APP<0)
_SPV=_SPV+_FRL*_PM*_SPVX*360/_PP0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," SPV(1)="<<_SPV<<" + Winkel="<<_FRL*_PM*_SPVX*360/_PP0)
ENDIF
IF(_PP1==_PIT)
_UM=_SPVZ/_PIT
ELSE
_UM=POT(_PIT/_PIT1)-2*_SPVZ/_PIT1
IF(_UM>=0)
_UM=-_PIT1/ABS(_PIT1)*SQRT(_UM)+_PIT/_PIT1
ELSE
_UM=0
ENDIF
ENDIF
_SPV=_SPV+_FRL*_PM*_UM*360
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," SPV(2)="<<_SPV<<" + Winkel="<<_FRL*_PM*_UM*360<<" _UM="<<_UM)
ENDIF
_SPV=_SPV-_FRL*_AI*_PM*(_LP*2-1)*_ZUZ*360/_PP0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," SPV(3)="<<_SPV<<" - Winkel="<<_FRL*_AI*_PM*(_LP*2-1)*_ZUZ*360/_PP0)
ENDIF
IF(_SPV>=0)
_SPV=TRUNC(_SPV*1000+0.5)/1000
ELSE
_SPV=TRUNC(_SPV*1000-0.5)/1000
ENDIF
_SPV=((_SPV MOD 360)+360) MOD 360
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," SPV   ="<<_SPV)
ENDIF
_IP0=_XX _IP1=_ZZ _IP2=_ZZ _IP3=_ZZ _IP4=_XX
IF(_APP<0)
IF(_LP==0)
_IP0=_ZZ
ENDIF
IF(ABS(_PG[3,0]-_PG[2,0])>ABS(_PG[3,1]-_PG[2,1]))
_IP1=_XX
ENDIF
IF(ABS(_PG[3,1-_LP]-_PG[2,1-_LP])>ABS(_PG[3,_LP]-_PG[2,_LP]))
_FK=ABS(_PG[3,1-_LP]-_PG[2,1-_LP])/ABS(_APP)
_PP1=_PP1*_FK
_PPP1=_PPP1*_FK
ENDIF
ELSE
IF(_LP)
_IP1=_XX
ENDIF
ENDIF
IF(_ROP)
IF(_LP==0)
_IP4=_ZZ
ENDIF
IF(ABS(_PG[5,0]-_PG[4,0])>ABS(_PG[5,1]-_PG[4,1]))
_IP3=_XX
ENDIF
IF(ABS(_PG[5,1-_LP]-_PG[4,1-_LP])>ABS(_PG[5,_LP]-_PG[4,_LP]))
_FK=ABS(_PG[5,1-_LP]-_PG[4,1-_LP])/_ROP
_PP3=_PP3*_FK
_PPP3=_PPP3*_FK
ENDIF
ELSE
IF(_LP)
_IP3=_XX
ENDIF
ENDIF
IF(_LP==0)
_IP2=_XX
ENDIF
IF(_GUD==1)
_C99[1]=_NRC-_NRCX
ENDIF
IF ( (_BA[5]==3)AND(_FAL==0) )
_NIDX=_NID+2
ELSE
_NIDX=_NID+1
ENDIF
IF(_ZUA==_TDEP)GOTOF _ML24
_NIDX=1
_ML24:
_L1:
IF(_NIDX<1)GOTOF _ML1E
_NIDX=_NIDX-1
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
SBLON
N20 G0 G90 AX[_XX]=_PG[1,0]*_XAF AX[_ZZ]=_PG[1,1]*_ZAF
SBLOF
IF(_LP==1)
IF(_AI==1)
_ALF=3
ELSE
_ALF=7
ENDIF
ELSE
IF(_AI==1)
_ALF=1
ELSE
_ALF=5
ENDIF
ENDIF
IF(NOT _SHOPTURN)
IF(_LP)
_DRF1=$AC_DRF[_XX]
ELSE
_DRF1=$AC_DRF[_ZZ]
ENDIF
ENDIF
IF(_PIT1==0)
IF(_APP>=0)
IF(_ROP==0)
N30 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
IF (_BG==0)
N32 G33 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ELSE
N32 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
IF ((S_XRS>0)AND(_PM==(-1)))OR((S_XRS<0)AND(_PM==(1)))
N34 G336 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ELSE
N34 G335 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ENDIF
ENDIF
ELSE
N40 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
IF (_BG==0)
N42 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N44 G33 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ELSE
N42 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
IF ((S_XRS>0)AND(_PM==(-1)))OR((S_XRS<0)AND(_PM==(1)))
N44 G336 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ELSE
N44 G335 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ENDIF
ENDIF
N46 G33 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 DITRB=S_DITRB
ENDIF
ELSE
IF(_ROP==0)
N50 G33 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF IP[_IP0]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N52 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP1]=_PP1 DITRB=S_DITRB
IF (_BG==0)
N54 G33 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PIT
ELSE
IF ((S_XRS>0)AND(_PM==(-1)))OR((S_XRS<0)AND(_PM==(1)))
N54 G336 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG
ELSE
N54 G335 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG
ENDIF
ENDIF
ELSE
N60 G33 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF IP[_IP0]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N62 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP1]=_PP1 DITRB=S_DITRB
IF (_BG==0)
N64 G33 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PIT
ELSE
IF ((S_XRS>0)AND(_PM==(-1)))OR((S_XRS<0)AND(_PM==(1)))
N64 G336 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG
ELSE
N64 G335 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PIT CR=_R_BG
ENDIF
ENDIF
N66 G33 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 DITRB=S_DITRB
ENDIF
ENDIF
ELSE
IF(_PIT1>0)
IF(_APP>=0)
IF(_APP==0)
IF(_ROP==0)
N100 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N102 G34 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PP2 F=_PPP2 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ELSE
N110 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N112 G34 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PP2 F=_PPP2 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
N114 G34 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 F=_PPP3 DITRB=S_DITRB
ENDIF
ELSE
IF(_ROP==0)
N120 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N122 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N124 G34 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PP2 F=_PPP2
ELSE
N130 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N132 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N134 G34 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PP2 F=_PPP2
N136 G34 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 F=_PPP3 DITRB=S_DITRB
ENDIF
ENDIF
ELSE
IF(_ROP==0)
N150 G33 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF IP[_IP0]=_PP0 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N152 G34 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP1]=_PP1 F=_PPP1 DITRB=S_DITRB
N154 G34 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PP2 F=_PPP2
ELSE
N160 G33 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF IP[_IP0]=_PP0 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N162 G34 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP1]=_PP1 F=_PPP1 DITRB=S_DITRB
N164 G34 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PP2 F=_PPP2
N166 G34 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 F=_PPP3 DITRB=S_DITRB
ENDIF
ENDIF
ELSE
IF(_APP>=0)
IF(_APP==0)
IF(_ROP==0)
N200 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N202 G35 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PP2 F=-_PPP2 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
ELSE
N210 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N212 G35 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PP2 F=-_PPP2 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF
N214 G35 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 F=-_PPP3 DITRB=S_DITRB
ENDIF
ELSE
IF(_ROP==0)
N220 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N222 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N224 G35 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PP2 F=-_PPP2
ELSE
N230 G0 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF
N232 G33 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP2]=_PIT SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N234 G35 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PP2 F=-_PPP2
N236 G35 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 F=-_PPP3 DITRB=S_DITRB
ENDIF
ENDIF
ELSE
IF(_ROP==0)
N250 G33 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF IP[_IP0]=_PP0 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N252 G35 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP1]=_PP1 F=-_PPP1 DITRB=S_DITRB
N254 G35 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP2]=_PP2 F=-_PPP2
ELSE
N260 G33 AX[_XX]=_PG[2,0]*_XAF AX[_ZZ]=_PG[2,1]*_ZAF IP[_IP0]=_PP0 SF=_SPV LFON DILF=ABS(_ZUA+_SDIS) LFWP ALF=_ALF DITRB=S_DITRB
N262 G35 AX[_XX]=_PG[3,0]*_XAF AX[_ZZ]=_PG[3,1]*_ZAF IP[_IP1]=_PP1 F=-_PPP1 DITRB=S_DITRB
N264 G35 AX[_XX]=_PG[4,0]*_XAF AX[_ZZ]=_PG[4,1]*_ZAF IP[_IP2]=_PP2 F=-_PPP2
N266 G35 AX[_XX]=_PG[5,0]*_XAF AX[_ZZ]=_PG[5,1]*_ZAF IP[_IP3]=_PP3 F=-_PPP3 DITRB=S_DITRB
ENDIF
ENDIF
ENDIF
ENDIF
N70 G0 LFOF ALF=0
IF (_LP==1)
N80 G0 AX[_XX]=_PG[6,0]*_XAF
IF (($P_EP[_ZZ])==(_PG[6,1]*_ZAF))
$AC_LIFTFAST=0
ENDIF
ELSE
N80 G0 AX[_ZZ]=_PG[6,1]*_ZAF
IF (($P_EP[_XX])==(_PG[6,0]*_XAF))
$AC_LIFTFAST=0
ENDIF
ENDIF
IF(NOT _SHOPTURN)
IF(_LP)
_DRF=$AC_DRF[_XX]
ELSE
_DRF=$AC_DRF[_ZZ]
ENDIF
ENDIF
IF($P_LIFTFAST==0)GOTOF _MN60
_NIDX=_NIDX+1
$AC_LIFTFAST=0
_MN60:
IF(_GUD<>1)GOTOF _ML19
STOPRE
IF((_C99[3] B_AND 1)==0)GOTOF _ML19
N400 G0 G90 AX[_XX]=_PG[1,0]*_XAF AX[_ZZ]=_PG[1,1]*_ZAF
M0
STOPRE
_ML19:
IF(_GUD<>1)GOTOF _ML1
IF(_NIDX>0) OR ((_C99[3] B_AND 4)==0)GOTOF _ML1
_NIDX=1
_ML1:
IF(_NIDX==0)AND(_DRF<>_DRF1)
_NIDX=1
ELSE
ENDIF
GOTOB _L1
_ML1E:
_ML2:
_ZUFX=-_ZUFX
IF(_GUD<>1)GOTOF _ML29
IF(_C99[2]<=0)OR(_C99[2]==_NRC)GOTOF _ML29
_NRC=_C99[2]
_ML29:
_C99[2]=0
GOTOB _L2
_ML2E:
IF(_GUD<>1)GOTOF _ML39
IF((_C99[3] B_AND 3)<>2)OR(_H_NUMTH==1)GOTOF _ML39
N110 G0 G90 AX[_XX]=_PG[1,0]*_XAF AX[_ZZ]=_PG[1,1]*_ZAF
M0
STOPRE
_ML39:
_ML3:
IF(_GST<0)GOTOF _ML3E
_NUI=_NUI+1
IF(_NUI>=_H_NUMTH)GOTOF _ML3E
GOTOB _L3
_ML3E:
_ZUAG=_GWT
_ZUFG=-_ZUFX
_GWT=_GWT+_GDEP
IF(_GWT<=_ZUG)GOTOF _ML40
_GWT=_ZUG
_ML40:
IF(_GST<0)GOTOF _ML42
_NUI=0
_ML42:
GOTOB _L4
_ML4E:
_ML5:
IF(_ZUG==_TDEP)OR(_SR)GOTOF _ML5E
_SL=1
_ZUG=_TDEP
_GWT=_TDEP
GOTOB _L5
_ML5E:
SBLON
N120 G0 G90 AX[_XX]=_PG[1,0]*_XAF AX[_ZZ]=_PG[1,1]*_ZAF
LFOF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[8])
ENDIF
IF(_GUD<>1)GOTOF _MR1
_C99[0]=0
_C99[1]=0
_MR1:
RET
_FEHL1: STOPRE
N709901 SETAL(61002)
RET
_FEHL2: STOPRE
N709902 SETAL(61001)
RET
_FEHL3: STOPRE
N709903 SETAL(61011)
RET
_FEHL4: STOPRE
N709904 SETAL(61605)
RET
_FEHL5: STOPRE
N709905 SETAL(61010)
RET
_FEHL6: STOPRE
N709906 SETAL(61610)
RET
_FEHL7: STOPRE
N709907 SETAL(61102)
RET
_FEHL8: STOPRE
N709908 SETAL(61244)
RET
_FEHL9: STOPRE
N709909 SETAL(61612)
RET
_FEHL10: STOPRE
N709910 SETAL(61158)
RET
_FEHL11: STOPRE
N709911 SETAL(61019,_SERR)
RET
_FEHL12: STOPRE
N709912 SETAL(61287)
RET
_FEHL13:STOPRE
N709913 SETAL(62106)
RET
_FEHL14:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Fehler 14: interner Zyklusfehler bei Frame-Berechnung (MEASURE->"<<_ERR<<")")
ENDIF
N709914 SETAL(61403)
RET
_FEHL15: STOPRE
N709915 SETAL(61099,_SERR)
RET
_FEHL16: STOPRE
N709916 SETAL(61621)
RET
_FEHL19: STOPRE
N709919 SETAL(61212)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE202_SPF
PROC CYCLE202(INT _MODE,VAR REAL _POS,REAL _DIS) SAVE SBLOF DISPLOF PREPRO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V04.08.02.00.074 ;DATE: 2017-04-05
;Rueckzugs-Zyklus
DEF INT _LOG,_LOG_ON=0
DEF INT _PLANE,_RETV,_FR
DEF AXIS _XX,_YY,_ZZ
DEF REAL _STARTPOS[3],_MOVDIS[3],_DLIMIT[5],_MAXDIST[3],_INC
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
_POS=1000
IF (($P_GG[13]==1)OR($P_GG[13]==3))
_POS=1000/$MN_SCALING_VALUE_INCH
ENDIF
_POS=_POS+$P_EP[$P_AXN3]
;GOTOF _RET
ENDIF
IF(_MODE==2)
_FR=(_TC_FR MOD 10)
IF(_FR<4)OR(_FR>5)
GOTOF _RET
ENDIF
_MODE=_TC_FR-4
IF(_FR==5)
_DIS=_TC_FR_I
ENDIF
ENDIF
_POS=0
_PLANE=$P_GG[6]
IF(_PLANE==1)
_XX=$P_AXN1
_YY=$P_AXN2
_ZZ=$P_AXN3
ELSE
IF(_PLANE==2)
_ZZ=$P_AXN1
_XX=$P_AXN2
_YY=$P_AXN3
ELSE
_YY=$P_AXN1
_ZZ=$P_AXN2
_XX=$P_AXN3
ENDIF
ENDIF
_INC=$MN_INT_INCR_PER_MM
_DLIMIT[0]=2/_INC _DLIMIT[1]=2/_INC _DLIMIT[2]=2/_INC
_STARTPOS[0]=$P_EP[_XX] _STARTPOS[1]=$P_EP[_YY] _STARTPOS[2]=$P_EP[_ZZ]
_MOVDIS[0]=0 _MOVDIS[1]=0 _MOVDIS[2]=0
IF(_MODE)
_MOVDIS[ABS(_PLANE-3)]=ABS(_DIS)
ELSE
_MOVDIS[ABS(_PLANE-3)]=999999999
ENDIF
_RETV=CALCPOSI(_STARTPOS,_MOVDIS,_DLIMIT,_MAXDIST,0,7)
_POS=_MAXDIST[ABS(_PLANE-3)]
_POS=_POS+_STARTPOS[ABS(_PLANE-3)]
IF(_LOG_ON)
DELETE(_LOG,"//NC:/_N_MPF_DIR/_N_LOG_cycle202_MPF")
WRITE(_LOG,"//NC:/_N_MPF_DIR/_N_LOG_cycle202_MPF", "RETV: "<<_RETV<<"  STARTPOS: "<<_STARTPOS[0]<<" "<<_STARTPOS[1]<<" "<<_STARTPOS[2]<<"  MOVDIS: "<<_MOVDIS[0]<<" "<<_MOVDIS[1]<<" "<<_MOVDIS[2]<<"  MAXDIST: "<<_MAXDIST[0]<<" "<<_MAXDIST[1]<<" "<<_MAXDIST[2]<<"  POS: "<<_POS)
ENDIF
IF(_RETV==-6) GOTOF _FEHL2
IF(_RETV<0) GOTOF _FEHL1
_RET:
RET
_FEHL1:STOPRE
SETAL(61099,"202")
RET
_FEHL2:STOPRE
SETAL(61816)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE203_SPF
PROC CYCLE203(INT _MODE,REAL _FS,REAL _ZFS) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.001 ;DATE: 2023-08-08
;Cycle support HMIsl
;Internal subroutine
DEF INT _TYP,_VORZ
DEF REAL _FAK1,_FAK2,_TOOLR,_TANGO,_DEEP
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_TYP=$TC_DP1[$P_TOOLNO,$P_TOOL]
_TOOLR=$P_TOOLR*_FAK1
_TANGO=0
_DEEP=0
_VORZ=1
_ZFS=ABS(_ZFS)
IF(_TYP==200)OR(_TYP==220)OR(_TYP==230)
_TANGO=$P_AD[24]/2
REPEAT _FASAN_A _FASAN_E
IF(_TANGO)
_DEEP=_TOOLR/_TANGO
ENDIF
ENDIF
IF(_TYP==140)
IF($P_AD[11])
_TANGO=90-$P_AD[11]
ENDIF
REPEAT _FASAN_A _FASAN_E
IF(_TANGO)
_DEEP=($P_AD[7]-$P_TOOLR)*_FAK1/_TANGO
ENDIF
_TOOLR=0
ENDIF
IF(_TYP==155)OR(_TYP==156)
_TANGO=$P_AD[11]
REPEAT _FASAN_A _FASAN_E
_TOOLR=0
ENDIF
IF(_FS<=0) GOTOF _FEHL1
IF(_ZFS<=0) GOTOF _FEHL3
IF(_TYP==140)
IF($P_AD[7]>0)
IF(_FS>($P_AD[7]-$P_TOOLR)*_FAK1) GOTOF _FEHL2
ENDIF
ELSE
IF(_TYP<>155)AND(_TYP<>156)
IF(_FS>$P_TOOLR*_FAK1) GOTOF _FEHL2
IF(_TANGO)
IF(_ZFS*_TANGO>$P_TOOLR*_FAK1) GOTOF _FEHL4
ENDIF
ENDIF
ENDIF
IF(NOT _TANGO)
_TANGO=1
ENDIF
IF(_ZFS*_TANGO<=_FS) GOTOF _FEHL3
IF(_DEEP)
IF(_ZFS>_DEEP) GOTOF _FEHL4
ENDIF
IF(NOT _MODE)
_VORZ=-_VORZ
ENDIF
OFFN=$P_OFFN*_FAK2-_VORZ*(_TOOLR-(_ZFS*_TANGO-_FS))
RET
_FASAN_A:
IF(_TANGO>=0)AND(_TANGO<90)
_TANGO=TAN(_TANGO)
ELSE
GOTOF _FEHL5
ENDIF
_FASAN_E:
_FEHL1: STOPRE
N720301 SETAL(61270)
RET
_FEHL2: STOPRE
N720302 SETAL(61271)
RET
_FEHL3: STOPRE
N720303 SETAL(61272)
RET
_FEHL4: STOPRE
N720304 SETAL(61273)
RET
_FEHL5: STOPRE
N720305 SETAL(61274)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE204_SPF
PROC CYCLE204(VAR REAL PP,REAL MPIT) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.37.00 ;DATE: 2009-10-22
;Cycle support HMIsl
;Internal subroutine
DEF INT JJ,II
DEF REAL HH,PT[27]=(0.6,0.75,0.5,0.7,0.8,1,1,1.25,1.5,1.75,2,2,2.5,2.5,2.5,3,3,3.5,3.5,4,4,4.5,4.5,5,5,5.5,5.5)
PP=PT[0]
IF MPIT==3.5 GOTOF _MX1
PP=PT[1]
IF MPIT==4.5 GOTOF _MX1
HH=TRUNC(MPIT) II=HH
IF (MPIT<>HH)OR(MPIT<3) GOTOF _FEHL1 IF MPIT<52 GOTOF _MA1
JJ=(II-52)DIV 4 PP=PT[24+JJ]
RET
_MA1:IF MPIT<27 GOTOF _MA2
JJ=(II-27)DIV 3 PP=PT[16+JJ]
RET
_MA2:IF MPIT<10 GOTOF _MA3
JJ=(II-10)DIV 2 PP=PT[8+JJ]
RET
_MA3:PP=PT[II-1]
_MX1:RET
_FEHL1:STOPRE
N720401 SETAL(61001)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE206_SPF
PROC CYCLE206(STRING[32] _T,INT _DD,INT _DP,INT _VARI,INT S_MTL) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.002 ;DATE: 2018-03-21
;Cycle support HMIsl
;Tool change cycle in JOG-Mode
DEF INT _I,_TI=0,_TPP=-1,S_THNR,S_SPI,S_MT_PL,_WTYP
DEF REAL S_TPPR
DEF BOOL S_IS_T0=FALSE,S_IS_T=FALSE,S_IS_MAG=FALSE,S_IS_MTL=FALSE
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE206_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
; DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE206: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"CYCLE206(_T="<<_T<<",_DD="<<_DD<<",_DP="<<_DP<<",_VARI="<<_VARI<<",S_MTL="<<S_MTL<<")")
ENDIF
IF(_T=="0")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"T0")
ENDIF
S_IS_T0=TRUE
_TI=0
ELSE
IF(_VARI _DEC1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Auswahl: Magazinplatz")
ENDIF
IF(_T<>"")
IF(ISNUMBER(_T))
S_TPPR=NUMBER(_T)
_TPP=S_TPPR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Magazinplatz="<<_TPP)
ENDIF
IF(_TPP>=0)AND(_TPP<=$TC_MAP7[$P_MAG[1]]*$TC_MAP6[$P_MAG[1]])
S_IS_MAG=TRUE
ELSE
IF(_TPP<0)
GOTOF _FEHL1
ELSE
GOTOF _FEHL2
ENDIF
ENDIF
ELSE
GOTOF _FEHL3
ENDIF
IF($MC_TOOL_MANAGEMENT_TOOLHOLDER>=1)
S_THNR=$P_MTHNUM
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Toolholder: "<<S_THNR)
ENDIF
ELSE
S_THNR=$P_MSNUM
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindel: "<<S_THNR)
ENDIF
ENDIF
FOR _I=1 TO $TC_MAP7[9998]
IF($TC_MPP1[9998,_I]==2)
IF(S_THNR==$TC_MPP5[9998,_I])
S_SPI=_I
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindelplatznummer: "<<S_SPI)
ENDIF
ENDIF
ENDIF
ENDFOR
IF($TC_MPP4[$P_MAG[1],_TPP] B_AND 'B100')
_TI=$TC_MPP6[9998,S_SPI]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"T-Nr. aus Spindel: "<<_TI)
ENDIF
ELSE
_TI=$TC_MPP6[$P_MAG[1],_TPP]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"T-Nr. aus Magazinplatz: "<<_TI)
ENDIF
ENDIF
IF(S_MTL)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Multitoolplatz: "<<S_MTL<<" TI="<<_TI)
ENDIF
IF(_TI>0)
IF($P_TMNOIS[_TI]==0)
S_IS_MTL=TRUE
S_MT_PL=$TC_MTPN[_TI]
IF(S_MTL<0)OR(S_MTL>S_MT_PL)
GOTOF _FEHL5
ENDIF
ELSE
GOTOF _FEHL4
ENDIF
_TI=$TC_MTPP6[_TI,S_MTL]
ELSE
S_IS_MTL=TRUE
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Werkzeugnummer: "<<_TI)
ENDIF
ELSE
GETEXET(_TI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"aktives Werkzeug: TI="<<_TI)
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Auswahl: Werkzeugname")
ENDIF
IF(_T<>"")
S_IS_T=TRUE
_TI=GETT(_T,_DP)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"neues Werkzeug: "<<_T<<" DP="<<_DP<<" TI="<<_TI)
ENDIF
ELSE
GETEXET(_TI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"aktives Werkzeug: TI="<<_TI)
ENDIF
ENDIF
ENDIF
ENDIF
IF(S_IS_T0)OR(S_IS_T)OR(S_IS_MAG)
IF($MCS_TECHNOLOGY==1)AND(_F_AX_EXISTS[1])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(42)")
ENDIF
CUST_TECHCYC(42)
ENDIF
IF(S_IS_T0)
_F_T_STR="0"
_F_DP_NO=-1
_F_T_MP=-1
_F_MTL=-1
CUST_TECHCYC(117)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: T0")
ENDIF
T0
ELSE
IF(_VARI _DEC1)
IF(S_IS_MAG)AND(S_IS_MTL)
_F_T_STR=""
_F_DP_NO=-1
_F_T_MP=_TPP
_F_MTL=S_MTL
CUST_TECHCYC(117)
IF(_TI>0)
IF($TC_TP8[_TI] B_AND 'H4')
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Werkzeug ist gesperrt")
WRITE(_LOG,_LOG_FILE,"Ausgabe: TCA("<<$TC_TP2[_TI]<<","<<$TC_TP1[_TI]<<")")
ENDIF
TCA($TC_TP2[_TI],$TC_TP1[_TI])
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: TCA("<<$TC_TP2[_TI]<<","<<$TC_TP1[_TI]<<")")
ENDIF
TCA($TC_TP2[_TI],$TC_TP1[_TI])
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: MTL="<<S_MTL<<" T="<<_TPP)
ENDIF
MTL=S_MTL T=_TPP
ENDIF
ELSE
_F_T_STR=""
_F_DP_NO=-1
_F_T_MP=_TPP
_F_MTL=-1
CUST_TECHCYC(117)
IF(_TI>0)
IF($TC_TP8[_TI] B_AND 'H4')
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Werkzeug ist gesperrt")
WRITE(_LOG,_LOG_FILE,"Ausgabe: TCA("<<$TC_TP2[_TI]<<","<<$TC_TP1[_TI]<<")")
ENDIF
TCA($TC_TP2[_TI],$TC_TP1[_TI])
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: TCA("<<$TC_TP2[_TI]<<","<<$TC_TP1[_TI]<<")")
ENDIF
TCA($TC_TP2[_TI],$TC_TP1[_TI])
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: T="<<_TPP)
ENDIF
T=_TPP
ENDIF
ENDIF
ELSE
IF(_DP)
_F_T_STR=_T
_F_DP_NO=_DP
_F_T_MP=-1
_F_MTL=-1
CUST_TECHCYC(117)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: TCA("<<_T<<","<<_DP<<")")
ENDIF
TCA(_T,_DP)
ELSE
_F_T_STR=_T
_F_DP_NO=-1
_F_T_MP=-1
_F_MTL=-1
CUST_TECHCYC(117)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ausgabe: T="<<_T)
ENDIF
T=_T
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(110)")
ENDIF
CUST_TECHCYC(110)
IF($MC_TOOL_CHANGE_MODE==1)
M6
ENDIF
ENDIF
IF(NOT S_IS_T0)
IF(_DD==-1)
_DD=$P_TOOL
ENDIF
IF($MC_CUTTING_EDGE_DEFAULT==-2)OR($MC_CUTTING_EDGE_DEFAULT==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schneidenanwahl: D="<<_DD)
ENDIF
D=_DD
ELSE
IF(($P_TOOL<>_DD)AND($P_TOOLNO==_TI))
_F_D_NO=_DD
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(113) _F_D_NO="<<_F_D_NO)
ENDIF
CUST_TECHCYC(113)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schneidenumwahl: D="<<_DD)
ENDIF
D=_DD
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schneidenanwahl: D="<<_DD)
ENDIF
D=_DD
ENDIF
ENDIF
ENDIF
IF($MCS_REV_2_BORDER_TOOL_LENGTH)
F_T_REV2
ENDIF
IF(S_IS_T0)OR(S_IS_T)OR(S_IS_MAG)OR(S_IS_MTL)
IF($MCS_TECHNOLOGY==1)AND(_F_AX_EXISTS[1])
IF($P_TOOLNO)AND($P_TOOL)
_WTYP=$P_AD[1]
IF(_WTYP<500)OR(_WTYP>599)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(41)")
ENDIF
CUST_TECHCYC(41)
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(111)")
ENDIF
CUST_TECHCYC(111)
ENDIF
RET
_FEHL1: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61055 Magazinplatznummer zu klein: "<<_TPP)
ENDIF
N720601 SETAL(61055,<<_TPP)
RET
_FEHL2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61056 Magazinplatznummer zu gro: "<<_TPP)
ENDIF
N720602 SETAL(61056,<<_TPP)
RET
_FEHL3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61057 Magazinplatznummer ist keine Zahl: "<<_T)
ENDIF
N720603 SETAL(61057,_T)
RET
_FEHL4: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61063 Werkzeug auf Magazinplatz "<<_TPP<<" ist kein Multitool")
ENDIF
N720604 SETAL(61063,<<_TPP)
RET
_FEHL5: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61064 Ungltiger Multitoolplatz: "<<S_MTL)
ENDIF
N720605 SETAL(61064,<<S_MTL)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE207_SPF
PROC CYCLE207 DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V04.08.02.00.074 ;DATE: 2017-04-06
;Cycle support HMIsl
;SERUPRO
DEF STRING[50] _FILENAME,_FILENAME2
DEF STRING[400] _STR
DEF INT _NUM=0
DEF INT _ERR
DEF INT _TI,_I1,_I2
DEF INT _GROUPINDEX[10]
DEF INT _E_TC,_NPV,S_P52,S_P53
DEF REAL _A1,_A2,S_A1TC,S_A2TC
DEF CHAR _QUOT=34
DEF FRAME _WPFR
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE207_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE207: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
GETEXET(_TI)
IF(_TI)
WRITE(_LOG,_LOG_FILE,"aufgesammeltes Werkzeug  T="<<_QUOT<<$TC_TP2[_TI]<<_QUOT)
ELSE
WRITE(_LOG,_LOG_FILE,"aufgesammeltes Werkzeug  T0")
ENDIF
WRITE(_LOG,_LOG_FILE,"aufgesammelte D-Nummer:    D"<<$P_TOOL)
GETSELT(_TI)
IF(_TI)
WRITE(_LOG,_LOG_FILE,"vorangewaehltes Werkzeug T="<<_QUOT<<$TC_TP2[_TI]<<_QUOT)
ENDIF
ENDIF
_FILENAME="/_N_WKS_DIR/_N_TEMP_WPD/_N_TEMP_SERUPRO_"<<$P_CHANNO<<"_MPF"
_FILENAME2="WKS/TEMP/TEMP_SERUPRO_"<<$P_CHANNO<<".MPF"
IF(ISFILE(_FILENAME))
DELETE(_ERR, _FILENAME)
IF(_ERR) GOTOF _FILE_ERROR
ENDIF
_E_TC=$P_TC
IF($MCS_FUNCTION_MASK_TECH B_AND 'H01')AND(_E_TC)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schwenkdaten merken")
ENDIF
_NPV=$P_GG[8]
S_P52=$P_GG[52]
S_P53=$P_GG[53]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME merken")
ENDIF
_WPFR=$P_WPFRAME
S_A1TC=$P_TCANG[1]
S_A2TC=$P_TCANG[2]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Position Schwenkkopf merken:")
WRITE(_LOG,_LOG_FILE,"  Toolcarrier:        "<<S_A1TC<<"/"<<S_A2TC)
ENDIF
ENDIF
_NUM=0
WHILE(_NUM>=0)
AUXFUSYNC(_NUM,_GROUPINDEX,_STR)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";AUXFUSYNC("<<_NUM<<",...,"<<_STR<<")")
ENDIF
IF(_NUM>=0)
WRITE(_ERR,_FILENAME,_STR)
IF(_ERR) GOTOF _FILE_ERROR
ENDIF
ENDWHILE
WRITE(_ERR,_FILENAME,"RET")
IF(_ERR) GOTOF _FILE_ERROR
N100 CALL _FILENAME
IF($MCS_FUNCTION_MASK_TECH B_AND 'H01')AND(_E_TC)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Toolcarrier rekonstruieren")
ENDIF
$P_WPFRAME=_WPFR
$P_WPFR=$P_WPFRAME
G[8]=_NPV
_A1=$TC_CARR13[_E_TC]
_A2=$TC_CARR14[_E_TC]
$TC_CARR13[_E_TC]=S_A1TC
$TC_CARR14[_E_TC]=S_A2TC
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $TC_CARR13="<<$TC_CARR13[_E_TC]<<" $TC_CARR14="<<$TC_CARR14[_E_TC])
ENDIF
N800 TCARR=_E_TC TCOABS
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  N800 TCARR="<<_E_TC<<" TCOABS")
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)AND(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))
IF($MC_TOOL_CARRIER_RESET_VALUE<>_E_TC)
STOPRE
$MC_TOOL_CARRIER_RESET_VALUE=_E_TC
ENDIF
ENDIF
$TC_CARR13[_E_TC]=_A1
$TC_CARR14[_E_TC]=_A2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $TC_CARR13="<<$TC_CARR13[_E_TC]<<" $TC_CARR14="<<$TC_CARR14[_E_TC])
ENDIF
_TC_A1=$P_TCANG[1]
_TC_A2=$P_TCANG[2]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  _TC_A1="<<_TC_A1<<" _TC_A2="<<_TC_A2)
ENDIF
N52 G[52]=S_P52
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  N52 G[52]="<<S_P52<<" -> "<<SUBSTR("PAROTOFPAROT",(S_P52-1)*7,7))
ENDIF
N53 G[53]=S_P53
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  N53 G[53]="<<S_P53<<" -> "<<SUBSTR("TOROTOF TOROT   TOROTZ  TOROTY  TOROTX  TOFRAME TOFRAMEZTOFRAMEYTOFRAMEX",(S_P53-1)*8,8))
ENDIF
ENDIF
RET
_FILE_ERROR:
CASE _ERR OF 1 GOTOF _ERR_1 2 GOTOF _ERR_2 3 GOTOF _ERR_3 4 GOTOF _ERR_4 10 GOTOF _ERR_10 11 GOTOF _ERR_11 12 GOTOF _ERR_12 13 GOTOF _ERR_13 DEFAULT GOTOF _ERR_20
_ERR_1: GOTOF _FEHL1
_ERR_2: GOTOF _FEHL2
_ERR_3: GOTOF _FEHL3
_ERR_4: GOTOF _FEHL4
_ERR_10: GOTOF _FEHL5
_ERR_11: GOTOF _FEHL6
_ERR_12: GOTOF _FEHL7
_ERR_13: GOTOF _FEHL8
_ERR_20: GOTOF _FEHL9
_FEHL1: STOPRE
N720701 SETAL(61030,_FILENAME2)
RET
_FEHL2: STOPRE
N720702 SETAL(61031,_FILENAME2)
RET
_FEHL3: STOPRE
N720703 SETAL(61032,_FILENAME2)
RET
_FEHL4: STOPRE
N720704 SETAL(61033,_FILENAME2)
RET
_FEHL5: STOPRE
N720705 SETAL(61034,_FILENAME2)
RET
_FEHL6: STOPRE
N720706 SETAL(61035,_FILENAME2)
RET
_FEHL7: STOPRE
N720707 SETAL(61036,_FILENAME2)
RET
_FEHL8: STOPRE
N720708 SETAL(61037,_FILENAME2)
RET
_FEHL9: STOPRE
;N720709 SETAL(61038,_FILENAME2)
N720709 SETAL(61036,_FILENAME2)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE208_SPF
PROC CYCLE208(STRING[24] _JOB) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.002 ;DATE: 2023-09-18
;Cycle support HMIsl
;Call of multi channel data
DEF INT _LINE,_POS,_CHAN,_ERR,_FOUND,_I,_CHANF[10],_VARI1,_VARI2
DEF STRING[400] _FILENAME
DEF STRING[28] _FILENAME2
DEF STRING[255] _CMD
DEF STRING[255] _STR[1]
DEF STRING[400] _ERR_STR
DEF STRING[10] S_CHANI
DEF STRING[1] _HOCHKOMMA=" "
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE208_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
_FILENAME=$P_PATH[0]<<"_N_"<<_JOB<<"_JOB"
_FILENAME2=_JOB<<".JOB"
IF(NOT ISFILE(_FILENAME)) GOTOF _FEHL13
_LINE=1
_ERR=0
_CHANF[0]=REP(0)
WHILE(_ERR==0)
N10 READ(_ERR,_FILENAME,_LINE,1,_STR)
IF(_ERR)
IF(_ERR<>21) GOTOF _FILE_ERROR
ELSE
IF(SUBSTR(_STR[0],0,7)=="SELECT ")
_POS=MATCH(_STR[0],"CH=")
IF(ISNUMBER(SUBSTR(_STR[0],_POS+3)))
_CHAN=NUMBER(SUBSTR(_STR[0],_POS+3))
IF(_CHAN==$P_CHANNO)
IF(TOUPPER(SUBSTR(_STR[0],7,_POS-8))==TOUPPER($P_PROG_NAME[0]<<"."<<$P_PROG_SUFFIX[0]))
_FOUND=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,<<_STR[0])
ENDIF
ENDIF
ENDIF
_CHANF[_CHAN-1]=1
ENDIF
ENDIF
IF(_CMD=="")AND(SUBSTR(_STR[0],0,9)=="CYCLE209(")
_CMD=_STR[0]
ENDIF
ENDIF
_LINE=_LINE+1
ENDWHILE
IF(NOT _FOUND) GOTOF _FEHL14
_SC_CHAN=""
_SC_CHAN_ST=""
IF(_CMD<>"")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,<<_CMD)
ENDIF
_HOCHKOMMA[0]=34
_POS=MATCH(_CMD,_HOCHKOMMA)
IF(_POS>0)
S_CHANI=SUBSTR(_CMD,_POS+1,10)
FOR _I=0 TO 9
IF(_CHANF[_I])AND((S_CHANI[_I]=="2")OR(S_CHANI[_I]=="4"))
IF($MN_ASSIGN_CHAN_TO_MODE_GROUP[_I]==0)
_ERR_STR=<<(_I+1)
GOTOF _FEHL17
ENDIF
IF(_SC_CHAN<>"")
_SC_CHAN=_SC_CHAN<<","
ENDIF
_SC_CHAN=_SC_CHAN<<(_I+1)
IF(_SC_CHAN_1==0)
_SC_CHAN_1=_I+1
ENDIF
ENDIF
IF(_CHANF[_I])AND(S_CHANI[_I]=="4")
IF(_SC_CHAN_ST<>"")
_SC_CHAN_ST=_SC_CHAN_ST<<","
ENDIF
_SC_CHAN_ST=_SC_CHAN_ST<<(_I+1)
ENDIF
ENDFOR
IF(STRLEN(_SC_CHAN)>0)AND(STRLEN(_SC_CHAN)<3)
_SC_CHAN=_SC_CHAN<<","<<_SC_CHAN
ENDIF
IF(STRLEN(_SC_CHAN_ST)>0)AND(STRLEN(_SC_CHAN_ST)<3)
_SC_CHAN_ST=_SC_CHAN_ST<<","<<_SC_CHAN_ST
ENDIF
ELSE
_SC_CHAN=""
FOR _I=0 TO 9
IF(_CHANF[_I])
IF($MN_ASSIGN_CHAN_TO_MODE_GROUP[_I]==0)
_ERR_STR=<<(_I+1)
GOTOF _FEHL17
ENDIF
IF(_SC_CHAN<>"")
_SC_CHAN=_SC_CHAN<<","
ENDIF
_SC_CHAN=_SC_CHAN<<(_I+1)
ENDIF
ENDFOR
_SC_CHAN_ST=_SC_CHAN
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"S_CHANI : "<<S_CHANI)
WRITE(_LOG,_LOG_FILE,"Jobliste: "<<_SC_CHAN)
WRITE(_LOG,_LOG_FILE,"1. Kanal: "<<_SC_CHAN_1)
WRITE(_LOG,_LOG_FILE,"ShopTurn: "<<_SC_CHAN_ST)
ENDIF
IF(_SC_FIRST_START==1)
_SC_FIRST_START=0
CUST_TECHCYC(160)
ENDIF
IF(_CMD<>"")
_POS=MATCH(_CMD,_HOCHKOMMA)
_FOUND=1
FOR _I=9 TO _POS
IF(_CMD[_I]==",")
_FOUND=_FOUND+1
ENDIF
ENDFOR
IF(_FOUND==46)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Version 4.7 vor SP5: "<<_CMD)
ENDIF
IF(SUBSTR(_CMD,_POS-2,2)==",,")
_CMD=SUBSTR(_CMD,0,_POS-2)<<SUBSTR(_CMD,_POS)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"     -> 4.5: "<<_CMD)
ENDIF
ENDIF
ENDIF
ENDIF
IF(_CMD<>"")
N100 EXECSTRING(_CMD)
ELSE
GOTOF _FEHL15
ENDIF
IF(_E_JS_PRG==0)
_FOUND=0
_I=8
_POS=0
WHILE(_FOUND<2)
IF(_CMD[_I]==",")
_FOUND=_FOUND+1
ENDIF
IF(_FOUND==2-1)AND(_POS==0)
_POS=_I+1
ENDIF
_I=_I+1
ENDWHILE
_VARI1=NUMBER(SUBSTR(_CMD,_POS,_I-_POS-1))
_FOUND=0
_I=8
_POS=0
WHILE(_FOUND<16)
IF(_CMD[_I]==",")
_FOUND=_FOUND+1
ENDIF
IF(_FOUND==16-1)AND(_POS==0)
_POS=_I+1
ENDIF
_I=_I+1
ENDWHILE
_VARI2=NUMBER(SUBSTR(_CMD,_POS,_I-_POS-1))
IF((_VARI1 _DEC1==1)AND(_VARI2 _DEC1==2))
CYCLE211(1)
CYCLE211(0)
ELSE
CYCLE211(0)
CYCLE211(1)
ENDIF
ENDIF
_SC_NCK_NPV[0]=-99
N300 EXECSTRING("WAITM(109,"<<_SC_CHAN<<")")
STOPRE
RET
_FILE_ERROR:
CASE _ERR OF 1 GOTOF _ERR_1 2 GOTOF _ERR_2 3 GOTOF _ERR_3 4 GOTOF _ERR_4 10 GOTOF _ERR_10 11 GOTOF _ERR_11 12 GOTOF _ERR_12 13 GOTOF _ERR_13 21 GOTOF _ERR_21 22 GOTOF _ERR_22 23 GOTOF _ERR_23 DEFAULT GOTOF _ERR_20
_ERR_1: GOTOF _FEHL1
_ERR_2: GOTOF _FEHL2
_ERR_3: GOTOF _FEHL3
_ERR_4: GOTOF _FEHL4
_ERR_10: GOTOF _FEHL5
_ERR_11: GOTOF _FEHL6
_ERR_12: GOTOF _FEHL7
_ERR_13: GOTOF _FEHL8
_ERR_20: GOTOF _FEHL9
_ERR_21: GOTOF _FEHL10
_ERR_22: GOTOF _FEHL11
_ERR_23: GOTOF _FEHL12
_FEHL1: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61030: Pfad nicht erlaubt: "<<_FILENAME2)
ENDIF
N720801 SETAL(61030,_FILENAME2)
RET
_FEHL2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61031: Pfad nicht gefunden: "<<_FILENAME2)
ENDIF
N720802 SETAL(61031,_FILENAME2)
RET
_FEHL3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61032: Datei nicht gefunden: "<<_FILENAME2)
ENDIF
N720803 SETAL(61032,_FILENAME2)
RET
_FEHL4: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61033: falscher Dateityp: "<<_FILENAME2)
ENDIF
N720804 SETAL(61033,_FILENAME2)
RET
_FEHL5: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61034: Datei ist voll: "<<_FILENAME2)
ENDIF
N720805 SETAL(61034,_FILENAME2)
RET
_FEHL6: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61035: Datei wird benutzt: "<<_FILENAME2)
ENDIF
N720806 SETAL(61035,_FILENAME2)
RET
_FEHL7: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61036: NC-Speichergrenze erreicht: "<<_FILENAME2)
ENDIF
N720807 SETAL(61036,_FILENAME2)
RET
_FEHL8: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61037: keine Zugriffsrechte auf Datei: "<<_FILENAME2)
ENDIF
N720808 SETAL(61037,_FILENAME2)
RET
_FEHL9: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Erreichen der NC-Speichergrenze fhrt zu einem sonstiger Dateifehler!")
WRITE(_LOG,_LOG_FILE,"Alarm 61036: NC-Speichergrenze erreicht: "<<_FILENAME2)
ENDIF
N720809 SETAL(61036,_FILENAME2)
RET
_FEHL10: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61039: Zeile nicht vorhanden: "<<_FILENAME2)
ENDIF
N720810 SETAL(61039,_FILENAME2)
RET
_FEHL11: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61040: Zeile lnger als Ergebnis-Variable: "<<_FILENAME2)
ENDIF
N720811 SETAL(61040,_FILENAME2)
RET
_FEHL12: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61041: Zeilenbereich zu gro: "<<_FILENAME2)
ENDIF
N720812 SETAL(61041,_FILENAME2)
RET
_FEHL13: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61045: Jobliste nicht gefunden: "<<_FILENAME2)
ENDIF
N720813 SETAL(61045,_FILENAME2)
RET
_FEHL14: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61046: Teileprogramm in Jobliste nicht gefunden: "<<_FILENAME2)
ENDIF
N720814 SETAL(61046,_FILENAME2)
RET
_FEHL15: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61048: Mehrkanaldaten in Jobliste nicht gefunden: "<<_FILENAME2)
ENDIF
N720815 SETAL(61048,_FILENAME2)
RET
_FEHL16: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61054: Programme aus verschiedenen Joblisten gestartet: "<<_ERR_STR)
ENDIF
N720816 SETAL(61054,_ERR_STR)
RET
_FEHL17: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61065: Ein in der Jobliste angegebener Kanal existiert nicht: "<<_ERR_STR)
ENDIF
N720817 SETAL(61065,_ERR_STR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE209_SPF
PROC CYCLE209(INT _MU,INT _VARI1,INT _NPV1,Rl _ZV1,INT _BL1,Rl _XA1,Rl _XI1,Rl _ZA1,Rl _ZI1,Rl _ZB1,INT _N1,Rl _L1,Rl _B1,Rl _H1,Rl _S1,INT _VARI2,INT _NPV2,Rl _ZV2,INT _BL2,Rl _XA2,Rl _XI2,Rl _ZA2,Rl _ZI2,Rl _ZB2,INT _N2,Rl _L2,Rl _B2,Rl _H2,Rl _S2,INT _VARI0,Rl _ZW,INT _MODE1,Rl S_ZC1,Rl S_ZS1,Rl S_ZE1,Rl S_XR1,Rl S_ZR1,INT _MODE2,Rl S_ZC2,Rl S_ZS2,Rl S_ZE2,Rl S_XR2,Rl S_ZR2,STRING[10] S_CHANI,Rl S_DUM1,Rl S_DUM2,Rl _YA1,Rl _YI1) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.94.00.00.004 ;DATE: 2020-03-25
;Cycle support HMIsl
;Multi channel data
DEF AXIS _ZZ,_Z2
DEF INT _NPV,_VARI,_BL,_N,_SP1,_SP2,_SP,_PM
DEF REAL _FAK1,_FAK2,_XA,_XI,_YA,_YI,_ZA,_ZI,_ZB,_L,_B,_H
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE209_MPF",_SERR
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
DEF STRING[1] _HOCHKOMMA=" "
_HOCHKOMMA[0]=34
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE209_MPF")
;DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,"CYCLE209("<<_MU<<","<<_VARI1<<","<<_NPV1<<","<<_ZV1<<","<<_BL1<<","<<_XA1<<","<<_XI1<<","<<_ZA1<<","<<_ZI1<<","<<_ZB1<<","<<_N1<<","<<_L1<<","<<_B1<<","<<_H1<<","<<_S1<<","<<_VARI2<<","<<_NPV2<<","<<_ZV2<<","<<_BL2<<","<<_XA2<<","<<_XI2<<","<<_ZA2<<","<<_ZI2<<","<<_ZB2<<","<<_N2<<","<<_L2<<","<<_B2<<","<<_H2<<","<<_S2<<","<<_VARI0<<","<<_ZW<<",")
WRITE(_TEMP,_TEMP_FILE,"         "<<_MODE1<<","<<S_ZC1<<","<<S_ZS1<<","<<S_ZE1<<","<<S_XR1<<","<<S_ZR1<<","<<_MODE2<<","<<S_ZC2<<","<<S_ZS2<<","<<S_ZE2<<","<<S_XR2<<","<<S_ZR2<<","<<_HOCHKOMMA<<S_CHANI<<_HOCHKOMMA<<","<<S_DUM1<<","<<S_DUM2<<","<<_YA1<<","<<_YI1<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE209_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
IF($P_GG[6]==1)
_ZZ=$P_AXN3
ELSE
IF($P_GG[6]==2)
_ZZ=$P_AXN1
ELSE
_ZZ=$P_AXN2
ENDIF
ENDIF
IF(_MU)
IF(_MU==70)
G70
ELSE
G71
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
CYCLE210(0)
IF(_VARI1 _DEC1==1)
_SP1=0
ELSE
IF(_VARI1 _DEC1==2)
_SP1=1
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
IF(_SP1==1)AND(NOT _F_AX_EXISTS[2]) GOTOF _FEHL6
IF(_NPV1<0)
IF(_SP1==0)
GOTOF _FEHL7
ELSE
GOTOF _FEHL8
ENDIF
ENDIF
_F_NPV[_SP1]=_NPV1
IF(NOT($MCS_FUNCTION_MASK_TECH B_AND 'H40'))
IF(_VARI1 _DEC2)
_F_NPV_SET[_SP1]=1
$P_UIFR[_NPV1,_ZZ,TR]=_ZV1/_FAK1
IF($MN_MM_FRAME_FINE_TRANS)
$P_UIFR[_NPV1,_ZZ,FI]=0
ENDIF
ENDIF
IF(_VARI1 _DEC2)OR($MN_SIM_ENVIRONMENT B_AND 'B100')
IF(_SP1==1)AND((_E_ST_PRG)OR((_VARI1 _DEC8)==0))
$P_UIFR[_NPV1,_ZZ,MI]=1
ELSE
$P_UIFR[_NPV1,_ZZ,MI]=0
ENDIF
ENDIF
ENDIF
CYCLE212(_SP1,_MODE1,S_ZC1,S_ZS1,S_ZE1,S_XR1,S_ZR1)
_SP=_SP1
IF(_BL1>=0)
_VARI=_VARI1
_BL=_BL1
_XA=_XA1
_XI=_XI1
_YA=_YA1
_YI=_YI1
_ZA=_ZA1
_ZI=_ZI1
_ZB=_ZB1
_N=_N1
_L=_L1
_B=_B1
_H=_H1
REPEAT _M_BL_A _M_BL_E
ENDIF
_NPV=_NPV1+1
G[8]=_NPV
IF(_SP1==0)
IF($P_UIFR[_NPV1,_ZZ,MI]) GOTOF _FEHL2
ELSE
IF((_E_ST_PRG)OR((_VARI1 _DEC8)==0))
IF(NOT $P_UIFR[_NPV1,_ZZ,MI]) GOTOF _FEHL3
ELSE
IF($P_UIFR[_NPV1,_ZZ,MI]) GOTOF _FEHL11
ENDIF
ENDIF
IF(_S1<=0)
IF(_SP1==0)
IF ($MCS_TECHNOLOGY==1)
GOTOF _FEHL9
ELSE
IF(_S1==0)
GOTOF _FEHL12
ENDIF
ENDIF
ELSE
GOTOF _FEHL10
ENDIF
ENDIF
IF(_S1>0)
G26 S[_F_S_NR[_SP1*2]]=_S1
LIMS[_F_S_NR[_SP1*2]]=_S1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G26 S"<<_F_S_NR[_SP1*2]<<"="<<_S1)
ENDIF
ENDIF
_SP2=-1
IF(_VARI2 _DEC1==1)
_SP2=0
ELSE
IF(_VARI2 _DEC1==2)AND(_F_AX_EXISTS[2])
_SP2=1
ENDIF
ENDIF
IF(_VARI2 _DEC1==3)
_SP2=1
ELSE
IF (_SP1==_SP2) GOTOF _FEHL5
ENDIF
IF(_SP2>=0)
IF(_VARI2 _DEC1==3)
_F_NPV[_SP2]=-1
ELSE
_F_NPV[_SP2]=_NPV2
IF(NOT($MCS_FUNCTION_MASK_TECH B_AND 'H40'))
IF(_VARI2 _DEC2)
_F_NPV_SET[_SP2]=1
$P_UIFR[_NPV2,_ZZ,TR]=_ZV2/_FAK1
IF($MN_MM_FRAME_FINE_TRANS)
$P_UIFR[_NPV2,_ZZ,FI]=0
ENDIF
ENDIF
IF(_VARI2 _DEC2)OR($MN_SIM_ENVIRONMENT B_AND 'B100')
IF(_SP2==1)AND((_E_ST_PRG)OR((_VARI2 _DEC8)==0))
$P_UIFR[_NPV2,_ZZ,MI]=1
ELSE
$P_UIFR[_NPV2,_ZZ,MI]=0
ENDIF
ENDIF
ENDIF
IF(_SP2==0)
IF($P_UIFR[_NPV2,_ZZ,MI]) GOTOF _FEHL2
ELSE
IF((_E_ST_PRG)OR((_VARI2 _DEC8)==0))
IF(NOT $P_UIFR[_NPV2,_ZZ,MI]) GOTOF _FEHL3
ELSE
IF($P_UIFR[_NPV2,_ZZ,MI]) GOTOF _FEHL11
ENDIF
IF(_E_ST_PRG)AND(_F_AX_EXISTS[3])
_Z2=_F_S_AX[3]
IF($P_ACTFRAME[_Z2,MI]) GOTOF _FEHL13
ENDIF
ENDIF
ENDIF
CYCLE212(_SP2,_MODE2,S_ZC2,S_ZS2,S_ZE2,S_XR2,S_ZR2)
_SP=_SP2
IF(_BL2>=0)
IF(_VARI2 _DEC1==3)
_VARI=_VARI1
_BL=_BL1
_XA=_XA1
_XI=_XI1
_YA=_YA1
_YI=_YI1
_ZA=_ZA1
_ZI=_ZI1
_ZB=_ZB1
_N=_N1
_L=_L1
_B=_B1
_H=_H1
ELSE
_VARI=_VARI2
_BL=_BL2
_XA=_XA2
_XI=_XI2
_ZA=_ZA2
_ZI=_ZI2
_ZB=_ZB2
_N=_N2
_L=_L2
_B=_B2
_H=_H2
ENDIF
REPEAT _M_BL_A _M_BL_E
ENDIF
IF(_S2<=0)
IF(_SP2==0)
GOTOF _FEHL9
ELSE
GOTOF _FEHL10
ENDIF
ENDIF
G26 S[_F_S_NR[_SP2*2]]=_S2
LIMS[_F_S_NR[_SP2*2]]=_S2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G26 S"<<_F_S_NR[_SP2*2]<<"="<<_S2)
ENDIF
ENDIF
_F_ZW=_SC_NO_VAL
IF((_VARI0 _DEC1)==1)
_F_ZW=_ZW/_FAK2
ENDIF
RET
_M_BL_A:
IF(_BL==3)
IF(_N<3)
GOTOF _FEHL1
ENDIF
IF((_VARI _DEC3)==0)AND((_N B_AND 1)==0)
_L=_L*TAN(180/_N)
ENDIF
_XA=_L/SIN(180/_N)
ENDIF
IF(_BL==4)
_XA=SQRT(_B*_B+_H*_H)
ENDIF
IF(_BL==5)
IF((_VARI _DEC4)==0)
_XI=_XA+_XI
ENDIF
IF((_VARI _DEC9)==0)
_YI=_YA+_YI
ENDIF
ELSE
_XA=_XA/2
IF((_VARI _DEC4)==0)
_XI=_XA-ABS(_XI)
ELSE
_XI=_XI/2
ENDIF
ENDIF
IF(_SP==1)AND((_VARI _DEC8)==1)
_E_RT[_SP,12]=1
ELSE
_E_RT[_SP,12]=0
ENDIF
_PM=2*_E_RT[_SP,12]-1
IF((_VARI _DEC5)==0)
_ZI=_ZA+_PM*ABS(_ZI)
ENDIF
IF((_VARI _DEC6)==0)
_ZB=_ZA+_PM*ABS(_ZB)
ENDIF
_E_RT[_SP,0]=_BL
_E_RT[_SP,1]=_XA/_FAK2
_E_RT[_SP,2]=_YA/_FAK2
_E_RT[_SP,3]=_ZA/_FAK2
_E_RT[_SP,4]=_XI/_FAK2
_E_RT[_SP,5]=_YI/_FAK2
_E_RT[_SP,6]=_ZI/_FAK2
_E_RT[_SP,7]=_ZB/_FAK2
_E_RT[_SP,8]=_N
_E_RT[_SP,9]=_L/_FAK2
_E_RT[_SP,10]=_B/_FAK2
_E_RT[_SP,11]=_H/_FAK2
IF(_LOG_ON)
IF(_SP==0)
WRITE(_LOG,_LOG_FILE,"Rohteil Hauptspindel: (Werte absolut und im Radius)")
ELSE
WRITE(_LOG,_LOG_FILE,"Rohteil Gegenspindel: (Werte absolut und im Radius)")
ENDIF
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,0] ="<<_E_RT[_SP,0]<<" ; Typ")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,1] ="<<_E_RT[_SP,1]<<" ; XA")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,2] ="<<_E_RT[_SP,2]<<" ; YA")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,3] ="<<_E_RT[_SP,3]<<" ; ZA")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,4] ="<<_E_RT[_SP,4]<<" ; XI")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,5] ="<<_E_RT[_SP,5]<<" ; YI")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,6] ="<<_E_RT[_SP,6]<<" ; ZI")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,7] ="<<_E_RT[_SP,7]<<" ; ZB")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,8] ="<<_E_RT[_SP,8]<<" ; N")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,9] ="<<_E_RT[_SP,9]<<" ; L")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,10]="<<_E_RT[_SP,10]<<" ; B")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,11]="<<_E_RT[_SP,11]<<" ; H")
WRITE(_LOG,_LOG_FILE,"  _E_RT[SP,12]="<<_E_RT[_SP,12]<<" ; 1=ohne Spiegelung GSP")
ENDIF
_M_BL_E:
_FEHL1: STOPRE
N720901 SETAL(61296)
RET
_FEHL2: STOPRE
N720902 SETAL(61614,<<AXSTRING(_ZZ))
RET
_FEHL3:STOPRE
N720903 SETAL(61280,<<AXSTRING(_ZZ))
RET
_FEHL4: STOPRE
N720904 SETAL(61049)
RET
_FEHL5: STOPRE
N720905 SETAL(61050)
RET
_FEHL6: STOPRE
N720906 SETAL(61289)
RET
_FEHL7:STOPRE
N720907 SETAL(61298)
RET
_FEHL8:STOPRE
N720908 SETAL(61299)
RET
_FEHL9:STOPRE
N720909 SETAL(61052)
RET
_FEHL10:STOPRE
N720910 SETAL(61053)
RET
_FEHL11:STOPRE
N720911 SETAL(61615,<<AXSTRING(_ZZ))
RET
_FEHL12:STOPRE
N720912 SETAL(61617)
RET
_FEHL13:STOPRE
N720913 SETAL(61620,<<AXSTRING(_Z2))
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE210_SPF
PROC CYCLE210(INT _MODE) PREPRO SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.009 ;DATE: 2024-05-22
;Cycle support HMIsl
;Analyse machine configuration
DEF INT _I,_J,_J2,_J3,_INT,_INT2,_PLANE,_WS_CINV,_HS_CINV,_GS_CINV,_KODIR[48],S_TRA_NO,_M3_CM
DEF INT S_TRAFO_ROT[8]=SET(3,2,1,1,2,3,0,0)
DEF INT S_GEO_TRACYL[8]=SET(19,17,18,17,19,18,0,0)
DEF INT S_GEO_TRANSMIT[8]=SET(17,18,19,19,18,17,0,0)
DEF REAL S_OFF_B
DEF STRING[10] S_TECH[4]=SET("TURN","MILL","GRIND_CYL","GRIND_FACE")
DEF STRING[8] S_TRAFO[6]=SET("","TRAORI","TRANSMIT","TRACYL","TRAANG","TRACON")
DEF STRING[30] S_STRAL
DEF STRING[200] _STR
DEF STRING[255] S_STR[1]
DEF CHAR _QUOT=34
DEF AXIS _AX
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE210_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_MODE==0)AND(_F_MCONF[0]==0)
_F_MCONF[0]=1
_F_MCONF[1]=1
_M_INIT_BEGIN:
IF(_LOG_ON)
IF(_MODE==0)
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
READ(_LOG,"/_N_CST_DIR/_N_CYCLE210_SPF",2,1,S_STR)
WRITE(_LOG,_LOG_FILE,S_STR[0])
WRITE(_LOG,_LOG_FILE,"NCK-Version: "<<$AN_NCK_VERSION)
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[0])
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[1])
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[2])
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[3])
IF($ON_NUM_CHANNELS>1)
WRITE(_LOG,_LOG_FILE,"$ON_NUM_CHANNELS="<<$ON_NUM_CHANNELS)
FOR _J=0 TO 9
_INT=$MN_ASSIGN_CHAN_TO_MODE_GROUP[_J]
IF(_INT>0)
WRITE(_LOG,_LOG_FILE,"  $MN_ASSIGN_CHAN_TO_MODE_GROUP["<<_J<<"]="<<_INT)
ENDIF
ENDFOR
ENDIF
_INT=$MCS_TECHNOLOGY
IF(_INT>=1)AND(_I<=4)
WRITE(_LOG,_LOG_FILE,"$MCS_TECHNOLOGY="<<_INT<<" ("<<S_TECH[_INT-1]<<")")
ELSE
WRITE(_LOG,_LOG_FILE,"$MCS_TECHNOLOGY="<<_INT)
ENDIF
_INT=$MCS_TECHNOLOGY_EXTENSION
IF(_INT>=1)AND(_I<=4)
WRITE(_LOG,_LOG_FILE,"$MCS_TECHNOLOGY_EXTENSION="<<_INT<<" ("<<S_TECH[_INT-1]<<")")
ELSE
WRITE(_LOG,_LOG_FILE,"$MCS_TECHNOLOGY_EXTENSION="<<_INT)
ENDIF
_INT=$MCS_DISP_COORDINATE_SYSTEM
WRITE(_LOG,_LOG_FILE,"$MCS_DISP_COORDINATE_SYSTEM="<<_INT)
_INT=$MCS_DISP_COORDINATE_SYSTEM_2
WRITE(_LOG,_LOG_FILE,"$MCS_DISP_COORDINATE_SYSTEM_2="<<_INT)
WRITE(_LOG,_LOG_FILE,"")
_INT=$MCS_FUNCTION_MASK_DISP
WRITE(_LOG,_LOG_FILE,"$MCS_FUNCTION_MASK_DISP ="<<SPRINT("%X",_INT)<<"H")
_INT=$MCS_FUNCTION_MASK_TECH
WRITE(_LOG,_LOG_FILE,"$MCS_FUNCTION_MASK_TECH ="<<SPRINT("%X",_INT)<<"H")
_INT=$MCS_FUNCTION_MASK_MILL
WRITE(_LOG,_LOG_FILE,"$MCS_FUNCTION_MASK_MILL ="<<SPRINT("%X",_INT)<<"H")
_INT=$MCS_FUNCTION_MASK_DRILL
WRITE(_LOG,_LOG_FILE,"$MCS_FUNCTION_MASK_DRILL="<<SPRINT("%X",_INT)<<"H")
_INT=$MCS_FUNCTION_MASK_TURN
WRITE(_LOG,_LOG_FILE,"$MCS_FUNCTION_MASK_TURN ="<<SPRINT("%X",_INT)<<"H")
WRITE(_LOG,_LOG_FILE,"")
FOR _J=0 TO S_AXES_PER_CHAN-1
_INT=$MCS_AXIS_USAGE[_J]
WRITE(_LOG,_LOG_FILE,"$MCS_AXIS_USAGE["<<_J<<"]="<<_INT)
ENDFOR
WRITE(_LOG,_LOG_FILE,"")
FOR _J=0 TO S_AXES_PER_CHAN-1
_INT=$MCS_AXIS_USAGE_ATTRIB[_J]
WRITE(_LOG,_LOG_FILE,"$MCS_AXIS_USAGE_ATTRIB["<<_J<<"]="<<SPRINT("%X",_INT)<<"H")
ENDFOR
WRITE(_LOG,_LOG_FILE,"")
ENDIF
FOR _J=0 TO S_AXES_PER_CHAN-1
_INT=$MC_AXCONF_MACHAX_USED[_J]
IF(_INT)
IF(STRINGIS($MC_AXCONF_CHANAX_NAME_TAB[_J])<>201)
S_STRAL="MD 10000["<<(_INT-1)<<"] <-> MD 20080["<<_J<<"]"
GOTOF _FEHL18
ENDIF
ENDIF
ENDFOR
FOR _J=0 TO 11
_F_AX_EXISTS[_J]=FALSE
_F_AX_NR[_J]=0
ENDFOR
FOR _J=0 TO S_AXES_PER_CHAN-1
IF(_F_AX_EXISTS[0]==FALSE)AND($MCS_AXIS_USAGE[_J]==3)
_F_AX_EXISTS[0]=TRUE
_F_AX_NR[0]=_J+1
ENDIF
IF(_F_AX_EXISTS[1]==FALSE)AND($MCS_AXIS_USAGE[_J]==1)
_F_AX_EXISTS[1]=TRUE
_F_AX_NR[1]=_J+1
ENDIF
IF(_F_AX_EXISTS[2]==FALSE)AND($MCS_AXIS_USAGE[_J]==5)
_F_AX_EXISTS[2]=TRUE
_F_AX_NR[2]=_J+1
ENDIF
IF(_F_AX_EXISTS[3]==FALSE)AND($MCS_AXIS_USAGE[_J]==7)
_F_AX_EXISTS[3]=TRUE
_F_AX_NR[3]=_J+1
ENDIF
IF(_F_AX_EXISTS[4]==FALSE)AND($MCS_AXIS_USAGE[_J]==4)
_F_AX_EXISTS[4]=TRUE
_F_AX_NR[4]=_J+1
ENDIF
IF(_F_AX_EXISTS[5]==FALSE)AND($MCS_AXIS_USAGE[_J]==6)
_F_AX_EXISTS[5]=TRUE
_F_AX_NR[5]=_J+1
ENDIF
IF(_F_AX_EXISTS[6]==FALSE)AND($MCS_AXIS_USAGE[_J]==10)AND($MCS_FUNCTION_MASK_TECH B_AND 'H01')
_F_AX_EXISTS[6]=TRUE
_F_AX_NR[6]=_J+1
ENDIF
IF(_F_AX_EXISTS[7]==FALSE)AND($MCS_AXIS_USAGE[_J]==11)AND($MCS_FUNCTION_MASK_TECH B_AND 'H01')
_F_AX_EXISTS[7]=TRUE
_F_AX_NR[7]=_J+1
ENDIF
IF(_F_AX_EXISTS[8]==FALSE)AND($MCS_AXIS_USAGE[_J]==12)AND($MCS_FUNCTION_MASK_TECH B_AND 'H01')
_F_AX_EXISTS[8]=TRUE
_F_AX_NR[8]=_J+1
ENDIF
IF(_F_AX_EXISTS[9]==FALSE)AND($MCS_AXIS_USAGE[_J]==13)
_F_AX_EXISTS[9]=TRUE
_F_AX_NR[9]=_J+1
ENDIF
IF(_F_AX_EXISTS[10]==FALSE)AND($MCS_AXIS_USAGE[_J]==8)
_F_AX_EXISTS[10]=TRUE
_F_AX_NR[10]=_J+1
ENDIF
IF(_F_AX_EXISTS[11]==FALSE)AND($MCS_AXIS_USAGE[_J]==9)
_F_AX_EXISTS[11]=TRUE
_F_AX_NR[11]=_J+1
ENDIF
ENDFOR
IF(_LOG_ON)
FOR _J=0 TO 11
WRITE(_LOG,_LOG_FILE,"_F_AX_EXISTS["<<_J<<"]="<<SPRINT("%B",_F_AX_EXISTS[_J]))
ENDFOR
WRITE(_LOG,_LOG_FILE,"")
ENDIF
_M_INIT_END:
IF($MC_SPIND_ASSIGN_TAB_ENABLE)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindelumsetzer aktiv:")
FOR _J=1 TO 20
IF($SC_SPIND_ASSIGN_TAB[_J]>0)
_J2=0
_I=0
WHILE(_J2<S_AXES_PER_CHAN)AND(_I==0)
IF($MC_AXCONF_MACHAX_USED[_J2])
_AX=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_J2])
IF($MA_SPIND_ASSIGN_TO_MACHAX[_AX]==$SC_SPIND_ASSIGN_TAB[_J])
_I=$MA_SPIND_ASSIGN_TO_MACHAX[_AX]
ELSE
_J2=_J2+1
ENDIF
ELSE
_J2=_J2+1
ENDIF
ENDWHILE
IF(_I>0)
WRITE(_LOG,_LOG_FILE,"  S"<<_J<<" -> S"<<_I<<" AX"<<_J2+1<<":"<<$MC_AXCONF_CHANAX_NAME_TAB[_J2])
ENDIF
ENDIF
ENDFOR
WRITE(_LOG,_LOG_FILE,"")
ENDIF
ENDIF
IF($MC_AXCONF_GEOAX_ASSIGN_TAB[0]>0)
FOR _J=0 TO 6
_F_S_AX[_J]=NO_AXIS
_F_S_STR[_J]=""
ENDFOR
ENDIF
_M_SPIND_BEGIN:
FOR _J=0 TO 2
_F_S_NR[_J]=0
ENDFOR
IF(_F_AX_EXISTS[0])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[0]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[0]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Hauptspindel ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[0]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[0]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[0]-1<<"]=0")
ENDIF
ENDIF
IF ($MCS_TECHNOLOGY==1)
GOTOF _FEHL6
ENDIF
IF ($MCS_TECHNOLOGY==2)
GOTOF _FEHL14
ENDIF
ENDIF
_F_S_AX[0]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[0]-1])
_F_S_AX[5]=_F_S_AX[0]
_F_S_NR[0]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[0]]
_F_MA_AX_NR[0]=$MC_AXCONF_MACHAX_USED[_F_AX_NR[0]-1]
IF(_F_AX_EXISTS[4])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[4]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[4]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: C-Achse der Hauptspindel ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[4]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[4]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[4]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL7
ENDIF
_F_S_AX[0]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[4]-1])
ENDIF
_F_S_STR[0]=AXSTRING(_F_S_AX[0])
_F_S_STR[5]=AXSTRING(_F_S_AX[5])
ELSE
IF($MCS_TECHNOLOGY==1)
_INT=0
FOR _J=0 TO S_AXES_PER_CHAN-1
IF($MC_AXCONF_MACHAX_USED[_J])
_AX=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_J])
IF($MA_SPIND_ASSIGN_TO_MACHAX[_AX])
IF(_INT==0)
_INT=_J+1
ELSE
_INT=-1
ENDIF
ENDIF
ENDIF
ENDFOR
IF(_INT>0)
_F_AX_EXISTS[0]=1
_F_AX_NR[0]=_INT
_F_MA_AX_NR[0]=$MC_AXCONF_MACHAX_USED[_F_AX_NR[0]-1]
_F_S_AX[0]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[0]-1])
_F_S_AX[5]=_F_S_AX[0]
_F_S_NR[0]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[0]]
_F_S_STR[0]=AXSTRING(_F_S_AX[0])
_F_S_STR[5]=AXSTRING(_F_S_AX[5])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"HSP S"<<_F_S_NR[0]<<": AX"<<_F_AX_NR[0]<<" ("<<_F_S_STR[0]<<") Drehmaschine mit nur 1 Spindel")
ENDIF
ENDIF
ENDIF
IF(_F_AX_EXISTS[0]==0)
IF($MCS_TECHNOLOGY==1)
GOTOF _FEHL1
ENDIF
IF($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1)AND(_MODE==2)AND(_F_AX_EXISTS[2]==0)
GOTOF _FEHL13
ENDIF
ENDIF
ENDIF
IF(_F_AX_EXISTS[0])
IF(_F_S_NR[0]==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"HSP S"<<_F_S_NR[0])
ENDIF
IF($MCS_TECHNOLOGY==1)
GOTOF _FEHL6
ENDIF
IF($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1)AND(_MODE==2)AND(_F_S_NR[2]==0)
GOTOF _FEHL14
ENDIF
ENDIF
ENDIF
IF(NOT _F_AX_EXISTS[4])
_F_AX_NR[4]=_F_AX_NR[0]
ENDIF
IF(_LOG_ON)
IF(_F_AX_EXISTS[4])
WRITE(_LOG,_LOG_FILE,"HSP S"<<_F_S_NR[0]<<": "<<_F_S_STR[5]<<"  AX"<<_F_AX_NR[0]<<" M-AX"<<_F_MA_AX_NR[0]<<" ("<<_F_S_STR[0]<<"=AX"<<_F_AX_NR[4]<<")")
ELSE
WRITE(_LOG,_LOG_FILE,"HSP S"<<_F_S_NR[0]<<": AX"<<_F_AX_NR[0]<<" M-AX"<<_F_MA_AX_NR[0]<<" ("<<_F_S_STR[0]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[1])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[1]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[1]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Werkzeugspindel ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[1]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[1]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[1]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL10
ENDIF
_F_S_AX[1]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[1]-1])
_F_S_NR[1]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[1]]
_F_S_STR[1]=AXSTRING(_F_S_AX[1])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WSP S"<<_F_S_NR[1]<<": AX"<<_F_AX_NR[1]<<" ("<<_F_S_STR[1]<<")")
ENDIF
ELSE
IF($MCS_TECHNOLOGY==2)
_INT=0
FOR _J=0 TO S_AXES_PER_CHAN-1
IF($MC_AXCONF_MACHAX_USED[_J])
_AX=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_J])
IF($MA_SPIND_ASSIGN_TO_MACHAX[_AX])
IF(_INT==0)
_INT=_J+1
ELSE
_INT=-1
ENDIF
ENDIF
ENDIF
ENDFOR
IF(_INT>0)
_F_AX_EXISTS[1]=1
_F_AX_NR[1]=_INT
_F_S_AX[1]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[1]-1])
_F_S_NR[1]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[1]]
_F_S_STR[1]=AXSTRING(_F_S_AX[1])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WSP S"<<_F_S_NR[1]<<": AX"<<_F_AX_NR[1]<<" ("<<_F_S_STR[1]<<") Fraesmaschine mit nur 1 Spindel")
ENDIF
ENDIF
ENDIF
IF($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1)AND(_MODE==2)
GOTOF _FEHL3
ENDIF
ENDIF
IF(_F_AX_EXISTS[2])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[2]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[2]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Gegenspindel ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[2]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[2]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[2]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL8
ENDIF
_F_S_AX[2]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[2]-1])
_F_S_AX[6]=_F_S_AX[2]
_F_S_NR[2]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[2]]
_F_MA_AX_NR[2]=$MC_AXCONF_MACHAX_USED[_F_AX_NR[2]-1]
IF(_F_S_NR[2]==0)
GOTOF _FEHL8
ENDIF
IF(_F_AX_EXISTS[5])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[5]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[5]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: C-Achse der Gegenspindel ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[5]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[5]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[5]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL9
ENDIF
_F_S_AX[2]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[5]-1])
ENDIF
_F_S_STR[2]=AXSTRING(_F_S_AX[2])
_F_S_STR[6]=AXSTRING(_F_S_AX[6])
IF(NOT _F_AX_EXISTS[5])
_F_AX_NR[5]=_F_AX_NR[2]
ENDIF
IF(NOT _F_AX_EXISTS[3])
ENDIF
IF(_LOG_ON)
IF(_F_AX_EXISTS[5])
WRITE(_LOG,_LOG_FILE,"GSP S"<<_F_S_NR[2]<<": "<<_F_S_STR[6]<<" AX"<<_F_AX_NR[2]<<" M-AX"<<_F_MA_AX_NR[2]<<" ("<<_F_S_STR[2]<<"=AX"<<_F_AX_NR[5]<<")")
ELSE
WRITE(_LOG,_LOG_FILE,"GSP S"<<_F_S_NR[2]<<": AX"<<_F_AX_NR[2]<<" M-AX"<<_F_MA_AX_NR[2]<<" ("<<_F_S_STR[2]<<")")
ENDIF
ENDIF
ENDIF
IF(_F_AX_EXISTS[3])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[3]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[3]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Linearachse der Gegenspindel ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[3]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[3]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[3]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL11
ENDIF
_F_S_AX[3]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[3]-1])
_F_S_STR[3]=AXSTRING(_F_S_AX[3])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lin.Achse GSP: AX"<<_F_AX_NR[3]<<" ("<<_F_S_STR[3]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[6])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[6]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[6]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: B-Achse ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[6]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[6]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[6]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL12
ENDIF
_F_S_AX[4]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[6]-1])
_F_S_STR[4]=AXSTRING(_F_S_AX[4])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"B-Achse: AX"<<_F_AX_NR[6]<<" ("<<_F_S_STR[4]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[7])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[7]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[7]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: B-Achse (HSP) ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[7]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[7]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[7]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL12
ENDIF
_F_S_AX[7]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[7]-1])
_F_S_STR[7]=AXSTRING(_F_S_AX[7])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"B-Achse: AX"<<_F_AX_NR[7]<<" ("<<_F_S_STR[7]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[8])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[8]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[8]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: B-Achse (GSP) ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[8]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[8]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[8]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL12
ENDIF
_F_S_AX[8]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[8]-1])
_F_S_STR[8]=AXSTRING(_F_S_AX[8])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"B-Achse: AX"<<_F_AX_NR[8]<<" ("<<_F_S_STR[8]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[9])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[9]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[9]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Querhub (GSP) ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[9]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[9]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[9]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL11
ENDIF
_F_S_AX[9]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[9]-1])
_F_S_STR[9]=AXSTRING(_F_S_AX[9])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"B-Achse: AX"<<_F_AX_NR[9]<<" ("<<_F_S_STR[9]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[10])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[10]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[10]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Reitstock ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[10]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[10]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[10]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL11
ENDIF
_F_S_AX[10]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[10]-1])
_F_S_STR[10]=AXSTRING(_F_S_AX[10])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"B-Achse: AX"<<_F_AX_NR[10]<<" ("<<_F_S_STR[10]<<")")
ENDIF
ENDIF
IF(_F_AX_EXISTS[11])
IF(($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[11]-1]=="")OR($MC_AXCONF_MACHAX_USED[_F_AX_NR[11]-1]==0))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm: Reitstock ist nicht korrekt eingerichtet")
IF($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[11]-1]=="")
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_CHANAX_NAME_TAB["<<_F_AX_NR[11]-1<<"]=leer")
ELSE
WRITE(_LOG,_LOG_FILE,"$MC_AXCONF_MACHAX_USED["<<_F_AX_NR[11]-1<<"]=0")
ENDIF
ENDIF
GOTOF _FEHL11
ENDIF
_F_S_AX[11]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[11]-1])
_F_S_STR[11]=AXSTRING(_F_S_AX[11])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"B-Achse: AX"<<_F_AX_NR[11]<<" ("<<_F_S_STR[11]<<")")
ENDIF
ENDIF
_M_SPIND_END:
_KODIR[0 ]=SET( 1,-1,-1 ,1,-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1)
_KODIR[24]=SET(-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1, 1,-1,-1, 1)
_SC_KODIR=_KODIR[$MCS_DISP_COORDINATE_SYSTEM]
IF(_LOG_ON)
_INT=$MCS_DISP_COORDINATE_SYSTEM
WRITE(_LOG,_LOG_FILE,"")
WRITE(_LOG,_LOG_FILE,"KO-System: "<<_INT<<" Dir="<<_SC_KODIR)
ENDIF
IF(_F_AX_EXISTS[0])
_HS_CINV=($MCS_AXIS_USAGE_ATTRIB[_F_AX_NR[0]-1] B_AND'B1000')/'B1000'
_F_C_DIR[0]=_KODIR[$MCS_DISP_COORDINATE_SYSTEM]*(2*_HS_CINV-1)
_M3_CM=($MCS_AXIS_USAGE_ATTRIB[_F_AX_NR[0]-1] B_AND'B100000')/'B100000'
IF(_HS_CINV==_M3_CM)
S_INV_S_MID[0]=1
ELSE
S_INV_S_MID[0]=0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"HSP: "<<_F_S_STR[0]<<"-Dir="<<_F_C_DIR[0])
WRITE(_LOG,_LOG_FILE,"HSP: S_INV_S_MID[0]="<<S_INV_S_MID[0])
ENDIF
ENDIF
IF(_F_AX_EXISTS[1])
_WS_CINV=($MCS_AXIS_USAGE_ATTRIB[_F_AX_NR[1]-1] B_AND'B1000')/'B1000'
_E_C_DIR=_KODIR[$MCS_DISP_COORDINATE_SYSTEM]*(2*_WS_CINV-1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WSP: "<<_F_S_STR[1]<<"-Dir="<<_E_C_DIR)
ENDIF
ELSE
_WS_CINV=0
_E_C_DIR=1
ENDIF
IF(_F_AX_EXISTS[0])
S_INV_S_IPT=S_INV_S_MID[0]
ELSE
S_INV_S_IPT=1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WSP: S_INV_S_IPT="<<S_INV_S_IPT)
ENDIF
IF(_F_AX_EXISTS[2])
_GS_CINV=($MCS_AXIS_USAGE_ATTRIB[_F_AX_NR[2]-1] B_AND'B1000')/'B1000'
_F_C_DIR[1]=-_KODIR[$MCS_DISP_COORDINATE_SYSTEM]*(2*_GS_CINV-1)
_M3_CM=($MCS_AXIS_USAGE_ATTRIB[_F_AX_NR[2]-1] B_AND'B100000')/'B100000'
IF(_GS_CINV==_M3_CM)
S_INV_S_MID[1]=1
ELSE
S_INV_S_MID[1]=0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"GSP: "<<_F_S_STR[2]<<"-Dir="<<_F_C_DIR[1])
WRITE(_LOG,_LOG_FILE,"GSP: S_INV_S_MID[1]="<<S_INV_S_MID[1])
ENDIF
ELSE
_F_C_DIR[1]=1
ENDIF
_SC_ROT_AX[0,0]=REP(0)
FOR _J=0 TO S_AXES_PER_CHAN-1
IF($MC_AXCONF_MACHAX_USED[_J])
_AX=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_J])
IF($MA_IS_ROT_AX[_AX])
_STR="_INT=$MCS_AXIS_USAGE_ATTRIB["<<_J<<"]"
EXECSTRING(_STR)
IF(_INT B_AND 'B10000000')
IF(_INT B_AND 'H1C00')
IF(_INT B_AND 'H0400')
_SC_ROT_AX[0,0]=_SC_ROT_AX[0,0]+1
_SC_ROT_AX[_SC_ROT_AX[0,0],0]=_J+1
ELSE
IF(_INT B_AND 'H0800')
_SC_ROT_AX[0,1]=_SC_ROT_AX[0,1]+1
_SC_ROT_AX[_SC_ROT_AX[0,1],1]=_J+1
ELSE
IF(_INT B_AND 'H1000')
_SC_ROT_AX[0,2]=_SC_ROT_AX[0,2]+1
_SC_ROT_AX[_SC_ROT_AX[0,2],2]=_J+1
ENDIF
ENDIF
ENDIF
ELSE
IF(_INT B_AND 'B001')
_SC_ROT_AX[0,0]=_SC_ROT_AX[0,0]+1
_SC_ROT_AX[_SC_ROT_AX[0,0],0]=_J+1
ELSE
IF(_INT B_AND 'B010')
_SC_ROT_AX[0,1]=_SC_ROT_AX[0,1]+1
_SC_ROT_AX[_SC_ROT_AX[0,1],1]=_J+1
ELSE
IF(_INT B_AND 'B100')
_SC_ROT_AX[0,2]=_SC_ROT_AX[0,2]+1
_SC_ROT_AX[_SC_ROT_AX[0,2],2]=_J+1
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Rundachsen fr Positionsmuster:")
FOR _J2=0 TO 2
_STR="  um "<<SUBSTR("XYZ",_J2,1)<<": "
FOR _J=1 TO S_AXES_PER_CHAN
IF(_J<=_SC_ROT_AX[0,_J2])
_STR=_STR<<$MC_AXCONF_CHANAX_NAME_TAB[_SC_ROT_AX[_J,_J2]-1]<<"("<<_SC_ROT_AX[_J,_J2]<<") "
ENDIF
ENDFOR
WRITE(_LOG,_LOG_FILE,_STR)
ENDFOR
ENDIF
_SC_CHUCK[0,0]=REP(0)
_I=1
IF($MCS_FUNCTION_MASK_MILL B_AND 'B10')
_SC_CHUCK[0,0]=1
ENDIF
FOR _J=0 TO S_AXES_PER_CHAN-1
IF($MC_AXCONF_MACHAX_USED[_J])
_AX=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_J])
IF($MA_IS_ROT_AX[_AX])
_STR="_INT=$MCS_AXIS_USAGE_ATTRIB["<<_J<<"]"
EXECSTRING(_STR)
IF(_INT B_AND 'B100000000')
_SC_CHUCK[_I,0]=_J+1
IF(_INT B_AND 'B001')
_SC_CHUCK[_I,1]=1
ELSE
IF(_INT B_AND 'B010')
_SC_CHUCK[_I,1]=2
ELSE
_SC_CHUCK[_I,1]=3
ENDIF
ENDIF
_I=_I+1
ENDIF
ENDIF
ENDIF
ENDFOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Rohteilaufnahmen:")
IF(_SC_CHUCK[0,0])
WRITE(_LOG,_LOG_FILE,"  Tisch (fest)")
ENDIF
FOR _J=1 TO 20
IF(_SC_CHUCK[_J,0])
WRITE(_LOG,_LOG_FILE,"  Rundachse "<<$MC_AXCONF_CHANAX_NAME_TAB[_SC_CHUCK[_J,0]-1]<<"("<<_SC_CHUCK[_J,0]<<"): dreht um "<<SUBSTR("XYZ",_SC_CHUCK[_J,1]-1,1))
ENDIF
ENDFOR
ENDIF
_SC_TRACYL[0,0]=REP(0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRACYL:")
ENDIF
FOR _J=1 TO $MN_MM_NUM_KIN_TRAFOS
IF(($NT_TRAFO_TYPE[_J]<>"")AND($NT_NAME[_J]<>""))
IF($NT_TRAFO_INDEX[_J] _DEC1==3)
IF(($NT_TRAFO_INDEX[_J] _DEC4)+10*($NT_TRAFO_INDEX[_J] _DEC5)==$P_CHANNO)
_I=($NT_TRAFO_INDEX[_J] _DEC2)+10*($NT_TRAFO_INDEX[_J] _DEC3)
IF(_I>0)AND(_I<=99)
IF(_SC_TRACYL[_I-1,0]==0)
_INT=$NT_CNTRL[_J] B_AND 'H600'
IF(_INT B_AND 'H400' == 0)
IF(_INT B_AND 'H200' == 0)
_SC_TRACYL[_I-1,0]=512
ELSE
_SC_TRACYL[_I-1,0]=513
ENDIF
ELSE
_SC_TRACYL[_I-1,0]=514
ENDIF
_SC_TRACYL[_I-1,3]=_J+1000
_INT=($NT_CNTRL[_J] B_AND 'H70000')/'H10000'
_SC_TRACYL[_I-1,1]=S_TRAFO_ROT[_INT]
_INT=($NT_CNTRL[_J] B_AND 'H70000')/'H10000'
_SC_TRACYL[_I-1,2]=S_GEO_TRACYL[_INT]
ENDIF
IF(_LOG_ON)
_STR="  Trafo "<<_SC_TRACYL[_I-1,3]<<" = TRACYL_K "<<_I<<": "<<_SC_TRACYL[_I-1,0]
IF(_SC_TRACYL[_I-1,1]>0)
IF(_SC_TRACYL[_I-1,1]<=3)
_STR=_STR<<" (um "<<$MC_AXCONF_GEOAX_NAME_TAB[_SC_TRACYL[_I-1,1]-1]
ELSE
_STR=_STR<<" (schraege Achse)"
ENDIF
ENDIF
_STR=_STR<<" G"<<_SC_TRACYL[_I-1,2]<<")"
_STR=_STR<<" "<<$NT_NAME[_J]
WRITE(_LOG,_LOG_FILE,_STR)
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  ACHTUNG: Index bei TRACYL_K["<<_J<<"] falsch: "<<_I)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
_I=0
FOR _J=1 TO 20
_STR="_INT=ISVAR("<<_QUOT<<"$MC_TRAFO_TYPE_"<<_J<<_QUOT<<")"
EXECSTRING(_STR)
IF(_INT)
_STR="_INT=$MC_TRAFO_TYPE_"<<_J
EXECSTRING(_STR)
IF(_INT>=512)AND(_INT<=1023)AND(_I<2)
IF(_SC_TRACYL[_I,0]==0)
_SC_TRACYL[_I,0]=_INT
_SC_TRACYL[_I,3]=_J
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[2]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_SC_TRACYL[_I,1]=_J2+1
ENDIF
ENDFOR
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[0]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_SC_TRACYL[_I,2]=19-_J2
ENDIF
ENDFOR
IF(_LOG_ON)
_STR="  Trafo "<<_J<<" = TRACYL "<<_I+1<<": "<<_SC_TRACYL[_I,0]
IF(_SC_TRACYL[_I,1]>0)
_STR=_STR<<" (um "<<$MC_AXCONF_GEOAX_NAME_TAB[_SC_TRACYL[_I,1]-1]<<" "
ELSE
_STR=_STR<<" ("
ENDIF
_STR=_STR<<"G"<<_SC_TRACYL[_I,2]<<")"
WRITE(_LOG,_LOG_FILE,_STR)
ENDIF
_I=_I+1
ENDIF
ENDIF
ENDIF
ENDFOR
_SC_TRANSM[0,0]=REP(0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRANSMIT:")
ENDIF
FOR _J=1 TO $MN_MM_NUM_KIN_TRAFOS
IF(($NT_TRAFO_TYPE[_J]<>"")AND($NT_NAME[_J]<>""))
IF($NT_TRAFO_INDEX[_J] _DEC1==2)
IF(($NT_TRAFO_INDEX[_J] _DEC4)+10*($NT_TRAFO_INDEX[_J] _DEC5)==$P_CHANNO)
_I=($NT_TRAFO_INDEX[_J] _DEC2)+10*($NT_TRAFO_INDEX[_J] _DEC3)
IF(_I>0)AND(_I<=2)
IF(_SC_TRANSM[_I-1,0]==0)
_INT=$NT_CNTRL[_J] B_AND 'H600'
IF(_INT B_AND 'H200' == 0)
_SC_TRANSM[_I-1,0]=256
ELSE
_SC_TRANSM[_I-1,0]=257
ENDIF
_SC_TRANSM[_I-1,3]=_J+1000
_INT=($NT_CNTRL[_J] B_AND 'H70000')/'H10000'
_SC_TRANSM[_I-1,1]=S_TRAFO_ROT[_INT]
_INT=($NT_CNTRL[_J] B_AND 'H70000')/'H10000'
_SC_TRANSM[_I-1,2]=S_GEO_TRANSMIT[_INT]
ENDIF
IF(_LOG_ON)
_STR="  Trafo "<<_SC_TRANSM[_I-1,3]<<" = TRANSMIT_K "<<_I<<": "<<_SC_TRANSM[_I-1,0]
IF(_SC_TRANSM[_I-1,1]>0)
_STR=_STR<<" (um "<<$MC_AXCONF_GEOAX_NAME_TAB[_SC_TRANSM[_I-1,1]-1]<<" "
ELSE
_STR=_STR<<" ("
ENDIF
_STR=_STR<<"G"<<_SC_TRANSM[_I-1,2]<<")"
_STR=_STR<<" "<<$NT_NAME[_J]
WRITE(_LOG,_LOG_FILE,_STR)
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  ACHTUNG: Index bei TRANSMIT_K["<<_J<<"] falsch: "<<_I)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
_I=0
FOR _J=1 TO 20
_STR="_INT=ISVAR("<<_QUOT<<"$MC_TRAFO_TYPE_"<<_J<<_QUOT<<")"
EXECSTRING(_STR)
IF(_INT)
_STR="_INT=$MC_TRAFO_TYPE_"<<_J
EXECSTRING(_STR)
IF(((_INT>=256)AND(_INT<=511))OR(_INT==4100))AND(_I<2)
IF(_SC_TRANSM[_I,0]==0)
_SC_TRANSM[_I,0]=_INT
_SC_TRANSM[_I,3]=_J
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[2]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_SC_TRANSM[_I,1]=_J2+1
ENDIF
ENDFOR
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[0]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_SC_TRANSM[_I,2]=17+_J2
ENDIF
ENDFOR
IF(_LOG_ON)
_STR="  Trafo "<<_J<<" = "
IF(_SC_TRANSM[_I,0]<=511)
_STR=_STR<<"TRANSMIT "
ELSE
_STR=_STR<<"Doppel-TRANSMIT "
ENDIF
_STR=_STR<<_I+1<<": "<<_SC_TRANSM[_I,0]
IF(_SC_TRANSM[_I,1]>0)
_STR=_STR<<" (um "<<$MC_AXCONF_GEOAX_NAME_TAB[_SC_TRANSM[_I,1]-1]<<" "
ELSE
_STR=_STR<<" ("
ENDIF
_STR=_STR<<"G"<<_SC_TRANSM[_I,2]<<")"
WRITE(_LOG,_LOG_FILE,_STR)
ENDIF
_I=_I+1
ENDIF
ENDIF
ENDIF
ENDFOR
_F_TRAANG=0
IF($ON_TRAFO_TYPE_MASK B_AND 'H08')
IF($MC_TRAFO_MODE_MASK B_AND 'H01')AND(($MC_TRAFO_RESET_VALUE>0)OR($MC_TRAFO_RESET_NAME<>""))
IF($MC_TRAFO_RESET_VALUE>0)
_I=$MC_TRAFO_RESET_VALUE
_STR="_INT=$MC_TRAFO_TYPE_"<<_I
EXECSTRING(_STR)
IF(_INT>=1024)AND(_INT<=2047)
_F_TRAANG=2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAANG persistent (Trafo "<<_I<<")")
ENDIF
ENDIF
ELSE
S_TRA_NO=NAMETOINT("$NT_NAME",$MC_TRAFO_RESET_NAME,TRUE)
IF(S_TRA_NO>0)
IF($NT_TRAFO_TYPE[S_TRA_NO]=="TRAANG_K")
_F_TRAANG=2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAANG_K persistent")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_TRAANG==0)
IF($P_TRAFO B_AND 'H400')
_F_TRAANG=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAANG aktiv (nicht persistent)")
ENDIF
ENDIF
ENDIF
ENDIF
_F_Y_AXIS=0
IF($MC_AXCONF_GEOAX_ASSIGN_TAB[1])OR(_F_TRAANG)
_F_Y_AXIS=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"reale Y-Achse vorhanden")
ENDIF
ENDIF
_SC_TRACON[0,0]=REP(0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRACON:")
ENDIF
_I=0
FOR _J=1 TO 20
_STR="_INT=ISVAR("<<_QUOT<<"$MC_TRAFO_TYPE_"<<_J<<_QUOT<<")"
EXECSTRING(_STR)
IF(_INT)
_STR="_INT=$MC_TRAFO_TYPE_"<<_J
EXECSTRING(_STR)
IF(_INT>=8192)AND(_I<8)
_STR="_INT=$MC_TRACON_CHAIN_"<<(_I+1)<<"[0]"
EXECSTRING(_STR)
_SC_TRACON[_i,0]=_INT
_STR="_INT=$MC_TRACON_CHAIN_"<<(_I+1)<<"[1]"
EXECSTRING(_STR)
_SC_TRACON[_i,1]=_INT
IF(_LOG_ON)
_STR="  Trafo "<<_J<<" = TRACON "<<_I+1<<": ("<<_SC_TRACON[_I,0]<<","<<_SC_TRACON[_I,1]<<")"
WRITE(_LOG,_LOG_FILE,_STR)
IF(_SC_TRACON[_I,0]>_J)OR(_SC_TRACON[_I,1]>_J)
WRITE(_LOG,_LOG_FILE,"Fehler: Verknpfte Trafos mssen vor der aktuellen Trafo stehen!")
ENDIF
ENDIF
_I=_I+1
ENDIF
ENDIF
ENDFOR
IF(_LOG_ON)
IF(_F_TRAANG==2)AND($MC_TRAFO_RESET_VALUE>0)
_INT=$MC_TRAFO_RESET_VALUE
_STR="_INT=$MC_TRAFO_TYPE_"<<_INT
EXECSTRING(_STR)
IF(_INT==1024)AND(_INT<=2047)
_INT=$MC_TRAFO_RESET_VALUE
IF(_SC_TRACYL[0,0]>0)
_J=0
FOR _I=0 TO 7
IF(_SC_TRACON[_I,0]==_SC_TRACYL[0,3])AND(_SC_TRACON[_I,1]==_INT)
_J=1
ENDIF
ENDFOR
IF(_J==0)
WRITE(_LOG,_LOG_FILE,"Fehler: TRACON fehlt fr TRACYL 1 ("<<_SC_TRACYL[0,3]<<")")
ENDIF
ENDIF
IF(_SC_TRACYL[1,0]>0)
_J=0
FOR _I=0 TO 7
IF(_SC_TRACON[_I,0]==_SC_TRACYL[1,3])AND(_SC_TRACON[_I,1]==_INT)
_J=1
ENDIF
ENDFOR
IF(_J==0)
WRITE(_LOG,_LOG_FILE,"Fehler: TRACON fehlt fr TRACYL 2 ("<<_SC_TRACYL[1,3]<<")")
ENDIF
ENDIF
IF(_SC_TRANSM[0,0]>0)
_J=0
FOR _I=0 TO 7
IF(_SC_TRACON[_I,0]==_SC_TRANSM[0,3])AND(_SC_TRACON[_I,1]==_INT)
_J=1
ENDIF
ENDFOR
IF(_J==0)
WRITE(_LOG,_LOG_FILE,"Fehler: TRACON fehlt fr TRANSMIT 1 ("<<_SC_TRANSM[0,3]<<")")
ENDIF
ENDIF
IF(_SC_TRANSM[1,0]>0)
_J=0
FOR _I=0 TO 7
IF(_SC_TRACON[_I,0]==_SC_TRANSM[1,3])AND(_SC_TRACON[_I,1]==_INT)
_J=1
ENDIF
ENDFOR
IF(_J==0)
WRITE(_LOG,_LOG_FILE,"Fehler: TRACON fehlt fr TRANSMIT 2 ("<<_SC_TRANSM[1,3]<<")")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
IF($MCS_FUNCTION_MASK_TECH B_AND 'H01')
WRITE(_LOG,_LOG_FILE,"Schwenken ist freigegeben")
ELSE
WRITE(_LOG,_LOG_FILE,"Schwenken ist nicht freigegeben")
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Toolcarrier:")
FOR _J=1 TO $P_TCNUM
CYCLE213(_J)
_STR="  TC "<<_J<<": "<<$TC_CARR34[_J]<<" ("<<$TC_CARR23[_J]<<": "<<$TC_CARR35[_J]<<" "<<$TC_CARR36[_J]<<")"
IF($TC_CARR37[_J] _DEC9>=4)
_STR=_STR<<" freigegeben"
ELSE
_STR=_STR<<" nicht freigegeben"
ENDIF
IF($TC_CARR_KIN_CNTRL[_J] B_AND 1)
_STR=_STR<<" (kin.)"
ENDIF
WRITE(_LOG,_LOG_FILE,_STR)
ENDFOR
ENDIF
FOR _J=0 TO 3
_F_TC_DEF[_J]=0
ENDFOR
_F_TC_DIFF_B=0
IF(_F_AX_EXISTS[6])AND($MCS_FUNCTION_MASK_TECH B_AND 'H01')
_J=1
WHILE(_J<=$P_TCNUM)AND((_F_TC_DEF[0]==0)OR(_F_TC_DEF[1]==0)OR(_F_TC_DEF[2]==0))
CYCLE213(_J)
IF(_F_TC_DEF[0]==0)
IF($TC_CARR23[_J]=="M")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR36[_J]==_F_S_STR[0])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5<2)
_F_TC_DEF[0]=_J
ENDIF
ENDIF
IF(_F_TC_DEF[0]==0)
IF($TC_CARR23[_J]=="P")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR36[_J]==_F_S_STR[0])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5<2)
_F_TC_DEF[0]=_J
ENDIF
ENDIF
IF(_F_TC_DEF[1]==0)
IF($TC_CARR23[_J]=="M")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR36[_J]==_F_S_STR[2])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5<2)
_F_TC_DEF[1]=_J
ENDIF
ENDIF
IF(_F_TC_DEF[1]==0)
IF($TC_CARR23[_J]=="P")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR36[_J]==_F_S_STR[2])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5<2)
_F_TC_DEF[1]=_J
ENDIF
ENDIF
IF(_F_TC_DEF[2]==0)
IF($TC_CARR23[_J]=="T")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR36[_J]==_F_S_STR[1])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5>=2)
_F_TC_DEF[2]=_J
_F_TC_TYP_B=0
IF($TC_CARR_KIN_CNTRL[_J] B_AND 1)
S_OFF_B=0
IF(_F_AX_NR[6]>0)
_STR=$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[_F_AX_NR[6]-1]-1]
_INT=NAMETOINT("$NK_AXIS",_STR,TRUE)
IF(_INT>=0)
S_OFF_B=$NK_A_OFF[_INT]
ENDIF
ENDIF
IF(_F_AX_NR[1]>0)
_STR=$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[_F_AX_NR[1]-1]-1]
_INT=NAMETOINT("$NK_AXIS",_STR,TRUE)
IF(_INT>=0)
IF($NK_OFF_DIR[_INT,2]<0)
_F_TC_DIFF_B=S_OFF_B
ELSE
IF($NK_OFF_DIR[_INT,2]>0)
_F_TC_DIFF_B=S_OFF_B-180
ELSE
IF($NK_OFF_DIR[_INT,0]>0)
_F_TC_DIFF_B=S_OFF_B-270
ELSE
IF($NK_OFF_DIR[_INT,0]<0)
_F_TC_DIFF_B=S_OFF_B-90
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC "<<_J<<": Kein Kettenelement fr Werkzeugspindel: "<<$TC_CARR36[_J]<<" (MA="<<_STR<<")")
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC "<<_J<<": Werkzeugspindel ist keine Achse: "<<$TC_CARR36[_J])
ENDIF
ENDIF
ELSE
IF(ABS($TC_CARR10[_J])<ABS($TC_CARR12[_J]))
IF($TC_CARR17[_J]<0)
_F_TC_DIFF_B=$TC_CARR24[_J]-180
ELSE
_F_TC_DIFF_B=$TC_CARR24[_J]
ENDIF
ELSE
IF($TC_CARR15[_J]<0)
_F_TC_DIFF_B=$TC_CARR24[_J]-270
ELSE
_F_TC_DIFF_B=$TC_CARR24[_J]-90
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_TC_DEF[2]==0)
IF($TC_CARR23[_J]=="M")AND($TC_CARR35[_J]==_F_S_STR[1])AND($TC_CARR36[_J]==_F_S_STR[4])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5>=2)
_F_TC_DEF[2]=_J
_F_TC_TYP_B=1
IF($TC_CARR_KIN_CNTRL[_J] B_AND 1)
S_OFF_B=0
IF(_F_AX_NR[6]>0)
_STR=$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[_F_AX_NR[6]-1]-1]
_INT=NAMETOINT("$NK_AXIS",_STR,TRUE)
IF(_INT>=0)
S_OFF_B=$NK_A_OFF[_INT]
ENDIF
ENDIF
IF(_F_AX_NR[1]>0)
_STR=$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[_F_AX_NR[1]-1]-1]
_INT=NAMETOINT("$NK_AXIS",_STR,TRUE)
IF(_INT>=0)
IF($NK_OFF_DIR[_INT,2]<0)
_F_TC_DIFF_B=S_OFF_B
ELSE
IF($NK_OFF_DIR[_INT,2]>0)
_F_TC_DIFF_B=S_OFF_B-180
ELSE
IF($NK_OFF_DIR[_INT,0]>0)
_F_TC_DIFF_B=S_OFF_B-270
ELSE
IF($NK_OFF_DIR[_INT,0]<0)
_F_TC_DIFF_B=S_OFF_B-90
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC "<<_J<<": Kein Kettenelement fr Werkzeugspindel: "<<$TC_CARR36[_J]<<" (MA="<<_STR<<")")
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC "<<_J<<": Werkzeugspindel ist keine Achse: "<<$TC_CARR36[_J])
ENDIF
ENDIF
ELSE
IF(ABS($TC_CARR7[_J])<ABS($TC_CARR9[_J]))
IF($TC_CARR6[_J]<0)
_F_TC_DIFF_B=$TC_CARR25[_J]-180
ELSE
_F_TC_DIFF_B=$TC_CARR25[_J]
ENDIF
ELSE
IF($TC_CARR4[_J]<0)
_F_TC_DIFF_B=$TC_CARR25[_J]-270
ELSE
_F_TC_DIFF_B=$TC_CARR25[_J]-90
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_TC_DEF[3]==0)
IF($TC_CARR23[_J]=="T")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5>=8)
_F_TC_DEF[3]=_J
ENDIF
ENDIF
IF(_F_TC_DEF[3]==0)
IF($TC_CARR23[_J]=="M")AND($TC_CARR35[_J]==_F_S_STR[4])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5>=8)
_F_TC_DEF[3]=_J
ENDIF
IF($TC_CARR23[_J]=="M")AND($TC_CARR35[_J]==_F_S_STR[1])AND($TC_CARR36[_J]==_F_S_STR[4])AND($TC_CARR37[_J] _DEC9>=4)AND($TC_CARR37[_J] _DEC5>=8)
_F_TC_DEF[3]=_J
ENDIF
ENDIF
_J=_J+1
ENDWHILE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Toolcarrier ShopTurn:")
ENDIF
IF(_F_TC_DEF[0])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Frsen HSP: "<<_F_TC_DEF[0])
ENDIF
ELSE
IF(_F_AX_EXISTS[1])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Frsen HSP: nicht eingerichtet")
ENDIF
ENDIF
ENDIF
IF(_F_TC_DEF[1])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Frsen GSP: "<<_F_TC_DEF[1])
ENDIF
ELSE
IF(_F_AX_EXISTS[1])AND(_F_AX_EXISTS[2])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Frsen GSP: nicht eingerichtet")
ENDIF
IF(_E_ST_PRG) GOTOF _FEHL16
ENDIF
ENDIF
IF(_F_TC_DEF[2])
IF(_LOG_ON)
IF(_F_TC_TYP_B==0)
WRITE(_LOG,_LOG_FILE,"  Drehen WSP: "<<_F_TC_DEF[2]<<" (B-Achse im Kopf)")
ELSE
WRITE(_LOG,_LOG_FILE,"  Drehen WSP: "<<_F_TC_DEF[2]<<" (B-Achse im Tisch)")
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Drehen WSP: nicht eingerichtet")
ENDIF
IF(_E_ST_PRG) GOTOF _FEHL17
ENDIF
IF(_F_TC_DEF[3])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Frsen Mantel/Stirn: "<<_F_TC_DEF[3])
ENDIF
ELSE
_F_TC_DEF[3]=_F_TC_DEF[2]
ENDIF
IF(_LOG_ON)
IF(_F_TC_DIFF_B)
WRITE(_LOG,_LOG_FILE,"  Differenz B-Beta="<<_F_TC_DIFF_B)
ENDIF
ENDIF
ENDIF
_M_KIN_TRAFO_BEGIN:
IF($MN_MM_NUM_KIN_TRAFOS>0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"")
WRITE(_LOG,_LOG_FILE,"kin. Trafos: (max. "<<$MN_MM_NUM_KIN_TRAFOS<<")")
ENDIF
_E_TURN_TR_NUM=0
_E_IPT_TR_NUM=0
FOR _J=1 TO $MN_MM_NUM_KIN_TRAFOS
IF(($NT_TRAFO_TYPE[_J]<>"")AND($NT_NAME[_J]<>""))
IF(_LOG_ON)
ENDIF
IF($NT_TRAFO_TYPE[_J]=="TRAORI_STAT")AND($NT_IDENT[_J,0] _DEC5 >=2)
IF(_E_TURN_TR_NUM<10)
_E_TURN_TR_AX[_E_TURN_TR_NUM]=0
_J2=0
WHILE(_J2<$MN_MM_MAXNUM_KIN_CHAIN_ELEM)AND(_E_TURN_TR_AX[_E_TURN_TR_NUM]==0)
IF($NT_ROT_AX_NAME[_J,0]==$NK_NAME[_J2])
_J3=0
WHILE(_J3<31)AND(_E_TURN_TR_AX[_E_TURN_TR_NUM]==0)
IF($MN_AXCONF_MACHAX_NAME_TAB[_J3]==$NK_AXIS[_J2])
_E_TURN_TR_AX[_E_TURN_TR_NUM]=_J3+1
_E_TURN_TR_STR[_E_TURN_TR_NUM]=$NT_NAME[_J]
ENDIF
_J3=_J3+1
ENDWHILE
ENDIF
_J2=_J2+1
ENDWHILE
IF(_E_TURN_TR_AX[_E_TURN_TR_NUM]>0)
IF(_LOG_ON)
IF(_E_TURN_TR_AX[_E_TURN_TR_NUM]>0)
WRITE(_LOG,_LOG_FILE," "<<_J<<": "<<$NT_NAME[_J]<<" (TRAORI_STAT) Drehspindel: "<<$MN_AXCONF_MACHAX_NAME_TAB[_E_TURN_TR_AX[_E_TURN_TR_NUM]-1]<<"("<<_E_TURN_TR_AX[_E_TURN_TR_NUM]<<")")
_STR=""
_J2=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_J,0],TRUE)
IF(_J2>=0)
_STR=_STR<<"Tisch "<<$NK_AXIS[_J2]<<"("<<$NK_OFF_DIR[_J2,0]<<","<<$NK_OFF_DIR[_J2,1]<<","<<$NK_OFF_DIR[_J2,2]<<") "
ENDIF
_J2=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_J,1],TRUE)
IF(_J2>=0)
_STR=_STR<<"Schwenk "<<$NK_AXIS[_J2]<<"("<<$NK_OFF_DIR[_J2,0]<<","<<$NK_OFF_DIR[_J2,1]<<","<<$NK_OFF_DIR[_J2,2]<<") "
ENDIF
_J2=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_J,2],TRUE)
IF(_J2>=0)
_STR=_STR<<"Wkz "<<$NK_AXIS[_J2]<<"("<<$NK_OFF_DIR[_J2,0]<<","<<$NK_OFF_DIR[_J2,1]<<","<<$NK_OFF_DIR[_J2,2]<<") "
ENDIF
WRITE(_LOG,_LOG_FILE,"    "<<_STR)
ENDIF
ENDIF
_E_TURN_TR_NUM=_E_TURN_TR_NUM+1
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"   Drehspindel nicht gefunden!"<<_STR)
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"ACHTUNG: Zu viele Drehtrafos!")
ENDIF
ENDIF
ELSE
IF($NT_TRAFO_TYPE[_J]=="TRAINT")
IF(_E_IPT_TR_NUM<10)
_E_IPT_TR_STR[_E_IPT_TR_NUM]=$NT_NAME[_J]
_E_IPT_TR_NUM=_E_IPT_TR_NUM+1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," "<<_J<<": "<<$NT_NAME[_J]<<" (TRAINT)")
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"ACHTUNG: Zu viele Trafos zum Interpolationsdrehen!")
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
_STR=" "<<_J<<": "<<$NT_NAME[_J]<<" ("<<$NT_TRAFO_TYPE[_J]<<")"
_INT=$NT_TRAFO_INDEX[_J]
IF(_INT>0)
_STR=_STR<<": "<<S_TRAFO[_INT _DEC1]<<" "<<(_INT _DEC2+_INT _DEC3*10)<<" CHAN"<<(_INT _DEC4+_INT _DEC5*10)
ENDIF
WRITE(_LOG,_LOG_FILE,_STR)
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Anzahl kin. Drehtrafos: "<<_E_TURN_TR_NUM)
WRITE(_LOG,_LOG_FILE,"Anzahl Trafos zum Interpolationsdrehen: "<<_E_IPT_TR_NUM)
ENDIF
ENDIF
_M_KIN_TRAFO_END:
IF($P_TRAFO_CHAIN[0]==4100)OR($P_TRAFO_CHAIN[1]==4100)
IF(ISVAR("$MN_CC_ACTIVE_IN_CHAN_ROBX"))
IF($MN_CC_ACTIVE_IN_CHAN_ROBX[$P_CHANNO-1])
_SC_IS_ROBOT=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Roboter aktiv: ROBX")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_MODE==1)AND(_F_MCONF[1]==0)
_F_MCONF[1]=1
REPEAT _M_INIT_BEGIN _M_INIT_END
REPEAT _M_SPIND_BEGIN _M_SPIND_END
ENDIF
IF(_MODE==2)AND(_F_MCONF[1]<2)
_F_MCONF[1]=2
REPEAT _M_INIT_BEGIN _M_INIT_END
REPEAT _M_SPIND_BEGIN _M_SPIND_END
REPEAT _M_KIN_TRAFO_BEGIN _M_KIN_TRAFO_END
ENDIF
RET
_FEHL1: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61288 Hauptspindel ist nicht eingerichtet")
ENDIF
N721001 SETAL(61288)
RET
_FEHL2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61289 Gegenspindel ist nicht eingerichtet")
ENDIF
N721002 SETAL(61289)
RET
_FEHL3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61290 Werkzeugspindel ist nicht eingerichtet")
ENDIF
N721003 SETAL(61290)
RET
_FEHL4: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61291 Linearachse der Gegenspindel ist nicht eingerichtet")
ENDIF
N721004 SETAL(61291)
RET
_FEHL5: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61292 B-Achse ist nicht eingerichtet")
ENDIF
N721005 SETAL(61292)
RET
_FEHL6: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61140 Hauptspindel ist nicht korrekt eingerichtet")
ENDIF
N721006 SETAL(61140)
RET
_FEHL7: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61141 C-Achse der Hauptspindel ist nicht korrekt eingerichtet")
ENDIF
N721007 SETAL(61141)
RET
_FEHL8: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61142 Gegenspindel ist nicht korrekt eingerichtet")
ENDIF
N721008 SETAL(61142)
RET
_FEHL9: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61143 C-Achse der Gegenspindel ist nicht korrekt eingerichtet")
ENDIF
N721009 SETAL(61143)
RET
_FEHL10: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61144 Werkzeugspindel ist nicht korrekt eingerichtet")
ENDIF
N721010 SETAL(61144)
RET
_FEHL11: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61145 Linearachse der Gegenspindel ist nicht korrekt eingerichtet")
ENDIF
N721011 SETAL(61145)
RET
_FEHL12: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61146 B-Achse ist nicht korrekt eingerichtet")
ENDIF
N721012 SETAL(61146)
RET
_FEHL13: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61618 Drehspindel ist nicht eingerichtet")
ENDIF
N721013 SETAL(61618)
RET
_FEHL14: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61619 Drehspindel ist nicht korrekt eingerichtet")
ENDIF
N721014 SETAL(61619)
RET
_FEHL15: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61623 Toolcarrier fr Frsbearbeitung auf der Hauptspindel nicht eingerichtet")
ENDIF
N721015 SETAL(61623)
RET
_FEHL16: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61624 Toolcarrier fr Frsbearbeitung auf der Gegenspindel nicht eingerichtet")
ENDIF
N721016 SETAL(61624)
RET
_FEHL17: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61622 Toolcarrier fr Drehbearbeitung nicht eingerichtet")
ENDIF
N721017 SETAL(61622)
RET
_FEHL18: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61166 Maschinendatum prfen: "<<S_STRAL<<" (Kanalachsbezeichner von der NC nicht erkannt)")
ENDIF
N721018 SETAL(61166,S_STRAL)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE211_SPF
PROC CYCLE211(INT _SP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.93.00.00.005 ;DATE: 2019-09-06
;Cycle support HMIsl
;Workpiece
DEF AXIS _ZZ,_XX
DEF INT _BL,_N,_MODE,_NPV,_NPV1
DEF REAL _FAK1,_FAK2,_XA,_XI,_YA,_YI,_ZA,_ZI,_ZB,_L,_B,_H,_L1,_L2,_L3
DEF INT _LOG,_LOG_ON,_LOG_ON_SIM
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE211_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
_LOG_ON_SIM=ISFILE("//NC:/_N_MPF_DIR/_N_LOG_SIM_MPF")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE211: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
IF(_F_NPV[_SP]<0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"keine NPV eingegeben")
ENDIF
GOTOF _RET
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_SP>=0)AND(_SP<=1)
IF($MN_SIM_ENVIRONMENT B_AND 'B100')AND(_E_ST_PRG)
IF($P_GG[6]==1)
_XX=$P_AXN1
_ZZ=$P_AXN3
ELSE
IF($P_GG[6]==2)
_XX=$P_AXN2
_ZZ=$P_AXN1
ELSE
_XX=$P_AXN3
_ZZ=$P_AXN2
ENDIF
ENDIF
IF(_SP==0)AND(_F_NPV[0]>=0)AND(_E_RT[0,0]>0)AND(_F_NPV_SET[0]==0)
_L1=$MAS_SPINDLE_PARAMETER[0,_F_S_AX[5]]*_FAK1+$MAS_SPINDLE_PARAMETER[1,_F_S_AX[5]]*_FAK1-_E_RT[0,7]*_FAK2
IF($MAS_SPINDLE_CHUCK_TYPE[_F_S_AX[5]])
_L1=_L1+$MAS_SPINDLE_PARAMETER[2,_F_S_AX[5]]*_FAK1
ENDIF
_L1=_L1+$MAS_AXIS_MCS_POSITION[2,_F_S_AX[5]]*_FAK1-$P_SETFRAME[_ZZ,TR]*_FAK1-$P_ACTBFRAME[_ZZ,TR]*_FAK1
IF(_F_AX_EXISTS[7])
_L1=_L1+$MAS_AXIS_MCS_POSITION[2,_F_S_AX[7]]*_FAK1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"HSP ZC1="<<$MAS_SPINDLE_PARAMETER[0,_F_S_AX[5]]*_FAK1)
WRITE(_LOG,_LOG_FILE,"HSP ZS1="<<$MAS_SPINDLE_PARAMETER[1,_F_S_AX[5]]*_FAK1)
IF($MAS_SPINDLE_CHUCK_TYPE[_F_S_AX[5]])
WRITE(_LOG,_LOG_FILE,"HSP ZE1="<<$MAS_SPINDLE_PARAMETER[2,_F_S_AX[5]]*_FAK1)
ENDIF
WRITE(_LOG,_LOG_FILE,"ZB="<<_E_RT[0,7]*_FAK2)
WRITE(_LOG,_LOG_FILE,"L1="<<_L1)
ENDIF
$P_UIFR[_F_NPV[0],_ZZ,TR]=_L1/_FAK1
$P_UIFR[_F_NPV[0],_F_S_AX[0],TR]=0
IF($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000')
$P_UIFR[_F_NPV[0],_XX,TR]=$MAS_AXIS_MCS_POSITION[0,_F_S_AX[5]]*2-$P_SETFRAME[_XX,TR]*_FAK1-$P_ACTBFRAME[_XX,TR]*_FAK1
ELSE
$P_UIFR[_F_NPV[0],_XX,TR]=$MAS_AXIS_MCS_POSITION[0,_F_S_AX[5]]-$P_SETFRAME[_XX,TR]*_FAK1-$P_ACTBFRAME[_XX,TR]*_FAK1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"X="<<$P_UIFR[_F_NPV[0],_XX,TR])
ENDIF
IF(_LOG_ON_SIM)
MSG("Log Sim: HSP NPV"<<_F_NPV[0]<<": Z="<<_L1<<" X="<<$P_UIFR[_F_NPV[0],_XX,TR])
M0
ENDIF
ENDIF
IF(_SP==1)AND(_F_NPV[1]>=0)AND(_E_RT[1,0]>0)AND(_F_AX_EXISTS[2])AND(_F_S_NR[2])AND(_F_NPV_SET[1]==0)
IF(_F_AX_EXISTS[3])
IF(_F_ZW<>_SC_NO_VAL)
_L2=_F_ZW*_FAK2
ELSE
_L2=$SCS_SUB_SPINDLE_REL_POS*_FAK1
ENDIF
ENDIF
_L2=_L2+$MAS_AXIS_MCS_POSITION[2,_F_S_AX[6]]*_FAK1-$P_SETFRAME[_ZZ,TR]*_FAK1-$P_ACTBFRAME[_ZZ,TR]*_FAK1
IF(_F_AX_EXISTS[8])
_L2=_L2+$MAS_AXIS_MCS_POSITION[2,_F_S_AX[8]]*_FAK1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"L2="<<_L2)
ENDIF
_L3=$MAS_SPINDLE_PARAMETER[0,_F_S_AX[6]]*_FAK1+$MAS_SPINDLE_PARAMETER[1,_F_S_AX[6]]*_FAK1-_E_RT[1,7]*_FAK2
IF($MAS_SPINDLE_CHUCK_TYPE[_F_S_AX[6]])
_L3=_L3+$MAS_SPINDLE_PARAMETER[2,_F_S_AX[6]]*_FAK1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"GSP ZC2="<<$MAS_SPINDLE_PARAMETER[0,_F_S_AX[6]]*_FAK1)
WRITE(_LOG,_LOG_FILE,"GSP ZS2="<<$MAS_SPINDLE_PARAMETER[1,_F_S_AX[6]]*_FAK1)
IF($MAS_SPINDLE_CHUCK_TYPE[_F_S_AX[6]])
WRITE(_LOG,_LOG_FILE,"GSP ZE2="<<$MAS_SPINDLE_PARAMETER[2,_F_S_AX[6]]*_FAK1)
ENDIF
WRITE(_LOG,_LOG_FILE,"ZB="<<_E_RT[1,7]*_FAK2)
WRITE(_LOG,_LOG_FILE,"L3="<<_L3)
ENDIF
$P_UIFR[_F_NPV[1],_ZZ,TR]=(_L2-_L3)/_FAK1
IF(_E_ST_PRG)
$P_UIFR[_F_NPV[1],_ZZ,MI]=1
ENDIF
$P_UIFR[_F_NPV[1],_F_S_AX[2],TR]=0
IF($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000')
$P_UIFR[_F_NPV[1],_XX,TR]=$MAS_AXIS_MCS_POSITION[0,_F_S_AX[6]]*2-$P_SETFRAME[_XX,TR]*_FAK1-$P_ACTBFRAME[_XX,TR]*_FAK1
ELSE
$P_UIFR[_F_NPV[1],_XX,TR]=$MAS_AXIS_MCS_POSITION[0,_F_S_AX[6]]-$P_SETFRAME[_XX,TR]*_FAK1-$P_ACTBFRAME[_XX,TR]*_FAK1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"X="<<$P_UIFR[_F_NPV[1],_XX,TR])
ENDIF
IF(_LOG_ON_SIM)
MSG("Log Sim: GSP NPV"<<_F_NPV[1]<<": Z="<<_L2<<"-"<<_L3<<"="<<_L2-_L3<<" X="<<$P_UIFR[_F_NPV[1],_XX,TR])
M0
ENDIF
ENDIF
ENDIF
_BL=_E_RT[_SP,0]
IF(_BL<0)OR(_BL>5)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Rohteil falsch: "<<_BL)
ENDIF
_BL=0
ENDIF
_NPV=$P_GG[8]
_NPV1=_F_NPV[_SP]+1
IF(_NPV1>0)AND($MCS_TECHNOLOGY==1)
G[8]=_NPV1
ENDIF
_XA=_E_RT[_SP,1]*_FAK2
_YA=_E_RT[_SP,2]*_FAK2
_ZA=_E_RT[_SP,3]*_FAK2
_XI=_E_RT[_SP,4]*_FAK2
_YI=_E_RT[_SP,5]*_FAK2
_ZI=_E_RT[_SP,6]*_FAK2
_ZB=_E_RT[_SP,7]*_FAK2
_N =_E_RT[_SP,8]
_L =_E_RT[_SP,9]*_FAK2
_B =_E_RT[_SP,10]*_FAK2
_H =_E_RT[_SP,11]*_FAK2
_MODE=0
IF(_SP)
_MODE=_MODE+'H1000'
ENDIF
IF(_E_RT[_SP,12]==1)
_MODE=_MODE+'H2000'
ENDIF
CUST_TECHCYC(900)
IF(_SC_CHAN_1==0)OR(_SC_CHAN_1==$P_CHANNO)
CASE _BL OF 0 GOTOF _M_NONE 1 GOTOF _M_CYLINDER 2 GOTOF _M_PIPE 3 GOTOF _M_N_CORNER 4 GOTOF _M_RECTANGLE 5 GOTOF _M_BOX
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Fehler: _BL="<<_BL)
ENDIF
GOTOF _FEHL1
_M_NONE:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WORKPIECE(,"<<_E_WP_SOCKET<<",,NONE,"<<_MODE<<")")
ENDIF
WORKPIECE(,_E_WP_SOCKET,,"NONE",_MODE)
GOTOF _M_BL_E
_M_CYLINDER:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WORKPIECE(,"<<_E_WP_SOCKET<<",,CYLINDER,"<<_MODE<<","<<_ZA<<","<<_ZI-_ZA<<","<<_ZB-_ZA<<","<<_XA*2<<")")
ENDIF
WORKPIECE(,_E_WP_SOCKET,,"CYLINDER",_MODE,_ZA,_ZI-_ZA,_ZB-_ZA,_XA*2)
GOTOF _M_BL_E
_M_PIPE:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WORKPIECE(,"<<_E_WP_SOCKET<<",,PIPE,"<<_MODE<<","<<_ZA<<","<<_ZI-_ZA<<","<<_ZB-_ZA<<","<<_XA*2<<","<<ABS(_XI-_XA)<<")")
ENDIF
WORKPIECE(,_E_WP_SOCKET,,"PIPE",_MODE,_ZA,_ZI-_ZA,_ZB-_ZA,_XA*2,ABS(_XI-_XA))
GOTOF _M_BL_E
_M_N_CORNER:
_MODE=_MODE+'H200'
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WORKPIECE(,"<<_E_WP_SOCKET<<",,N_CORNER,"<<_MODE<<","<<_ZA<<","<<_ZI-_ZA<<","<<_ZB-_ZA<<","<<_N<<","<<_L<<")")
ENDIF
WORKPIECE(,_E_WP_SOCKET,,"N_CORNER",_MODE,_ZA,_ZI-_ZA,_ZB-_ZA,_N,_L)
GOTOF _M_BL_E
_M_RECTANGLE:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WORKPIECE(,"<<_E_WP_SOCKET<<",,RECTANGLE,"<<_MODE<<","<<_ZA<<","<<_ZI-_ZA<<","<<_ZB-_ZA<<","<<_H<<","<<_B<<")")
ENDIF
WORKPIECE(,_E_WP_SOCKET,,"RECTANGLE",_MODE,_ZA,_ZI-_ZA,_ZB-_ZA,_H,_B)
GOTOF _M_BL_E
_M_BOX:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WORKPIECE(,"<<_E_WP_SOCKET<<",,BOX,"<<_MODE<<","<<_ZA<<","<<_ZI-_ZA<<","<<_ZB-_ZA<<","<<_XA<<","<<_YA<<","<<_XI-_XA<<","<<_YI-_YA<<")")
ENDIF
WORKPIECE(,_E_WP_SOCKET,,"BOX",_MODE,_ZA,_ZI-_ZA,_ZB-_ZA,_XA,_YA,_XI-_XA,_YI-_YA)
GOTOF _M_BL_E
_M_BL_E:
ENDIF
IF(_NPV<>$P_GG[8])
G[8]=_NPV
ENDIF
ENDIF
_RET:
RET
_FEHL1: STOPRE
N721101 SETAL(61296)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE212_SPF
PROC CYCLE212(INT _SP,INT _MODE,REAL S_ZC,REAL S_ZS,REAL S_ZE,REAL S_XR,REAL S_ZR) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V04.08.02.00.074 ;DATE: 2017-04-06
;Cycle support HMIsl
;Spindle chuck data
DEF AXIS _AX
DEF INT _MODE1,_MODE2
DEF REAL _FAK1
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
DEF STRING[5] _AXISNAME
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE212_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_MODE1=_MODE _DEC1 _MODE2=_MODE _DEC2
IF(_LOG_ON)
;DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"_SP="<<_SP<<" _MODE="<<_MODE<<" S_ZC="<<S_ZC<<" S_ZS="<<S_ZS<<" S_ZE="<<S_ZE<<" S_XR="<<S_XR<<" S_ZR="<<S_ZR)
ENDIF
IF(_SP>=0)AND(_SP<=1)
IF(_MODE1==1)OR(_MODE1==2)
CYCLE210(1)
IF(_SP==0)
_AX=_F_S_AX[5]
ELSE
_AX=_F_S_AX[6]
ENDIF
$MAS_SPINDLE_CHUCK_TYPE[_AX]=_MODE2
IF(_LOG_ON)
_AXISNAME=AXSTRING(_AX)
WRITE(_LOG,_LOG_FILE,"  $MAS_SPINDLE_CHUCK_TYPE["<<_AXISNAME<<"]="<<_MODE2)
ENDIF
$MAS_SPINDLE_PARAMETER[0,_AX]=S_ZC/_FAK1
$MAS_SPINDLE_PARAMETER[1,_AX]=S_ZS/_FAK1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $MAS_SPINDLE_PARAMETER[0,"<<_AXISNAME<<"]="<<S_ZC/_FAK1)
WRITE(_LOG,_LOG_FILE,"  $MAS_SPINDLE_PARAMETER[1,"<<_AXISNAME<<"]="<<S_ZS/_FAK1)
ENDIF
IF(_MODE2==1)
$MAS_SPINDLE_PARAMETER[2,_AX]=S_ZE/_FAK1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $MAS_SPINDLE_PARAMETER[2,"<<_AXISNAME<<"]="<<S_ZE/_FAK1)
ENDIF
ELSE
$MAS_SPINDLE_PARAMETER[2,_AX]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $MAS_SPINDLE_PARAMETER[2,"<<_AXISNAME<<"]= 0")
ENDIF
ENDIF
FIXTURE("","","","CHUCK",_SP*4096,_MODE2,S_ZC,S_ZS,S_ZE)
IF(_MODE1==2)
$MAS_TAILSTOCK_PARAMETER[0,_AX]=S_XR/_FAK1
$MAS_TAILSTOCK_PARAMETER[1,_AX]=S_ZR/_FAK1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $MAS_TAILSTOCK_PARAMETER[0,"<<_AXISNAME<<"]="<<S_XR/_FAK1)
WRITE(_LOG,_LOG_FILE,"  $MAS_TAILSTOCK_PARAMETER[1,"<<_AXISNAME<<"]="<<S_ZR/_FAK1)
ENDIF
FIXTURE("","","","TAILSTOCK",_SP*4096,1,S_XR,S_ZR)
ENDIF
ENDIF
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE213_SPF
PROC CYCLE213(INT _TCI) PREPRO SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.02.00.085; DATE: 2017-11-16
;Cycle support HMIsl
DEF INT _H, _I, _II, _III, _TCMD, _FOUND
DEF STRING[40] _SERR
_TCMD=$MN_MM_NUM_TOOL_CARRIER
IF (_TCMD==0) OR (_TCI<=0) OR (_TCI>_TCMD)
ELSE
IF NOT ($TC_CARR_KIN_CNTRL[_TCI] B_AND 'B1')
ELSE
FOR _I=0 TO 1
_FOUND=0
IF($TC_CARR_KIN_ROTAX_NAME[_TCI,_I]<>"")
_H=NAMETOINT("$NK_NAME",$TC_CARR_KIN_ROTAX_NAME[_TCI,_I],TRUE)
IF(_H<>-1)
_II=-1
REPEAT
_II=_II+1
IF($MN_AXCONF_MACHAX_NAME_TAB[_II]==$NK_AXIS[_H])
_III=-1
REPEAT
_III=_III+1
IF $MC_AXCONF_MACHAX_USED[_III]==(_II+1)
EXECSTRING("$TC_CARR"<<35+_I<<"["<<_TCI<<"]=$MC_AXCONF_CHANAX_NAME_TAB["<<_III<<"]")
_FOUND=1
ENDIF
UNTIL(_III>=19)OR(_FOUND)
IF(NOT _FOUND)
_SERR="AXIS "<<$NK_AXIS[_H]<<" not found in channel"
GOTOF _ERR1
ENDIF
ENDIF
UNTIL(_III>=30)OR(_FOUND)
IF(NOT _FOUND)
_SERR="AXIS "<<$NK_AXIS[_H]<<" not found in MD10000"
GOTOF _ERR1
ENDIF
ELSE
_SERR=<<"$TC_CARR_KIN_ROTAX_NAME["<<_TCI<<","<<_I<<"] not found"
GOTOF _ERR1
ENDIF
ENDIF
IF(NOT _FOUND)
EXECSTRING("$TC_CARR"<<35+_I<<"["<<_TCI<<"]='"''"'")
ENDIF
ENDFOR
ENDIF
ENDIF
RET
_ERR1: STOPRE
N780040 SETAL(61098,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE217_SPF
PROC CYCLE217(VAR REAL S_CONT[,6], VAR INT S_RETVAL, VAR REAL S_HWM, VAR REAL S_FWM) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.00.02 ;DATE: 2016-11-14
;Cycle support HMIsl
;tool - contour control cycle
DEF REAL S_ANG, S_OFFA, S_EPS=0.001, S_MIMA[4]=SET(1000,-1000,1000,-1000), S_VGL[3], S_HW, S_FW
DEF INT S_II, S_JJ, S_GNUM, S_DIRH,S_NO_ANG_CHECK=0
DEF STRING[160] S_SERR=""
IF S_CONT[0,5]<2
S_RETVAL=-1
RET
ENDIF
S_RETVAL=0 S_FW=S_FWM S_HW=S_HWM
IF ((S_FWM==0)AND(S_HWM==0))
S_NO_ANG_CHECK=1
GOTOF S_KONTUR
ENDIF
S_FWM=0 S_HWM=0
IF ($MCS_TECHNOLOGY==3)
S_DIRH=1
CASE $P_ADT[2] OF 1 GOTOF _LAB2 2 GOTOF _LAB3 3 GOTOF _LAB1 4 GOTOF _LAB4 5 GOTOF _LAB2 6 GOTOF _LAB3 7 GOTOF _LAB1 8 GOTOF _LAB4
ELSE
IF ($MCS_TECHNOLOGY==4)
S_DIRH=-1
CASE $P_ADT[2] OF 1 GOTOF _LAB1 2 GOTOF _LAB3 3 GOTOF _LAB2 4 GOTOF _LAB4 5 GOTOF _LAB1 6 GOTOF _LAB3 7 GOTOF _LAB2 8 GOTOF _LAB4
ELSE
IF ($MCS_TECHNOLOGY_EXTENSION==3)
S_DIRH=1
CASE $P_ADT[2] OF 1 GOTOF _LAB2 2 GOTOF _LAB3 3 GOTOF _LAB1 4 GOTOF _LAB4 5 GOTOF _LAB2 6 GOTOF _LAB3 7 GOTOF _LAB1 8 GOTOF _LAB4
ELSE
IF ($MCS_TECHNOLOGY_EXTENSION==4)
S_DIRH=-1
CASE $P_ADT[2] OF 1 GOTOF _LAB1 2 GOTOF _LAB3 3 GOTOF _LAB2 4 GOTOF _LAB4 5 GOTOF _LAB1 6 GOTOF _LAB3 7 GOTOF _LAB2 8 GOTOF _LAB4
ELSE
S_SERR=<<"S_HW<>0 OR S_FW<>0"
SETAL(61019,S_SERR)
ENDIF
ENDIF
ENDIF
ENDIF
_LAB1: S_OFFA=-90
_LAB4: S_OFFA=S_OFFA+270
_LAB2: S_OFFA=S_OFFA-90
_LAB3: S_OFFA=S_OFFA-S_DIRH*180
S_KONTUR:
FOR S_II=2 TO S_CONT[0,5]
IF (S_CONT[S_II,1]==S_CONT[S_II-1,1]) AND (S_CONT[S_II,2]==S_CONT[S_II-1,2]) GOTOF _NEXT
S_GNUM=S_CONT[S_II,0] _DEC1
IF S_GNUM==0
S_RETVAL=100
ENDIF
IF (S_NO_ANG_CHECK==1) GOTOF _NEXT
;
IF S_GNUM>1
S_ANG=ATAN2(S_CONT[S_II,4]-S_CONT[S_II-1,2],S_CONT[S_II,3]-S_CONT[S_II-1,1])+(2.5-S_GNUM)*180
REPEAT _SAVE _NEXT
S_ANG=ATAN2(S_CONT[S_II,4]-S_CONT[S_II,2],S_CONT[S_II,3]-S_CONT[S_II,1])+(2.5-S_GNUM)*180
ELSE
S_ANG=ATAN2(S_CONT[S_II,2]-S_CONT[S_II-1,2],S_CONT[S_II,1]-S_CONT[S_II-1,1])
ENDIF
_SAVE:
WHILE (S_ANG<MINVAL(S_OFFA+S_DIRH*180,S_OFFA-S_DIRH*180)) OR (S_ANG>MAXVAL(S_OFFA+S_DIRH*180,S_OFFA-S_DIRH*180))
IF S_ANG>MAXVAL(S_OFFA+S_DIRH*180,S_OFFA-S_DIRH*180)
S_ANG=S_ANG-360
ELSE
S_ANG=S_ANG+360
ENDIF
ENDWHILE
S_MIMA[0]=MINVAL(S_MIMA[0],S_ANG) S_MIMA[1]=MAXVAL(S_MIMA[1],S_ANG)
WHILE (S_ANG<MINVAL(S_OFFA,S_OFFA+S_DIRH*360)) OR (S_ANG>MAXVAL(S_OFFA,S_OFFA+S_DIRH*360))
IF S_ANG>MAXVAL(S_OFFA,S_OFFA+S_DIRH*360)
S_ANG=S_ANG-360
ELSE
S_ANG=S_ANG+360
ENDIF
ENDWHILE
S_MIMA[2]=MINVAL(S_MIMA[2],S_ANG) S_MIMA[3]=MAXVAL(S_MIMA[3],S_ANG)
_NEXT:
ENDFOR
IF (S_NO_ANG_CHECK==1) GOTOF _END_RET
IF ABS(S_MIMA[0]-S_MIMA[1])-S_EPS>180
IF ABS(S_MIMA[2]-S_MIMA[3])-S_EPS>180 GOTOF _ERR
S_JJ=2
ENDIF
_CHECK:
FOR S_II=S_JJ TO S_JJ+1
IF BOUND(MINVAL(S_OFFA,S_OFFA+S_DIRH*(S_JJ-1)*180),MAXVAL(S_OFFA,S_OFFA+S_DIRH*(S_JJ-1)*180),S_MIMA[S_II])==S_MIMA[S_II]
S_FWM=MAXVAL(S_FWM,ABS(S_OFFA+S_JJ*S_DIRH*90-S_MIMA[S_II]))
ENDIF
IF BOUND(MINVAL(S_OFFA+S_JJ*S_DIRH*90,S_OFFA+S_DIRH*(S_JJ+2)*90),MAXVAL(S_OFFA+S_JJ*S_DIRH*90,S_OFFA+S_DIRH*(S_JJ+2)*90),S_MIMA[S_II])==S_MIMA[S_II]
S_HWM=MAXVAL(S_HWM,ABS(S_OFFA+S_JJ*S_DIRH*90-S_MIMA[S_II]))
ENDIF
ENDFOR
IF (S_HWM+S_FWM-S_EPS>180) OR (S_FWM-S_EPS>90) OR (($P_ADT[2]>4) AND (S_HWM-S_EPS>90)) GOTOF _ERR
IF (S_HWM-S_EPS<S_HW) AND (S_FWM-S_EPS<S_FW) GOTOF _END
S_RETVAL=S_RETVAL+1
_END:
IF (ABS(S_MIMA[0]-S_MIMA[1])-ABS(S_MIMA[2]-S_MIMA[3])<S_EPS) AND (S_RETVAL _DEC1==1)
IF S_VGL[0]==0
S_VGL[0]=S_RETVAL S_VGL[1]=S_HWM S_VGL[2]=S_FWM
S_RETVAL=S_RETVAL _DEC3*100 S_JJ=ABS(S_JJ-2) S_FWM=0 S_HWM=0
GOTOB _CHECK
ELSE
IF S_VGL[0]<S_RETVAL
S_RETVAL=S_VGL[0] S_HWM=S_VGL[1] S_FWM=S_VGL[2]
ENDIF
ENDIF
ENDIF
_END_RET:
RET
_ERR:
S_RETVAL=S_RETVAL+11 S_FWM=0 S_HWM=0
GOTOB _END

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE225_SPF
PROC CYCLE225 SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.91.00.00.003 ;DATE: 2018-11-07
;Cycle support HMIsl
;Internal subroutine
DEF INT _I=0
WHILE (_SC_TSM[_I]<>"")
EXECSTRING(_SC_TSM[_I])
_I=_I+1
ENDWHILE
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE226_SPF
PROC CYCLE226(STRING[32] _T,INT _DD,INT _DP,INT _VARI,STRING[32] S_TRA,INT _BA,REAL _BETA,REAL _GAMA,REAL S_POLA,INT S_MTL) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.67.00 ;DATE: 2016-07-24
;Cycle support HMIsl
;Tool change cycle in JOG-Mode for milling + turning
DEF INT S_ST,S_MODE,S_DIR
IF((_VARI _DEC2)==0)
IF(NOT $P_TC)
CYCLE809()
ENDIF
ENDIF
CYCLE206(_T,_DD,_DP,_VARI _DEC1,S_MTL)
IF((_VARI _DEC2)==1)
IF($P_SUBPAR[7]<>0)
IF(_BA B_AND 'H00200000')
S_DIR=1
ELSE
S_DIR=-1
ENDIF
IF(_BA B_AND 'H00010000')
S_MODE='B11111001'
S_POLA=0
ELSE
S_MODE='B00111001'
ENDIF
S_ST=S_ST+10*((_BA B_AND 'H00100000')/'H00100000')
S_ST=S_ST+200
S_ST=S_ST+1000000*((_BA B_AND 'H00060000')/'H00020000')
S_ST=S_ST+10000000*((_BA B_AND 'H00080000')/'H00080000')
CYCLE800(0,S_TRA,S_ST,S_MODE,,,,S_POLA,_BETA,_GAMA,,,,S_DIR,,2)
ELSE
CYCLE800()
ENDIF
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE800_SPF
PROC CYCLE800(INT _FR,STRING[32] _TC,INT _ST,INT _MODE,REAL _X0,REAL _Y0,REAL _Z0,REAL _A,REAL _B,REAL _C,REAL _X1,REAL _Y1,REAL _Z1,INT _DIR,REAL _FR_I,INT _DMODE) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.007 ;DATE: 2023-05-26
;Cycle support HMIsl
;Swiveling
DEF REAL _A1,_A2,_A3,_A4,_Amax=90,_Amin=-90,_A1_TR,_A2_TR,_MODR,_MODS,_FAK1,_FAK3,_CARR[65],_EPS,_AXROT
DEF REAL _RAX1A,_RAX2A,_AXPOL,_SBI_RT[3],_TCMI_Z,_LEN[11],_CAL[11],_MT_ANG
DEF INT _NV_AKT,_NVG8,_G17_18_19,_GS17_18_19,_TCMD,_TCI,_TCBA=99,_TCC,_HIRTH,_ISO=1,_VA1,_VA2,_SOL2,_SWIV=1,_TEMP,_TEMP_ON,_DMODE1,_MD21186,_MD21104,_M_DIRECT,_TCPL,_WWZ,_I,_II,_III,_H
DEF INT _TCRD,_CARR37,_TCJOG,_BFNR,_TRTYP,_Z2,_Z3,_Z4,_VG0,_ERR_M,_SETFR,_RA_KOMP,_WPOL,_DIRR,_DNR,_TNR,_DIRM,_GG29,_SWP,_MODE_809,_SD55221_5,_NYY,_SD55221_8,_M_GRIND,_SD55221_12,_MT_N
DEF INT _H_VAL[4],_TCI_KIN_CHAIN,_ALARM,_ROT_G18
DEF AXIS _XX,_YY,_ZZ,_AX1,_AX2,_AX3,_RAX1,_RAX2,_APPL
DEF FRAME _WPFR,_OLDFR,_TOOLFR,_SBI_FR,_TMPFR
DEF STRING[40] _SERR, _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE800_MPF",_PN
DEF CHAR _CARR23
DEF STRING[32] _CARR34,_CARR35,_CARR36
DEF INT _LOG,_LOG_ON,S_LOGSIZE
DEF STRING[40] _LOG_FILE
DEF STRING[200] S_STR
DEF STRING[1] _HOCHKOMMA=" "
_HOCHKOMMA[0]=34
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE800_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
WRITE(_TEMP,_TEMP_FILE,";CYCLE800("<<_FR<<","<<_HOCHKOMMA<<_TC<<_HOCHKOMMA<<","<<_ST<<","<<_MODE<<","<<_X0<<","<<_Y0<<","<<_Z0<<","<<_A<<","<<_B<<","<<_C<<","<<_X1<<","<<_Y1<<","<<_Z1<<","<<_DIR<<","<<_FR_I<<","<<_DMODE<<")")
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<" G[8]="<<$P_GG[8]<<" G[13]="<<$P_GG[13])
WRITE(_TEMP,_TEMP_FILE,"G[25]="<<$P_GG[25]<<" G[29]="<<$P_GG[29]<<" G[42]="<<$P_GG[42])
WRITE(_TEMP,_TEMP_FILE,"G[51]="<<$P_GG[51]<<" G[52]="<<$P_GG[52]<<" G[53]="<<$P_GG[53])
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
_TEMP_ON=1
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE800_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,S_LOGSIZE)
IF(S_LOGSIZE>20000)
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,"*****************************")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"CYCLE800("<<_FR<<","<<_TC<<","<<_ST<<","<<_MODE<<","<<_X0<<","<<_Y0<<","<<_Z0<<","<<_A<<","<<_B<<","<<_C<<","<<_X1<<","<<_Y1<<","<<_Z1<<","<<_DIR<<","<<_FR_I<<","<<_DMODE<<")")
S_STR="Aufruf aus "
FOR _I=0 TO $P_STACK-1
S_STR=S_STR<<$P_PROG_NAME[_I]<<" -> "
ENDFOR
WRITE(_LOG,_LOG_FILE,S_STR<<"CYCLE800")
ENDIF
IF _SC_Y_TURN<>0
CYCLE805()
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE805()")
ENDIF
ENDIF
_EPS=1/$MN_INT_INCR_PER_MM
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
G0
ENDIF
_GG29=$P_GG[29]
DIAMCYCOF
_G17_18_19=$P_GG[6] _GS17_18_19=_G17_18_19
_ST=ABS(_ST) _FR=ABS(_FR)
_ALARM=GETTCOR(_LEN,"-T:M")
_MD21186 = 0
IF ISVAR("$MC_TOCARR_ROT_OFFSET_FROM_FR")
IF $MC_TOCARR_ROT_OFFSET_FROM_FR
_MD21186=1
ENDIF
ENDIF
_SD55221_5 = 0
IF ($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B100000')
_SD55221_5 = 1
ENDIF
_SD55221_8 = 0
IF ($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B100000000')
_SD55221_8 = 1
ENDIF
_SD55221_12 = 0
IF ($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H1000')
_SD55221_12 = 1
ENDIF
IF ($MCS_TECHNOLOGY==3) OR ($MCS_TECHNOLOGY==4) OR ($MCS_TECHNOLOGY_EXTENSION==3) OR ($MCS_TECHNOLOGY_EXTENSION==4)
_SERR=<<"K SD55221 bit5=0"
IF(_SD55221_5==0) GOTOF _ERR21
_SERR=<<"L MD21186 =0"
IF(_MD21186==0) GOTOF _ERR21
_M_GRIND=3
IF ($MCS_TECHNOLOGY_EXTENSION==4)
_M_GRIND=4
ENDIF
IF ($MCS_TECHNOLOGY_EXTENSION==3) OR ($MCS_TECHNOLOGY_EXTENSION==4)
_M_GRIND=0
ENDIF
ENDIF
IF(($P_TOOL) AND (NOT((_TC=="0")OR($P_SUBPAR[1]==0))))
IF(((_ST _DEC3)==0)AND(($P_ADT[1] _DEC3)==5)AND($SCS_MILL_SWIVEL_ALARM_MASK B_AND 'B100'))
GOTOF _ERR28
ENDIF
IF(((_ST _DEC3)==0)AND(($P_ADT[1] _DEC3)==5)AND(($P_ADT[1] _DEC1)==5))
GOTOF _ERR28
ENDIF
IF (_M_GRIND==3)OR(_M_GRIND==4)
IF(((_ST _DEC3)==0)AND(($P_ADT[1] _DEC3)==4))
GOTOF _ERR32
ENDIF
ENDIF
IF(((_ST _DEC3)==1)AND(($P_ADT[1] _DEC3)==5))
GOTOF _ERR29
ENDIF
IF (_M_GRIND==3)OR(_M_GRIND==4)
IF(((_ST _DEC3)==1)AND(($P_ADT[1] _DEC3)==4))
GOTOF _ERR33
ENDIF
ENDIF
IF(((_ST _DEC3)==3)AND(($P_ADT[1] _DEC3)==5))
GOTOF _ERR30
ENDIF
IF (_M_GRIND==3)OR(_M_GRIND==4)
IF(((_ST _DEC3)==3)AND(($P_ADT[1] _DEC3)==4))
GOTOF _ERR34
ENDIF
ENDIF
IF (((_ST _DEC3)==2) AND ((($P_ADT[1] _DEC3)<4)OR(($P_ADT[1] _DEC3)==6)OR(($P_ADT[1] _DEC3)>7)))
GOTOF _ERR31
ENDIF
IF ((SUBSTR($P_PROG[$P_STACK-1],3,8)<>"CYCLE805") AND (($P_ADT[1] _DEC3)==5)AND(($P_ADT[1] _DEC1)==5))
GOTOF _ERR31
ENDIF
IF (_M_GRIND==3)OR(_M_GRIND==4)
IF(((_ST _DEC3)==2)AND((($P_ADT[1] _DEC3)<4)OR(($P_ADT[1] _DEC3)==6)OR(($P_ADT[1] _DEC3)>7)))
GOTOF _ERR35
ENDIF
ENDIF
_DNR=$P_TOOL _TNR=$P_TOOLNO
IF ((_TNR>0) AND (_DNR>0))
IF $MN_MM_ENABLE_TOOL_ORIENT>=1
IF((_ST _DEC3)==0)
_SERR="$TC_DPV["<<_TNR<<","<<_DNR<<"]<>0"
IF $TC_DPV[_TNR,_DNR]<>0 GOTOF _ERR3
ENDIF
ENDIF
_MT_N=$A_MYMTN[_TNR]
IF _MT_N>0
IF($TC_MTP_KD[_MT_N]==1)
_MT_ANG=($A_MYMTLN[_TNR]-1)*360/$TC_MTPN[_MT_N] ;Platznummer in Winkelumgerechnet
ELSE
IF($TC_MTP_KD[_MT_N]==3)
_MT_ANG=$TC_MTPPA[_MT_N,$A_MYMTLN[_TNR]]
ENDIF
ENDIF
IF _LOG_ON
WRITE(_LOG,_LOG_FILE,"; Multitool:")
WRITE(_LOG,_LOG_FILE,";  T="<<_TNR<<" MT="<<_MT_N<<" Platz="<<$A_MYMTLN[_TNR]<<" Typ="<<$TC_MTP_KD[_MT_N]<<" Winkel="<< _MT_ANG)
ENDIF
ENDIF
ENDIF
ENDIF
IF(ISVAR("NAMETOINT"))AND(ISVAR("$NT_NAME"))AND(ISVAR("$NT_IDENT"))
_TCI=NAMETOINT("$NT_NAME",_TC,TRUE)
_TCI_KIN_CHAIN=_TCI
IF(_TCI<1)AND($MCS_FUNCTION_MASK_TECH B_AND 'H400')AND((_ST _DEC3)==2)
IF(NOT(_TC=="0")OR($P_SUBPAR[1]==0))
CYCLE210(2)
IF(_E_TURN_TR_NUM==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; Abwahl: CYCLE800()")
WRITE(_LOG,_LOG_FILE,"; Trafoname getauscht: "<<_TC<<" -> "<<_E_TURN_TR_STR[0])
ENDIF
_TC=_E_TURN_TR_STR[0]
_TCI=NAMETOINT("$NT_NAME",_TC,TRUE)
ENDIF
ENDIF
ENDIF
IF((_ST _DEC3)==2)AND(_TCI>=0)
IF(($NT_IDENT[_TCI,0] _DEC5)>=2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; TC ist kin. Drehtrafo ("<<_TC<<")")
ENDIF
IF($P_TC)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; Abwahl: CYCLE800()")
ENDIF
CYCLE800()
ENDIF
_MODE_809=_FR _DEC1
_MODE_809=_MODE_809+10*(_ST _DEC2)
_MODE_809=_MODE_809+100*(0)
_MODE_809=_MODE_809+1000*((_DIR+1)/2+1)
IF(_MODE B_AND 'B11000000' == 'B11000000')
_MODE_809=_MODE_809+10000
ENDIF
_MODE_809=_MODE_809+100000*(_ST _DEC7)
_MODE_809=_MODE_809+1000000*(_ST _DEC8)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE809("<<_TC<<","<<_B<<","<<_C<<","<<_MODE_809<<","<<_FR_I<<","<<_A<<","<<_DMODE _DEC1<<")")
ENDIF
CYCLE809(_TC,_B,_C,_MODE_809,_FR_I,_A,_DMODE _DEC1)
GOTOF _RET
ENDIF
ENDIF
IF((_ST _DEC3)==0)AND(_TCI>=0)
ENDIF
ENDIF
_DMODE=ABS(_DMODE) _DMODE1=_DMODE _DEC1
IF ((_DMODE1>0)AND(_TC=="0"))
_DMODE1=0
ENDIF
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _ERR25
ELSE
IF($P_MC) GOTOF _ERR12
IF((_DMODE1>0)AND(_G17_18_19<>_DMODE1))
G[6]=_DMODE1
_G17_18_19=$P_GG[6]
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_X0=_X0/_FAK1 _Y0=_Y0/_FAK1 _Z0=_Z0/_FAK1
_X1=_X1/_FAK1 _Y1=_Y1/_FAK1 _Z1=_Z1/_FAK1
_NVG8=$P_GG[8] _NV_AKT=_NVG8-1
_BFNR=$MC_MM_NUM_BASE_FRAMES-1
_SETFR=$MC_MM_SYSTEM_FRAME_MASK B_AND 'B1'
IF (($P_TRAFO>0) AND ($P_TRAFO<256))
_TRTYP=2
ENDIF
IF ISAXIS(2)
IF(_G17_18_19==1)
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
ELSE
IF(_G17_18_19==2)
_XX=$P_AXN2 _YY=$P_AXN3 _ZZ=$P_AXN1
ELSE
_XX=$P_AXN3 _YY=$P_AXN1 _ZZ=$P_AXN2
ENDIF
ENDIF
_APPL=$P_AXN3
ELSE
IF(_G17_18_19==2)
_XX=$P_AXN2 _ZZ=$P_AXN1 _NYY=1
ENDIF
ENDIF
IF $P_GG[7]==2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G40 G0 "<< AXSTRING(_XX)<<"=IC(0) "<<AXSTRING(_YY)<<"=IC(0)")
ENDIF
G40 G0 AX[_XX]=IC(0) AX[_YY]=IC(0)
ENDIF
IF ((_NV_AKT==0) AND (_BFNR > 0))
_Z2=0 _Z3=1
FOR _Z4=1 TO _BFNR+1
IF ($P_CHBFRMASK B_AND _Z3)
_Z2=_Z4-1
ENDIF
_Z3=_Z3*2
ENDFOR
_BFNR=_Z2
ENDIF
_ST=ABS(_ST) _TCJOG=(_ST _DEC4)
IF _TCJOG
IF (_TRTYP AND (_TC=="TRAORI"))
_TCJOG=_TCJOG+2
ENDIF
IF ISVAR("$SCS_MILL_SWIVEL_ALARM_MASK")
_ERR_M=($SCS_MILL_SWIVEL_ALARM_MASK B_AND 'B1')
ENDIF
IF _ERR_M
IF ((_BFNR>=0) AND _NV_AKT)
IF ($P_ACTBFRAME[_XX,RT]<>0) OR ($P_ACTBFRAME[_YY,RT]<>0) OR ($P_ACTBFRAME[_ZZ,RT]<>0) GOTOF _ERR26
ENDIF
IF (_SETFR AND _NV_AKT)
IF ($P_SETFRAME[_XX,RT]<>0) OR ($P_SETFRAME[_YY,RT]<>0) OR ($P_SETFRAME[_ZZ,RT]<>0) GOTOF _ERR26
ENDIF
ENDIF
_ERR_M=0
IF ISVAR("$SCS_MILL_SWIVEL_ALARM_MASK")
_ERR_M=($SCS_MILL_SWIVEL_ALARM_MASK B_AND 'B10')
ENDIF
IF _ERR_M
IF _BFNR>=0
IF ($P_CHBFR[_BFNR,_XX,RT]<>$P_ACTBFRAME[_XX,RT])OR($P_CHBFR[_BFNR,_YY,RT]<>$P_ACTBFRAME[_YY,RT])OR($P_CHBFR[_BFNR,_ZZ,RT]<>$P_ACTBFRAME[_ZZ,RT])OR($P_CHBFRMASK==0) GOTOF _ERR27
ENDIF
IF _SETFR
IF ($P_ACTBFRAME[_XX,RT]<>0)OR($P_ACTBFRAME[_YY,RT]<>0)OR($P_ACTBFRAME[_ZZ,RT]<>0) GOTOF _ERR27
ENDIF
ENDIF
_X0=0 _Y0=0 _Z0=0 _X1=0 _Y1=0 _Z1=0
_VG0=($MA_JOG_VELO_RAPID[_ZZ]/$MA_MAX_AX_VELO[_ZZ])*100
IF (_VG0 > 100)
_VG0=100
ENDIF
ENDIF
IF ($AN_NCK_VERSION < 750000) GOTOF _ERR1
IF (_TCJOG==3) OR (_TCJOG==4) GOTOF _SI1
_PN=SUBSTR($P_PROG[$P_STACK-1],3,7)
IF(_PN=="E_TCARR")
_ISO=0
ENDIF
IF(_PN=="F_TCARR")
_ISO=2
ENDIF
_TCMD=$MN_MM_NUM_TOOL_CARRIER
IF(_TC=="0") OR ($P_SUBPAR[1]==0)
WRTPR("SWIVEL(1)",1)
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")
IF(_FR>0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";Freifahren: ")
WRITE(_LOG,_LOG_FILE," CYCLE807("<<_FR<<",'"'"<<$PC_TRAFO_NAME<<"'"',200,"<<_FR_I<<")")
ENDIF
N115 CYCLE807(_FR,$PC_TRAFO_NAME,200,_FR_I)
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";kein Freifahren")
ENDIF
ENDIF
IF(($NT_IDENT[($P_TRAFO_PARSET MOD 1000),0] _DEC5)>=2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";Abwahl:")
WRITE(_LOG,_LOG_FILE," CYCLE809()")
ENDIF
CYCLE809()
ENDIF
ENDIF
IF ($P_TC)
IF (_FR >0) AND ((_DMODE _DEC3)==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE807("<<_FR<<","<<$TC_CARR34[$P_TC]<<","<<_ST<<","<<_FR_I<<","<<_VG0<<")")
ENDIF
CYCLE807(_FR,$TC_CARR34[$P_TC],_ST,_FR_I,_VG0)
ENDIF
IF ($P_PROG[$P_STACK-1]=="_N_MA_JOG_STEP1_MPF")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800(16,"<<$P_TC<<")")
ENDIF
CUST_800(16,$P_TC)
ENDIF
STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<$P_TC<<"]=0 $TC_CARR14["<<$P_TC<<"]=0")
ENDIF
$TC_CARR13[$P_TC]=0 $TC_CARR14[$P_TC]=0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR=0 ")
WRITE(_LOG,_LOG_FILE,"PAROTOF ")
WRITE(_LOG,_LOG_FILE,"TOROTOF ")
ENDIF
TCARR=0
PAROTOF
TOROTOF
IF ISVAR("$P_PARTFR")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_PARTFR=CTRANS() ")
ENDIF
$P_PARTFR=CTRANS()
ENDIF
IF ISVAR("$P_TOOLFR")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_TOOLFR=CTRANS() ")
ENDIF
$P_TOOLFR=CTRANS()
ENDIF
IF ISVAR("$P_WPFR")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS() ")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME ")
ENDIF
$P_WPFRAME=CTRANS()
$P_WPFR=$P_WPFRAME
ENDIF
IF(_LOG_ON)
IF _NVG8==1
WRITE(_LOG,_LOG_FILE,"G500")
ELSE
IF ((_NVG8<6) AND (_NVG8<>0))
WRITE(_LOG,_LOG_FILE,"G"<<52+_NVG8)
ELSE
IF _NVG8>5
WRITE(_LOG,_LOG_FILE,"G"<<499+_NVG8)
ENDIF
ENDIF
ENDIF
ENDIF
G[8]=_NVG8
_TC_P[5]=0 _TC_P[6]=0 _TC_P[7]=0
_TC_NUM=0 _TC_FR=0 _TC_ST=0 _TC_MODE=0 _TC_N_WZ=0 _TC_A_WZ=0 _TC_A1=0 _TC_A2=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$MC_TOOL_CARRIER_RESET_VALUE=0")
WRITE(_LOG,_LOG_FILE,"D="<<$P_TOOL<<" DL="<<$P_DLNO)
ENDIF
$MC_TOOL_CARRIER_RESET_VALUE=0
D=$P_TOOL DL=$P_DLNO
IF(SUBSTR($P_PROG[$P_STACK-1],3,8)<>"CYCLE800")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800(40,0)")
ENDIF
CUST_800(40,0)
ENDIF
STOPRE
GOTOF _RET1
ENDIF
_TCI=$P_TC
CYCLE213(_TCI)
IF (_TCJOG==6) OR (_TCJOG==7)
_TCI=$P_TC
IF ((_TCI==0) AND (_TRTYP==0)) GOTOF _RET1
_DIR=_TC_DIR
_MODE=27
_CARR37=ABS($TC_CARR37[_TCI])
_CARR34=$TC_CARR34[_TCI] _CARR35=$TC_CARR35[_TCI] _CARR36=$TC_CARR36[_TCI]
_WPFR=CTRANS() _SBI_FR=CTRANS()
IF _NV_AKT>0
_SBI_FR=$P_UIFR[_NV_AKT]
ELSE
IF _SETFR
_SBI_FR=$P_SETFR
ELSE
IF _BFNR>=0
_SBI_FR=$P_CHBFR[_BFNR]
ENDIF
ENDIF
ENDIF
_WPFR[_ZZ,RT]=_TC_P[5] _WPFR[_YY,RT]=_TC_P[6] _WPFR[_XX,RT]=_TC_P[7]
_WPFR=_SBI_FR:(INVFRAME(_WPFR):$P_WPFRAME)
_A=_WPFR[_ZZ,RT] _B=_WPFR[_YY,RT] _C=_WPFR[_XX,RT]
_X0=0 _Y0=0 _Z0=0 _X1=0 _Y1=0 _Z1=0
_WPFR=CTRANS() _SBI_FR=CTRANS()
_TCBA=0
IF (_TCJOG==6)
_ST=2000
_TCJOG=2+_TRTYP
ELSE
REPEAT _SJ_A _SJ_E
G[8]=_NVG8
_ST=1000
_TCJOG=1+_TRTYP
ENDIF
IF _TRTYP GOTOF _SI1
GOTOF M_FR
ENDIF
IF ISVAR("_TC_GNO")
IF _M_GRIND==3
_SERR=<<"SD55221 bit9=0 and _TC_GNO>0"
IF ((($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B1000000000')==0)AND(_TC_GNO>0)) GOTOF _ERR36
_SERR=<<"SD55221 bit9=1 and _TC_GNO<=0"
IF (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B1000000000')AND(_TC_GNO <= 0)) GOTOF _ERR36
_SERR=<<"SGUD _TC_GNO > $P_TCNUM"
IF (_TC_GNO > $P_TCNUM) GOTOF _ERR36
IF ($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B1000000000')
_TC=<<$TC_CARR34[_TC_GNO]
ENDIF
ENDIF
ENDIF
IF (_E_JS_PRG==0) AND ($SCS_MILL_SWIVEL_ALARM_MASK B_AND 'H10')
_SERR=<<"_ST ="<<(_ST _DEC5)<<"xxxx or _DIR="<<_DIR
IF ((_ST _DEC5==0) AND (_DIR==0)) GOTOF _ERR36
IF ((_ST _DEC5<>0) AND (_DIR<>0))GOTOF _ERR36
_SERR=<<"_ST ="<<(_ST _DEC5)<<"xxxx"
IF _ST _DEC5>2 GOTOF _ERR36
_SERR=<<"_DIR="<<_DIR
IF ABS(_DIR)>1 GOTOF _ERR36
ENDIF
IF ((_TC=="") AND (_TCMD>1)) OR (_TCMD==0) GOTOF _ERR0
IF (_TC=="") AND (_TCMD==1)
_TCI=1
ELSE
IF ISVAR("$P_TCNUM")
_TCMD=$P_TCNUM
ENDIF
_TCI=1
WHILE (TOUPPER($TC_CARR34[_TCI])<>TOUPPER(_TC))
_TCI=_TCI+1
IF (_TCI>_TCMD) GOTOF _ERR2
ENDWHILE
IF ((_TCI_KIN_CHAIN>0) AND((_ST _DEC3)==0))
_SERR="$TC_CARR34["<<_TCI<<"]=$NT_NAME["<<_TCI_KIN_CHAIN<<"]"
GOTOF _ERR26A
ENDIF
ENDIF
_TC_N_WZ=_ST _DEC2
_TC_A_WZ=_ST _DEC3
IF (_TC_A_WZ==1)
_SERR=<<"A"
IF (_TCI<>$P_TC) GOTOF _ERR19
IF ((_ST _DEC1)<>1) GOTOF _ERR22
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800(40,"<<_TCI<<")")
ENDIF
CUST_800(40,_TCI)
IF ISVAR("_TC_CHANGE")<>0
IF ((_TCI>0) AND (_TC_CHANGE<>""))
_SERR=""
FOR _I=1 TO _TCMD
IF TOUPPER($TC_CARR34[_I])==TOUPPER(_TC_CHANGE) GOTOF _CHANGE
ENDFOR
_SERR=<<"_TC_CHANGE="<<_TC_CHANGE
GOTOF _ERR36
_CHANGE:
IF $TC_CARR23[_TCI]<> $TC_CARR23[_I]
_SERR="_TC_CHANGE->$TC_CARR23"
ENDIF
IF (($TC_CARR37[_TCI] _DEC1)<>($TC_CARR37[_I] _DEC1))
_SERR="_TC_CHANGE->$TC_CARR37 _DEC1"
ENDIF
IF (($TC_CARR37[_TCI] _DEC5)<>($TC_CARR37[_I] _DEC5))
_SERR="_TC_CHANGE->$TC_CARR37 _DEC5"
ENDIF
IF ((($TC_CARR37[_TCI] _DEC7)<>($TC_CARR37[_I] _DEC7)) OR (($TC_CARR37[_TCI] _DEC8)<>($TC_CARR37[_I] _DEC8)))
_SERR="_TC_CHANGE->$TC_CARR37 _DEC7/8"
ENDIF
IF (($TC_CARR37[_I] _DEC9)==0)
_SERR="_TC_CHANGE->$TC_CARR37 _DEC9=0"
ENDIF
IF _SERR<>"" GOTOF _ERR36
_TC=<<_TC_CHANGE
_TCI=_I
_CHANGE_E:
ENDIF
ENDIF
CYCLE213(_TCI)
_CARR37=ABS($TC_CARR37[_TCI])
_CARR23=$TC_CARR23[_TCI] _CARR34=$TC_CARR34[_TCI] _CARR35=$TC_CARR35[_TCI] _CARR36=$TC_CARR36[_TCI]
FOR _II=1 TO 40
IF _II==21
_II=24
ENDIF
IF _II==34
_II=38
ENDIF
EXECSTRING("_CARR["<<_II<<"]=$TC_CARR"<<_II<<"["<<_TCI<<"]")
ENDFOR
IF ($TC_CARR_KIN_CNTRL[_TCI] B_AND 'B1')
_H=0
IF $P_TC==0
_H=$P_TOOL+10
IF $P_TOOL<>0
IF (($P_AD[1]>=400) AND ($P_AD[1]<600))
D0
ENDIF
ENDIF
$TC_CARR13[_TCI]=0 $TC_CARR14[_TCI]=0
TCOABS
TCARR=_TCI
ENDIF
FOR _II=13 TO 40
IF _II==15
_II=26
ENDIF
IF _II==34
_II=38
ENDIF
EXECSTRING("_CARR["<<_II<<"]=$TC_CARR"<<_II<<"["<<_TCI<<"]")
ENDFOR
FOR _II=0 TO 2
_CARR[1+_II]=$PC_TCARR_OFFSET[1,_II]
_CARR[4+_II]=$PC_TCARR_OFFSET[2,_II]
_CARR[15+_II]=$PC_TCARR_OFFSET[3,_II]
_CARR[18+_II]=$PC_TCARR_OFFSET[4,_II]
_CARR[7+_II]=$PC_TCARR_AX_VECT[1,_II]
_CARR[10+_II]=$PC_TCARR_AX_VECT[2,_II]
ENDFOR
_CARR[24]=SET($PC_TCARR_AX_OFFSET[1],$PC_TCARR_AX_OFFSET[2])
IF _H<>0
TCARR=0
D=_H-10
ENDIF
ENDIF
_VA1=ABS(_CARR[7])+ABS(_CARR[8])+ABS(_CARR[9])
_VA2=ABS(_CARR[10])+ABS(_CARR[11])+ABS(_CARR[12])
IF (_VA1+_VA2)==0 GOTOF _ERR6
IF _CARR35=="" GOTOF _ERR8
CASE _G17_18_19 OF 2 GOTOF _P18 3 GOTOF _P19 DEFAULT GOTOF _P17
_P18:
IF ((_CARR[7]==0) AND (_CARR[9]==0))
_WPOL=1
ENDIF
IF ((_CARR[10]==0) AND (_CARR[12]==0) AND (_CARR23<>""))
_WPOL=2
ENDIF
GOTOF _PPE
_P19:
IF ((_CARR[8]==0) AND (_CARR[9]==0))
_WPOL=1
ENDIF
IF ((_CARR[11]==0) AND (_CARR[12]==0) AND (_CARR23<>""))
_WPOL=2
ENDIF
GOTOF _PPE
_P17:
IF ((_CARR[7]==0) AND (_CARR[8]==0))
_WPOL=1
ENDIF
IF ((_CARR[10]==0) AND (_CARR[11]==0) AND (_CARR23<>""))
_WPOL=2
ENDIF
_PPE:
IF ((_WPOL==0) AND (_CARR36<>"") AND (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H2000')<>0))
IF (_CARR23=="M") OR (_CARR23=="P")
CASE _G17_18_19 OF 2 GOTOF S_P18 3 GOTOF S_P19 DEFAULT GOTOF S_P17
S_P18:
IF ((_CARR[11]==0) AND (_CARR[12]==0) AND (_CARR23<>""))
_WPOL=2
ENDIF
GOTOF S_PPE
S_P19:
IF ((_CARR[10]==0) AND (_CARR[11]==0) AND (_CARR23<>""))
_WPOL=2
ENDIF
GOTOF S_PPE
S_P17:
IF ((_CARR[10]==0) AND (_CARR[12]==0) AND (_CARR23<>""))
_WPOL=2
ENDIF
S_PPE:
ENDIF
ENDIF
_RAX1A=(ABS(_CARR[30]))+(ABS(_CARR[32]))
_RAX2A=(ABS(_CARR[31]))+(ABS(_CARR[33]))
IF (_RAX1A==0) GOTOF _ERR5
IF ((_RAX2A==0) AND (_CARR36<>"")) GOTOF _ERR5
IF (_CARR[30]>=_CARR[32]) OR ((_CARR[31]>=_CARR[33]) AND (_CARR36<>"")) GOTOF _ERR5
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G"<<16+_DMODE1)
ENDIF
_G17_18_19=$P_GG[6]
ENDIF
IF ISVAR("$MC_ORI_IPO_WITH_G_CODE")
_MD21104=$MC_ORI_IPO_WITH_G_CODE
ENDIF
IF _TEMP_ON
WRITE(_TEMP,_TEMP_FILE,";I1: "<<_CARR[1]<<" "<<_CARR[2]<<" "<<_CARR[3])
WRITE(_TEMP,_TEMP_FILE,";I2: "<<_CARR[4]<<" "<<_CARR[5]<<" "<<_CARR[6])
WRITE(_TEMP,_TEMP_FILE,";V1: "<<_CARR[7]<<" "<<_CARR[8]<<" "<<_CARR[9])
WRITE(_TEMP,_TEMP_FILE,";V2: "<<_CARR[10]<<" "<<_CARR[11]<<" "<<_CARR[12])
WRITE(_TEMP,_TEMP_FILE,";I3: "<<_CARR[15]<<" "<<_CARR[16]<<" "<<_CARR[17])
WRITE(_TEMP,_TEMP_FILE,";I4: "<<_CARR[18]<<" "<<_CARR[19]<<" "<<_CARR[20])
WRITE(_TEMP,_TEMP_FILE,";26-29: "<<_CARR[26]<<" "<<_CARR[27]<<" "<<_CARR[28]<<" "<<_CARR[29])
WRITE(_TEMP,_TEMP_FILE,";30-33: "<<_CARR[30]<<" "<<_CARR[31]<<" "<<_CARR[32]<<" "<<_CARR[33])
WRITE(_TEMP,_TEMP_FILE,";34-37: "<<_CARR[34]<<" "<<_CARR[35]<<" "<<_CARR[36]<<" "<<_CARR[37])
WRITE(_TEMP,_TEMP_FILE,";38-40: "<<_CARR[38]<<" "<<_CARR[39]<<" "<<_CARR[40])
WRITE(_TEMP,_TEMP_FILE,"CYCLE800("<<_FR<<","<<_HOCHKOMMA<<_TC<<_HOCHKOMMA<<","<<_ST<<","<<_MODE<<","<<_X0<<","<<_Y0<<","<<_Z0<<","<<_A<<","<<_B<<","<<_C<<","<<_X1<<","<<_Y1<<","<<_Z1<<","<<_DIR<<","<<_FR_I<<","<<_DMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_SERR=<<"1"
IF ((_CARR37 _DEC1)>5) GOTOF _ERR11
_SERR=<<"2"
IF ((_CARR37 _DEC2)>2) GOTOF _ERR11
_SERR=<<"3"
IF ((_CARR37 _DEC3)>2) GOTOF _ERR11
_SERR=<<"4"
IF ISVAR("$MCS_FUNCTION_MASK_TECH")
IF ((_CARR37 _DEC4)==1)OR((_CARR37 _DEC4)==2)OR((_CARR37 _DEC4)==6)OR((_CARR37 _DEC4)==7)GOTOF _ERR11
ELSE
IF ((_CARR37 _DEC4)>4) GOTOF _ERR11
ENDIF
IF ($MCS_TECHNOLOGY<>3)
_SERR=<<"5 >3 "
IF ((_CARR37 _DEC5)>3) GOTOF _ERR11
ELSE
_SERR=<<"5 >7 AND $MCS_TECHNOLOGY=3"
IF ((_CARR37 _DEC5)>7) GOTOF _ERR11
ENDIF
_SERR=<<"6"
_TCPL=_CARR37 _DEC6
IF ((_TCPL>3) OR (_TCPL==2)) GOTOF _ERR11
_SERR=<<"6 or TECHNOLOGY"
IF ((_TCPL>0) AND ($MCS_TECHNOLOGY<>1)) GOTOF _ERR11
_SERR=<<"7 or dec8"
IF (((_CARR37 _DEC8)*10)+(_CARR37 _DEC7))>15 GOTOF _ERR11
_TCBA=(_CARR37 _DEC3)*10
IF _TCBA>=20
_TCBA=10
ENDIF
IF (_CARR37 _DEC2)
_TCBA=_TCBA+21
ELSE
_TCBA=_TCBA+20
ENDIF
IF _CARR36==""
_TCBA=_TCBA+2
IF (_TCBA>=32)
_TCBA=_TCBA-10
ENDIF
$TC_CARR10[_TCI]=0 $TC_CARR11[_TCI]=0 $TC_CARR12[_TCI]=0
ENDIF
_M_DIRECT=((_MODE B_AND 'B11000000')=='B11000000')
_SERR=<<"E"
IF((_DMODE _DEC4)==0)
IF ((_TCJOG==0) AND ((_CARR37 _DEC1) <= 2) AND((_MODE B_AND 'B11000000')=='B11000000')) GOTOF _ERR24
ENDIF
IF ((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4) OR (_TC_A_WZ==9))
IF ((_CARR37 _DEC5)<2)
_SERR=<<"B"<<" $TC_CARR37["<<_TCI<<"]="<<_CARR[37]
GOTOF _ERR23
ENDIF
_SERR=<<"A"
IF (_ST _DEC1) GOTOF _ERR21
_SERR=<<"F SD55221 bit5=0"
IF ((_NYY==1) AND (_SD55221_5==0)) GOTOF _ERR21
IF (_TCPL>0)
_SERR=<<"G SD55221 bit5=0"
IF(_SD55221_5==0) GOTOF _ERR21
ENDIF
ENDIF
IF (_TC_A_WZ==9)
IF _TCBA==20
_TCBA=22
ENDIF
ENDIF
_TC_ST=_TCBA
IF (_CARR[28])OR(_CARR[29])
_HIRTH=1
IF ($MC_TOCARR_ROT_ANGLE_INCR[0])OR($MC_TOCARR_ROT_ANGLE_INCR[1])
$MC_TOCARR_ROT_ANGLE_OFFSET[0]=0
$MC_TOCARR_ROT_ANGLE_OFFSET[1]=0
$MC_TOCARR_ROT_ANGLE_INCR[0]=0
$MC_TOCARR_ROT_ANGLE_INCR[1]=0
NEWCONF
ENDIF
ENDIF
CYCLE807(_FR,_TC,_ST,_FR_I,_VG0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE807("<<_FR<<","<<_TC<<","<<_ST<<","<<_FR_I<<","<<_VG0<<")")
ENDIF
M_FR:
IF (_TCI <> $P_TC)
STOPRE
ENDIF
WRTPR("SWIVEL(1)",1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"PAROTOF")
WRITE(_LOG,_LOG_FILE,"TOROTOF")
ENDIF
PAROTOF
TOROTOF
IF ISVAR("$P_PARTFR")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_PARTFR=CTRANS()")
ENDIF
$P_PARTFR=CTRANS()
ENDIF
IF ISVAR("$P_TOOLFR")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_TOOLFR=CTRANS()")
ENDIF
$P_TOOLFR=CTRANS()
ENDIF
IF NOT( $P_TRAFO B_AND 'H3700')
TRAFOOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAFOOF")
ENDIF
ENDIF
TCARR=0
G[8]=_NVG8
$TC_CARR21[_TCI]=_XX $TC_CARR22[_TCI]=_XX
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR=0")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
WRITE(_LOG,_LOG_FILE,"$TC_CARR21["<<_TCI<<"]=_XX $TC_CARR22["<<_TCI<<"]=_XX ")
ENDIF
IF ((_ST _DEC1)==0)
$TC_CARR13[_TCI]=0 $TC_CARR14[_TCI]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]=0 $TC_CARR14["<<_TCI<<"]=0")
ENDIF
ENDIF
IF ((_M_DIRECT==1) AND ((_ST _DEC1)==1))
IF ($P_WPFRAME[_XX,RT]<>0)OR($P_WPFRAME[_YY,RT]<>0)OR($P_WPFRAME[_ZZ,RT]<>0)
_SERR=<<"G WPFRAME ?"
IF ($P_WPFRAME[_XX,TR]<>0)OR($P_WPFRAME[_YY,TR]<>0)OR($P_WPFRAME[_ZZ,TR]<>0) GOTOF _ERR24
ENDIF
ENDIF
IF ((_ST _DEC1)==0) OR (_TCJOG==2) OR (_M_DIRECT==1)
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10000')
$P_WPFRAME=CTRANS()
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS()")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
ENDIF
_TC_P[5]=0 _TC_P[6]=0 _TC_P[7]=0
ENDIF
ELSE
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10000')
$P_WPFRAME=$P_WPFRAME:$P_PFRAME
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";additiv")
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=$P_WPFRAME:$P_PFRAME")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
ENDIF
ENDIF
ENDIF
TRANS
G[8]=_NVG8
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRANS")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
IF NOT (_CARR37 _DEC2)
N800101 _RAX1=AXNAME(_CARR35)
_A1_TR=$P_ACTFRAME[_RAX1,TR]
IF $MN_MM_FRAME_FINE_TRANS
_A1_TR=_A1_TR+$P_ACTFRAME[_RAX1,FI]
ENDIF
IF (_A1_TR<>0)
_A1_TR=_A1_TR-_CARR[24]
ENDIF
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
N800102 _RAX2=AXNAME(_CARR36)
_A2_TR=$P_ACTFRAME[_RAX2,TR]
IF $MN_MM_FRAME_FINE_TRANS
_A2_TR=_A2_TR+$P_ACTFRAME[_RAX2,FI]
ENDIF
IF (_A2_TR<>0)
_A2_TR=_A2_TR-_CARR[25]
ENDIF
ENDIF
_TC_MODE=_MODE
IF (_M_DIRECT==1) GOTOF _NOANGLES
IF (((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4)) AND (_SD55221_5==1)) GOTOF _NOANGLES
IF (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H2000')<>0) ;Polstellung nicht in Grundstellung aktiv SD55221_13
_AXROT=$P_ACTFRAME[_XX,RT]+$P_ACTFRAME[_YY,RT]+$P_ACTFRAME[_ZZ,RT]-$P_WPFRAME[_XX,RT]-$P_WPFRAME[_YY,RT]-$P_WPFRAME[_ZZ,RT]
ELSE
_AXROT=0
ENDIF
IF _MODE<=0 GOTOF _ERR4
_SI1:
IF((_MODE B_AND 'B11000000')=='B01000000')
_WPFR=CTRANS(_XX,_X0,_YY,_Y0,_ZZ,_Z0):CROT(_ZZ,_A):CROT(_YY,_B):CTRANS(_XX,_X1,_YY,_Y1,_ZZ,_Z1)
_AXPOL=_A
ELSE
_AX1=_XX _AX2=_XX _AX3=_XX
IF((_MODE B_AND 'B000011')=='B000000') GOTOF _ERR4
IF((_MODE B_AND 'B000011')=='B000001')
_AX1=_XX
ENDIF
IF((_MODE B_AND 'B000011')=='B000010')
_AX1=_YY
ENDIF
IF((_MODE B_AND 'B000011')=='B000011')
_AX1=_ZZ
_AXPOL=_A
ENDIF
IF((_MODE B_AND 'B001100')=='B000000') GOTOF _ERR4
IF((_MODE B_AND 'B001100')=='B000100')
_AX2=_XX
ENDIF
IF((_MODE B_AND 'B001100')=='B001000')
_AX2=_YY
ENDIF
IF((_MODE B_AND 'B001100')=='B001100')
_AX2=_ZZ
_AXPOL=_B
ENDIF
IF(_AX1==_AX2) GOTOF _ERR4
IF((_MODE B_AND 'B110000')=='B000000') GOTOF _ERR4
IF((_MODE B_AND 'B110000')=='B010000')
_AX3=_XX
ENDIF
IF((_MODE B_AND 'B110000')=='B100000')
_AX3=_YY
ENDIF
IF((_MODE B_AND 'B110000')=='B110000')
_AX3=_ZZ
_AXPOL=_C
ENDIF
IF((_AX1==_AX3) OR (_AX2==_AX3)) GOTOF _ERR4
IF((_MODE B_AND 'B11000000')=='B10000000')
_WPFR=CTRANS(_XX,_X0,_YY,_Y0,_ZZ,_Z0):CROTS(_AX1,_A,_AX2,_B):CROT(_AX3,_C):CTRANS(_XX,_X1,_YY,_Y1,_ZZ,_Z1)
_AXPOL=_C
ELSE
IF _TC_A_WZ==0
_WPFR=CTRANS(_XX,_X0,_YY,_Y0,_ZZ,_Z0):CROT(_AX1,_A):CROT(_AX2,_B):CROT(_AX3,_C):CTRANS(_XX,_X1,_YY,_Y1,_ZZ,_Z1)
ELSE
IF (_TC_A_WZ==1)
IF _A>_Amax
_A=_Amax
ENDIF
IF _B>_Amax
_B=_Amax
ENDIF
IF _C>_Amax
_C=_Amax
ENDIF
IF _A<_Amin
_A=_Amin
ENDIF
IF _B<_Amin
_B=_Amin
ENDIF
IF _C<_Amin
_C=_Amin
ENDIF
ENDIF
_WPFR=CROT(_AX1,_A):CROT(_AX2,_B):CROT(_AX3,_C)
ENDIF
ENDIF
IF (_CARR36<>"") AND (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H2000')<>0)
IF ((_CARR[10]==0) AND (_CARR[11]<>0) AND (_CARR[12]==0))AND(_AXPOL==0)
IF((_MODE B_AND 'B000011')=='B000010')
_AXPOL=_A
ENDIF
IF((_MODE B_AND 'B001100')=='B001000')
_AXPOL=_B
ENDIF
IF((_MODE B_AND 'B110000')=='B100000')
_AXPOL=_C
ENDIF
ENDIF
IF ((_CARR[10]<>0) AND (_CARR[11]==0) AND (_CARR[12]==0))AND(_AXPOL==0)
IF((_MODE B_AND 'B000011')=='B000001')
_AXPOL=_A
ENDIF
IF((_MODE B_AND 'B001100')=='B000100')
_AXPOL=_B
ENDIF
IF((_MODE B_AND 'B110000')=='B010000')
_AXPOL=_C
ENDIF
ENDIF
ENDIF
IF $TC_CARR29[_TCI]>0
_AXPOL=ROUND(_AXPOL/$TC_CARR29[_TCI])*$TC_CARR29[_TCI]
ENDIF
IF $TC_CARR29[_TCI]>0
_AXPOL=ROUND(_AXPOL/$TC_CARR29[_TCI])*$TC_CARR29[_TCI]
ENDIF
ENDIF
_NOANGLES:
IF (_TRTYP AND ((_TCJOG==3) OR (_TCJOG==4))) GOTOF _M_TR
IF ((((_TCJOG>0) AND (_TCJOG<5)) OR ((_CARR37 _DEC1) > 2))AND(_M_DIRECT==1))
IF (_TCJOG==2) OR (_TCJOG==4)
REPEAT _SJ_A _SJ_E
G[8]=_NVG8
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
ENDIF
IF (_CARR23=="T")
IF _NV_AKT<5
_SERR=<<"F ROT ? G"<<_NV_AKT+53
ELSE
_SERR=<<"F ROT ? G"<<_NV_AKT+500
ENDIF
IF ($P_IFRAME[_XX,RT]<>0)OR($P_IFRAME[_YY,RT]<>0)OR($P_IFRAME[_ZZ,RT]<>0) GOTOF _ERR24
IF _SETFR
_SERR=<<"F ROT ? SETFRAME"
IF ($P_SETFRAME[_XX,RT]<>0)OR($P_SETFRAME[_YY,RT]<>0)OR($P_SETFRAME[_ZZ,RT]<>0) GOTOF _ERR24
ENDIF
IF _BFNR>=0
_SERR=<<"F ROT ? CHBRFRAME"
IF ($P_ACTBFRAME[_XX,RT]<>0)OR($P_ACTBFRAME[_YY,RT]<>0)OR($P_ACTBFRAME[_ZZ,RT]<>0) GOTOF _ERR24
ENDIF
ENDIF
IF _CARR[28] <> 0
_SERR=<<"C Hirth: "<<_CARR[28]<<" <-> "<<_A
_H_VAL[0]=_A*1000 _H_VAL[1]=$TC_CARR28[_TCI]*1000
IF (((_H_VAL[0]) MOD (_H_VAL[1])) <> 0) GOTOF _ERR24
ENDIF
IF ((_CARR[29] <> 0) AND (_CARR36<>""))
_SERR=<<"D Hirth: "<<_CARR[29]<<" <-> "<<_B
_H_VAL[2]=_B*1000 _H_VAL[3]=$TC_CARR29[_TCI]*1000
IF (((_H_VAL[2]) MOD (_H_VAL[3])) <> 0) GOTOF _ERR24
ENDIF
IF ((_A1_TR==0)AND(_A2_TR==0))
_SD55221_8=0
ENDIF
IF ((_MD21186==1)AND(_SD55221_8==1))
_A1_TR=0 _A2_TR=0
ENDIF
IF (_SD55221_8==0)
IF ((_MD21186==0) AND (((_WPOL<>1)AND(_A1_TR<>0)) OR ((_WPOL<>2)AND(_A2_TR<>0))))
REPEAT M_RAFA M_RAFE
ENDIF
IF ((_ST _DEC1)==1)
_SERR=<<"B"
IF _DIR==0 GOTOF _ERR24
_SERR=<<"H X0,Y0,Z0<>0 S_ST dec1<>0"
IF ((_X0<>0)OR(_Y0<>0)OR(_Z0<>0)) GOTOF _ERR24
IF NOT (_CARR37 _DEC2)
_A=_A+$P_EP[_RAX1]
ELSE
_A=_A+_TC_A1
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
_B=_B+$P_EP[_RAX2]
ELSE
_B=_B+_TC_A2
ENDIF
ENDIF
REPEAT _M_MOD_A _M_MOD_E
REPEAT _M_ERR9_A _M_ERR9_E
IF _CARR36==""
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]=0")
ENDIF
ELSE
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=_B
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]="<<_B)
ENDIF
ENDIF
REPEAT M_RA2 M_RE
IF (_CARR23<>"P")
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_SBI_FR:_TOOLFR
ELSE
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_TOOLFR
ENDIF
IF _TCPL>0
_SERR=<<"I Plane = G18 ?"
IF (_G17_18_19==2) GOTOF _ERR24
_SERR=<<"J MIRROR Z ?"
IF($P_ACTFRAME[_ZZ,MI]) GOTOF _ERR24
IF ((_TCPL==3)AND(_G17_18_19==1))
_SERR=<<"L not Y-Axis"
IF _NYY==1 GOTOF _ERR24
_WPFR=_WPFR:CROT(_YY,90)
ENDIF
IF ((_TCPL==1)AND(_G17_18_19==3))
_SERR=<<"K G19 ?"
GOTOF _ERR24
ENDIF
ENDIF
_WPFR=CTRANS(_XX,_X0,_YY,_Y0,_ZZ,_Z0):_WPFR
_WPFR=_WPFR:CROT(_APPL,_C):CTRANS(_XX,_X1,_YY,_Y1,_ZZ,_Z1)
_RA_KOMP=1
ELSE
IF ((_ST _DEC1)==1)
_SERR=<<"B"
IF _DIR==0 GOTOF _ERR24
_SERR=<<"H X0,Y0,Z0<>0 S_ST dec1<>0"
IF ((_X0<>0)OR(_Y0<>0)OR(_Z0<>0)) GOTOF _ERR24
IF NOT (_CARR37 _DEC2)
_A=_A+$P_EP[_RAX1]
ELSE
_A=_A+_TC_A1
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
_B=_B+$P_EP[_RAX2]
ELSE
_B=_B+_TC_A2
ENDIF
ENDIF
_A=_A+_A1_TR
IF NOT ((_CARR23=="P") AND(_A1_TR==0))
_B=_B+_A2_TR
ENDIF
REPEAT _M_MOD_A _M_MOD_E
REPEAT _M_ERR9_A _M_ERR9_E
IF _CARR36==""
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]=0")
ENDIF
ELSE
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=_B
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]="<<_B)
ENDIF
ENDIF
REPEAT M_RA2 M_RA3
IF (_CARR23<>"P")
IF ((_WPOL==1) AND (_A<>0))
$P_WPFRAME=CROT(_APPL,_A)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CROT("<<AXSTRING(_APPL)<<","<<_A<<")")
ENDIF
ENDIF
ELSE
IF (_A1_TR==0)
_B=_B+_A2_TR
ENDIF
ENDIF
REPEAT _HGGA _HGGE
IF ((_ST _DEC1)==1)
_A=_A-_A1_TR
IF _CARR36==""
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]=0")
ENDIF
ELSE
_B=_B-_A2_TR
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=_B
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]="<<_B)
ENDIF
ENDIF
ENDIF
_TOOLFR=$P_TOOLFRAME:$P_WPFRAME
_TOOLFR[_XX,TR]=0 _TOOLFR[_YY,TR]=0 _TOOLFR[_ZZ,TR]=0
$P_WPFRAME=$P_WPFR
TCARR=0
TOROTOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=$P_WPFR")
WRITE(_LOG,_LOG_FILE,"TCARR=0")
WRITE(_LOG,_LOG_FILE,"TOROTOF")
ENDIF
IF (_CARR23<>"P")
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_SBI_FR:_TOOLFR
ELSE
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_TOOLFR
ENDIF
IF _TCPL>0
_SERR=<<"I Plane = G18 ?"
IF (_G17_18_19==2) GOTOF _ERR24
_SERR=<<"J MIRROR Z ?"
IF($P_ACTFRAME[_ZZ,MI]) GOTOF _ERR24
IF ((_TCPL==3)AND(_G17_18_19==1))
_SERR=<<"L not Y-Axis"
IF _NYY==1 GOTOF _ERR24
_WPFR=_WPFR:CROT(_YY,90)
ENDIF
IF ((_TCPL==1)AND(_G17_18_19==3))
_SERR=<<"K G19 ?"
GOTOF _ERR24
ENDIF
ENDIF
_WPFR=CTRANS(_XX,_X0,_YY,_Y0,_ZZ,_Z0):_WPFR
_WPFR=_WPFR:CROT(_APPL,_C):CTRANS(_XX,_X1,_YY,_Y1,_ZZ,_Z1)
_RA_KOMP=1
ENDIF
ENDIF
_M_TR:
IF ((_TCJOG>0) AND (_TCJOG<5))
IF (((_ST _DEC1)==0) AND ((_TCJOG==3) OR (_TCJOG==4)))
$P_WPFRAME=CTRANS()
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS()")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
ENDIF
ENDIF
IF (_TCJOG==2) OR (_TCJOG==4)
IF (_ST _DEC1)==0
REPEAT _SJ_A _SJ_E
ENDIF
IF _NV_AKT>0
$P_UIFR[_NV_AKT]=$P_UIFR[_NV_AKT]:_WPFR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_UIFR["<<_NV_AKT<<"]="<<AXSTRING(_XX)<<","<<$P_UIFR[_NV_AKT,_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_UIFR[_NV_AKT,_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_UIFR[_NV_AKT,_ZZ,TR]<<")")
WRITE(_LOG,_LOG_FILE,"$P_UIFR["<<_NV_AKT<<"]=$P_UIFR["<<_NV_AKT<<"]:CROT("<<AXSTRING(_XX)<<","<<$P_UIFR[_NV_AKT,_XX,RT]<<","<<AXSTRING(_YY)<<","<<$P_UIFR[_NV_AKT,_YY,RT]<<","<<AXSTRING(_ZZ)<<","<<$P_UIFR[_NV_AKT,_ZZ,RT]<<")")
ENDIF
_TEMP=ADDFRAME(_WPFR,"$P_UIFR[_NV_AKT]")
ELSE
IF _SETFR
$P_SETFR=$P_SETFR:_WPFR
_TEMP=ADDFRAME(_WPFR,"$P_SETFR")
ELSE
IF _BFNR
$P_CHBFR[_BFNR]=$P_CHBFR[_BFNR]:_WPFR
_TEMP=ADDFRAME(_WPFR,"$P_CHBFR[_BFNR]")
ENDIF
ENDIF
ENDIF
ENDIF
IF (_TCJOG==1) OR (_TCJOG==3)
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10000')
$P_WPFRAME=$P_WPFRAME:_WPFR
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<"):CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
ENDIF
ENDIF
ENDIF
IF (_TCJOG==3) OR (_TCJOG==4)
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100')
PAROTOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"PAROTOF")
ENDIF
ENDIF
TOROTOF
$MC_TOOL_CARRIER_RESET_VALUE=0
G[8]=_NVG8
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TOROTOF")
WRITE(_LOG,_LOG_FILE,"$MC_TOOL_CARRIER_RESET_VALUE=0")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
IF (_TCBA==99)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800("<<(_G17_18_19+56)<<",,,"<<_VG0<<")")
ENDIF
CUST_800(_G17_18_19+56,,,_VG0)
ENDIF
GOTOF _RET
ENDIF
ELSE
IF (((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4)) AND (_SD55221_5==1))
ELSE
_OLDFR=$P_WPFRAME
$P_WPFRAME=$P_WPFRAME:_WPFR
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<":CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
ENDIF
ENDIF
ENDIF
G[8]=_NVG8
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
IF (((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4)) AND (_SD55221_5==1)) GOTOF M_RA1
IF ((_SD55221_8==1)AND(_M_DIRECT==1)) GOTOF M_RA1
IF _MD21186==1 GOTOF M_RA1
IF ((_WPOL<>1)AND(_A1_TR<>0)) OR ((_WPOL<>2)AND(_A2_TR<>0))
IF ((_ST _DEC1)==0)
IF (((_TCJOG==2)OR(_TCJOG==4)) AND (_M_DIRECT==1))
IF ((_A1_TR==0) AND (_A2_TR==0)) GOTOF M_RA1
_A=_A+_A1_TR
_B=_B+_A2_TR
REPEAT _M_MOD_A _M_MOD_E
REPEAT _M_ERR9_A _M_ERR9_E
IF _CARR36==""
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]=0")
ENDIF
ELSE
$TC_CARR13[_TCI]=_A $TC_CARR14[_TCI]=_B
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]="<<_B)
ENDIF
ENDIF
REPEAT M_RA M_RE
IF (_CARR23<>"P")
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_SBI_FR:_TOOLFR
ELSE
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_TOOLFR
ENDIF
_TC_P[5]=_WPFR[_ZZ,RT] _TC_P[6]=_WPFR[_YY,RT] _TC_P[7]=_WPFR[_XX,RT]
$P_WPFRAME=_WPFR
$P_WPFR=$P_WPFRAME
G[8]=_NVG8
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<"):CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
ELSE
M_RAFA:
REPEAT _M_ERR9_A _M_ERR9_E
IF ((_CARR37 _DEC2)==0)
$TC_CARR13[_TCI]=_A1_TR $TC_CARR14[_TCI]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<_A<<" $TC_CARR14["<<_TCI<<"]=0")
ENDIF
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
$TC_CARR14[_TCI]=_A2_TR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," $TC_CARR14["<<_TCI<<"]="<<_A2_TR)
ENDIF
ENDIF
REPEAT M_RA M_RE
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_SBI_FR:_TOOLFR
_TC_P[5]=_WPFR[_ZZ,RT] _TC_P[6]=_WPFR[_YY,RT] _TC_P[7]=_WPFR[_XX,RT]
M_RAFE:
$P_WPFRAME=_WPFR:$P_WPFRAME
$P_WPFR=$P_WPFRAME
G[8]=_NVG8
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<"):CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
WRITE(_LOG,_LOG_FILE,"$P_WPFR=$P_WPFRAME")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
ENDIF
ENDIF
_RA_KOMP=1
ENDIF
IF $P_PROG[$P_STACK-1]=="_N_CYCLE132_SPF"
IF ((_ST _DEC1)==1)
_SD55221_8=1
IF (($P_WPFRAME[_XX,RT]==0)AND($P_WPFRAME[_YY,RT]==0)AND($P_WPFRAME[_ZZ,RT]==0))
_A1_TR=E_MESS[11]
_A2_TR=E_MESS[13]
ELSE
_A1_TR=E_MESS[11]-E_MESS[10]
_A2_TR=E_MESS[13]-E_MESS[12]
ENDIF
IF ((_CARR37 _DEC2)==0)
$TC_CARR13[_TCI]=_A1_TR $TC_CARR14[_TCI]=0
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
$TC_CARR14[_TCI]=_A2_TR
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<$TC_CARR13[_TCI]<<" $TC_CARR14["<<_TCI<<"]="<<$TC_CARR14[_TCI])
ENDIF
REPEAT M_RA M_RE
_WPFR=INVFRAME(_SBI_FR):INVFRAME(_WPFR):_SBI_FR:_TOOLFR
_TC_P[5]=_WPFR[_ZZ,RT] _TC_P[6]=_WPFR[_YY,RT] _TC_P[7]=_WPFR[_XX,RT]
$P_WPFRAME=_WPFR:$P_WPFRAME
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<":CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
WRITE(_LOG,_LOG_FILE,"P_WPFR=$P_WPFRAME")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
ENDIF
G[8]=_NVG8
_A1_TR=E_MESS[11]
_A2_TR=E_MESS[13]
_RA_KOMP=1
ENDIF
ENDIF
M_RA1:
IF ((_DIR==3) OR (_DIR==4)) AND (_TCBA==20)
$TC_CARR13[_TCI]=$P_EPM[_RAX1] $TC_CARR14[_TCI]=0
IF (_CARR36<>"")
$TC_CARR14[_TCI]=$P_EPM[_RAX2]
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<$TC_CARR13[_TCI]<<" $TC_CARR14["<<_TCI<<"]="<<$TC_CARR14[_TCI])
ENDIF
IF (_DIR==4)
_TCBA=0
ENDIF
ENDIF
IF (((_TC_A_WZ==2)OR(_TC_A_WZ==3)OR(_TC_A_WZ==4)) AND ((_CARR37 _DEC5)>1) AND (_SD55221_5==0))
IF ((_CARR[7]==0)AND(_CARR[8]<>0)AND(_CARR[9]==0))
IF(_RAX1A >= 360)
_SERR=<<"B Angle area >= 360"
GOTOF _ERR21
ENDIF
IF (_CARR36<>"")
IF (_CARR[11]<>0)OR((_CARR[10]<>0)AND(_CARR[12]<>0))
_SERR=<<"D Rotary axis vector V2"
GOTOF _ERR21
ENDIF
ENDIF
ELSE
IF (_CARR[7]<>0)OR(_CARR[9]<>0)
_SERR=<<"C Rotary axis vector V1<>0 1 0"
ENDIF
GOTOF _ERR21
ENDIF
ENDIF
IF (((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4)) AND (_SD55221_5==1)) GOTOF _M_AWZ
REPEAT M_FRA M_FRE
IF $P_TCSOL==0 GOTOF _ERR4
IF (_TC_A_WZ==1)
IF _TC_DIR
_DIR=_TC_DIR
ELSE
_DIR=-1
ENDIF
ELSE
IF (_DIR==1) OR (_DIR==-1)
_TC_DIR=_DIR
ENDIF
IF (_DIR==0)
IF ((_ST _DEC5)==1)
_TC_DIR=-1
ENDIF
IF ((_ST _DEC5)==2)
_TC_DIR=1
ENDIF
ENDIF
ENDIF
_A1=$P_TCANG[1] _A2=$P_TCANG[2]
_A3=$P_TCANG[3] _A4=$P_TCANG[4]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,";$P_TCANG[1..]="<<$P_TCANG[1]<<" "<<$P_TCANG[2]<<" || "<<$P_TCANG[3]<<" "<<$P_TCANG[4]<<" ")
ENDIF
IF (($P_TCSOL==2)AND(_M_DIRECT==0))
IF (_DIR==3) OR (_DIR==4)
ELSE
IF ((_DIR<0) OR ((_DIR==0)AND((_ST _DEC5)==1)))
_DIRR=-1
ENDIF
IF ((_DIR>0) OR ((_DIR==0)AND((_ST _DEC5)==2)))
_DIRR=1
ENDIF
_DIRM=_CARR37 _DEC4
IF _DIRM > 4
_DIRM=_DIRM - 5
ENDIF
IF (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B10000000') AND (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H2000')==0))
IF _DIRM==3
_DIRM=1
ENDIF
IF _DIRM==4
_DIRM=2
ENDIF
ENDIF
IF ((_ZSD[14]==1) OR (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B10000')==0)OR (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H2000')<>0) )
_SWP=1
ENDIF
IF ((((_ST _DEC3)==2)OR((_ST _DEC3)==3))AND((_CARR37 _DEC5)>1))
_SWP=2
ENDIF
IF ((_SWP==1) AND (_DIRM==3) AND (ABS(_A1-_A3)<_EPS))
IF (_CARR36<>"")
IF ((_ST _DEC1)==1)
_AXPOL=_AXPOL + $P_EP[_RAX2]
ELSE
_AXPOL=_AXPOL+_AXROT
ENDIF
IF ((_CARR37 _DEC3)==0)
IF ($MA_DISPLAY_IS_MODULO[_RAX2]==1)
_AXPOL=(_AXPOL + 360) MOD 360
ENDIF
_RAX2_360_A:
IF ((_RAX2A >= 360) AND ($MA_ROT_IS_MODULO[_RAX2]==0) AND(_CARR36<>""))
IF ((ABS(_A1-_A3)<_EPS) AND (ABS(_A2-_A4)<_EPS))
IF _A1<0
$TC_CARR13[_TCI]=0 $TC_CARR14[_TCI]=_A2+360
ELSE
$TC_CARR13[_TCI]=0 $TC_CARR14[_TCI]=_A2-360
ENDIF
REPEAT M_FRA M_FRE
_A3=$P_TCANG[1] _A4=$P_TCANG[2]
IF (ABS(_A2-_A4)<_EPS)
IF ((_DIRR*_A1<_DIRR*_A3))
_A1=_A3 _A2=_A4
ENDIF
ENDIF
GOTOF _MP1
ELSE
$TC_CARR13[_TCI]=0 $TC_CARR14[_TCI]=_AXPOL
REPEAT M_FRA M_FRE
_A1=$P_TCANG[1] _A2=$P_TCANG[2]
_A3=$P_TCANG[3] _A4=$P_TCANG[4]
ENDIF
ENDIF
_RAX2_360_E:
ENDIF
ENDIF
IF (($P_TCSOL==2) AND (ABS(_A1-_A3)<_EPS) AND (((ABS(_AXPOL-_A2)<_EPS) AND (_DIRR==-1)) OR ((ABS(_AXPOL-_A4)<_EPS) AND (_DIRR==1))))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
GOTOF _MP1
ENDIF
IF ((_SWP==1) AND (_DIRM==4) AND (ABS(_A2-_A4)<_EPS))
IF ((_ST _DEC1)==1)
_AXPOL=_AXPOL + $P_EP[_RAX1]
ELSE
_AXPOL=_AXPOL+_AXROT
ENDIF
IF ((_CARR37 _DEC2)==0)
IF ($MA_DISPLAY_IS_MODULO[_RAX1]==1)
_AXPOL=(_AXPOL + 360) MOD 360
ENDIF
_RAX1_360_A:
IF ((_RAX1A >= 360) AND ($MA_ROT_IS_MODULO[_RAX1]==0))
IF ((ABS(_A1-_A3)<_EPS) AND (ABS(_A2-_A4)<_EPS))
IF _A1<0
$TC_CARR13[_TCI]=_A1+360 $TC_CARR14[_TCI]=0
ELSE
$TC_CARR13[_TCI]=_A1-360 $TC_CARR14[_TCI]=0
ENDIF
REPEAT M_FRA M_FRE
_A3=$P_TCANG[1] _A4=$P_TCANG[2]
IF (ABS(_A2-_A4)<_EPS)
IF ((_DIRR*_A1<_DIRR*_A3))
_A1=_A3 _A2=_A4
ENDIF
ENDIF
GOTOF _MP1
ELSE
$TC_CARR13[_TCI]=_AXPOL $TC_CARR14[_TCI]=0
REPEAT M_FRA M_FRE
_A1=$P_TCANG[1] _A2=$P_TCANG[2]
_A3=$P_TCANG[3] _A4=$P_TCANG[4]
ENDIF
ENDIF
_RAX1_360_E:
ENDIF
IF (($P_TCSOL==2) AND (ABS(_A2-_A4)<_EPS) AND (((ABS(_AXPOL-_A1)<_EPS) AND (_DIRR==-1)) OR ((ABS(_AXPOL-_A3)<_EPS) AND (_DIRR==1))))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
GOTOF _MP1
ENDIF
IF (_SWP==2)
IF ((_B==(ROUND(_A3*1000)/1000))AND(_C==(ROUND(_A4*1000)/1000)))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
_SWP=1
GOTOF _MP1
ENDIF
IF (((_DIRM==2) OR (_DIRM==4)) AND (_DIRR*_A2<_DIRR*_A4))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
IF ((_DIRM==4) AND (ABS(_A2-_A4)<_EPS) AND (_DIRR<0))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
IF (((_DIRM==1) OR (_DIRM==3)) AND (_DIRR*_A1<_DIRR*_A3))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
IF ((_DIRM==3) AND (ABS(_A1-_A3)<_EPS) AND (_DIRR<0))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
ENDIF
_MP1:
IF ((($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H800')<>0) AND (($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'H2000')==0))
IF (_DIRM==3)OR(_DIRM==4)
IF ((((_DIRM==3)AND(ABS(_A1-_A3)<_EPS)) OR ((_DIRM==4)AND(ABS(_A2-_A4)<_EPS)))AND(_SOL2==0)AND(_DIRR<0))
_A1=_A3 _A2=_A4 _SOL2=1
ENDIF
ENDIF
ENDIF
ENDIF
IF (($P_TCSOL==1)AND(_M_DIRECT==0))
IF ((_DIR<0) OR ((_DIR==0)AND((_ST _DEC5)==1)))
_DIRR=-1
ENDIF
IF ((_DIR>0) OR ((_DIR==0)AND((_ST _DEC5)==2)))
_DIRR=1
ENDIF
IF NOT (_CARR36=="")
REPEAT _RAX2_360_A _RAX2_360_E
ENDIF
REPEAT _RAX1_360_A _RAX1_360_E
ENDIF
IF (_M_DIRECT==1)
IF ((_SD55221_8==0) OR ((_SD55221_8==1)AND((_ST _DEC1)==1)))
IF NOT((_TCJOG==2) OR (_TCJOG==4))
_A=_A+_A1_TR
_B=_B+_A2_TR
ENDIF
ENDIF
_A1=_A _A2=_B
ENDIF
$TC_CARR13[_TCI]=_A1 $TC_CARR14[_TCI]=_A2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13["<<_TCI<<"]="<<$TC_CARR13[_TCI]<<" $TC_CARR14["<<_TCI<<"]="<<$TC_CARR14[_TCI])
ENDIF
IF ((_CARR23<>"T") AND (_WPOL==2) AND (_A1_TR==0) AND (_A2_TR<>0) AND (_M_DIRECT==1))
$TC_CARR14[_TCI]=_A2-_A2_TR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," $TC_CARR14["<<_TCI<<"]="<<$TC_CARR14[_TCI]<<"  ; workoffset rotary")
ENDIF
ENDIF
IF _CARR36==""
$TC_CARR14[_TCI]=0
ENDIF
IF _SOL2==1
REPEAT M_FRA M_FRE
ENDIF
IF ((_CARR37 _DEC2)==0)
IF (ABS(_A1)==360) AND ((_SWP==0) OR ((_SWP==1) AND ($MA_ROT_IS_MODULO[_RAX1]==1)))
_A1=0
ENDIF
ENDIF
IF ((_CARR36<>"")AND((_CARR37 _DEC3)==0))
IF (ABS(_A2)==360) AND ((_SWP==0) OR ((_SWP==1) AND ($MA_ROT_IS_MODULO[_RAX2]==1)))
_A2=0
ENDIF
ENDIF
_TC_A1=ROUND(_A1*1000)/1000
_TC_A2=ROUND(_A2*1000)/1000
_DNR=$P_TOOL _TNR=$P_TOOLNO
IF (ISVAR("$TC_DPV") AND ($MN_MM_ENABLE_TOOL_ORIENT>=2))
IF ($P_TOOLFRAME[_XX,RT]<>0) OR ($P_TOOLFRAME[_YY,RT]<>0) OR ($P_TOOLFRAME[_ZZ,RT]<>0)
_WWZ=_WWZ+1
ENDIF
IF (_TNR AND _DNR)
IF ($TC_DPV3[_TNR,_DNR]) OR ($TC_DPV4[_TNR,_DNR]) OR ($TC_DPV5[_TNR,_DNR])
_WWZ=1
ENDIF
ENDIF
ENDIF
IF ((_TNR>0) AND (ISVAR("$A_TOOLMTADAPT")))
IF $A_TOOLMTADAPT[_TNR]>0
_WWZ=1
ENDIF
ENDIF
IF (_M_DIRECT==1)
TCOABS TCARR=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," TCOABS TCARR="<<_TCI)
ENDIF
ENDIF
PAROT
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," PAROT")
ENDIF
IF _WWZ
REPEAT _HGGA _HGGE
ENDIF
IF ((_HIRTH==1) AND (($P_TCDIFF[1]<>0) OR ($P_TCDIFF[2]<>0)))
REPEAT _HGGA _HGGE
ENDIF
_TC_NUM=_TCI
$MC_TOOL_CARRIER_RESET_VALUE=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," $MC_TOOL_CARRIER_RESET_VALUE="<<_TCI)
ENDIF
D=$P_TOOL DL=$P_DLNO
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"D="<<$P_TOOL<<" DL="<<$P_DLNO)
ENDIF
_M_AWZ:
IF (_TC_A_WZ)
IF (((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4)) AND (_SD55221_5==1))
_SERR=<<"H Plane <> G18 ?"
IF ((_TCPL>0) AND (_G17_18_19<>2) AND (_TC_A_WZ==2)) GOTOF _ERR21 ;TFS539501: fr Ausrichten Frswerkzeug muss eine Ebene<>G18 zugelassen werden.
IF (_TCPL==3)
IF(($P_ACTFRAME[_ZZ,MI])AND(SUBSTR($P_PROG[$P_STACK-1],3,8)<>"CYCLE805"))
_B=90-_B
_C=_C+180
ELSE
_B=_B-90
ENDIF
ELSE
IF(($P_ACTFRAME[_ZZ,MI])AND(SUBSTR($P_PROG[$P_STACK-1],3,8)<>"CYCLE805"))
_B=180-_B
_C=_C+180
ENDIF
ENDIF
IF(_B<_CARR[30])
_B=_B+360
ENDIF
IF(_B>_CARR[32])
_B=_B-360
ENDIF
_SERR=<<"E WCS ROT Y > 90"
IF ((ABS($P_ACTFRAME[_XX,RT])) AND (ABS($P_ACTFRAME[_ZZ,RT]))) GOTOF _ERR21
$TC_CARR13[_TCI]=_B + _CARR[24] + $P_ACTFRAME[_YY,RT] $TC_CARR14[_TCI]=0
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
$TC_CARR14[_TCI]=_C + _CARR[25]
ENDIF
CUT2DF TCARR=_TCI TCOABS
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," $TC_CARR14["<<_TCI<<"]="<<$TC_CARR14[_TCI]<<"  ; workoffset rotary")
WRITE(_LOG,_LOG_FILE," CUT2DF TCARR="<<_TCI<<" TCOABS")
ENDIF
_A1=$TC_CARR13[_TCI] _A2=$TC_CARR14[_TCI]
_A2=(((_A2 MOD 360)+360) MOD 360)
IF _HIRTH
_A1=ROUND(1000*(_A1+$P_TCDIFF[1]))/1000 _A2=ROUND(1000*(_A2+$P_TCDIFF[2]))/1000
ENDIF
_TC_NUM=_TCI
$MC_TOOL_CARRIER_RESET_VALUE=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TC_NUM="<<_TCI)
WRITE(_LOG,_LOG_FILE,"$MC_TOOL_CARRIER_RESET_VALUE="<<_TCI)
ENDIF
ELSE
$P_WPFRAME=_OLDFR
$P_WPFR=$P_WPFRAME
G[8]=_NVG8
PAROT
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<"):CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
WRITE(_LOG,_LOG_FILE,"P_WPFR=$P_WPFRAME")
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NVG8)
WRITE(_LOG,_LOG_FILE,"PAROT")
ENDIF
ENDIF
IF ((_TC_A_WZ==2) OR (_TC_A_WZ==3) OR (_TC_A_WZ==4) OR (_TC_A_WZ==9))
IF(ISVAR("$P_CUTMODK"))
IF($P_CUTMODK)
CUTMODK="OFF"
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUTMODK='"'OFF'"'")
ENDIF
ENDIF
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,8)<>"CYCLE805")
IF ISVAR("$P_CUTMOD")
CUTMOD=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUTMOD="<<_TCI)
ENDIF
ENDIF
ENDIF
TCARR=_TCI TCOABS
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR="<<_TCI<<" TCOABS")
ENDIF
ENDIF
ENDIF
IF _TEMP_ON
WRITE(_TEMP,_TEMP_FILE,";Anzahl Lsungen $P_TCSOL:"<<$P_TCSOL<<" Lsungen: $P_TCANG:"<<TRUNC($P_TCANG[1]*$MN_INT_INCR_PER_DEG)/$MN_INT_INCR_PER_DEG<<"/"<<TRUNC($P_TCANG[2]*$MN_INT_INCR_PER_DEG)/$MN_INT_INCR_PER_DEG<<"  "<<TRUNC($P_TCANG[3]*$MN_INT_INCR_PER_DEG)/$MN_INT_INCR_PER_DEG<<"/"<<TRUNC($P_TCANG[4]*$MN_INT_INCR_PER_DEG)/$MN_INT_INCR_PER_DEG)
WRITE(_TEMP,_TEMP_FILE,";A1/A2:"<<_A1<<" "<<_A2<<" $TC_CARR13/14:"<<$TC_CARR13[_TCI]<<" "<<$TC_CARR14[_TCI])
ENDIF
IF (NOT _DIR==0) AND (NOT _TCBA==0)
IF (NOT $P_SEARCH)
_TCRD=0 _SERR=<<""
IF ((_CARR37 _DEC2)==1)
_SERR=<<(SUBSTR(_CARR35,0,5))<<": "<<_TC_A1
_TCRD=1
ENDIF
IF (((_CARR37 _DEC3)==1)AND(_CARR36<>""))
IF _SERR==""
_SERR=<<(SUBSTR(_CARR36,0,5))<<": "<<_TC_A2
_TCRD=1
ELSE
_SERR=<<(SUBSTR(_CARR35,0,5))<<": "<<_TC_A1<<"  "<<(SUBSTR(_CARR36,0,5))<<": "<<_TC_A2
_TCRD=_TCRD+1
ENDIF
ENDIF
IF (_TCRD==1)
STOPRE
N800181 SETAL(62181,_SERR)
ENDIF
IF (_TCRD==2)
STOPRE
N800180 SETAL(62180,_SERR)
ENDIF
IF _HIRTH AND (_ISO<>1) AND ((ROUND($P_TCDIFF[1]*100000)/100000) OR (ROUND($P_TCDIFF[2]*100000)/100000))
CUST_800(10,_TCI,_A1,_A2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," CUST_800(10,"<<_TCI<<","<<_A1<<","<<_A2<<")")
ENDIF
ENDIF
ENDIF
IF _TCJOG
IF ((_CARR37 _DEC2)==0)
_VG0=($MA_JOG_VELO_RAPID[_RAX1]/$MA_MAX_AX_VELO[_RAX1])*100
ELSE
IF ((_CARR37 _DEC3)==0) AND (_CARR36<>"")
_VG0=($MA_JOG_VELO_RAPID[_RAX2]/$MA_MAX_AX_VELO[_RAX2])*100
ENDIF
ENDIF
IF (_VG0 > 100)
_VG0=100
ENDIF
ENDIF
IF (_SD55221_8==0)
IF ((_CARR37 _DEC2)==0)
IF ISVAR("$P_WPFR")
$P_WPFRAME[_RAX1,TR]=0
IF (_RA_KOMP)
$P_WPFRAME[_RAX1,TR]=-_A1_TR
ENDIF
$P_WPFR[_RAX1,TR]=$P_WPFRAME[_RAX1,TR]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME["<<AXSTRING(_RAX1)<<",TR]="<<$P_WPFRAME[_RAX1,TR]<<"  $P_WPFR["<<AXSTRING(_RAX1)<<",TR]="<<$P_WPFRAME[_RAX1,TR])
ENDIF
ENDIF
ENDIF
IF ((_CARR36<>"") AND ((_CARR37 _DEC3)==0))
IF ISVAR("$P_WPFR")
$P_WPFRAME[_RAX2,TR]=0
IF (_RA_KOMP)
$P_WPFRAME[_RAX2,TR]=-_A2_TR
ENDIF
$P_WPFR[_RAX2,TR]=$P_WPFRAME[_RAX2,TR]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME["<<AXSTRING(_RAX2)<<",TR]="<<$P_WPFRAME[_RAX2,TR]<<"  $P_WPFR["<<AXSTRING(_RAX2)<<",TR]="<<$P_WPFRAME[_RAX2,TR])
ENDIF
ENDIF
ENDIF
ELSE
IF ((_MD21186==0) AND (_RA_KOMP==1))
_A1=_A1-_A1_TR
_A2=_A2-_A2_TR
ENDIF
ENDIF
IF (_TC_N_WZ==1)
TCARR=_TCI TCOABS
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR="<<_TCI<<" TCOABS")
ENDIF
ENDIF
_TC_POS_DIR=0
IF(_CARR23<>"T")AND((_TCBA==20)OR(_TCBA==21)OR(_TCBA==22))
IF((_ST _DEC9)==1)
_TC_POS_DIR=1
ENDIF
IF((_ST _DEC9)==2)
_TC_POS_DIR=-1
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; _TC_POS_DIR="<< _TC_POS_DIR)
ENDIF
IF _SD55221_12==1
IF ((_CARR37 _DEC2)==0)
$TC_CARR21[_TCI]=AXNAME($TC_CARR35[_TCI])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR21["<<_TCI<<"]="<<($TC_CARR35[_TCI]))
ENDIF
ENDIF
IF (((_CARR37 _DEC3)==0)AND(_CARR36<>""))
$TC_CARR22[_TCI]=AXNAME($TC_CARR36[_TCI])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR22["<<_TCI<<"]="<<($TC_CARR36[_TCI]))
ENDIF
ENDIF
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE805")
_A2=(_A2+$P_AD[36]+_MT_ANG+360)MOD 360
ENDIF
CUST_800(_TCBA,_TCI,_A1,_A2,_VG0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800("<<_TCBA<<","<<_TCI<<","<<_A1<<","<<_A2<<","<<_VG0<<") ")
ENDIF
IF _SD55221_12==1
STOPRE
$TC_CARR21[_TCI]=_XX $TC_CARR22[_TCI]=_XX
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR21["<<_TCI<<"]="<<AXSTRING(_XX)<<" $TC_CARR22["<<_TCI<<"]="<<AXSTRING(_XX))
ENDIF
ENDIF
_TC_POS_DIR=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; _TC_POS_DIR=0")
ENDIF
ENDIF
IF (NOT _DIR==0) AND (NOT _TCBA==0)
IF ((_CARR37 _DEC2)>0)
WRTPR("MANAX("<<_CARR35<<","<<_TC_A1<<")",1)
ENDIF
IF (((_CARR37 _DEC3)>0)AND(_CARR36<>""))
WRTPR("MANAX("<<_CARR36<<","<<_TC_A2<<")",1)
ENDIF
ENDIF
_TC_P[9]=_TC_P[9]+0.001
_RET:
IF (ISVAR("_TC_CHANGE")<>0)
_TC_CHANGE=""
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; _TC_CHANGE='"' '"'")
ENDIF
ENDIF
IF($P_GG[29]==4)
G[29]=_GG29
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[29]="<<_GG29)
ENDIF
ENDIF
IF _TCJOG GOTOF _RET1
IF (NOT ((_DIR==0) AND (_ISO==2)))
WRTPR("SWIVEL(0)",1)
ENDIF
REPEAT _SG6_A _SG6_E
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G4 F0")
WRITE(_LOG,_LOG_FILE,"M17")
ENDIF
G4 F0
M17
_RET1:
IF($P_GG[29]==4)
G[29]=_GG29
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[29]="<<_GG29)
ENDIF
ENDIF
IF (NOT ((_DIR==0) AND (_ISO==2)))
WRTPR("SWIVEL(0)",1)
ENDIF
REPEAT _SG6_A _SG6_E
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G4 F0")
WRITE(_LOG,_LOG_FILE,"RET")
ENDIF
G4 F0
RET
_SG6_A:
IF((_DMODE1>0)AND(_GS17_18_19<>_DMODE1))
G[6]=_GS17_18_19
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[6]="<<_GS17_18_19)
ENDIF
ENDIF
_SG6_E:
M_SIM_A:
IF(_ISO==0)OR(_ISO==2)
IF(_SWIV)AND((_TC_A_WZ==2)OR(_TC_A_WZ==9))
_SWIV=4
ENDIF
ENDIF
M_SIM_E:
M_FRA:
IF (_TCPL>0)
IF ((_TCPL==1) AND (_G17_18_19==3) AND ((_ST _DEC1)<>0)) GOTOF _ERR14
IF ((_TCPL==3) AND (_G17_18_19==1) AND ((_ST _DEC1)<>0)) GOTOF _ERR14
ENDIF
IF ((_LEN[0]<600) AND (_LEN[0]>399) AND ($SC_TOOL_ORI_CONST_T<>0))
_TMPFR=$P_WPFRAME
IF ($SC_TOOL_ORI_CONST_T==18)
$P_WPFRAME=$P_WPFRAME:CROT(_XX,-90)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=$P_WPFRAME:CROT("<<AXSTRING(_XX)<<",-90)")
ENDIF
ENDIF
IF ($SC_TOOL_ORI_CONST_T==19)
$P_WPFRAME=$P_WPFRAME:CROT(_YY,90)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=$P_WPFRAME:CROT("<<AXSTRING(_YY)<<",90)")
ENDIF
ENDIF
CUT2DF TCOFRY TCARR=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  CUT2DF TCOFRY TCARR="<<_TCI)
ENDIF
$P_WPFRAME=_TMPFR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=CROT(Z,"<<$P_WPFRAME[_ZZ,RT]<<"):CROT(Y,"<<$P_WPFRAME[_YY,RT]<<"):CROT(X,"<<$P_WPFRAME[_XX,RT]<<")")
ENDIF
GOTOF M_FRE
ENDIF
CASE _G17_18_19 OF 2 GOTOF _Y18 3 GOTOF _X19 DEFAULT GOTOF _Z17
_Y18:
CUT2DF TCOFRY TCARR=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUT2DF TCOFRY TCARR="<<_TCI)
ENDIF
GOTOF M_FRE
_X19:
_TMPFR=$P_WPFRAME
IF (_TCPL==3) AND ($P_ACTFRAME[_ZZ,MI])
$P_WPFRAME=$P_WPFRAME:CROT(_ZZ,-180)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=$P_WPFRAME:CROT("<<AXSTRING(_ZZ)<<",-180)")
ENDIF
ENDIF
IF (_TCPL==1)
_SERR=<<"J not Y-Axis"
IF _NYY==1 GOTOF _ERR21
$P_WPFRAME=CROT(_YY,90):$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=CROT("<<AXSTRING(_YY)<<",-90):$P_WPFRAME")
ENDIF
ENDIF
CUT2DF TCOFRX TCARR=_TCI
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUT2DF TCOFRX TCARR="<<_TCI)
ENDIF
$P_WPFRAME=_TMPFR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=CROT(Z,"<<$P_WPFRAME[_ZZ,RT]<<"):CROT(Y,"<<$P_WPFRAME[_YY,RT]<<"):CROT(X,"<<$P_WPFRAME[_XX,RT]<<")")
ENDIF
GOTOF M_FRE
_Z17:
_TMPFR=$P_WPFRAME
_H=11
_CAL[0]=SET(0,1,0,1)
CYCLE216(_CAL,_H)
IF (_TCPL==3)
_SERR=<<"J not Y-Axis"
IF _NYY==1 GOTOF _ERR21
IF ($P_ACTFRAME[_ZZ,MI])
$P_WPFRAME=$P_WPFRAME:CROT(_YY,90)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=$P_WPFRAME:CROT("<<AXSTRING(_YY)<<",90)")
ENDIF
ELSE
IF _CAL[1]<0
$P_WPFRAME=$P_WPFRAME:CROT(_YY,90)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=$P_WPFRAME:CROT("<<AXSTRING(_YY)<<",90)")
ENDIF
ELSE
$P_WPFRAME=$P_WPFRAME:CROT(_YY,-90)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=$P_WPFRAME:CROT("<<AXSTRING(_YY)<<",-90)")
ENDIF
ENDIF
ENDIF
ENDIF
CUT2DF TCOFR TCARR=_TCI
$P_WPFRAME=_TMPFR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUT2DF TCOFR TCARR="<<_TCI)
WRITE(_LOG,_LOG_FILE,"  $P_WPFRAME=CROT(Z,"<<$P_WPFRAME[_ZZ,RT]<<"):CROT(Y,"<<$P_WPFRAME[_YY,RT]<<"):CROT(X,"<<$P_WPFRAME[_XX,RT]<<")")
ENDIF
M_FRE:
M_RA:
IF _MD21186==1 GOTOF M_RE
M_RA2: _WPFR=_WPFR:CROT() _TOOLFR=CTRANS() _SBI_FR=CTRANS()
IF _SETFR
_SBI_FR=$P_SETFRAME
ENDIF
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10')
_SBI_FR=_SBI_FR:$P_EXTFRAME
ENDIF
IF _BFNR
_SBI_FR=_SBI_FR:$P_ACTBFRAME
ENDIF
_SBI_FR=_SBI_FR:$P_IFRAME
_SBI_RT[0]=_SBI_FR[_XX,RT] _SBI_RT[1]=_SBI_FR[_YY,RT] _SBI_RT[2]=_SBI_FR[_ZZ,RT]
_SBI_FR=CTRANS()
_SBI_FR[_XX,RT]=_SBI_RT[0] _SBI_FR[_YY,RT]=_SBI_RT[1] _SBI_FR[_ZZ,RT]=_SBI_RT[2]
IF NOT (_CARR37 _DEC2)
_SBI_FR[_RAX1,TR]=0
IF $MN_MM_FRAME_FINE_TRANS
_SBI_FR[_RAX1,FI]=0
ENDIF
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
_SBI_FR[_RAX2,TR]=0
IF $MN_MM_FRAME_FINE_TRANS
_SBI_FR[_RAX2,FI]=0
ENDIF
ENDIF
TCOABS TCARR=_TCI
PAROT
_WPFR=$P_PARTFRAME
_WPFR[_XX,TR]=0 _WPFR[_YY,TR]=0 _WPFR[_ZZ,TR]=0
PAROTOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCOABS TCARR="<<_TCI)
ENDIF
M_RA3:
IF (_CARR23<>"P")
IF (_M_DIRECT==1)
IF ((_WPOL==1) AND (_A<>0))
$P_WPFRAME=CROT(_APPL,_A)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CROT("<<AXSTRING(_APPL)<<","<<_A<<")")
ENDIF
ENDIF
ELSE
$P_WPFRAME=INVFRAME(_SBI_FR)
ENDIF
REPEAT _HGGA _HGGE
_TOOLFR=$P_TOOLFRAME:$P_WPFRAME
_TOOLFR[_XX,TR]=0 _TOOLFR[_YY,TR]=0 _TOOLFR[_ZZ,TR]=0
$P_WPFRAME=$P_WPFR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME=CTRANS("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,TR]<<","<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,TR]<<","<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,TR]<<"):CROT("<<AXSTRING(_ZZ)<<","<<$P_WPFRAME[_ZZ,RT]<<"):CROT("<<AXSTRING(_YY)<<","<<$P_WPFRAME[_YY,RT]<<":CROT("<<AXSTRING(_XX)<<","<<$P_WPFRAME[_XX,RT]<<")")
ENDIF
ENDIF
TCARR=0
TOROTOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR=0")
WRITE(_LOG,_LOG_FILE,"TOROTOF")
ENDIF
M_RE:
_SJ_A:
IF _NV_AKT>0
$P_UIFR[_NV_AKT,_ZZ,RT]=0 $P_UIFR[_NV_AKT,_YY,RT]=0 $P_UIFR[_NV_AKT,_XX,RT]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_UIFR["<<_NV_AKT<<","<<AXSTRING(_ZZ)<<",RT]=0 $P_UIFR["<<_NV_AKT<<","<<AXSTRING(_YY)<<",RT]=0 $P_UIFR["<<_NV_AKT<<","<<AXSTRING(_XX)<<",RT]=0 ")
ENDIF
_TEMP=ADDFRAME(_WPFR,"$P_UIFR[_NV_AKT]")
ELSE
IF _SETFR
$P_SETFR[_ZZ,RT]=0 $P_SETFR[_YY,RT]=0 $P_SETFR[_XX,RT]=0
$P_SETFRAME=$P_SETFR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_SETFR["<<_NV_AKT<<","<<AXSTRING(_ZZ)<<",RT]=0  $P_SETFR["<<_NV_AKT<<","<<AXSTRING(_YY)<<",RT]=0  $P_SETFR["<<_NV_AKT<<","<<AXSTRING(_XX)<<",RT]=0 ")
WRITE(_LOG,_LOG_FILE,"$P_SETFRAME=$P_SETFR")
ENDIF
_TEMP=ADDFRAME(_WPFR,"$P_SETFR")
ELSE
IF _BFNR
$P_CHBFR[_BFNR,_ZZ,RT]=0 $P_CHBFR[_BFNR,_YY,RT]=0 $P_CHBFR[_BFNR,_XX,RT]=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_CHBFR["<<_NV_AKT<<","<<AXSTRING(_ZZ)<<",RT]=0  $P_CHBFR["<<_NV_AKT<<","<<AXSTRING(_YY)<<",RT]=0  $P_CHBFR["<<_NV_AKT<<","<<AXSTRING(_XX)<<",RT]=0 ")
ENDIF
_TEMP=ADDFRAME(_WPFR,"$P_CHBFR[_BFNR]")
ENDIF
ENDIF
ENDIF
_SJ_E:
_M_MOD_A:
IF NOT (_CARR37 _DEC2)
IF($MA_ROT_IS_MODULO[_RAX1])
_MODR=$MA_MODULO_RANGE[_RAX1]
_MODS=$MA_MODULO_RANGE_START[_RAX1]
_A=((((_A-_MODS) MOD _MODR)+_MODR) MOD _MODR)+_MODS
ENDIF
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
IF($MA_ROT_IS_MODULO[_RAX2])
_MODR=$MA_MODULO_RANGE[_RAX2]
_MODS=$MA_MODULO_RANGE_START[_RAX2]
_B=((((_B-_MODS) MOD _MODR)+_MODR) MOD _MODR)+_MODS
ENDIF
ENDIF
_M_MOD_E:
_M_ERR9_A:
IF ((_M_DIRECT==1) AND NOT((_TCJOG==2) OR (_TCJOG==4)))
IF ((_CARR37 _DEC2)==0)
_SERR=<<" "<<_CARR35<<"="<<_A
IF (_A1_TR==0)
IF (_A < _CARR[30])OR(_A > _CARR[32]) GOTOF _ERR9
ELSE
IF _NV_AKT<5
_SERR=<<_SERR<<"  G"<<_NV_AKT+53<<" "<<_CARR35<<"="<<_A1_TR
ELSE
_SERR=<<_SERR<<"  G"<<_NV_AKT+500<<" "<<_CARR35<<"="<<_A1_TR
ENDIF
IF ($MA_ROT_IS_MODULO[_RAX1]==1)
IF (((_A+_A1_TR+360)MOD 360) > (_CARR[32]-_CARR[30])) GOTOF _ERR9
ELSE
IF (_SD55221_8==1)
IF ((_A < _CARR[30]) OR (_A > _CARR[32])) GOTOF _ERR9
ELSE
IF (((_A+_A1_TR) < _CARR[30]) OR ((_A+_A1_TR) > _CARR[32])) GOTOF _ERR9
ENDIF
ENDIF
ENDIF
ENDIF
IF (((_CARR37 _DEC3)==0) AND (_CARR36<>""))
_SERR=<<" "<<_CARR36<<"="<<_B
IF (_A2_TR==0)
IF (_B < _CARR[31])OR(_B > _CARR[33]) GOTOF _ERR9
ELSE
IF _NV_AKT<5
_SERR=<<_SERR<<"  G"<<_NV_AKT+53<<" "<<_CARR36<<"="<<_A2_TR
ELSE
_SERR=<<_SERR<<"  G"<<_NV_AKT+500<<" "<<_CARR36<<"="<<_A2_TR
ENDIF
IF ($MA_ROT_IS_MODULO[_RAX2]==1)
IF (((_B+_A2_TR+360)MOD 360) > (_CARR[33]-_CARR[31])) GOTOF _ERR9
ELSE
IF (_SD55221_8==1)
IF ((_B < _CARR[31]) OR (_B > _CARR[33])) GOTOF _ERR9
ELSE
IF (((_B+_A2_TR) < _CARR[31]) OR ((_B+_A2_TR) > _CARR[33])) GOTOF _ERR9
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_M_ERR9_E:
_HGGA:
CASE _G17_18_19 OF 2 GOTOF _HG18 3 GOTOF _HG19 DEFAULT GOTOF _HG17
_HG18: TOROTY
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TOROTY")
ENDIF
GOTOF _HGGE
_HG19: TOROTX
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TOROTX")
ENDIF
GOTOF _HGGE
_HG17: TOROT
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TOROT")
ENDIF
_HGGE:
_ERR0: STOPRE
N780000 SETAL(61180)
RET
_ERR1: STOPRE
N780001 SETAL(61181)
RET
_ERR2: STOPRE
N780002 SETAL(61182,_TC)
RET
_ERR3:
N780003 SETAL(61628,_SERR)
RET
_ERR4: STOPRE
N780004 SETAL(61184)
RET
_ERR5: STOPRE
N780005 SETAL(61185)
RET
_ERR6: STOPRE
N780006 SETAL(61186)
RET
_ERR7: STOPRE
N780007 SETAL(61187)
RET
_ERR8: STOPRE
N780008 SETAL(61188)
RET
_ERR9:
$TC_CARR13[_TCI]=0 $TC_CARR14[_TCI]=0
STOPRE
N780009 SETAL(61189,_SERR)
RET
_ERR11: STOPRE
N7800011 SETAL(61019,<<">$TC_CARR37["<<_TCI<<"] dec"<<_SERR<<"<")
RET
_ERR12: STOPRE
N780012 SETAL(61019,<<">MCALL<")
RET
_ERR13: STOPRE
N780013 SETAL(61019,<<">$SC_TOOL_LENGTH_CONST<")
RET
_ERR14: STOPRE
N780014 SETAL(61019,<<">S_ST dec1<")
RET
_ERR16: STOPRE
N780016 SETAL(61196)
RET
_ERR19: STOPRE
N780019 SETAL(61199,_SERR)
RET
_ERR26: STOPRE
IF _NV_AKT<5
_NV_AKT=_NV_AKT+53
ELSE
_NV_AKT=_NV_AKT+500
ENDIF
_SERR=<<_NV_AKT
N780026 SETAL(62186,_SERR)
RET
_ERR27: STOPRE
N780027 SETAL(62187)
RET
_ERR21: STOPRE
N780021 SETAL(61150,_SERR)
RET
_ERR22: STOPRE
N780022 SETAL(61151,_SERR)
RET
_ERR23: STOPRE
N780023 SETAL(61152,_SERR)
RET
_ERR24: STOPRE
N780024 SETAL(61153,_SERR)
RET
_ERR25: STOPRE
N780025 SETAL(61158)
RET
_ERR26A: STOPRE
N7800026 SETAL(61019,_SERR)
RET
_ERR28: STOPRE
N780028 SETAL(61148)
RET
_ERR29: STOPRE
N780029 SETAL(61149)
RET
_ERR30: STOPRE
N780030 SETAL(61174)
RET
_ERR31: STOPRE
N780031 SETAL(61195)
RET
_ERR32: STOPRE
N780032 SETAL(61550)
RET
_ERR33: STOPRE
N780033 SETAL(61551)
RET
_ERR34: STOPRE
N780034 SETAL(61552)
RET
_ERR35: STOPRE
N780035 SETAL(61553)
RET
_ERR36: STOPRE
N780036 SETAL(61019,_SERR)
RET
_ERR40: STOPRE
N780040 SETAL(61098,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE801_SPF
PROC CYCLE801(REAL _SPCA,REAL _SPCO,REAL _STA,REAL _DIS1,REAL _DIS2,INT _NUM1,INT _NUM2,INT _VARI,INT _UMODE,REAL _ANG1,REAL _ANG2,STRING[200] _HIDE,INT _NSP,INT _DMODE) SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.002 ;DATE: 2023-03-10
;Cycle support HMIsl
;Positions matrix
DEF AXIS _XX,_YY,_ZZ
DEF INT _DMODE1,_FOUND,_I1,_I2,_INI,_MODE,_NUM,_POS,_MAX_POS,_VARI2,_SPIND,_H8,_II
DEF INT _I,_I1L,_I2L,_I1DIR=1,_I2DIR=1,_POSL,_NUM1L,_NUM2L,_CHANGE_DIR,_EDGE=0,S_ACT_POS,S_NUM_POS
DEF INT _ARTIS[16]
DEF REAL _DX,_DY,_FAK1,_DIS,_DIST[4],_SX,_SY,_RTZ
DEF FRAME _RE_CYCFR
DEF INT _TEMP,_ABS,_ORD,_APP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE801_MPF",_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE801_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE801("<<_SPCA<<","<<_SPCO<<","<<_STA<<","<<_DIS1<<","<<_DIS2<<","<<_NUM1<<","<<_NUM2<<","<<_VARI<<","<<_UMODE<<","<<_ANG1<<","<<_ANG2<<",'"'"<<_HIDE<<"'"',"<<_NSP<<","<<_DMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
IF(_VARI<0) GOTOF _FEHL5
_MODE=_VARI _DEC1
IF(_MODE<0)OR(_MODE>1)
_SERR="(_VARI: dec1)"
GOTOF _FEHL2
ENDIF
_VARI2=_VARI _DEC2
IF(_VARI2<0)OR(_VARI2>1) GOTOF _FEHL3
IF(_NUM1<=0)OR(_NUM2<=0) GOTOF _FEHL1
IF(_NUM1>1)AND(_DIS1==0) GOTOF _FEHL6
IF(_NUM2>1)AND(_DIS2==0) GOTOF _FEHL6
IF(_ANG1<=-90)OR(_ANG1>=90) GOTOF _FEHL9
IF(_ANG2<=-90)OR(_ANG2>=90) GOTOF _FEHL9
IF(_NSP<0) GOTOF _FEHL10
IF($P_SEARCH) OR (($AC_SERUPRO)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100')))
_NSP=0
ELSE
IF (_E_SEARCH[2]>-1)
_NSP=_E_SEARCH[2]+1
ENDIF
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL7
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
_ARTISUP=0
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_SPIND=_VARI _DEC3
IF((_SPIND<>2)AND(_SPIND<>0)) GOTOF _FEHL5
_STCCMA:
_H8=$P_TRAFO
IF((_SPIND==2)AND(_H8 B_AND 'H300')) GOTOF _FEHL5
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(_UMODE)
SBLON
ENDIF
IF($P_MC==0)
STOPRE
N780104 SETAL(62100)
M0
STOPRE
ENDIF
_RE_CYCFR=$P_CYCFRAME
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF ISAXIS(_ABS)
_XX=$P_AXN1
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_SPCA*1/_FAK1)
ENDIF
IF ISAXIS(_ORD)
_YY=$P_AXN2
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_YY,_SPCO*1/_FAK1)
ENDIF
IF ISAXIS(_APP)
_ZZ=$P_AXN3
IF ISAXIS(_ABS)
$P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,_STA)
ENDIF
ENDIF
IF (ISAXIS(_ABS)==FALSE) OR (ISAXIS(_ORD)==FALSE)
_RTZ=$P_CYCFRAME[_ZZ,RT]
IF (NOT((_RTZ==0) OR (ABS(_RTZ)==180)) AND (_NUM2==1))
_SERR="(_STA/STA1)"
GOTOF _FEHL2
ENDIF
IF ((ISAXIS(_ORD)==FALSE) AND (_SPCO<>0))
_SERR="(_SPCO)"
GOTOF _FEHL2
ENDIF
IF ((ISAXIS(_ABS)==FALSE) AND (_SPCA<>0))
_SERR="(_SPCA)"
GOTOF _FEHL2
ENDIF
IF (_NUM2>1)
_SERR="(_NUM2)"
GOTOF _FEHL2
ENDIF
ENDIF
IF(_MODE==1)AND((_NUM1==1)OR(_NUM2==1))
_MODE=0
ENDIF
_HIDE=","<<_HIDE<<","
IF(_VARI2==1)
_CHANGE_DIR=0
_I1DIR=1
_I2DIR=1
ELSE
IF (_SC_POS[9]==0)
_SX=$P_EP[_XX]*_FAK1 _SY=$P_EP[_YY]*_FAK1
ELSE
IF (_E_SEARCH[2]<>-1)
IF ISAXIS(_ABS)
_SC_POS[6]= _SC_POS[6] - $P_CYCFRAME[$P_AXN1,TR]
ENDIF
IF ISAXIS(_ORD)
_SC_POS[7]= _SC_POS[7] - $P_CYCFRAME[$P_AXN2,TR]
ENDIF
_SX=(_SC_POS[6] * cos($P_CYCFRAME[$P_AXN3,RT])) + (_SC_POS[7] * sin($P_CYCFRAME[$P_AXN3,RT]))
_SY=((-1*_SC_POS[6]) * sin($P_CYCFRAME[$P_AXN3,RT])) + (_SC_POS[7]* cos($P_CYCFRAME[$P_AXN3,RT]))
ELSE
_SX=$P_EP[_XX]*_FAK1 _SY=$P_EP[_YY]*_FAK1
ENDIF
ENDIF
_SC_POS[6]=SET(0,0,0,0)
IF NOT (($P_SEARCH) OR (($AC_SERUPRO)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))))
_E_SEARCH[2]=-1
ENDIF
_DIST[0]=SQRT(POT(_SX)+POT(_SY))
_DX=(_NUM1-1)*_DIS1
_DY=(_NUM1-1)*_DIS1*TAN(_ANG1)
_DIST[1]=SQRT(POT(_SX-_DX)+POT(_SY-_DY))
_DX=-(_NUM2-1)*_DIS2*TAN(_ANG2)
_DY=(_NUM2-1)*_DIS2
_DIST[2]=SQRT(POT(_SX-_DX)+POT(_SY-_DY))
_DX=(_NUM1-1)*_DIS1-(_NUM2-1)*_DIS2*TAN(_ANG2)
_DY=(_NUM2-1)*_DIS2+(_NUM1-1)*_DIS1*TAN(_ANG1)
_DIST[3]=SQRT(POT(_SX-_DX)+POT(_SY-_DY))
_EDGE=0
_DIS=_DIST[0]
FOR _I=1 TO 3
IF(_DIST[_I]<_DIS)
_EDGE=_I
_DIS=_DIST[_I]
ENDIF
ENDFOR
IF(_DIST[0]==_DIS)
_I1DIR=1
_I2DIR=1
ELSE
IF(_DIST[1]==_DIS)
_I1DIR=-1
_I2DIR=1
ELSE
IF(_DIST[2]==_DIS)
_I1DIR=1
_I2DIR=-1
ELSE
_I1DIR=-1
_I2DIR=-1
ENDIF
ENDIF
ENDIF
IF(_DIS2<_DIS1)
_CHANGE_DIR=1
ENDIF
ENDIF
_INI=1
_NUM=0
REPEAT
REPEAT _NPOS1 _NPOS2
UNTIL _FOUND==FALSE
S_NUM_POS=S_ACT_POS
_INI=1
_NUM=0
IF(_NSP>=1)
_NUM=_NSP-1
ENDIF
REPEAT _NPOS1 _NPOS2
_NUM=0
IF(_NSP>=1)
S_ACT_POS=S_ACT_POS+_NSP-1
ENDIF
IF(NOT _FOUND)
IF(_NSP==0)
GOTOF _FEHL1
ELSE
GOTOF _FEHL13
ENDIF
ENDIF
WHILE(_FOUND)
IF(_ARTIS[11]==2)
_ARTIS[9]=_ARTIS[9]+1
IF(_ARTIS[3]<>0)
IF(_ARTIS[9]==_ARTIS[13])
_ARTIS[1]=_ARTIS[13] _ARTIS[2]=_ARTIS[13]
_ARTISUP=1
IF(_ARTIS[13]+_ARTIS[3]<=_SC_TOOL_VALI[2])
_ARTIS[13]=_ARTIS[13]+_ARTIS[3]
ENDIF
ELSE
_ARTISUP=0
ENDIF
ELSE
IF(_ARTIS[9]==_ARTIS[1])
_ARTISUP=1
ENDIF
ENDIF
ENDIF
IF(_ARTIS[11]==3)
_ARTISUP=1
ENDIF
_DX=_I1*_DIS1-_I2*_DIS2*TAN(_ANG2) _DY=_I2*_DIS2+_I1*_DIS1*TAN(_ANG1)
IF ISAXIS(_ABS)==FALSE
_DY=_DX
ENDIF
WRTPR("POSITIONS(1,1,"<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
IF ((ISAXIS(_ABS)==1) AND (ISAXIS(_ORD)==1))
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N20 G0 G90 AX[_XX]=_DX AX[_YY]=_DY
SBLOF
ELSE
SBLON
N20 G0 G9 G90 AX[_XX]=_DX AX[_YY]=_DY
SBLOF
ENDIF
ELSE
IF ISAXIS(_ABS)==FALSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N20 G0 G90 AX[_YY]=_DY
SBLOF
ELSE
SBLON
N20 G0 G9 G90 AX[_YY]=_DY
SBLOF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N20 G0 G90 AX[_XX]=_DX
SBLOF
ELSE
SBLON
N20 G0 G9 G90 AX[_XX]=_DX
SBLOF
ENDIF
ENDIF
ENDIF
IF(_ARTIS[3]==0)
IF(_ARTIS[9]==_ARTIS[2])
_ARTISUP=0
ENDIF
ENDIF
REPEAT _NPOS1 _NPOS2
ENDWHILE
WRTPR("POSITIONS(0)")
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(_UMODE+1)
SBLON
ENDIF
$P_CYCFRAME=_RE_CYCFR
RET
_NPOS1:
IF(_INI)
_INI=0
_POSL=0
S_ACT_POS=0
IF(_MODE==0)
_MAX_POS=_NUM1*_NUM2
ELSE
_MAX_POS=2*(_NUM1+_NUM2)-4
ENDIF
IF(_CHANGE_DIR)
_NUM1L=_NUM2 _NUM2L=_NUM1
ELSE
_NUM1L=_NUM1 _NUM2L=_NUM2
ENDIF
ENDIF
_FOUND=0
WHILE(_FOUND<=_NUM)AND(_POSL<_MAX_POS)
_POSL=_POSL+1
IF(_MODE==0)
_I1L=(_POSL-1)MOD _NUM1L
_I2L=(_POSL-1)DIV _NUM1L
IF(_I2L MOD 2)
_I1L=_NUM1L-_I1L-1
ENDIF
ELSE
IF(_POSL<=_NUM1L-1)
_I1L=_POSL-1
_I2L=0
ELSE
IF(_POSL<=_NUM1L+_NUM2L-2)
_I1L=_NUM1L-1
_I2L=_POSL-_NUM1L
ELSE
IF(_POSL<=2*_NUM1L+_NUM2L-3)
_I1L=2*_NUM1L+_NUM2L-2-_POSL
_I2L=_NUM2L-1
ELSE
_I1L=0
_I2L=_MAX_POS-_POSL+1
ENDIF
ENDIF
ENDIF
ENDIF
IF(_CHANGE_DIR)
_I=_I1L
_I1L=_I2L
_I2L=_I
ENDIF
IF(_I1DIR==1)
_I1=_I1L
ELSE
_I1=(_NUM1-1)-_I1L
ENDIF
IF(_I2DIR==1)
_I2=_I2L
ELSE
_I2=(_NUM2-1)-_I2L
ENDIF
IF(_MODE==0)
IF(_I2 MOD 2)
_POS=_I2*_NUM1+(_NUM1-1-_I1)+1
ELSE
_POS=_I2*_NUM1+_I1+1
ENDIF
ELSE
IF(_I2==0)
_POS=_I1+1
ELSE
IF(_I1==(_NUM1-1))
_POS=_I2+(_NUM1-1)+1
ELSE
IF(_I2==(_NUM2-1))
_POS=(_NUM2-1)+2*(_NUM1-1)-_I1+1
ELSE
_POS=2*(_NUM1-1)+2*(_NUM2-1)-_I2+1
ENDIF
ENDIF
ENDIF
ENDIF
IF(MATCH(_HIDE,","<<_POS<<",")<0)AND(_POS<=_MAX_POS)
_FOUND=_FOUND+1
ENDIF
ENDWHILE
IF(_FOUND<=_NUM)
_FOUND=0
ELSE
S_ACT_POS=S_ACT_POS+1
ENDIF
_NPOS2:
_FEHL1: STOPRE
N780101 SETAL(61103)
RET
_FEHL2: STOPRE
N780102 SETAL(61019,<<_SERR)
RET
_FEHL3: STOPRE
N780103 SETAL(61019,"(_VARI: dec2)")
RET
_FEHL5:STOPRE
N780105 SETAL(61002)
RET
_FEHL6: STOPRE
N780106 SETAL(61019," L1/L2 ")
RET
_FEHL7: STOPRE
N780107 SETAL(61158)
RET
_FEHL9: STOPRE
N780109 SETAL(61184)
RET
_FEHL10: STOPRE
N780114 SETAL(61019,"(_NSP)")
RET
_FEHL11: STOPRE
N780111 SETAL(62106)
RET
_FEHL12:STOPRE
N780112 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL13: STOPRE
N780113 SETAL(61210)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE802_SPF
PROC CYCLE802(INT __XA,INT __YA,REAL _X0,REAL _Y0,REAL _X1,REAL _Y1,REAL _X2,REAL _Y2,REAL _X3,REAL _Y3,REAL _X4,REAL _Y4,REAL _X5,REAL _Y5,REAL _X6,REAL _Y6,REAL _X7,REAL _Y7,REAL _X8,REAL _Y8,INT _VARI,INT _UMODE,INT _DMODE,INT S_ABA,REAL S_AB0,REAL S_AB1,REAL S_AB2,REAL S_AB3,REAL S_AB4,REAL S_AB5,REAL S_AB6,REAL S_AB7,REAL S_AB8,REAL S_C3D) SAVE SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.002 ;DATE: 2023-03-10
;Cycle support HMIsl
;Positions sequential with or without rotary axis
DEF AXIS _XX,_YY,_ZZ,_AA
DEF INT _XA,_YA
DEF INT _ABS_BEZUG,_DMODE1,_FAK,_H8,_I,_II,_J,_PSNR,_SPIND,_XAA,_YAA,_XPROG,_YPROG,_XAREST,_YAREST,S_ACT_POS,S_NUM_POS
DEF INT _ARTIS[16]
DEF REAL _FAK1,_POS[5,9],_XP,_YP
DEF INT _TEMP,_ABS,_ORD,_APP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE802_MPF"
DEF INT _ABA,_ABAREST,_ABAA,_ABPROG,_VAR5,_VAR6,_VAR7,_TRAC=0,_TRAM=0,_ABRI,_INT,_III,_INT2,_TRAFO_NO,_J2,_GEO1
DEF INT _GEO[3,3]=SET(1,2,0,2,0,1,0,1,2)
DEF INT _TRAMI[99,3]=REP(0),_NSP
DEF REAL _MODR,_MODS,_TRAD,_ABP,_DX,_DY
DEF CHAR _QUOT=34
DEF STRING[200] _STR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE802_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_AD[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_AD[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_AD[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_AD[15]<<"    ; Tool wear radius")
IF (($P_AD[1]>=200) AND ($P_AD[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_AD[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_AD[1]>=100) AND ($P_AD[1]<200))
IF ($P_AD[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_AD[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_AD[35]<<"    ; Number of teeth")
ENDIF
IF ($P_AD[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_AD[7]<<"   ; Outside radius ")
ENDIF
IF ($P_AD[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_AD[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE802("<<_XA<<","<<_YA<<","<<_X0<<","<<_Y0<<","<<_X1<<","<<_Y1<<","<<_X2<<","<<_Y2<<","<<_X3<<","<<_Y3<<","<<_X4<<","<<_Y4<<","<<_X5<<","<<_Y5<<","<<_X6<<","<<_Y6<<","<<_X7<<","<<_Y7<<","<<_X8<<","<<_Y8<<","<<_VARI<<","<<_UMODE<<","<<_DMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
cycle210(0)
_XA=__XA _YA=__YA _ABA=S_ABA
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3) GOTOF _FEHL6
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
IF($P_SEARCH)OR($AC_SERUPRO)
_NSP=0
ELSE
IF (_E_SEARCH[2]>-1)
_NSP=_E_SEARCH[2]
ELSE
_NSP=0
ENDIF
IF NOT ($P_SEARCH)
_E_SEARCH[2]=-1
ENDIF
ENDIF
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF ISAXIS(_ABS)
_XX=$P_AXN1
ELSE
_ABS=-_ABS
ENDIF
IF ISAXIS(_ORD)
_YY=$P_AXN2
ELSE
_ORD=-_ORD
ENDIF
IF($P_TRAFO B_AND 'H200')
_TRAC=1
_TRAD=$P_TRAFO_PAR[0]
_TRAFO_NO=$P_TRAFO_PARSET MOD 1000
IF $P_TRAFO_PARSET>1000
_I=$P_TRAFO_PARSET MOD 1000
_TRAFO_NO=($NT_TRAFO_INDEX[_I] _DEC2)+10*($NT_TRAFO_INDEX[_I] _DEC3)
ENDIF
ENDIF
IF $P_TRAFO B_AND 'H1100'
_TRAM=1
_TRAFO_NO=$P_TRAFO_PARSET MOD 1000
ENDIF
IF(_VARI<0) GOTOF _FEHL1
_VAR5=_VARI _DEC5
_VAR6=_VARI _DEC6
IF ((_VAR5==2) AND ((_TRAC==1) OR (_TRAM==1))) GOTOF _FEHL15
IF ((_VAR5>2) OR (_VAR6>3)) GOTOF _FEHL1
IF NOT((_VAR5==0) AND (_VAR6==0))
IF (_VAR5==0) OR (_VAR6==0) GOTOF _FEHL1
ELSE
_VAR6=1
ENDIF
IF ((_VAR5==0) OR (_VAR5==2))
IF ((_ABS<0)OR(_ORD<0))
GOTOF _FEHL9
ENDIF
ENDIF
IF _VAR5<>0
_GEO1=_GEO[$P_GG[6]-1,_VAR6-1]
ENDIF
IF ((_VAR5==0)OR(_VAR5==2))
IF((_XA<=0)OR(_YA<=0)) GOTOF _FEHL5
IF((_XA>222222222)OR(_YA>222222222)) GOTOF _FEHL7
ENDIF
IF (_VAR5>0)
IF(_ABA<=0) GOTOF _FEHL5
IF(_ABA>222222222) GOTOF _FEHL7
ENDIF
IF (_VAR5==1)
IF(_GEO[$P_GG[6]-1,_VAR6-1]==1)
IF(_XA<=0) GOTOF _FEHL5
IF(_XA>222222222) GOTOF _FEHL7
ELSE
IF(_YA<=0) GOTOF _FEHL5
IF(_YA>222222222) GOTOF _FEHL7
ENDIF
ENDIF
IF(_VAR5==2)
_III=5
ELSE
_III=8
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF(_SC_TOOL_VALI[0]<>0)
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
_ARTISUP=0
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_SPIND=_VARI _DEC3
IF((_SPIND<>2)AND(_SPIND<>0)) GOTOF _FEHL1
_STCCMA:
_H8=$P_TRAFO
IF((_SPIND==2) AND (_H8 B_AND 'H1300')) GOTOF _FEHL1
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(_UMODE)
SBLON
ENDIF
IF($P_MC==0)
STOPRE
N780204 SETAL(62100)
M0
STOPRE
ENDIF
IF (_VAR5>0)
IF(_VAR6>3)GOTOF _FEHL14
IF(_SC_ROT_AX[0,_VAR6-1]==0)GOTOF _FEHL14
_VAR7=10*(_VARI _DEC8)+_VARI _DEC7
IF(_VAR7>_SC_ROT_AX[0,_VAR6-1]-1)
_VAR7=0
ENDIF
_AA=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_SC_ROT_AX[_VAR7+1,_VAR6-1]-1])
IF($MA_ROT_IS_MODULO[_AA])
_MODR=$MA_MODULO_RANGE[_AA]
_MODS=$MA_MODULO_RANGE_START[_AA]
ENDIF
_ABRI=1
IF(_TRAC)
IF $P_TRAFO_PARSET<1000
_STR="_INT=$MC_TRACYL_ROT_SIGN_IS_PLUS_"<<$P_TRAFO_PARSET
EXECSTRING(_STR)
ELSE
_INT=($NT_CNTRL[$P_TRAFO_PARSET MOD 1000] B_AND 'H800')/2048
ENDIF
IF(_INT==0)
_ABRI=-1
ENDIF
ENDIF
IF(_TRAM)
IF $P_TRAFO_PARSET<1000
_STR="_INT=$MC_TRANSMIT_ROT_SIGN_IS_PLUS_"<<$P_TRAFO_PARSET
EXECSTRING(_STR)
ELSE
_INT=($NT_CNTRL[$P_TRAFO_PARSET MOD 1000] B_AND 'H800')/2048
ENDIF
IF(_INT==1)
_ABRI=-1
ENDIF
ENDIF
_PSNR=25
_FAK=1
_POS[2,0]=SET(S_AB0,S_AB1,S_AB2,S_AB3,S_AB4,S_AB5,S_AB6,S_AB7,S_AB8)
_ABAREST=_ABA
_ABA=0
FOR _I=0 TO _III
_ABPROG=_ABAREST _DEC1
IF(_ABPROG<=0)OR(_ABPROG>2) GOTOF _FEHL7
_ABAREST=_ABAREST DIV 10
IF(NOT($P_SUBPAR[_PSNR]))
_ABPROG=0
ENDIF
_ABA=_ABA+_ABPROG*_FAK
_PSNR=_PSNR+1 _FAK=_FAK*10
ENDFOR
ENDIF
IF (_TRAC==1)
IF (NOT((_VAR5==0) AND ($P_TC>0)))
IF ((_SC_TRACYL[_TRAFO_NO-1,2])<>($P_GG[6]-1+17)) GOTOF _FEHL15
ENDIF
IF(_VAR5>0)
IF ((_VAR6)<>(_SC_TRACYL[_TRAFO_NO-1,1])) GOTOF _FEHL15
ENDIF
ENDIF
IF (_TRAM==1)
IF $P_TRAFO_PARSET<1000
_TRAMI[0,0]=REP(0)
FOR _J=1 TO 20
_STR="_INT=ISVAR("<<_QUOT<<"$MC_TRAFO_TYPE_"<<_J<<_QUOT<<")"
EXECSTRING(_STR)
IF(_INT)
_STR="_INT=$MC_TRAFO_TYPE_"<<_J
EXECSTRING(_STR)
IF(_INT B_AND 'H1100')AND(_I<2)
_TRAMI[_I,0]=_INT
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[2]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_TRAMI[_I,1]=_J2+1
ENDIF
ENDFOR
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[0]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_TRAMI[_I,2]=17+_J2
ENDIF
ENDFOR
_I=_I+1
ENDIF
ENDIF
ENDFOR
IF (NOT((_VAR5==0) AND ($P_TC>0)))
IF ((_TRAMI[_TRAFO_NO-1,2])<>($P_GG[6]-1+17)) GOTOF _FEHL15
ENDIF
IF(_VAR5>0)
IF ((_VAR6)<>(_TRAMI[_TRAFO_NO-1,1])) GOTOF _FEHL15
ENDIF
_I=0 _J=0 _J2=0
ELSE
_TRAMI[0,0]=$P_TRAFO
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TRAFO_NO,1],TRUE)
FOR _J=0 TO 2
IF $NK_OFF_DIR[_I,_J]<>0
_TRAMI[0,1]=_J+1
ENDIF
ENDFOR
_I=NAMETOINT("$NK_NAME",$NT_GEO_AX_NAME[_TRAFO_NO,0],TRUE)
FOR _J=0 TO 2
IF $NK_OFF_DIR[_I,_J]<>0
_TRAMI[0,2]=_J+17
ENDIF
ENDFOR
IF (NOT((_VAR5==0) AND ($P_TC>0)))
IF ((_TRAMI[0,2])<>($P_GG[6]-1+17)) GOTOF _FEHL15
ENDIF
IF(_VAR5>0)
IF ((_VAR6)<>(_TRAMI[0,1])) GOTOF _FEHL15
ENDIF
ENDIF
_I=0 _J=0 _J2=0
ENDIF
;IF (_VAR5==0) OR (_VAR5==2)
_PSNR=3
_FAK=1
_XAREST=_XA _YAREST=_YA
_XA=0 _YA=0
_POS[0,0]=SET(_X0,_X1,_X2,_X3,_X4,_X5,_X6,_X7,_X8)
_POS[1,0]=SET(_Y0,_Y1,_Y2,_Y3,_Y4,_Y5,_Y6,_Y7,_Y8)
;ENDIF
FOR _I=0 TO _III
IF NOT((_VAR5==1) AND (_GEO[$P_GG[6]-1,_VAR6-1]==2))
_XPROG=_XAREST _DEC1
IF(_XPROG<=0)OR(_XPROG>2) GOTOF _FEHL7
_XAREST=_XAREST DIV 10
IF(NOT($P_SUBPAR[_PSNR]))
_XPROG=0
ENDIF
_XA=_XA+_XPROG*_FAK
ENDIF
_PSNR=_PSNR+1
IF NOT((_VAR5==1) AND (_GEO[$P_GG[6]-1,_VAR6-1]==1))
_YPROG=_YAREST _DEC1
IF(_YPROG<=0)OR(_YPROG>2) GOTOF _FEHL7
_YAREST=_YAREST DIV 10
IF(NOT($P_SUBPAR[_PSNR]))
_YPROG=0
ENDIF
_YA=_YA+_YPROG*_FAK
ENDIF
_PSNR=_PSNR+1 _FAK=_FAK*10
ENDFOR
_XAREST=_XA
_YAREST=_YA
_ABAREST=_ABA
S_NUM_POS=0
FOR _I=0 TO _III
IF (_VAR5>0)
_ABAA=_ABAREST _DEC1
_ABAREST=_ABAREST DIV 10
ELSE
_ABAA=0
ENDIF
_XAA=_XAREST _DEC1
_YAA=_YAREST _DEC1
_XAREST=_XAREST DIV 10
_YAREST=_YAREST DIV 10
IF(NOT((_XAA==0)AND(_YAA==0)AND(_ABAA==0)))
S_NUM_POS=S_NUM_POS+1
ENDIF
ENDFOR
S_ACT_POS=_NSP
IF((_NSP>0) AND (_VAR5==0))
IF(NOT (($P_SEARCH) OR ($AC_SERUPRO)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))))
FOR _I=0 TO _III
_STR="_INT=__XA _DEC"<<(_I+1)
EXECSTRING(_STR)
IF _INT<>0
IF _INT==1
_POS[3,_I]=_POS[0,_I]
ELSE
_POS[3,_I]=_POS[3,_I-1]+_POS[0,_I]
ENDIF
ENDIF
_STR="_INT=__YA _DEC"<<(_I+1)
EXECSTRING(_STR)
IF _INT<>0
IF _INT==1
_POS[4,_I]=_POS[1,_I]
ELSE
_POS[4,_I]=_POS[4,_I-1]+_POS[1,_I]
ENDIF
ENDIF
ENDFOR
_J=1
FOR _I=0 TO _III
_STR="_INT=_XA _DEC"<<(_I+1)
EXECSTRING(_STR)
_STR="_INT2=_YA _DEC"<<(_I+1)
EXECSTRING(_STR)
IF(_INT>0)OR(_INT2>0)
_XA=_XA-_J*_INT _YA=_YA-_J*_INT2
_NSP=_NSP-1
IF _NSP==0
GOTOF _SEARCH_FINISH2
ENDIF
ENDIF
_J=_J*10
ENDFOR
_SEARCH_FINISH2:
_I=_I+1 _J=_J*10
_POS[0,_I]=_POS[3,_I] _POS[1,_I]=_POS[4,_I]
_STR=""<<_XA _INT=STRLEN(_STR)
_STR=SUBSTR(_STR,0,_INT-STRLEN(""<<_J))<<_J
_XA=NUMBER(_STR)
_STR=""<<_YA _INT=STRLEN(_STR)
_STR=SUBSTR(_STR,0,_INT-STRLEN(""<<_J))<<_J
_YA=NUMBER(_STR)
ENDIF
ENDIF
_SEARCH_FINISH:
_I=0
IF(_NSP>1)
IF(NOT (($P_SEARCH) OR ($AC_SERUPRO)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))))
FOR _I=0 TO _III
_STR="_INT=_ABA _DEC"<<(_I+1)
EXECSTRING(_STR)
IF _INT<>0
IF _INT==1
_POS[3,_I]=_POS[2,_I]
ELSE
_POS[3,_I]=_POS[3,_I-1]+_POS[2,_I]
ENDIF
ENDIF
ENDFOR
_J=1
FOR _I=0 TO _III
_STR="_INT=_ABA _DEC"<<(_I+1)
EXECSTRING(_STR)
IF(_INT>0)
_ABA=_ABA-_J*_INT
_NSP=_NSP-1
IF _NSP==0
GOTOF _SEARCH_FINISH3
ENDIF
ENDIF
_J=_J*10
ENDFOR
_SEARCH_FINISH3:
_POS[2,_I]=_POS[3,_I]
_STR=""<<_ABA _INT=STRLEN(_STR)
_STR=SUBSTR(_STR,0,_INT-STRLEN(""<<_J))<<_J
_ABA=NUMBER(_STR)
_ABS_BEZUG=1
ENDIF
ENDIF
_XAREST=_XA _YAREST=_YA
_ABS_BEZUG=0 _ABAREST=_ABA
_J=0
FOR _I=0 TO _III
IF (_VAR5>0)
_ABAA=_ABAREST _DEC1
_ABAREST=_ABAREST DIV 10
ELSE
_ABAA=0
ENDIF
_XAA=_XAREST _DEC1
_YAA=_YAREST _DEC1
_XAREST=_XAREST DIV 10
_YAREST=_YAREST DIV 10
IF (_VAR5==0)
IF((_XAA==1)AND(_YAA==1))
_ABS_BEZUG=1
ENDIF
IF(_ABS_BEZUG==0)AND((_XAA<>0)OR(_YAA<>0)) GOTOF _FEHL8
ENDIF
IF (_VAR5==2)
IF((_XAA==1)AND(_YAA==1)AND(_ABAA==1))
_ABS_BEZUG=1
ENDIF
IF(_ABS_BEZUG==0)AND((_XAA<>0)OR(_YAA<>0)OR(_ABAA<>0)) GOTOF _FEHL8
ENDIF
IF (_VAR5==1)
IF(_GEO[$P_GG[6]-1,_VAR6-1]==1)
IF(_XAA==1)
_ABS_BEZUG=1
ENDIF
IF(_ABS_BEZUG==0)AND(_XAA<>0) GOTOF _FEHL8
ELSE
IF(_YAA==1)
_ABS_BEZUG=1
ENDIF
IF(_ABS_BEZUG==0)AND(_YAA<>0) GOTOF _FEHL8
ENDIF
ENDIF
IF(NOT((_XAA==0)AND(_YAA==0)AND(_ABAA==0)))
IF NOT((_VAR5==1) AND (_GEO[$P_GG[6]-1,_VAR6-1]==2))
IF(_XAA==2)
IF(_ABS_BEZUG==0)
GOTOF _FEHL8
ELSE
_XP=_XP+_POS[0,_J]
ENDIF
ELSE
IF(_XAA==1)
_XP=_POS[0,_J]
ENDIF
ENDIF
ENDIF
IF NOT((_VAR5==1) AND (_GEO[$P_GG[6]-1,_VAR6-1]==1))
IF(_YAA==2)
IF(_ABS_BEZUG==0)
GOTOF _FEHL8
ELSE
_YP=_YP+_POS[1,_J]
ENDIF
ELSE
IF(_YAA==1)
_YP=_POS[1,_J]
ENDIF
ENDIF
ENDIF
IF _VAR5>0
IF(_ABAA==2)
IF(_ABS_BEZUG==0)
GOTOF _FEHL8
ELSE
_ABP=_ABP+_POS[2,_J]
ENDIF
ELSE
IF(_ABAA==1)
_ABP=_POS[2,_J]
ELSE
GOTOF _NEXT
ENDIF
ENDIF
IF(($MA_ROT_IS_MODULO[_AA])AND(_TRAC==0))
_ABP=((((_ABP - _MODS) MOD _MODR) + _MODR) MOD _MODR) + _MODS
ENDIF
IF(_TRAC==1)
_ABP=(_TRAD*$PI*_ABP/360)*_ABRI
ENDIF
IF (_TRAM==1)
_DX=COS(_ABP*_ABRI)*_XP _DY=SIN(_ABP*_ABRI)*_XP
ENDIF
ENDIF
IF(_ARTIS[11]==2)
_ARTIS[9]=_ARTIS[9]+1
IF(_ARTIS[3]<>0)
IF(_ARTIS[9]==_ARTIS[13])
_ARTIS[1]=_ARTIS[13] _ARTIS[2]=_ARTIS[13]
_ARTISUP=1
IF(_ARTIS[13]+_ARTIS[3]<=_SC_TOOL_VALI[2])
_ARTIS[13]=_ARTIS[13]+_ARTIS[3]
ENDIF
ELSE
_ARTISUP=0
ENDIF
ELSE
IF(_ARTIS[9]==_ARTIS[1])
_ARTISUP=1
ENDIF
ENDIF
ENDIF
IF(_ARTIS[11]==3)
_ARTISUP=1
ENDIF
S_ACT_POS=S_ACT_POS+1
WRTPR("POSITIONS(1,1,"<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
IF (_VAR5==0)
IF ($P_GG[7]<>1)
G40
ENDIF
SBLON
N20 G90 G0 AX[_XX]=_XP AX[_YY]=_YP
SBLOF
ENDIF
IF (_VAR5==2)
IF (_TRAC==0) AND (_TRAM==0)
IF ($P_GG[7]<>1)
G40
ENDIF
SBLON
N30 G90 G0 AX[_XX]=_XP AX[_YY]=_YP AX[_AA]=_ABP
SBLOF
ELSE
GOTOF _FEHL15
ENDIF
ENDIF
IF (_VAR5==1)
IF ((_GEO1==1) AND (_TRAM==0))
IF ($P_GG[7]<>1)
G40
ENDIF
IF (_TRAC==0)
SBLON
N40 G90 G0 AX[_XX]=_XP AX[_AA]=_ABP
SBLOF
ELSE
SBLON
N45 G90 G0 AX[_XX]=_XP AX[_YY]=_ABP
SBLOF
ENDIF
GOTOF _NEXT
ENDIF
IF ((_GEO1==2) AND (_TRAM==0))
IF ($P_GG[7]<>1)
G40
ENDIF
IF (_TRAC==0)
SBLON
N50 G90 G0 AX[_YY]=_YP AX[_AA]=_ABP
SBLOF
ELSE
SBLON
N55 G90 G0 AX[_YY]=_YP AX[_XX]=_ABP
SBLOF
ENDIF
GOTOF _NEXT
ENDIF
IF ((_GEO1==0) AND (_TRAC==0))
IF ($P_GG[7]<>1)
G40
ENDIF
IF (_TRAM==0)
SBLON
N60 G90 G0 AX[_XX]=_XP AX[_AA]=_ABP
SBLOF
ELSE
SBLON
N65 G0 G9 G90 AX[_XX]=_DX AX[_YY]=_DY
SBLOF
ENDIF
ENDIF
ENDIF
ENDIF
_NEXT:
IF(_ARTIS[3]==0)
IF(_ARTIS[9]==_ARTIS[2])
_ARTISUP=0
ENDIF
ENDIF
_J=_J+1
ENDFOR
IF(_ABS_BEZUG==0) GOTOF _FEHL5
WRTPR("POSITIONS(0)")
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(_UMODE+1)
SBLON
ENDIF
RET
_FEHL1:STOPRE
N780201 SETAL(61002)
RET
_FEHL2: STOPRE
N780202 SETAL(62106)
RET
_FEHL3:STOPRE
N780203 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL5: STOPRE
N780205 SETAL(61103)
RET
_FEHL6: STOPRE
N780206 SETAL(61158)
RET
_FEHL7: STOPRE
N780207 SETAL(61019,"(__XA/__YA)")
RET
_FEHL8: STOPRE
N780208 SETAL(61211)
RET
_FEHL9: STOPRE
N780209 SETAL(61803)
RET
_FEHL14: STOPRE
N780214 SETAL(61329)
RET
_FEHL15: STOPRE
N780215 SETAL(61020)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE807_SPF
PROC CYCLE807(INT S_FR,STRING[32] _TC,INT S_ST,REAL S_FR_I,INT S_VG0) SBLOF SAVE ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.004 ;DATE: 2024-03-26
;Cycle support HMIsl
;Retract before swiveling
DEF INT _TCI,_TCMD,_FR_1,_CARR37,_G17_18_19,_GS17_18_19,_RETV,_SIM,_WZ_R,_I,_II,_ORI_T_18,_NYY,_MODE216,_G94,_G0,_CP
DEF REAL _STARTPOS[3],_MOVDIS[3],_DLIMIT[5],_MAXDIST[3],_T_POS,_FAK1,_V_TORI[3],_MD10200_MM,_LEN[11],_T_POS_ORI_18[4],_F
DEF AXIS _XX,_YY,_ZZ
DEF CHAR _CARR23
DEF STRING[32] _CARR35,_CARR36
DEF STRING[40] _SERR
DEF INT _LOG,_LOG_ON,_LOGSIZE
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE807_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,_LOGSIZE)
IF _LOGSIZE>2000
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,"; ! only for internal diagnostics ! ------------------")
WRITE(_LOG,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"CYCLE807("<<S_FR<<","<<_TC<<","<<S_ST<<","<<S_FR_I<<","<<S_VG0<<")")
ENDIF
IF(S_FR<=0)
IF(S_FR==0)AND($MN_SIM_ENVIRONMENT B_AND 'B100')
REPEAT _NULLSATZ_A _NULLSATZ_E
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"not retract in tool direction-> End")
ENDIF
GOTOF M_FR
ENDIF
IF(ISVAR("NAMETOINT"))AND(ISVAR("$NT_NAME"))AND(ISVAR("$NT_IDENT"))
_TCI=NAMETOINT("$NT_NAME",_TC,TRUE)
IF (_TCI==0) GOTOF M_FR
IF _TCI>0
_CARR23=<<"K" _CARR37=ABS($NT_IDENT[_TCI,0])
_SERR=<<"B"<<" $NT_IDENT["<<_TCI<<",0]="<<_CARR37
IF _CARR37==0 GOTOF _ERR23
ENDIF
ENDIF
IF (_CARR23<>"K")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"not KC -> search in TC ")
ENDIF
_TCMD=$MN_MM_NUM_TOOL_CARRIER
IF ((_TC=="") AND (_TCMD>1)) OR (_TCMD==0) GOTOF _ERR0
IF (_TC=="") AND (_TCMD==1)
_TCI=1
ELSE
IF ISVAR("$P_TCNUM")
_TCMD=$P_TCNUM
ENDIF
_TCI=1
WHILE (TOUPPER($TC_CARR34[_TCI])<>TOUPPER(_TC))
_TCI=_TCI+1
IF (_TCI>_TCMD)
_SERR=""<<_TCI
GOTOF _ERR2
ENDIF
ENDWHILE
ENDIF
IF (_TCI==0) GOTOF M_FR
_CARR37=ABS($TC_CARR37[_TCI])
CYCLE213(_TCI)
_CARR23=$TC_CARR23[_TCI] _CARR35=$TC_CARR35[_TCI] _CARR36=$TC_CARR36[_TCI]
ENDIF
_NULLSATZ_A:
_G17_18_19=$P_GG[6] _GS17_18_19=_G17_18_19
IF ISAXIS(2)
IF(_G17_18_19==1)
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
ELSE
IF(_G17_18_19==2)
_XX=$P_AXN2 _YY=$P_AXN3 _ZZ=$P_AXN1
ELSE
_XX=$P_AXN3 _YY=$P_AXN1 _ZZ=$P_AXN2
ENDIF
ENDIF
ELSE
IF(_G17_18_19==2)
_XX=$P_AXN2 _ZZ=$P_AXN1 _NYY=1
ENDIF
ENDIF
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF ((S_FR>=0) AND (S_FR<6))
_TC_FR=_TC_FR - (_TC_FR _DEC1) + S_FR
ELSE
_SERR=""<<S_FR
GOTOF _ERR3
ENDIF
_TC_FR_I=S_FR_I
DIAMCYCOF
_G94=$P_GG[15]
_G0=$P_GG[1]
_CP=$P_GG[49]
_F= $P_F
IF _NYY==1
G0 G90 G94 CP AX[_XX]=$P_EP[_XX]*_FAK1 AX[_ZZ]=$P_EP[_ZZ]*_FAK1
ELSE
G0 G90 G94 CP AX[_XX]=$P_EP[_XX]*_FAK1 AX[_YY]=$P_EP[_YY]*_FAK1 AX[_ZZ]=$P_EP[_ZZ]*_FAK1
ENDIF
IF(S_FR==0)AND($MN_SIM_ENVIRONMENT B_AND 'B100')
G0 G90 G94 CP AX[_ZZ]=$P_EP[_ZZ]*_FAK1-0.00001
ENDIF
G[15]=_G94
G[1]=_G0
G[49]=_CP
IF _F>0
F=_F
ENDIF
_NULLSATZ_E:
_FR_1=(_CARR37 _DEC8) _FR_1=10*_FR_1 + (_CARR37 _DEC7)
IF (S_FR==1)
IF (_FR_1 B_AND 'B1')
IF (_CARR23<>"K")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N807041 CUST_800(41,"<<_TCI<<",,,"<<S_VG0<<")")
ENDIF
N807041 CUST_800(41,_TCI,,,S_VG0)
GOTOF M_FR
ELSE
IF $P_TRAFO <= 0
TRAFOON($NT_NAME[_TCI])
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N807047 CUST_800(47,"<<_TCI<<",,,"<<S_VG0<<")")
ENDIF
N807047 CUST_800(47,_TCI,,,S_VG0)
GOTOF M_FR
ENDIF
ELSE
_SERR=<<"A"
GOTOF _ERR10
ENDIF
ENDIF
IF (S_FR==2)
IF (_FR_1 B_AND 'B10')
IF (_CARR23<>"K")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N807042 CUST_800(42,"<<_TCI<<",,,"<<S_VG0<<")")
ENDIF
N807042 CUST_800(42,_TCI,,,S_VG0)
GOTOF M_FR
ELSE
IF $P_TRAFO <= 0
TRAFOON($NT_NAME[_TCI])
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N807048 CUST_800(48,"<<_TCI<<",,,"<<S_VG0<<")")
ENDIF
N807048 CUST_800(48,_TCI,,,S_VG0)
GOTOF M_FR
ENDIF
ELSE
_SERR=<<"B"
GOTOF _ERR10
ENDIF
ENDIF
_T_POS=0
IF (_CARR23=="K")
IF $P_TRAFO <= 0
TRAFOON($NT_NAME[_TCI])
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Kinematic Chain KC: "<<$NT_NAME[_TCI])
ENDIF
IF ((((S_ST _DEC3)==2)OR((S_ST _DEC3)==3))AND((_CARR37 _DEC5)>1))
IF ($SC_TOOL_LENGTH_TYPE==3)
_SERR=<<"L $SC_TOOL_ORI_CONST_M<>0"
IF ($SC_TOOL_ORI_CONST_M<>0) GOTOF _ERR10
_SERR=<<"M $SC_TOOL_ORI_CONST_T<>0 and <>18"
IF ($SC_TOOL_ORI_CONST_T<>0) AND ($SC_TOOL_ORI_CONST_T<>18) GOTOF _ERR10
ENDIF
_SERR=<<"Q $P_ACTFRAME Mirror"
IF ($P_ACTFRAME[_XX,MI]==1) OR ($P_ACTFRAME[_YY,MI]==1) GOTOF _ERR10
IF (_G17_18_19==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"if G18")
ENDIF
_SERR=<<"Q $P_ACTFRAME Mirror Z"
IF ($P_ACTFRAME[_ZZ,MI]==1) GOTOF _ERR10
IF $SC_TOOL_ORI_CONST_T<>18
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G17 TOROT")
ENDIF
G17 TOROT
ENDIF
ELSE
_SERR=<<"R Plane <> G18"
GOTOF _ERR10
ENDIF
_G17_18_19=$P_GG[6]
ELSE
_SERR=<<"K KC:"<<$NT_NAME[_TCI]
GOTOF _ERR10
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Kinematic="<<_CARR23)
ENDIF
IF (_CARR23<>"P")
IF ((_CARR37 _DEC2)==0)
$TC_CARR21[_TCI]=AXNAME(_CARR35) $TC_CARR13[_TCI]=0
ENDIF
IF ((_CARR23=="T")AND((_CARR37 _DEC3)==0) AND (_CARR36<>""))
$TC_CARR22[_TCI]=AXNAME(_CARR36) $TC_CARR14[_TCI]=0
ENDIF
TCARR=_TCI TCOABS
IF ((((S_ST _DEC3)==2)OR((S_ST _DEC3)==3))AND((_CARR37 _DEC5)>1))
IF (_G17_18_19==2)
IF ((_CARR37 _DEC6)==3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC Main -X + G19 TOROTX")
ENDIF
G19 TOROTX
IF ($P_ACTFRAME[_ZZ,MI]==1)
$P_TOOLFRAME=CROT(_YY,180):INVFRAME($P_TOOLFRAME)
$P_TOOLFR=$P_TOOLFRAME
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC Main -Z + G17 TOROT")
ENDIF
G17 TOROT
IF ($P_ACTFRAME[_ZZ,MI]==1)
$P_TOOLFRAME=INVFRAME($P_TOOLFRAME)
$P_TOOLFR=$P_TOOLFRAME
ENDIF
ENDIF
ELSE
_SERR=<<"O $P_ACTFRAME Mirror Z"
IF ($P_ACTFRAME[_ZZ,MI]==1) GOTOF _ERR10
IF (_G17_18_19==3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G19 TOROTX")
ENDIF
G19 TOROTX
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G17 TOROT")
ENDIF
G17 TOROT
ENDIF
ENDIF
_SERR=<<"J $P_ACTFRAME Mirror"
IF ($P_ACTFRAME[_XX,MI]==1) OR ($P_ACTFRAME[_YY,MI]==1) GOTOF _ERR10
_G17_18_19=$P_GG[6]
ELSE
IF ($MCS_TECHNOLOGY==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," G18 + TURN + Swivel Plane")
ENDIF
IF ((_CARR37 _DEC6)==3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G19 TOROTX")
ENDIF
G19 TOROTX
IF ($P_ACTFRAME[_ZZ,MI]==1)
$P_TOOLFRAME=CROT(_YY,180):INVFRAME($P_TOOLFRAME)
$P_TOOLFR=$P_TOOLFRAME
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G17 TOROT")
ENDIF
G17 TOROT
IF ($P_ACTFRAME[_ZZ,MI]==1)
$P_TOOLFRAME=INVFRAME($P_TOOLFRAME)
$P_TOOLFR=$P_TOOLFRAME
ENDIF
ENDIF
IF ($SC_TOOL_ORI_CONST_T==0)
_G17_18_19=$P_GG[6]
ENDIF
ELSE
REPEAT _HGGA _HGGE
ENDIF
ENDIF
$TC_CARR21[_TCI]=_XX $TC_CARR22[_TCI]=_XX
ENDIF
ENDIF
_SERR=<<"F"
IF (_CARR37 _DEC6)==0
_WZ_R=ABS(_G17_18_19-3)
ELSE
_WZ_R=3-(_CARR37 _DEC6)
ENDIF
_ORI_T_18=0
IF $SC_TOOL_ORI_CONST_T==18
_I=GETTCOR(_LEN,"-T:M")
IF ((_LEN[0]>399) AND (_LEN[0]<600))
_WZ_R=2
_ORI_T_18=1
ENDIF
ENDIF
IF _NYY==1 GOTOF _ERR10
_DLIMIT[0]=SET(0,0,0)
_MOVDIS[0]=SET(0,0,0)
IF _ORI_T_18==1
_LEN[0]=SET($P_TOOLBIN[1],$P_TOOLBIN[2],$P_TOOLBIN[3],0,1)
_MODE216=11
CYCLE216(_LEN,_MODE216)
_MOVDIS[0]=SET(_LEN[0]*999999999,_LEN[1]*999999999,_LEN[2]*999999999)
ELSE
_MOVDIS[_WZ_R]=999999999
ENDIF
IF ISVAR("$MN_SIM_ENVIRONMENT")
_SIM=($MN_SIM_ENVIRONMENT B_AND 'B100')
ELSE
_SIM=$P_SIM
ENDIF
_MD10200_MM=$MN_INT_INCR_PER_MM
_STARTPOS[0]=TRUNC($P_EP[_XX]*_FAK1*_MD10200_MM)/_MD10200_MM
_STARTPOS[1]=TRUNC($P_EP[_YY]*_FAK1*_MD10200_MM)/_MD10200_MM
_STARTPOS[2]=TRUNC($P_EP[_ZZ]*_FAK1*_MD10200_MM)/_MD10200_MM
_RETV=CALCPOSI(_STARTPOS,_MOVDIS,_DLIMIT,_MAXDIST,0,7)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CALCPOSI")
WRITE(_LOG,_LOG_FILE,"_STARTPOS "<<_STARTPOS[0]<<"  "<<_STARTPOS[1]<<"  "<<_STARTPOS[2])
WRITE(_LOG,_LOG_FILE,"_MOVDIS   "<<_MOVDIS[0]<<"  "<<_MOVDIS[1]<<"  "<<_MOVDIS[2])
WRITE(_LOG,_LOG_FILE,"_DLIMIT   "<<_DLIMIT[0]<<"  "<<_DLIMIT[1]<<"  "<<_DLIMIT[2])
WRITE(_LOG,_LOG_FILE,"_MAXDIST  "<<_MAXDIST[0]<<"  "<<_MAXDIST[1]<<"  "<<_MAXDIST[2])
WRITE(_LOG,_LOG_FILE,"RET="<<_RETV)
ENDIF
IF (_RETV < 0)
IF(_RETV==-6)
IF($MC_REFP_NC_START_LOCK==0)
IF(S_FR==5)
_MAXDIST[ABS(_G17_18_19-3)]=S_FR_I
ELSE
_MAXDIST[ABS(_G17_18_19-3)]=1000000
ENDIF
ELSE
GOTOF _ERR7
ENDIF
ELSE
_SERR=<<"E: "<<_RETV
GOTOF _ERR10
ENDIF
ENDIF
IF (S_FR==4) OR (S_FR==5)
_SERR=<<"Tool T0 ?"
IF $P_TOOLNO==0 GOTOF _ERR10
_SERR=<<"Edge D0 ?"
IF $P_TOOL==0 GOTOF _ERR10
IF ((S_FR==4) AND (_FR_1 B_AND 'B100'))
_T_POS=_MAXDIST[_WZ_R]
IF _ORI_T_18==1
FOR _I=0 TO 2
IF _LEN[_I]<>0
_T_POS=_MAXDIST[_I]/_LEN[_I]
ENDIF
ENDFOR
ENDIF
_T_POS=TRUNC(_T_POS*_MD10200_MM)/_MD10200_MM
IF _T_POS<0
_SERR=<<"G"
GOTOF _ERR10
ENDIF
IF _T_POS>0
IF _ORI_T_18==0
_T_POS=_T_POS+_STARTPOS[_WZ_R]
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N807044 CUST_800(44,"<<_TCI<<",,,"<<S_VG0<<","<<_T_POS<<")")
ENDIF
N807044 CUST_800(44,_TCI,,,S_VG0,_T_POS)
ELSE
CUST_800(440,_TCI,,,S_VG0)
ENDIF
GOTOF M_FR
ELSE
_SERR=<<"C"
IF (S_FR==4) GOTOF _ERR10
ENDIF
IF ((S_FR==5) AND (_FR_1 B_AND 'B1000'))
S_FR_I=ABS(S_FR_I)
IF (_MAXDIST[_WZ_R]>=S_FR_I)
_T_POS=S_FR_I
ELSE
_T_POS=_MAXDIST[_WZ_R]
ENDIF
IF _ORI_T_18==1
_T_POS_ORI_18[0]=SET(S_FR_I*$P_TOOLBIN[1],S_FR_I*$P_TOOLBIN[2],S_FR_I*$P_TOOLBIN[3])
_T_POS_ORI_18[3]=SQRT(POT(_T_POS_ORI_18[0])+POT(_T_POS_ORI_18[1])+POT(_T_POS_ORI_18[2]))
IF ((SQRT(POT(_MAXDIST[0])+POT(_MAXDIST[1])+POT(_MAXDIST[2]))<_T_POS_ORI_18[3]) AND(_T_POS_ORI_18[3]>0))
_T_POS=SQRT(POT(_MAXDIST[0])+POT(_MAXDIST[1])+POT(_MAXDIST[2]))
ELSE
_T_POS_ORI_18[3]=0
_T_POS=S_FR_I
ENDIF
ENDIF
_T_POS=TRUNC(_T_POS*_MD10200_MM)/_MD10200_MM
IF _T_POS<0
_SERR=<<"H"
IF (S_FR==5) GOTOF _ERR10
ENDIF
IF _T_POS>0
IF _ORI_T_18==0
_T_POS=_T_POS+_STARTPOS[_WZ_R]
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N807045 CUST_800(45,"<<_TCI<<",,,"<<S_VG0<<","<<_T_POS<<")")
ENDIF
N807045 CUST_800(45,_TCI,,,S_VG0,_T_POS)
ELSE
CUST_800(450,_TCI,,,S_VG0)
ENDIF
GOTOF M_FR
ELSE
_SERR=<<"D"
GOTOF _ERR10
ENDIF
IF (_CARR23<>"P")
IF NOT(_CARR37 _DEC2)
$TC_CARR21[_TCI]=AXNAME(_CARR35) $TC_CARR13[_TCI]=0
ENDIF
IF ((_CARR23=="T")AND(((_CARR37 _DEC3)==0))AND(_CARR36<>""))
$TC_CARR22[_TCI]=AXNAME(_CARR36) $TC_CARR14[_TCI]=0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR="<<_TCI<<" TCOABS")
ENDIF
TCARR=_TCI TCOABS
REPEAT _HGGA _HGGE
$TC_CARR21[_TCI]=_XX $TC_CARR22[_TCI]=_XX
ENDIF
ENDIF
_SERR=<<"I"
GOTOF _ERR10
M_FR:
IF ((((S_ST _DEC3)==2)OR((S_ST _DEC3)==3))AND((_CARR37 _DEC5)>1))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G"<<_GS17_18_19+16)
ENDIF
G[6]=_GS17_18_19
_G17_18_19=_GS17_18_19
ENDIF
RET
_HGGA:
CASE _G17_18_19 OF 2 GOTOF _HG18 3 GOTOF _HG19 DEFAULT GOTOF _HG17
_HG18: TOROTY
GOTOF _HGGE
_HG19: TOROTX
GOTOF _HGGE
_HG17: TOROT
_HGGE:
_ERR0: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61180: Schwenkdatensatz kein Name zugewiesen")
ENDIF
N780700 SETAL(61180)
RET
_ERR2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61182: Name Schwenkdatensatz unbekannt: "<<_SERR)
ENDIF
N780702 SETAL(61182,_SERR)
RET
_ERR3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61183: Schwenken CYCLE800: Parameter Freifahrmodus auerhalb des Wertebereichs: "<<_SERR)
ENDIF
N780703 SETAL(61183,_SERR)
RET
_ERR7:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61069: Achse nicht referenziert")
ENDIF
N780707 SETAL(61069)
RET
_ERR10: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61190: kein Freifahren vor dem Schwenken mglich -> Fehlercode: "<<_SERR)
ENDIF
N7807010 SETAL(61190,<<_SERR)
RET
_ERR23: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61152: B-Achskinematik (Drehtechnologie) nicht oder falsch in IBN Schwenken eingerichtet - Fehlercode: "<<_SERR)
ENDIF
N780723 SETAL(61152,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE809_SPF
PROC CYCLE809(STRING[32] S_TRA,REAL _BETA,REAL _GAMA,INT _MODE,REAL _FR_I,REAL S_POLA,INT _DMODE) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-01
;Cycle support HMIsl
;Tool orientation
DEF INT _I,_J,_P15,_P25,_P29,_P51,S_TRA_NO,S_C_NR=0,S_B_NR=1,S_SP_NR=2,_PM,S_SOL,S_SOL_TEMP,_TYP,S_IDENT,_STATUS,S_CNTRL,S_HIRTH=-1,_MD21104,S_IS_45KIN
DEF REAL _FAK1,_FAK3,S_B,S_SP,S_SP1,S_SP2,S_C,S_SP_D,S_MI,S_RT,S_SP_DIR,S_SP_DIFF
DEF STRING[4] S_WZ_DIR[5]=SET("n.d.","-X","+X","-Z","+Z")
DEF STRING[200] S_STR
;DEF STRING[200] S_TRA_SP
DEF STRING[32] S_TRA_INT
DEF STRING[100] S_STRAL
DEF STRING[15] S_AX_NAME[3]
DEF AXIS _XX,_YY,_ZZ,_B,_C,_SP
DEF FRAME _VECT
DEF INT _LOG,_LOG_ON,S_LOGSIZE
DEF STRING[40] _LOG_FILE
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE809_MPF"
DEF STRING[1] _HOCHKOMMA=" "
_HOCHKOMMA[0]=34
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE809_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=500)AND($P_ADT[1]<=599))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; Holder angle")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Reference direction holder angle")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Clearance angle")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<" G[8]="<<$P_GG[8]<<" G[13]="<<$P_GG[13])
WRITE(_TEMP,_TEMP_FILE,"G[22]="<<$P_GG[22])
WRITE(_TEMP,_TEMP_FILE,"G[25]="<<$P_GG[25]<<" G[29]="<<$P_GG[29]<<" G[42]="<<$P_GG[42])
WRITE(_TEMP,_TEMP_FILE,"G[51]="<<$P_GG[51]<<" G[52]="<<$P_GG[52]<<" G[53]="<<$P_GG[53])
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE809("<<_HOCHKOMMA<<S_TRA<<_HOCHKOMMA<<","<<_BETA<<","<<_GAMA<<","<<_MODE<<","<<_FR_I<<","<<S_POLA<<","<<_DMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
CYCLE210(2)
S_TRA_INT=S_TRA
IF(S_TRA<>"0")AND($P_SUBPAR[1]<>0)
IF(_E_TURN_TR_NUM==1)
IF(S_TRA<>_E_TURN_TR_STR[0])
S_TRA_INT=_E_TURN_TR_STR[0]
ENDIF
ENDIF
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE809_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
; DELETE(_LOG,_LOG_FILE)
FILESIZE(_LOG,_LOG_FILE,S_LOGSIZE)
IF(S_LOGSIZE>20000)
_LOG_ON=0
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"*****************************")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"CYCLE809("<<S_TRA<<","<<_BETA<<","<<_GAMA<<","<<_MODE<<","<<_FR_I<<","<<S_POLA<<","<<_DMODE<<")")
S_STR="Aufruf aus "
FOR _I=0 TO $P_STACK-1
S_STR=S_STR<<SUBSTR($P_PROG[_I],3,STRLEN($P_PROG[_I])-3-4)<<" -> "
ENDFOR
WRITE(_LOG,_LOG_FILE,S_STR<<"CYCLE809")
IF($P_SEARCH)
WRITE(_LOG,_LOG_FILE,"  waehrend SSL")
ENDIF
IF($P_PROG_EVENT==5)
WRITE(_LOG,_LOG_FILE,"  nach SSL")
ENDIF
WRITE(_LOG,_LOG_FILE,"NCK-Version: "<<$AN_NCK_VERSION)
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[0])
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[1])
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[2])
WRITE(_LOG,_LOG_FILE,"             "<<$MN_VERSION_INFO[3])
IF(S_TRA<>S_TRA_INT)
WRITE(_LOG,_LOG_FILE,"Trafoname getauscht: "<<S_TRA<<" -> "<<S_TRA_INT)
ENDIF
IF(_MODE _DEC7==0)
IF(_MODE _DEC5)
S_STR="Direkt: B="<<_BETA<<" / C="<<_GAMA<<" / "<<SUBSTR("          gespiegeltnormal",(_MODE _DEC4)*10,10)
ELSE
IF(_BETA<>0)
S_STR="Beta="<<_BETA<<" Gamma="<<_GAMA<<" / "<<SUBSTR(" -+",_MODE _DEC4,1)
S_TRA_NO=NAMETOINT("$NT_NAME",S_TRA_INT,TRUE)
IF(S_TRA_NO>0)
IF($NT_CNTRL[S_TRA_NO] B_AND 'B1100000')
S_HIRTH=_MODE _DEC6
IF(S_HIRTH==1)
S_STR=S_STR<<" / Beta abrunden"
ELSE
IF(S_HIRTH==2)
S_STR=S_STR<<" / Beta aufrunden"
ELSE
S_STR=S_STR<<" / Beta-Abweichung minimal"
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
S_STR="Beta="<<_BETA<<" Gamma="<<_GAMA<<" AlphaC="<<S_POLA
S_TRA_NO=NAMETOINT("$NT_NAME",S_TRA_INT,TRUE)
IF(S_TRA_NO>0)
IF($NT_CNTRL[S_TRA_NO] B_AND 'B1100000')
S_HIRTH=_MODE _DEC6
IF(S_HIRTH==1)
S_STR=S_STR<<" / Hirth abrunden"
ELSE
IF(S_HIRTH==2)
S_STR=S_STR<<" / Hirth aufrunden"
ELSE
S_STR=S_STR<<" / Hirth-Abweichung minimal"
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF(_MODE _DEC5)
S_STR="Direkt: B="<<_BETA<<" / Spindel fest / "<<SUBSTR("          gespiegeltnormal",(_MODE _DEC4)*10,10)
ELSE
S_STR="Beta="<<_BETA<<" / Spindel fest / "<<SUBSTR("          gespiegeltnormal",(_MODE _DEC4)*10,10)
ENDIF
ENDIF
WRITE(_LOG,_LOG_FILE,S_STR)
ENDIF
STOPRE
IF(S_TRA_INT=="0")OR($P_SUBPAR[1]==0)
S_STR="G18_ORIENT(0)"
ELSE
S_STR="G18_ORIENT(1)"
ENDIF
WRTPR(S_STR,1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WRTPR("<<S_STR<<",1)")
ENDIF
IF($P_GG[15]==4)OR($P_GG[15]==7)
_P15=$P_GG[15]
N10 G972
G4 F0
ENDIF
$P_WPFRAME=CTRANS()
$P_WPFR=$P_WPFRAME
IF ISVAR("$P_PARTFR")
$P_PARTFR=CTRANS()
ENDIF
IF ISVAR("$P_TOOLFR")
$P_TOOLFR=CTRANS()
ENDIF
PAROTOF
TOROTOF
$P_PARTFRAME=CTRANS()
IF ISVAR("$P_PARTFR")
$P_PARTFR=$P_PARTFRAME
ENDIF
IF(S_TRA_INT=="0")OR($P_SUBPAR[1]==0)
S_STR="TOOL_ORIENT(0)"
WRTPR(S_STR,1)
CUTMODK="CLEAR"
TRAFOOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WRTPR("<<S_STR<<",1)")
WRITE(_LOG,_LOG_FILE,"CUTMODK=CLEAR")
WRITE(_LOG,_LOG_FILE,"TRAFOOF")
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800(75)")
ENDIF
N20 CUST_800(75)
S_C809_FIXED=0
S_C809_INV=0
GOTOF _RET
ENDIF
IF($P_MC)
S_STRAL=">MCALL<"
GOTOF _FEHL4
ENDIF
IF(_E_TURN_TR_NUM==0)
S_STRAL=S_TRA_INT
GOTOF _FEHL6
ENDIF
S_STRAL="(_MODE)"
IF(_MODE <0)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC1>5)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC2>1)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC3>0)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC4<1)OR(_MODE _DEC4>2)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC5>1)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC6>2)
GOTOF _FEHL4
ENDIF
IF(_MODE _DEC7>1)
GOTOF _FEHL4
ENDIF
S_STRAL="(_DMODE)"
IF(_DMODE <0)
GOTOF _FEHL4
ENDIF
IF(_DMODE _DEC1<>2)
GOTOF _FEHL4
ENDIF
IF($MC_TOOL_MANAGEMENT_TOOLHOLDER==0)
S_STRAL="MD 20124 (>0)"
GOTOF _FEHL10
ENDIF
IF($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H60000'<>'H40000')
S_STRAL="MD 20360 (Bit 17=0, 18=1)"
GOTOF _FEHL10
ENDIF
IF($MC_LIFTFAST_MODE_MASK B_AND 'H01'<>'H01')
S_STRAL="MD 21203 (Bit 0 = 1)"
GOTOF _FEHL10
ENDIF
IF($MNS_FUNCTION_MASK_SIM B_AND 'H20'<>'H20')
S_STRAL="MD 51226 (Bit 5 = 1)"
GOTOF _FEHL10
ENDIF
IF($SC_TOOL_LENGTH_CONST==-1018)
S_STRAL="SD 42940 (old version: -1018)"
GOTOF _FEHL10
ENDIF
IF($SC_TOOL_ORI_CONST_T<>0)AND($SC_TOOL_ORI_CONST_T<>18)
S_STRAL="SD 42956 (=0 or =18)"
GOTOF _FEHL10
ENDIF
IF(_F_AX_EXISTS[0]==0)AND(_F_AX_EXISTS[2]==0)
S_STRAL="MD 52206[] (=3)"
GOTOF _FEHL10
ENDIF
IF(_F_AX_EXISTS[1]==0)
S_STRAL="MD 52206[] (=1)"
GOTOF _FEHL10
ENDIF
IF($P_GG[22]<>2)
S_STRAL="CUT2DF"
GOTOF _FEHL22
ENDIF
S_TRA_NO=NAMETOINT("$NT_NAME",S_TRA_INT,TRUE)
S_STRAL=S_TRA_INT
IF(S_TRA_NO<0)
GOTOF _FEHL1
ENDIF
S_IDENT=$NT_IDENT[S_TRA_NO,0]
S_STRAL=S_TRA_INT
IF((S_IDENT _DEC5)<2)
GOTOF _FEHL13
ENDIF
S_STRAL=$NT_TRAFO_TYPE[S_TRA_NO]<<" (TRAORI_STAT)"
IF($NT_TRAFO_TYPE[S_TRA_NO]<>"TRAORI_STAT")
GOTOF _FEHL2
ENDIF
IF(($NT_IDENT[S_TRA_NO,0] _DEC4)<>0)AND(($NT_IDENT[S_TRA_NO,0] _DEC4)<>4)AND(($NT_IDENT[S_TRA_NO,0] _DEC4)<>5)AND(($NT_IDENT[S_TRA_NO,0] _DEC4)<>9)
S_STRAL=S_TRA_INT<<" ($NT_IDENT: "<<($NT_IDENT[S_TRA_NO,0] _DEC4)*1000<<")"
GOTOF _FEHL6
ENDIF
IF(_MODE _DEC5)
IF((S_IDENT _DEC1)==0)AND(_DMODE _DEC2<>1)
GOTOF _FEHL18
ENDIF
ENDIF
IF($P_TOOLNO==0)
GOTOF _FEHL7
ENDIF
IF($P_TOOL==0)
GOTOF _FEHL8
ENDIF
_TYP=$P_ADT[1]
IF(_MODE _DEC3==0)AND((_TYP<500)OR(_TYP>599))
GOTOF _FEHL9
ENDIF
IF(_MODE _DEC3==1)AND((_TYP>=500)AND(_TYP<=599))
GOTOF _FEHL19
ENDIF
IF((_DMODE _DEC1)==1)
G17
ELSE
IF((_DMODE _DEC1)==2)
G18
ELSE
IF((_DMODE _DEC1)==3)
G19
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ebene: G"<<$P_GG[6]+16)
ENDIF
IF(_MODE _DEC3==0)AND($P_GG[6]<>2)
S_STRAL="G"<<$P_GG[6]+16<<" (G18)"
GOTOF _FEHL3
ENDIF
IF($P_GG[53]<>1)
S_STRAL="Error: set TOROTOF"
GOTOF _FEHL23
ENDIF
_ZZ=$P_AXN1
_XX=$P_AXN2
_YY=$P_AXN3
_TC_FR=_MODE _DEC1
_TC_N_WZ=_MODE _DEC2
_TC_A_WZ=_MODE _DEC3 + 2
IF ISVAR("$MC_ORI_IPO_WITH_G_CODE")
_MD21104=$MC_ORI_IPO_WITH_G_CODE
ELSE
_MD21104=0
ENDIF
_P25=$P_GG[25]
IF(_MD21104==1)
_P51=$P_GG[51]
ENDIF
_P29=$P_GG[29]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N80 CUTMODK=CLEAR")
WRITE(_LOG,_LOG_FILE,"N90 TRAFOOF")
ENDIF
N80 CUTMODK="CLEAR"
N90 TRAFOOF
IF(_LOG_ON)
IF(_TYP>=500)AND(_TYP<=599)
WRITE(_LOG,_LOG_FILE,"Drehwerkzeug: TI="<<$P_TOOLNO<<" Typ="<<$P_ADT[1]<<" D="<<$P_TOOL<<" SL="<<$P_ADT[2]<<" Halterwinkel="<<$P_ADT[10]<<" Freiwinkel="<<$P_ADT[24]<<" Richtung="<<$P_ADT[11]<<"("<<S_WZ_DIR[$P_ADT[11]]<<")"<<" Einspannwinkel="<<$P_ADT[36])
ELSE
WRITE(_LOG,_LOG_FILE,"Werkzeug: TI="<<$P_TOOLNO<<" Typ="<<$P_ADT[1]<<" D="<<$P_TOOL)
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_800(70,"<<S_TRA_NO<<")")
ENDIF
N100 CUST_800(70,S_TRA_NO)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_TOOL_LENGTH_CONST  ="<<$SC_TOOL_LENGTH_CONST)
IF((ABS($SC_TOOL_LENGTH_CONST) _DEC4)==1)
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Die 1000er-Stelle wirkt in diesem NCK-Stand nicht mehr!")
ENDIF
WRITE(_LOG,_LOG_FILE,"$SC_TOOL_LENGTH_CONST_T="<<$SC_TOOL_LENGTH_CONST_T)
WRITE(_LOG,_LOG_FILE,"$SC_TOOL_LENGTH_TYPE   ="<<$SC_TOOL_LENGTH_TYPE)
WRITE(_LOG,_LOG_FILE,"$SC_TOOL_ORI_CONST_M   ="<<$SC_TOOL_ORI_CONST_M)
WRITE(_LOG,_LOG_FILE,"$SC_TOOL_ORI_CONST_T   ="<<$SC_TOOL_ORI_CONST_T)
WRITE(_LOG,_LOG_FILE,"$SC_CUTMOD_PLANE_TOL   ="<<$SC_CUTMOD_PLANE_TOL)
WRITE(_LOG,_LOG_FILE,"$SC_ORISOLH_INCLINE_TOL="<<$SC_ORISOLH_INCLINE_TOL)
WRITE(_LOG,_LOG_FILE,"$MCS_TURN_TOOL_FIXING  ="<<$MCS_TURN_TOOL_FIXING)
WRITE(_LOG,_LOG_FILE,"$P_ACT_TOOL_LENGTH_INDEX = "<<$P_ACT_TOOL_LENGTH_INDEX[0]<<" " <<$P_ACT_TOOL_LENGTH_INDEX[1]<<" "<<$P_ACT_TOOL_LENGTH_INDEX[2])
WRITE(_LOG,_LOG_FILE,"$NT_CNTRL["<<S_TRA_NO<<"]="<<$NT_CNTRL[S_TRA_NO])
WRITE(_LOG,_LOG_FILE,"$NT_IDENT["<<S_TRA_NO<<",0]="<<$NT_IDENT[S_TRA_NO,0])
S_STR=""
IF($P_WPFRAME[_XX,RT])OR($P_WPFRAME[_YY,RT])OR($P_WPFRAME[_ZZ,RT])OR($P_WPFRAME[_XX,MI])
IF($P_WPFRAME[_ZZ,RT])
S_STR=S_STR<<"CROT(Z,"<<$P_WPFRAME[_ZZ,RT]<<")"
ENDIF
IF($P_WPFRAME[_YY,RT])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CROT(Y,"<<$P_WPFRAME[_YY,RT]<<")"
ENDIF
IF($P_WPFRAME[_XX,RT])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CROT(X,"<<$P_WPFRAME[_XX,RT]<<")"
ENDIF
IF($P_WPFRAME[_XX,MI])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CMIRROR(X)"
ENDIF
ELSE
S_STR=S_STR<<"0"
ENDIF
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME="<<S_STR)
ENDIF
IF(_MODE _DEC7==0)
IF($NT_ROT_AX_NAME[S_TRA_NO,2]=="")
S_STRAL=S_TRA_INT<<" ($NT_ROT_AX_NAME["<<S_TRA_NO<<",2])"
GOTOF _FEHL6
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,2],TRUE)
_J=0
WHILE(_J>=0)AND(_J<=30)
IF($MN_AXCONF_MACHAX_NAME_TAB[_J]==$NK_AXIS[_I])
_J=-1
ELSE
_J=_J+1
ENDIF
ENDWHILE
IF(_J==31)
S_STRAL=S_TRA_INT<<" ($NK_AXIS["<<_I<<"])"
GOTOF _FEHL6
ENDIF
_J=$MA_SPIND_ASSIGN_TO_MACHAX[AXNAME($NK_AXIS[_I])]
IF($P_SMODE[_J]==1)
S_STRAL="S"<<_J
GOTOF _FEHL21
ENDIF
ENDIF
N110 TRAFOON(S_TRA_INT)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAFOON("<<S_TRA_INT<<") -> "<<$PC_TRAFO_NAME<<"("<<$PC_TRAFO_TYPE_NAME<<")")
WRITE(_LOG,_LOG_FILE,"$P_TRAFO_PARSET="<<$P_TRAFO_PARSET)
ENDIF
IF(_LOG_ON)
_VECT=CTRANS(_XX,$P_TOOLBIN[1],_YY,$P_TOOLBIN[2],_ZZ,$P_TOOLBIN[3])
WRITE(_LOG,_LOG_FILE,"Werkzeugrichtung (MKS): ("<<_VECT[_XX,TR]<<"/"<<_VECT[_YY,TR]<<"/"<<_VECT[_ZZ,TR]<<")")
_VECT=INVFRAME(CTRANS(_XX,-$P_ACTFRAME[_XX,TR],_YY,-$P_ACTFRAME[_YY,TR],_ZZ,-$P_ACTFRAME[_ZZ,TR]):$P_ACTFRAME):_VECT
WRITE(_LOG,_LOG_FILE,"Werkzeugrichtung (WKS): ("<<_VECT[_XX,TR]<<"/"<<_VECT[_YY,TR]<<"/"<<_VECT[_ZZ,TR]<<")")
ENDIF
IF(_MODE _DEC1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Freifahren: CYCLE807("<<(_MODE _DEC1)<<","<<$PC_TRAFO_NAME<<",200,"<<_FR_I<<")")
ENDIF
N115 CYCLE807((_MODE _DEC1),$PC_TRAFO_NAME,200,_FR_I)
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"kein Freifahren")
ENDIF
ENDIF
IF(_LOG_ON)
; WRITE(_LOG,_LOG_FILE,"Geoachsen: "<<$NT_GEO_AX_NAME[S_TRA_NO,0]<<" " <<$NT_GEO_AX_NAME[S_TRA_NO,2]<<" "<<$NT_GEO_AX_NAME[S_TRA_NO,1])
S_STR="Geoachsen: "
_I=NAMETOINT("$NK_NAME",$NT_GEO_AX_NAME[S_TRA_NO,0],TRUE)
IF(_I>=0)
S_STR=S_STR<<$NK_AXIS[_I]<<" "
_J=0
IF($MC_AXCONF_GEOAX_ASSIGN_TAB[_J])
IF($MC_AXCONF_MACHAX_USED[$MC_AXCONF_GEOAX_ASSIGN_TAB[_J]-1])
IF($NK_AXIS[_I]<>$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[$MC_AXCONF_GEOAX_ASSIGN_TAB[_J]-1]-1])
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Reihenfolge der Geoachsen prfen! "<<$NK_AXIS[_I])
ENDIF
ENDIF
ENDIF
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_GEO_AX_NAME[S_TRA_NO,1],TRUE)
IF(_I>=0)
S_STR=S_STR<<$NK_AXIS[_I]<<" "
_J=1
IF($MC_AXCONF_GEOAX_ASSIGN_TAB[_J])
IF($MC_AXCONF_MACHAX_USED[$MC_AXCONF_GEOAX_ASSIGN_TAB[_J]-1])
IF($NK_AXIS[_I]<>$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[$MC_AXCONF_GEOAX_ASSIGN_TAB[_J]-1]-1])
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Reihenfolge der Geoachsen prfen! "<<$NK_AXIS[_I])
ENDIF
ENDIF
ENDIF
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_GEO_AX_NAME[S_TRA_NO,2],TRUE)
IF(_I>=0)
S_STR=S_STR<<$NK_AXIS[_I]<<" "
_J=2
IF($MC_AXCONF_GEOAX_ASSIGN_TAB[_J])
IF($MC_AXCONF_MACHAX_USED[$MC_AXCONF_GEOAX_ASSIGN_TAB[_J]-1])
IF($NK_AXIS[_I]<>$MN_AXCONF_MACHAX_NAME_TAB[$MC_AXCONF_MACHAX_USED[$MC_AXCONF_GEOAX_ASSIGN_TAB[_J]-1]-1])
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Reihenfolge der Geoachsen prfen! "<<$NK_AXIS[_I])
ENDIF
ENDIF
ENDIF
ENDIF
WRITE(_LOG,_LOG_FILE,"  "<<S_STR)
S_STR=""
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,0],TRUE)
IF(_I>=0)
S_STR=S_STR<<"Tisch:"<<$NK_AXIS[_I]<<"("<<$NK_OFF_DIR[_I,0]<<","<<$NK_OFF_DIR[_I,1]<<","<<$NK_OFF_DIR[_I,2]<<") "
IF($NK_AXIS[_I]=="__ROTM_C")
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: IBN aus 4.5 (__ROTM_C) ***")
ENDIF
IF($NK_A_OFF[_I]<>0)
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Achsoffset Tisch = "<<$NK_A_OFF[_I]<<" ***")
ENDIF
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,1],TRUE)
IF(_I>=0)
S_STR=S_STR<<"Schwenk:"<<$NK_AXIS[_I]<<"("<<$NK_OFF_DIR[_I,0]<<","<<$NK_OFF_DIR[_I,1]<<","<<$NK_OFF_DIR[_I,2]<<") "
IF($NK_A_OFF[_I]<>0)
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Achsoffset Schwenk = "<<$NK_A_OFF[_I]<<" ***")
ENDIF
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,2],TRUE)
IF(_I>=0)
S_STR=S_STR<<"Wkz:"<<$NK_AXIS[_I]<<"("<<$NK_OFF_DIR[_I,0]<<","<<$NK_OFF_DIR[_I,1]<<","<<$NK_OFF_DIR[_I,2]<<") "
IF($NK_OFF_DIR[_I,0]<>0)OR($NK_OFF_DIR[_I,1]<>0)OR($NK_OFF_DIR[_I,2]<>-1)
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Wkz. normalerweise (0,0,-1) ***")
ENDIF
IF($NK_A_OFF[_I]<>0)
WRITE(_LOG,_LOG_FILE,"  *** ACHTUNG: Achsoffset Wkz = "<<$NK_A_OFF[_I]<<" ***")
ENDIF
ENDIF
WRITE(_LOG,_LOG_FILE,"  "<<S_STR)
ENDIF
IF(_LOG_ON)
S_STR="$AC_TRAFO_ORIAX_LOC:"
IF($PC_TRAFO_ROT_CHAIN_INDEX[0]>=0)
IF($PC_TRAFO_ROT_CHAN_AX_IN[0]<>NO_AXIS)
S_STR=S_STR<<" Tisch:"<<$AC_TRAFO_ORIAX_LOC[$PC_TRAFO_ROT_CHAN_AX_IN[0]]
ENDIF
ENDIF
IF($PC_TRAFO_ROT_CHAIN_INDEX[1]>=0)
IF($PC_TRAFO_ROT_CHAN_AX_IN[1]<>NO_AXIS)
S_STR=S_STR<<" Schwenk:"<<$AC_TRAFO_ORIAX_LOC[$PC_TRAFO_ROT_CHAN_AX_IN[1]]
ENDIF
ENDIF
IF($PC_TRAFO_ROT_CHAIN_INDEX[2]>=0)
IF($PC_TRAFO_ROT_CHAN_AX_IN[2]<>NO_AXIS)
S_STR=S_STR<<" Wkz:"<<$AC_TRAFO_ORIAX_LOC[$PC_TRAFO_ROT_CHAN_AX_IN[2]]
ENDIF
ENDIF
WRITE(_LOG,_LOG_FILE,"  "<<S_STR)
ENDIF
IF(_LOG_ON)
IF($NT_ROT_AX_CNT[S_TRA_NO,0]>-1)OR($NT_ROT_AX_CNT[S_TRA_NO,1]>-1)
WRITE(_LOG,_LOG_FILE,"  $NT_ROT_AX_CNT="<<$NT_ROT_AX_CNT[S_TRA_NO,0]<<", "<<$NT_ROT_AX_CNT[S_TRA_NO,1])
ENDIF
ENDIF
IF(_LOG_ON)
FOR _I=1 TO 1
IF($PC_TRAFO_ROT_CHAIN_INDEX[_I]>=0)
IF($PC_TRAFO_ROT_CHAN_AX_IN[_I]<>NO_AXIS)
WRITE(_LOG,_LOG_FILE,"  SWE "<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[_I])<<": "<<$MA_POS_LIMIT_MINUS[$PC_TRAFO_ROT_CHAN_AX_IN[_I]]<<" ... "<<$MA_POS_LIMIT_PLUS[$PC_TRAFO_ROT_CHAN_AX_IN[_I]])
ENDIF
ENDIF
ENDFOR
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$PC_TRAFO_ROT_CHAIN_INDEX = "<<$PC_TRAFO_ROT_CHAIN_INDEX[0]<<" " <<$PC_TRAFO_ROT_CHAIN_INDEX[1]<<" "<<$PC_TRAFO_ROT_CHAIN_INDEX[2])
ENDIF
IF(_MODE _DEC7==0)
IF($PC_TRAFO_ROT_CHAIN_INDEX[0]<0)OR($PC_TRAFO_ROT_CHAIN_INDEX[1]<0)OR($PC_TRAFO_ROT_CHAIN_INDEX[2]<0)
S_STRAL=S_TRA_INT<<" ($PC_TRAFO_ROT_CHAIN_INDEX)"
GOTOF _FEHL6
ENDIF
IF($MCS_TURN_TOOL_FIXING==1)
GOTOF _FEHL24
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Werkzeug fest!")
ENDIF
IF($PC_TRAFO_ROT_CHAIN_INDEX[0]<0)OR($PC_TRAFO_ROT_CHAIN_INDEX[1]<0)
S_STRAL=S_TRA_INT<<" ($PC_TRAFO_ROT_CHAIN_INDEX)"
GOTOF _FEHL6
ENDIF
ENDIF
_C=$PC_TRAFO_ROT_CHAN_AX_IN[0]
_B=$PC_TRAFO_ROT_CHAN_AX_IN[1]
_SP=$PC_TRAFO_ROT_CHAN_AX_IN[2]
S_AX_NAME[S_C_NR]=AXSTRING(_C)
S_AX_NAME[S_B_NR]=AXSTRING(_B)
S_AX_NAME[S_SP_NR]=AXSTRING(_SP)
IF(_C==NO_AXIS)
S_STRAL=S_TRA_INT<<" ($NT_ROT_AX_NAME["<<S_TRA_NO<<",0])"
GOTOF _FEHL6
ENDIF
IF(_B==NO_AXIS)
S_STRAL=S_TRA_INT<<" ($NT_ROT_AX_NAME["<<S_TRA_NO<<",1])"
GOTOF _FEHL6
ENDIF
IF(_SP==NO_AXIS)
S_STRAL=S_TRA_INT<<" ($NT_ROT_AX_NAME["<<S_TRA_NO<<",2])"
GOTOF _FEHL6
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,1],TRUE)
IF(_I>=0)
IF(ABS(SQRT(POT($NK_OFF_DIR[_I,0])+POT($NK_OFF_DIR[_I,1]))-ABS($NK_OFF_DIR[_I,2]))<0.01)
S_IS_45KIN=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"45-Kinematik")
ENDIF
ENDIF
ENDIF
IF(_C<>NO_AXIS)
IF(($NT_CNTRL[S_TRA_NO] B_AND 'B10')==0)
S_STRAL=S_TRA_INT<<" ($NT_CNTRL Bit 1)"
GOTOF _FEHL6
ENDIF
ENDIF
IF($NT_CNTRL[S_TRA_NO] B_AND 'B0010000')
S_STRAL=S_TRA_INT<<" ($NT_CNTRL: Bit 4=1)"
GOTOF _FEHL6
ENDIF
IF(($NT_CNTRL[S_TRA_NO] B_AND 'B1100000')=='B1100000')
S_STRAL=S_TRA_INT<<" ($NT_CNTRL: Bit 5+6=1)"
GOTOF _FEHL6
ENDIF
IF($NT_CNTRL[S_TRA_NO] B_AND 'B1100000')
S_HIRTH=_MODE _DEC6
IF(S_HIRTH>2)
S_STRAL="(_MODE)"
GOTOF _FEHL4
ENDIF
IF(_LOG_ON)
IF($NT_CNTRL[S_TRA_NO] B_AND 'B0100000')
IF($MA_ROT_IS_MODULO[_B])
WRITE(_LOG,_LOG_FILE,"Hirth: Rundachse "<<S_AX_NAME[S_B_NR]<<" "<<$MA_INDEX_AX_OFFSET[_B]<<"+/-n*"<<$MA_MODULO_RANGE[_B]/$MA_INDEX_AX_DENOMINATOR[_B]<<" (Modulo "<<$MA_MODULO_RANGE_START[_B]<<" ... "<<$MA_MODULO_RANGE_START[_B]+$MA_MODULO_RANGE[_B]<<")")
ELSE
WRITE(_LOG,_LOG_FILE,"Hirth: Rundachse "<<S_AX_NAME[S_B_NR]<<" "<<$MA_INDEX_AX_OFFSET[_B]<<"+/-n*"<<$MA_INDEX_AX_NUMERATOR[_B]/$MA_INDEX_AX_DENOMINATOR[_B])
ENDIF
ENDIF
IF($NT_CNTRL[S_TRA_NO] B_AND 'B1000000')
IF($MA_ROT_IS_MODULO[_SP])
WRITE(_LOG,_LOG_FILE,"Hirth: Werkzeugspindel "<<S_AX_NAME[S_SP_NR]<<" "<<$MA_INDEX_AX_OFFSET[_SP]<<"+/-n*"<<$MA_MODULO_RANGE[_SP]/$MA_INDEX_AX_DENOMINATOR[_SP]<<" (Modulo "<<$MA_MODULO_RANGE_START[_SP]<<" ... "<<$MA_MODULO_RANGE_START[_SP]+$MA_MODULO_RANGE[_SP]<<")")
ELSE
WRITE(_LOG,_LOG_FILE,"Hirth: Werkzeugspindel "<<S_AX_NAME[S_SP_NR]<<" "<<$MA_INDEX_AX_OFFSET[_SP]<<"+/-n*"<<$MA_INDEX_AX_NUMERATOR[_SP]/$MA_INDEX_AX_DENOMINATOR[_SP])
ENDIF
ENDIF
IF(_BETA<>0)
IF(S_HIRTH==1)
WRITE(_LOG,_LOG_FILE,"  Beta abrunden")
ELSE
IF(S_HIRTH==2)
WRITE(_LOG,_LOG_FILE,"  Beta aufrunden")
ELSE
WRITE(_LOG,_LOG_FILE,"  Beta-Abweichung minimal")
ENDIF
ENDIF
ELSE
IF(S_HIRTH==1)
WRITE(_LOG,_LOG_FILE,"  Hirth abrunden")
ELSE
IF(S_HIRTH==2)
WRITE(_LOG,_LOG_FILE,"  Hirth aufrunden")
ELSE
WRITE(_LOG,_LOG_FILE,"  Hirth-Abweichung minimal")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
S_CNTRL=1001
IF(S_HIRTH>-1)
S_CNTRL=S_CNTRL+10*(S_HIRTH+1)
ENDIF
IF(_MODE _DEC5)
S_CNTRL=S_CNTRL+100
ENDIF
IF(_MODE _DEC7==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Drehwerkzeug fest am Spindelkasten montiert")
WRITE(_LOG,_LOG_FILE,"    Gamma=0")
ENDIF
_GAMA=0
S_C809_FIXED=1
IF((_MODE _DEC5)==0)
IF(S_IS_45KIN)AND(ABS(_BETA)==90)
_GAMA=180
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    45-Kinematik und Beta=+/-90 -> Gamma="<<_GAMA)
ENDIF
ENDIF
ENDIF
ELSE
S_C809_FIXED=0
ENDIF
S_C809_INV=0
IF(_MODE _DEC5)OR(_MODE _DEC7==1)
IF((_MODE _DEC4)==1)
$P_WPFRAME=$P_WPFRAME:CMIRROR(_XX)
S_MI=1
S_C809_INV=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    Spiegelung der Drehebene -> Mirror X")
ENDIF
IF((_MODE _DEC5)==0)
_GAMA=180-_GAMA
S_RT=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    S_RT=1 -> Gamma="<<_GAMA)
ENDIF
ELSE
S_RT=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    S_RT=1 -> Spiegelung")
ENDIF
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
S_STR=""
IF($P_ACTFRAME[_XX,RT])OR($P_ACTFRAME[_YY,RT])OR($P_ACTFRAME[_ZZ,RT])OR($P_ACTFRAME[_XX,MI])
IF($P_ACTFRAME[_ZZ,RT])
S_STR=S_STR<<"CROT(Z,"<<$P_ACTFRAME[_ZZ,RT]<<")"
ENDIF
IF($P_ACTFRAME[_YY,RT])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CROT(Y,"<<$P_ACTFRAME[_YY,RT]<<")"
ENDIF
IF($P_ACTFRAME[_XX,RT])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CROT(X,"<<$P_ACTFRAME[_XX,RT]<<")"
ENDIF
IF($P_ACTFRAME[_XX,MI])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CMIRROR(X)"
ENDIF
ELSE
S_STR=S_STR<<"0"
ENDIF
WRITE(_LOG,_LOG_FILE,"$P_ACTFRAME="<<S_STR)
ENDIF
S_STR="N120 _STATUS=ORISOLH("<<S_CNTRL<<","<<_BETA<<","<<_GAMA<<")"
EXECSTRING(S_STR)
S_CHECK_RET_A:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,S_STR)
WRITE(_LOG,_LOG_FILE,"_STATUS="<<_STATUS)
WRITE(_LOG,_LOG_FILE,"$PC_TRAFO_ROT_CHAN_AX_IN[] 0:"<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[0])<<" 1:"<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[1])<<" 2:"<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[2]))
WRITE(_LOG,_LOG_FILE,"$P_ORI_SOL="<<$P_ORI_SOL)
WRITE(_LOG,_LOG_FILE,"$P_ORI_STAT="<<$P_ORI_STAT[0]<<" "<<$P_ORI_STAT[1]<<" "<<$P_ORI_STAT[2])
WRITE(_LOG,_LOG_FILE,"$P_ORI_POS="<<$P_ORI_POS[0,0]<<"/"<<$P_ORI_POS[1,0]<<"  "<<$P_ORI_POS[0,1]<<"/"<<$P_ORI_POS[1,1]<<"  "<<$P_ORI_POS[0,2]<<"/"<<$P_ORI_POS[1,2])
IF(S_HIRTH>-1)
WRITE(_LOG,_LOG_FILE,"$P_ORI_DIFF="<<$P_ORI_DIFF[0,0]<<"/"<<$P_ORI_DIFF[1,0]<<"  "<<$P_ORI_DIFF[0,1]<<"/"<<$P_ORI_DIFF[1,1]<<"  "<<$P_ORI_DIFF[0,2]<<"/"<<$P_ORI_DIFF[1,2])
ENDIF
ENDIF
IF(_STATUS<0)
CASE _STATUS OF -8 GOTOF S_ERR_8 -9 GOTOF S_ERR_9 -10 GOTOF S_ERR_10 -11 GOTOF S_ERR_11 -12 GOTOF S_ERR_12 -13 GOTOF S_ERR_13 -14 GOTOF S_ERR_14 -17 GOTOF S_ERR_17 DEFAULT GOTOF S_ERR_DEFAULT
S_ERR_8:
IF(_DMODE _DEC2<>1)
S_STRAL="G18"
GOTOF _FEHL17
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  GAMMA bei Direkt zu gross, aber Aufruf aus PROG_EVENT -> OK")
ENDIF
GOTOF S_ERR_END
ENDIF
S_ERR_9:
GOTOF _FEHL20
S_ERR_10:
GOTOF _FEHL8
S_ERR_11:
IF($P_ORI_SOL==-7)
S_STRAL=""
IF($P_ORI_STAT[1]<0)
S_STRAL=S_STRAL<<S_AX_NAME[S_B_NR]<<"="<<_BETA<<" "
ENDIF
IF($P_ORI_STAT[2]<0)
S_STRAL=S_STRAL<<S_AX_NAME[S_SP_NR]<<"="<<_GAMA<<""
ENDIF
GOTOF _FEHL16
ELSE
IF($P_ORI_SOL==-6)
S_STRAL="G18"
GOTOF _FEHL17
ELSE
GOTOF _FEHL5
ENDIF
ENDIF
S_ERR_12:
S_ERR_13:
S_ERR_14:
GOTOF _FEHL5
S_ERR_17:
S_STRAL=""
IF($P_ORI_STAT[1]<0)
S_STRAL=S_STRAL<<S_AX_NAME[S_B_NR]<<"="<<_BETA<<" "
ENDIF
IF($P_ORI_STAT[2]<0)
S_STRAL=S_STRAL<<S_AX_NAME[S_SP_NR]<<"="<<_GAMA<<""
ENDIF
GOTOF _FEHL16
S_ERR_DEFAULT:
S_STRAL="CYCLE809/3/"<<_STATUS
GOTOF _FEHL11
S_ERR_END:
ENDIF
S_CHECK_RET_E:
IF($P_ORI_SOL _DEC1<0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Fehler: $P_ORI_SOL 1er="<<($P_ORI_SOL _DEC1))
ENDIF
IF(_DMODE _DEC2<>1)OR($P_ORI_SOL _DEC1<>-6)
S_STRAL="CYCLE809/1"
GOTOF _FEHL11
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  GAMMA bei Direkt zu gross, aber Aufruf aus PROG_EVENT -> OK")
ENDIF
ENDIF
ENDIF
IF($P_ORI_SOL _DEC1==0)
GOTOF _FEHL5
ENDIF
IF($P_ORI_STAT[0]<0)OR($P_ORI_STAT[1]<0)OR($P_ORI_STAT[2]<0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Fehler: $P_ORI_STAT: "<<$P_ORI_STAT[0]<<"/"<<$P_ORI_STAT[1]<<"/"<<$P_ORI_STAT[2])
ENDIF
S_STRAL="CYCLE809/2"
GOTOF _FEHL11
ENDIF
IF(_MODE _DEC5)
ELSE
IF((S_IDENT _DEC4)==0)
_PM=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"keine Richtungsauswahl, fest -1 (IDENT="<<S_IDENT<<")")
ENDIF
ELSE
IF((S_IDENT _DEC4)==5)
_PM=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"keine Richtungsauswahl, fest +1 (IDENT="<<S_IDENT<<")")
ENDIF
ELSE
_PM=((_MODE _DEC4)-1)*2-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Richtungsauswahl "<<_PM<<" (IDENT="<<S_IDENT<<", MODE="<<_MODE<<")")
ENDIF
ENDIF
ENDIF
ENDIF
S_SOL=-1
IF($P_ORI_SOL _DEC1==1)
IF($P_ORI_STAT[0] _DEC1)OR($P_ORI_STAT[1] _DEC1)OR($P_ORI_STAT[2] _DEC1)
GOTOF _FEHL5
ENDIF
S_SOL=0
ELSE
IF($P_ORI_SOL _DEC1==2)
IF($P_ORI_STAT[0] _DEC1)OR($P_ORI_STAT[1] _DEC1)OR($P_ORI_STAT[2] _DEC1)
S_SOL=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-> nur Loesung 2 moeglich!")
ENDIF
IF($P_ORI_STAT[0] _DEC2)OR($P_ORI_STAT[1] _DEC2)OR($P_ORI_STAT[2] _DEC2)
GOTOF _FEHL5
ENDIF
ELSE
IF($P_ORI_STAT[0] _DEC2)OR($P_ORI_STAT[1] _DEC2)OR($P_ORI_STAT[2] _DEC2)
S_SOL=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-> nur Loesung 1 moeglich!")
ENDIF
ELSE
IF(_MODE _DEC5)
IF(_MODE _DEC7==1)
IF(((($P_ORI_POS[0,S_SP_NR] MOD 360)+360)MOD 360)==0)
S_SOL=0
ELSE
S_SOL=1
ENDIF
IF(S_MI)
S_SOL=1-S_SOL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Loesungen getauscht: KS gespiegelt")
ENDIF
ENDIF
IF(S_IS_45KIN)AND(ABS(_BETA)==180)
S_SOL=1-S_SOL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Loesungen getauscht: 45-Kinematik und B=+/-180")
ENDIF
ENDIF
ELSE
S_SOL=0
ENDIF
ELSE
IF(_MODE _DEC7==1)
IF(((($P_ORI_POS[0,S_SP_NR] MOD 360)+360)MOD 360)==0)
S_SOL=0
ELSE
S_SOL=1
ENDIF
ELSE
IF(_PM==-1)
IF($P_ORI_POS[0,S_B_NR]==$P_ORI_POS[1,S_B_NR])
IF(((($P_ORI_POS[0,S_SP_NR] MOD 360)+360)MOD 360)==180)
S_SOL=0
ELSE
S_SOL=1
ENDIF
ELSE
IF($P_ORI_POS[0,S_B_NR]<$P_ORI_POS[1,S_B_NR])
S_SOL=0
ELSE
S_SOL=1
ENDIF
ENDIF
ELSE
IF($P_ORI_POS[0,S_B_NR]==$P_ORI_POS[1,S_B_NR])
IF(((($P_ORI_POS[0,S_SP_NR] MOD 360)+360)MOD 360)==0)
S_SOL=0
ELSE
S_SOL=1
ENDIF
ELSE
IF($P_ORI_POS[0,S_B_NR]<$P_ORI_POS[1,S_B_NR])
S_SOL=1
ELSE
S_SOL=0
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-> unendlich viele Loesungen")
ENDIF
S_SOL=-1
IF(_MODE _DEC5)
S_B=_BETA
S_SP=_GAMA
S_C=$P_ORI_POS[0,S_C_NR]
_BETA=$P_ORI_POS[0,S_B_NR]
_GAMA=$P_ORI_POS[0,S_SP_NR]
IF(S_MI)
_GAMA=_GAMA+180
S_RT=1-S_RT
ENDIF
ELSE
S_B=$P_ORI_POS[0,S_B_NR]
IF(_MODE _DEC7==1)
S_POLA=$P_ORI_POS[0,S_SP_NR]
S_SP=0
S_C=-S_POLA
ELSE
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,2],TRUE)
IF(_I>=0)
IF($NK_OFF_DIR[_I,0]==0)AND($NK_OFF_DIR[_I,1]==0)AND($NK_OFF_DIR[_I,2]==1)
S_SP_DIR=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Werkzeugspindel ist invertiert")
ENDIF
ELSE
S_SP_DIR=1
ENDIF
ENDIF
S_SP=$P_ORI_POS[0,S_SP_NR]
S_C=$P_ORI_POS[0,S_C_NR]
IF(NOT($MCS_FUNCTION_MASK_TURN B_AND 'H4000'))
S_C=0
IF(_BETA==0)
IF(S_HIRTH>-1)AND($NT_CNTRL[S_TRA_NO] B_AND 'B1000000')
S_SP=S_SP-$P_ORI_DIFF[0,S_SP_NR]
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Polstellung mit redundanter Rundachse:")
WRITE(_LOG,_LOG_FILE,"  Winkelfeinheit: 1/"<<$MN_INT_INCR_PER_DEG)
WRITE(_LOG,_LOG_FILE,"  Beta=0.0001")
ENDIF
S_STR="N200 _STATUS=ORISOLH(1021,0.0001,0)"
EXECSTRING(S_STR)
REPEAT S_CHECK_RET_A S_CHECK_RET_E
S_SOL_TEMP=0
IF(ABS($P_ORI_POS[1,S_SP_NR])<ABS($P_ORI_POS[0,S_SP_NR]))
S_SOL_TEMP=1
ENDIF
S_SP=ROUND($P_ORI_POS[S_SOL_TEMP,S_SP_NR]*1000)/1000
S_B=ROUND($P_ORI_POS[S_SOL_TEMP,S_B_NR]*1000)/1000
S_C=ROUND($P_ORI_POS[S_SOL_TEMP,S_C_NR]*1000)/1000
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Auswahl:"<<S_SOL_TEMP)
WRITE(_LOG,_LOG_FILE,"  S_SP="<<S_SP)
WRITE(_LOG,_LOG_FILE,"  S_B="<<S_B)
WRITE(_LOG,_LOG_FILE,"  S_C="<<S_C)
ENDIF
IF(_GAMA<>0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Gamma (bei Beta=0): "<<_GAMA)
ENDIF
S_SP=S_SP-_GAMA
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    S_SP="<<S_SP)
ENDIF
ENDIF
S_STR="N210 _STATUS=ORISOLH("<<S_CNTRL<<","<<_BETA<<","<<_GAMA<<")"
EXECSTRING(S_STR)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,S_STR)
WRITE(_LOG,_LOG_FILE,"_STATUS="<<_STATUS)
WRITE(_LOG,_LOG_FILE,"$PC_TRAFO_ROT_CHAN_AX_IN[] 0:"<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[0])<<" 1:"<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[1])<<" 2:"<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[2]))
WRITE(_LOG,_LOG_FILE,"$P_ORI_SOL="<<$P_ORI_SOL)
WRITE(_LOG,_LOG_FILE,"$P_ORI_STAT="<<$P_ORI_STAT[0]<<" "<<$P_ORI_STAT[1]<<" "<<$P_ORI_STAT[2])
WRITE(_LOG,_LOG_FILE,"$P_ORI_POS="<<$P_ORI_POS[0,0]<<"/"<<$P_ORI_POS[1,0]<<"  "<<$P_ORI_POS[0,1]<<"/"<<$P_ORI_POS[1,1]<<"  "<<$P_ORI_POS[0,2]<<"/"<<$P_ORI_POS[1,2])
IF(S_HIRTH>-1)
WRITE(_LOG,_LOG_FILE,"$P_ORI_DIFF="<<$P_ORI_DIFF[0,0]<<"/"<<$P_ORI_DIFF[1,0]<<"  "<<$P_ORI_DIFF[0,1]<<"/"<<$P_ORI_DIFF[1,1]<<"  "<<$P_ORI_DIFF[0,2]<<"/"<<$P_ORI_DIFF[1,2])
ENDIF
ENDIF
ENDIF
S_SP=S_SP-S_POLA*S_SP_DIR
IF(_BETA==0)
IF(S_HIRTH>-1)AND($NT_CNTRL[S_TRA_NO] B_AND 'B1000000')
IF($MA_ROT_IS_MODULO[_SP])
S_SP_D=$MA_MODULO_RANGE[_SP]/$MA_INDEX_AX_DENOMINATOR[_SP]
ELSE
S_SP_D=$MA_INDEX_AX_NUMERATOR[_SP]/$MA_INDEX_AX_DENOMINATOR[_SP]
ENDIF
S_SP_DIFF=((S_SP+3600) MOD S_SP_D)
IF(S_SP_DIFF==0)
S_SP1=0
S_SP2=0
ELSE
S_SP1=-S_SP_DIFF
S_SP2=S_SP1+S_SP_D
ENDIF
IF(S_HIRTH==1)
S_SP_DIFF=S_SP1
ELSE
IF(S_HIRTH==2)
S_SP_DIFF=S_SP2
ELSE
IF(ABS(S_SP1)<=ABS(S_SP2))
S_SP_DIFF=S_SP1
ELSE
S_SP_DIFF=S_SP2
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Hirth -> SP="<<S_SP<<" diff="<<S_SP_DIFF<<" ("<<S_SP1<<"..."<<S_SP2<<")")
ENDIF
ELSE
S_SP_DIFF=0
ENDIF
ELSE
IF(_PM==1)
S_SP_DIFF=0
ELSE
S_SP_DIFF=180
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Minus!")
ENDIF
ENDIF
ENDIF
S_SP=S_SP+S_SP_DIFF
S_C=S_C-S_POLA+S_SP_DIFF*S_SP_DIR
S_SP=((S_SP MOD 360)+360)MOD 360
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  _GAMA="<<_GAMA)
WRITE(_LOG,_LOG_FILE,"  S_POLA="<<S_POLA)
WRITE(_LOG,_LOG_FILE,"  S_SP="<<S_SP)
WRITE(_LOG,_LOG_FILE,"  S_B="<<S_B)
WRITE(_LOG,_LOG_FILE,"  S_C="<<S_C)
WRITE(_LOG,_LOG_FILE,"  $P_ORI_POS[0,S_SP_NR]="<<$P_ORI_POS[0,S_SP_NR])
WRITE(_LOG,_LOG_FILE,"  $P_ORI_POS[0,S_C_NR] ="<<$P_ORI_POS[0,S_C_NR])
ENDIF
ENDIF
ENDIF
ENDIF
IF(S_SOL>=0)
IF(_MODE _DEC5)
S_B=_BETA
S_SP=_GAMA
S_C=$P_ORI_POS[S_SOL,S_C_NR]
_BETA=$P_ORI_POS[S_SOL,S_B_NR]
_GAMA=$P_ORI_POS[S_SOL,S_SP_NR]
ELSE
S_B=$P_ORI_POS[S_SOL,S_B_NR]
S_SP=(($P_ORI_POS[S_SOL,S_SP_NR] MOD 360)+360)MOD 360
S_C=$P_ORI_POS[S_SOL,S_C_NR]
ENDIF
ENDIF
IF(_LOG_ON)
IF(S_SOL>=0)
WRITE(_LOG,_LOG_FILE,"Loesung: "<<S_SOL+1)
WRITE(_LOG,_LOG_FILE,"S_SP="<<S_SP)
ELSE
WRITE(_LOG,_LOG_FILE,"Loesung beliebig: S_SP="<<S_SP)
ENDIF
WRITE(_LOG,_LOG_FILE,"S_B="<<S_B)
WRITE(_LOG,_LOG_FILE,"S_C="<<S_C)
IF(_MODE _DEC5)
WRITE(_LOG,_LOG_FILE,"Beta ="<<_BETA)
WRITE(_LOG,_LOG_FILE,"Gamma="<<_GAMA)
ENDIF
ENDIF
ORIMKS
IF($MC_ORI_IPO_WITH_G_CODE)
ORIAXES
ENDIF
S_STR="TOOL_ORIENT("<<_GAMA<<")"
WRTPR(S_STR,1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WRTPR("<<S_STR<<",1)")
WRITE(_LOG,_LOG_FILE,"N300 TRAFOON("<<S_TRA_INT<<")")
ENDIF
N300 TRAFOON(S_TRA_INT)
S_SP=((S_SP MOD 360)+360)MOD 360
IF(_MODE _DEC7==1)
IF(S_SP<>0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehwerkzeug fest am Spindelkasten montiert, aber SPOS="<<S_SP)
ENDIF
GOTOF _FEHL5
ENDIF
ENDIF
IF(_LOG_ON)
IF(_TC_N_WZ)
S_STR="mit nachfuehren"
ELSE
S_STR="ohne nachfuehren"
ENDIF
WRITE(_LOG,_LOG_FILE,"Achsen ausrichten: CUST_800(71,"<<S_TRA_NO<<","<<S_B<<","<<S_SP<<") ("<<S_STR<<")")
ENDIF
N310 CUST_800(71,S_TRA_NO,S_B,S_SP)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Achsen nach ausrichten: "<<AXSTRING(_B)<<"="<<$P_EP[_B]<<" "<<AXSTRING(_SP)<<"="<<$P_EP[_SP])
ENDIF
G4F0
IF($P_SEARCH)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  waehrend SSL -> _TC_SSL_WP="<<S_C)
ENDIF
_TC_SSL_WP=S_C
ENDIF
IF(_DMODE _DEC2==1)AND($P_PROG_EVENT==5)AND(_MODE _DEC5)AND(_TC_SSL_WP<>9999)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  nach SSL -> _TC_SSL_WP="<<_TC_SSL_WP<<" -> S_C")
ENDIF
S_C=_TC_SSL_WP
ENDIF
IF(S_MI==0)
$P_WPFRAME=$P_WPFRAME:CROT(_ZZ,-S_C)
ELSE
$P_WPFRAME=$P_WPFRAME:CMIRROR(_XX)
$P_WPFRAME=$P_WPFRAME:CROT(_ZZ,-S_C+S_RT*180)
$P_WPFRAME=$P_WPFRAME:CMIRROR(_XX)
ENDIF
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
S_STR=""
IF($P_WPFRAME[_XX,RT])OR($P_WPFRAME[_YY,RT])OR($P_WPFRAME[_ZZ,RT])OR($P_WPFRAME[_XX,MI])
IF($P_WPFRAME[_ZZ,RT])
S_STR=S_STR<<"CROT(Z,"<<$P_WPFRAME[_ZZ,RT]<<")"
ENDIF
IF($P_WPFRAME[_YY,RT])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CROT(Y,"<<$P_WPFRAME[_YY,RT]<<")"
ENDIF
IF($P_WPFRAME[_XX,RT])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CROT(X,"<<$P_WPFRAME[_XX,RT]<<")"
ENDIF
IF($P_WPFRAME[_XX,MI])
IF(S_STR<>"")
S_STR=S_STR<<":"
ENDIF
S_STR=S_STR<<"CMIRROR(X)"
ENDIF
ELSE
S_STR=S_STR<<"0"
ENDIF
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME="<<S_STR)
ENDIF
N400 TRAFOON(S_TRA_INT)
S_STR="PARTFRAME("<<$P_TRAFRAME_P[_XX,TR]*_FAK1/_FAK3<<","<<$P_TRAFRAME_P[_YY,TR]*_FAK1/_FAK3<<","<<$P_TRAFRAME_P[_ZZ,TR]*_FAK1/_FAK3<<","<<$P_TRAFRAME_P[_XX,RT]<<","<<$P_TRAFRAME_P[_YY,RT]<<","<<$P_TRAFRAME[_ZZ,RT]<<")"
WRTPR(S_STR,1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"WRTPR("<<S_STR<<",1)")
ENDIF
IF(_LOG_ON)
_VECT=CTRANS(_XX,$P_TOOLBIN[1],_YY,$P_TOOLBIN[2],_ZZ,$P_TOOLBIN[3])
WRITE(_LOG,_LOG_FILE,"Werkzeugrichtung (MKS): ("<<_VECT[_XX,TR]<<"/"<<_VECT[_YY,TR]<<"/"<<_VECT[_ZZ,TR]<<")")
_VECT=INVFRAME(CTRANS(_XX,-$P_ACTFRAME[_XX,TR],_YY,-$P_ACTFRAME[_YY,TR],_ZZ,-$P_ACTFRAME[_ZZ,TR]):$P_ACTFRAME):_VECT
WRITE(_LOG,_LOG_FILE,"Werkzeugrichtung (WKS): ("<<_VECT[_XX,TR]<<"/"<<_VECT[_YY,TR]<<"/"<<_VECT[_ZZ,TR]<<")")
WRITE(_LOG,_LOG_FILE,"S_C809_FIXED="<<S_C809_FIXED)
WRITE(_LOG,_LOG_FILE,"S_C809_INV="<<S_C809_INV)
ENDIF
IF($P_CUTMOD)
N500 CUTMOD=0
ENDIF
N510 CUTMODK="NEW"
N520 D=$P_TOOL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUTMODK=NEW ("<<$P_CUTMODK<<") ANG="<<$P_CUTMOD_ANG<<" INV="<<$P_CUT_INV)
WRITE(_LOG,_LOG_FILE,"  D="<<$P_TOOL<<" SL="<<$P_ADT[2]<<" Halterwinkel="<<$P_ADT[10]<<" Freiwinkel="<<$P_ADT[24]<<" Richtung="<<$P_ADT[11]<<"("<<S_WZ_DIR[$P_ADT[11]]<<")")
WRITE(_LOG,_LOG_FILE,"  $P_CUTMOD_ERR="<<$P_CUTMOD_ERR)
IF($P_CUTMOD_ERR)
IF($P_CUTMOD_ERR B_AND'B00000001')
WRITE(_LOG,_LOG_FILE,"    Bit 0: Fr das aktive Werkzeug ist keine gltige Schnittrichtung definiert.")
ENDIF
IF($P_CUTMOD_ERR B_AND'B00000010')
WRITE(_LOG,_LOG_FILE,"    Bit 1: Die Schneidenwinkel (Freiwinkel und Halterwinkel) des aktiven Werkzeugs sind beide Null.")
ENDIF
IF($P_CUTMOD_ERR B_AND'B00000100')
WRITE(_LOG,_LOG_FILE,"    Bit 2: Der Freiwinkel des aktiven Werkzeugs hat einen unzulssigen Wert (kleiner 0 Grad oder grer 180 Grad).")
ENDIF
IF($P_CUTMOD_ERR B_AND'B00001000')
WRITE(_LOG,_LOG_FILE,"    Bit 3: Der Halterwinkel des aktiven Werkzeugs hat einen unzulssigen Wert (kleiner 0 Grad oder grer 90 Grad).")
ENDIF
IF($P_CUTMOD_ERR B_AND'B00010000')
WRITE(_LOG,_LOG_FILE,"    Bit 4: Der Plattenwinkel des aktiven Werkzeugs hat einen unzulssigen Wert (kleiner 0 Grad oder grer 90 Grad).")
ENDIF
IF($P_CUTMOD_ERR B_AND'B00100000')
WRITE(_LOG,_LOG_FILE,"    Bit 5: Die Kombination Schneidenlage - Halterwinkel des aktiven Werkzeugs ist unzulssig.")
ENDIF
IF($P_CUTMOD_ERR B_AND'B01000000')
WRITE(_LOG,_LOG_FILE,"    Bit 6: Unzulssige Drehung des aktiven Werkzeugs.")
ENDIF
IF($P_CUTMOD_ERR B_AND'B10000000')
WRITE(_LOG,_LOG_FILE,"    Bit 7: Die Schneidplatte liegt nicht in der Bearbeitungsebene.")
ENDIF
IF($P_CUTMOD_ERR B_AND'B100000000')
WRITE(_LOG,_LOG_FILE,"    Bit 8: Die Schneidplatte liegt nicht in der Bearbeitungsebene (ALPHA>1).")
ENDIF
IF(($MC_CUTMOD_ERR B_AND 'HCFFF')<>'HCFFF')
S_STRAL="Error CUTMODK:set MD20125=CFFF"
ELSE
S_STRAL="Error CUTMODK: "<<SPRINT("%X",$P_CUTMOD_ERR)<<"H"
ENDIF
GOTOF _FEHL23
ENDIF
WRITE(_LOG,_LOG_FILE,"$P_TOOLO   = "<<$P_TOOLO[1]<<" " <<$P_TOOLO[2]<<" "<<$P_TOOLO[3])
WRITE(_LOG,_LOG_FILE,"$P_TOOLROT = "<<$P_TOOLROT[1]<<" " <<$P_TOOLROT[2]<<" "<<$P_TOOLROT[3])
WRITE(_LOG,_LOG_FILE,"$P_TOOLBIN = "<<$P_TOOLBIN[1]<<" " <<$P_TOOLBIN[2]<<" "<<$P_TOOLBIN[3])
ENDIF
;
;msg("Tool-Ori: ("<<$P_TOOLO[1]<<"/"<<$P_TOOLO[2]<<"/"<<$P_TOOLO[3]<<") ("<<$P_TOOLROT[1]<<"/"<<$P_TOOLROT[2]<<"/"<<$P_TOOLROT[3]<<") ("<<$P_TOOLBIN[1]<<"/"<<$P_TOOLBIN[2]<<"/"<<$P_TOOLBIN[3]<<")")
;m0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ende: CUST_800(72,"<<S_TRA_NO<<")")
ENDIF
N600 CUST_800(72,S_TRA_NO)
IF(_P15)
G[15]=_P15
ENDIF
G[25]=_P25
IF(_MD21104==1)
G[51]=_P51
ENDIF
IF(NOT $P_SEARCH)AND($P_SEARCHL==2)AND($P_PROG_EVENT==5)
G[29]=_P29
ENDIF
;msg("Ausrichten: B="<<S_B<<" SP="<<S_SP<<" C="<<S_C<<" Beta="<<_BETA<<" Gama="<<_GAMA<<" SL="<<$P_ADT[2])
;m0
_RET:
RET
_FEHL1: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61167 Transformation nicht eingerichtet: "<<S_STRAL)
ENDIF
N780901 SETAL(61167,S_STRAL)
RET
_FEHL2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61164 Transformation hat falschen Typ: "<<S_STRAL)
ENDIF
N780902 SETAL(61164,S_STRAL)
RET
_FEHL3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61168 Falsche Bearbeitungsbene: "<<S_STRAL)
ENDIF
N780903 SETAL(61168,S_STRAL)
RET
_FEHL4: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61019 Parameter "<<S_STRAL<<" falsch definiert")
ENDIF
N780904 SETAL(61019,S_STRAL)
RET
_FEHL5: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61184 Mit aktuellen Eingabewinkelwerten keine Loesung moeglich")
ENDIF
N780905 SETAL(61184)
RET
_FEHL6: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61165 Transformation falsch eingerichtet: "<<S_STRAL)
ENDIF
N780906 SETAL(61165,S_STRAL)
RET
_FEHL7: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61009 Aktive Werkzeugnummer = 0")
ENDIF
N780907 SETAL(61009)
RET
_FEHL8: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61000 Keine Werkzeugkorrektur aktiv")
ENDIF
N780908 SETAL(61000)
RET
_FEHL9: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61195 Ausrichten Drehwerkzeug nur mit aktivem Drehwerkzeug moeglich")
ENDIF
N780909 SETAL(61195)
RET
_FEHL10: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61166 Maschinendatum pruefen: "<<S_STRAL)
ENDIF
N780910 SETAL(61166,S_STRAL)
RET
_FEHL11: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61099 Interner Zyklenfehler ("<<S_STRAL<<")")
ENDIF
N780911 SETAL(61099,S_STRAL)
RET
_FEHL12: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61183 Schwenken CYCLE800: Parameter Freifahrmodus ausserhalb des Wertebereichs: "<<S_STRAL)
ENDIF
N780912 SETAL(61183,S_STRAL)
RET
_FEHL13: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61152 B-Achskinematik (Drehtechnologie) nicht oder falsch in IBN Schwenken eingerichtet --> Fehlercode: "<<S_STRAL)
ENDIF
N780913 SETAL(61152,S_STRAL)
RET
_FEHL14: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61147 Transformation nicht aktiv: "<<S_STRAL)
ENDIF
N780914 SETAL(61147,S_STRAL)
RET
_FEHL15: STOPRE
RET
_FEHL16: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61625 Programmierter Winkelwert liegt nicht im Raster der Hirth-Verzahnung: "<<S_STRAL)
ENDIF
N780916 SETAL(61625,S_STRAL)
RET
_FEHL17: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61626 Mit den programmierten Winkelwerten liegt die Schneidplatte nicht in der Drehebene "<<S_STRAL)
ENDIF
N780917 SETAL(61626,S_STRAL)
RET
_FEHL18: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61153 kein Schwenkmodus Rundachsen direkt moeglich - Fehlercode: F")
ENDIF
N780918 SETAL(61153,"F")
RET
_FEHL19: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61174 Ausrichten Fraeswerkzeug mit aktivem Drehwerkzeug nicht moeglich")
ENDIF
N780919 SETAL(61174)
RET
_FEHL20: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61275 Zielpunkt verletzt Softwareendschalter!")
ENDIF
N780920 SETAL(61275)
RET
_FEHL21: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61067 Werkzeugspindel ist im Spindelbetrieb: "<<S_STRAL)
ENDIF
N780921 SETAL(61067,S_STRAL)
RET
_FEHL22: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61068 Zyklus erfordert G-Code: "<<S_STRAL)
ENDIF
N780922 SETAL(61068,S_STRAL)
RET
_FEHL23: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61098 "<<S_STRAL)
ENDIF
N780923 SETAL(61098,S_STRAL)
RET
_FEHL24: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61627 Rotation des Drehwerkzeugs nicht moeglich, da Werkzeugaufnahme fest ist")
ENDIF
N780924 SETAL(61627)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_HOLES1_SPF
PROC HOLES1 (REAL SPCA,REAL SPCO,REAL STA1,REAL FDIS,REAL DBH,INT NUM,INT __VARI,INT _UMODE,STRING[200] _HIDE,INT _NSP,INT _DMODE) SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Positions row
DEF AXIS _XX,_YY,_ZZ
DEF INT _DMODE1,_VARI,_ABS,_ORD,_APP,_HH2=-1
DEF REAL _FAK1,_HH1
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_HOLES1_MPF",_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_HOLES1_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"HOLES1("<<SPCA<<","<<SPCO<<","<<STA1<<","<< FDIS<<","<<DBH<<","<<NUM<<","<<_VARI<<","<<_UMODE<<",'"'"<<_HIDE<<"'"',"<<_NSP<<","<<_DMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL1
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_RE_CYCFR=$P_CYCFRAME
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF ISAXIS(_ABS)
_XX=$P_AXN1
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,SPCA*1/_FAK1)
ENDIF
IF ISAXIS(_ORD)
_YY=$P_AXN2
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_YY,SPCO*1/_FAK1)
ENDIF
IF ISAXIS(_APP)
_ZZ=$P_AXN3
IF ISAXIS(_ABS)
$P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,STA1)
ELSE
IF(STA1/90 MOD 2)==0
_SERR="(STA1)"
GOTOF _FEHL2
ENDIF
_HH1=STA1 MOD 360
IF (_HH1==90) OR (_HH1==-270)
_HH2=1
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_YY,FDIS*1/_FAK1*_HH2)
ENDIF
ENDIF
IF ISAXIS(_ABS)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,FDIS*1/_FAK1)
ENDIF
IF ISAXIS(_ORD)==FALSE
IF (SPCO<>0)
_SERR="(SPCO)"
GOTOF _FEHL2
ENDIF
ENDIF
IF ISAXIS(_ABS)==FALSE
IF (SPCA<>0)
_SERR="(SPCA)"
GOTOF _FEHL2
ENDIF
ENDIF
_VARI=TRUNC(__VARI/10)*10
N10 CYCLE801(0,0,0,DBH,0,NUM,1,_VARI,_UMODE,0,0,_HIDE,_NSP,_DMODE)
$P_CYCFRAME=_RE_CYCFR
RET
_FEHL1: STOPRE
N730201 SETAL(61158)
RET
_FEHL2: STOPRE
N730202 SETAL(61019,<<_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_HOLES2_SPF
PROC HOLES2 (REAL CPA,REAL CPO,REAL RAD,REAL STA1,REAL INDA,INT NUM,INT _VARI,INT _UMODE,STRING[200] _HIDE,INT _NSP,INT _DMODE) SAVE SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.002 ;DATE: 2023-03-10
;Cycle support HMIsl
;Positions circle
DEF AXIS _XX,_YY,_AA
DEF INT HZ1,_SPIND,_H8,_II,_DMODE1,_N,_I,_G,_POS,_MAX_POS,_INI,_FIRST,_FOUND,_NUM,S_ACT_POS,S_NUM_POS
DEF INT _ARTIS[16]
DEF INT _VAR5,_VAR6,_VAR7,_TRAC=0,_TRAM=0,_ABRI,_INT,_INT2,_TRAFO_NO,_J,_J2,_GEO1
DEF INT _GEO[3,3]=SET(1,2,0,2,0,1,0,1,2)
DEF INT _TRAMI[99,3]=REP(0)
DEF REAL _MODR,_MODS,_TRAD,_AP
DEF REAL _A1,_FC,_DX,_DY,_FAK1,_RAD1
DEF CHAR _QUOT=34
DEF INT _TEMP,_ABS,_ORD,_APP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_HOLES2_MPF"
DEF STRING[200] _STR
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_HOLES2_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"HOLES2("<<CPA<<","<<CPO<<","<<RAD<<","<<STA1<<","<<INDA<<","<<NUM<<","<<_VARI<<","<<_UMODE<<",'"'"<<_HIDE<<"'"',"<<_NSP<<","<<_DMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
DIAMCYCOF
cycle210(0)
IF(NUM<=0) GOTOF _FEHL1
IF(_NSP<0) GOTOF _FEHL8
IF((_VARI _DEC4)<0)OR((_VARI _DEC4)>2) GOTOF _FEHL5
IF((_VARI _DEC2)<0)OR((_VARI _DEC2)>1) GOTOF _FEHL5
IF($P_SEARCH) OR (($AC_SERUPRO)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100')))
_NSP=0
ELSE
IF (_E_SEARCH[2]>-1)
_NSP=_E_SEARCH[2]+1
ELSE
_NSP=1
ENDIF
_E_SEARCH[2]=-1
ENDIF
_N=NUM
_A1=INDA
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
_ARTISUP=0
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_SPIND=_VARI _DEC3
IF ((_SPIND<>2)AND(_SPIND<>0)) GOTOF _FEHL5
_STCCMA:
_H8=$P_TRAFO
IF ((_SPIND==2) AND (_H8 B_AND 'H1300') ) GOTOF _FEHL5
IF($P_MC==0)
STOPRE
N730303 SETAL(62100)
M0
STOPRE
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL2
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF ISAXIS(_ABS)
_XX=$P_AXN1
ENDIF
IF ISAXIS(_ORD)
_YY=$P_AXN2
ENDIF
_VAR5=_VARI _DEC5
_VAR6=_VARI _DEC6
IF _VAR5<>0
_GEO1=_GEO[$P_GG[6]-1,_VAR6-1]
ENDIF
IF ((_VAR5==0) OR ((_VAR5==1) AND (_GEO1==0)))
IF(RAD<=0) GOTOF _FEHL7
ENDIF
IF($P_TRAFO B_AND 'H200')
_TRAC=1
_TRAD=$P_TRAFO_PAR[0]
_TRAFO_NO=$P_TRAFO_PARSET MOD 1000
IF $P_TRAFO_PARSET>1000
_I=$P_TRAFO_PARSET MOD 1000
_TRAFO_NO=($NT_TRAFO_INDEX[_I] _DEC2)+10*($NT_TRAFO_INDEX[_I] _DEC3)
ENDIF
ENDIF
IF $P_TRAFO B_AND 'H1100'
_TRAM=1
_TRAFO_NO=$P_TRAFO_PARSET MOD 1000
ENDIF
IF (_VAR5==0)
_VAR6=1
ENDIF
IF (_VAR5>1) GOTOF _FEHL5
IF(_VAR5>0)
IF((_VAR6>3) OR (_VAR6==0)) GOTOF _FEHL14
IF(_SC_ROT_AX[0,_VAR6-1]==0) GOTOF _FEHL14
_VAR7=10*(_VARI _DEC8)+_VARI _DEC7
IF(_VAR7>_SC_ROT_AX[0,_VAR6-1]-1)
_VAR7=0
ENDIF
_AA=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_SC_ROT_AX[_VAR7+1,_VAR6-1]-1])
IF($MA_ROT_IS_MODULO[_AA])
_MODR=$MA_MODULO_RANGE[_AA]
_MODS=$MA_MODULO_RANGE_START[_AA]
ENDIF
_ABRI=1
IF(_TRAC)
IF $P_TRAFO_PARSET<1000
_STR="_INT=$MC_TRACYL_ROT_SIGN_IS_PLUS_"<<$P_TRAFO_PARSET
EXECSTRING(_STR)
ELSE
_INT=($NT_CNTRL[$P_TRAFO_PARSET MOD 1000] B_AND 'H800')/2048
ENDIF
IF(_INT==0)
_ABRI=-1
ENDIF
ENDIF
IF(_TRAM)
IF $P_TRAFO_PARSET<1000
_STR="_INT=$MC_TRANSMIT_ROT_SIGN_IS_PLUS_"<<$P_TRAFO_PARSET
EXECSTRING(_STR)
ELSE
_INT=($NT_CNTRL[$P_TRAFO_PARSET MOD 1000] B_AND 'H800')/2048
ENDIF
IF(_INT==1)
_ABRI=-1
ENDIF
ENDIF
ENDIF
IF (_TRAC==1)
IF (NOT((_VAR5==0) AND ($P_TC>0)))
IF ((_SC_TRACYL[_TRAFO_NO-1,2])<>($P_GG[6]-1+17)) GOTOF _FEHL15
ENDIF
IF(_VAR5>0)
IF ((_VAR6)<>(_SC_TRACYL[_TRAFO_NO-1,1])) GOTOF _FEHL15
ENDIF
ENDIF
IF (_TRAM==1)
IF $P_TRAFO_PARSET<1000
_I=0
_TRAMI[0,0]=REP(0)
FOR _J=1 TO 20
_STR="_INT=ISVAR("<<_QUOT<<"$MC_TRAFO_TYPE_"<<_J<<_QUOT<<")"
EXECSTRING(_STR)
IF(_INT)
_STR="_INT=$MC_TRAFO_TYPE_"<<_J
EXECSTRING(_STR)
IF(_INT B_AND 'H1100')AND(_I<2)
_TRAMI[_I,0]=_INT
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[2]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_TRAMI[_I,1]=_J2+1
ENDIF
ENDFOR
_STR="_INT=$MC_TRAFO_AXES_IN_"<<_J<<"[0]"
EXECSTRING(_STR)
FOR _J2=0 TO 2
_STR="_INT2=$MC_TRAFO_GEOAX_ASSIGN_TAB_"<<_J<<"["<<_J2<<"]"
EXECSTRING(_STR)
IF(_INT==_INT2)
_TRAMI[_I,2]=17+_J2
ENDIF
ENDFOR
_I=_I+1
ENDIF
ENDIF
ENDFOR
IF (NOT((_VAR5==0) AND ($P_TC>0)))
IF (((_TRAMI[_TRAFO_NO-1,2])<>($P_GG[6]-1+17)) AND ($P_TRAFO<>4096)) GOTOF _FEHL15
ENDIF
IF(_VAR5>0)
IF ((_VAR6)<>(_TRAMI[_TRAFO_NO-1,1])) GOTOF _FEHL15
ENDIF
ELSE
_TRAMI[0,0]=$P_TRAFO
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TRAFO_NO,1],TRUE)
FOR _J=0 TO 2
IF $NK_OFF_DIR[_I,_J]<>0
_TRAMI[0,1]=_J+1
ENDIF
ENDFOR
_I=NAMETOINT("$NK_NAME",$NT_GEO_AX_NAME[_TRAFO_NO,0],TRUE)
FOR _J=0 TO 2
IF $NK_OFF_DIR[_I,_J]<>0
_TRAMI[0,2]=_J+17
ENDIF
ENDFOR
IF (NOT((_VAR5==0) AND ($P_TC>0)))
IF ((_TRAMI[0,2])<>($P_GG[6]-1+17)) GOTOF _FEHL15
ENDIF
IF(_VAR5>0)
IF ((_VAR6)<>(_TRAMI[0,1])) GOTOF _FEHL15
ENDIF
ENDIF
_I=0 _J=0 _J2=0
ENDIF
_HIDE=","<<_HIDE<<","
_INI=1
_NUM=0
REPEAT
REPEAT _NPOS1 _NPOS2
UNTIL _FOUND==FALSE
S_NUM_POS=S_ACT_POS
_INI=1
_NUM=0
IF(_NSP>=1)
_NUM=_NSP-1
ENDIF
REPEAT _NPOS1 _NPOS2
_NUM=0
IF(_NSP>=1)
S_ACT_POS=S_ACT_POS+_NSP-1
ENDIF
IF(NOT _FOUND)
IF(_NSP==0)
GOTOF _FEHL1
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(_UMODE)
SBLON
ENDIF
IF (_VAR5==0)
IF((_VARI _DEC4)==0)
IF(_A1==0)
_A1=360/_N
ENDIF
ELSE
IF((_VARI _DEC4)==1)
_A1=360/_N
ELSE
IF(_A1==0)
GOTOF _FEHL13
ENDIF
ENDIF
ENDIF
IF((_VARI _DEC2)==0)
_G=0 _SC_PC=0
ELSE
_FC=$SCS_CIRCLE_RAPID_FEED
_SC_PC=1
IF(_A1>0)
_G=3
ELSE
_G=2
ENDIF
ENDIF
_FIRST=1
WHILE(_FOUND)
_SC_WO=STA1+_I*_A1
_DX=COS(_SC_WO)*RAD _DY=SIN(_SC_WO)*RAD
IF(_ARTIS[11]==2)
_ARTIS[9]=_ARTIS[9]+1
IF(_ARTIS[3]<>0)
IF(_ARTIS[9]==_ARTIS[13])
_ARTIS[1]=_ARTIS[13] _ARTIS[2]=_ARTIS[13]
_ARTISUP=1
IF(_ARTIS[13]+_ARTIS[3]<=_SC_TOOL_VALI[2])
_ARTIS[13]=_ARTIS[13]+_ARTIS[3]
ENDIF
ELSE
_ARTISUP=0
ENDIF
ELSE
IF(_ARTIS[9]==_ARTIS[1])
_ARTISUP=1
ENDIF
ENDIF
ENDIF
IF(_ARTIS[11]==3)
_ARTISUP=1
ENDIF
WRTPR("POSITIONS(1,1,"<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
IF ISAXIS(_ORD)==FALSE
IF (_DY==0)
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N20 G0 G90 AX[_XX]=CPA+_DX
SBLOF
ELSE
SBLON
N20 G0 G9 G90 AX[_XX]=CPA+_DX
SBLOF
ENDIF
ELSE
GOTOF _FEHL9
ENDIF
GOTOF _NEXT
ENDIF
IF(_G==0)OR(_FIRST)
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N20 G0 G90 AX[_XX]=CPA+_DX AX[_YY]=CPO+_DY
SBLOF
ELSE
SBLON
N20 G0 G9 G90 AX[_XX]=CPA+_DX AX[_YY]=CPO+_DY
SBLOF
ENDIF
_FIRST=0
ELSE
IF(_G==2)
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N30 BLG94 FB=_FC G2 G90 AX[_XX]=CPA+_DX AX[_YY]=CPO+_DY IP[_XX]=AC(CPA) IP[_YY]=AC(CPO)
SBLOF
ELSE
SBLON
N30 BLG94 FB=_FC G2 G9 G90 AX[_XX]=CPA+_DX AX[_YY]=CPO+_DY IP[_XX]=AC(CPA) IP[_YY]=AC(CPO)
SBLOF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N40 BLG94 FB=_FC G3 G90 AX[_XX]=CPA+_DX AX[_YY]=CPO+_DY IP[_XX]=AC(CPA) IP[_YY]=AC(CPO)
SBLOF
ELSE
SBLON
N40 BLG94 FB=_FC G3 G9 G90 AX[_XX]=CPA+_DX AX[_YY]=CPO+_DY IP[_XX]=AC(CPA) IP[_YY]=AC(CPO)
SBLOF
ENDIF
ENDIF
ENDIF
IF((_G>0)AND((ABS($P_EP[_XX]*_FAK1-(CPA+_DX))>$MC_CIRCLE_ERROR_CONST) OR (ABS($P_EP[_YY]*_FAK1-(CPO+_DY))>$MC_CIRCLE_ERROR_CONST)))
GOTOF _FEHL10
ENDIF
_NEXT:
IF(_ARTIS[3]==0)
IF(_ARTIS[9]==_ARTIS[2])
_ARTISUP=0
ENDIF
ENDIF
REPEAT _NPOS1 _NPOS2
ENDWHILE
_SC_WO=0
ELSE
_SC_WO=0
_RAD1=RAD
IF(_VARI _DEC4)==1
_A1=360/_N
ENDIF
WHILE(_FOUND)
_AP=STA1+_I*_A1
IF ((_TRAC==0) AND (_TRAM==0))
IF ((_GEO1==0) AND ((CPA<>0)OR(CPO<>0)))
;POSITIONIERWINKEL RUNDACHE NEU BERECHEN
_DX=COS(_AP*_ABRI)*RAD _DY=SIN(_AP*_ABRI)*RAD
_DX=_DX+CPA _DY=_DY+CPO
_RAD1=(SQRT(_DX*_DX+_DY*_DY))
_AP=ATAN2(_DY,_DX)
ENDIF
IF($MA_ROT_IS_MODULO[_AA])
_AP=((((_AP-_MODS) MOD _MODR) + _MODR) MOD _MODR) + _MODS
ENDIF
ENDIF
IF(_TRAC==1)
_AP=(_TRAD*$PI*_AP/360)*_ABRI
ENDIF
IF (_TRAM==1)
_DX=COS(_AP*_ABRI)*RAD _DY=SIN(_AP*_ABRI)*RAD
ENDIF
IF(_ARTIS[11]==2)
_ARTIS[9]=_ARTIS[9]+1
IF(_ARTIS[3]<>0)
IF(_ARTIS[9]==_ARTIS[13])
_ARTIS[1]=_ARTIS[13] _ARTIS[2]=_ARTIS[13]
_ARTISUP=1
IF(_ARTIS[13]+_ARTIS[3]<=_SC_TOOL_VALI[2])
_ARTIS[13]=_ARTIS[13]+_ARTIS[3]
ENDIF
ELSE
_ARTISUP=0
ENDIF
ELSE
IF(_ARTIS[9]==_ARTIS[1])
_ARTISUP=1
ENDIF
ENDIF
ENDIF
IF(_ARTIS[11]==3)
_ARTISUP=1
ENDIF
WRTPR("POSITIONS(1,1,"<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
IF (_VAR5==1)
IF ((_GEO1==1) AND (_TRAM==0))
IF (_TRAC==0)
IF (_F_Y_AXIS==1)
IF ($P_GG[7]<>1)
G40
ENDIF
_SC_PC=1
IF ($P_GG[30]==6)
SBLON
N60 G0 G90 AX[_XX]=CPA AX[_AA]=_AP AX[_YY]=$P_EP[_YY]
SBLOF
ELSE
SBLON
N60 G9 G0 G90 AX[_XX]=CPA AX[_AA]=_AP AX[_YY]=$P_EP[_YY]
SBLOF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N65 G0 G90 AX[_XX]=CPA AX[_AA]=_AP
SBLOF
ELSE
SBLON
N65 G9 G0 G90 AX[_XX]=CPA AX[_AA]=_AP
SBLOF
ENDIF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N70 G0 G90 AX[_XX]=CPA AX[_YY]=_AP
SBLOF
ELSE
SBLON
N70 G9 G0 G90 AX[_XX]=CPA AX[_YY]=_AP
SBLOF
ENDIF
ENDIF
GOTOF _NEXT2
ENDIF
IF ((_GEO1==2) AND (_TRAM==0))
IF (_TRAC==0)
IF (_F_Y_AXIS==1)
IF ($P_GG[7]<>1)
G40
ENDIF
_SC_PC=1
IF ($P_GG[30]==6)
SBLON
N80 G0 G90 AX[_AA]=_AP AX[_YY]=CPO AX[_XX]=$P_EP[_XX]
SBLOF
ELSE
SBLON
N80 G9 G0 G90 AX[_AA]=_AP AX[_YY]=CPO AX[_XX]=$P_EP[_XX]
SBLOF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N85 G0 G90 AX[_YY]=CPO AX[_AA]=_AP
SBLOF
ELSE
SBLON
N85 G9 G0 G90 AX[_YY]=CPO AX[_AA]=_AP
SBLOF
ENDIF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N90 G0 G90 AX[_XX]=_AP AX[_YY]=CPO
SBLOF
ELSE
SBLON
N90 G9 G0 G90 AX[_XX]=_AP AX[_YY]=CPO
SBLOF
ENDIF
ENDIF
GOTOF _NEXT2
ENDIF
IF ((_GEO1==0) AND (_TRAC==0))
IF(_TRAM==0)
IF (_F_Y_AXIS==1)
IF ($P_GG[7]<>1)
G40
ENDIF
_SC_PC=1
IF ($P_GG[30]==6)
SBLON
N95 G0 G90 AX[_AA]=_AP AX[_XX]=ABS(_RAD1) AX[_YY]=$P_EP[_YY]
SBLOF
ELSE
SBLON
N95 G9 G0 G90 AX[_AA]=_AP AX[_XX]=ABS(_RAD1) AX[_YY]=$P_EP[_YY]
SBLOF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N100 G0 G90 AX[_XX]=ABS(_RAD1) AX[_AA]=_AP
SBLOF
ELSE
SBLON
N100 G9 G0 G90 AX[_XX]=ABS(_RAD1) AX[_AA]=_AP
SBLOF
ENDIF
ENDIF
ELSE
IF ($P_GG[7]<>1)
G40
ENDIF
IF ($P_GG[30]==6)
SBLON
N105 G0 G90 AX[_XX]=_DX AX[_YY]=_DY
SBLOF
ELSE
SBLON
N105 G0 G9 G90 AX[_XX]=_DX AX[_YY]=_DY
SBLOF
ENDIF
ENDIF
ENDIF
ENDIF
_NEXT2:
IF(_ARTIS[3]==0)
IF(_ARTIS[9]==_ARTIS[2])
_ARTISUP=0
ENDIF
ENDIF
REPEAT _NPOS1 _NPOS2
ENDWHILE
ENDIF
WRTPR("POSITIONS(0)")
RET
_NPOS1:
IF(_INI)
_INI=0
_POS=0
S_ACT_POS=0
_MAX_POS=_N
ENDIF
_FOUND=0
WHILE(_FOUND<=_NUM)AND(_POS<_MAX_POS)
_POS=_POS+1
_I=(_POS-1)
IF(MATCH(_HIDE,","<<_POS<<",")<0)AND(_POS<=_MAX_POS)
_FOUND=_FOUND+1
ENDIF
ENDWHILE
IF(_FOUND<=_NUM)
_FOUND=0
ELSE
S_ACT_POS=S_ACT_POS+1
ENDIF
_NPOS2:
_SC_PC=0
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(_UMODE+1)
SBLON
ENDIF
RET
_FEHL1:STOPRE
N730301 SETAL(61103)
RET
_FEHL2: STOPRE
N730302 SETAL(61158)
RET
_FEHL4: STOPRE
N730304 SETAL(61210)
RET
_FEHL5:STOPRE
N730305 SETAL(61002)
RET
_FEHL7: STOPRE
N730307 SETAL(61213)
RET
_FEHL8: STOPRE
N730308 SETAL(61019,"(_NSP)")
RET
_FEHL9: STOPRE
N730309 SETAL(61803)
RET
_FEHL10: STOPRE
N730310 SETAL(61019,"")
RET
_FEHL11: STOPRE
N730311 SETAL(62106)
RET
_FEHL12:STOPRE
N730312 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL13:STOPRE
N730313 SETAL(61019,"(alpha1)")
RET
_FEHL14: STOPRE
N730314 SETAL(61329)
RET
_FEHL15: STOPRE
N730315 SETAL(61020)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_LONGHOLE_SPF
PROC LONGHOLE (REAL RTP,REAL RFP,REAL _SDIS,REAL __DP,REAL __DPR,INT NUM,REAL LENG,REAL __CPA,REAL __CPO,REAL RAD,REAL STA1,REAL INDA,REAL FFD,REAL FFP1,REAL _MID,INT _VARI,INT _UMODE,INT _GMODE,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Longhole
DEF AXIS _X,_Y,_Z
DEF REAL HH1,HH2,HH3,HH4,HH5,HH6,HH7,_FAK1,_SDZI,_ZUZ,_RE_ROT,_TX,WID
DEF INT HZ1,HZ2,HZ3,_SPIND,_ERR,_II,_FFD_TYPE,_WTYP,_GG10,_H8
DEF BOOL _ZB[13],_H9, _MDG
DEF FRAME _RE_CYCFR
DEF INT _ARTIS[16],_TEMP,_GMODE4,_DMODE1,_DMODE4,_AMODE1,_AMODE3,_ZZSD[15]
DEF REAL DP,DPR,CPA,CPO,_H7
DEF REAL SDIS,MID,_SKF,_SKF1,_SKF2,_SKF3
DEF STRING[30] _S_FFP1,_S_FFD
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_LONGHOLE_MPF",_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_LONGHOLE_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";Scaling factors: $P_ACTFRAME=CSCALE("<<AXSTRING($P_AXN1)<<","<<$P_ACTFRAME[$P_AXN1,SC]<<","<<AXSTRING($P_AXN2)<<","<<$P_ACTFRAME[$P_AXN2,SC]<<","<<AXSTRING($P_AXN3)<<","<<$P_ACTFRAME[$P_AXN3,SC]<<")")
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1]<<"  _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"LONGHOLE("<<RTP<<","<<RFP<<","<<_SDIS<<","<<__DP<<","<<__DPR<<","<<NUM<<","<<LENG<<","<<__CPA<<","<<__CPO<<","<<RAD<<","<<STA1<<","<<INDA<<","<<FFD<<","<<FFP1<<","<<_MID<<","<<_VARI<<","<<_UMODE<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (__DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
DIAMCYCOF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
DP=__DP DPR=__DPR CPA=__CPA CPO=__CPO
SDIS=_SDIS MID=_MID
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_DMODE4=_DMODE _DEC4
IF (_DMODE4<0)OR(_DMODE4>2) GOTOF _FEHL31
IF _DMODE4
IF (NUM<>1)
GOTOF _FEHL32
ELSE
RAD=0
ENDIF
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL25
_GMODE4 = _GMODE _DEC4
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_X=$P_AXN1 _Y=$P_AXN2
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)<>"POCKET3")
CPA=$P_EP[_X]*_FAK1 CPO=$P_EP[_Y]*_FAK1
ENDIF
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
SDIS=ABS(SDIS) DPR=ABS(DPR) LENG=ABS(LENG) _RE_ROT=0
RAD=ABS(RAD) NUM=ABS(NUM) MID=ABS(MID) HH6=STA1
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_RE_CYCFR=$P_CYCFRAME
ELSE
GOTOF _FEHL21
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL7
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL7
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL7
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
_SPIND=ABS(_VARI) DIV 100 _VARI=_VARI MOD 100
IF(_SPIND>4) GOTOF _FEHL5
_STCCMA:
IF($P_SUBPAR[16])
IF NOT((_VARI==1)OR(_VARI==3)) GOTOF _FEHL5
ENDIF
IF NOT ($SCS_FUNCTION_MASK_MILL_SET B_AND 'H8')
IF ($P_ACTFRAME[_X,SC]<>$P_ACTFRAME[_Y,SC]) GOTOF _FEHL35
ENDIF
_SKF1=$P_ACTFRAME[_X,SC]
_SKF2=$P_ACTFRAME[_Y,SC]
_SKF3=$P_ACTFRAME[_Z,SC]
_SKF=MINVAL(_SKF1,_SKF2)
MID=MID*1/_SKF3
SDIS=SDIS*1/_SKF3
_H8=$P_TRAFO
_H7=$P_CYCFRAME[_Z,RT]
IF ((_SPIND==2) AND (_H8 B_AND 'H1300') ) GOTOF _FEHL5
IF((_SPIND==1)AND(_VARI==3)) GOTOF _FEHL5
IF(_ZSD[1]==-1)
IF ($SCS_FUNCTION_MASK_MILL_SET B_AND 'B0100')
_ZZSD[1]=1
ELSE
_ZZSD[1]=0
ENDIF
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF(_ZZSD[1]==0)
_SDZI=SDIS
ENDIF
IF(_VARI==3)
_SDZI=SDIS
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL33
ENDIF
_S_FFP1="G95 FZ="<<FFP1
ELSE
_S_FFP1="G94 F"<<FFP1
ENDIF
ENDIF
IF(_VARI _DEC1 == 4)OR(_VARI _DEC1 == 5)
_S_FFD=_S_FFP1
ELSE
IF(_DMODE _DEC2 == 0)
IF(_ZSD[3]==-1)OR(_ZSD[3]==0)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=1
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ELSE
IF(_DMODE _DEC2 == 1)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=11
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ENDIF
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_S_FFD="G95 F"<<FFD
ELSE
IF(_FFD_TYPE==11)OR(_FFD_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL33
ENDIF
_S_FFD="G95 FZ="<<FFD
ELSE
_S_FFD="G94 F"<<FFD
ENDIF
ENDIF
ENDIF
IF $P_TOOL==0
GOTOF _FEHL6
ELSE
HH3=$P_TOOLR*_FAK1
ENDIF
IF NUM==0 GOTOF _FEHL2
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(((DPR==0) AND (_AMODE1==0)) OR (_AMODE1==2))
DPR=ABS(RFP-DP)
IF RFP==DP GOTOF _MM8
ELSE
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF(((DPR>0) AND (_AMODE1==0)) OR (_AMODE1==1))
DP=HH2
ELSE
IF DP==HH2
DPR=ABS(RFP-DP)
ENDIF
ENDIF
IF RFP==DP GOTOF _MM8
ENDIF
IF RTP<>RFP
IF ((RTP-RFP)/ABS(RTP-RFP)<>(RFP-DP)/DPR) GOTOF _FEHL1
ENDIF
HH2=(RFP-DP)/DPR
HH3=HH3/$P_ACTFRAME[_X,SC]
IF NUM==1 GOTOF _MM14 IF INDA<>0 GOTOF _MM3
INDA=360/NUM
GOTOF _MM4
_MM3:IF ABS(INDA*(NUM-1))>=360 GOTOF _FEHL2
IF (INDA*(NUM-1)<=180) GOTOF _MM4 IF ABS((RAD+HH3)*SIN((INDA*(NUM-1))/2))<=HH3 GOTOF _FEHL3
_MM4:IF (INDA>180) GOTOF _MM14 IF ABS((RAD+HH3)*SIN(INDA/2))<=HH3 GOTOF _FEHL3
_MM14:IF MID GOTOF _MM4A
MID=_SDZI+DPR
_MM4A:
IF MID>=DPR
MID=_SDZI+DPR
ENDIF
HZ1=(_SDZI+DPR)/MID+0.4999
IF HZ1==0
HZ1=1
ENDIF
IF(_VARI==3)
IF HZ1>1
HZ1=(_SDZI+DPR)*2/MID+0.4999
ENDIF
ENDIF
HH1=(_SDZI+DPR)/HZ1
HH4=RAD+HH3 HH5=RAD+LENG-HH3 HH3=HH4 HH7=1 HZ2=1
IF HH5<=HH4
IF $P_SEARCH GOTOF _RET
GOTOF _FEHL4
ENDIF
IF SQRT(POT(CPA+HH4*COS(STA1)-$P_EP[_X]*_FAK1)+POT(CPO+HH4*SIN(STA1)-$P_EP[_Y]*_FAK1)) <= SQRT(POT(CPA+HH5*COS(STA1)-$P_EP[_X]*_FAK1)+POT(CPO+HH5*SIN(STA1)-$P_EP[_Y]*_FAK1)) GOTOF _MM5
HH3=HH5 HH7=-1
_MM5:
IF _SPIND==2
CUST_TECHCYC(3+_UMODE)
ENDIF
IF(_SPIND==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
N10 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,CPA*1/_FAK1,_Y,CPO*1/_FAK1)
WID=2*$P_TOOLR*_FAK1
IF _DMODE4
IF (NUM>1) GOTOF _FEHL27
CASE _GMODE4 OF 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 DEFAULT GOTOF _M0
_M0: _TX=-LENG/2
GOTOF _MREF
_M1: _TX=-WID/2
GOTOF _MREF
_M2: _TX=-LENG+WID/2
GOTOF _MREF
_M3: _TX=0
GOTOF _MREF
_M4: _TX=-LENG
_MREF:
ENDIF
_MM6:
IF _DMODE4
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)<>"POCKET3")
HH6=HH6+_SC_WO
ENDIF
ENDIF
N10 $P_CYCFRAME=$P_CYCFRAME:CROT(_Z,HH6)
_RE_ROT=_RE_ROT+HH6
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_TX*1/_FAK1)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
SBLON
N20 G0 G90 G40 G60 G601 AX[_X]=HH3 AX[_Y]=0
IF (((_SPIND==1)OR(_SPIND==3))AND(_VARI<2))
SBLOF
CUST_TECHCYC(3+_UMODE)
SBLON
_H9=1
ENDIF
N21 G[10]=_GG10 AX[_Z]=RFP+SDIS*HH2
SBLOF
_ZUZ=(RFP+SDIS*HH2)-(DP+(HZ1-HZ2)*HH1*HH2)
N22 _MM7:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF HZ1>1
IF(HZ2==1)
ENDIF
IF(HZ2==HZ1)
ENDIF
ENDIF
IF (((_SPIND==1)OR(_SPIND==3))AND(_VARI<2)AND(_H9==0))
CUST_TECHCYC(3+_UMODE)
ENDIF
_H9=0
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF(_VARI==3)
IF ((_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
N23 G1 G91 AX[_X]=(HH5-HH4)*HH7 AX[_Y]=0 AX[_Z]=-_ZUZ
ELSE
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFD)
G1 G90 G60 AX[_Z]=DP+(HZ1-HZ2)*HH1*HH2
IF (((_SPIND==1)OR(_SPIND==3))AND(_VARI<2))
IF ((_H8 B_AND 'H200') AND (ABS(_H7)==90) AND ($P_GG[6]==3))
_H9=1
ELSE
IF (_SPIND==1)
CUST_TECHCYC(4+_UMODE)
ELSE
CUST_TECHCYC(403+_UMODE)
ENDIF
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
N230 G91 AX[_X]=(HH5-HH4)*HH7 AX[_Y]=0
ENDIF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
HH7=-HH7 HZ2=HZ2+1
IF HZ2 <= HZ1 GOTOB _MM7
IF(_VARI==3)
EXECSTRING(_S_FFP1)
N231 G1 G91 AX[_X]=(HH5-HH4)*HH7 AX[_Y]=0
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[8])
ENDIF
SBLON
N24 G0 G90 G60 AX[_Z]=RTP
SBLOF
IF ((_SPIND==1)AND(_VARI<2))
IF ((_H8 B_AND 'H200') AND (ABS(_H7)==90) AND ($P_GG[6]==3) AND (_H9==1))
ENDIF
_H9=0
ENDIF
HZ2=1 HH6=INDA HZ3=HZ3+1
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
IF HZ3>=NUM GOTOF _MM8
IF ($P_EP[_X]*_FAK1>=HH4*0.999)AND($P_EP[_X]*_FAK1<=HH4*1.001) GOTOF _MM7B
IF SQRT(POT(HH4*COS(INDA)-HH5)+POT(HH4*SIN(INDA)))<=SQRT(POT(HH5*COS(INDA)-HH5)+POT(HH5*SIN(INDA))) GOTOF _MM7B
HH3=HH5 HH7=-1
GOTOB _MM6
_MM7B:HH3=HH4 HH7=1
GOTOB _MM6
_MM8:
IF _SPIND==2
CUST_TECHCYC(4+_UMODE)
ENDIF
SBLON
$P_CYCFRAME=_RE_CYCFR
IF(($P_MC)AND(_SC_PC==1))
N920 G40 G90 AX[_X]=CPA AX[_Y]=CPO
ENDIF
_RET: RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_X]=HH3
$AA_MEAS_POINT1[_Y]=0
$AA_MEAS_POINT1[_Z]=RFP+SDIS*HH2
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_X])+POT($AA_MEAS_POINT2[_Y])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_X,HH3,_Z,RFP+SDIS*HH2)
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_FEHL1:STOPRE
N730401 SETAL(61101)
RET
_FEHL2:STOPRE
N730402 SETAL(61106)
RET
_FEHL3:STOPRE
N730403 SETAL(61104)
RET
_FEHL4:STOPRE
N730404 SETAL(61609)
RET
_FEHL5:STOPRE
N730405 SETAL(61002)
RET
_FEHL6:STOPRE
N730406 SETAL(61000)
RET
_FEHL7:
N730407 SETAL(62106)
RET
_FEHL12:STOPRE
N730408 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL18: STOPRE
N730418 SETAL(61019,_SERR)
RET
_FEHL20: STOPRE
N730420 SETAL(61156)
RET
_FEHL21: STOPRE
N730421 SETAL(61016)
RET
_FEHL22: STOPRE
N730422 SETAL(61158)
RET
_FEHL23: STOPRE
N730423 SETAL(61159)
RET
_FEHL24: STOPRE
N730424 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N730425 SETAL(61019,"(_GMODE: dec3)")
RET
_FEHL27: STOPRE
N730427 SETAL(61019,"(_GMODE: dec4)")
RET
_FEHL29: STOPRE
N730429 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N730430 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N730431 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL32: STOPRE
N730432 SETAL(61019,"(_DMODE: dec4/NUM)")
RET
_FEHL33: STOPRE
N730433 SETAL(61216)
RET
_FEHL35: STOPRE
N730435 SETAL(61012)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_SLOT1_SPF
PROC SLOT1 (REAL RTP,REAL RFP,REAL _SDIS,REAL _DP,REAL _DPR,INT NUM,REAL LENG,REAL WID,REAL __CPA,REAL __CPO,REAL RAD,REAL STA1,REAL INDA,REAL FFD,REAL FFP1,REAL _MID,INT _CDIR,REAL _FAL,INT _VARI,REAL _MIDF,REAL FFP2,REAL SSF,REAL FALD,REAL __STA2,REAL __DP1,INT _UMODE,REAL __FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.011 ;DATE: 2024-05-31
;Cycle support HMIsl
;Slot
DEF AXIS _X,_Y,_Z
DEF REAL HH1,HH2,HH3,HH4,HH5,HH6,HH7,HH8,HH9,WZR,HHS,_SDZI,_DPT,_FFP2,_FFP1_SAVE,DP_SAVE
DEF INT HZ1,HZ2,HZ3,HZ4,VARI,_VARI1,_VARI2,_SPIND,_I3,_I4,_I4MERK,_I14,CDIR,_FFD_TYPE,_WTYP,_GG10,_GG49
DEF REAL _H1,_H4,_H5,_LINT,_WINT,_ZT,_GT,_AZ,_HH3,_ZTSDIS,_THE,_H15,_ZTP,_M_HH4,_M_HH5
DEF REAL _H6,_H7,_OFFN,_OFFN1,_FAK1,_FAK2,_TX,DP,DPR,CPA,CPO,MID,MIDF,FAL,_FALD,_ZFS
DEF REAL SDIS,_STA2,_DP1,_FS,_SKF,_SKF1,_SKF2,_SKF3,_KTS[60,6]
DEF BOOL SOWZ,_H9,_H10,_H11,_SET_DP_NEU=0
DEF INT _MIRR,_SLGR,_ERR,_II,_ZB[10],_DIR,_DIRH,_HELIKAL,_FRK,_VARI72,_I,_ERROR
DEF INT _ARTIS[16],_TEMP,_GMODE4,_DMODE1,_DMODE4,_DMODE5,_AMODE1,_AMODE2,_AMODE3,_ZZSD[15]
DEF STRING[30] _S_FFP1,_S_FFD,_S_FFP2,_SRE_FFP1
DEF FRAME _RE_CYCFR
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_SLOT1_MPF",_PROG,_SERR
DEF STRING[141] _KNAME
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_SLOT1_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";Scaling factors: $P_ACTFRAME=CSCALE("<<AXSTRING($P_AXN1)<<","<<$P_ACTFRAME[$P_AXN1,SC]<<","<<AXSTRING($P_AXN2)<<","<<$P_ACTFRAME[$P_AXN2,SC]<<","<<AXSTRING($P_AXN3)<<","<<$P_ACTFRAME[$P_AXN3,SC]<<")")
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<< _ZSD[1]<<" _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"SLOT1("<<RTP<<","<<RFP<<","<<_SDIS<<","<<_DP<<","<<_DPR<<","<<NUM<<","<<LENG<<","<<WID<<","<<__CPA<<","<<__CPO<<","<<RAD<<","<<STA1<<","<<INDA<<","<<FFD<<","<<FFP1<<","<<_MID<<","<<_CDIR<<","<<_FAL<<","<<_VARI<<","<<_MIDF<<","<<FFP2<<","<<SSF<<","<<FALD<<","<<__STA2<<","<<__DP1<<","<<_UMODE<<","<<__FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF ((_DPR==0)AND(_VARI _DEC1<>5))
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF ($P_GG[30]>1)
COMPOF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
DIAMCYCOF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_GG49=$P_GG[49]
DP=_DP DPR=ABS(_DPR) CPA=__CPA CPO=__CPO MID=ABS(_MID) MIDF=ABS(_MIDF) CDIR=_CDIR FAL=ABS(_FAL) _FALD=ABS(FALD) VARI=ABS(_VARI) _ZFS=__ZFS
_FFP2=FFP2
_FFP1_SAVE=FFP1
SDIS=_SDIS _STA2=__STA2 _DP1=__DP1 _FS=__FS
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
_GMODE4=_GMODE _DEC4
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL38
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
GOTOF _FEHL38
ENDIF
IF ($P_STACK<2)
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
ELSE
_PROG=SUBSTR($P_PROG[$P_STACK-2],3,STRLEN($P_PROG[$P_STACK-2])-7)
ENDIF
IF ((_PROG <> "F_SL_LON")AND(_PROG <> "E_SL_LON")AND(_PROG <> "E_PO_REC")AND(_PROG <> "F_PO_REC"))
SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_GMODE4=0
STA1=0
ENDIF
_DMODE4=_DMODE _DEC4
IF (_DMODE4<0) OR (_DMODE4>1) GOTOF _FEHL31
IF _DMODE4
NUM=1 RAD=0 MIDF=MID SSF=0
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL25
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF ((_DMODE4==0) AND ((_VARI _DEC1 ==0) OR (_VARI _DEC1 ==2)))
IF (_FFP2==0)
_FFP2=FFP1
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP2="G95 F"<<_FFP2
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL35
ENDIF
_S_FFP2="G95 FZ="<<_FFP2
ELSE
_S_FFP2="G94 F"<<_FFP2
ENDIF
ENDIF
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL35
ENDIF
_S_FFP1="G95 FZ="<<FFP1
ELSE
_S_FFP1="G94 F"<<FFP1
ENDIF
ENDIF
IF(_VARI _DEC1 == 4)OR(_VARI _DEC1 == 5)
_S_FFD=_S_FFP1
ELSE
IF(_DMODE _DEC2 == 0)
IF(_ZSD[3]==-1)OR(_ZSD[3]==0)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=1
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ELSE
IF(_DMODE _DEC2 == 1)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=11
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ENDIF
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_S_FFD="G95 F"<<FFD
ELSE
IF(_FFD_TYPE==11)OR(_FFD_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL35
ENDIF
_S_FFD="G95 FZ="<<FFD
ELSE
_S_FFD="G94 F"<<FFD
ENDIF
ENDIF
ENDIF
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)<>"POCKET3")
CPA=$P_EP[_X]*_FAK1 CPO=$P_EP[_Y]*_FAK1
ENDIF
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
SDIS=ABS(SDIS) RAD=ABS(RAD) NUM=ABS(NUM) LENG=ABS(LENG) WID=ABS(WID) _ZB[9]=VARI HH6=STA1
IF(LENG==WID) GOTOF _FEHL9
WZR=$P_TOOLR*_FAK1
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF NOT ($SCS_FUNCTION_MASK_MILL_SET B_AND 'H8')
IF ($P_ACTFRAME[_X,SC]<>$P_ACTFRAME[_Y,SC]) GOTOF _FEHL36
ENDIF
_SKF1=$P_ACTFRAME[_X,SC]
_SKF2=$P_ACTFRAME[_Y,SC]
_SKF3=$P_ACTFRAME[_Z,SC]
_SKF=MINVAL(_SKF1,_SKF2)
IF (_VARI _DEC1<>5)
WZR=WZR*1/_SKF
ELSE
IF (_SKF<>_SKF3) GOTOF _FEHL37
_FS=_FS*_SKF
ENDIF
FAL=FAL*1/_SKF
_FALD=_FALD*1/_SKF3
MID=MID*1/_SKF3
_STA2=_STA2*1/_SKF
SDIS=SDIS*1/_SKF3
_DP1=_DP1*1/_SKF3
_VARI1=VARI _DEC1
IF (_VARI1>5) GOTOF _FEHL5
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL13
IF(_HELIKAL==1)AND(_VARI1==5) GOTOF _FEHL5
_VARI2=(_VARI _DEC2)
IF ( (_HELIKAL)AND((_VARI1==0)OR(_VARI1==1))AND(_VARI2<>3) )
GOTOF _FEHL14
ENDIF
IF(_VARI1==5)
_OFFN1=$P_OFFN*_FAK2
_AMODE3=_AMODE _DEC3
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(RTP==RFP) GOTOF _FEHL1
HH2=(RTP-RFP)/ABS(RTP-RFP)
DP=RFP-ABS(_ZFS)*HH2
_ZFS=ABS(_ZFS)
ELSE
DP=_ZFS
_ZFS=ABS(RFP-_ZFS) _AMODE3=1
ENDIF
_AMODE1=2 DPR=0 _ZB[5]=1
DP=DP*1/_SKF3
IF(_ZZSD[1]==0)
MID=_ZFS+SDIS
ELSE
MID=_ZFS
ENDIF
MIDF=MID FALD=0 FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_OFFN=$P_OFFN*_FAK2 VARI=12
ENDIF
WZR=WZR+_OFFN
IF SUBSTR($P_PROG[$P_STACK-1],3,7)=="POCKET3"
IF ((MIDF==0) AND ((_VARI1==2) OR (_VARI1==4)))
MIDF=MID
ENDIF
ENDIF
IF((VARI==0)OR(VARI==1)OR(VARI==2)AND(_DMODE4==0))
IF (($P_SUBPAR[23]==FALSE) AND ($P_SUBPAR[24]==FALSE))
VARI=VARI + 10
ENDIF
ENDIF
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_RE_CYCFR=$P_CYCFRAME
ELSE
GOTOF _FEHL21
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_SPIND=ABS(_VARI) _DEC3
IF(_SPIND>4) GOTOF _FEHL5
_STCCMA:
_VARI1=VARI _DEC1 _VARI2=VARI _DEC2
IF (_VARI2<0) OR (_VARI2>3) GOTOF _FEHL5
IF (_VARI1<0) OR (_VARI1>5) OR (_VARI1==3) GOTOF _FEHL5
IF ((_SPIND==2) AND ($P_TRAFO B_AND 'H1300') ) GOTOF _FEHL5
IF((_SPIND==1)AND(_VARI2>1)AND(_VARI1<2)) GOTOF _FEHL5
IF (_VARI1==4)
IF (FAL<=0) GOTOF _FEHL33
_VARI1=2 _VARI2=1
_ZB[7]=1
ENDIF
IF (_VARI1==2)
FALD=0
ELSE
IF FALD>0
IF DPR>0
DPR=DPR-FALD
ELSE
DP=DP+FALD
ENDIF
ENDIF
IF (_VARI2==2)
MIDF=0
ENDIF
ENDIF
;--------------------------------------------
IF(_ZZSD[1]==0)
_SDZI=SDIS
ENDIF
SOWZ=0
IF ($P_TOOL==0) GOTOF _FEHL6
IF NUM==0 GOTOF _FEHL2
HHS=$P_S[0]
IF SSF<=0
SSF=HHS
ENDIF
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0) AND (_ZB[5]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(((DPR==0) AND (_AMODE1==0)) OR (_AMODE1==2))
DPR=ABS(RFP-DP)
IF RFP==DP GOTOF _MM8
ELSE
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
_DP=HH2-((RTP-RFP)/ABS(RTP-RFP)*_FALD)
IF(((DPR>0) AND (_AMODE1==0)) OR (_AMODE1==1))
DP=HH2
ELSE
IF DP==HH2
DPR=ABS(RFP-DP)
ENDIF
ENDIF
IF RFP==DP GOTOF _MM8
ENDIF
DP_SAVE=DP
IF RTP<>RFP
IF ((RTP-RFP)/ABS(RTP-RFP)<>(RFP-DP)/DPR) GOTOF _FEHL1
ENDIF
HH1=INDA*(NUM-1)
IF (RFP-DP)<>0
HH2=(RFP-DP)/ABS(RFP-DP)
ELSE
GOTOF _FEHL29
ENDIF
IF (CDIR<0)OR(CDIR>3) GOTOF _FEHL16
_MIRR=$P_ACTFRAME[_X,MI]+$P_ACTFRAME[_Y,MI]
IF(_MIRR==1)
IF(CDIR==0)OR(CDIR==2)
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
IF HH2<0
IF(CDIR==0)OR(CDIR==2)
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_Z,MI])
IF(CDIR==0)OR(CDIR==2)
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
_DIR=2
IF CDIR==2 GOTOF _MY3 IF CDIR<>3 GOTOF _MY2
_DIR=3
GOTOF _MY3
_MY2:
IF($P_SMODE[0]==1) OR ($P_SMODE[0]==3)
_H1=$P_SDIR[$P_MSNUM]
IF(_H1<3)OR(_H1>4)
GOTOF _FEHL10
ENDIF
ELSE
GOTOF _FEHL10
ENDIF
IF(_H1<3)OR(_H1>4)
_DIR=3
SETAL(62101)
GOTOF _MY3
ENDIF
IF (((CDIR==0)AND(_H1==4))OR((CDIR==1)AND(_H1==3)))
_DIR=2
ELSE
_DIR=3
ENDIF
_MY3:
_DIRH=_DIR+1
IF NOT MIDF
MIDF=_SDZI+DPR
ENDIF
IF NOT MID
MID=_SDZI+DPR
ENDIF
IF MIDF>=DPR
IF NOT _ZZSD[1]
MIDF=SDIS+DPR
ENDIF
ENDIF
IF MID>=DPR
IF NOT _ZZSD[1]
MID=SDIS+DPR
ENDIF
ENDIF
IF NOT((_VARI1==5) AND (_ZZSD[8]<>0))
IF ((_VARI1<2)AND(WZR>(WID-FAL)/2))OR((_VARI1>=2)AND(WZR>WID/2)) GOTOF _FEHL4
ENDIF
IF ((_VARI1<2)AND((4*WZR)<(WID-2*FAL))) GOTOF _FEHL34
IF ((_VARI1==2)AND(NOT _ZB[7])AND(NOT _OFFN)AND((4*WZR)<WID)) GOTOF _FEHL34
IF NUM==1 GOTOF _MM14 IF INDA GOTOF _MM3
INDA=360/NUM
GOTOF _MM4
_MM3: IF ABS(HH1) >= 360 GOTOF _FEHL2 IF (HH1<=180) GOTOF _MM4
IF ABS((RAD+WID/2)*SIN(HH1/2)) <=WID/2 GOTOF _FEHL3
_MM4:IF (HH1>180) GOTOF _MM14 IF ABS((RAD+WID/2)*SIN(INDA/2)) <=WID/2 GOTOF _FEHL3
_MM14:
IF(_SPIND==2)
CUST_TECHCYC(3+_UMODE)
ENDIF
IF(_SPIND==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,CPA*1/_FAK1,_Y,CPO*1/_FAK1)
IF _DMODE4
IF (NUM>1) GOTOF _FEHL27
CASE _GMODE4 OF 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 DEFAULT GOTOF _M0
_M0: _TX=-LENG/2
GOTOF _MREF
_M1: _TX=-WID/2
GOTOF _MREF
_M2: _TX=-LENG+WID/2
GOTOF _MREF
_M3: _TX=0
GOTOF _MREF
_M4: _TX=-LENG
_MREF:
ENDIF
HH4=RAD+WID/2 HH5=RAD+LENG-WID/2
_M_HH4=HH4 _M_HH5=HH5
IF HH5<HH4 GOTOF _FEHL3
_MM4A:
IF _ZZSD[1]==0
HZ1=(SDIS+DPR)/MID+0.4999
IF HZ1==0
HZ1=1
ENDIF
HH1=(SDIS+DPR)/HZ1 HH7=1 HZ2=1 HH3=WID/2-FAL
ELSE
HZ1=DPR/MID+0.4999
IF HZ1==0
HZ1=1
ENDIF
HH1=DPR/HZ1 HH7=1 HZ2=1 HH3=WID/2-FAL
ENDIF
IF HH3>WZR GOTOF _MM5
FAL=WID/2-WZR HH3=WZR
_MM5:HH8=HH3 HH9=0
_MM6:
IF _DMODE4
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)<>"POCKET3")
HH6=HH6+_SC_WO
ENDIF
ENDIF
N12 $P_CYCFRAME=$P_CYCFRAME:CROT(_Z,HH6)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_TX*1/_FAK1)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
SBLON
IF ((_HELIKAL==0)OR((_HELIKAL==1)AND(_VARI1<>1)))
N14 G0 G40 G60 G90 CFTCP AX[_X]=HH4 AX[_Y]=0
IF (((_SPIND==1)OR(_SPIND==3))AND(_VARI1<2))
SBLOF
CUST_TECHCYC(3+_UMODE)
SBLON
_H9=1
ENDIF
_HH3=RFP+SDIS*HH2
N50 G[10]=_GG10 AX[_Z]=_HH3
SBLOF
ENDIF
IF _VARI1==2 GOTOF _MS1
_MM7:
IF HZ1>1
IF(HZ2==1)
ENDIF
IF(HZ2==HZ1)
ENDIF
ENDIF
IF SOWZ
HZ2=HZ1
ENDIF
_SLGR=0
IF(_HELIKAL)
HZ1=1
IF (_VARI1>1) GOTOF _TG4
ENDIF
CASE _VARI2 OF 0 GOTOF _TG0 1 GOTOF _TG1 2 GOTOF _TG2 3 GOTOF _TG3
_TG3:
_GT=ABS(DPR)
IF _ZZSD[1]==0
_GT=_GT+ABS(SDIS)
ENDIF
IF ((_VARI1==2) AND (MIDF>0))
_AZ=TRUNC(_GT/MIDF)
IF NOT(MIDF*_AZ==_GT)
_AZ=_AZ+1
ENDIF
ELSE
_AZ=TRUNC(_GT/MID)
IF NOT(MID*_AZ==_GT)
_AZ=_AZ+1
ENDIF
ENDIF
HZ1=_AZ
IF (_HELIKAL)
_AZ=1
_ZT=_GT
ELSE
_ZT=_GT/_AZ
ENDIF
IF HZ2==1
_I3=1 _M_HH4=HH4 _M_HH5=HH5
ENDIF
_LINT=ABS(LENG)/2 _WINT=ABS(WID)/2
_LINT=_LINT-FAL _WINT=_WINT-FAL
_H4=_LINT-_WINT
IF NOT(_STA2==0)
_H5=ABS(TAN(_STA2))*2*_H4
ELSE
GOTOF _FEHL7
ENDIF
IF ABS(_ZT)>ABS(_H5) GOTOF _ZP05
_I4=1
GOTOF _ZP10
_ZP05:_I4=TRUNC(ABS(_ZT)/_H5)
IF _H5*_I4==ABS(_ZT) GOTOF _ZP10
_I4=_I4+1
_ZP10:_H5=(_ZT/_I4) _I4MERK=_I4
IF (_HELIKAL)
SBLON
IF ( ((_I4+1) MOD 2)==1)
N150 G0 G40 G60 G90 CFTCP AX[_X]=HH5 AX[_Y]=0
_I3=-_I3
ELSE
N150 G0 G40 G60 G90 CFTCP AX[_X]=HH4 AX[_Y]=0
ENDIF
IF (((_SPIND==1)OR(_SPIND==3))AND(_VARI1<2))
SBLOF
CUST_TECHCYC(3+_UMODE)
SBLON
_H9=1
ENDIF
_HH3=RFP+SDIS*HH2
N50 G[10]=_GG10 AX[_Z]=_HH3
SBLOF
ENDIF
;
EXECSTRING(_S_FFP1)
_MARK1:
IF((_ZZSD[1]==1) AND (HZ2==1))
_H15=ABS(TAN(_STA2))*2*_H4
_ZTP=_ZT+SDIS
IF ABS(_ZTP)>ABS(_H15) GOTOF _ZPP05
_I14=1
GOTOF _ZPP10
_ZPP05:_I14=TRUNC(ABS(_ZTP)/_H15)
IF _H15*_I14==ABS(_ZT) GOTOF _ZPP10
_I14=_I14+1
_ZPP10:_H15=_ZTP/_I14
_ZPPNEXT:
N1161 G1 G91 AX[_X]=_I3*_H4*2 AX[_Z]=-_H15*HH2
_I3=-_I3 _I14=_I14-1
IF _I14>0 GOTOB _ZPPNEXT
ENDIF
IF((_ZZSD[1]==1) AND (HZ2==1)) GOTOF _M6201
_ZPNEXT:
IF (_HELIKAL)
_H6=DP+_H5*(_I4-1)
ELSE
_H6=DP+(HZ1-HZ2)*_ZT*HH2+_H5*(_I4-1)
ENDIF
_H7=$P_EP[_X]+_I3*_H4*2
IF((HZ2==HZ1) AND (_I4==1) AND (_VARI1==1))
N161 G1 G90 AX[_X]=_H7 AX[_Z]=_H6
ELSE
N161 G1 G90 AX[_X]=_H7 AX[_Z]=_H6
ENDIF
_I3=-_I3 _I4=_I4-1
IF (_I4>0) GOTOB _ZPNEXT
_M6201:
IF (_HELIKAL)
G1 G90 AX[_X]=$P_EP[_X]+_I3*_H4*2
ENDIF
GOTOF _TG4
_TG2:
_WINT=ABS(WID)/2
_WINT=_WINT-FAL
_DPT=DP-RFP-(SDIS*HH2)
FALD=FALD*HH2
IF (_VARI1<>1)
IF(HH2==1)
_ZT=_DPT+(HZ1-HZ2)*HH1*HH2
ELSE
_ZT=(_DPT+FALD*2)+(HZ1-HZ2)*HH1*HH2
ENDIF
ELSE
_ZT=(DPR*HH2)-(HZ1-HZ2)*HH1*HH2
ENDIF
IF (_ZZSD[1]==0)
_ZTSDIS=ABS(_ZT)
IF (_VARI1==1)
_ZTSDIS=_ZTSDIS+SDIS
ENDIF
ELSE
_ZTSDIS=ABS(_ZT)+SDIS
ENDIF
IF(HZ2>1)
_ZTSDIS=HH1
ENDIF
IF (_STA2<=0) GOTOF _FEHL8 IF (_DP1<=0) GOTOF _FEHL8 IF ABS(_ZTSDIS)>=ABS(_DP1) GOTOF _MQ34
_I4=1
GOTOF _HELRAD
_MQ34:_I4=TRUNC(ABS(_ZTSDIS)/_DP1)
IF _DP1*_I4==_ZTSDIS GOTOF _HELRAD
_I4=_I4+1
_HELRAD:_H4=_STA2
IF(_STA2<=WZR)
_H4=WZR+0.2*WZR
ENDIF
IF _H4>_WINT
_H4=_WINT
ENDIF
IF _H4==0 GOTOF _FEHL4
GOTOF _HELBAHN
_FALL3: IF _H4==_STA2 GOTOF _HELBAHN
_FALL3NEU: IF ABS(_ZTSDIS)/_I4/_H4<=_DP1/_STA2 GOTOF _HELBAHN
_I4=_I4+1
GOTOB _FALL3NEU
_HELBAHN:
N150 G0 G40 G91 AX[_X]=_H4-WZR
IF (_VARI1<>1)
_THE=_ZT
ELSE
_THE=-_ZTSDIS*HH2
ENDIF
IF(HZ2>1)
_THE=(-HH1)*HH2
ENDIF
EXECSTRING(_S_FFP1)
IF(HZ2<HZ1) OR NOT (_VARI1==1)
ENDIF
N170 G[1]=_DIRH G91 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=_THE IP[_X]=-(_H4-WZR) IP[_Y]=AC(0) TURN=_I4-1
IF(HZ2<HZ1) OR NOT (_VARI1==1)
ENDIF
N190 G91 AX[_X]=0 AX[_Y]=0 IP[_X]=-(_H4-WZR) IP[_Y]=AC(0)
N195 G1 G91 AX[_X]=-(_H4-WZR)
G90
GOTOF _TG4
_TG0:
IF ((_H9==0)AND(_H10==0))
IF ((_SPIND==1)AND(_VARI1<2))
CUST_TECHCYC(1+_UMODE)
ENDIF
ENDIF
_H9=0
IF(HZ2<HZ1) OR NOT (_VARI1==1)
SBLON
ENDIF
N19 G0 G90 AX[_Z]=DP+((HZ1-HZ2)*HH1+SDIS)*HH2
EXECSTRING(_S_FFP1)
N20 G1 G90 G60 AX[_Z]=DP+(HZ1-HZ2)*HH1*HH2
IF(HZ2<HZ1) OR NOT (_VARI1==1)
SBLOF
ENDIF
GOTOF _TG4
_TG1:
IF ((_H9==0)AND(_H10==0))
IF ((_SPIND==1)AND(_VARI1<2))
CUST_TECHCYC(1+_UMODE)
ENDIF
ENDIF
_H9=0
IF(HZ2<HZ1) OR NOT (_VARI1==1)
SBLON
ENDIF
EXECSTRING(_S_FFD)
N21 G1 G90 G60 AX[_Z]=DP+(HZ1-HZ2)*HH1*HH2
IF(HZ2<HZ1) OR NOT (_VARI1==1)
SBLOF
ENDIF
_TG4:
IF _H10==0
IF ((_SPIND==1)AND(_ZB[2]==0))
CUST_TECHCYC(4+_UMODE)
ENDIF
IF ((_SPIND==3)AND(_ZB[2]==0))
CUST_TECHCYC(403+_UMODE)
ENDIF
ENDIF
IF HH3 > WZR GOTOF _MG0
EXECSTRING(_S_FFP1)
IF ((_HELIKAL==0)AND(_VARI2==3))
IF (_I3<0); AND (_VARI2==3))
HH7=-1 _I3=-_I3
ELSE
HH7=1 _I3=-_I3
ENDIF
ENDIF
N101 G91 AX[_X]=(HH5-HH4)*HH7 AX[_Y]=0
HH7=-HH7
_MM7A:HZ2=HZ2+1
IF SOWZ GOTOF _MS0
IF HZ2<=HZ1 GOTOB _MM7
GOTOF _MS0
_MG0:
EXECSTRING(_S_FFP1)
IF ((_HELIKAL==0)AND(_I3<0))
HH4=_M_HH5 HH5=_M_HH4 HH7=-1;-HH7
ENDIF
G90
IF _DIR==2 GOTOF _MG2
_MG1:
IF(_HELIKAL)
N306 G0 AX[_Z]=RFP+_SDIS
N307 G0 AX[_X]=HH4 AX[_Y]=HH3*HH7-WZR
IF (_ZZSD[1]==1)
N308 G1 NORM G[10]=_GG10 AX[_Z]=RFP
ENDIF
N950 CONTDCON(_KTS)
N309 G1 AX[_X]=HH4 AX[_Y]=HH3*HH7
GOTOF _NEXT1
ENDIF
N310 G1 G41 NORM G[10]=_GG10 AX[_X]=HH4+HH8*HH7 AX[_Y]=HH9*HH7
_NEXT1:
N311 G3 AX[_X]=HH4 AX[_Y]=-HH3*HH7 CR=-HH3
N312 G1 AX[_X]=HH5
N330 G3 AX[_X]=HH5 AX[_Y]=HH3*HH7 CR=HH3
N340 G1 AX[_X]=HH4
IF(_HELIKAL)
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
ENDIF
N350 G3 AX[_X]=HH4-(WZR+4*HH3)/5*HH7 AX[_Y]=(HH3-(WZR+4*HH3)/5)*HH7 CR=(WZR+4*HH3)/5
N360 G1 G40 G60 AX[_X]=HH4 AX[_Y]=0
IF ((_HELIKAL)AND(ABS(_VARI) _DEC1==2))
N365 G1 AX[_X]=HH5
ENDIF
IF(_HELIKAL)
G0 AX[_Z]=RFP+_SDIS
GOTOF _MS0
ENDIF
IF ((HH7<0)AND(HZ2<HZ1))
HH4=_M_HH4 HH5=_M_HH5 HH7=-HH7
ENDIF
GOTOB _MM7A
_MG2:
IF(_HELIKAL)
N206 G0 AX[_Z]=RFP+_SDIS
N207 G0 AX[_X]=HH4 AX[_Y]=-HH3*HH7+WZR
IF (_ZZSD[1]==1)
N208 G1 NORM G[10]=_GG10 AX[_Z]=RFP
ENDIF
N950 CONTDCON(_KTS)
N209 G1 AX[_X]=HH4 AX[_Y]=-HH3*HH7
GOTOF _NEXT2
ENDIF
G1 G42 NORM G[10]=_GG10 AX[_X]=HH4+HH8*HH7 AX[_Y]=-HH9*HH7
_NEXT2:
N210 G2 AX[_X]=HH4 AX[_Y]=HH3*HH7 CR=-HH3
N220 G1 AX[_X]=HH5
N230 G2 AX[_X]=HH5 AX[_Y]=-HH3*HH7 CR=HH3
N240 G1 AX[_X]=HH4
IF(_HELIKAL)
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
ENDIF
N250 G2 AX[_X]=HH4-(WZR+4*HH3)/5*HH7 AX[_Y]=-(HH3-(WZR+4*HH3)/5)*HH7 CR=(WZR+4*HH3)/5
N260 G1 G40 G60 AX[_X]=HH4 AX[_Y]=0
IF ((_HELIKAL)AND(ABS(_VARI) _DEC1==2))
N265 G1 AX[_X]=HH5
ENDIF
IF(_HELIKAL)
G0 AX[_Z]=RFP+_SDIS
GOTOF _MS0
ENDIF
IF ((HH7<0)AND(HZ2<HZ1))
HH4=_M_HH4 HH5=_M_HH5 HH7=-HH7
ENDIF
GOTOB _MM7A
_MS0:
IF ((_VARI2==3)AND(_VARI1==0))
IF NOT(FAL==0)
N400 G0 G90 AX[_Z]=RFP+SDIS*HH2
IF ((HH7<0)AND(HZ2<HZ1))
HH4=_M_HH4 HH5=_M_HH5 HH7=-HH7
_I3=1
ENDIF
N401 G0 G90 AX[_X]=HH4 AX[_Y]=0
ENDIF
ENDIF
IF HZ4 GOTOF _MM7B
IF (_VARI1==1) OR (FAL==0)
_ZB[2]=_VARI2 _ZB[1]=_VARI1
GOTOF _MM7C
ENDIF
N261 _MS1: CFC
IF ((_DMODE4==0) AND ((_VARI _DEC1 ==0) OR (_VARI _DEC1 ==2)))
_SRE_FFP1=_S_FFP1
_S_FFP1=_S_FFP2
ENDIF
IF WZR==WID/2 GOTOF _MS2
HH9=WID/2*((HH3-WZR)/(WID/2-WZR))
IF (POT(WID/2)-POT(HH9))<0
HH9=WID/2 HH8=0
ELSE
HH8=SQRT(POT(WID/2)-POT(HH9))
ENDIF
_MS2:HH3=WID/2 HZ4=1 HZ1=(_SDZI+DPR)/MIDF+0.4999
IF HZ1==0
HZ1=1
ENDIF
HH1=(_SDZI+DPR)/HZ1 HZ2=1 _H10=1
IF HH7>0 GOTOF _MS3
HH7=HH4 HH4=HH5 HH5=HH7 HH7=-1
_MS3:
IF ((_VARI2<2)OR(_VARI1>0)) GOTOF _MMAR1
IF ((VARI MOD 100)==30)
_ZB[2]=_VARI2 _ZB[1]=_VARI1 _VARI2=1 _VARI1=2 VARI=12
IF (_HELIKAL)
_SET_DP_NEU=1 _SLGR=1
DP_SAVE=DP _FFP1_SAVE=FFP1
IF (SSF>0)
S=SSF G60
ENDIF
GOTOB _TG4
ENDIF
GOTOF _MMAR1
ENDIF
GOTOB _TG4
_MMAR1:IF SSF<0 GOTOB _MM7
S=SSF G60
GOTOB _MM7
_MM7B:IF HH3<=WZR GOTOF _MM7C IF HH7>0 GOTOF _MM7C
HH7=HH4 HH4=HH5 HH5=HH7 HH7=1
_MM7C:
IF ((_VARI1==1)OR(FALD==0)OR(_SLGR==1)) GOTOF _MM7D
_VARI1=VARI MOD 10
IF ((HH7<0) AND (_VARI1==0) AND (HH3==WZR) AND (_VARI2<>3))
HH7=HH4 HH4=HH5 HH5=HH7 HH7=-1
ENDIF
EXECSTRING(_S_FFD)
G1 G91 G[10]=_GG10 AX[_Z]=-FALD
_SLGR=1
G90
_SRE_FFP1=_S_FFP1
_S_FFP1=_S_FFP2
GOTOB _MG0
_MM7D:SBLON
IF ((_DMODE4==0) AND ((_VARI _DEC1 ==0) OR (_VARI _DEC1 ==2)))
_S_FFP1=_SRE_FFP1
ENDIF
G0 G90 AX[_Z]=RTP
IF ((_VARI1==0) AND (HH3==WZR) AND (HH7<0) AND (_SLGR==1))
HH7=HH4 HH4=HH5 HH5=HH7 HH7=1
ENDIF
IF (_HELIKAL==0)
AX[_X]=_M_HH4 AX[_Y]=0
ENDIF
HZ2=1 HH6=INDA HZ3=HZ3+1 HZ4=0 _H10=0
IF HZ3>=NUM GOTOF _M7D
VARI=_ZB[9]
IF ((VARI MOD 100)==30)
_VARI2=_ZB[2] _VARI1=_ZB[1]
ENDIF
IF SSF<0 GOTOB _MM4A
IF (((_DMODE4>0) AND (_VARI _DEC1 <>2)) OR ((_DMODE4==0) AND (_VARI _DEC1 ==0)))
S=HHS
ENDIF
GOTOB _MM4A
_M7D:
IF ((_SPIND==1)AND(_ZB[2]==0))
CUST_TECHCYC(4+_UMODE)
ENDIF
IF ((_SPIND==3)AND(_ZB[2]==0))
CUST_TECHCYC(403+_UMODE)
ENDIF
IF SSF<0 GOTOF _MM8
S=HHS
_MM8:
SBLON
$P_CYCFRAME=_RE_CYCFR
IF(($P_MC)AND(_SC_PC==1))
N920 G40 G90 AX[_X]=CPA AX[_Y]=CPO
ENDIF
IF (_OFFN<>0)
IF(_ZZSD[8]==0)
OFFN=_OFFN1
ENDIF
ENDIF
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_X]=HH4
$AA_MEAS_POINT1[_Y]=0
$AA_MEAS_POINT1[_Z]=RFP+SDIS*HH2
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_X])+POT($AA_MEAS_POINT2[_Y])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_X,HH4,_Z,RFP+SDIS*HH2)
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_CALL_CYCLE72_A:
N960 EXECUTE(_ERROR)
IF(_ERROR) GOTOF _FEHL41
IF(ISFILE(_TEMP_FILE))
FOR _I=0 TO _KTS[0,5]
WRITE(_TEMP,_TEMP_FILE,"I="<<_I<<" G"<<_KTS[_I,0] MOD 10<<" "<<_KTS[_I,1]<<" "<<_KTS[_I,2]<<" "<<_KTS[_I,3]<<" "<<_KTS[_I,4]<<" F="<<_KTS[_I,5])
ENDFOR
ENDIF
_CONT_TAB[1,0]=0
FOR _I=0 TO _KTS[0,5]
IF(_CONT_TAB[1,0]<2)AND((_KTS[_I,0] MOD 10)>0)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=1
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=0
_CONT_TAB[4,_CONT_TAB[1,0]]=0
ENDIF
IF((_KTS[_I,0] MOD 10)==1)OR((_KTS[_I,0] MOD 10)==2)OR((_KTS[_I,0] MOD 10)==3)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=_KTS[_I,0] MOD 10
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=_KTS[_I,3]
_CONT_TAB[4,_CONT_TAB[1,0]]=_KTS[_I,4]
ENDIF
ENDFOR
_KNAME="_E_SP_SLOT1_ANF:_E_SP_SLOT1_END"
_VARI72=2+100000
IF (_SET_DP_NEU)
_SET_DP_NEU=0 DP=_DP
IF (FFP2<>0)
FFP1=FFP2
ENDIF
ELSE
DP=DP_SAVE FFP1=_FFP1_SAVE
ENDIF
_FRK=40
IF(_DIR==2)
_FRK=42
G42
ELSE
_FRK=41
G41
ENDIF
N970 CYCLE72(_KNAME,RTP,RFP,_SDIS,DP,_MID,_FAL,_FALD,FFP1,FFP1,_VARI72,_FRK,0,0,FFP1,0,0)
_CALL_CYCLE72_E:
_E_SP_SLOT1_ANF:
FOR _CONT_TAB[0,0]=1 TO _CONT_TAB[1,0]
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==1)
N910 G1 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]]
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==2)
N920 G2 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==3)
N930 G3 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
ENDFOR
_E_SP_SLOT1_END:
_FEHL1:STOPRE
N731001 SETAL(61101)
RET
_FEHL2:STOPRE
N731002 SETAL(61106)
RET
_FEHL3:STOPRE
N731003 SETAL(61104)
RET
_FEHL4:STOPRE
N731004 SETAL(61105)
RET
_FEHL5:STOPRE
N731005 SETAL(61002)
RET
_FEHL6:STOPRE
N731006 SETAL(61000)
RET
_FEHL7:STOPRE
N731007 SETAL(61128)
RET
_FEHL8:STOPRE
N731008 SETAL(61108)
RET
_FEHL9:STOPRE
N731009 SETAL(61609)
RET
_FEHL10:STOPRE
N731010 SETAL(61102)
RET
_FEHL11:
N731011 SETAL(62106)
RET
_FEHL12:STOPRE
N731012 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL13:STOPRE
N731013 SETAL(61019,"(_VARI: dec6)")
RET
_FEHL14:STOPRE
N731014 SETAL(61078)
RET
_FEHL16:STOPRE
N731016 SETAL(61109)
RET
_FEHL18: STOPRE
N731018 SETAL(61019,_SERR)
RET
_FEHL20: STOPRE
N731020 SETAL(61156)
RET
_FEHL21: STOPRE
N731021 SETAL(61016)
RET
_FEHL22: STOPRE
N731022 SETAL(61158)
RET
_FEHL23: STOPRE
N731023 SETAL(61159)
RET
_FEHL24: STOPRE
N731024 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N731025 SETAL(61019,"(_GMODE: dec3)")
RET
_FEHL26: STOPRE
N731026 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL27: STOPRE
N731027 SETAL(61019,"(_GMODE: dec4)")
RET
_FEHL29: STOPRE
N731029 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N731030 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N731031 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL32: STOPRE
N731032 SETAL(61019,"(_DMODE: dec4/NUM)")
RET
_FEHL33: STOPRE
N731033 SETAL(61022,"(UXY)")
RET
_FEHL34:STOPRE
N731034 SETAL(61007)
RET
_FEHL35: STOPRE
N731035 SETAL(61216)
RET
_FEHL36: STOPRE
N731036 SETAL(61012)
RET
_FEHL37: STOPRE
N731037 SETAL(61061)
RET
_FEHL38: STOPRE
N731038 SETAL(61019,"(_DMODE: dec5)")
RET
_FEHL39: STOPRE
N731039 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N731040 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_FEHL41: STOPRE
N707941 SETAL(61606)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_SLOT2_SPF
PROC SLOT2(REAL RTP,REAL RFP,REAL SDIS,REAL _DP,REAL _DPR,INT NUM,REAL AFSL,REAL WID,REAL __CPA,REAL __CPO,REAL RAD,REAL STA1,REAL INDA,REAL FFD,REAL FFP1,REAL _MID,INT _CDIR,REAL _FAL,INT _VARI,REAL _MIDF,REAL FFP2,REAL SSF,REAL _FFCP,INT _UMODE,REAL _FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.011 ;DATE: 2024-05-31
;Cycle support HMIsl
;Circumferential Slot
DEF AXIS _X,_Y,_Z
DEF REAL HH1,HH2,HH3,HH4,HH5,HH6,HH7,HH8,HH9,HH10,WZR,HHS,_SDZI,_RFT,_OFFN,_OFFN1,_FFP2,_FFP1_SAVE
DEF REAL _FAK1,_FAK2,DP,DPR,CPA,CPO,MID,MIDF,CDIR,FAL,_ZFS,_KTS[60,6],_FALD=0
DEF INT HZ1,HZ2,HZ3,HZ4,_VARI1,_VARI2,_VARI4,_SPIND,_H1,_DIR,VARI,_WTYP,_GG10
DEF BOOL SOWZ,_H9,_H10,_H11,_MDG,_ZB[10],_SET_F_SCHLI=0
DEF INT _MIRR,_RE_MIRR,_ERR,_II,_HELIKAL,_FRK,_VARI72,_I,_ERROR
DEF INT _ARTIS[16],_TEMP,_GMODE4,_DMODE1,_DMODE4,_DMODE5,_AMODE1,_AMODE3,_ZZSD[15]
DEF STRING[30] _S_FFP1,_S_FFD,_S_FFCP,_S_FFP2,_SRE_FFP1
DEF FRAME _RE_CYCFR
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_SLOT2_MPF",_PROG,_SERR
DEF STRING[70] _KNAME
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_SLOT2_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1]<<"  _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"SLOT2("<<RTP<<","<<RFP<<","<<SDIS<<","<<_DP<<","<<_DPR<<","<<NUM<<","<<AFSL<<","<<WID<<","<<__CPA<<","<<__CPO<<","<<RAD<<","<<STA1<<","<<INDA<<","<<FFD<<","<<FFP1<<","<<_MID<<","<<_CDIR<<","<<_FAL<<","<<_VARI<<","<<_MIDF<<","<<FFP2<<","<<SSF<<","<<_FFCP<<","<<_UMODE<<","<<_FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF ((_DPR==0)AND(_VARI _DEC1<>5))
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DIAMCYCOF
IF ($P_GG[30]>1)
COMPOF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
DP=_DP DPR=_DPR CPA=__CPA CPO=__CPO MID=_MID MIDF=_MIDF CDIR=_CDIR FAL=_FAL VARI=ABS(_VARI) _ZFS=__ZFS
_FFP2=FFP2
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL34
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
GOTOF _FEHL34
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "F_SL_CIR")AND(_PROG <> "E_SL_CIR") )
SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
ENDIF
_DMODE4=_DMODE _DEC4
IF (_DMODE4<0) OR (_DMODE4>1) GOTOF _FEHL31
IF _DMODE4
MIDF=MID SSF=0
ENDIF
IF(_GMODE _DEC3==0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL25
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_X=$P_AXN1 _Y=$P_AXN2
CPA=$P_EP[_X]*_FAK1 CPO=$P_EP[_Y]*_FAK1
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
IF ((_DMODE4==0) AND ((_VARI _DEC1 ==0) OR (_VARI _DEC1 ==2) OR (_VARI _DEC1 ==3)))
IF (_FFP2==0)
_FFP2=FFP1
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP2="G95 F"<<_FFP2
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL32
ENDIF
_S_FFP2="G95 FZ="<<_FFP2
ELSE
_S_FFP2="G94 F"<<_FFP2
ENDIF
ENDIF
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<FFP1
_S_FFD ="G95 F"<<FFD
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL32
ENDIF
_S_FFP1="G95 FZ="<<FFP1
_S_FFD ="G95 FZ="<<FFD
ELSE
_S_FFP1="G94 F"<<FFP1
_S_FFD ="G94 F"<<FFD
ENDIF
ENDIF
IF(_VARI _DEC1 == 3)OR(_VARI _DEC1 == 5)
_S_FFD=_S_FFP1
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3 SDIS=ABS(SDIS) DPR=ABS(DPR) AFSL=ABS(AFSL) WID=ABS(WID) _RE_MIRR=1
WZR=$P_TOOLR*_FAK1
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF ($P_ACTFRAME[_X,SC]<>$P_ACTFRAME[_Y,SC]) GOTOF _FEHL35
_VARI1=VARI _DEC1
IF (_VARI1>5) GOTOF _FEHL5
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL8
IF(_HELIKAL==1)AND(_VARI1==5) GOTOF _FEHL5
IF(_VARI1==5)
_OFFN1=$P_OFFN*_FAK2
_AMODE3=_AMODE _DEC3
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(RTP==RFP) GOTOF _FEHL1
_RFT=(RTP-RFP)/ABS(RTP-RFP)
DP=RFP-ABS(_ZFS)*_RFT
_ZFS=ABS(_ZFS)
ELSE
DP=_ZFS
_ZFS=ABS(RFP-_ZFS) _AMODE3=1
ENDIF
_AMODE1=2 DPR=0 _ZB[5]=1
IF(_ZZSD[1]==0)
MID=_ZFS+SDIS
ELSE
MID=_ZFS
ENDIF
MIDF=MID FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_OFFN=$P_OFFN*_FAK2 _VARI1=3
ENDIF
WZR=WZR+_OFFN
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_RE_CYCFR=$P_CYCFRAME
ELSE
GOTOF _FEHL21
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL11
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL11
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL11
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_SPIND=VARI _DEC3
IF(_SPIND>4) GOTOF _FEHL5
_STCCMA:
IF ((_SPIND==2) AND ($P_TRAFO B_AND 'H1300') ) GOTOF _FEHL5
IF (_VARI1==3)
IF (FAL<=0) GOTOF _FEHL33
_VARI1=2 _ZB[7]=1
ENDIF
_VARI2=VARI _DEC2
IF (_VARI2<0) OR (_VARI2>1) GOTOF _FEHL5
IF (_DMODE4 AND (_VARI2==1))OR(_FFCP==0)
_FFCP=$SCS_CIRCLE_RAPID_FEED
ENDIF
IF _ZZSD[1]==0
_SDZI=SDIS
ENDIF
SOWZ=0
RAD=ABS(RAD) NUM=ABS(NUM) MID=ABS(MID) MIDF=ABS(MIDF) INDA=ABS(INDA) HH6=STA1 HH10=1
_VARI4=VARI _DEC4
IF _VARI4>2 GOTOF _FEHL5
IF _VARI4==1
INDA=0
ENDIF
IF ($P_TOOL==0) GOTOF _FEHL6
IF NUM==0 GOTOF _FEHL2
IF ((_VARI1>=2)AND(FAL==0))
FAL=WID
ENDIF
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0) AND (_ZB[5]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(((DPR==0) AND (_AMODE1==0)) OR (_AMODE1==2))
DPR=ABS(RFP-DP)
IF RFP==DP GOTOF _MM8
ELSE
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF(((DPR>0) AND (_AMODE1==0)) OR (_AMODE1==1))
DP=HH2
ELSE
IF DP==HH2
DPR=ABS(RFP-DP)
ENDIF
ENDIF
IF RFP==DP GOTOF _MM8
ENDIF
IF RTP<>RFP
IF ((RTP-RFP)/ABS(RTP-RFP)<>(RFP-DP)/DPR) GOTOF _FEHL1
ENDIF
IF INDA<>0
HH1=INDA*(NUM-1)+AFSL
IF (NUM>1)AND(AFSL>INDA) GOTOF _FEHL3
IF HH1>360 GOTOF _FEHL2
IF(NUM<>1)
IF ABS(SIN(HH1 /2))*RAD<=WID/2 GOTOF _FEHL3
ENDIF
ELSE
INDA=360/NUM
ENDIF
IF (RFP-DP)<>0
_RFT=(RFP-DP)/ABS(RFP-DP)
ELSE
GOTOF _FEHL29
ENDIF
IF (CDIR<0)OR(CDIR>3) GOTOF _FEHL16
_MIRR=$P_ACTFRAME[_X,MI]+$P_ACTFRAME[_Y,MI]
IF(_MIRR==1)
IF(CDIR==0)OR(CDIR==2)
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
IF _RFT<0
IF(CDIR==0)OR(CDIR==2)
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_Z,MI])
IF(CDIR==0)OR(CDIR==2)
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
_DIR=2
IF CDIR==2 GOTOF _MY3 IF CDIR<>3 GOTOF _MY2
_DIR=3
GOTOF _MY3
_MY2:
IF($P_SMODE[0]==1) OR ($P_SMODE[0]==3)
_H1=$P_SDIR[$P_MSNUM]
IF(_H1<3)OR(_H1>4)
GOTOF _FEHL10
ENDIF
ELSE
GOTOF _FEHL10
ENDIF
IF(_H1<3)OR(_H1>4)
_DIR=3
SETAL(62101)
GOTOF _MY3
ENDIF
IF (((CDIR==0)AND(_H1==4))OR((CDIR==1)AND(_H1==3)))
_DIR=2
ELSE
_DIR=3
ENDIF
_MY3:
IF CDIR<>2
HH10=-1
ENDIF
HHS=$P_S[0]
IF SSF<=0
SSF=HHS
ENDIF
IF(NUM<>1)
IF ABS(SIN((INDA-AFSL)/2))*RAD<=WID/2
GOTOF _FEHL3
ENDIF
ENDIF
IF MIDF GOTOF _MM1D
MIDF=_SDZI+DPR
_MM1D:IF RTP==RFP GOTOF _MM2 IF (RTP-RFP)/ABS(RTP-RFP)<>(RFP-DP)/DPR GOTOF _FEHL1
_MM2:
WZR=WZR/$P_ACTFRAME[_X,SC]
IF(_VARI1==2)
IF(WID<((WZR-_OFFN)*2))
IF NOT(_VARI _DEC1 ==5)
GOTOF _FEHL4
ENDIF
ENDIF
IF((WID>((WZR-_OFFN)*4))AND(NOT _ZB[5])AND(NOT _ZB[7]))
GOTOF _FEHL7
ENDIF
ELSE
IF(_VARI1==1)OR(_VARI1==0)
IF((WID-2*FAL)<(WZR*2))
GOTOF _FEHL4
ENDIF
IF((WID-2*FAL)>(WZR*4))
GOTOF _FEHL7
ENDIF
ELSE
IF(WID<(WZR*2))
GOTOF _FEHL4
ENDIF
ENDIF
ENDIF
;
IF ((_SPIND==2)AND(_H11==0))
CUST_TECHCYC(3+_UMODE)
_H11=1
ENDIF
IF(_SPIND==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
N100 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,CPA*1/_FAK1,_Y,CPO*1/_FAK1)
HH4=COS(AFSL) HH5=SIN(AFSL)
IF MID GOTOF _MM4A
MID=_SDZI+DPR
_MM4A:
IF MID>=DPR
MID=_SDZI+DPR
ENDIF
IF MIDF>=DPR
MIDF=_SDZI+DPR
ENDIF
HZ1=(_SDZI+DPR)/MID+0.4999
IF HZ1==0
HZ1=1
ENDIF
HH1=(_SDZI+DPR)/HZ1 HZ2=1 HH3=WID/2-FAL
IF HH3>WZR GOTOF _MM5
FAL=WID/2-WZR HH3=WZR
_MM5:HH9=HH3 HH8=0
N121 $P_CYCFRAME=$P_CYCFRAME:CROT(_Z,HH6)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
IF _ZZSD[3]
IF _ZB[8]
G94
ELSE
G95
ENDIF
ENDIF
IF((_VARI2==0)OR(HZ3==0))
N130 G0 G40 G60 G90 CFTCP AX[_X]=RAD AX[_Y]=0
ELSE
_S_FFCP="G94 F"<<_FFCP
EXECSTRING(_S_FFCP)
N130 G3 G40 G60 G90 CFTCP CR=RAD AX[_X]=RAD AX[_Y]=0
ENDIF
SBLON
IF ((_SPIND==1)AND(_VARI1<2))
CUST_TECHCYC(3+_UMODE)
_H9=1
ENDIF
N140 G0 G[10]=_GG10 AX[_Z]=RFP+SDIS*_RFT
SBLOF
IF ((_VARI1==2)OR(_VARI1==3)) GOTOF _MS1
_MM7:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
ENDIF
IF(_HELIKAL==1)
HZ1=1
ENDIF
IF HZ1>1
IF(HZ2==1)
ENDIF
IF(HZ2==HZ1)
ENDIF
ENDIF
IF ((_H9==0)AND(_H10==0))
IF ((_SPIND==1)AND(_VARI1<2))
CUST_TECHCYC(3+_UMODE)
ENDIF
ENDIF
_H9=0
IF SOWZ==1
HZ2=HZ1
ENDIF
SBLON
G0 AX[_Z]=IC(0)
SBLOF
IF (_ARTIS[11]==3) AND ( ((_VARI1<2)AND(_ARTIS[12]<>1)) OR (((_VARI1==0)OR(_VARI1>1))AND(_ARTIS[12]==1)))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF _ZZSD[3]
IF _ZB[8]
G94
ELSE
G95
ENDIF
ENDIF
IF(_HELIKAL==1) GOTOF _NEXT0
EXECSTRING(_S_FFD)
N150 G1 G90 G60 AX[_Z]=DP+(HZ1-HZ2)*HH1*_RFT
_NEXT0:
IF _H10==0
IF ((_SPIND==1)AND(_VARI1<2))
CUST_TECHCYC(4+_UMODE)
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
IF HH3>WZR GOTOF _MG0 IF HH7 GOTOF _MM7B
N150 G3 AX[_X]=RAD*HH4 AX[_Y]=RAD*HH5 IP[_X]=AC(0)IP[_Y]=AC(0)
HH7=1
GOTOF _MM7A
N160 _MM7B:G2 AX[_X]=RAD AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
HH7=0
_MM7A:HZ2=HZ2+1
IF SOWZ==1 GOTOF _MS0
IF HZ2 <= HZ1 GOTOB _MM7
GOTOF _MS0
_MG0:IF ((_DIR==2)AND(HH7==0))OR((_DIR==3)AND(HH7)) GOTOF _MG2
N300 _MG1:
EXECSTRING(_S_FFP1)
IF(_HELIKAL==1)
N301 G0 AX[_Z]=RFP+SDIS
N302 G0 AX[_X]=RAD-HH3+WZR AX[_Y]=0
IF (_ZZSD[1]==1)
N303 G1 NORM G[10]=_GG10 AX[_Z]=RFP
ENDIF
N950 CONTDCON(_KTS)
N304 G1 AX[_X]=RAD-HH3 AX[_Y]=0
GOTOF _NEXT1
ENDIF
G1 G41 NORM G[10]=_GG10 AX[_X]=RAD+HH8 AX[_Y]=HH9
_NEXT1:
N310 G3 AX[_X]=RAD+HH3 AX[_Y]=0 IP[_X]=AC(RAD) IP[_Y]=AC(0)
N320 G3 AX[_X]=(RAD+HH3)*HH4 AX[_Y]=(RAD+HH3)*HH5 IP[_X]=AC(0) IP[_Y]=AC(0)
N330 G3 AX[_X]=(RAD-HH3)*HH4 AX[_Y]=(RAD-HH3)*HH5 IP[_X]=AC(RAD*HH4) IP[_Y]=AC(RAD*HH5)
N340 G2 AX[_X]=RAD-HH3 AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
IF(_HELIKAL==1)
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
ENDIF
N350 G3 AX[_X]=RAD-HH3+(WZR+4*HH3)/5 AX[_Y]=-(WZR+4*HH3)/5 IP[_X]=AC(RAD-HH3+(WZR+4*HH3)/5) IP[_Y]=AC(0)
N360 G1 G40 G60 AX[_X]=RAD AX[_Y]=0
IF(_HELIKAL==1)
G0 AX[_Z]=RFP+SDIS
ENDIF
IF (_ARTIS[11]==3) AND ( ((_VARI1<2)AND(_ARTIS[12]<>1)) OR (((_VARI1==0)OR(_VARI1>1))AND(_ARTIS[12]==1)) )
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[8])
ENDIF
GOTOB _MM7A
N200 _MG2:
EXECSTRING(_S_FFP1)
IF(_HELIKAL==1)
N201 G0 AX[_Z]=RFP+SDIS
N202 AX[_X]=RAD+HH3-WZR AX[_Y]=0
IF (_ZZSD[1]==1)
N203 G1 NORM G[10]=_GG10 AX[_Z]=RFP
ENDIF
N950 CONTDCON(_KTS)
N204 G1 AX[_X]=RAD+HH3 AX[_Y]=0
GOTOF _NEXT2
ENDIF
G1 G42 NORM G[10]=_GG10 AX[_X]=RAD+HH8 AX[_Y]=HH9
_NEXT2:
N210 G2 AX[_X]=RAD-HH3 AX[_Y]=0 IP[_X]=AC(RAD) IP[_Y]=AC(0)
N230 G3 AX[_X]=(RAD-HH3)*HH4 AX[_Y]=(RAD-HH3)*HH5 IP[_X]=AC(0) IP[_Y]=AC(0)
N240 G2 AX[_X]=(RAD+HH3)*HH4 AX[_Y]=(RAD+HH3)*HH5 IP[_X]=AC(RAD*HH4) IP[_Y]=AC(RAD*HH5)
N245 G2 AX[_X]=RAD+HH3 AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
IF(_HELIKAL==1)
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
ENDIF
N250 G2 AX[_X]=RAD+HH3-(WZR+4*HH3)/5 AX[_Y]=-(WZR+4*HH3)/5 IP[_X]=AC(RAD+HH3-(WZR+4*HH3)/5) IP[_Y]=AC(0)
N260 G1 G40 G60 AX[_X]=RAD AX[_Y]=0
IF(_HELIKAL==1)
G0 AX[_Z]=RFP+SDIS
ENDIF
IF (_ARTIS[11]==3) AND ( ((_VARI1<2)AND(_ARTIS[12]<>1)) OR (((_VARI1==0)OR(_VARI1>1))AND(_ARTIS[12]==1)) )
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[8])
ENDIF
GOTOB _MM7A
_MS0:IF HZ4 GOTOF _MM17B IF (_VARI1==1)OR(FAL==0) GOTOF _MM7C
N261 _MS1:CFC
IF ((_DMODE4==0) AND ((_VARI _DEC1 ==0) OR (_VARI _DEC1 ==2) OR (_VARI _DEC1 ==3)))
_SRE_FFP1=_S_FFP1
_S_FFP1=_S_FFP2
ENDIF
IF WZR==WID/2 GOTOF _MS02
N310 HH8=(POT(RAD+(HH3-WZR)*HH10)-POT(WID/2-WZR)-POT(RAD))*WID/2/(2*RAD*(WID/2-WZR))
N311 HH9=SQRT(POT(WID/2)-POT(HH8))
_MS02:HZ4=1 HH3=WID/2 HZ1=(_SDZI+DPR)/MIDF+0.4999
IF HZ1==0
HZ1=1
ENDIF
HH1=(_SDZI+DPR)/HZ1 HZ2=1 _H10=1
IF NOT(HH7==0)
N400 $P_CYCFRAME=$P_CYCFRAME:CROT(_Z,AFSL)
N410 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_Y)
_RE_MIRR=-_RE_MIRR
ENDIF
_MS3:
IF (_HELIKAL)
_SET_F_SCHLI=1
ENDIF
IF SSF<0 GOTOB _MM7
N420 S=SSF G60
GOTOB _MM7
_MM17B:IF HH7==0 GOTOF _MM7C
IF NOT((WZR==WID/2)OR(_ZB[5]==1))
N430 $P_CYCFRAME=$P_CYCFRAME:CMIRROR(_Y)
N431 $P_CYCFRAME=$P_CYCFRAME:CROT(_Z,-AFSL)
_RE_MIRR=-_RE_MIRR
ENDIF
HH7=0
_MM7C:
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
SBLON
IF ((_DMODE4==0) AND ((_VARI _DEC1 ==0) OR (_VARI _DEC1 ==2)))
_S_FFP1=_SRE_FFP1
FFP1=_FFP1_SAVE
ENDIF
N450 G0 G90 G60 AX[_Z]=RTP
SBLOF
HZ2=1 HH6=INDA HZ3=HZ3+1 HZ4=0 HH7=0 _H10=0
IF HZ3>=NUM GOTOF _M7C
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
IF SSF<0 GOTOB _MM4A
IF (((_DMODE4>0) AND (_VARI _DEC1 <>2)) OR ((_DMODE4==0) AND (_VARI _DEC1 ==0)))
N460 S=HHS
ENDIF
GOTOB _MM4A
_M7C:
HZ3=0
IF _SPIND==2
CUST_TECHCYC(4+_UMODE)
_H11=0
ENDIF
IF SSF<0 GOTOF _MM8
N480 S=HHS
N490 _MM8:
SBLON
IF (_ARTIS[1]<>0)
M=QU(_ARTIS[8])
ENDIF
$P_CYCFRAME=_RE_CYCFR
IF(($P_MC)AND(_SC_PC==1))
N920 G40 G90 AX[_X]=CPA AX[_Y]=CPO
ENDIF
IF (_OFFN<>0)
IF(_ZZSD[8]==0)
OFFN=_OFFN1
ENDIF
ENDIF
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_X]=RAD
$AA_MEAS_POINT1[_Y]=0
$AA_MEAS_POINT1[_Z]=RFP+SDIS*_RFT
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_X])+POT($AA_MEAS_POINT2[_Y])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_X,RAD,_Z,RFP+SDIS*_RFT)
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_CALL_CYCLE72_A:
N960 EXECUTE(_ERROR)
IF(_ERROR) GOTOF _FEHL41
IF(ISFILE(_TEMP_FILE))
FOR _I=0 TO _KTS[0,5]
WRITE(_TEMP,_TEMP_FILE,"I="<<_I<<" G"<<_KTS[_I,0] MOD 10<<" "<<_KTS[_I,1]<<" "<<_KTS[_I,2]<<" "<<_KTS[_I,3]<<" "<<_KTS[_I,4]<<" F="<<_KTS[_I,5])
ENDFOR
ENDIF
_CONT_TAB[1,0]=0
FOR _I=0 TO _KTS[0,5]
IF(_CONT_TAB[1,0]<2)AND((_KTS[_I,0] MOD 10)>0)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=1
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=0
_CONT_TAB[4,_CONT_TAB[1,0]]=0
ENDIF
IF((_KTS[_I,0] MOD 10)==1)OR((_KTS[_I,0] MOD 10)==2)OR((_KTS[_I,0] MOD 10)==3)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=_KTS[_I,0] MOD 10
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=_KTS[_I,3]
_CONT_TAB[4,_CONT_TAB[1,0]]=_KTS[_I,4]
ENDIF
ENDFOR
_KNAME="_E_SP_SLOT2_ANF:_E_SP_SLOT2_END"
_VARI72=2+100000
IF (_SET_F_SCHLI)
_SET_F_SCHLI=0 _FFP1_SAVE=FFP1
IF (FFP2<>0)
FFP1=FFP2
ENDIF
ENDIF
_FRK=40
IF(_DIR==2)
_FRK=42
G42
ELSE
_FRK=41
G41
ENDIF
N970 CYCLE72(_KNAME,RTP,RFP,SDIS,DP,_MID,_FAL,_FALD,FFP1,FFP1,_VARI72,_FRK,0,0,FFP1,0,0)
_CALL_CYCLE72_E:
_E_SP_SLOT2_ANF:
FOR _CONT_TAB[0,0]=1 TO _CONT_TAB[1,0]
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==1)
N910 G1 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]]
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==2)
N920 G2 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==3)
N930 G3 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
ENDFOR
_E_SP_SLOT2_END:
_FEHL1:STOPRE
N731101 SETAL(61101)
RET
_FEHL2:STOPRE
N731102 SETAL(61106)
RET
_FEHL3:STOPRE
N731103 SETAL(61104)
RET
_FEHL4:STOPRE
N731104 SETAL(61105)
RET
_FEHL5:STOPRE
N731105 SETAL(61002)
RET
_FEHL6:STOPRE
N731106 SETAL(61000)
RET
_FEHL7:STOPRE
N731107 SETAL(61007)
RET
_FEHL8:STOPRE
N731108 SETAL(61019,"(_VARI: dec6)")
RET
_FEHL10:STOPRE
N731110 SETAL(61102)
RET
_FEHL11:
N731111 SETAL(62106)
RET
_FEHL12:STOPRE
N731112 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL16:STOPRE
N731116 SETAL(61109)
RET
_FEHL18: STOPRE
N731118 SETAL(61019,_SERR)
RET
_FEHL20: STOPRE
N731120 SETAL(61156)
RET
_FEHL21: STOPRE
N731121 SETAL(61016)
RET
_FEHL22: STOPRE
N731122 SETAL(61158)
RET
_FEHL23: STOPRE
N731123 SETAL(61159)
RET
_FEHL24: STOPRE
N731124 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N731125 SETAL(61019,"(_GMODE: dec3)")
RET
_FEHL26: STOPRE
N731126 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL29: STOPRE
N731129 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N731130 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N731131 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL32: STOPRE
N731132 SETAL(61216)
RET
_FEHL33: STOPRE
N731133 SETAL(61022,"(UXY)")
RET
_FEHL34: STOPRE
N731134 SETAL(61019,"(_DMODE: dec5)")
RET
_FEHL35: STOPRE
N731135 SETAL(61012)
RET
_FEHL39: STOPRE
N731139 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N731140 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_FEHL41: STOPRE
N707941 SETAL(61606)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_POCKET3_SPF
PROC POCKET3(REAL _RTP,REAL _RFP,REAL __SDIS,REAL __DP,REAL __LENG,REAL __WID,REAL __CRAD,REAL _PA,REAL _PO,REAL __STA,REAL __MID,REAL __FAL,REAL __FALD,REAL _FFP1,REAL _FFD,INT __CDIR,INT __VARI,REAL __MIDA,REAL __AP1,REAL __AP2,REAL _AD,REAL __RAD1,REAL __DP1,INT _UMODE,REAL __FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT __AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.008 ;DATE: 2024-05-06
;Cycle support HMIsl
;Rectangular pocket
DEF AXIS _X,_Y,_Z
DEF INT _CDIR,_VARI,_AMODE,_GG10,_GG49
DEF INT _MIRR,_I1,_I2,_I3,_I4,_I11,_I14,_AZ,_AZB,_RFT,_SPIND,_H8,_ERR=0,_II,_ANFAS,_AMODE1,_AMODE2,_AMODE3,_DMODE1,_DMODE5,_GMODE4,_GMODE5,_GMODE5_SAVE=0,_VAR1,_VAR2,_ZZSD[15],_FFD_TYPE,_WTYP
DEF INT _ARTIS[16],_HELIKAL,_FRK,_VARI72,_I,_ERROR
DEF REAL _DP,_LENG,_WID,_CRAD,_MID,_FAL,_FALD,_MIDA,_AP1,_AP2,_ZFS,_STA,_DPH,_RFPH,_KTS[600,6]
DEF REAL _BRIX,_BRIY,_WZR,_H1,_H2,_H3,_H4,_H5,_AT,_GT,_ZT,_LINT,_WINT,_DPINT,_PEA[3,2],_ERI,_BRI,_RURA,_WZMF=1,_EINRAD=2,_ADZI,_SDZI=1
DEF REAL _FALI,CPA,CPO,_H15,_ZTP,_ZTSDIS,_H6,_H7,_EPS=0.001,_TOOLOFFN,_FAK1,_FAK2,_BRIMAX,_H3LINKS
DEF REAL _SDIS,_RAD1,_DP1,_FS,_SKF,_SKF1,_SKF2,_SKF3
DEF BOOL _ZB[12],_SOWZ,_GRUND,_RFP_AUF_AD=0
DEF STRING[30] _S_FFP1,_S_FFD
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_POCKET3_MPF",_SERR,_PROG
DEF STRING[141] _KNAME
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_POCKET3_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";Scaling factors: $P_ACTFRAME=CSCALE("<<AXSTRING($P_AXN1)<<","<<$P_ACTFRAME[$P_AXN1,SC]<<","<<AXSTRING($P_AXN2)<<","<<$P_ACTFRAME[$P_AXN2,SC]<<","<<AXSTRING($P_AXN3)<<","<<$P_ACTFRAME[$P_AXN3,SC]<<")")
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1]<<"  _ZSD[2]="<<_ZSD[2]<<"  _ZSD[3]="<<_ZSD[3]<<"  _ZSD[8]="<<_ZSD[8]<<"  _ZSD[9]="<<_ZSD[9])
WRITE(_TEMP,_TEMP_FILE,"POCKET3("<<_RTP<<","<<_RFP<<","<<__SDIS<<","<<__DP<<","<<__LENG<<","<<__WID<<","<<__CRAD<<","<<_PA<<","<<_PO<<","<<__STA<<","<<__MID<<","<<__FAL<<","<<__FALD<<","<<_FFP1<<","<<_FFD<<","<<__CDIR<<","<<__VARI<<","<<__MIDA<<","<<__AP1<<","<<__AP2<<","<<_AD<<","<<__RAD1<<","<<__DP1<<","<<_UMODE<<","<<__FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<__AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
DIAMCYCOF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_CDIR=__CDIR _VARI=__VARI _DP=__DP _LENG=__LENG _WID=__WID _CRAD=__CRAD _MID=__MID
_FAL=__FAL _FALD=__FALD _MIDA=__MIDA _AP1=__AP1 _AP2=__AP2 _ZFS=__ZFS _STA=__STA _AMODE=__AMODE
_SDIS=__SDIS _RAD1=__RAD1 _DP1=__DP1 _FS=__FS
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
_GMODE4=_GMODE _DEC4
_GMODE5=_GMODE _DEC5
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL47
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
GOTOF _FEHL47
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "F_PO_REC")AND(_PROG <> "E_PO_REC")AND(_PROG <> "E_SL_LON")AND(_PROG <> "F_SL_LON") )
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_GMODE4=1
_STA=0
_GMODE5=1
ENDIF
_RE_CYCFR=$P_CYCFRAME
IF(_SC_TOOL_VALI[0]<>0)
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF(_ARTIS[0] MOD 10 <>1)
GOTOF _FEHL15
ENDIF
_II=_ARTIS[0] DIV 10
IF((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL15
ELSE
_ARTIS[11]=_II MOD 10
IF(_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF(_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL15
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
_SOWZ=FALSE
IF $P_TOOL<=0
GOTOF _FEHL1
ENDIF
_WZR=$P_TOOLR _H1=$MN_SCALING_SYSTEM_IS_METRIC _I1=$P_GG[13]
IF(_I1>2) GOTOF _MY5316
IF((_H1-_I1)==-1) GOTOF _MY5316
IF(_H1<>1)
_WZR=_WZR*$MN_SCALING_VALUE_INCH
ELSE
_WZR=_WZR/$MN_SCALING_VALUE_INCH
ENDIF
_MY5316: _I1=$P_TOOL _FAL=ABS(_FAL) _CRAD=ABS(_CRAD) _FALD=ABS(_FALD)
IF (_WZR<=0) GOTOF _FEHL9 IF (_CRAD>ABS(_WID)/2) OR (_CRAD>ABS(_LENG)/2) GOTOF _FEHL10
IF(_LENG==0)OR(_WID==0) GOTOF _FEHL34
_SPIND=ABS(_VARI) _DEC3
IF(_SPIND>4) GOTOF _FEHL2
_STCCMA:
_H8=$P_TRAFO
IF ((_SPIND==2) AND (_H8 B_AND 'H1300') ) GOTOF _FEHL2
_VAR1=_VARI _DEC1
_VAR2=_VARI _DEC2
IF(_VAR1<0)OR(_VAR1==3)OR(_VAR1>5) GOTOF _FEHL2
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL18
IF(_HELIKAL)AND(_VAR1==5) GOTOF _FEHL2
IF ((_HELIKAL)AND(_VAR1==1))
IF ( (ABS(ABS(_LENG)-ABS(_WID))>_EPS)AND(_VAR2<>3) ) GOTOF _FEHL17
ENDIF
IF(_VAR1==1) AND (_GMODE5==2)
IF((_VAR2==0) OR (_VAR2==2) OR (_VAR2==3))
_FFD=_FFP1
ENDIF
ENDIF
IF(_VAR1==4)
_MIDA=2*_WZR
_FFD=_FFP1
ENDIF
IF(_VAR1==5)
_ANFAS=1
_VAR2=0
_VARI=_VAR1+_VAR2*10
ENDIF
IF(_VAR1==4)
_VAR2=0
_FALD=0
_VARI=_VAR1+_VAR2*10
ENDIF
IF(_VAR1==4)AND(_FAL<=0)
_SERR=<<"(UXY)"
GOTOF _FEHL45
ENDIF
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF(_SDIS<=0) GOTOF _FEHL16
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
_PA=$P_EP[_X]*_FAK1 _PO=$P_EP[_Y]*_FAK1
ELSE
GOTOF _FEHL27
ENDIF
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL21
IF NOT ($SCS_FUNCTION_MASK_MILL_SET B_AND 'H8')
IF ($P_ACTFRAME[_X,SC]<>$P_ACTFRAME[_Y,SC]) GOTOF _FEHL35
ENDIF
_SKF1=$P_ACTFRAME[_X,SC]
_SKF2=$P_ACTFRAME[_Y,SC]
_SKF3=$P_ACTFRAME[_Z,SC]
_SKF=MINVAL(_SKF1,_SKF2)
IF _VAR1<>5
_WZR=_WZR*1/_SKF
ELSE
IF (_SKF<>_SKF3) GOTOF _FEHL35
_FS=_FS*_SKF
ENDIF
_FAL=_FAL*1/_SKF
_FALD=_FALD*1/_SKF3
_MID=_MID*1/_SKF3
_RAD1=_RAD1*1/_SKF
_SDIS=_SDIS*1/_SKF3
_DP1=_DP1*1/_SKF3
_EINRAD=_EINRAD*1/_SKF
_MIDA=_SKF/MAXVAL(_SKF1,_SKF2)*_MIDA
IF (_AMODE _DEC2==0)
_MIDA=_MIDA*1/_SKF
ENDIF
IF(_ANFAS == 1)
_AMODE3=_AMODE _DEC3
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(_RTP==_RFP) GOTOF _FEHL11
_H1=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_ZFS)*_H1
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
_ZFS=ABS(_RFP-_ZFS) _AMODE3=1
ENDIF
_DP=_DP*1/_SKF3
IF(_ZZSD[1]==0)
_MID=_ZFS+_SDIS
ELSE
_MID=_ZFS
ENDIF
_MIDA=_FS _FALD=0 _FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_TOOLOFFN=$P_OFFN*_FAK2 _VARI=_VARI-3
ENDIF
_WZR=_WZR+_TOOLOFFN
IF(_VARI MOD 10 == 1)OR(_VARI MOD 10 == 2)AND(_ANFAS==0)
_AMODE2=_AMODE _DEC2
IF(_AMODE2<0)OR(_AMODE2>1) GOTOF _FEHL25
IF(_AMODE2==1)
IF(_MIDA<0)OR(_MIDA>100)
GOTOF _FEHL13
ELSE
_MIDA=_MIDA/100*(2*_WZR) _AMODE2=0
ENDIF
ENDIF
ENDIF
IF(_GMODE4<0)OR(_GMODE4>5) GOTOF _FEHL32
IF(_GMODE4==0)
IF(_ZSD[2]==-1)
_ZZSD[2]=0
ELSE
_ZZSD[2]=_ZSD[2]
IF(_ZSD[2]<0)OR(_ZSD[2]>1) GOTOF _FEHL32
ENDIF
IF(_ZSD[9]==-1)
_ZZSD[9]=0
ELSE
IF(_ZSD[9]<>0) GOTOF _FEHL33
_ZZSD[9]=0
ENDIF
ELSE
_LENG=ABS(_LENG) _WID=ABS(_WID)
CASE _GMODE4 OF 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 5 GOTOF _M5
_M1: _ZZSD[2]=0
GOTOF _MRE
_M2: _ZZSD[2]=1
GOTOF _MRE
_M3: _LENG=-_LENG _ZZSD[2]=1
GOTOF _MRE
_M4: _WID=-_WID _ZZSD[2]=1
GOTOF _MRE
_M5: _LENG=-_LENG _WID=-_WID _ZZSD[2]=1
GOTOF _MRE
_MRE:
_ZZSD[9]=0
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_PA*1/_FAK1,_Y,_PO*1/_FAK1)
IF(_ZZSD[2]==1)
IF(_ZZSD[9]==0)
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,_STA+_SC_WO)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_LENG/2,_Y,_WID/2)
ELSE
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,_SC_WO)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_LENG/2,_Y,_WID/2)
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,_STA)
ENDIF
ELSE
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,_STA+_SC_WO)
ENDIF
IF(ABS(_WID)>ABS(_LENG))
_H1=_LENG _LENG=_WID _WID=_H1
_H1=_AP1 _AP1=_AP2 _AP2=_H1
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,90)
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL46
ENDIF
_S_FFP1="G95 FZ="<<_FFP1
ELSE
_S_FFP1="G94 F"<<_FFP1
ENDIF
ENDIF
IF(_VAR1 _DEC1 == 4)OR(_VAR1 _DEC1 == 5)OR(_VAR2==2)OR(_VAR2==3)
_S_FFD=_S_FFP1
ELSE
IF(_DMODE _DEC2 == 0)
IF(_ZSD[3]==-1)OR(_ZSD[3]==0)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=1
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ELSE
IF(_DMODE _DEC2 == 1)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=11
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ENDIF
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_S_FFD="G95 F"<<_FFD
ELSE
IF(_FFD_TYPE==11)OR(_FFD_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL46
ENDIF
_S_FFD="G95 FZ="<<_FFD
ELSE
_S_FFD="G94 F"<<_FFD
ENDIF
ENDIF
ENDIF
IF(_VARI MOD 10 == 1)
IF(_GMODE5<0)OR(_GMODE5>2) GOTOF _FEHL31
IF(_GMODE5==1)
_AP1=0 _AD=0
ENDIF
IF ((_HELIKAL)AND(_GMODE5==2)AND(_AD>0))
_GMODE5_SAVE=_GMODE5 _GMODE5=1
ENDIF
ENDIF
IF(_ANFAS == 0)
_AMODE1=_AMODE _DEC1
IF(_AMODE1<0)OR(_AMODE1>1) GOTOF _FEHL24
IF(_AMODE1==1)
_DPINT=ABS(_DP)
IF(_DPINT==0) GOTOF _FEHL30
IF(_RTP==_RFP)
GOTOF _FEHL11
ELSE
_H1=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-_DPINT*_H1
_AMODE1=0
ENDIF
ENDIF
ENDIF
_I2=ABS(_VARI) _I1=_I2 MOD 10 _I2=((_I2-_I1) DIV 10) MOD 10
_I11=_I1
IF ((_I1<1)OR(_I1>5)OR(_I1==3)OR(_I2<0)OR(_I2>3)) GOTOF _FEHL2
IF(_I1==4)
_FALD=0
ENDIF
IF (_CDIR<0)OR(_CDIR>3) GOTOF _FEHL6 IF(_I2<1) GOTOF _MY1
_ZB[0]=1
IF _I2==1 GOTOF _MY1
_ZB[1]=1
IF _I2==2 GOTOF _MY1
_ZB[7]=1
_MY1: _I1=_I1-1
IF(_SOWZ==TRUE)
_ZB[2]=1
ELSE
_ZB[2]=_I1
ENDIF
IF(_FAL<>0)
_ZB[10]=1
ENDIF
IF(_FALD<>0)
_ZB[9]=1
ENDIF
IF ((ABS(_WID-_CRAD*2)<_EPS) OR (ABS(_LENG-_CRAD*2)<_EPS))
_ZB[11]=1
ENDIF
IF (_RTP==_RFP)AND(_DP==_RFP) GOTOF _FEHL11 IF _RTP==_RFP GOTOF _MY52 IF (_RFP==_DP) GOTOF _MY52 IF ((_RFP-_DP)/ABS(_RFP-_DP))<>((_RTP-_RFP)/ABS(_RTP-_RFP)) GOTOF _FEHL11
_MY52:
IF(_RFP-_DP<>0)
_H1=_RFP-_DP
ELSE
_H1=_RTP-_DP
ENDIF
_RFT=ABS(_H1)/_H1 _DPINT=_DP
_MIRR=$P_ACTFRAME[_X,MI]+$P_ACTFRAME[_Y,MI]
IF(_MIRR==1)
IF (_CDIR==0) OR (_CDIR==2) GOTOF _SPG1
_CDIR=_CDIR-1
GOTOF _SPG2
_SPG1: _CDIR=_CDIR+1
_SPG2:
ENDIF
IF(_RFT==-1)
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_Z,MI])
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF(_CDIR==2) GOTOF _MY3 IF(_CDIR<>3) GOTOF _MY2
_ZB[3]=1
GOTOF _MY3
_MY2:
IF($P_SMODE[0]==1) OR ($P_SMODE[0]==3)
_H1=$P_SDIR[$P_MSNUM]
IF(_H1<3)OR(_H1>4)
GOTOF _FEHL3
ENDIF
ELSE
GOTOF _FEHL3
ENDIF
IF(_H1<3)OR(_H1>4)
_ZB[3]=1
SETAL(62101)
GOTOF _MY3
ENDIF
IF (_CDIR==0)AND(_H1==4) GOTOF _MY3 IF (_CDIR==1)AND(_H1==3) GOTOF _MY3
_ZB[3]=1
_MY3:
IF(_SDIS<>0)
_SDZI=_SDIS
ENDIF
IF(_CRAD==0)
_CRAD=0.001/_WZMF
ENDIF
_LINT=ABS(_LENG)/2 _WINT=ABS(_WID)/2 _ERI=_CRAD
_MY5: _I1=$P_GG[13]
IF(_I1==2)OR(_I1==4) GOTOF _MY51
_WZMF=$MN_SCALING_VALUE_INCH _EINRAD=_EINRAD/_WZMF
IF(_SDIS<>0) GOTOF _MY51
_SDZI=_SDZI/_WZMF
_MY51:
IF(_FALD>ABS(_RFP-_DP))
IF(_ZZSD[1]==1)
_FALD=ABS(_RFP-_DP)
ELSE
_FALD=ABS(_RFP-_DP)+ABS(_SDIS)
ENDIF
ENDIF
IF _ZB[2]
IF _MID>=ABS(_RFP-_DP)
IF _ZZSD[1]==1
_MID=ABS(_RFP-_DP)
ELSE
_MID=ABS(_RFP-_DP)+ABS(_SDIS)
ENDIF
ENDIF
ELSE
IF _MID>=ABS(_RFP-_DP)-ABS(_FALD)
IF _ZZSD[1]==1
_MID=ABS(_RFP-_DP)-ABS(_FALD)
ELSE
_MID=ABS(_RFP-_DP)+ABS(_SDIS)-ABS(_FALD)
ENDIF
ENDIF
ENDIF
IF NOT (_ZB[2])
_LINT=_LINT-_FAL _WINT=_WINT-_FAL _ERI=_CRAD-_FAL _DPINT=_DP+_RFT*_FALD _ADZI=ABS(_RFP-_DPINT)-ABS(_AD)
IF(_ADZI<0)
_ADZI=0
ENDIF
ELSE
IF NOT _FAL
IF(_MIDA)
_FAL=_MIDA
ELSE
_FAL=1.6*_WZR
ENDIF
ENDIF
IF (NOT _FALD) AND (__VARI _DEC1<>4)
IF(_MID)
_FALD=_MID
ELSE
IF(ABS(_RFP-_DP)>2/_WZMF)
_FALD=2/_WZMF
ELSE
_FALD=ABS(_RFP-_DP)
ENDIF
ENDIF
ENDIF
ENDIF
IF NOT((_ANFAS==1) AND (_ZZSD[8]<>0))
IF((_WZR>_LINT)OR(_WZR>_WINT))
GOTOF _FEHL4
ENDIF
ENDIF
IF(_ERI>=_WZR) GOTOF _MY55
_ERI=_WZR
_MY55:
IF (_AP1<=0)OR(_AP1/2<_WZR)OR(_AP2/2<_WZR)OR(_AP2<=0)OR(_AD<=0)
_ZB[6]=1
ENDIF
_BRIMAX=1.707*_WZR
IF(_SPIND==2)
CUST_TECHCYC(3+_UMODE)
ENDIF
IF(_SPIND==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
IF (_ANFAS==1) GOTOF _MY60
IF ((((_WINT<=2*_WZR) AND (ABS(_ERI-_WINT)<_EPS)) OR ((_LINT<=2*_WZR) AND (ABS(_ERI-_LINT)<_EPS))) AND ((_MIDA>=_CRAD) OR ((_VARI MOD 10)==2))) OR (ABS(_WINT-_WZR)<_EPS) OR (ABS(_LINT-_WZR)<_EPS)
IF ( (_HELIKAL)AND(_VAR2<>3) )
GOTOF _FEHL17
ENDIF
IF(ABS(_LINT-_WZR)<_EPS) OR (ABS(_WINT-_WZR)<_EPS)
CPA=0 CPO=0
IF(_I11==1) AND (_ZB[9]==1)
_DP=_DP+_FALD
ENDIF
IF(_I2==2)
GOTOF _FEHL14
ENDIF
IF(_I2==3)
IF((_VARI DIV 10) MOD 10 == 3)
_H3=TAN(_RAD1)*(_LENG-_WZR*2)
IF(_H3<_MID)
_MID=_H3
ENDIF
ENDIF
ENDIF
IF(_SPIND==1)
_I2=_I2+100
ENDIF
IF(_SPIND==3)
_I2=_I2+300
ENDIF
IF _I2 _DEC1==0
_I2=_I2+1 _FFD=_FFP1
_DMODE=_DMODE _DEC1+10+1000
ENDIF
IF (_VARI _DEC1==4)
_FFD=_FFP1
_DMODE=_DMODE _DEC1+10+1000
ENDIF
_SDIS=_SDIS*_SKF3
_MID=_MID*_SKF3
_AMODE=2
_GMODE=100*(_GMODE _DEC3)
IF (_DMODE5==0)
_DMODE=_DMODE _DEC1+10*(_DMODE _DEC2)+1000
ELSE
_DMODE=_DMODE1+10*(_DMODE _DEC2)+1000
ENDIF
LONGHOLE(_RTP,_RFP,_SDIS,_DP,,1,_LENG,CPA,CPO,0,0,0,_FFD,_FFP1,_MID,_I2,_UMODE,_GMODE,_DMODE,_AMODE)
IF(_ZZSD[8]==1)
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_X,_SC_POS[0],_Y,_SC_POS[1],_Z,_SC_POS[2])
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
ENDIF
ELSE
CPA=0 CPO=0
IF(_SPIND==1)
_I2=_I2+100
ENDIF
IF(_SPIND==3)
_I2=_I2+300
ENDIF
_SDIS=_SDIS*_SKF3 _MID=_MID*_SKF3
_FAL=_FAL*_SKF _FALD=_FALD*_SKF3
_RAD1=_RAD1*_SKF _DP1=_DP1*_SKF3
_FS=_FS/_SKF
_GMODE=100*(_GMODE _DEC3)
_DMODE=_DMODE _DEC1+10*(_DMODE _DEC2)+1000+_DMODE5*10000
_AMODE=2+100*(_AMODE _DEC3)
SLOT1(_RTP,_RFP,_SDIS,_DP,0,1,_LENG,_WID,CPA,CPO,0,0,0,_FFD,_FFP1,_MID,__CDIR,_FAL,_VARI,0,0,0,_FALD,_RAD1,_DP1,_UMODE,_FS,_ZFS,_GMODE,_DMODE,_AMODE)
IF(_ZZSD[8]==1)
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_X,_SC_POS[0],_Y,_SC_POS[1],_Z,_SC_POS[2])
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
ENDIF
ENDIF
$P_CYCFRAME=_RE_CYCFR
GOTOF _RET_NOCYCFR
ENDIF
_MY60:
IF (_MIDA>2*_WZR)
IF NOT( (_ZB[2]==1) AND (_ZB[9]==0) AND (_ZB[10]==1) )
GOTOF _FEHL8
ENDIF
ENDIF
IF(((_SPIND==1)OR(_SPIND==3))AND(_I2>1)AND(_ZB[2]==0)) GOTOF _FEHL2
_MY61: _GT=ABS(_RFP-_DPINT) _AZ=1
IF(_ZZSD[1]) GOTOF _MQ1
_GT=_GT+ABS(_SDIS)
_MQ1: IF(_MID==0)OR(_GT==0) GOTOF _MQ2
_AZ=TRUNC(_GT/_MID)
IF(_MID*_AZ==_GT) GOTOF _MQ2
_AZ=_AZ+1
_MQ2: _ZT=_GT/_AZ _ZT=_ZT*_RFT
IF(_HELIKAL)
_AZ=1
IF(_VAR1==2)AND(_FALD<>0)
_AZ=2
ENDIF
ENDIF
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
_I1=1
SBLON
N110 G0 G90 AX[_Z]=_RTP
N120 NORM CFTCP AX[_X]=0 AX[_Y]=0
N130 AX[_Z]=_RFP+_RFT*_SDIS
SBLOF
_GG49=$P_GG[49]
CP
IF (_WINT<_WZR+_EINRAD)
IF (_ERI-_WZR)<_EINRAD
_EINRAD=(_ERI-_WZR)
ENDIF
ENDIF
IF (_ZB[2]) AND (_SOWZ==TRUE) GOTOF _MSL1
IF (_ZB[2]) AND (_AZ<>1) GOTOF _MSL1
IF (_ZB[2]) AND (_ZB[9]==0) GOTOF _MSL1
IF _ZB[2] GOTOF _SCHLICHTEND
_BRI=_MIDA _H2=_WZR+_EINRAD _PEA[2,0]=_LINT-_H2 _PEA[2,1]=-_I3*_H2
IF(_MIDA==0)
_BRI=_BRIMAX
ENDIF
_NXTIEF:_AT=_DPINT+((_AZ-_I1)*_ZT)
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ZB[6] GOTOF _SRV IF ABS(_AT-_DPINT)>=_ADZI GOTOF _SRROH
_ZB[6]=1
N700 G0 G90 AX[_X]=0 AX[_Y]=0
GOTOF _SRV
_SRROH: _H1=_LINT-_AP1/2
IF(_H1<0)
_H1=0 _AP1=_LINT*2
ENDIF
IF(_H1<_WINT-_AP2/2)
_H1=_WINT-_AP2/2
ELSE
IF(_WINT-_AP2/2<0)
_AP2=_WINT*2
ENDIF
ENDIF
_SRR1: IF NOT _H1 GOTOF _END1
IF ((_MIDA>0) AND (_MIDA<_BRIMAX))
_BRI=_MIDA
ELSE
_BRI=_BRIMAX
ENDIF
_AZB=TRUNC(_H1/_BRI) _I3=1
IF(_BRI*_AZB==_H1) GOTOF _MY90
_AZB=_AZB+1
_MY90: _I2=1 _BRIX=(_LINT-_AP1/2)/_AZB _BRIY=(_WINT-_AP2/2)/_AZB _BRI=_H1/_AZB _H2=_WZR+_EINRAD
IF ((_ERI>_WZR) AND ( TRUNC(_ERI/_BRI)==_AZB))
_BRIMAX=1.414*_WZR + 0.293*_BRI
ENDIF
IF(_BRI>_BRIMAX)
GOTOF _FEHL13
ENDIF
IF NOT(_ZB[3]) GOTOF _MY92
_I3=-1
_MY92: _PEA[0,0]=_AP1/2 _PEA[0,1]=0 _PEA[1,0]=_PEA[0,0]-_H2 _PEA[1,1]=_PEA[0,1]+_I3*_H2
_PEA[2,0]=_LINT-_H2 _PEA[2,1]=_PEA[0,1]-_I3*_H2
IF(_HELIKAL)
SBLON
N4010 G0 AX[_Z]=_RFP+_RFT*_SDIS
N4020 G0 AX[_X]=_PEA[0,0]-_WZR AX[_Y]=_PEA[0,1]
N4030 G1 AX[_Z]=_RFP
SBLOF
N4040 CONTDCON(_KTS)
N4050 G1 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1]
GOTOF _NXRU
ENDIF
IF NOT(_ZB[3])
SBLON
N400 G0 G42 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N403 G0 AX[_Z]=_AT+_RFT*_SDZI
SBLOF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFD)
N405 G1 AX[_Z]=_AT
EXECSTRING(_S_FFP1)
N408 G2 G[10]=_GG10 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ELSE
SBLON
N400 G0 G41 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N403 G0 AX[_Z]=_AT+_RFT*_SDZI
SBLOF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFD)
N405 G1 AX[_Z]=_AT
EXECSTRING(_S_FFP1)
N408 G3 G[10]=_GG10 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
_NXRU:
_RURA=_ERI-_BRI*(_AZB+1-_I2)
IF(_RURA<=_WZR+0.001/_WZMF)
_RURA=0
ENDIF
IF (_ZB[11]==1) AND (_I2>_AZB)
IF(_RURA<>0)
N410 G1 AX[_Y]=0
N412 AX[_Y]=-_I3*(_AP2/2+_BRIY*(_I2-1)) RND=_RURA
IF (ABS( _AP2/2+_BRIY*(_I2-1) )==_RURA)
IF(_ZB[3]==0)
N416 G90 AX[_X]=-_AP1/2-_BRIX*(_I2-1)+_RURA
N421 G2 AX[_Y]=_I3*(_AP2/2+_BRIY*(_I2-1)) CR=_RURA
ELSE
N416 G90 AX[_X]=-_AP1/2-_BRIX*(_I2-1)+_RURA
N421 G3 AX[_Y]=_I3*(_AP2/2+_BRIY*(_I2-1)) CR=_RURA
ENDIF
ELSE
N415 G90 AX[_X]=-_AP1/2-_BRIX*(_I2-1) RND=_RURA
N420 AX[_Y]=_I3*(_AP2/2+_BRIY*(_I2-1)) RND=_RURA
ENDIF
ENDIF
ELSE
IF _RURA<>0
IF (_I2>_AZB)
N4100 G1 AX[_Y]=0
ENDIF
N4101 G1 AX[_Y]=-_I3*(_AP2/2+_BRIY*(_I2-1)) RND=_RURA
N4151 AX[_X]=-_AP1/2-_BRIX*(_I2-1) RND=_RURA
N4201 AX[_Y]=_I3*(_AP2/2+_BRIY*(_I2-1)) RND=_RURA
ELSE
IF (_I2>_AZB)
N4102 G1 AX[_Y]=0
ENDIF
N4103 G1 AX[_Y]=-_I3*(_AP2/2+_BRIY*(_I2-1))
N4153 AX[_X]=-_AP1/2-_BRIX*(_I2-1)
N4203 AX[_Y]=_I3*(_AP2/2+_BRIY*(_I2-1))
ENDIF
IF(_HELIKAL)
IF(_I2<=_AZB)
IF (_RURA<>0)
N4401 G1 AX[_X]=_AP1/2+_BRIX*(_I2-1) RND=_RURA
ELSE
N4402 G1 AX[_X]=_AP1/2+_BRIX*(_I2-1)
ENDIF
N4403 G1 AX[_Y]=0
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
IF NOT(_ZB[3])
N4300 G2 AX[_X]=IC(-_H2) AX[_Y]=IC(-_H2) CR=_H2
N4310 G1 G40 AX[_X]=IC(0) AX[_Y]=IC(_WZR)
ELSE
N4300 G3 AX[_X]=IC(-_H2) AX[_Y]=IC(_H2) CR=_H2
N4310 G1 G40 AX[_X]=IC(0) AX[_Y]=IC(-_WZR)
ENDIF
N4410 G0 AX[_Z]=_RFP+_RFT*_SDIS
N4420 G0 AX[_Y]=0
N4430 G0 AX[_X]=_AP1/2+_BRIX*_I2-_WZR
N4440 G1 AX[_Z]=_RFP
N4450 CONTDCON(_KTS)
N4460 G1 AX[_X]=_AP1/2+_BRIX*_I2 AX[_Y]=0
_I2=_I2+1
GOTOB _NXRU
ENDIF
ENDIF
ENDIF
IF(_I2<=_AZB) GOTOF _NRU
IF(_RURA<>0)
N425 G1 AX[_X]=_LINT RND=_RURA
ELSE
N425 G1 AX[_X]=_LINT
ENDIF
N427 G1 AX[_Y]=0
IF(_HELIKAL)
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
ENDIF
IF NOT(_ZB[3])
N430 G2 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H2
ELSE
N430 G3 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H2
ENDIF
N431 G1 G40 AX[_X]=_PEA[2,0] AX[_Y]=-_I3*(_H2-_WZR)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
SBLON
N433 G0 G91 AX[_Z]=_RFT*_SDZI
SBLOF
N435 G90 G40 AX[_X]=_PEA[1,0] AX[_Y]=0
GOTOF _END1
_NRU: _RURA=_ERI-_BRI*(_AZB-_I2)
IF(_RURA<=_WZR+0.001/_WZMF)
_RURA=0
ENDIF
IF _RURA<>0
N440 AX[_X]=_AP1/2+_I2*_BRIX RND=_RURA
ELSE
N440 AX[_X]=_AP1/2+_I2*_BRIX
ENDIF
_I2=_I2+1
GOTOB _NXRU
_SRV: _H1=_WINT-_WZR
IF ((_MIDA>0) AND (_MIDA<_BRIMAX))
_BRI=_MIDA
ELSE
_BRI=_BRIMAX
ENDIF
_AZB=TRUNC(_H1/_BRI) _I3=-1
IF(_BRI*_AZB<>_H1)
_AZB=_AZB+1
ENDIF
IF(_HELIKAL)
_AZB=_AZB+1
ENDIF
_BRI=_H1/_AZB
IF ((_ERI>_WZR) AND ( TRUNC(_ERI/_BRI)==_AZB))
_BRIMAX=1.414*_WZR + 0.293*_BRI
ENDIF
IF(_BRI>_BRIMAX)
GOTOF _FEHL13
ENDIF
_I2=1 _RURA=0 _H3=(_AZB-1)*_BRI
IF ((_BRI>_WZR) AND (NOT(_AZB==1)))
_H3=_H3-(_BRI-_WZR)
ENDIF
IF (_BRI>_WZR)
_H3LINKS=_BRI-_WZR
ELSE
_H3LINKS=0
ENDIF
IF _ZB[3] GOTOF _MY84
_I3=1
_MY84:
IF(_HELIKAL)
_AT=_DPINT
_ZT=_GT
IF ((_GMODE5_SAVE==2)AND((_AP1/2)>(_LINT-(_AZB-_I2)*_BRI)))
_RFP_AUF_AD=1 _ZT=_ZT-_ADZI-_FALD
SBLON
N131 G0 AX[_Z]=_RFP-(_AD-_SDZI)*_RFT
SBLOF
ENDIF
IF ((_VAR1==2)OR((_VAR1==1)AND(_VAR2==0)))
GOTOF _SEB
ENDIF
ENDIF
IF _ZB[1] GOTOF _ZUBAHN
IF (((_SPIND==1)OR(_SPIND==3))AND(_ZB[2]==0))
CUST_TECHCYC(3+_UMODE)
ENDIF
IF (_ZB[2] OR _ZB[0]) GOTOF _ZBG1
SBLON
N150 G0 AX[_Z]=_AT+_RFT*_SDZI
SBLOF
_ZBG1:
IF(_ZB[0]==0)
EXECSTRING(_S_FFP1)
ELSE
EXECSTRING(_S_FFD)
ENDIF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N152 G1 AX[_Z]=_AT
IF ((_SPIND==1)AND(_ZB[2]==0))
CUST_TECHCYC(4+_UMODE)
ENDIF
IF ((_SPIND==3)AND(_ZB[2]==0))
CUST_TECHCYC(403+_UMODE)
ENDIF
GOTOF _SEB
_ZUBAHN:
IF (_ZZSD[1]==0)
_ZTSDIS=ABS(_ZT)
ELSE
_ZTSDIS=ABS(_ZT)+_SDIS
ENDIF
IF (_RAD1<=0) GOTOF _FEHL5 IF _ZB[7] GOTOF _ZPEN IF (_DP1<=0) GOTOF _FEHL5 IF ABS(_ZTSDIS)>=ABS(_DP1) GOTOF _MQ34
_I4=1
GOTOF _HELRAD
_MQ34:
IF(_ZZSD[1]==1)
_I4=TRUNC(ABS(_ZT)/_DP1)
IF((_DP1*_I4)<>_ZT)
_I4=_I4+1
ENDIF
ELSE
_I4=TRUNC(ABS(_ZTSDIS)/_DP1)
IF((_DP1*_I4)<>_ZTSDIS)
_I4=_I4+1
ENDIF
ENDIF
_HELRAD:_H4=_RAD1
IF(_RAD1<_WZR) GOTOF _FALL2
_H4=_WZR
_FALL2: IF _H4+_WZR<_WINT GOTOF _FALL3
_H4=_WINT-_WZR
IF(_H4==0) GOTOF _FEHL4
GOTOF _HELBAHN
_FALL3: IF _H4==_RAD1 GOTOF _HELBAHN
_FALL3NEU: IF ABS(_ZT)/_I4/_H4<_DP1/_RAD1 GOTOF _HELBAHN
_I4=_I4+1
GOTOB _FALL3NEU
_HELBAHN:
N150 G0 G40 G90 AX[_X]=_H4
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
IF(((_ZZSD[1]==1) AND (_I1==1)) OR ((_ZZSD[1]==0) AND (_VAR1==2) AND (_I1==1)))
IF(_SDIS<>0)
_I14=TRUNC(ABS(_SDIS)/_DP1)
IF((_DP1*_I14)<>_SDIS)
_I14=_I14+1
ENDIF
IF NOT(_ZB[3])
N1160 G91 G2 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_SDIS*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I14-1
ELSE
N1160 G91 G3 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_SDIS*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I14-1
ENDIF
ENDIF
ENDIF
IF ((_VARI MOD 10)==1)
IF ((_AP1==_LINT*2)AND(_AP2==_WINT*2)AND(_AD<_GT)AND(_ZB[6]==1))
N155 G1 AX[_Z]=_AT+_ZT+_SDZI*_RFT
ENDIF
ENDIF
IF(_I1>1)
N160 G1 G[10]=_GG10 G91 AX[_Z]=-_RFT*_SDZI
ENDIF
IF (_I4>0)
IF NOT(_ZB[3])
N170 G91 G2 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_ZT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I4-1
ELSE
N170 G91 G3 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_ZT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I4-1
ENDIF
ENDIF
N190 G91 AX[_X]=0 AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
N195 G1 G90 AX[_X]=0
GOTOF _SEB
_ZPEN:
IF (_RFP_AUF_AD)
_H4=_LINT-(_AZB-_I2)*_BRI-_WZR
ELSE
_H4=_LINT-_WINT
ENDIF
_I3=1
IF(_H4<_BRI)
_H4=_BRI
ENDIF
IF ((_VARI MOD 10)==1)
IF ((_AP1==_LINT*2)AND(_AP2==_WINT*2)AND(_AD<_GT)AND(_ZB[6]==1))
EXECSTRING(_S_FFP1)
N1550 G1 AX[_Z]=_AT+_ZT+_SDZI*_RFT
ENDIF
ENDIF
_H5=ABS(TAN(_RAD1))*2*_H4
IF ABS(_ZT)>ABS(_H5) GOTOF _ZP05
_I4=1
GOTOF _ZP10
_ZP05: _I4=TRUNC(ABS(_ZT)/_H5)
IF(_H5*_I4==ABS(_ZT)) GOTOF _ZP10
_I4=_I4+1
_ZP10: _H5=_ZT/_I4
IF (_I4 MOD 2)<>1
N150 G0 G90 AX[_X]=-_H4
ELSE
N150 G0 G90 AX[_X]=_H4
_I3=-_I3
ENDIF
EXECSTRING(_S_FFP1)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF((_ZZSD[1]==1) AND (_I1==1))
_H15=ABS(TAN(_RAD1))*2*_H4
_ZTP=_SDZI*_RFT+_ZT
IF ABS(_ZTP)>ABS(_H15) GOTOF _ZPP05
_I14=1
GOTOF _ZPP10
_ZPP05: _I14=TRUNC(ABS(_ZTP)/_H15)
IF(_H15*_I14==ABS(_ZT)) GOTOF _ZPP10
_I14=_I14+1
_ZPP10:_H15=_ZTP/_I14
_ZPPNEXT:
N1161 G1 G91 AX[_X]=_I3*_H4*2 AX[_Z]=-_H15
_I3=-_I3 _I14=_I14-1
IF(_I14>0) GOTOB _ZPPNEXT
ENDIF
IF(_I1>1)
N1162 G1 G[10]=_GG10 G91 AX[_Z]=-_RFT*_SDZI
ENDIF
IF((_ZZSD[1]==1) AND (_I1==1)) GOTOF _M6201
_ZPNEXT: _H6=_AT+_H5*(_I4-1) _H7=$P_EP[_X]+_I3*_H4*2
N161 G1 G90 AX[_X]=_H7 AX[_Z]=_H6
_I3=-_I3 _I4=_I4-1
IF(_I4>0) GOTOB _ZPNEXT
_M6201:
IF (_HELIKAL)
G1 G[10]=_GG10 G40 G90 AX[_X]=$P_EP[_X]+_I3*_H4*2
ENDIF
IF(_I1==_AZ)
ENDIF
IF (_ZB[3])
_I3=-1
ELSE
_I3=1
ENDIF
_SEB:
EXECSTRING(_S_FFP1)
IF(_HELIKAL)
IF(_VAR1==2)AND(_FALD<>0)AND(_AZ==2)AND(_I1==2)
_HELIKAL=0
_GRUND=1
_I3=-_I3
IF(_ZB[3])
_ZB[3]=0
ELSE
_ZB[3]=1
ENDIF
N3040 CONTDCON(_KTS)
N3045 G1 AX[_X]=-_LINT+(_AZB)*_BRI AX[_Y]=_WZR
N3050 G1 AX[_X]=_LINT-(_AZB-1)*_BRI AX[_Y]=_WZR
GOTOF _NXR
ENDIF
IF (_RFP_AUF_AD)
_RFPH=_RFP-_AD*_RFT
ELSE
_RFPH=_RFP
ENDIF
N3060 G0 AX[_Z]=_RFPH+_RFT*_SDIS
N3070 G0 AX[_X]=_LINT-(_AZB-1)*_BRI-_WZR AX[_Y]=0
IF (_ZZSD[1]==1)
N3080 G1 AX[_Z]=_RFPH
ENDIF
GOTOF _NXR
ENDIF
N304 _SEB0: G1 G[10]=_GG10 G40 G90 AX[_X]=-(_LINT+_H3LINKS)+_WINT
_H4=_LINT-_WINT
IF _ZB[3] GOTOF _ANFG3
IF(_RURA<>0)
N305 G1 G42 G[10]=_GG10 AX[_X]=_LINT-_H3 RND=_RURA
ELSE
N305 G1 G42 G[10]=_GG10 AX[_X]=_LINT-_H3
ENDIF
GOTOF _NXR
_ANFG3:
IF(_RURA<>0)
N305 G1 G41 G[10]=_GG10 AX[_X]=_LINT-_H3 RND=_RURA
ELSE
N305 G1 G41 G[10]=_GG10 AX[_X]=_LINT-_H3
ENDIF
_NXR: _H1=_H1-_BRI _RURA=_ERI-_H1
IF(_HELIKAL)
N3000 CONTDCON(_KTS)
N3070 G1 AX[_X]=_LINT-(_AZB-_I2)*_BRI AX[_Y]=0
ENDIF
IF (_RURA<_WZR+0.001/_WZMF) OR ( (_RURA>(_I2*_BRI+_WZR)) AND (_ZB[11]==0) )
_RURA=0
ENDIF
IF (_I2==_AZB) AND (_ZB[2])
CFC
ENDIF
IF (_ZB[11]==1) AND (_I2==_AZB)
IF(_RURA<>0)
IF (ABS (_I2*_BRI+_WZR )==_RURA)
IF _ZB[3]==0
IF (NOT ( (ABS($P_EP[_X]-_LINT)<0.001) AND (ABS($P_EP[_Y])<_EPS)))
N310 G2 AX[_X]=_LINT AX[_Y]=0 CR=(_RURA-_BRI)
ENDIF
N311 G2 AX[_X]=_LINT-_RURA AX[_Y]=-_I3*(_I2*_BRI+_WZR) CR=_RURA
N312 G1 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI)+_RURA
N313 G2 AX[_Y]=_I3*(_I2*_BRI+_WZR) CR=_RURA
ELSE
IF (NOT ( (ABS($P_EP[_X]-_LINT)<0.001) AND (ABS($P_EP[_Y])<_EPS)))
N314 G3 AX[_X]=_LINT AX[_Y]=0 CR=(_RURA-_BRI)
ENDIF
N315 G3 AX[_X]=_LINT-_RURA AX[_Y]=-_I3*(_I2*_BRI+_WZR) CR=_RURA
N316 G1 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI)+_RURA
N317 G3 AX[_Y]=_I3*(_I2*_BRI+_WZR) CR=_RURA
ENDIF
ELSE
N320 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI) RND=_RURA
N321 AX[_Y]=_I3*(_I2*_BRI+_WZR) RND=_RURA
ENDIF
ENDIF
ELSE
IF(_RURA<>0)
IF ((_ZB[11]==1) AND (ABS (_I2*_BRI+_WZR )==_RURA) AND (NOT(_I2==1)))
IF(_ZB[3]==0)
N330 G2 AX[_Y]=-_I3*(_I2*_BRI+_WZR) CR=(2*_I2-1)*_BRI/2+_WZR
N331 G1 G90 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI)+_RURA
N332 G2 AX[_Y]=_I3*(_I2*_BRI+_WZR) CR=_RURA
ELSE
N335 G3 AX[_Y]=-_I3*(_I2*_BRI+_WZR) CR=(2*_I2-1)*_BRI/2+_WZR
N336 G1 G90 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI)+_RURA
N337 G3 AX[_Y]=_I3*(_I2*_BRI+_WZR) CR=_RURA
ENDIF
N340 G1
ELSE
IF (_ZB[11]==1)
N344 AX[_Y]=-_I3*(_I2*_BRI+_WZR)
N345 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI)
N346 AX[_Y]=_I3*(_I2*_BRI+_WZR)
ELSE
N347 AX[_Y]=-_I3*(_I2*_BRI+_WZR) RND=_RURA
N348 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI) RND=_RURA
N349 AX[_Y]=_I3*(_I2*_BRI+_WZR) RND=_RURA
ENDIF
ENDIF
ELSE
N350 AX[_Y]=-_I3*(_I2*_BRI+_WZR)
N351 AX[_X]=-(_LINT-(_AZB-_I2)*_BRI)
N352 AX[_Y]=_I3*(_I2*_BRI+_WZR)
ENDIF
ENDIF
IF(_HELIKAL)
IF(_I2==_AZB) GOTOF _LRU
IF(_RURA<>0)
N3480 G1 AX[_X]=_LINT-(_AZB-_I2)*_BRI RND=_RURA
N3470 G1 AX[_Y]=0
ELSE
N3560 G1 AX[_X]=_LINT-(_AZB-_I2)*_BRI
N3500 G1 AX[_Y]=0
ENDIF
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
IF NOT(_ZB[3])
N3660 G2 AX[_X]=IC(-_H2) AX[_Y]=-_I3*_H2 CR=_H2
ELSE
N3670 G3 AX[_X]=IC(-_H2) AX[_Y]=-_I3*_H2 CR=_H2
ENDIF
N3670 G1 G40 AX[_X]=IC(0) AX[_Y]=-_I3*(_H2-_WZR)
N1300 G0 AX[_Z]=_RFPH+_RFT*_SDIS
IF((_H1-_BRI)<(_AP1/2))
_RFP_AUF_AD=0 _RFPH=_RFP
N1301 G0 AX[_Z]=_RFPH+_RFT*_SDIS
ENDIF
N1310 G0 AX[_Y]=0
N3550 G0 AX[_X]=_LINT-(_AZB-_I2-1)*_BRI-_WZR
IF (_ZZSD[1]==1)
N3560 G1 AX[_Z]=_RFPH
ENDIF
ENDIF
IF(_I2==_AZB) GOTOF _LRU IF (_ERI-_H1+_BRI)>(_I2*_BRI+_WZR) GOTOF _NX1 IF (_ERI-_H1+_BRI)<(_WZR+0.001/_WZMF) GOTOF _NX1
_RURA=_ERI-_H1+_BRI
_NX1:
IF(_HELIKAL) GOTOF _SKIP1
IF(_RURA<>0)
IF ((_ZB[11]==1))
N354 G1 AX[_X]=_LINT-(_AZB-_I2-1)*_BRI-_RURA
ELSE
N355 G1 AX[_X]=_LINT-(_AZB-_I2-1)*_BRI RND=_RURA
ENDIF
ELSE
N356 G1 AX[_X]=_LINT-(_AZB-_I2-1)*_BRI
ENDIF
_SKIP1:
_I2=_I2+1
IF(_I2<=_AZB) GOTOB _NXR
_LRU:
IF NOT(_ZB[11]==1)
IF(_RURA<>0)
N360 G1 AX[_X]=_LINT RND=_RURA
ELSE
N361 G1 AX[_X]=_LINT
ENDIF
N362 AX[_Y]=0
ELSE
N363 G1 AX[_X]=_LINT-_RURA
IF(_ZB[3]==0)
N364 G2 AX[_X]=_LINT AX[_Y]=0 CR=_RURA
ELSE
N365 G3 AX[_X]=_LINT AX[_Y]=0 CR=_RURA
ENDIF
ENDIF
IF(_GRUND)
IF(_ZB[3])
N5750 G1 AX[_X]=_PEA[0,0]+_ERI AX[_Y]=_PEA[0,1]-_ERI
N5400 G3 AX[_X]=IC(-_ERI) AX[_Y]=IC(_ERI) CR=_ERI
ELSE
N5750 G1 AX[_X]=-_PEA[0,0]+_ERI AX[_Y]=-_PEA[0,1]+_ERI
N5400 G2 AX[_X]=IC(-_ERI) AX[_Y]=IC(-_ERI) CR=_ERI
ENDIF
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
N369 G1 G40 G90 AX[_Y]=IC(_I3*_WZR)
GOTOF _SKIP_AB
ENDIF
IF(_HELIKAL)
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
ENDIF
IF NOT(_ZB[3])
N366 G2 AX[_X]=_PEA[2,0] AX[_Y]=-_I3*_H2 CR=_H2
ELSE
N367 G3 AX[_X]=_PEA[2,0] AX[_Y]=-_I3*_H2 CR=_H2
ENDIF
N367 G1 G40 AX[_X]=_PEA[2,0] AX[_Y]=-_I3*(_H2-_WZR)
_SKIP_AB:
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF (_AZ==1)OR (_I1==_AZ) GOTOF _FINE
SBLON
N368 G0 G91 AX[_Z]=_RFT*_SDZI
SBLOF
IF(_ZB[1]==0)
N370 G0 G90 G40 AX[_X]=0 AX[_Y]=0
ELSE
N371 G0 G90 G40 AX[_X]=_H4 AX[_Y]=0
ENDIF
_END1: _I1=_I1+1
IF (_ZB[2]) AND (_ZB[10]==0) GOTOF _FINE IF _I1<=_AZ GOTOB _NXTIEF
GOTOF _FINE
_MSL1: IF (_FALD>_MID) AND (_SOWZ==FALSE) GOTOF _FEHL7
_EINRAD=2/_WZMF
IF (_ERI-_WZR)>=_EINRAD GOTOF _MY74
IF (_WZR+_FAL+_EINRAD)<=_WINT GOTOF _MY74
IF (_WINT-_WZR-_FAL)>=0
_EINRAD=_WINT-_FAL-_WZR
ELSE
GOTOF _FEHL4
ENDIF
_MY74: _H1=1
IF NOT _ZB[3] GOTOF _MSL3
_H1=-1
_MSL3: _H2=_WZR+_FAL+_EINRAD _PEA[0,0]=_H1*(_LINT-_ERI) _PEA[0,1]=_WINT _I3=0
IF (_H2<_WINT) GOTOF _MSL31
_H2=_WINT
_MSL31:IF ((_LINT-_WZR-_FAL)>=1/_WZMF) AND ((_WINT-_WZR-_FAL)>=1/_WZMF) GOTOF _MSL4
_I3=1
_MSL4:
IF(_ERI>_H2)
_PEA[1,0]=_PEA[0,0]-_H1*_ERI _PEA[1,1]=_PEA[0,1]-_ERI
ELSE
_PEA[1,0]=_PEA[0,0]-_H1*_H2 _PEA[1,1]=_PEA[0,1]-_H2
ENDIF
_H5=_WZR+_EINRAD
IF NOT (_H5<_ERI)
_H5=_ERI
ENDIF
_PEA[2,0]=_PEA[0,0]+_H1*_H5 _PEA[2,1]=_PEA[0,1]-_H5
_ANFSZ: _AT=_DPINT+(_AZ-_I1)*_ZT
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ENDIF
ENDIF
IF(_ZB[10]==0)
_AT=_DPINT _ZT=_ZT*_AZ
GOTOF _SCHLICHTEND
ENDIF
N529 CFC
IF (_ZB[2]) AND (_ZB[9]==0) GOTOF _ANFSZ1
IF (ABS(_AT-_DPINT)>=_FALD) GOTOF _ANFSZ1
_AT=_DPINT+_FALD*_RFT _ZT=_FALD*_RFT
_ANFSZ1:
IF(_SOWZ==TRUE)
_AT=_DPINT
ENDIF
IF(_HELIKAL)
N5200 G0 AX[_Z]=_RFP+_RFT*_SDIS
EXECSTRING(_S_FFP1)
GOTOF _NEXT1
ENDIF
IF ((_I3==0) AND (ABS(_AT-_DPINT)>_FALD)) OR (_ANFAS==1)
N520 G90 G0 AX[_Z]=_AT
ELSE
IF _I3==1
EXECSTRING(_S_FFP1)
N521 G90 G1 AX[_Z]=_AT
ELSE
N521 G90 G0 AX[_Z]=_AT+_RFT*_SDZI
ENDIF
ENDIF
_NEXT1:
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
IF NOT(_ZB[3])
IF(_HELIKAL)
N5300 G0 G[10]=_GG10 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1]-_WZR
IF (_ZZSD[1]==1)
N5310 G1 AX[_Z]=_RFP
ENDIF
N5320 CONTDCON(_KTS)
N5330 G1 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1]
GOTOF _NEXT2
ENDIF
IF _I3==1
N530 G1 G[10]=_GG10 G42 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
ELSE
N530 G0 G[10]=_GG10 G42 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N531 G1 G90 AX[_Z]=_AT
ENDIF
IF(_H2<_ERI)
N535 G2 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_ERI
ELSE
N535 G2 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
N540 G2 G91 AX[_X]=_ERI AX[_Y]=-_ERI CR=_ERI
N545 G1 AX[_Y]=-2*(_WINT-_ERI)
N550 G2 AX[_X]=-_ERI AX[_Y]=-_ERI CR=_ERI
N555 G1 AX[_X]=-2*(_LINT-_ERI)
N560 G2 AX[_X]=-_ERI AX[_Y]=_ERI CR=_ERI
N565 G1 AX[_Y]=2*(_WINT-_ERI)
N570 G2 AX[_X]=_ERI AX[_Y]=_ERI CR=_ERI
N575 G1 AX[_X]=2*(_LINT-_ERI)
_NEXT2:
IF(_HELIKAL)
N540 G2 AX[_X]=IC(_ERI) AX[_Y]=IC(-_ERI) CR=_ERI
N545 G1 AX[_Y]=IC(-2*(_WINT-_ERI))
N550 G2 AX[_X]=IC(-_ERI) AX[_Y]=IC(-_ERI) CR=_ERI
N555 G1 AX[_X]=IC(-2*(_LINT-_ERI))
N560 G2 AX[_X]=IC(-_ERI) AX[_Y]=IC(_ERI) CR=_ERI
N565 G1 AX[_Y]=IC(2*(_WINT-_ERI))
N570 G2 AX[_X]=IC(_ERI) AX[_Y]=IC(_ERI) CR=_ERI
N575 G1 AX[_X]=IC(2*(_LINT-_ERI))
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
IF(_FALD<>0)AND(_AZ==2) GOTOF _SKIP_G2
ENDIF
IF NOT(_H5<_ERI)
N580 G2 G90 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_ERI
ELSE
N580 G2 G90 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H5
ENDIF
_SKIP_G2:
ELSE
IF(_HELIKAL)
N5300 G0 G[10]=_GG10 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1]-_WZR
IF (_ZZSD[1]==1)
N5310 G1 AX[_Z]=_RFP
ENDIF
N5320 CONTDCON(_KTS)
N5330 G1 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1]
GOTOF _NEXT3
ENDIF
IF _I3==1
N530 G1 G[10]=_GG10 G41 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
ELSE
N530 G0 G[10]=_GG10 G41 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N531 G1 G90 AX[_Z]=_AT
ENDIF
IF(_H2<_ERI)
N535 G3 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_ERI
ELSE
N535 G3 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
N540 G3 G91 AX[_X]=-_ERI AX[_Y]=-_ERI CR=_ERI
N545 G1 AX[_Y]=-2*(_WINT-_ERI)
N550 G3 AX[_X]=_ERI AX[_Y]=-_ERI CR=_ERI
N555 G1 AX[_X]=2*(_LINT-_ERI)
N560 G3 AX[_X]=_ERI AX[_Y]=_ERI CR=_ERI
N565 G1 AX[_Y]=2*(_WINT-_ERI)
N570 G3 AX[_X]=-_ERI AX[_Y]=_ERI CR=_ERI
N575 G1 AX[_X]=-2*(_LINT-_ERI)
_NEXT3:
IF(_HELIKAL)
N540 G3 AX[_X]=IC(-_ERI) AX[_Y]=IC(-_ERI) CR=_ERI
N545 G1 AX[_Y]=IC(-2*(_WINT-_ERI))
N550 G3 AX[_X]=IC(_ERI) AX[_Y]=IC(-_ERI) CR=_ERI
N555 G1 AX[_X]=IC(2*(_LINT-_ERI))
N560 G3 AX[_X]=IC(_ERI) AX[_Y]=IC(_ERI) CR=_ERI
N565 G1 AX[_Y]=IC(2*(_WINT-_ERI))
N570 G3 AX[_X]=IC(-_ERI) AX[_Y]=IC(_ERI) CR=_ERI
N575 G1 AX[_X]=IC(-2*(_LINT-_ERI))
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
IF(_FALD<>0)AND(_AZ==2) GOTOF _SKIP_G3
ENDIF
IF NOT(_H5<_ERI)
N580 G3 G90 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_ERI
ELSE
N580 G3 G90 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H5
ENDIF
_SKIP_G3:
ENDIF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_HELIKAL)
IF(_FALD==0)OR(_AZ==1)
N5850 G0 AX[_Z]=_RFP+_RFT*_SDIS
ENDIF
GOTOF _SKIP2
ENDIF
SBLON
N585 G0 G91 AX[_Z]=_RFT*_SDZI
SBLOF
N590 G0 G90 G40 AX[_X]=_PEA[1,0]+_WZR*_H1 AX[_Y]=_PEA[1,1]
_SKIP2:
_I1=_I1+1
IF(_SOWZ==TRUE) GOTOF _FINE
IF(_I1<_AZ) GOTOB _ANFSZ
IF (_I1==_AZ) AND (_ZB[9]==0)
_AT=_DP
GOTOB _ANFSZ1
ENDIF
IF (_I1>_AZ) AND (_ZB[9]==0) GOTOF _FINE
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ENDIF
ENDIF
IF(_HELIKAL)AND(_FALD<>0)AND(_AZ==2)
IF NOT(_ZB[3])
N566 G1 G40 G90 CFTCP AX[_Y]=IC(-_WZR)
ELSE
N576 G1 G40 G90 CFTCP AX[_Y]=IC(-_WZR)
ENDIF
GOTOF _SCHLICHTEND
ENDIF
N600 G0 G40 G90 CFTCP AX[_X]=0 AX[_Y]=0
SBLOF
_AT=_DPINT _PEA[2,0]=_LINT-_H2
_SCHLICHTEND:
IF _ZB[3]
_I3=-1
ELSE
_I3=1
ENDIF
IF (_ZB[2] AND (_ZB[9]==1) AND (_AZ==1))
_EINRAD=2/_WZMF
IF (_WZR+_FAL+_EINRAD)>_WINT
IF (_WINT-_WZR-_FAL)>=0
_EINRAD=_WINT-_FAL-_WZR
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
ENDIF
IF(_AZ==1)
_AT=_DPINT _ZT=_FALD
SBLON
N610 G0 AX[_Z]=_AT+(_FALD+_SDZI)*_RFT
SBLOF
ENDIF
_SCHL1: _H2=_WZR+_EINRAD _PEA[2,0]=_LINT-_H2 _PEA[2,1]=-_I3*_H2
GOTOB _SRV
_FINE:
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
SBLON
N900 G0 G90 AX[_Z]=_RTP
G[49]=_GG49
IF ((_ZB[2]) AND (_ZB[9]==0))
N910 G40 G90 AX[_X]=0 AX[_Y]=0
ENDIF
_RET:
IF(_ANFAS==1)
IF(_ZZSD[8]==0)
CYCLE203(0,_FS,_ZFS)
ENDIF
ENDIF
$P_CYCFRAME=_RE_CYCFR
IF(($P_MC)AND(_SC_PC==1))
N920 G40 G90 AX[_X]=_PA AX[_Y]=_PO
ENDIF
_RET_NOCYCFR:
SBLON
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(4+_UMODE)
SBLON
ENDIF
RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_X]=0
$AA_MEAS_POINT1[_Y]=0
$AA_MEAS_POINT1[_Z]=_RFP+_RFT*_SDIS
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_X])+POT($AA_MEAS_POINT2[_Y])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_Z,_RFP+_RFT*_SDIS)
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_CALL_CYCLE72_A:
N960 EXECUTE(_ERROR)
IF(_ERROR) GOTOF _FEHL41
IF(ISFILE(_TEMP_FILE))
FOR _I=0 TO _KTS[0,5]
WRITE(_TEMP,_TEMP_FILE,"I="<<_I<<" G"<<_KTS[_I,0] MOD 10<<" "<<_KTS[_I,1]<<" "<<_KTS[_I,2]<<" "<<_KTS[_I,3]<<" "<<_KTS[_I,4]<<" F="<<_KTS[_I,5])
ENDFOR
ENDIF
_CONT_TAB[1,0]=0
FOR _I=0 TO _KTS[0,5]
IF(_CONT_TAB[1,0]<2)AND((_KTS[_I,0] MOD 10)>0)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=1
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=0
_CONT_TAB[4,_CONT_TAB[1,0]]=0
ENDIF
IF((_KTS[_I,0] MOD 10)==1)OR((_KTS[_I,0] MOD 10)==2)OR((_KTS[_I,0] MOD 10)==3)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=_KTS[_I,0] MOD 10
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=_KTS[_I,3]
_CONT_TAB[4,_CONT_TAB[1,0]]=_KTS[_I,4]
ENDIF
ENDFOR
_KNAME="_E_SP_POCKET3_ANF:_E_SP_POCKET3_END"
_VARI72=2+100000
IF(_VAR1==2)AND(_FALD<>0)
IF(NOT _GRUND)
_VARI72=2+1100000
ELSE
_VARI72=2+2100000+10000
ENDIF
ENDIF
_DPH=_DP
IF (_VAR1==1)
_DPH=_DPH+_FALD*_RFT
ENDIF
IF (_RFP_AUF_AD)
_RFPH=_RFP-_AD*_RFT
ELSE
_RFPH=_RFP
ENDIF
_FRK=1
IF(_ZB[3]==0)
_FRK=3
ELSE
_FRK=2
ENDIF
IF(_GRUND)
_FRK=5-_FRK
ENDIF
;MSG("Pocket3: HELIKAL="<<_HELIKAL<<" GRUND="<<_GRUND<<" VARI72="<<_VARI72)
;M0
;_FRK=1
G[7]=_FRK
_FRK=_FRK+39
IF(_GRUND)AND(_ZB[3]==0)
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,180)
ENDIF
N970 CYCLE72(_KNAME,_RTP,_RFPH,_SDIS,_DPH,_MID,_FAL,_FALD,_FFP1,_FFD,_VARI72,_FRK,0,0,_FFD,0,0)
IF(_GRUND)AND(_ZB[3]==0)
$P_CYCFRAME=$P_CYCFRAME:CROT(_Z,-180)
ENDIF
_CALL_CYCLE72_E:
_E_SP_POCKET3_ANF:
FOR _CONT_TAB[0,0]=1 TO _CONT_TAB[1,0]
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==1)
N910 G1 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]]
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==2)
N920 G2 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==3)
N930 G3 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
ENDFOR
_E_SP_POCKET3_END:
_FEHL1:STOPRE
N730701 SETAL(61000)
RET
_FEHL2:STOPRE
N730702 SETAL(61002)
RET
_FEHL3:STOPRE
N730703 SETAL(61102)
RET
_FEHL4:STOPRE
N730704 SETAL(61105)
RET
_FEHL5:STOPRE
N730705 SETAL(61108)
RET
_FEHL6:STOPRE
N730706 SETAL(61109)
RET
_FEHL7:STOPRE
N730707 SETAL(61110)
RET
_FEHL8:STOPRE
N730708 SETAL(61111)
RET
_FEHL9:STOPRE
N730709 SETAL(61117)
RET
_FEHL10:STOPRE
N730710 SETAL(61113)
RET
_FEHL11:STOPRE
N730711 SETAL(61101)
RET
_FEHL12:STOPRE
N730712 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL13:STOPRE
N730713 SETAL(61019,"(_MIDA)")
RET
_FEHL14:STOPRE
N730714 SETAL(61942)
RET
_FEHL15: STOPRE
N730715 SETAL(62106)
RET
_FEHL16: STOPRE
N730716 SETAL(61246)
RET
_FEHL17: STOPRE
N730717 SETAL(61078)
RET
_FEHL18: STOPRE
N730718 SETAL(61019,"(__VARI: dec6)")
RET
_FEHL20: STOPRE
N730720 SETAL(61156)
RET
_FEHL21: STOPRE
N730721 SETAL(61019,"(_GMODE: dec3)")
_FEHL22: STOPRE
N730722 SETAL(61158)
RET
_FEHL23: STOPRE
N730723 SETAL(61019,"(_DMODE: dec2)")
RET
_FEHL24: STOPRE
N730724 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N730725 SETAL(61155)
RET
_FEHL26: STOPRE
N730726 SETAL(61019,"(_AMODE: dec3>)")
RET
_FEHL27: STOPRE
N730727 SETAL(61159)
RET
_FEHL30: STOPRE
N730730 SETAL(61154)
RET
_FEHL31: STOPRE
N730731 SETAL(61019,"(_GMODE: dec5)")
RET
_FEHL32: STOPRE
N730732 SETAL(61157)
RET
_FEHL33: STOPRE
N730733 SETAL(61019,"(_STA)")
RET
_FEHL34: STOPRE
N730734 SETAL(61019,"(_LENG/_WID)")
RET
_FEHL35: STOPRE
N730735 SETAL(61012)
RET
_FEHL39: STOPRE
N730739 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N730740 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_FEHL41: STOPRE
N707941 SETAL(61606)
RET
_FEHL45: STOPRE
N730745 SETAL(61022,_SERR)
RET
_FEHL46: STOPRE
N730746 SETAL(61216)
RET
_FEHL47: STOPRE
N730747 SETAL(61019,"(_DMODE: dec5)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_POCKET4_SPF
PROC POCKET4(REAL _RTP,REAL _RFP,REAL __SDIS,REAL __DP,REAL _CDIAM,REAL __PA,REAL __PO,REAL __MID,REAL __FAL,REAL __FALD,REAL _FFP1,REAL __FFD,INT __CDIR,INT __VARI,REAL __MIDA,REAL __AP1,REAL __AD,REAL __RAD1,REAL __DP1,INT _UMODE,REAL __FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2023-11-14
;Cycle support HMIsl
;Circular pocket
DEF AXIS _X,_Y,_Z
DEF INT _CDIR,_VARI,_GG10
DEF INT _MIRR,_I1,_I2,_I3,_I4,_I14,_AZ,_AZB,_RFT,_SPIND,_H8,_ERR=0,_II,_FFD_TYPE,_WTYP
DEF INT _ANFAS,_AZH1,_AZH0,_AZHR,_EINFH,_GG1,_GG7,_IX,_KBA,_ROWI,_VAR1,_VAR2,_VAR3,_VAR4,_ZSD1,_AMODE1,_AMODE2,_AMODE3,_DMODE1,_DMODE3,_DMODE5,_GMODE5,_ZZSD[15]
DEF INT _ARTIS[16]
DEF REAL _DP,_PA,_PO,_MID,_FAL,_FALD,_FFD,_MIDA,_AP1,_AD,_ZFS,_HRAD=0,_Z_POS_START,_AP1_SAVE=0
DEF REAL _WZR,_H1,_H2,_H3,_H4,_AT,_GT,_ZT,_RT,_PEA[3,2],_ERI,_BRI,_RURA,_CRAD,_WZMF=1,_EINRAD=2,_ADZI,_SDZI=1,_HS_A,_ZTSDIS,_TOOLOFFN,_FAK1,_FAK2,_BRIMAX,_DPI
DEF REAL _AR,_ARX,_ARY,_ARXM,_ARYM,_ARX3,_ARY3,_ALFA,_BETA,_BETA3,_HYP,_HYP3,_EWH2,_EWH3,_AWHAL,_BR,_BRF,_BRALT,_BRI1,_GTR,_HALB,_PRAD
DEF REAL _HL1,_MIDH0,_MIDR,_RHALB,_SWH0,_SWH1,_EWH1,_EWHR,_RWH,_RWH1,_RWHR,_VWH1,_VWHR,_VWH2,_VWH3,_ZUB
DEF REAL _SDIS,_RAD1,_DP1,_FS,_SKF,_SKF1,_SKF2,_SKF3
DEF BOOL _ZB[13],_SOWZ
DEF STRING[30] _S_FFP1,_S_FFD,_PROG
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_POCKET4_MPF",_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_POCKET4_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";Scaling factors: $P_ACTFRAME=CSCALE("<<AXSTRING($P_AXN1)<<","<<$P_ACTFRAME[$P_AXN1,SC]<<","<<AXSTRING($P_AXN2)<<","<<$P_ACTFRAME[$P_AXN2,SC]<<","<<AXSTRING($P_AXN3)<<","<<$P_ACTFRAME[$P_AXN3,SC]<<")")
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1]<<"  _ZSD[3]="<<_ZSD[3]<<"  _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"POCKET4("<<_RTP<<","<<_RFP<<","<<__SDIS<<","<<__DP<<","<<_CDIAM<<","<<__PA<<","<<__PO<<","<<__MID<<","<<__FAL<<","<<__FALD<<","<<_FFP1<<","<<__FFD<<","<<__CDIR<<","<<__VARI<<","<<__MIDA<<","<<__AP1<<","<<__AD<<","<<__RAD1<<","<<__DP1<<","<<_UMODE<<","<<__FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_I3=0
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DIAMCYCOF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_CDIR=__CDIR _VARI=__VARI _DP=__DP _PRAD=_CDIAM _PA=__PA _PO=__PO _MID=__MID
_FAL=__FAL _FALD=__FALD _FFD=__FFD _MIDA=__MIDA _AP1=__AP1 _AD=__AD _ZFS=__ZFS
_SDIS=__SDIS _RAD1=__RAD1 _DP1=__DP1 _FS=__FS
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
_GMODE5=_GMODE _DEC5
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL37
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
GOTOF _FEHL37
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "F_PO_CIR")AND(_PROG <> "E_PO_CIR") )
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_GMODE5=1
ENDIF
_DMODE3=_DMODE _DEC3
IF(_DMODE3<0)OR(_DMODE3>1)
_SERR=<<"(_DMODE: dec3)"
GOTOF _FEHL32
ENDIF
IF(_DMODE3==1)
_PRAD=_PRAD/2 _AP1=_AP1/2
ENDIF
_SOWZ=FALSE
_VAR1=_VARI _DEC1
_VAR2=_VARI _DEC2
_VAR3=_VARI _DEC3
_VAR4=_VARI _DEC4
IF(_VAR2==2)
_FFD=_FFP1
ENDIF
IF(_VAR1==1) AND (_VAR2==0) AND (_GMODE _DEC5==2)
_FFD=_FFP1
ENDIF
IF(_VAR1==2) AND (_VAR2==0)
_FFD=_FFP1
ENDIF
IF(_VAR1<0)OR(_VAR1==3)OR(_VAR1>5) GOTOF _FEHL2
IF(_VAR1==5)
_ANFAS=1
_VAR2=0
ENDIF
IF(_VAR1==4)
IF(_FAL<=0)
_SERR=<<"(UXY)"
GOTOF _FEHL10
ENDIF
_FALD=0 _VAR1=2
_VAR2=0 _FFD=_FFP1
ENDIF
IF(_ANFAS==1)
_VAR4=0
ENDIF
IF(_VAR4<0)OR(_VAR4>2) GOTOF _FEHL2
IF(_VAR1==5)
_VAR4=0
ENDIF
IF(_VAR4==1)
_VAR2=0
ENDIF
IF(_VAR2<0)OR(_VAR2>2) GOTOF _FEHL2
_VARI=_VAR1+_VAR2*10+_VAR3*100+_VAR4*1000
_VARI=_VARI MOD 1000
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF(_SDIS<=0) GOTOF _FEHL14
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
_PA=$P_EP[_X]*_FAK1 _PO=$P_EP[_Y]*_FAK1
ELSE
GOTOF _FEHL27
ENDIF
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3
IF $P_TOOL<=0
GOTOF _FEHL1
ENDIF
_WZR=$P_TOOLR*_FAK1 _I1=$P_TOOL
IF NOT ($SCS_FUNCTION_MASK_MILL_SET B_AND 'H8')
IF ($P_ACTFRAME[_X,SC]<>$P_ACTFRAME[_Y,SC]) GOTOF _FEHL35
ENDIF
_SKF1=$P_ACTFRAME[_X,SC]
_SKF2=$P_ACTFRAME[_Y,SC]
_SKF3=$P_ACTFRAME[_Z,SC]
_SKF=MINVAL(_SKF1,_SKF2)
IF _VAR1<>5
_WZR=_WZR*1/_SKF
ELSE
IF (_SKF<>_SKF3) GOTOF _FEHL36
_FS=_FS*_SKF
ENDIF
_FAL=_FAL*1/_SKF
_FALD=_FALD*1/_SKF3
_MID=_MID*1/_SKF3
_RAD1=_RAD1*1/_SKF
_SDIS=_SDIS*1/_SKF3
_DP1=_DP1*1/_SKF3
_EINRAD=_EINRAD*1/_SKF
_MIDA=_SKF/MAXVAL(_SKF1,_SKF2)*_MIDA
IF (_AMODE _DEC2==0)
_MIDA=_MIDA*1/_SKF
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL21
IF(_ANFAS == 1)
_AMODE3=_AMODE _DEC3
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(_RTP==_RFP) GOTOF _FEHL11
_H1=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_ZFS)*_H1
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
_ZFS=ABS(_RFP-_ZFS) _AMODE3=1
ENDIF
_DP=_DP*1/_SKF3
IF(_ZZSD[1]==0)
_MID=_ZFS+_SDIS
ELSE
_MID=_ZFS
ENDIF
_MIDA=_FS _FALD=0 _FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_FFD=_FFP1
_TOOLOFFN=$P_OFFN*_FAK2
_VARI=_VARI-3 _ZB[7]=1 _ZB[12]=1
ENDIF
_WZR=_WZR+_TOOLOFFN
IF(_VARI _DEC1 == 1)OR(_VARI _DEC1 == 2)AND(_ANFAS==0)
_AMODE2=_AMODE _DEC2
IF(_AMODE2<0)OR(_AMODE2>1) GOTOF _FEHL25
IF(_AMODE2==1)
IF(_MIDA<0)OR(_MIDA>100)
GOTOF _FEHL13
ELSE
_MIDA=_MIDA/100*(2*_WZR) _AMODE2=0
ENDIF
ENDIF
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL33
ENDIF
_S_FFP1="G95 FZ="<<_FFP1
ELSE
_S_FFP1="G94 F"<<_FFP1
ENDIF
ENDIF
IF(_VAR1 _DEC1 == 4)OR(_VAR1 _DEC1 == 5)OR(_VAR2 == 2)OR(_VAR4<>0)
_S_FFD=_S_FFP1
ELSE
IF(_DMODE _DEC2 == 0)
IF(_ZSD[3]==-1)OR(_ZSD[3]==0)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=1
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ELSE
IF(_DMODE _DEC2 == 1)
_FFD_TYPE=$P_F_TYPE
ELSE
IF($P_F_TYPE==0)OR($P_F_TYPE==2)
_FFD_TYPE=11
ELSE
_FFD_TYPE=0
ENDIF
ENDIF
ENDIF
IF(_FFD_TYPE==1)OR(_FFD_TYPE==3)
_S_FFD="G95 F"<<_FFD
ELSE
IF(_FFD_TYPE==11)OR(_FFD_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL33
ENDIF
_S_FFD="G95 FZ="<<_FFD
ELSE
_S_FFD="G94 F"<<_FFD
ENDIF
ENDIF
ENDIF
IF(_VARI _DEC1 == 1)
IF(_GMODE5<0)OR(_GMODE5>2) GOTOF _FEHL31
IF(_GMODE5==1)
_AP1=0 _AD=0
ENDIF
ENDIF
IF(_ANFAS==0)
_AMODE1=_AMODE _DEC1
IF(_AMODE1<0)OR(_AMODE1>1) GOTOF _FEHL24
IF(_AMODE1==1)
_DPI=ABS(_DP)
IF(_DPI==0) GOTOF _FEHL30
IF(_RTP==_RFP)
GOTOF _FEHL11
ELSE
_H1=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-_DPI*_H1
_AMODE1=0
ENDIF
ENDIF
ENDIF
_RE_CYCFR=$P_CYCFRAME
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL15
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL15
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL15
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
_CRAD=ABS(_PRAD) _ADZI=ABS(_RFP-_DP)-ABS(_AD)
_FALD=ABS(_FALD)
IF _ADZI<_FALD
_ADZI=_FALD
ENDIF
N25 IF _WZR<=0 GOTOF _FEHL9
_SPIND=ABS(_VARI) DIV 100 _VARI=_VARI MOD 100
IF(_SPIND>4) GOTOF _FEHL2
_STCCMA:
_I2=ABS(_VARI) _I1=(_I2 _DEC1) _I2=(_I2 _DEC2)
N30 IF ((_I1<1)OR(_I1>5)OR(_I1==3)OR(_I2<0)OR(_I2>2)) GOTOF _FEHL2
IF(_I1==4)
_FALD=0
ENDIF
IF(_I1==2)AND(_VAR4==0)AND(_ANFAS==0)
IF(_FAL>=2*_WZR) GOTOF _FEHL16
_AP1=0 _AD=0
ENDIF
IF (_CDIR<0)OR(_CDIR>3) GOTOF _FEHL6 IF _I2<1 GOTOF _MY1
_ZB[0]=1
IF _I2==1 GOTOF _MY1
_ZB[1]=1
_MY1:_I1=_I1-1
IF _SOWZ==TRUE
_ZB[2]=1
ELSE
_ZB[2]=_I1
ENDIF
IF _FAL<>0
_ZB[10]=1
ENDIF
IF _FALD<>0
_ZB[9]=1
ENDIF
IF (_RTP==_RFP)AND(_DP==_RFP) GOTOF _FEHL11 IF _RTP==_RFP GOTOF _MY52 IF _RFP==_DP GOTOF _MY52 IF ((_RFP-_DP)/ABS(_RFP-_DP))<>((_RTP-_RFP)/ABS(_RTP-_RFP)) GOTOF _FEHL11
_MY52:
IF _RFP-_DP<>0
_H1=_RFP-_DP
ELSE
_H1=_RTP-_DP
ENDIF
_RFT=ABS(_H1)/_H1
_MIRR=$P_ACTFRAME[_X,MI]+$P_ACTFRAME[_Y,MI]
IF _MIRR==1
IF (_CDIR==0) OR (_CDIR==2) GOTOF _SPG1
_CDIR=_CDIR-1
GOTOF _SPG2
_SPG1: _CDIR=_CDIR+1
_SPG2:
ENDIF
IF(_RFT==-1)
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_Z,MI])
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF _CDIR==2 GOTOF _MY3 IF _CDIR<>3 GOTOF _MY2
_ZB[3]=1
GOTOF _MY3
_MY2:
IF ($P_SMODE[0]==1) OR ($P_SMODE[0]==3)
_H1=$P_SDIR[$P_MSNUM]
IF (_H1<3) OR (_H1>4)
GOTOF _FEHL3
ENDIF
ELSE
GOTOF _FEHL3
ENDIF
IF (_H1<3) OR (_H1>4)
_ZB[3]=1
SETAL(62101)
GOTOF _MY3
ENDIF
N35 IF (_CDIR==0)AND(_H1==4) GOTOF _MY3 IF (_CDIR==1)AND(_H1==3) GOTOF _MY3
_ZB[3]=1
_MY3:
IF _SDIS<>0
_SDZI=_SDIS
ENDIF
_BRIMAX=2*_WZR
_H1=$MN_SCALING_SYSTEM_IS_METRIC _I1=$P_GG[13]
IF(_I1==2)OR(_I1==4) GOTOF _MY51
_WZMF=$MN_SCALING_VALUE_INCH _EINRAD=_EINRAD/_WZMF
IF _SDIS<>0 GOTOF _MY51
_SDZI=_SDZI/_WZMF
_MY51:_ERI=_CRAD
IF (_MIDA>2*_WZR) AND (_SOWZ==FALSE)
IF NOT( (_ZB[2]==1) AND (_ZB[9]==0) AND (_ZB[10]==1) )
GOTOF _FEHL8
ENDIF
ENDIF
IF NOT((_ANFAS==1) AND (_ZZSD[8]<>0))
IF _WZR>=_CRAD GOTOF _FEHL4 IF NOT(_ZB[2])AND(_WZR>=ABS(_CRAD-_FAL)) GOTOF _FEHL4
IF (_ZB[2])AND(__VARI _DEC1==4)AND(_WZR>=ABS(_CRAD-_FAL)) GOTOF _FEHL4
ENDIF
_MY55:_ZB[6]=1
IF (_AP1>0)
_ZB[6]=0 _ZB[4]=1
ENDIF
IF (_AD>0)
_ZB[6]=0 _ZB[5]=1
ENDIF
IF ( (_ZB[4]==1)AND((_AP1-_WZR)<(_EINRAD)) )
_ZB[6]=1
ENDIF
_H8=$P_TRAFO
IF ((_SPIND==2) AND (_H8 B_AND 'H1300') ) GOTOF _FEHL2
IF(_VAR4==0)
IF((_SPIND==1)AND(_I2>1)AND(_ZB[2]==0)) GOTOF _FEHL2
ENDIF
IF(_VAR4==1) GOTOF _HELIKAL
_MY61:
IF _FALD>ABS(_RFP-_DP)
IF(_ZZSD[1]==1)
_FALD=ABS(_RFP-_DP)
ELSE
_FALD=ABS(_RFP-_DP)+ABS(_SDIS)
ENDIF
ENDIF
IF _ZB[2]
IF _MID>=ABS(_RFP-_DP)
IF _ZSD[1]==1
_MID=ABS(_RFP-_DP)
ELSE
_MID=ABS(_RFP-_DP)+ABS(_SDIS)
ENDIF
ENDIF
ELSE
IF _MID>=ABS(_RFP-_DP)-ABS(_FALD)
IF _ZSD[1]==1
_MID=ABS(_RFP-_DP)-ABS(_FALD)
ELSE
_MID=ABS(_RFP-_DP)+ABS(_SDIS)-ABS(_FALD)
ENDIF
ENDIF
ENDIF
_GT=ABS(_RFP-_DP) _AZ=1
IF _ZB[2] GOTOF _MQ11
_GT=_GT-ABS(_FALD)
_MQ11: IF(_ZZSD[1]) GOTOF _MQ1
_GT=_GT+ABS(_SDIS)
_MQ1:IF ((_MID==0) OR (_GT==0)) GOTOF _MQ2 IF ((_ZB[2]==1) AND (_FAL==0) AND (_ZB[1]==1)) GOTOF _MQ2
_AZ=TRUNC(_GT/_MID)
IF _MID*_AZ==_GT GOTOF _MQ2
_AZ=_AZ+1
N40 _MQ2:_ZT=_GT/_AZ _ZT=_ZT*_RFT
IF ABS(_AD)>=ABS(_RFP-_DP)-ABS(_FALD)
IF NOT((_ZB[2]==1) AND (_AZ==1) AND (_ZB[9]==1))
_ZB[7]=1
ENDIF
ENDIF
IF (_ZB[6]==1) AND (NOT _ZB[12]==1)
_ZB[7]=0
ENDIF
IF(_SPIND==2)
CUST_TECHCYC(3+_UMODE)
ENDIF
IF(_SPIND==4)
CUST_TECHCYC(403+_UMODE)
ENDIF
_WKSN:
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_PA*1/_FAK1,_Y,_PO*1/_FAK1)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
SBLON
N110 G0 G90 AX[_Z]=_RTP
N120 NORM CDOF CFTCP AX[_X]=0 AX[_Y]=0
N130 AX[_Z]=_RFP+_RFT*_SDIS
SBLOF
_Z_POS_START=_RFP+_RFT*_SDIS
IF (_VAR4==2)
IF (_VAR1==1)
IF ((_VAR2==0)OR(_ZB[7]==1))
GOTOF _HELIKAL
ELSE
IF (_ZB[6]==0)
SBLON
N131 AX[_Z]=_RFP-(_AD-_SDZI)*_RFT
SBLOF
_Z_POS_START=_RFP-(_AD-_SDZI)*_RFT
ENDIF
GOTOF _MY84
ENDIF
ELSE
GOTOF _HELIKAL
ENDIF
ENDIF
IF (_ZB[2]) AND (_AZ<>1) GOTOF _MSL1
IF (_ZB[2]) AND (_ZB[9]==0) GOTOF _MSL1
IF _ZB[2] GOTOF _SCHLICHTEND
N200 _SEB1:
IF ( (_CRAD-_FAL-_WZR)<(_EINRAD) )
_EINRAD=(_CRAD-_FAL-_WZR)
ENDIF
_MY71:_BRI=_MIDA _I1=1
IF _MIDA<>0 GOTOF _NXTIEF
_BRI=_WZR*1.6
_NXTIEF:_AT=_DP+((_AZ-_I1)*_ZT)
IF(_AZ>1)OR(_ZB[1]>0)
IF _ZB[2]==0
IF(_I1==1)
ENDIF
IF((_I1==_AZ)AND(_ZB[1]==0))
ENDIF
ENDIF
ENDIF
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ZB[7] GOTOF _SRROH
IF _ZB[6] GOTOF _SRV
IF ABS(_AT-_DP)+_FALD>_ADZI GOTOF _SRROH
_ZB[6]=1
N240 G0 G90 G40 AX[_X]=0 AX[_Y]=0
GOTOF _SRV
N400 _SRROH:_H1=ABS(_PRAD)-ABS(_AP1)-_FAL
IF (_H1<_BRI) AND (_ZB[7]==1)
_PRAD=_PRAD-_FAL _FAL=0 _CRAD=_PRAD _ERI=_CRAD _ZB[2]=1
IF NOT(_ZB[7])
GOTOF _MSL1
ENDIF
ENDIF
_AZB=TRUNC(_H1/_BRI) _I3=1
IF _H1<=0 GOTOF _END1 IF _BRI*_AZB==_H1 GOTOF _MY90
_AZB=_AZB+1
_MY90:_BRI=_H1/_AZB _I2=1 _RURA=_ERI-_FAL-_H1+_BRI
IF(_ZB[12])
ELSE
IF _BRI>_BRIMAX
GOTOF _FEHL13
ENDIF
ENDIF
_H2=_WZR+_EINRAD
IF NOT(_ZB[3]) GOTOF _MY92
_I3=-1
_MY92:
IF _ZB[3]==1
_PEA[0,0]=0 _PEA[0,1]=-(_AP1+_BRI)
_PEA[1,0]=_PEA[0,0]+_I3*_H2 _PEA[1,1]=-(_CRAD-_FAL-(_AZB-_I2)*_BRI-_H2 )
_PEA[2,0]=_CRAD-_FAL-_H2 _PEA[2,1]=-_I3*_H2
ELSE
_PEA[0,0]=0 _PEA[0,1]=_AP1+_BRI
_PEA[1,0]=_PEA[0,0]-_I3*_H2 _PEA[1,1]=_CRAD-_FAL-(_AZB-_I2)*_BRI-_H2
_PEA[2,0]=_CRAD-_FAL-_H2 _PEA[2,1]=-_I3*_H2
ENDIF
IF _ZB[3] GOTOF _AFG3
IF ( ( NOT (_EINRAD<2/_WZMF) ) AND (ABS(_PEA[1,0])-_WZR > 0) AND(_AP1-_WZR-_EINRAD>0) )
IF ((_AZB==1)AND(_I2==1))
N420 G0 AX[_Y]=0 AX[_X]=(_AP1-_WZR-_EINRAD)
ELSE
N420 G0 AX[_X]=0 AX[_Y]=_AP1-_WZR-_EINRAD
ENDIF
SBLON
EXECSTRING(_S_FFD)
IF _SDZI
N421 G0 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
ELSE
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N421 G1 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
ENDIF
SBLOF
N422 G1 AX[_Z]=_AT+_RFT*_FALD
EXECSTRING(_S_FFP1)
IF ((_AZB==1)AND(_I2==1))
N4221 G1 G42 G[10]=_GG10 AX[_Y]=(-1)*_PEA[1,0] AX[_X]=_PEA[1,1]
N423 G2 AX[_Y]=_PEA[0,0] AX[_X]=_PEA[0,1] CR=_H2
ELSE
N4221 G1 G42 G[10]=_GG10 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N423 G2 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
ELSE
N420 G0 AX[_X]=0 AX[_Y]=0
SBLON
N421 G0 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
SBLOF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
EXECSTRING(_S_FFD)
N422 G1 AX[_Z]=_AT+_RFT*_FALD
EXECSTRING(_S_FFP1)
IF ((_AZB==1)AND(_I2==1))
N423 G1 G42 G[10]=_GG10 AX[_Y]=(-1)*_PEA[1,0] AX[_X]=_PEA[1,1]
N4231 G2 AX[_Y]=_PEA[0,0] AX[_X]=_PEA[0,1] CR=_H2
ELSE
N423 G42 G[10]=_GG10 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N4231 G2 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
ENDIF
_NXRUG2:
IF ((_AZB==1)AND(_I2==1))
N4241 G2 AX[_Y]=0 AX[_X]=-_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
N4242 AX[_Y]=0 AX[_X]=_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
ELSE
N4241 G2 AX[_X]=0 AX[_Y]=-_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
N4242 AX[_X]=0 AX[_Y]=_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
ENDIF
IF _I2<>_AZB GOTOF _MQ84
IF NOT((_AZB==1)AND(_I2==1))
N427 G2 AX[_X]=(_CRAD-_FAL) AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
ENDIF
N428 G2 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H2
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
N429 G0 G91 AX[_Z]=_RFT*_SDZI
SBLOF
N402 G90 G40 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1]+_WZR+0.001/_WZMF
GOTOF _END1
N425 _MQ84:G1 AX[_X]=_BRI
N426 G2 AX[_X]=_BRI+_RURA AX[_Y]=0 IP[_X]=AC(_BRI) IP[_Y]=AC(0)
_I2=_I2+1 _RURA=_RURA+_BRI
GOTOB _NXRUG2
_AFG3:
IF ( ( NOT (_EINRAD<2/_WZMF) ) AND (ABS(_PEA[1,0])-_WZR > 0) AND(_AP1-_WZR-_EINRAD>0) )
IF ((_AZB==1)AND(_I2==1))
N410 G0 AX[_Y]=0 AX[_X]=(_AP1-_WZR-_EINRAD)*(-_I3)
ELSE
N410 G0 AX[_X]=0 AX[_Y]=(_AP1-_WZR-_EINRAD)*_I3
ENDIF
SBLON
EXECSTRING(_S_FFD)
IF _SDZI
N411 G0 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
ELSE
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N411 G1 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
ENDIF
SBLOF
N412 G1 AX[_Z]=_AT+_RFT*_FALD
EXECSTRING(_S_FFP1)
IF ((_AZB==1)AND(_I2==1))
N4121 G1 G41 G[10]=_GG10 AX[_Y]=_PEA[1,0] AX[_X]=(-1)*_PEA[1,1]
N413 G3 AX[_Y]=_PEA[0,0] AX[_X]=(-1)*_PEA[0,1] CR=_H2
ELSE
N4121 G1 G41 G[10]=_GG10 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N413 G3 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
ELSE
N410 G0 AX[_X]=0 AX[_Y]=0
SBLON
EXECSTRING(_S_FFD)
N411 G0 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
SBLOF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N412 G1 AX[_Z]=_AT+_RFT*_FALD
EXECSTRING(_S_FFP1)
IF ((_AZB==1)AND(_I2==1))
N413 G1 G41 G[10]=_GG10 AX[_Y]=_PEA[1,0] AX[_X]=(-1)*_PEA[1,1]
N4131 G3 AX[_Y]=_PEA[0,0] AX[_X]=(-1)*_PEA[0,1] CR=_H2
ELSE
N413 G41 G[10]=_GG10 AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N4131 G3 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
ENDIF
ENDIF
_NXRU:
IF ((_AZB==1)AND(_I2==1))
N4141 G3 AX[_Y]=0 AX[_X]=-_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
N4142 AX[_Y]=0 AX[_X]=_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
ELSE
N4141 G3 AX[_X]=0 AX[_Y]=_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
N4142 AX[_X]=0 AX[_Y]=-_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
ENDIF
IF _I2<>_AZB GOTOF _MQ85
IF NOT((_AZB==1)AND(_I2==1))
N417 G3 AX[_X]=(_CRAD-_FAL) AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
ENDIF
N418 G3 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H2
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
SBLON
N419 G0 G91 AX[_Z]=_RFT*_SDZI
SBLOF
N404 G90 G40 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1]-_WZR-0.001/_WZMF
GOTOF _END1
N415 _MQ85:G1 AX[_X]=_BRI
N416 G3 AX[_X]=_BRI+_RURA AX[_Y]=0 IP[_X]=AC(_BRI) IP[_Y]=AC(0)
_I2=_I2+1 _RURA=_RURA+_BRI
GOTOB _NXRU
N300 _SRV:_H1=_CRAD-_WZR
IF _ZB[2] GOTOF _MY79
_H1=_H1-_FAL
_MY79: _BRI=_MIDA
IF _MIDA<>0 GOTOF _MY79A
_BRI=_WZR*1.6
_MY79A:_AZB=TRUNC(_H1/_BRI) _I3=1
IF _BRI*_AZB==_H1 GOTOF _MY80
_AZB=_AZB+1
_MY80:_BRI=_H1/_AZB _I2=1 _RURA=0 _H2=_WZR+_EINRAD
IF _BRI>_BRIMAX
GOTOF _FEHL13
ENDIF
IF NOT(_ZB[3]) GOTOF _MY84
_I3=-1
_MY84:
IF(_VAR4==2)
_AT=_DP
_ZT=_DP
ENDIF
IF _ZB[2] GOTOF _SEB IF _ZB[1] GOTOF _ZUBAHN
IF (((_SPIND==1)OR(_SPIND==3))AND(_ZB[2]==0))
CUST_TECHCYC(3+_UMODE)
ENDIF
IF _ZB[0] GOTOF _ZBG1
SBLON
N302 G0 AX[_Z]=_AT+_RFT*(_FALD+_SDZI)
SBLOF
_ZBG1:
IF(_ZB[0]==0)
EXECSTRING(_S_FFP1)
ELSE
EXECSTRING(_S_FFD)
ENDIF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N303 G1 AX[_Z]=_AT+_RFT*_FALD
IF ((_SPIND==1)AND(_ZB[2]==0))
CUST_TECHCYC(4+_UMODE)
ENDIF
IF ((_SPIND==3)AND(_ZB[2]==0))
CUST_TECHCYC(403+_UMODE)
ENDIF
IF (_VAR4==2) GOTOF _HELIKAL
GOTOF _SEB
N380 _ZUBAHN:
IF (((_ZZSD[1]==0) AND (_I1==1)) OR (_ZZSD[1]==1))
_ZTSDIS=ABS(_ZT)
ELSE
_ZTSDIS=ABS(_ZT)+_SDIS
ENDIF
IF (_RAD1<=0) OR (_DP1<=0) GOTOF _FEHL5 IF ABS(_ZTSDIS)>=ABS(_DP1) GOTOF _MQ34
_I4=1
GOTOF _HELRAD
_MQ34:_I4=TRUNC(_ZTSDIS/_DP1)
IF _DP1*_I4==_ZTSDIS GOTOF _HELRAD
_I4=_I4+1
_HELRAD:_H4=_RAD1
IF _AP1==0
IF _RAD1<_WZR GOTOF _FALL2
_H4=_WZR
ELSE
IF (ABS(_AT-_DP)+_FALD<_ADZI)
IF _RAD1<_WZR GOTOF _FALL2
_H4=_WZR
ENDIF
IF _RAD1<_AP1+_WZR
GOTOF _FALL2
ELSE
_H4=_AP1
ENDIF
ENDIF
_FALL2:IF _H4+_WZR<_PRAD-_FAL GOTOF _FALL3
_H4=_PRAD-_FAL-_WZR
IF _H4==0 GOTOF _FEHL4
GOTOF _HELBAHN
_FALL3: IF _H4==_RAD1 GOTOF _HELBAHN
_FALL3NEU: IF ABS(_ZT)/_I4/_H4<_DP1/_RAD1 GOTOF _HELBAHN
_I4=_I4+1
GOTOB _FALL3NEU
_HELBAHN:
_HRAD=_H4
N382 G0 G40 G90 AX[_X]=_H4
EXECSTRING(_S_FFP1)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF(_I1>1)
N383 G1 G[10]=_GG10 G91 AX[_Z]=-_RFT*_SDZI
ENDIF
IF((_ZZSD[1]==1) AND (_I1==1))
IF(_SDIS<>0)
_I14=TRUNC(ABS(_SDIS)/_DP1)
IF((_DP1*_I14)<>_SDIS)
_I14=_I14+1
ENDIF
IF NOT(_ZB[3])
N1160 G91 G2 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_SDIS IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I14-1
ELSE
N1160 G91 G3 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_SDIS IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I14-1
ENDIF
ENDIF
ENDIF
IF _ZB[3] GOTOF _HELG3
N384 G90 G2 G[10]=_GG10 AX[_X]=_H4 AX[_Y]=0 AX[_Z]=(_AT+_RFT*_FALD) IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I4-1
GOTOF _HELKR
N385 _HELG3:G90 G3 G[10]=_GG10 AX[_X]=_H4 AX[_Y]=0 AX[_Z]=(_AT+_RFT*_FALD) IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I4-1
_HELKR:
IF(_I1==_AZ)
ENDIF
IF ( (NOT(_WZR>=_PRAD/2)AND(_ZB[4]==0)) OR ((_ZB[4]==1) AND (( _WZR<(_PRAD-_AP1)/2) OR (_AT+_RFT*_FALD < _RFP-_RFT*_AD))) )
N386 G91 AX[_X]=0 AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
N387 G1 G90 AX[_X]=0
ENDIF
IF (_VAR4==2) GOTOF _HELIKAL
N305 _SEB:
EXECSTRING(_S_FFP1)
_H1=_H1-_BRI _RURA=_ERI-_H1 _H3=_CRAD-(_AZB-_I2)*_BRI
IF _ZB[2] GOTOF _MY78
_RURA=_RURA-_FAL _H3=_H3-_FAL
_MY78:IF (_ZB[3])AND(_I2==1) GOTOF _MY930 IF _ZB[3] GOTOF _N310G3 IF _I2>1 GOTOF _N310
N320 G1 G90 G42 G[10]=_GG10 AX[_X]=_H3
N321 _N310:G2 G90 AX[_X]=-_RURA AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
N322 G2 G90 AX[_X]=0 AX[_Y]=_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
IF _I2<>_AZB GOTOF _MY93
N326 G2 AX[_X]=_RURA AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
IF _ZB[2]
N327 G2 AX[_X]=_CRAD-_H2 AX[_Y]=-_I3*_H2 IP[_X]=AC(_CRAD-_H2) IP[_Y]=AC(0)
ELSE
N328 G2 AX[_X]=_CRAD-_FAL-_H2 AX[_Y]=-_I3*_H2 IP[_X]=AC(_CRAD-_FAL-_H2) IP[_Y]=AC(0)
ENDIF
GOTOF _WEG1
_MY93:
IF (_I2==(_AZB-1))AND(_ZB[2])
N323 CFC G1 AX[_X]=_BRI
ELSE
N324 G1 AX[_X]=_BRI
ENDIF
N325 G2 AX[_X]=_BRI+_RURA AX[_Y]=0 IP[_X]=AC(_BRI) IP[_Y]=AC(0)
GOTOF _MY94
N310 _MY930:G1 G90 G41 G[10]=_GG10 AX[_X]=_H3
N311 _N310G3:G3 G90 AX[_X]=-_RURA AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
N312 G3 G90 AX[_X]=0 AX[_Y]=-_RURA IP[_X]=AC(0) IP[_Y]=AC(0)
IF _I2<>_AZB GOTOF _MY93A
N316 G3 AX[_X]=_RURA AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
IF _ZB[2]
N317 G3 AX[_X]=_CRAD-_H2 AX[_Y]=-_I3*_H2 IP[_X]=AC(_CRAD-_H2) IP[_Y]=AC(0)
ELSE
N318 G3 AX[_X]=_CRAD-_FAL-_H2 AX[_Y]=-_I3*_H2 IP[_X]=AC(_CRAD-_FAL-_H2) IP[_Y]=AC(0)
ENDIF
N319 G1 G40 AX[_X]=_CRAD-_FAL-_H2 AX[_Y]=-_I3*_H2+(_WZR+0.001/_WZMF)*_I3
_WEG1:IF _I1==_AZ GOTOF _FINE IF _ZB[2] GOTOF _FINE
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
SBLON
N306 G0 G91 AX[_Z]=_RFT*_SDZI
N307 G90 G40 AX[_X]=0 AX[_Y]=0
SBLOF
GOTOF _END1
N315 _MY93A:
IF (_I2==(_AZB-1))AND(_ZB[2])
N313 CFC G1 AX[_X]=_BRI
ELSE
N314 G1 AX[_X]=_BRI
ENDIF
N315 G3 AX[_X]=_BRI+_RURA AX[_Y]=0 IP[_X]=AC(_BRI) IP[_Y]=AC(0)
_MY94:_I2=_I2+1
IF _I2<=_AZB GOTOB _SEB
_END1:_I1=_I1+1
IF _I1<=_AZ GOTOB _NXTIEF
IF _ZB[7] GOTOF _FINE
N500 _MSL1:IF _FALD>_MID GOTOF _FEHL7 IF (_CRAD-_WZR)>=_EINRAD GOTOF _MY74
_EINRAD=(_CRAD-_WZR)
_MY74:_H1=1
IF NOT _ZB[3] GOTOF _MSL3
_H1=-1
_MSL3:
IF NOT _FAL
IF _MIDA
_FAL=_MIDA
ELSE
_FAL=1.6*_WZR
ENDIF
IF (_CRAD-_WZR)<_FAL
_FAL=(_CRAD-_WZR)/2
ENDIF
ENDIF
IF (NOT _FALD) AND (__VARI _DEC1<>4)
IF _MID
_FALD=_MID
ELSE
IF ABS(_RFP-_DP)>2/_WZMF
_FALD=2/_WZMF
ELSE
_FALD=ABS(_RFP-_DP)
ENDIF
ENDIF
ENDIF
IF _SOWZ==TRUE GOTOF _MS1
_MS0:IF _ZB[10]==0 GOTOF _MS1 IF (_FAL<2*_WZR) GOTOF _MS1
IF (_ANFAS==1) GOTOF _MS1
_AP1=_CRAD-_FAL _FAL=0 _ZB[2]=0 _ADZI=_FALD _FALD=0
GOTOB _SEB1
_MS1:_H2=_WZR+_EINRAD _PEA[0,0]=_CRAD _PEA[0,1]=0
IF SQRT(POT(_CRAD-_WZR-_EINRAD)+POT(_EINRAD))<_CRAD-_FAL-_WZR GOTOF _MSL4
_I3=1 _H4=1/_WZMF
IF _CRAD-_FAL-_WZR-_H4<0
_H4=_CRAD-_FAL-_WZR
ENDIF
IF (POT(_CRAD-_FAL-_H4)-POT(_EINRAD)>=0.001)
_HS_A=SQRT(POT(_CRAD-_FAL-_H4)-POT(_EINRAD))-_WZR
ELSE
_HS_A=-_WZR
ENDIF
_MSL4:_PEA[1,0]=_PEA[0,0]-_H2 _PEA[1,1]=_PEA[0,1]+_H1*_H2 _PEA[2,0]=_PEA[1,0] _PEA[2,1]=_PEA[0,1]-_H1*_H2
_I1=1
_ANFSZ:_AT=_DP+((_AZ-_I1)*_ZT)
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ZB[10]==0
_AT=_DP _ZT=_ZT*_AZ
GOTOF _SCHLICHTEND
ENDIF
IF _ZB[9]==0 GOTOF _ANFSZ1 IF (_FALD<=ABS(_ZT))OR (_AZ-_I1<>1) GOTOF _ANFSZ1
_AT=_DP+_FALD*_RFT _ZT=_FALD*_RFT
_ANFSZ1:
IF _SOWZ==TRUE
_AT=_DP
ENDIF
IF (NOT(_ZB[0]) AND (ABS(_AT-_DP)==_FALD) AND (_I3==0))
N502 G90 G0 AX[_Z]=_AT+_RFT*_SDZI
ENDIF
IF (NOT(_ZB[0]) AND (ABS(_AT-_DP)>_FALD) AND (_I3==0))
N503 G90 G0 AX[_Z]=_AT
ELSE
EXECSTRING(_S_FFP1)
G1
IF (_I3==1)
N506 G90 G1 AX[_Z]=_AT
ELSE
N505 G90 G0 AX[_Z]=_AT+_RFT*_SDZI
ENDIF
IF(_ANFAS)
G0
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF _ZB[3] GOTOF _SLEG3
IF _I3
IF SQRT(POT(_HS_A)+POT(_EINRAD))>(_PRAD-_FAL-_WZR)
_H3=(_PRAD-_FAL-_WZR)*0.9/SQRT(POT(_HS_A)+POT(_EINRAD))
ELSE
_H3=1
ENDIF
N518 G1 G90 G[10]=_GG10 AX[_X]=_HS_A*_H3 AX[_Y]=_EINRAD*_H3
N519 G1 G42 CFC AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
ELSE
N520 G0 G90 G[10]=_GG10 G42 CFC AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N5201 G1 G90 AX[_Z]=_AT
ENDIF
N521 _SLG2:G2 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
N522 G2 AX[_X]=0 AX[_Y]=-_ERI IP[_X]=AC(0) IP[_Y]=AC(0)
GOTOF _KR270
_SLEG3:
IF _I3
IF SQRT(POT(_HS_A)+POT(_EINRAD))>(_PRAD-_FAL-_WZR)
_H3=(_PRAD-_FAL-_WZR)*0.9/SQRT(POT(_HS_A)+POT(_EINRAD))
ELSE
_H3=1
ENDIF
N508 G1 G90 G[10]=_GG10 AX[_X]=_HS_A*_H3 AX[_Y]=-_EINRAD*_H3
N509 G1 G41 CFC AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
ELSE
N510 G0 G90 G[10]=_GG10 G41 CFC AX[_X]=_PEA[1,0] AX[_Y]=_PEA[1,1]
N5101 G1 G90 AX[_Z]=_AT
ENDIF
N511 _SLG3:G3 AX[_X]=_PEA[0,0] AX[_Y]=_PEA[0,1] CR=_H2
N512 G3 AX[_X]=0 AX[_Y]=_ERI IP[_X]=AC(0) IP[_Y]=AC(0)
N530 _KR270:AX[_X]=_ERI AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
N531 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1] CR=_H2
N540 G1 G40 G90 AX[_X]=_PEA[2,0] AX[_Y]=_PEA[2,1]+(_WZR+0.001/_WZMF)*_H1
IF _I3
N541 AX[_X]=_HS_A*_H3 AX[_Y]=-_EINRAD*_H1*_H3
ENDIF
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF _AT==_DP+_FALD*_RFT
_AT=_DP+(_FALD+_SDZI)*_RFT _ZT=_FALD+_SDZI
N541 G0 AX[_Z]=_AT
ENDIF
_NT:_I1=_I1+1
IF _SOWZ==TRUE GOTOF _FINE
IF _I1<_AZ GOTOB _ANFSZ
IF (_I1==_AZ) AND (_ZB[7]==1) GOTOB _ANFSZ
IF (_I1==_AZ+1) AND (_ZB[7]==1) GOTOF _FINE
IF (_I1==_AZ) AND (_ZB[9]==0)
_AT=_DP
GOTOB _ANFSZ1
ENDIF
IF (_I1>_AZ) AND (_ZB[9]==0) GOTOF _FINE
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
N550 G0 G40 G90 CFTCP AX[_X]=0 AX[_Y]=0
_SCHLICHTEND:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ENDIF
ENDIF
IF _AZ==1
_AT=_DP+(_FALD+_SDZI)*_RFT _ZT=_FALD+_SDZI
N551 G0 AX[_Z]=_AT
ENDIF
N800 CFC
IF _ZB[1]
IF (_RAD1<=0) OR (_DP1<=0)
GOTOF _FEHL5
ENDIF
IF ABS(_ZT)>=ABS(_DP1) GOTOF _HB1
_I4=1
GOTOF _HBR
_HB1:_I4=TRUNC(ABS(_ZT)/_DP1)
IF _DP1*_I4==_ZT GOTOF _HBR
_I4=_I4+1
_HBR:_H4=_RAD1
IF _AP1==0
IF _RAD1<_WZR GOTOF _FLL2
_H4=_WZR
ELSE
IF _RAD1<_AP1+_WZR GOTOF _FLL2
_H4=_AP1
ENDIF
_FLL2:IF _H4+_WZR<_PRAD-_FAL GOTOF _FLL3
_H4=_PRAD-_WZR
IF _H4==0
GOTOF _FEHL4
ENDIF
GOTOF _HBAHN
_FLL3: IF ABS(_ZT)/_I4/_H4<_DP1/_RAD1 GOTOF _HBAHN
_I4=_I4+1
GOTOB _FLL3
N580 _HBAHN:G0 G40 G90 AX[_X]=_H4
EXECSTRING(_S_FFP1)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
IF _ZB[3] GOTOF _HLG3
N582 G91 G2 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_ZT*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I4-1
GOTOF _HLKR
N583 _HLG3:G91 G3 G[10]=_GG10 AX[_X]=0 AX[_Y]=0 AX[_Z]=-_ZT*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_I4-1
_HLKR:
IF(_I1==_AZ)
ENDIF
IF ( (NOT(_WZR>=_PRAD/2)AND(_ZB[4]==0)) OR ((_ZB[4]==1) AND (( _WZR<(_PRAD-_AP1)/2) OR (_AT+_RFT*_FALD < _RFP-_RFT*_AD))) )
N584 G91 AX[_X]=0 AX[_Y]=0 IP[_X]=AC(0) IP[_Y]=AC(0)
N585 G1 G90 AX[_X]=0
ENDIF
ELSE
EXECSTRING(_S_FFD)
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N586 G1 CFTCP AX[_Z]=_DP
N801 CFC
ENDIF
_ZB[6]=1
GOTOB _SEB1
_HELIKAL:
_ZSD1=0
_I1=_VARI MOD 10
IF(_I1>2) GOTOF _FEHL2
IF(_MID<=0) GOTOF _FEHL17
IF (_VAR4<>2)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_X,_PA*1/_FAK1,_Y,_PO*1/_FAK1)
ENDIF
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
_FAL=ABS(_FAL) _FALD=ABS(_FALD) _AD=ABS(_AD)
_SDZI=_SDIS
IF(_SDZI==0)
_SDZI=1/_WZMF
ENDIF
_EINRAD=_WZR+_WZR/2
IF(_I1==1)
_BRF=ABS(_PRAD)-_FAL
_GT=ABS(_RFP-_DP)-_FALD
_ZB[6]=1
IF(_AP1>0)
_ZB[6]=0
ENDIF
IF(_AD>0)
_ZB[6]=0
IF(_AD>=ABS(_RFP-_DP)-_FALD)
_ZB[6]=1 _ZB[7]=1
_AD=0
ENDIF
ELSE
_ZB[6]=1 _ZB[7]=0 _AP1=0
ENDIF
IF(_ZB[6]==0)AND(_ZB[7]==0)
IF(_AP1>_BRF)
_ZB[6]=1 _ZB[7]=0
ENDIF
IF(_AP1-_SDZI<_WZR)
_ZB[6]=1 _ZB[7]=0
ENDIF
ENDIF
IF(_ZB[7]==1)
IF(_AP1<_WZR)
_ZB[6]=1 _ZB[7]=0
ENDIF
ENDIF
ELSE
_BRF=ABS(_PRAD)
_GT=ABS(_RFP-_DP)
_AP1=0 _AD=0
ENDIF
IF(_ZSD1==1)
_EINFH=1
_HL1=_GT
_MIDH0=_MID
IF(_MIDH0>_SDZI)
_MIDH0=_SDZI
ENDIF
_H1=_SDZI/_MIDH0
_AZH0=ROUND(_H1+0.4999)
_MIDH0=_SDZI/_AZH0
_AZH0=_AZH0-1
ELSE
_EINFH=0
_HL1=_GT+_SDZI
ENDIF
IF(_ZB[3])
_GG1=4 _GG7=2
ELSE
_GG1=3 _GG7=3
ENDIF
IF(_I1==2)
IF(_FAL>=2*_WZR) GOTOF _FEHL16
ENDIF
IF(_MIDA<=0)
_BRI=0.8*_WZR*2
ELSE
_BRI=_MIDA
ENDIF
IF(_ZB[7]==0)
IF ((_VAR1==1)AND(_VAR2<>0)AND(_VAR4==2))
_AP1_SAVE=_AP1
_AP1=_HRAD+_WZR
_ZB[7]=1
ELSE
_BRI1=_BRI-_WZR
IF(_BRI1<_SDZI)
_BRI1=_SDZI
ENDIF
IF(_BRI1>_WZR)
_BRI1=_WZR
ENDIF
ENDIF
ENDIF
_KBA=0
IF(_ZB[7]==1)
IF(_AP1<_BRF)
_BRI1=_AP1+_BRI-_WZR
ELSE
_KBA=1
ENDIF
ENDIF
IF(_BRI1+_WZR>=_BRF)
_AZB=1 _BR=_BRF
ELSE
IF(_I1==1)
IF(_ZB[7]==0)
_AZB=1+(_BRF-_WZR-_BRI1)/_BRI+0.4999
IF(_AZB==2)
_ZUB=(_BRF-_WZR)/1.5
_BRI1=_ZUB/2
ELSE
_ZUB=(_BRF-_WZR-_BRI1)/(_AZB-1)
ENDIF
ELSE
IF(_AP1<_BRF)
_AZB=(_BRF-_AP1)/_BRI+0.4999
IF(_AZB==2)
_ZUB=(_BRF-_AP1)/2
ELSE
_ZUB=(_BRF-_AP1)/_AZB
ENDIF
_BRI1=_AP1+_ZUB-_WZR
ELSE
_ZB[6]=1 _KBA=1 _AZB=1
ENDIF
ENDIF
ELSE
_AZB=1+(_BRF-_WZR)/_BRI+0.4999
_ZUB=(_BRF-_WZR)/(_AZB-1)
_BRI1=_ZUB
ENDIF
ENDIF
_BR=_BRI1+_WZR
IF ((_BR>_AP1-_SDZI)AND(_BR>_AP1_SAVE-_SDZI))
_ZB[6]=1
ENDIF
_SWH0=0 _SWH1=0
_H1=_HL1/_MID
_AZH1=TRUNC(_HL1/_MID)
_VWH1=_H1*360
IF(_VWH1-_AZH1*360)<0.000001
_AZH1=_AZH1-1
ENDIF
_RWH1=(_H1*360) MOD 360
_HALB=180
IF(_GG1==3)
_RWH1=-_RWH1
_HALB=-_HALB
ENDIF
_EWH1=_RWH1
_RWH=_RWH1
_EWH2=_EWH1
IF(_ZB[6]==0)
_ADZI=ABS(_RFP-_DP)-_AD
_GTR=_ADZI-_FALD+_SDZI
_MIDR=_MID
IF(_MIDR>_GTR)
_MIDR=_GTR
ENDIF
_H1=_GTR/_MIDR
_AZHR=TRUNC(_GTR/_MIDR)
_VWHR=_H1*360
IF(_VWHR-_AZHR*360)<0.000001
_AZHR=_AZHR-1
ENDIF
_RWHR=(_H1*360) MOD 360
IF(_GG1==3)
_RWHR=-_RWHR
ENDIF
_EWHR=_RWHR
_EWH2=_EWHR
ENDIF
IF _SPIND==2
CUST_TECHCYC(4+_UMODE)
ENDIF
IF ((_VAR1==1)AND(_VAR4==2))
SBLON
IF (_ZB[6]==1)
N1010 G0 G90 G40 AX[_Z]=_RFP+_RFT*_SDIS
ELSE
N1010 G0 G90 G40 AX[_Z]=_Z_POS_START
ENDIF
N1012 NORM CDOF CFTCP AX[_X]=0 AX[_Y]=0
SBLOF
ELSE
SBLON
N1010 G0 G90 G40 AX[_Z]=_RTP
N1012 NORM CDOF CFTCP AX[_X]=0 AX[_Y]=0
N1014 AX[_Z]=_RFP+_SDZI*_RFT
SBLOF
ENDIF
IF(_I1==1)
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[7])
ENDIF
FOR _IX=1 TO _AZB
IF(_I1==1)AND(_IX==_AZB)
_BR=_BRF
ENDIF
_AR=_SDZI
IF(_AR>(_BR-_WZR)/2)
_AR=(_BR-_WZR)/2
ENDIF
_ARYM=(_BR-_WZR-_AR)*SIN(_EWH1+_VWH2) _ARXM=(_BR-_WZR-_AR)*COS(_EWH1+_VWH2)
_BETA=ATAN2(_AR+_WZR,_BR-_WZR-_AR)
_BETA3=ATAN2(_AR,_BR-_WZR-_AR)
_VWH3=_BETA3
_VWH2=_BETA
IF(_GG1==3)
_VWH3=-_VWH3
_VWH2=-_VWH2
ENDIF
_HYP3=SQRT(POT(_BR-_WZR-_AR)+POT(_AR))
_HYP=SQRT(POT(_BR-_WZR-_AR)+POT(_AR+_WZR))
_EWH3=_EWH2+_VWH3
_EWH2=_EWH2+_VWH2
_ARX3=_HYP3*COS(_EWH3) _ARY3=_HYP3*SIN(_EWH3)
_ARX=_HYP*COS(_EWH2) _ARY=_HYP*SIN(_EWH2)
EXECSTRING(_S_FFP1)
IF(_ZB[6]==1)
IF(_KBA==1) GOTOF _M_KBA
SBLON
N1020 NORM CDOF CFTCP G[7]=_GG7 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1)
SBLOF
IF(_EINFH==1)
N1025 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1) AX[_Z]=_RFP IP[_X]=IC(-_EINRAD*COS(_SWH1)) IP[_Y]=IC(-_EINRAD*SIN(_SWH1)) TURN=_AZH0
ENDIF
WRTPR("TMP_BLK_BEG()",1)
N1030 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_EWH1) AX[_Y]=_BR*SIN(_EWH1) AX[_Z]=_RFP-_GT*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_AZH1
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
WRTPR("TMP_BLK_END()",1)
ELSE
WRTPR("TMP_BLK_END()")
ENDIF
N1035 AX[_X]=IC(0) AX[_Y]=IC(0) IP[_X]=AC(0) IP[_Y]=AC(0)
N1040 AX[_X]=_ARX AX[_Y]=_ARY AX[_Z]=IC(_SDZI*_RFT) IP[_X]=AC((_BR-_WZR-_AR)*COS(_EWH1)) IP[_Y]=AC((_BR-_WZR-_AR)*SIN(_EWH1))
N1045 G90 G0 G40 AX[_X]=_ARX3 AX[_Y]=_ARY3
_M_KBA:
ELSE
SBLON
N1060 NORM CDOF CFTCP G[7]=_GG7 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1) AX[_Z]=_RFP-(_AD-_SDZI)*_RFT
SBLOF
WRTPR("TMP_BLK_BEG()",1)
N1065 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_EWHR) AX[_Y]=_BR*SIN(_EWHR) AX[_Z]=_RFP-_GT*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_AZHR
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
WRTPR("TMP_BLK_END()",1)
ELSE
WRTPR("TMP_BLK_END()")
ENDIF
N1070 AX[_X]=IC(0) AX[_Y]=IC(0) IP[_X]=AC(0) IP[_Y]=AC(0)
N1075 AX[_X]=_ARX AX[_Y]=_ARY AX[_Z]=IC(_SDZI*_RFT) IP[_X]=AC((_BR-_WZR-_AR)*COS(_EWHR)) IP[_Y]=AC((_BR-_WZR-_AR)*SIN(_EWHR))
N1080 G90 G0 G40 AX[_X]=_ARX3 AX[_Y]=_ARY3
ENDIF
IF(_IX<_AZB)
IF(_I1==1)
_BR=_BR+_ZUB
IF(_ZB[6]==0)
IF(_BR>_AP1-_SDZI)
_ZB[6]=1
_ROWI=1
ENDIF
ENDIF
IF(_ZB[6]==1)
IF(_ROWI==1)
_SWH1=_EWH3
_EWH1=_SWH1+_RWH1
_EWH2=_EWH1
_ROWI=0
ELSE
_RWH1=_RWH
_SWH1=_EWH3
_EWH1=_SWH1+_RWH1
_EWH2=_EWH1
ENDIF
ELSE
_SWH1=_EWH3
_EWHR=_SWH1+_RWHR
_EWH2=_EWHR
ENDIF
ENDIF
ENDIF
SBLON
IF(_ZB[6]==1)
N1090 G0 AX[_Z]=_RFP+_SDZI*_RFT
ELSE
N1092 G0 AX[_Z]=_RFP-(_AD-_SDZI)*_RFT
ENDIF
SBLOF
ENDFOR
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[8])
ENDIF
ELSE
_BR=_BRF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[7])
ENDIF
IF(_FALD==0)OR(_AZB==1)
_AR=_SDZI
IF(_BR-_WZR<_AR)
_AR=(_BR-_WZR)/2
ENDIF
_ARYM=(_BR-_WZR-_AR)*SIN(_EWH1) _ARXM=(_BR-_WZR-_AR)*COS(_EWH1)
_BETA=ATAN2(_AR+_WZR,_BR-_WZR-_AR)
_BETA3=ATAN2(_AR,_BR-_WZR-_AR)
_VWH3=_BETA3
_VWH2=_BETA
IF(_GG1==3)
_VWH3=-_VWH3
_VWH2=-_VWH2
ENDIF
_HYP3=SQRT(POT(_BR-_WZR-_AR)+POT(_AR))
_HYP=SQRT(POT(_BR-_WZR-_AR)+POT(_AR+_WZR))
_EWH3=_EWH2+_VWH3
_EWH2=_EWH2+_VWH2
_ARX3=_HYP3*COS(_EWH3) _ARY3=_HYP3*SIN(_EWH3)
_ARX=_HYP*COS(_EWH2) _ARY=_HYP*SIN(_EWH2)
SBLON
EXECSTRING(_S_FFP1)
N1200 NORM CDOF CFTCP G[7]=_GG7 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1)
SBLOF
IF(_EINFH==1)
N1210 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1) AX[_Z]=_RFP IP[_X]=IC(-_EINRAD*COS(_SWH1)) IP[_Y]=IC(-_EINRAD*SIN(_SWH1)) TURN=_AZH0
ENDIF
WRTPR("TMP_BLK_BEG()",1)
N1220 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_EWH1) AX[_Y]=_BR*SIN(_EWH1) AX[_Z]=_RFP-_GT*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_AZH1
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
WRTPR("TMP_BLK_END()",1)
ELSE
WRTPR("TMP_BLK_END()")
ENDIF
N1230 AX[_X]=IC(0) AX[_Y]=IC(0) IP[_X]=AC(0) IP[_Y]=AC(0)
N1235 AX[_X]=_ARX AX[_Y]=_ARY AX[_Z]=IC(_SDZI*_RFT) IP[_X]=AC((_BR-_WZR-_AR)*COS(_EWH1)) IP[_Y]=AC((_BR-_WZR-_AR)*SIN(_EWH1))
N1240 G90 G0 G40 AX[_X]=_ARX3 AX[_Y]=_ARY3
ELSE
SBLON
EXECSTRING(_S_FFP1)
N1300 NORM CDOF CFTCP G[7]=_GG7 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1)
SBLOF
IF(_EINFH==1)
N1310 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_SWH1) AX[_Y]=_BR*SIN(_SWH1) AX[_Z]=_RFP IP[_X]=IC(-_EINRAD*COS(_SWH1)) IP[_Y]=IC(-_EINRAD*SIN(_SWH1)) TURN=_AZH0
ENDIF
WRTPR("TMP_BLK_BEG()",1)
N1320 G[1]=_GG1 G[10]=_GG10 AX[_X]=_BR*COS(_EWH1) AX[_Y]=_BR*SIN(_EWH1) AX[_Z]=_RFP-_GT*_RFT IP[_X]=AC(0) IP[_Y]=AC(0) TURN=_AZH1
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
WRTPR("TMP_BLK_END()",1)
ELSE
WRTPR("TMP_BLK_END()")
ENDIF
N1330 AX[_X]=IC(0) AX[_Y]=IC(0) IP[_X]=AC(0) IP[_Y]=AC(0)
_AWHAL=_EWH1+_HALB
FOR _IX=1 TO _AZB-2
N1340 AX[_X]=(_BR-_ZUB)*COS(_AWHAL) AX[_Y]=(_BR-_ZUB)*SIN(_AWHAL) IP[_X]=AC((_ZUB/2)*COS(_EWH1)) IP[_Y]=AC((_ZUB/2)*SIN(_EWH1))
_BR=_BR-_ZUB
N1350 AX[_X]=_BR*COS(_EWH1) AX[_Y]=_BR*SIN(_EWH1) IP[_X]=AC(0) IP[_Y]=AC(0)
ENDFOR
N1360 AX[_X]=(_BR-_ZUB)*COS(_AWHAL) AX[_Y]=(_BR-_ZUB)*SIN(_AWHAL) IP[_X]=AC((_ZUB/2)*COS(_EWH1)) IP[_Y]=AC((_ZUB/2)*SIN(_EWH1))
N1370 G90 G0 G40 AX[_X]=0 AX[_Y]=0
N1371 AX[_Z]=IC(_SDZI*_RFT)
ENDIF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[8])
ENDIF
SBLON
N1400 G0 AX[_Z]=_RFP+_SDZI*_RFT
SBLOF
ENDIF
N900 _FINE:
IF ((_ARTIS[0]==11) OR (_ARTIS[11]==3))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_VAR4==0)
IF (_ZB[2]==1)
IF (_ZB[3]==0)
_I3=1
ELSE
_I3=-1
ENDIF
ENDIF
SBLON
N902 G0 G90 AX[_Z]=_RTP
N903 G40 AX[_X]=_CRAD-_FAL-_H2 AX[_Y]=-_I3*_H2+(_WZR+0.001/_WZMF)*_I3
ELSE
SBLON
N902 G0 G90 AX[_Z]=_RTP
ENDIF
IF(($P_MC)AND(_SC_PC==1))
N910 G40 G90 AX[_X]=0 AX[_Y]=0
ENDIF
IF(_SPIND==2)
SBLOF
CUST_TECHCYC(4+_UMODE)
SBLON
ENDIF
IF(_ANFAS==1)
IF(_ZZSD[8]==0)
CYCLE203(0,_FS,_ZFS)
ENDIF
ENDIF
$P_CYCFRAME=_RE_CYCFR
N904 RET
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_X]=0
$AA_MEAS_POINT1[_Y]=0
$AA_MEAS_POINT1[_Z]=_RFP+_RFT*_SDIS
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_X])+POT($AA_MEAS_POINT2[_Y])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_Z,_RFP+_RFT*_SDIS)
_SC_POS[0]=$P_CYCFRAME[_X,TR]
_SC_POS[1]=$P_CYCFRAME[_Y,TR]
_SC_POS[2]=$P_CYCFRAME[_Z,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_FEHL1:STOPRE
N730801 SETAL(61000)
RET
_FEHL2:STOPRE
N730802 SETAL(61002)
RET
_FEHL3:STOPRE
N730803 SETAL(61102)
RET
_FEHL4:STOPRE
N730804 SETAL(61105)
RET
_FEHL5:STOPRE
N730805 SETAL(61108)
RET
_FEHL6:STOPRE
N730806 SETAL(61109)
RET
_FEHL7:STOPRE
N730807 SETAL(61110)
RET
_FEHL8:STOPRE
N730808 SETAL(61111)
RET
_FEHL9:STOPRE
N730809 SETAL(61117)
RET
_FEHL10: STOPRE
N730810 SETAL(61022,_SERR)
RET
_FEHL11: STOPRE
N730811 SETAL(61101)
RET
_FEHL12: STOPRE
N730812 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL13: STOPRE
N730813 SETAL(61019,"(_MIDA)")
RET
_FEHL14: STOPRE
N730814 SETAL(61246)
RET
_FEHL15: STOPRE
N730815 SETAL(62106)
RET
_FEHL16: STOPRE
N730816 SETAL(61010)
RET
_FEHL17: STOPRE
N730817 SETAL(61610)
RET
_FEHL20: STOPRE
N730820 SETAL(61156)
RET
_FEHL21: STOPRE
N730821 SETAL(61019,"(_GMODE: dec3)")
_FEHL22: STOPRE
N730822 SETAL(61158)
RET
_FEHL23: STOPRE
N730823 SETAL(61019,"(_DMODE: dec2)")
RET
_FEHL24: STOPRE
N730824 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N730825 SETAL(61155)
RET
_FEHL26: STOPRE
N730826 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL27: STOPRE
N730827 SETAL(61159)
RET
_FEHL30: STOPRE
N730830 SETAL(61154)
RET
_FEHL31: STOPRE
N730831 SETAL(61019,"(_GMODE: dec5)")
RET
_FEHL32: STOPRE
N730832 SETAL(61019,_SERR)
RET
_FEHL33: STOPRE
N730833 SETAL(61216)
RET
_FEHL35: STOPRE
N730835 SETAL(61012)
RET
_FEHL36: STOPRE
N730836 SETAL(61061)
RET
_FEHL37: STOPRE
N730837 SETAL(61019,"(_DMODE: dec5)")
RET
_FEHL39: STOPRE
N730839 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N730840 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_PROG_EVENT_SPF
PROC PROG_EVENT DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.007 ;DATE: 2024-04-24
;Programm Handling (Block Search,Reset,Power-On,..)
DEF INT _TCI,_G0,_PTRAFO,_G90,S_DFM,_ABS,_ORD,_APP,_MODE
DEF AXIS _AX,_B,_SP
DEF REAL _A1_S,_A2_S
DEF STRING[32] S_TRA
SBLOF
IF($P_PROG_EVENT==5)
IF NOT($MCS_FUNCTION_MASK_TECH B_AND 'H80000') ;Bit 19=0 SEATRAON (TRAFO Aktivierung) nach Sachsuchlauf ausfhren
SEATRAON()
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")
IF(($NT_IDENT[$P_TRAFO_PARSET MOD 1000,0] _DEC5)>=2)
S_DFM=1
S_TRA=$PC_TRAFO_NAME
_B=$PC_TRAFO_ROT_CHAN_AX_IN[1]
_SP=$PC_TRAFO_ROT_CHAN_AX_IN[2]
ENDIF
ENDIF
ENDIF
;Call partial program CYCPE1US.SPF to PROG_EVENT.SPF for user.
;CYCPE1US.SPF must be loaded in directory CMA.DIR or CUS.DIR.
IF(ISFILE("/_N_CMA_DIR/_N_CYCPE1US_SPF")) OR (ISFILE("/_N_CUS_DIR/_N_CYCPE1US_SPF")) OR (ISFILE("/_N_CMA_DIR/_N_CYCPE1US_CPF")) OR (ISFILE("/_N_CUS_DIR/_N_CYCPE1US_CPF"))
N101 CYCPE1US
ENDIF
;
;Call partial program CYCPE1MA.SPF to PROG_EVENT.SPF for manufacturers.
;CYCPE1MA.SPF must be loaded in directory CMA.DIR.
IF (ISFILE("/_N_CMA_DIR/_N_CYCPE1MA_SPF")) OR (ISFILE("/_N_CMA_DIR/_N_CYCPE1MA_CPF"))
N102 CYCPE1MA
ENDIF
;
IF($P_PROG_EVENT==5)
IF NOT($MCS_FUNCTION_MASK_TECH B_AND 'H8000')
IF($MN_MM_NUM_TOOL_CARRIER)
$MC_TOOL_CARRIER_RESET_VALUE=$P_TC
ENDIF
ENDIF
_SC_SSL=$P_LINENO[0]
IF($MCS_FUNCTION_MASK_TECH B_AND 'B100000')AND($P_SEARCHL==5)
CYCLE207
ELSE
IF($MCS_FUNCTION_MASK_TECH B_AND 'B1000')
IF($MCS_TECHNOLOGY==1)
N10 F_S_ASUP
ENDIF
IF($MCS_TECHNOLOGY==2)
N20 E_S_ASUP
ENDIF
ENDIF
ENDIF
IF NOT($MCS_FUNCTION_MASK_TECH B_AND 'H10000')
IF(ISFILE("/_N_CST_DIR/_N_CYCLE800_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CYCLE800_SPF"))OR(ISFILE("/_N_CUS_DIR/_N_CYCLE800_SPF"))
_TCI=$P_TC _PTRAFO=$P_TRAFO
CYCLE213(_TCI)
IF (_TCI>0) AND (($P_SEARCHL==2)OR($P_SEARCHL==4))
IF NOT((_PTRAFO B_AND 'H200')OR(_PTRAFO B_AND 'H100'))
_G0=$P_GG[1] _G90=$P_GG[14]
IF (_TC_ST==20)OR(_TC_ST==21)OR(_TC_ST==22)OR(_TC_ST==30)
IF(_TC_ST==20)OR(_TC_ST==22)OR(_TC_ST==30)
_AX=AXNAME($TC_CARR35[_TCI])
_A1_S=$AC_RETPOINT[_AX]
$TC_CARR13[_TCI]=_A1_S $TC_CARR14[_TCI]=0
IF($MA_ROT_IS_MODULO[_AX])
_A1_S=((_A1_S MOD $MA_MODULO_RANGE[_AX])+360) MOD $MA_MODULO_RANGE[_AX]
ENDIF
ENDIF
IF(_TC_ST==20)OR(_TC_ST==21)
_AX=AXNAME($TC_CARR36[_TCI])
_A2_S=$AC_RETPOINT[_AX]
$TC_CARR14[_TCI]=_A2_S
IF($MA_ROT_IS_MODULO[_AX])
_A2_S=((_A2_S MOD $MA_MODULO_RANGE[_AX])+360) MOD $MA_MODULO_RANGE[_AX]
ENDIF
ENDIF
N30 CUST_800(34,_TCI,_A1_S,_A2_S)
ENDIF
G[1]=_G0 G[14]=_G90
ENDIF
IF(_TC_ST==21)OR(_TC_ST==22)OR(_TC_ST==30)OR(_TC_ST==31)
N40 CUST_800(35,_TCI,_TC_A1,_TC_A2)
ENDIF
ENDIF
ENDIF
ENDIF
IF NOT($MCS_FUNCTION_MASK_TECH B_AND 'H20000')
IF(S_DFM)
IF(($P_SEARCHL==2)OR($P_SEARCHL==4))
IF(NOT _E_SSL_JS_T)
IF(_B<>NO_AXIS)
_A1_S=$AC_RETPOINT[_B]
ELSE
_A1_S=0
ENDIF
IF(_SP<>NO_AXIS)
_A2_S=$AC_RETPOINT[_SP]
ELSE
_A2_S=0
ENDIF
IF($MCS_TURN_TOOL_FIXING==1)
_MODE=1012000
ELSE
_MODE=0012000
ENDIF
N50 CYCLE809(S_TRA,_A1_S,_A2_S,_MODE,0,0,12)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
;
;Call partial program CYCPE_US.SPF to PROG_EVENT.SPF for user.
;CYCPE_US.SPF must be loaded in directory CMA.DIR or CUS.DIR.
IF(ISFILE("/_N_CMA_DIR/_N_CYCPE_US_SPF")) OR (ISFILE("/_N_CUS_DIR/_N_CYCPE_US_SPF")) OR (ISFILE("/_N_CMA_DIR/_N_CYCPE_US_CPF")) OR (ISFILE("/_N_CUS_DIR/_N_CYCPE_US_CPF"))
N100 CYCPE_US
ENDIF
;
;Call partial program CYCPE_MA.SPF to PROG_EVENT.SPF for manufacturers.
;CYCPE_MA.SPF must be loaded in directory CMA.DIR.
IF(ISFILE("/_N_CMA_DIR/_N_CYCPE_MA_SPF")) OR (ISFILE("/_N_CMA_DIR/_N_CYCPE_MA_CPF"))
N110 CYCPE_MA
ENDIF
;
SBLON
IF($P_PROG_EVENT==5)
IF(_SC_INTERPOL)
CYCLE806(1000+_SC_INTERPOL)
ENDIF
IF(($P_SEARCHL==4) AND (_E_SEARCH[2] <> -1))
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF ISAXIS(_ABS)
_SC_POS[6]=$AC_RETPOINT[$P_AXN1]
ENDIF
IF ISAXIS(_ORD)
_SC_POS[7]=$AC_RETPOINT[$P_AXN2]
ENDIF
IF ISAXIS(_APP)
_SC_POS[8]=$AC_RETPOINT[$P_AXN3]
ENDIF
_SC_POS[9]=1
ENDIF
IF($P_SEARCHL==5)
IF(S_SERUPRO_MODE==0)
N190 REPOSA RMEBL
ENDIF
ELSE
N200 REPOSA
ENDIF
ENDIF
IF ($MN_M_NO_FCT_EOP<>-1) GOTOF _M32
M17
_M32: M=$MN_M_NO_FCT_EOP
_M17: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE76_SPF
PROC CYCLE76(REAL _RTP,REAL _RFP,REAL _SDIS,REAL __DP,REAL _DPR,REAL _LENG,REAL _WID,REAL _CRAD,REAL __PA,REAL __PO,REAL __STA,REAL __MID,REAL __FAL,REAL __FALD,REAL _FFP1,REAL _FFD,INT __CDIR,INT __VARI,REAL __AP1,REAL __AP2,REAL _FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.010 ;DATE: 2024-05-24
;Cycle support HMIsl
;Rectangular spigot milling
; Fehlerhandling mit ACTBLOCNO
DEF AXIS _XX,_YY,_ZZ
DEF INT _AS1,_AS2,_BA1,_DIR,_FRK,_H1,_HH2,_CDIR,_VARI,_TYP,_VORZ,_ZZSD[15],_HELIKAL
DEF REAL _FAK1,_FAK2,_LP1,_LP2,_TX,_TY,_MIRR,_DP,_PA,_PO,_MID,_FAL,_FALD,_AP1,_AP2,_ZFS,_OFFN,_OFFN1,_STA,S_TOFFR
DEF STRING[70] _KNAME
DEF FRAME _RE_CYCFR
DEF INT _TEMP,_DMODE1,_DMODE5,_AMODE1,_AMODE3,_GMODE4,_GMODE5
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE76_MPF",_PROG,_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE76_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<< _ZSD[1]<<" _ZSD[2]="<<_ZSD[2]<<" _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"CYCLE76("<<_RTP<<","<<_RFP<<","<<_SDIS<<","<<__DP<<","<<_DPR<<","<<_LENG<<","<<_WID<<","<<_CRAD<<","<<__PA<<","<<__PO<<","<<__STA<<","<<__MID<<","<<__FAL<<","<<__FALD<<","<<_FFP1<<","<<_FFD<<","<<__CDIR<<","<<__VARI<<","<<__AP1<<","<<__AP2<<","<<_FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF ((_DPR==0)AND(__VARI _DEC1<>5))
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DIAMCYCOF
IF ($P_GG[30]>1)
COMPOF
ENDIF
_DP=__DP _PA=__PA _PO=__PO _MID=__MID _FAL=__FAL _FALD=__FALD _CDIR=__CDIR _VARI=__VARI _ZFS=__ZFS _AP1=__AP1 _AP2=__AP2
_STA=__STA
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
_GMODE4=_GMODE _DEC4
_GMODE5=_GMODE _DEC5
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL36
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
GOTOF _FEHL36
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "F_PI_REC")AND(_PROG <> "E_PI_REC") )
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_GMODE4=1
_STA=0
_GMODE5=1
ENDIF
IF($P_MC)
_STA=_STA+_SC_WO
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL21
IF(_GMODE4 == 0)
IF(_ZSD[2]<>-1)
IF _ZSD[2]
_ZZSD[2]=0
ELSE
_ZZSD[2]=1
ENDIF
ENDIF
ELSE
_ZZSD[2]=_GMODE4
ENDIF
IF(_ZZSD[2]<0)OR(_ZZSD[2]>5) GOTOF _FEHL32
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_XX=$P_AXN1 _YY=$P_AXN2
_PA=$P_EP[_XX]*_FAK1 _PO=$P_EP[_YY]*_FAK1
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL37
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') AND ($AN_NCK_VERSION>=480300))
_RE_CYCFR=$P_CYCFRAME
ELSE
GOTOF _FEHL35
ENDIF
_BA1=_VARI _DEC1
IF(_BA1<1)OR(_BA1>5)OR(_BA1==3)OR(_BA1==4) GOTOF _FEHL1
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL2
IF(_BA1==1)AND(_MID<0) GOTOF _FEHL6
_VARI=_BA1+300
IF (_BA1==5)
_OFFN1=$P_OFFN*_FAK2
_AMODE3=(_AMODE _DEC3)
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(_RTP==_RFP) GOTOF _FEHL11
_HH2=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_ZFS)*_HH2
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
IF (_RFP<>_DP)
_HH2=(_RFP-_DP)/ABS(_RFP-_DP)
ENDIF
_ZFS=ABS(_RFP-_ZFS)
_AMODE3=1
ENDIF
IF(_ZZSD[1]==0)
_MID=_ZFS+_SDIS
ELSE
_MID=_ZFS
ENDIF
_FALD=0 _FAL=_FS
_FFD=_FFP1
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_OFFN=$P_OFFN*_FAK2 _VARI=_VARI-3
_AP1=_LENG+$P_TOOLR*_FAK1
ENDIF
_VARI=_HELIKAL*100000+_VARI
IF _BA1<>5
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(((_DPR) AND (_AMODE1==0)) OR (_AMODE1==1))
IF(_RTP==_RFP) GOTOF _FEHL11
_HH2=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_DPR)*_HH2
IF (_RFP==_DP) GOTOF _FEHL30
ELSE
IF (_RFP-_DP)<>0
_HH2=(_RFP-_DP)/ABS(_RFP-_DP)
ELSE
GOTOF _FEHL29
ENDIF
ENDIF
ENDIF
IF ((_RTP<>_RFP) AND (_RFP<>_DP))
IF ((_RFP-_DP)/ABS(_RFP-_DP))<>((_RTP-_RFP)/ABS(_RTP-_RFP)) GOTOF _FEHL11
ENDIF
GOTOF _MARKE1
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF _BA1<>5
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
ENDIF
IF(((_DPR>0) AND (_AMODE1==0)) OR (_AMODE1==1))
_DP=_RFP-_DPR
ENDIF
IF (_RFP-_DP)<>0
_HH2=(_RFP-_DP)/ABS(_RFP-_DP)
ELSE
GOTOF _FEHL29
ENDIF
_MARKE1:
IF (_CDIR<0)OR(_CDIR>3) GOTOF _FEHL16
_MIRR=$P_ACTFRAME[_XX,MI]+$P_ACTFRAME[_YY,MI]
IF(_MIRR==1)
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF _HH2<0
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_ZZ,MI])
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
_DIR=2
IF _CDIR==2 GOTOF _MY3 IF _CDIR<>3 GOTOF _MY2
_DIR=3
GOTOF _MY3
_MY2:
IF($P_SMODE[0]==1) OR ($P_SMODE[0]==3)
_H1=$P_SDIR[$P_MSNUM]
IF(_H1<3)OR(_H1>4)
GOTOF _FEHL10
ENDIF
ELSE
GOTOF _FEHL10
ENDIF
IF(_H1<3)OR(_H1>4)
_DIR=3
SETAL(62101)
GOTOF _MY3
ENDIF
IF (((_CDIR==0)AND(_H1==4))OR((_CDIR==1)AND(_H1==3)))
_DIR=3
ELSE
_DIR=2
ENDIF
_MY3:
_FRK=_DIR+39
IF($P_TOOLR<0) GOTOF _FEHL5
_AP1=ABS(_AP1) _AP2=ABS(_AP2)
IF (_BA1<>5)
IF(_AP1<(ABS(_LENG)+2*_FAL))OR(_AP2<(ABS(_WID)+2*_FAL)) GOTOF _FEHL4
ENDIF
_TX=0 _TY=0
CASE _ZZSD[2] OF 0 GOTOF _M12 2 GOTOF _M12 3 GOTOF _M3 4 GOTOF _M4 5 GOTOF _M5 DEFAULT GOTOF _M0
_M12: _TX=_LENG/2 _TY=_WID/2
GOTOF _MREF
_M3: _TX=-_LENG/2 _TY=_WID/2
GOTOF _MREF
_M4: _TX=_LENG/2 _TY=-_WID/2
GOTOF _MREF
_M5: _TX=-_LENG/2 _TY=-_WID/2
GOTOF _MREF
_M0: _TX=0 _TY=0
_MREF:
_LENG=ABS(_LENG) _WID=ABS(_WID) _CRAD=ABS(_CRAD)
IF ($P_ADT[1]==140) AND (NOT(_BA1==5)) AND ($P_ADT[7]>$P_ADT[6])
S_TOFFR=$P_TOFFR*_FAK1
IF ($P_ADT[7]-$P_ADT[6])<>0
TOFFR=($P_TOFFR+ABS($P_ADT[7]-$P_ADT[6]))*_FAK1
ENDIF
ENDIF
_AS1=3 _AS2=3
_LP1=((_AP1-_LENG)/2-_FAL+_SDIS)/2
_LP2=_LP1
_KNAME="_E_SP_REC_ANF:_E_SP_REC_END"
IF _BA1==1
_CONT2[0]=_LENG/2+_FAL _CONT2[1]=0
_CONT2[2]=_LENG/2+_FAL _CONT2[3]=_WID/2+_FAL
_CONT2[4]=_CRAD+_FAL
_FAL=0
ELSE
_CONT2[0]=_LENG/2 _CONT2[1]=0
_CONT2[2]=_LENG/2 _CONT2[3]=_WID/2
_CONT2[4]=_CRAD
ENDIF
_CONT2[5]=_LENG/2-_CRAD _CONT2[6]=_WID/2-_CRAD
_CONT2[7]=_DIR
N11 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_PA*1/_FAK1,_YY,_PO*1/_FAK1)
N13 $P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,_STA)
N14 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_TX*1/_FAK1,_YY,_TY*1/_FAK1)
IF _GMODE _DEC3==2
_ZSD[8]=1
ENDIF
IF (_HELIKAL==1)
_FFD=_FFP1
ENDIF
N30 CYCLE72(_KNAME,_RTP,_RFP,_SDIS,_DP,_MID,_FAL,_FALD,_FFP1,_FFD,_VARI,_FRK,_AS1,_LP1,_FFD,_AS2,_LP2)
IF _GMODE _DEC3==2
_ZSD[8]=-1
ENDIF
IF(_ZZSD[8]==1)
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_XX,_SC_POS[0],_YY,_SC_POS[1],_ZZ,_SC_POS[2])
_SC_POS[0]=$P_CYCFRAME[_XX,TR]
_SC_POS[1]=$P_CYCFRAME[_YY,TR]
_SC_POS[2]=$P_CYCFRAME[_ZZ,TR]
ENDIF
$P_CYCFRAME=_RE_CYCFR
IF(_BA1==5)
IF(_ZZSD[8]==0)
OFFN=_OFFN1
ENDIF
ENDIF
IF(($P_MC)AND(_SC_PC==1))
N920 G0 G40 G90 AX[_XX]=_PA AX[_YY]=_PO
ENDIF
IF $P_ADT[1]==140
TOFFR=S_TOFFR
ENDIF
RET
_FEHL1: STOPRE
N707601 SETAL(61002)
RET
_FEHL2: STOPRE
N707602 SETAL(61019,"(__VARI: dec6)")
RET
_FEHL4: STOPRE
N707604 SETAL(61215)
RET
_FEHL5: STOPRE
N707605 SETAL(61112)
RET
_FEHL6: STOPRE
N707606 SETAL(61610)
RET
_FEHL7: STOPRE
N707607 SETAL(62106)
RET
_FEHL10:STOPRE
N707610 SETAL(61102)
RET
_FEHL11:STOPRE
N707611 SETAL(61101)
RET
_FEHL16:STOPRE
N707616 SETAL(61109)
RET
_FEHL18: STOPRE
N707618 SETAL(61019,_SERR)
RET
_FEHL20: STOPRE
N707620 SETAL(61156)
RET
_FEHL21: STOPRE
N707621 SETAL(61019,"(_GMODE: dec3/_ZSD[8])")
RET
_FEHL22: STOPRE
N707622 SETAL(61158)
RET
_FEHL23: STOPRE
N707623 SETAL(61159)
RET
_FEHL24: STOPRE
N707624 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL26: STOPRE
N707626 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL29: STOPRE
N707629 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N707630 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL32: STOPRE
N707632 SETAL(61019,"(_GMODE: dec4/_ZSD[2])")
RET
_FEHL34: STOPRE
N707634 SETAL(61273)
RET
_FEHL35: STOPRE
N707635 SETAL(61016)
RET
_FEHL36: STOPRE
N707636 SETAL(61019,"(_DMODE: dec5)")
RET
_FEHL37: STOPRE
N707637 SETAL(61012)
RET
_FEHL39: STOPRE
N707639 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N707640 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_E_SP_REC_ANF:
IF(_CONT2[7]==2)
N100 G1 G90 AX[$P_AXN1]=_CONT2[0] AX[$P_AXN2]=_CONT2[1]
IF(_CONT2[6]>0)
N105 AX[$P_AXN2]=-_CONT2[6]
ENDIF
IF(_CONT2[4]>0)
N110 G2 AX[$P_AXN1]=_CONT2[5] AX[$P_AXN2]=-_CONT2[3] CR=_CONT2[4]
ENDIF
IF(_CONT2[5]>0)
N115 G1 AX[$P_AXN1]=-_CONT2[5]
ENDIF
IF(_CONT2[4]>0)
N120 G2 AX[$P_AXN1]=-_CONT2[2] AX[$P_AXN2]=-_CONT2[6] CR=_CONT2[4]
ENDIF
IF(_CONT2[6]>0)
N130 G1 AX[$P_AXN2]=_CONT2[6]
ENDIF
IF(_CONT2[4]>0)
N135 G2 AX[$P_AXN1]=-_CONT2[5] AX[$P_AXN2]=_CONT2[3] CR=_CONT2[4]
ENDIF
IF(_CONT2[5]>0)
N140 G1 AX[$P_AXN1]=_CONT2[5]
ENDIF
IF(_CONT2[4]>0)
N145 G2 AX[$P_AXN1]=_CONT2[2] AX[$P_AXN2]=_CONT2[6] CR=_CONT2[4]
ENDIF
N150 G1 AX[$P_AXN2]=_CONT2[1]
ELSE
N200 G1 G90 AX[$P_AXN1]=_CONT2[0] AX[$P_AXN2]=_CONT2[1]
IF(_CONT2[6]>0)
N205 AX[$P_AXN2]=_CONT2[6]
ENDIF
IF(_CONT2[4]>0)
N210 G3 AX[$P_AXN1]=_CONT2[5] AX[$P_AXN2]=_CONT2[3] CR=_CONT2[4]
ENDIF
IF(_CONT2[5]>0)
N215 G1 AX[$P_AXN1]=-_CONT2[5]
ENDIF
IF(_CONT2[4]>0)
N220 G3 AX[$P_AXN1]=-_CONT2[2] AX[$P_AXN2]=_CONT2[6] CR=_CONT2[4]
ENDIF
IF(_CONT2[6]>0)
N230 G1 AX[$P_AXN2]=-_CONT2[6]
ENDIF
IF(_CONT2[4]>0)
N235 G3 AX[$P_AXN1]=-_CONT2[5] AX[$P_AXN2]=-_CONT2[3] CR=_CONT2[4]
ENDIF
IF(_CONT2[5]>0)
N240 G1 AX[$P_AXN1]=_CONT2[5]
ENDIF
IF(_CONT2[4]>0)
N245 G3 AX[$P_AXN1]=_CONT2[2] AX[$P_AXN2]=-_CONT2[6] CR=_CONT2[4]
ENDIF
N250 G1 AX[$P_AXN2]=_CONT2[1]
ENDIF
_E_SP_REC_END:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE77_SPF
PROC CYCLE77(REAL _RTP,REAL _RFP,REAL _SDIS,REAL __DP,REAL _DPR,REAL _CDIAM,REAL __PA,REAL __PO,REAL __MID,REAL __FAL,REAL __FALD,REAL _FFP1,REAL _FFD,INT __CDIR,INT __VARI,REAL __AP1,REAL _FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.010 ;DATE: 2024-05-24
;Cycle support HMIsl
;Circular spigot milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _H1,_HH2,_FRK,_AS1,_AS2,_BA1,_DIR,_CDIR,_VARI,_ZZSD[15],_HELIKAL
DEF REAL _FAK1,_FAK2,_LP1,_LP2,_A0,_X0,_Y0,_MIRR,_DP,_PA,_PO,_MID,_FAL,_FALD,_AP1,_ZFS,_OFFN,_OFFN1,_PA_IN,_PO_IN,S_TOFFR
DEF STRING[70] _KNAME
DEF INT _TEMP,_DMODE1,_DMODE5,_AMODE1,_AMODE3,_GMODE5
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE77_MPF",_PROG,_SERR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE77_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1]<<" _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"CYCLE77("<<_RTP<<","<<_RFP<<","<<_SDIS<<","<<__DP<<","<<_DPR<<", "<<_CDIAM<<","<<__PA<<","<<__PO<<","<<__MID<<","<<__FAL<<","<<__FALD<<","<<_FFP1<<","<<_FFD<<","<<__CDIR<<","<<__VARI<<","<<__AP1<<","<<_FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF ((_DPR==0)AND(__VARI _DEC1<>5))
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DIAMCYCOF
IF ($P_GG[30]>1)
COMPOF
ENDIF
_DP=__DP _PA=__PA _PO=__PO _MID=__MID _FAL=__FAL _FALD=__FALD _CDIR=__CDIR _VARI=__VARI _ZFS=__ZFS _AP1=__AP1
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
_GMODE5=_GMODE _DEC5
IF (_DMODE5<0)OR(_DMODE5>1)
_SERR=<<"(_DMODE: dec5)"
GOTOF _FEHL18
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
_SERR=<<"(_DMODE: dec5)"
GOTOF _FEHL18
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "F_PI_CIR")AND(_PROG <> "E_PI_CIR") )
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_GMODE5=1
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL21
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL20
ENDIF
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_XX=$P_AXN1 _YY=$P_AXN2
_PA=$P_EP[_XX]*_FAK1 _PO=$P_EP[_YY]*_FAK1
_PA_IN=_PA _PO_IN=_PO
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL35
_X0=_PA _Y0=_PO
_BA1=_VARI _DEC1
IF(_BA1<1)OR(_BA1>5)OR(_BA1==3)OR(_BA1==4) GOTOF _FEHL1
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL2
IF(_BA1==1)AND(_MID<0) GOTOF _FEHL6
_VARI=_BA1+300
IF (_BA1==5)
_OFFN1=$P_OFFN*_FAK2
_AMODE3=(_AMODE _DEC3)
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL26
IF(_AMODE3==1)
IF(_RTP==_RFP) GOTOF _FEHL11
_HH2=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_ZFS)*_HH2
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
IF (_RFP<>_DP)
_HH2=(_RFP-_DP)/ABS(_RFP-_DP)
ENDIF
_ZFS=ABS(_RFP-_ZFS)
_AMODE3=1
ENDIF
IF(_ZZSD[1]==0)
_MID=_ZFS+_SDIS
ELSE
_MID=_ZFS
ENDIF
_FALD=0 _FAL=_FS
_FFD=_FFP1
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_OFFN=$P_OFFN*_FAK2 _VARI=_VARI-3
_AP1=_CDIAM+$P_TOOLR*_FAK1
ENDIF
_VARI=_HELIKAL*100000+_VARI
IF _BA1<>5
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(((_DPR) AND (_AMODE1==0)) OR (_AMODE1==1))
IF(_RTP==_RFP) GOTOF _FEHL11
_HH2=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_DPR)*_HH2
IF (_RFP==_DP) GOTOF _FEHL30
ELSE
IF (_RFP-_DP)<>0
_HH2=(_RFP-_DP)/ABS(_RFP-_DP)
ELSE
GOTOF _FEHL29
ENDIF
ENDIF
ENDIF
IF ((_RTP<>_RFP) AND (_RFP<>_DP))
IF ((_RFP-_DP)/ABS(_RFP-_DP))<>((_RTP-_RFP)/ABS(_RTP-_RFP)) GOTOF _FEHL11
ENDIF
IF (_CDIR<0)OR(_CDIR>3) GOTOF _FEHL16
_MIRR=$P_ACTFRAME[_XX,MI]+$P_ACTFRAME[_YY,MI]
IF(_MIRR==1)
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF _HH2<0
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_ZZ,MI])
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
_DIR=2
IF _CDIR==2 GOTOF _MY3 IF _CDIR<>3 GOTOF _MY2
_DIR=3
GOTOF _MY3
_MY2:
IF($P_SMODE[0]==1) OR ($P_SMODE[0]==3)
_H1=$P_SDIR[$P_MSNUM]
IF(_H1<3)OR(_H1>4)
GOTOF _FEHL10
ENDIF
ELSE
GOTOF _FEHL10
ENDIF
IF(_H1<3)OR(_H1>4)
_DIR=3
SETAL(62101)
GOTOF _MY3
ENDIF
IF (((_CDIR==0)AND(_H1==4))OR((_CDIR==1)AND(_H1==3)))
_DIR=3
ELSE
_DIR=2
ENDIF
_MY3:
_FRK=_DIR+39
_AP1=ABS(_AP1) _CDIAM=ABS(_CDIAM)
IF(_CDIAM==0) GOTOF _FEHL3
IF($P_TOOLR<0) GOTOF _FEHL5
IF (_BA1<>5)
IF(_AP1<(_CDIAM+2*_FAL)) GOTOF _FEHL4
ENDIF
IF ($P_ADT[1]==140) AND (NOT(_BA1==5)) AND ($P_ADT[7]>$P_ADT[6])
S_TOFFR=$P_TOFFR*_FAK1
IF ($P_ADT[7]-$P_ADT[6])<>0
TOFFR=($P_TOFFR+ABS($P_ADT[7]-$P_ADT[6]))*_FAK1
ENDIF
ENDIF
_AS1=3 _AS2=3
_LP1=((_AP1-_CDIAM)/2-_FAL+_SDIS)/2
_LP2=_LP1
IF _BA1==1
_PA=_PA+COS(_A0)*(_CDIAM/2+_FAL) _PO=_PO+SIN(_A0)*(_CDIAM/2+_FAL)
_FAL=0
ELSE
_PA=_PA+COS(_A0)*_CDIAM/2 _PO=_PO+SIN(_A0)*_CDIAM/2
ENDIF
_KNAME="_E_SP_CIR_ANF:_E_SP_CIR_END"
_CONT2[0]=_PA _CONT2[1]=_PO _CONT2[2]=_X0 _CONT2[3]=_Y0
_CONT2[4]=_DIR
IF _GMODE _DEC3==2
_ZSD[8]=1
ENDIF
IF (_HELIKAL==1)
_FFD=_FFP1
ENDIF
N30 CYCLE72(_KNAME,_RTP,_RFP,_SDIS,_DP,_MID,_FAL,_FALD,_FFP1,_FFD,_VARI,_FRK,_AS1,_LP1,_FFD,_AS2,_LP2)
IF _GMODE _DEC3==2
_ZSD[8]=-1
ENDIF
IF(_BA1==5)
IF(_ZZSD[8]==0)
OFFN=_OFFN1
ENDIF
ENDIF
IF(($P_MC)AND(_SC_PC==1))
N920 G0 G40 G90 AX[_XX]=_PA_IN AX[_YY]=_PO_IN
ENDIF
IF $P_ADT[1]==140
TOFFR=S_TOFFR
ENDIF
RET
_FEHL1: STOPRE
N707701 SETAL(61002)
RET
_FEHL2: STOPRE
N707702 SETAL(61019,"(__VARI: dec6)")
RET
_FEHL3: STOPRE
N707703 SETAL(61213)
RET
_FEHL4: STOPRE
N707704 SETAL(61215)
RET
_FEHL5: STOPRE
N707705 SETAL(61112)
RET
_FEHL6: STOPRE
N707706 SETAL(61610)
RET
_FEHL7: STOPRE
N707707 SETAL(62106)
RET
_FEHL10:STOPRE
N707710 SETAL(61102)
RET
_FEHL11:STOPRE
N707711 SETAL(61101)
RET
_FEHL16:STOPRE
N707716 SETAL(61109)
RET
_FEHL18: STOPRE
N707718 SETAL(61019,_SERR)
RET
_FEHL20: STOPRE
N707720 SETAL(61156)
RET
_FEHL21: STOPRE
N707721 SETAL(61019,"(_GMODE: dec3/_ZSD[8])")
RET
_FEHL22: STOPRE
N707722 SETAL(61158)
RET
_FEHL23: STOPRE
N707723 SETAL(61159)
RET
_FEHL24: STOPRE
N707724 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL26: STOPRE
N707726 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL29: STOPRE
N707729 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N707730 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL34: STOPRE
N707734 SETAL(61273)
RET
_FEHL35: STOPRE
N707735 SETAL(61012)
RET
_FEHL39: STOPRE
N707739 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N707740 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_E_SP_CIR_ANF:
IF(_CONT2[4]==2)
N20 G01 G90 AX[$P_AXN1]=_CONT2[0] AX[$P_AXN2]=_CONT2[1]
N22 G02 IP[$P_AXN1]=AC(_CONT2[2]) IP[$P_AXN2]=AC(_CONT2[3])
ELSE
N30 G01 G90 AX[$P_AXN1]=_CONT2[0] AX[$P_AXN2]=_CONT2[1]
N32 G03 IP[$P_AXN1]=AC(_CONT2[2]) IP[$P_AXN2]=AC(_CONT2[3])
ENDIF
_E_SP_CIR_END:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE78_SPF
PROC CYCLE78(REAL _RTP,REAL _RFP,REAL _SDIS,REAL __DP,REAL _ADPR,REAL _FDPR,REAL __LDPR,REAL _DIAM,REAL _PIT,INT _PITA,REAL __DAM,REAL _MDEP,INT _VARI,INT _CDIR,REAL _GE,REAL _FFD,REAL _FRDP,REAL __FFR,REAL __FFP2,INT _FFA,STRING[15] _PITM,STRING[20] _PTAB,STRING[20] _PTABA,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.005 ;DATE: 2024-04-03
;Cycle support HMIsl
;Drill and thread milling
DEF REAL _DV1,_DV2,_DV3,_DV6,_DV7,_DV9,_FAK3,_SKX,_SKY,_SKZ,_FFD_R
DEF REAL _DV10,_DV11,_WR,_DV12,_DV13,_DV14,_DV16,_DV17,_DP,_DPR,_LDPR
DEF REAL _DV19,_FAK1,_RST,_HH5,_HH8,_FFR,_FFP2,_DAM
DEF INT TNummer,_DNUM,_RICH,_MIRR,_PD,_CRM,_SRDP,_MILL,_WTYP,_GG10
DEF INT _TEPA=0
DEF INT _AMODE1,_AMODE2,_DMODE1,_VARS,_VARI5,_VARI2,_VARI3,_VARI4,_ZAE,_TYP,_HH1
DEF AXIS _X, _Y, _Z
DEF INT _TEMP,_SDIR
DEF STRING[30] _S_FFD,_S_FFD_R,_S_FRDP,_S_FFR,_S_FFR_25,_S_FFP2,_S_FFP2_25
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE78_MPF"
DEF FRAME _RE_CYCFR
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE78_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE78("<<_RTP<<","<<_RFP<<","<<_SDIS<<","<<__DP<<","<<_ADPR<<","<<_FDPR<<","<<__LDPR<<","<<_DIAM<<","<<_PIT<<","<<_PITA<<","<<__DAM<<","<<_MDEP<<","<<_VARI<<","<<_CDIR<<","<<_GE<<","<<_FFD<<","<<_FRDP<<","<<__FFR<<","<<__FFP2<<","<<_FFA<<","<<_PITM<<","<< _PTAB<<","<<_PTABA<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL31
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL32
ENDIF
DIAMCYCOF
IF ($P_GG[30]>1)
COMPOF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_VARS=_PITA _DAM=__DAM _FFR=__FFR _FFP2=__FFP2 _DP=__DP _LDPR=__LDPR
_DPR=ABS(_DPR) _FDPR=ABS(_FDPR) _SDIS=ABS(_SDIS) _VARI=ABS(_VARI)
_FFA=ABS(_FFA) _FFD=ABS(_FFD) _FRDP=ABS(_FRDP) _FFR=ABS(_FFR)
_FFP2=ABS(_FFP2)
IF(_FFD<=0)OR(_FFR<=0)GOTOF _FEHL6
IF(_FFA _DEC1 == 0)
_S_FFD="G94 F"<<_FFD
ELSE
_S_FFD="G95 F"<<_FFD
ENDIF
IF(_TEPA==0)
IF(_FFA _DEC1 == 0)
IF(_FFD<(0.15*($P_S[$P_MSNUM])))
_FFD_R=0.3*_FFD
ELSE
_FFD_R=($P_S[$P_MSNUM])*0.1
ENDIF
ELSE
IF(_FFD<0.15)
_FFD_R=0.3*_FFD
ELSE
_FFD_R=0.1
ENDIF
ENDIF
ELSE
_FFD_R=0.3*_FFD
ENDIF
IF(_FFA _DEC1 == 0)
_S_FFD_R="G94 F"<<_FFD_R
ELSE
_S_FFD_R="G95 F"<<_FFD_R
ENDIF
IF(_VARI _DEC4 == 0)
IF(_TEPA==0)
IF(_FFA _DEC2 == 0)
_FRDP=0.1*($P_S[$P_MSNUM])
ELSE
_FRDP=0.1
ENDIF
ENDIF
ENDIF
IF(_FFA _DEC2 == 0)
_S_FRDP="G94 F"<<_FRDP
ELSE
_S_FRDP="G95 F"<<_FRDP
ENDIF
IF(_FFA _DEC3 == 0)
_S_FFR="G94 F"<<_FFR
_S_FFR_25="G94 F"<<_FFR*2.5
ELSE
_WTYP=$P_ADT[1]
IF(_WTYP<100)OR(_WTYP>199) GOTOF _FEHL42
_S_FFR="G95 FZ="<<_FFR
_S_FFR_25="G95 FZ="<<_FFR*2.5
ENDIF
IF(_FFA _DEC4 == 0)
_S_FFP2="G94 F"<<_FFP2
_S_FFP2_25="G94 F"<<_FFP2*2.5
ELSE
_WTYP=$P_ADT[1]
IF(_WTYP<100)OR(_WTYP>199) GOTOF _FEHL42
_S_FFP2="G95 FZ="<<_FFP2
_S_FFP2_25="G95 FZ="<<_FFP2*2.5
ENDIF
_SDIR=$P_SDIR[$P_MSNUM]
IF(_SDIR<3) OR (_SDIR>4) GOTOF _FEHL15
_RE_CYCFR=$P_CYCFRAME
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
IF ($P_GG[6]==2) AND ($MC_AXCONF_GEOAX_ASSIGN_TAB[1]==0)
GOTOF _FEHL12
ELSE
_Z=$P_AXN3
ENDIF
_X=$P_AXN1 _Y=$P_AXN2
_SKX=$P_ACTFRAME[_X,SC] _SKY=$P_ACTFRAME[_Y,SC] _SKZ=$P_ACTFRAME[_Z,SC]
$P_CYCFRAME=$P_CYCFRAME:CSCALE(_X,1/_SKX,_Y,1/_SKY,_Z,1/_SKZ)
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>1) GOTOF _FEHL24
_AMODE2=(_AMODE _DEC2)
IF(_AMODE2<0)OR(_AMODE2>1) GOTOF _FEHL25
IF(_AMODE1==0)
_DPR=0
ELSE
_DPR=ABS(_DP)
_DP=0
ENDIF
_VARI5 = _VARI _DEC5 _VARI2 = _VARI _DEC2
_VARI3 = _VARI _DEC3 _VARI4 = _VARI _DEC4
IF (_VARI5<0) OR (_VARI5>1) GOTOF _FEHL33
IF (_VARI2<0) OR (_VARI2>1) GOTOF _FEHL34
IF (_VARI3<0) OR (_VARI3>1) GOTOF _FEHL35
IF (_VARI4<0) OR (_VARI4>1) GOTOF _FEHL36
IF (_AMODE2==1)
IF (_DAM>0)
_DAM=-(ABS(_DAM))/100
ENDIF
ENDIF
IF (_AMODE2==0)
_DAM=ABS(_DAM)
ENDIF
IF _DAM<-1 GOTOF _FEHL37
_MILL=_CDIR MOD 10
_PD=_VARI5 _CRM=_VARI2 _SRDP=_VARI4 _RICH=_VARI3
IF(_RICH>1) GOTOF _FEHL10
IF _DP==0
IF(_RTP==_RFP)GOTOF _FEHL11
_HH1=(_RTP-_RFP)/ABS(_RTP-_RFP)
ELSE
_HH1=(_RFP-_DP)/ABS(_RFP-_DP)
IF (_RTP==_RFP)
_RTP=_RFP+_SDIS*_HH1
ENDIF
ENDIF
IF _DPR==0
_DPR=(_RFP-_DP)*_HH1
IF _DPR==0 GOTOF _FEHL30
IF NOT(_RTP==_RFP)
IF (((_RTP-_RFP)/ABS(_RTP-_RFP))<>_HH1) GOTOF _FEHL11
ENDIF
ENDIF
_DV12=_DAM
IF(_DAM==0)
_DAM=_DPR
ENDIF
IF(_VARS<1) OR (_VARS>4) GOTOF _FEHL9
IF(_VARS==1)
_RST=_PIT
ENDIF
IF(_VARS==2)
_RST=$MN_SCALING_VALUE_INCH/_PIT
ENDIF
IF(_VARS==3)
_RST=$MN_SCALING_VALUE_INCH*_PIT
ENDIF
IF(_VARS==4)
_RST=_PIT*$PI
ENDIF
_RST=_RST*_FAK3
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<>160) GOTOF _FEHL39
ELSE
GOTOF _FEHL3
ENDIF
_MIRR=$P_ACTFRAME[_X,MI]+$P_ACTFRAME[_Y,MI]
IF $P_ACTFRAME[_Z,MI]==1
IF ($P_GG[22]<>2) GOTOF _FEHL41
_MIRR=ABS(_MIRR-1)
ENDIF
_DV1=_DIAM/2
_DV13=_RFP+_SDIS*_HH1
_DV14=_RST*0.15
_DNUM=$P_TOOL
IF(_DNUM==0) GOTOF _FEHL1
TNummer=$P_TOOLNO
IF (TNummer==0) GOTOF _FEHL3
_WR=(($P_ADT[6])+($P_ADT[15]))*_FAK1
IF(_WR<0.75*_DV1) GOTOF _FEHL2
IF(_WR>=_DIAM/2) GOTOF _FEHL7
IF(_SRDP>1) GOTOF _FEHL10
IF(_SRDP==0)
_LDPR=0.0
ELSE
IF(_LDPR==0.0) GOTOF _FEHL5
ENDIF
IF(_FDPR>_DPR)
_FDPR=_DPR
ENDIF
_DV6=_FDPR
_DV11=1.3*_RST+(_DV1-_WR)+_GE
IF(_CDIR==0)
_DV11=_RST/3+_GE
ENDIF
_DV2=_DPR-_DV11
_DV3=_DV1+_WR
IF(_PD>1) GOTOF _FEHL10
IF(_PD==1)
_DV9=_ADPR
ELSE
_DV9=0
ENDIF
_DV19=_DAM
CFC
SBLON
G0 G90 NORM AX[_Z]=_DV13
SBLOF
IF(_PD==1)
IF(_FDPR>0)
IF(_DV9>_FDPR)
_DV9=_FDPR
ENDIF
ENDIF
GOTOF LevelPD
ELSE
GOTOF LevelOPD
ENDIF
LevelPD:
EXECSTRING(_S_FFD_R)
G1 G60 G91 AX[_Z]=-(_DV9+_SDIS)*_HH1
IF(_FDPR>(_DPR-_LDPR))
EXECSTRING(_S_FFD)
AX[_Z]=-(_DPR-_LDPR-_DV9)*_HH1
EXECSTRING(_S_FRDP)
AX[_Z]=-(_FDPR-(_DPR-_LDPR))*_HH1
ELSE
EXECSTRING(_S_FFD)
AX[_Z]=-(_FDPR-_DV9)*_HH1
ENDIF
GOTOF LevelWeiter
LevelOPD:
IF (_FDPR>(_DPR-_LDPR))
EXECSTRING(_S_FFD)
G1 G60 G91 AX[_Z]=-(_DPR-_LDPR+_SDIS)*_HH1
EXECSTRING(_S_FRDP)
AX[_Z]=-(_FDPR-(_DPR-_LDPR))*_HH1
ELSE
_DV6=_FDPR+_SDIS
EXECSTRING(_S_FFD)
G1 G60 G91 AX[_Z]=-(_FDPR+_SDIS)*_HH1
ENDIF
LevelWeiter:
IF(_DAM>=0) AND (_FDPR<_DPR)
IF(_PD==0) AND (_DV12>0)
_DV6=_DV6-_SDIS
ENDIF
WHILE _DV6<_DPR
IF(_PD==1) OR (_DV12>0)
SBLON
G0 AX[_Z]=+_DV6*_HH1
AX[_Z]=-(_DV6-1.0*_FAK3)*_HH1
SBLOF
ELSE
IF(_FDPR>0)
SBLON
G0 AX[_Z]=+(_DV6-_SDIS)*_HH1
AX[_Z]=-((_DV6-1.0*_FAK3)+_SDIS)*_HH1
SBLOF
_DV6=_DV6-1*_FAK3
ENDIF
ENDIF
_DV7=_DV6
_DV6=(_DV6+_DV19)
IF(_DV6>_DPR)
_DV6=_DPR
_DV19=(_DPR-_DV7)
ENDIF
IF(_DV6>(_DPR-_LDPR))
IF(_DV7<(_DPR-_LDPR))
EXECSTRING(_S_FFD)
N40G1 AX[_Z]=-((_DPR-_LDPR)-_DV7+1.0*_FAK3)*_HH1
EXECSTRING(_S_FRDP)
N45AX[_Z]=-(_DV19-((_DPR-_LDPR)-_DV7))*_HH1
ELSE
EXECSTRING(_S_FRDP)
G1 AX[_Z]=-(_DV19+1.0*_FAK3)*_HH1
ENDIF
ELSE
EXECSTRING(_S_FFD)
IF(_PD==0) AND (_DV12==0)
G1 AX[_Z]=-(_DV19)*_HH1-_SDIS*_HH1
ELSE
G1 AX[_Z]=-(_DV19+1.0*_FAK3)*_HH1
ENDIF
ENDIF
ENDWHILE
ELSE
IF(_FDPR==0)
_HH8=1 _HH5=-_DV9*_HH1
ELSE
_HH8=_FDPR _HH5=-_FDPR*_HH1
ENDIF
IF (_HH8<_DPR)
MAR1:
SBLON
G90 G0 AX[_Z]=_RFP
AX[_Z]=(_HH5+1*_FAK3*_HH1)+_RFP
SBLOF
_HH8=-_HH8*_DAM
IF(_HH8>=_MDEP)GOTOF _MMD1
_HH8=_MDEP
_MMD1:
_HH5=_HH5-_HH8*_HH1
IF((_DPR-_LDPR-ABS(_HH5))>=0)GOTOF _MA6
_HH5=-(_DPR-_LDPR)*_HH1
_MA6:
EXECSTRING(_S_FFD)
G1 AX[_Z]=_HH5+_RFP
IF (ABS(_HH5)<(_DPR-_LDPR)) GOTOB MAR1
IF(_SRDP==1)
EXECSTRING(_S_FRDP)
G1 AX[_Z]=_RFP-_DPR*_HH1
ENDIF
ENDIF
ENDIF
IF(_RICH==1)
IF(_MILL>0)
_DV2=_DV2+_RST+(2*_DV14)
_DV11=_DV11-_RST-(2*_DV14)
ELSE
_DV2=_DV2-_RST-(2*_DV14)
_DV11=_DV11+_RST+(2*_DV14)
ENDIF
ENDIF
IF(_CRM>1) GOTOF _FEHL10
SBLON
IF(_CRM==1)
G91 G0 AX[_Z]=_DPR*_HH1
AX[_Z]=-_DV2
ELSE
G91 G0 AX[_Z]=_DV11*_HH1
ENDIF
SBLOF
_DV16=_DV3-0.02*_FAK3
_DV17=_DV1-0.02*_FAK3
IF (_RICH==1)
_DV14=_DV14*(-1)
_RST=_RST*(-1)
ENDIF
IF (_MILL<0)OR(_MILL>4) GOTOF _FEHL8
IF (_MILL==2)OR(_MILL==3) GOTOF _FEHL8
IF(_MILL==1) OR (_MILL==4)
EXECSTRING(_S_FFR)
IF(_MIRR==1) XOR (_HH1==-1)
G1 G41 G[10]=_GG10 AX[_X]=0 AX[_Y]=_WR
ELSE
G1 G42 G[10]=_GG10 AX[_X]=0 AX[_Y]=_WR
ENDIF
IF(_MILL==1)
IF(_MIRR==1) XOR (_HH1==-1)
G3 AX[_X]=0 AX[_Y]=-_DV3 AR=180 AX[_Z]=-_DV14*_HH1
ELSE
G2 AX[_X]=0 AX[_Y]=-_DV3 AR=180 AX[_Z]=-_DV14*_HH1
ENDIF
AX[_X]=0 AX[_Y]=0 IP[_X]=0 IP[_Y]=_DV1 AX[_Z]=-_RST*_HH1
EXECSTRING(_S_FFR_25)
AX[_X]=0 AX[_Y]=_DV3 AR=180 AX[_Z]=-_DV14*_HH1
ELSE
IF(_MIRR==1) XOR (_HH1==-1)
G3 AX[_X]=0 AX[_Y]=-_DV16 AR=180 AX[_Z]=-_DV14*_HH1
ELSE
G2 AX[_X]=0 AX[_Y]=-_DV16 AR=180 AX[_Z]=-_DV14*_HH1
ENDIF
AX[_X]=0 AX[_Y]=0 IP[_X]=0 IP[_Y]=_DV17 AX[_Z]=-_RST*_HH1
EXECSTRING(_S_FFR_25)
AX[_X]=0 AX[_Y]=_DV16 AR=180 AX[_Z]=-_DV14*_HH1
SBLON
G0 G40 G60 AX[_Y]=-_WR
SBLOF
EXECSTRING(_S_FFP2)
IF(_MIRR==1) XOR (_HH1==-1)
G1 G42 G[10]=_GG10 AX[_X]=0 AX[_Y]=_WR
G2 AX[_X]=0 AX[_Y]=-_DV3 AR=180 AX[_Z]=_DV14*_HH1
ELSE
G1 G41 G[10]=_GG10 AX[_X]=0 AX[_Y]=_WR
G3 AX[_X]=0 AX[_Y]=-_DV3 AR=180 AX[_Z]=_DV14*_HH1
ENDIF
AX[_X]=0 AX[_Y]=0 IP[_X]=0 IP[_Y]=_DV1 AX[_Z]=_RST*_HH1
EXECSTRING(_S_FFP2_25)
AX[_X]=0 AX[_Y]=_DV3 AR=180 AX[_Z]=_DV14*_HH1
ENDIF
ELSE
EXECSTRING(_S_FFR)
IF(_MIRR==1) XOR (_HH1==-1)
G1 G42 G[10]=_GG10 AX[_X]=0 AX[_Y]=_WR
G2 AX[_X]=0 AX[_Y]=-_DV3 AR=180 AX[_Z]=_DV14*_HH1
ELSE
G1 G41 G[10]=_GG10 AX[_X]=0 AX[_Y]=_WR
G3 AX[_X]=0 AX[_Y]=-_DV3 AR=180 AX[_Z]=_DV14*_HH1
ENDIF
N5AX[_X]=0 AX[_Y]=0 IP[_X]=0 IP[_Y]=_DV1 AX[_Z]=_RST*_HH1
EXECSTRING(_S_FFR_25)
N6AX[_X]=0 AX[_Y]=_DV3 AR=180 AX[_Z]=_DV14*_HH1
ENDIF
GewFertig:
SBLON
G0 G40 G60 AX[_Y]=-_WR
G0 G90 AX[_Z]=_RTP
SBLOF
MSG("")
$P_CYCFRAME=_RE_CYCFR
MSG()
RET
_FEHL1:STOPRE
N707801 SETAL(61328)
RET
_FEHL2:STOPRE
N707802 SETAL(61220)
RET
_FEHL3:STOPRE
N707803 SETAL(61320)
RET
_FEHL4:STOPRE
N707804 SETAL(61014)
RET
_FEHL5:STOPRE
N707805 SETAL(61610)
RET
_FEHL6:STOPRE
N707806 SETAL(61003)
RET
_FEHL7:STOPRE
N707807 SETAL(61105)
RET
_FEHL8:STOPRE
N707808 SETAL(61109)
RET
_FEHL9:STOPRE
N707809 SETAL(61001)
RET
_FEHL10:STOPRE
N707810 SETAL(61002)
RET
_FEHL11: STOPRE
N707811 SETAL(61101)
RET
_FEHL12: STOPRE
N707812 SETAL(61005)
RET
_FEHL15:STOPRE
N707815 SETAL(61102)
RET
_FEHL22: STOPRE
N707822 SETAL(61158)
RET
_FEHL23: STOPRE
N707823 SETAL(61159)
RET
_FEHL24: STOPRE
N707824 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N707825 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL29: STOPRE
N707829 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N707830 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N707831 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL32: STOPRE
N707832 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_FEHL33: STOPRE
N707833 SETAL(61019,"(_VARI: dec5)")
RET
_FEHL34: STOPRE
N707834 SETAL(61019,"(_VARI: dec2)")
RET
_FEHL35: STOPRE
N707835 SETAL(61019,"(_VARI: dec3)")
RET
_FEHL36: STOPRE
N707836 SETAL(61019,"(_VARI: dec4)")
RET
_FEHL37: STOPRE
N707837 SETAL(61019,"(_DAM)")
RET
_FEHL39: STOPRE
N707839 SETAL(61212)
RET
_FEHL40: STOPRE
N707840 SETAL(61218)
RET
_FEHL41: STOPRE
N707841 SETAL(61801)
RET
_FEHL42: STOPRE
N707842 SETAL(61216)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE79_SPF
PROC CYCLE79(REAL _RTP,REAL __RFP,REAL __SDIS,REAL __DP,INT _NUM,REAL __SWL,REAL _PA,REAL _PO,REAL _STA,REAL __RC,REAL _AP1,REAL __MIDA,REAL __MID,REAL __FAL,REAL __FALD,REAL _FFP1,INT __CDIR,INT _VARI,REAL _FS,REAL __ZFS,INT _GMODE,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.011 ;DATE: 2024-05-31
;Cycle support HMIsl
;Multi edge cycle
DEF AXIS _XX,_YY,_ZZ
DEF INT _CDIR,_WTYP,_GG10
DEF INT _I,_MUN,_MUN_ACT,_J,_J0,_EBEN,_T,_TIEF,_SII,_MIRR,_M3_4,_MODE,_MOD1,_FFA_P1,_FFA_D,_STAFA,_ERR,_PMZ,_DMODE1,_DMODE5,_AMODE1,_AMODE2,_AMODE3,_ZZSD[9]
DEF INT _II,_ARTIS[16],_HELIKAL,_FRK,_VARI72,_ERROR
DEF REAL _DP,_FAL,_FALD,_MID,_MIDA,_RC,_RFP,_SDIS,_SWL,_ZFS,S_WB,S_DIST
DEF REAL _DEB,_DTI,_PHI,_ALFA,_BETA,_GAMA,_RUM,_RIN,_RUV,_RIV,_LP,_R,_RP,_RZ,_RPZ,_RVF,_RVFZ,_RPFZ,_KATOS,_ZITOS,_FASOS,_NORM,_NORM1,_NORM2,_NORM3,_USCH,_USCHI,_USCHI1
DEF REAL _WR,_SKX,_SKZ,_FAK1,_FAK2,_FFD,_XS,_YS,_ZS,_PR,_KANT_S[2],_KANT_E[2],_FASE_S[2],_FASE_E[2],_RUND_S[2],_RUND_E[2],_RUND_M[2],_RUND_D,_TOOLOFFN,_SDIZ,_PRAD
DEF REAL _FRND1_S[2],_FRND1_E[2],_FRND1_M[2],_FRND1_D,_FRND2_S[2],_FRND2_E[2],_FRND2_M[2],_FRND2_D
DEF REAL _START_S[2],_START_E[2],_START_M[2],_START_D,_ZIEL_S[2],_ZIEL_E[2],_DEPART_S[2],_DEPART_E[2],_DEPART_M[2],_DEPART_D,_SP1[3],_SP2[3],_VPKT[2],_WPKT[2],S_TOFFR
DEF REAL _KT[2,11],_S[2],_S1_A[2],_S1_E[2],_S1_M[2],_S1_G,_S2_A[2],_S2_E[2],_S2_M[2],_S2_G,_KR_A[2],_KR_E[2],_KR_M[2],_RADIUS,_DIST_E,_DIR,_START_HELI[2],_KTS[60,6]
DEF BOOL _ZUSTELL,_RUNDUNG,_DRAN,_DRIN,_OPTIMIZE,_SCHLIGRND,_FALG,_DEEP1,S_DISC_CUTTER,S_IS_ST,_GRUND
DEF STRING[30] _S_FFP1,_S_FFC
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE79_MPF",_PROG
DEF STRING[141] _KNAME
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE79_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
IF ($P_ADT[1]==150) OR ($P_ADT[1]==151)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Cutting Edge Width")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[10]="<<$P_GG[10]<<"    ; G60/G64/G641/...")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE79("<<_RTP<<","<<_RFP<<","<<__SDIS<<","<<__DP<<","<<_NUM<<","<<__SWL<<","<<_PA<<","<<_PO<<","<<_STA<<","<<__RC<<","<<_AP1<<","<<__MIDA<<","<<__MID<<","<<__FAL<<","<<__FALD<<","<<_FFP1<<","<<__CDIR<<","<<_VARI<<","<<_FS<<","<<__ZFS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (_VARI _DEC1<>1)
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DIAMCYCOF
IF ($P_GG[30]>1)
COMPOF
ENDIF
_GG10=$P_GG[10]
IF ((_GG10 < 2) AND (__RC <> 0))
_GG10=2
ENDIF
_CDIR=__CDIR _DP=__DP _SDIS=__SDIS _SWL=__SWL _RC=__RC _RFP=__RFP _MIDA=__MIDA _MID=__MID _FAL=__FAL _FALD=__FALD _ZFS=__ZFS
_PRAD=_AP1/2
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL30
ENDIF
IF (_DMODE5==1)
IF ($P_MC)
GOTOF _FEHL30
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "F_MI_EDG") )
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_STA=0
ENDIF
_WR=$P_TOOLR*_FAK1
IF(_WR<=0) GOTOF _FEHL6
IF(_SDIS<=0) GOTOF _FEHL8
IF(_NUM<=0) GOTOF _FEHL11
G40 G90 NORM
_RE_CYCFR=$P_CYCFRAME
IF(_FFP1<=0) GOTOF _FEHL2
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL29
ENDIF
_S_FFP1="G95 FZ="<<_FFP1
ELSE
_S_FFP1="G94 F"<<_FFP1
ENDIF
ENDIF
_S_FFC="G94 F"<<$SCS_CIRCLE_RAPID_FEED
IF(_FFP1<=0) GOTOF _FEHL2
_FFA_P1=$P_GG[15]
_FFD=$SCS_CIRCLE_RAPID_FEED
IF(_FFD<=0) GOTOF _FEHL16
_FFA_D=2
_ZZSD[8]=_GMODE _DEC3
IF(_ZZSD[8]<0)OR(_ZZSD[8]>2) GOTOF _FEHL17
IF(_ZZSD[8]==2)
_ZZSD[8]=1
ELSE
_ZZSD[8]=0
ENDIF
IF(_DMODE1<0)OR(_DMODE1>3) GOTOF _FEHL19
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
_PA=$P_EP[_XX]*_FAK1 _PO=$P_EP[_YY]*_FAK1
ELSE
GOTOF _FEHL26
ENDIF
ELSE
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_VARI _DEC1<>5)
_AMODE2=_AMODE _DEC2
IF(_AMODE2<0)OR(_AMODE2>1) GOTOF _FEHL22
IF(_AMODE2==1)
IF(_MIDA<0)OR(_MIDA>100)
GOTOF _FEHL21
ELSE
_MIDA=_MIDA/100*(2*_WR)
ENDIF
ENDIF
ENDIF
IF(_VARI _DEC1<>5)
_AMODE1=_AMODE _DEC1
IF(_AMODE1<0)OR(_AMODE1>1) GOTOF _FEHL23
IF(_AMODE1==1)
IF(_RTP==_RFP) GOTOF _FEHL24
IF(_RTP>_RFP)
_DP=_RFP-ABS(_DP)
ELSE
_DP=_RFP+ABS(_DP)
ENDIF
ENDIF
IF(_RFP==_DP) GOTOF _FEHL28
IF(_DP<_RFP)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_PA*1/_FAK1,_YY,_PO*1/_FAK1)
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL4
_SKX=$P_ACTFRAME[_XX,SC] _SKZ=$P_ACTFRAME[_ZZ,SC]
_MIDA=_MIDA/_SKX _MID=_MID/_SKZ _FAL=_FAL/_SKX _FALD=_FALD/_SKZ _SDIS=_SDIS/_SKX
_WR=_WR/_SKX _TOOLOFFN=0
IF($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100')
_ZZSD[1]=1 _SDIZ=0
ELSE
_ZZSD[1]=0 _SDIZ=_SDIS
ENDIF
_MODE=_VARI MOD 10
IF(_MODE<1)OR(_MODE==4)OR(_MODE>5) GOTOF _FEHL1
_HELIKAL=(_VARI _DEC6)
IF ( (_HELIKAL<0)OR(_HELIKAL>1) ) GOTOF _FEHL33
IF(_HELIKAL==1)AND(_MODE==5) GOTOF _FEHL1
IF(_MODE==5)
_AMODE3=_AMODE _DEC3
IF(_AMODE3<0)OR(_AMODE3>1) GOTOF _FEHL25
IF(_AMODE3==1)
IF(_RTP==_RFP) GOTOF _FEHL24
_PMZ=(_RTP-_RFP)/ABS(_RTP-_RFP)
_DP=_RFP-ABS(_ZFS)*_PMZ
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
IF (_RFP<>_DP)
_PMZ=(_RFP-_DP)/ABS(_RFP-_DP)
ENDIF
_ZFS=ABS(_RFP-_ZFS) _AMODE3=1
ENDIF
_MID=ABS(_ZFS) _MIDA=_FS _FALD=0 _FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_TOOLOFFN=$P_OFFN*_FAK2
_MODE=3
ENDIF
IF ($P_ADT[1]==140) AND (NOT(_MODE==5)) AND ($P_ADT[7]>$P_ADT[6])
S_TOFFR=$P_TOFFR*_FAK1
_TOOLOFFN=(ABS($P_ADT[7]-$P_ADT[6]))*_FAK1
IF ($P_ADT[7]-$P_ADT[6])<>0
TOFFR=($P_TOFFR+ABS($P_ADT[7]-$P_ADT[6]))*_FAK1
ENDIF
ENDIF
_WR=_WR+_TOOLOFFN
IF (_RTP<>_RFP) AND (_RFP<>_DP)
IF ((_RFP-_DP)/ABS(_RFP-_DP))<>((_RTP-_RFP)/ABS(_RTP-_RFP)) GOTOF _FEHL24
ELSE
IF(_RFP==_DP) GOTOF _FEHL28
ENDIF
IF(_MODE==3)
_FALG=FALSE
_MODE=2 _MIDA=_WR
ELSE
_FALG=TRUE
ENDIF
IF(_MODE==2)
_USCH=_FAL+_SDIS+_WR
_FAL =0
_FALD=0
ENDIF
_MOD1=TRUNC(_VARI/10) MOD 10
IF(_NUM==1)
IF((_MOD1==0)AND(_SWL<_PRAD))OR((_MOD1==1)AND(_SWL<0))
_DEEP1=TRUE
ELSE
_DEEP1=FALSE
ENDIF
ENDIF
_SWL=ABS(_SWL)
IF(_SWL==0) GOTOF _FEHL12
IF(_VARI _DEC1<>5)
IF(_MIDA>2*_WR) GOTOF _FEHL7
IF(_MIDA<=0)AND(_FALG==TRUE) GOTOF _FEHL21
IF(_MID<=0) GOTOF _FEHL10
IF(_FAL>_MIDA)AND(_MODE==2) GOTOF _FEHL3
IF(_FALD>_MID)AND(_MODE==2) GOTOF _FEHL3
IF(_PRAD<=0) GOTOF _FEHL9
ENDIF
S_IS_ST=FALSE
S_DISC_CUTTER=FALSE
IF($MCS_FUNCTION_MASK_MILL B_AND 'H04')AND($P_TOOL)AND(($P_ADT[1]==150)OR($P_ADT[1]==151))
S_DISC_CUTTER=TRUE
IF(_HELIKAL==1) GOTOF _FEHL31
IF(SUBSTR($P_PROG[$P_STACK-1],3,8)=="F_MI_EDG")
S_IS_ST=TRUE
ENDIF
S_WB=$P_ADT[9]*_FAK1
IF(S_WB>0)AND(S_WB>ABS(_DP-_RFP)) GOTOF _FEHL31
IF(S_WB>0)AND(S_WB<ABS(_MID)) GOTOF _FEHL32
ENDIF
IF(_NUM<=2)
IF(_MOD1==0)
IF(_NUM==1)
IF(_SWL+_FAL>=2*_PRAD) GOTOF _FEHL13
_SWL=2*SQRT(POT(_PRAD)-POT(_SWL-_PRAD))
ELSE
IF(_SWL/2+_FAL>=_PRAD) GOTOF _FEHL13
_SWL=2*SQRT(POT(_PRAD)-POT(_SWL/2))
ENDIF
ENDIF
IF(_SWL>2*_PRAD) GOTOF _FEHL13
ENDIF
IF(_NUM>=3)
IF(_MOD1==0)
_SWL=_SWL*TAN(180/_NUM)
ENDIF
IF(0.5*_SWL/TAN(180/_NUM)+_FAL>_PRAD)
GOTOF _FEHL13
ENDIF
IF(_AMODE _DEC4 <0)OR(_AMODE _DEC4 >1) GOTOF _FEHL18
IF(_RC<0) GOTOF _FEHL20
IF(_AMODE _DEC4 == 1)
IF(_RC>0.5*_SWL/(1+SIN(180*(_NUM-2)/(2*_NUM)))) GOTOF _FEHL14
_RC=-_RC
ELSE
IF(_RC>0.5*_SWL*TAN(180*(_NUM-2)/(2*_NUM))) GOTOF _FEHL14
ENDIF
ENDIF
IF (_VARI _DEC2==0)AND((2*_PRAD<=ABS(__SWL)+ABS(2*__FAL))) GOTOF _FEHL3
IF(_SC_TOOL_VALI[0]<>0)
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF(_ARTIS[0] MOD 10 <>1)
GOTOF _FEHL15
ENDIF
_II=_ARTIS[0] DIV 10
IF((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL15
ELSE
_ARTIS[11]=_II MOD 10
IF(_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF(_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL15
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
IF(($P_ACTFRAME[_XX,MI]+$P_ACTFRAME[_YY,MI])==1)
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF(_RFP<_DP)
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
IF($P_ACTFRAME[_ZZ,MI])
IF(_CDIR==0)OR(_CDIR==2)
_CDIR=_CDIR+1
ELSE
_CDIR=_CDIR-1
ENDIF
ENDIF
_MIRR=0
_STAFA=1
IF(_CDIR==2)OR(_CDIR==3)
IF(_CDIR==2)
_MIRR=1
_STAFA=-1
ENDIF
ELSE
IF($P_SMODE[$P_MSNUM]<>0)
_M3_4=$P_SDIR[$P_MSNUM]
IF(_M3_4<3)OR(_M3_4>4) GOTOF _FEHL5
IF((_M3_4==3)AND(_CDIR==0))OR((_M3_4==4)AND(_CDIR==1))
_MIRR=1
_STAFA=-1
ENDIF
ELSE
SETAL(62101)
ENDIF
ENDIF
IF(_NUM<=2)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-90)
ELSE
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,180/_NUM)
ENDIF
IF(_MIRR)
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
IF(_NUM<=2)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,180)
ENDIF
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,_STAFA*_STA)
IF(_VARI _DEC1<>5)
_RFP=_RFP+_SDIZ*_PMZ
ENDIF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[7])
ENDIF
IF(_NUM<=2)
_PHI=2*ASIN(0.5*_SWL/_PRAD)
_RIN=_PRAD*COS(_PHI/2)+_FAL
_RUM=_PRAD+_WR+_SDIS
IF(_NUM==1)AND(_DEEP1)
_RIN=-_RIN+2*_FAL
ENDIF
_EBEN=ROUND((_PRAD-_RIN)/_MIDA)
IF(_EBEN<(_PRAD-_RIN)/_MIDA)
_EBEN=_EBEN+1
ENDIF
IF(_EBEN<>0)
_DEB=(_PRAD-_RIN)/_EBEN
ENDIF
_TIEF=ROUND((ABS(_RFP-_DP)-_FALD)/_MID)
IF(_TIEF<(ABS(_RFP-_DP)-_FALD)/_MID)
_TIEF=_TIEF+1
ENDIF
IF(_TIEF<>0)
_DTI=(ABS(_RFP-_DP)-_FALD)/_TIEF
ENDIF
IF(S_DISC_CUTTER)AND(S_WB>0)
_TIEF=ROUND((ABS(_RFP-_DP)-_FALD-S_WB)/_MID)
IF(_TIEF<(ABS(_RFP-_DP)-_FALD-S_WB)/_MID)
_TIEF=_TIEF+1
ENDIF
IF(_TIEF<>0)
_DTI=(ABS(_RFP-_DP)-_FALD-S_WB)/_TIEF
ENDIF
_TIEF=_TIEF+1
_RFP=_RFP-ABS(S_WB-_DTI)*_PMZ
ENDIF
IF(_HELIKAL==1)
IF(_MODE==2)AND(_FALG)AND(_TIEF==1)
_HELIKAL=0
GOTOF _NO_HELIKAL
ENDIF
_TIEF=1
IF(_MODE==2)AND(_FALG)
_TIEF=2
_DTI=ABS(_RFP-_DP)/_TIEF
ENDIF
_NO_HELIKAL:
ENDIF
FOR _I=1 TO _NUM
_SCHLIGRND=FALSE
FOR _T=1 TO _TIEF
IF(_TIEF>1)
IF(_T==1)
ENDIF
IF(_T==_TIEF)
ENDIF
ENDIF
IF(_MODE==1)
_J0=1
ENDIF
IF(_MODE==2)
_J0=_EBEN
ENDIF
IF(_MODE==2)AND(_FALG)AND(_T==_TIEF)
_J0=1
_SCHLIGRND=TRUE
ENDIF
IF(_MODE==1)OR(_SCHLIGRND==TRUE)
_RIV=_PRAD+_WR-_DEB
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
ELSE
_RIV=_RIN+_WR
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
ENDIF
IF(_ZZSD[8]==1)
_XS=_RUV
_YS=_RIV
_ZS=_RFP-(_T*_DTI-_SDIS)*_PMZ
IF(_HELIKAL==1)
_ZS=_RFP+_SDIS*_PMZ
ENDIF
GOTOF _M_ST_POS
ENDIF
IF(_HELIKAL==1)AND(_SCHLIGRND)
_DIR=-1
_MUN=ROUND(ABS(_RFP-_DP)/_MID)
IF(_MUN<ABS(_RFP-_DP)/_MID)
_MUN=_MUN+1
ENDIF
_MUN_ACT=_MUN MOD 2
IF(_MUN_ACT==1)
_DIR=-_DIR
ENDIF
;MSG("Anfahrt Schlichten Grund: TIEF="<<_MUN<<" MOD 2="<<_MUN_ACT<<" DIR="<<_DIR)
;M0
GOTOF _SKIP_ANFAHREN
ENDIF
SBLON
N10 G0 AX[_XX]=_RUV AX[_YY]=_RIV
IF(_HELIKAL==1)AND(NOT _SCHLIGRND)
N11 G0 AX[_ZZ]=_RFP+_SDIS*_PMZ
EXECSTRING(_S_FFP1)
N12 G1 AX[_ZZ]=_RFP
GOTOF _SKIP_ANFAHREN
ENDIF
IF(_T==_TIEF)
N15 G0 AX[_ZZ]=_RFP-(_T*_DTI-_SDIS)*_PMZ
ELSE
N16 G0 AX[_ZZ]=_RFP-_T*_DTI*_PMZ
ENDIF
EXECSTRING(_S_FFP1)
N20 G1 G[10]=_GG10 AX[_ZZ]=_RFP-_T*_DTI*_PMZ
_SKIP_ANFAHREN:
SBLOF
FOR _J=_J0 TO _EBEN
IF(_HELIKAL==1)AND(_SCHLIGRND)
_RIV=_PRAD+_WR-(_EBEN-_J+1)*_DEB
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
N31 G1 AX[_XX]=_DIR*_RUV AX[_YY]=_RIV
IF(_J<_EBEN)
_RIV=_PRAD+_WR-(_EBEN-_J)*_DEB
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
EXECSTRING(_S_FFC)
IF(_DIR<0)
N32 G2 AX[_XX]=_DIR*_RUV AX[_YY]=_RIV IP[_XX]=AC(0) IP[_YY]=AC(0)
ELSE
N33 G3 AX[_XX]=_DIR*_RUV AX[_YY]=_RIV IP[_XX]=AC(0) IP[_YY]=AC(0)
ENDIF
EXECSTRING(_S_FFP1)
_DIR=-_DIR
ENDIF
GOTOF _NEXT_EBENE
ENDIF
_RIV=_PRAD+_WR-_J*_DEB
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
IF(_HELIKAL==1)AND(NOT _SCHLIGRND)
N21 CONTDCON(_KTS)
N22 G1 AX[_XX]=_RUV AX[_YY]=_RIV
ENDIF
IF(_MODE==1)
N25 G1 G[10]=_GG10 AX[_XX]=-_RUV AX[_YY]=_RIV
ELSE
N30 G1 G[10]=_GG10 AX[_XX]=-_RUV AX[_YY]=_RIV
ENDIF
IF(_HELIKAL==1)AND(NOT _SCHLIGRND)
_MUN=_I
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
_I=_MUN
ENDIF
IF(_J<_EBEN)
_RIV=_PRAD+_WR-(_J+1)*_DEB
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
IF(_HELIKAL==1)AND(NOT _SCHLIGRND)
N34 G0 AX[_ZZ]=_RFP+_SDIS*_PMZ
ENDIF
EXECSTRING(_S_FFC)
N35 G2 G[10]=_GG10 AX[_XX]=_RUV AX[_YY]=_RIV IP[_XX]=AC(0) IP[_YY]=AC(0)
EXECSTRING(_S_FFP1)
IF(_HELIKAL==1)AND(NOT _SCHLIGRND)
N36 G1 AX[_ZZ]=_RFP
ENDIF
ENDIF
_NEXT_EBENE:
ENDFOR
IF(_T<_TIEF)AND(_HELIKAL==0)
_RIV=_PRAD+_WR-_DEB
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
EXECSTRING(_S_FFC)
SBLON
N40 G2 G[10]=_GG10 AX[_XX]=_RUV AX[_YY]=_RIV IP[_XX]=AC(0) IP[_YY]=AC(0)
SBLOF
EXECSTRING(_S_FFP1)
ENDIF
ENDFOR
SBLON
IF(NOT(S_IS_ST))AND(NOT(_ZZSD[8]))
N45 G0 AX[_ZZ]=_RTP
ENDIF
SBLOF
IF(_NUM==2)AND(_I==1)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,180)
IF(_MODE==1);OR(_SCHLIGRND==TRUE)
_RIV=_PRAD+_WR-_DEB
ELSE
_RIV=_RIN+_WR
ENDIF
_ALFA=ASIN(_RIV/_RUM)
_RUV=_RUM*COS(_ALFA)
EXECSTRING(_S_FFC)
N50 G3 G[10]=_GG10 AX[_XX]=_RUV AX[_YY]=_RIV IP[_XX]=AC(0) IP[_YY]=AC(0)
EXECSTRING(_S_FFP1)
ENDIF
ENDFOR
IF(_NUM==2)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-180)
IF(S_DISC_CUTTER)
N51 G3 G[10]=_GG10 AX[_XX]=_RUV AX[_YY]=_RIV IP[_XX]=AC(0) IP[_YY]=AC(0)
ENDIF
ENDIF
ELSE
_ZUSTELL=FALSE
_RUNDUNG=FALSE
_OPTIMIZE=FALSE
_SCHLIGRND=FALSE
_DRIN=TRUE
_DRAN=TRUE
_I=0
IF(_MODE==2)
_USCHI=_SDIS+_WR
_WR=0
ELSE
_USCHI=_SDIS
ENDIF
_USCHI1=_USCHI
_ALFA=90*(2*_NUM-4)/_NUM
_PHI =360/_NUM
_PRAD=_PRAD+_WR
_RUM =_SWL/(2*SIN(_PHI/2))
_RIN =_RUM*COS(_PHI/2)+_FAL+_WR
_RUM =_RIN/COS(_PHI/2)
_EBEN=ROUND((_PRAD-_RIN)/_MIDA)
IF(_EBEN<(_PRAD-_RIN)/_MIDA)
_EBEN=_EBEN+1
ENDIF
IF(_EBEN<>0)
_DEB=(_PRAD-_RIN)/_EBEN
ENDIF
_TIEF=ROUND((ABS(_RFP-_DP)-_FALD)/_MID)
IF(_TIEF<(ABS(_RFP-_DP)-_FALD)/_MID)
_TIEF=_TIEF+1
ENDIF
IF(_TIEF<>0)
_DTI=(ABS(_RFP-_DP)-_FALD)/_TIEF
ENDIF
IF(S_DISC_CUTTER)AND(S_WB>0)
_TIEF=ROUND((ABS(_RFP-_DP)-_FALD-S_WB)/_MID)
IF(_TIEF<(ABS(_RFP-_DP)-_FALD-S_WB)/_MID)
_TIEF=_TIEF+1
ENDIF
IF(_TIEF<>0)
_DTI=(ABS(_RFP-_DP)-_FALD-S_WB)/_TIEF
ENDIF
_TIEF=_TIEF+1
_RFP=_RFP-ABS(S_WB-_DTI)*_PMZ
ENDIF
IF(_HELIKAL==1)
IF(_MODE==2)AND(_FALG)AND(_TIEF==1)
_HELIKAL=0
GOTOF _NEXT0
ENDIF
_TIEF=1
IF(_MODE==2)AND(_FALG)
_TIEF=2
_DTI=ABS(_RFP-_DP)/_TIEF
ENDIF
IF(_RC==0);AND((_AMODE _DEC4)==0)
_RC=0.0001*$P_TOOLR*_FAK1
ENDIF
_NEXT0:
ENDIF
_RIV =(_PRAD-(_EBEN-1)*_DEB)
_RUV =_RIV/COS(_PHI/2)
_LP =2*_RUV*SIN(_PHI/2)
_RIV =_RIV-_DEB
_NORM= SQRT((1-COS(_PHI))*(1-COS(_PHI))+SIN(_PHI)*SIN(_PHI))
IF(_RC<0)
_R =ABS(_RC)+((_FAL+_WR)/(TAN(_ALFA/2)*SIN(_PHI/2))-(_FAL+_WR))/COS(_ALFA/2)
_RP =_R+(_RUV-_RUM-_DEB)/COS(_ALFA/2)
_RZ =_R
_RVF=_FAL+_WR+_DEB
ELSE
_R =_RC+_FAL+_WR
_RP =(_R+_DEB)/TAN(_ALFA/2)
_RZ =_R+0.5*_DEB
ENDIF
_ZIEL_S[0]=_RIV/COS(_PHI/2)*COS(0*_PHI)+_PRAD*2/_NORM*(1-COS(_PHI))
_ZIEL_S[1]=_RIV/COS(_PHI/2)*SIN(0*_PHI)-_PRAD*2/_NORM*SIN(_PHI)
_ZIEL_E[0]=_RIV/COS(_PHI/2)*COS(1*_PHI)+0.5*_RIV/COS(_PHI/2)*(1-COS(_PHI))
_ZIEL_E[1]=_RIV/COS(_PHI/2)*SIN(1*_PHI)-0.5*_RIV/COS(_PHI/2)*SIN(_PHI)
WHILE(_I<_NUM)AND(_ZUSTELL==FALSE)
_KANT_S[0]=_RUV*COS(_I*_PHI)+_RP/_LP*_RUV*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_S[1]=_RUV*SIN(_I*_PHI)+_RP/_LP*_RUV*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)-_RP/_LP*_RUV*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)-_RP/_LP*_RUV*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_RUND_D=3
_RUND_S[0]=_KANT_E[0] _RUND_S[1]=_KANT_E[1]
_RUND_E[0]=_RUV*COS((_I+1)*_PHI)+_RP/_LP*_RUV*(COS((_I+2)*_PHI)-COS((_I+1)*_PHI))
_RUND_E[1]=_RUV*SIN((_I+1)*_PHI)+_RP/_LP*_RUV*(SIN((_I+2)*_PHI)-SIN((_I+1)*_PHI))
_RUND_M[0]=(_RUM-_R/SIN(_ALFA/2))*COS((_I+1)*_PHI)
_RUND_M[1]=(_RUM-_R/SIN(_ALFA/2))*SIN((_I+1)*_PHI)
_S1_A[0]=_RUND_S[0] _S1_A[1]=_RUND_S[1] _S1_E[0]=_RUND_E[0] _S1_E[1]=_RUND_E[1]
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1]
_S1_M[0]=_RUND_M[0] _S1_M[1]=_RUND_M[1] _S1_G=_RUND_D _S2_G=1
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _SCHNITT_A _SCHNITT_E
_SP2[0]=_S[0] _SP2[1]=_S[1] _SP2[2]=_SII
IF(_SP1[2])OR(_SP2[2])
_ZUSTELL=TRUE
_MUN=_I
IF(_RC<0)
IF(_SP1[2])
_RZ=0
_RUND_E[0]=_SP1[0] _RUND_E[1]=_SP1[1]
_ZIEL_S[0]=_SP1[0] _ZIEL_S[1]=_SP1[1]
_ZIEL_E[0]=_RIV/COS(_PHI/2)*COS(0*_PHI)+_R/_NORM*(COS(1*_PHI)-COS(0*_PHI))
_ZIEL_E[1]=_RIV/COS(_PHI/2)*SIN(0*_PHI)+_R/_NORM*(SIN(1*_PHI)-SIN(0*_PHI))
_KATOS=SQRT(POT(_KANT_E[0]-_KANT_S[0])+POT(_KANT_E[1]-_KANT_S[1]))
_ZITOS=SQRT(POT(_ZIEL_E[0]-_ZIEL_S[0])+POT(_ZIEL_E[1]-_ZIEL_S[1]))
_FASOS=SQRT(POT(_KANT_E[0]-_ZIEL_S[0])+POT(_KANT_E[1]-_ZIEL_S[1]))
_NORM1=SQRT(POT(_RUND_E[0]-_RUND_S[0])+POT(_RUND_E[1]-_RUND_S[1]))
_NORM2=SQRT(POT(_ZIEL_E[0]-_ZIEL_S[0])+POT(_ZIEL_E[1]-_ZIEL_S[1]))
_BETA =180-ACOS(((_RUND_E[0]-_RUND_S[0])/_NORM1)*((_ZIEL_E[0]-_ZIEL_S[0])/_NORM2)+((_RUND_E[1]-_RUND_S[1])/_NORM1)*((_ZIEL_E[1]-_ZIEL_S[1])/_NORM2))
IF(_RVF<=TAN(_BETA/2)*_KATOS/2)AND(_RVF<=TAN(_BETA/2)*_ZITOS/2)AND(_RVF<=TAN(_BETA/2)*_FASOS/2)
_RVFZ=_RVF
ELSE
IF(_KATOS<=_ZITOS)AND(_KATOS<=_FASOS)
_RVFZ=TAN(_BETA/2)*_KATOS/2
ENDIF
IF(_ZITOS<=_KATOS)AND(_ZITOS<=_FASOS)
_RVFZ=TAN(_BETA/2)*_ZITOS/2
ENDIF
IF(_FASOS<=_KATOS)AND(_FASOS<=_ZITOS)
_RVFZ=TAN(_BETA/2)*_FASOS/2
ENDIF
ENDIF
ELSE
_KANT_E[0]=_SP2[0] _KANT_E[1]=_SP2[1]
_ZIEL_S[0]=_SP2[0] _ZIEL_S[1]=_SP2[1]
_ZIEL_E[0]=_RIV/COS(_PHI/2)*COS(0*_PHI)+_R/_NORM*(COS(1*_PHI)-COS(0*_PHI))
_ZIEL_E[1]=_RIV/COS(_PHI/2)*SIN(0*_PHI)+_R/_NORM*(SIN(1*_PHI)-SIN(0*_PHI))
_KATOS=SQRT(POT(_KANT_E[0]-_KANT_S[0])+POT(_KANT_E[1]-_KANT_S[1]))
_ZITOS=SQRT(POT(_ZIEL_E[0]-_ZIEL_S[0])+POT(_ZIEL_E[1]-_ZIEL_S[1]))
_NORM1=SQRT(POT(_KANT_E[0]-_KANT_S[0])+POT(_KANT_E[1]-_KANT_S[1]))
_NORM2=SQRT(POT(_ZIEL_E[0]-_ZIEL_S[0])+POT(_ZIEL_E[1]-_ZIEL_S[1]))
_BETA =180-ACOS(((_KANT_E[0]-_KANT_S[0])/_NORM1)*((_ZIEL_E[0]-_ZIEL_S[0])/_NORM2)+((_KANT_E[1]-_KANT_S[1])/_NORM1)*((_ZIEL_E[1]-_ZIEL_S[1])/_NORM2))
IF(_RZ>_KATOS/2)OR(_RZ>_ZITOS/2)
IF(_KATOS<=_ZITOS)
_RZ=_KATOS/2
ELSE
_RZ=_ZITOS/2
ENDIF
ENDIF
_FASOS=_RZ*COS(_BETA/2)/2
_RVFZ =_FASOS*TAN((180/2+_BETA/2)/2)
ENDIF
ELSE
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)+_PRAD*2/_NORM*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)+_PRAD*2/_NORM*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_NORM1=SQRT(POT(_KANT_E[0]-_KANT_S[0])+POT(_KANT_E[1]-_KANT_S[1]))
_NORM2=SQRT(POT(_ZIEL_E[0]-_ZIEL_S[0])+POT(_ZIEL_E[1]-_ZIEL_S[1]))
_BETA =180-ACOS(((_KANT_E[0]-_KANT_S[0])/_NORM1)*((_ZIEL_E[0]-_ZIEL_S[0])/_NORM2)+((_KANT_E[1]-_KANT_S[1])/_NORM1)*((_ZIEL_E[1]-_ZIEL_S[1])/_NORM2))
_KANT_E[0]=_SP2[0] _KANT_E[1]=_SP2[1]
_ZIEL_S[0]=_SP2[0] _ZIEL_S[1]=_SP2[1]
_ZIEL_E[0]=_RIV/COS(_PHI/2)*COS(0*_PHI)+(_R/(2*TAN(_ALFA/2)*SIN(_PHI/2)))*(COS(1*_PHI)-COS(0*_PHI))
_ZIEL_E[1]=_RIV/COS(_PHI/2)*SIN(0*_PHI)+(_R/(2*TAN(_ALFA/2)*SIN(_PHI/2)))*(SIN(1*_PHI)-SIN(0*_PHI))
_KATOS=SQRT(POT(_KANT_S[0]-_SP2[0])+POT(_KANT_S[1]-_SP2[1]))
_ZITOS=SQRT(POT(_ZIEL_E[0]-_ZIEL_S[0])+POT(_ZIEL_E[1]-_ZIEL_S[1]))
IF(_KATOS/2>=_R/TAN(_BETA/2))AND(_ZITOS/2>=_R/TAN(_BETA/2))
IF(_RZ/TAN(_BETA/2)>_KATOS/2)OR(_RZ/TAN(_BETA/2)>_ZITOS/2)
IF(_KATOS<=_ZITOS)
_RZ=_KATOS*TAN(_BETA/2)/2
ELSE
_RZ=_ZITOS*TAN(_BETA/2)/2
ENDIF
ENDIF
ELSE
IF(_KATOS<=_ZITOS)
_RZ=_KATOS*TAN(_BETA/2)
ELSE
_RZ=_ZITOS*TAN(_BETA/2)
ENDIF
ENDIF
ENDIF
ENDIF
_I=_I+1
ENDWHILE
FOR _T=1 TO _TIEF
IF(_TIEF>1)
IF(_T==1)
ENDIF
IF(_T==_TIEF)
ENDIF
ENDIF
IF(_MODE==1)
_J0=1
ENDIF
IF(_MODE==2)
_J0=_EBEN
_RUNDUNG=FALSE
ENDIF
IF(_MODE==2)AND(_FALG)AND(_T==_TIEF)
_J0=1
_RUNDUNG=FALSE
_SCHLIGRND=TRUE
IF(_HELIKAL==1)
_HELIKAL=0
_GRUND=1
ENDIF
ENDIF
IF(_MODE==1)OR(_SCHLIGRND==TRUE)
_GET_START_A:
_RIV=_PRAD
_RUV=_RIV/COS(_PHI/2)
_LP =2*_RUV*SIN(_PHI/2)
_RIV=_RIV-_DEB
_KANT_S[0]=_RUV*COS(_MUN*_PHI)
_KANT_S[1]=_RUV*SIN(_MUN*_PHI)
_KANT_E[0]=_RUV*COS((_MUN+1)*_PHI)+_PRAD*2/_NORM*(COS((_MUN+1)*_PHI)-COS(_MUN*_PHI))
_KANT_E[1]=_RUV*SIN((_MUN+1)*_PHI)+_PRAD*2/_NORM*(SIN((_MUN+1)*_PHI)-SIN(_MUN*_PHI))
_ZIEL_S[0]=_RIV/COS(_PHI/2)*COS(0*_PHI)+_PRAD*2/_NORM*(1-COS(_PHI))
_ZIEL_S[1]=_RIV/COS(_PHI/2)*SIN(0*_PHI)-_PRAD*2/_NORM*SIN(_PHI)
_ZIEL_E[0]=_RIV/COS(_PHI/2)*COS(1*_PHI)
_ZIEL_E[1]=_RIV/COS(_PHI/2)*SIN(1*_PHI)
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1] _S2_G=1
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_KANT_E[0]=_SP1[0] _KANT_E[1]=_SP1[1]
_ZIEL_S[0]=_SP1[0] _ZIEL_S[1]=_SP1[1]
IF(_RC<0)
_RP =_R +(_RUV-_RUM-_EBEN*_DEB)/COS(_ALFA/2)
_RPZ=_RZ+(_RIV/COS(_PHI/2)-_RUM-(_EBEN-1)*_DEB)/COS(_ALFA/2)
IF(_RZ==0)
_KANT_E[0]=_RUV*COS((_MUN+1)*_PHI)-_RP/_LP*_RUV*(COS((_MUN+1)*_PHI)-COS(_MUN*_PHI))
_KANT_E[1]=_RUV*SIN((_MUN+1)*_PHI)-_RP/_LP*_RUV*(SIN((_MUN+1)*_PHI)-SIN(_MUN*_PHI))
_FASE_S[0]=_KANT_E[0] _FASE_S[1]=_KANT_E[1]
_FASE_E[0]=_RUV*COS((_NUM)*_PHI)+_RP/_LP*_RUV*(COS((_NUM+1)*_PHI)-COS((_NUM)*_PHI))
_FASE_E[1]=_RUV*SIN((_NUM)*_PHI)+_RP/_LP*_RUV*(SIN((_NUM+1)*_PHI)-SIN((_NUM)*_PHI))
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1] _S2_G=1
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_FASE_E[0]=_SP1[0] _FASE_E[1]=_SP1[1]
ELSE
_KANT_E[0]=_SP1[0]-_RPZ/_NORM*(COS((_MUN+1)*_PHI)-COS(_MUN*_PHI))
_KANT_E[1]=_SP1[1]-_RPZ/_NORM*(SIN((_MUN+1)*_PHI)-SIN(_MUN*_PHI))
_FASE_S[0]=_KANT_E[0] _FASE_S[1]=_KANT_E[1]
_FASE_E[0]=_SP1[0]+_RPZ/_NORM*(COS((_NUM+1)*_PHI)-COS((_NUM)*_PHI))
_FASE_E[1]=_SP1[1]+_RPZ/_NORM*(SIN((_NUM+1)*_PHI)-SIN((_NUM)*_PHI))
ENDIF
_RADIUS=_PRAD
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
_S2_A[0]=0 _S2_A[1]=-_RADIUS _S2_E[0]=0 _S2_E[1]=_RADIUS _S1_M[0]=0 _S1_M[1]=0 _S2_G=3
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
IF(_SP1[2])
_FASE_S[0]=_SP1[0] _FASE_S[1]=_SP1[1]
_DRAN=TRUE
ELSE
_RADIUS=_PRAD
_S1_A[0]=_ZIEL_S[0] _S1_A[1]=_ZIEL_S[1] _S1_E[0]=_ZIEL_E[0] _S1_E[1]=_ZIEL_E[1] _S1_G=1
_S2_A[0]=0 _S2_A[1]=-_RADIUS _S2_E[0]=0 _S2_E[1]=_RADIUS _S1_M[0]=0 _S1_M[1]=0 _S2_G=3
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_FASE_E[0]=_SP1[0] _FASE_E[1]=_SP1[1]
_DRAN=FALSE
ENDIF
ELSE
IF(_OPTIMIZE==TRUE)
_RPZ=_RZ+(_EBEN-1)*_DEB
ELSE
_RPZ=_R+(_EBEN-0.5)*_DEB
ENDIF
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1]
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1]
_RADIUS =_RPZ
REPEAT _CALC_RND_A _CALC_RND_E
_RUND_S[0]=_KR_A[0] _RUND_S[1]=_KR_A[1] _RUND_E[0]=_KR_E[0] _RUND_E[1]=_KR_E[1] _RUND_M[0]=_KR_M[0] _RUND_M[1]=_KR_M[1]
IF(_OPTIMIZE==FALSE)
_SP1[0]=_RUND_S[0] _SP1[1]=_RUND_S[1]
_START_E[0]=_SP1[0] _START_E[1]=_SP1[1]
_START_M[0]=_START_E[0]+_USCHI1*COS(ATAN2(_SP1[1],_SP1[0]))
_START_M[1]=_START_E[1]+_USCHI1*SIN(ATAN2(_SP1[1],_SP1[0]))
_USCHI=_USCHI1+2*ABS((_USCHI1+SQRT(POT(_RUND_M[0]-_RUND_S[0])+POT(_RUND_M[1]-_RUND_S[1])))-SQRT(POT(_START_M[0]-_RUND_M[0])+POT(_START_M[1]-_RUND_M[1])))
ELSE
_RADIUS=_PRAD
_S1_A[0]=_RUND_S[0] _S1_A[1]=_RUND_S[1] _S1_E[0]=_RUND_E[0] _S1_E[1]=_RUND_E[1] _S1_M[0]=_RUND_M[0] _S1_M[1]=_RUND_M[1] _S1_G=3
_S2_A[0]=0 _S2_A[1]=-_RADIUS _S2_E[0]=0 _S2_E[1]=_RADIUS _S1_M[0]=0 _S1_M[1]=0 _S2_G=3
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
IF(_SP1[2])
_RUND_S[0]=_SP1[0] _RUND_S[1]=_SP1[1]
_DRAN=TRUE
ELSE
_RADIUS=_PRAD
_S1_A[0]=_ZIEL_S[0] _S1_A[1]=_ZIEL_S[1] _S1_E[0]=_ZIEL_E[0] _S1_E[1]=_ZIEL_E[1] _S1_G=1
_S2_A[0]=0 _S2_A[1]=-_RADIUS _S2_E[0]=0 _S2_E[1]=_RADIUS _S1_M[0]=0 _S1_M[1]=0 _S2_G=3
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_RUND_E[0]=_SP1[0] _RUND_E[1]=_SP1[1]
_DRAN=FALSE
ENDIF
ENDIF
ENDIF
_START_D=2
_START_E[0]=_SP1[0] _START_E[1]=_SP1[1]
_START_M[0]=_START_E[0]+_USCHI*COS(ATAN2(_SP1[1],_SP1[0]))
_START_M[1]=_START_E[1]+_USCHI*SIN(ATAN2(_SP1[1],_SP1[0]))
_START_S[0]=_START_M[0]+(_START_M[1]-_START_E[1])
_START_S[1]=_START_M[1]-(_START_M[0]-_START_E[0])
_GET_START_E:
IF(_SCHLIGRND==FALSE)
_XS=_START_S[0]
_YS=_START_S[1]
ELSE
_PR=($P_TOOLR*_FAK1+$P_OFFN*_FAK2)/SQRT(ABS(POT(_START_M[0]-_START_S[0])+POT(_START_M[1]-_START_S[1])))
_XS=_START_S[0]+_PR*(_START_M[0]-_START_S[0])
_YS=_START_S[1]+_PR*(_START_M[1]-_START_S[1])
ENDIF
IF(_ZZSD[8]==1)
_ZS=_RFP-(_T*_DTI-_SDIS)*_PMZ
IF(_HELIKAL==1)
_ZS=_RFP+_SDIS*_PMZ
ENDIF
GOTOF _M_ST_POS
ENDIF
IF(_GRUND)
;MSG("Schlichten Grund: MIRR="<<_MIRR)
;M0
STOPRE
EXECSTRING(_S_FFP1)
N57 CONTDCON(_KTS)
IF(_RC<0)
;N58 G1 AX[_XX]=_FASE_S[0] AX[_YY]=_FASE_S[1]
N70 G1 AX[_XX]=_START_E[0] AX[_YY]=_START_E[1]
N75 G1 AX[_XX]=_FASE_E[0] AX[_YY]=_FASE_E[1]
ELSE
N59 G1 AX[_XX]=_RUND_S[0] AX[_YY]=_RUND_S[1]
N70 G2 AX[_XX]=_START_E[0] AX[_YY]=_START_E[1] IP[_XX]=AC(_START_M[0]) IP[_YY]=AC(_START_M[1])
N80 G3 AX[_XX]=_RUND_E[0] AX[_YY]=_RUND_E[1] IP[_XX]=AC(_RUND_M[0]) IP[_YY]=AC(_RUND_M[1])
ENDIF
GOTOF _NEXT1
ENDIF
SBLON
N48 G0 G40 AX[_XX]=_XS AX[_YY]=_YS
IF(_SCHLIGRND==TRUE)
N60 G0 G42 AX[_XX]=_START_S[0] AX[_YY]=_START_S[1]
ENDIF
IF(_HELIKAL==1)
N61 G0 AX[_ZZ]=_RFP+_SDIS*_PMZ
SBLOF
EXECSTRING(_S_FFP1)
N62 G0 AX[_XX]=_START_E[0] AX[_YY]=_START_E[1]
GOTOF _NEXT1
ENDIF
N65 G0 AX[_ZZ]=_RFP-_T*_DTI*_PMZ
SBLOF
EXECSTRING(_S_FFP1)
N70 G2 G[10]=_GG10 AX[_XX]=_START_E[0] AX[_YY]=_START_E[1] IP[_XX]=AC(_START_M[0]) IP[_YY]=AC(_START_M[1])
IF(_OPTIMIZE==FALSE)OR(_DRAN==TRUE)
IF(_RC<0)
N75 G1 G[10]=_GG10 AX[_XX]=_FASE_E[0] AX[_YY]=_FASE_E[1]
ELSE
N80 G3 G[10]=_GG10 AX[_XX]=_RUND_E[0] AX[_YY]=_RUND_E[1] IP[_XX]=AC(_RUND_M[0]) IP[_YY]=AC(_RUND_M[1])
ENDIF
ENDIF
_NEXT1:
ENDIF
IF(_MODE==2)AND(_SCHLIGRND==FALSE)
IF(_RC<0)
_RP=_R-(_USCH-_USCHI)*SIN(180-_PHI)
ELSE
_RP=_R/TAN(_ALFA/2)-(_USCH-_USCHI)*SIN(180-_PHI)
ENDIF
_GET_SCHLICHT_A:
_START_D=2
_START_E[0]=_RUM*COS(0*_PHI)-_RP/_NORM*(1-COS(_PHI))
_START_E[1]=_RUM*SIN(0*_PHI)+_RP/_NORM*SIN(_PHI)
_START_M[0]=_START_E[0]+_USCH*COS(_PHI/2)
_START_M[1]=_START_E[1]+_USCH*SIN(_PHI/2)
_START_S[0]=_START_M[0]+(_START_M[1]-_START_E[1])
_START_S[1]=_START_M[1]-(_START_M[0]-_START_E[0])
_GET_SCHLICHT_E:
IF(_RC<0)
_FASE_E[0]=_START_E[0] _FASE_E[1]=_START_E[1]
ELSE
_RUND_E[0]=_START_E[0] _RUND_E[1]=_START_E[1]
ENDIF
IF(_ZZSD[8]==1)
_PR=($P_TOOLR*_FAK1+$P_OFFN*_FAK2)/SQRT(ABS(POT(_START_M[0]-_START_S[0])+POT(_START_M[1]-_START_S[1])))
_XS=_START_S[0]+_PR*(_START_M[0]-_START_S[0])
_YS=_START_S[1]+_PR*(_START_M[1]-_START_S[1])
_ZS=_RFP-(_T*_DTI-_SDIS)*_PMZ
IF(S_DISC_CUTTER==TRUE)AND(_T==1)
REPEAT _GET_SCHLICHT_A2 _GET_SCHLICHT_E2
ENDIF
IF(_HELIKAL==1)
_ZS=_RFP+_SDIS*_PMZ
ENDIF
GOTOF _M_ST_POS
ENDIF
SBLON
IF(S_DISC_CUTTER)AND(_T==1)
_GET_SCHLICHT_A2:
_PR=($P_TOOLR*_FAK1+$P_OFFN*_FAK2)/SQRT(ABS(POT(_START_M[0]-_START_S[0])+POT(_START_M[1]-_START_S[1])))
_XS=_START_S[0]+_PR*(_START_M[0]-_START_S[0])
_YS=_START_S[1]+_PR*(_START_M[1]-_START_S[1])
_NORM3=SQRT(POT(_XS)+POT(_YS))
IF(_NORM3<=0)
_NORM3=1
ENDIF
_XS=_XS*(_PRAD+_SDIS+$P_TOOLR*_FAK1+$P_OFFN*_FAK2)/_NORM3
_YS=_YS*(_PRAD+_SDIS+$P_TOOLR*_FAK1+$P_OFFN*_FAK2)/_NORM3
_GET_SCHLICHT_E2:
N84 G0 G40 AX[_XX]=_XS AX[_YY]=_YS
ELSE
IF (_HELIKAL==1)
_NORM3=SQRT(POT((_START_E[0]-_START_M[0]))+POT((_START_E[1]-_START_M[1])))
N86 G0 AX[_XX]=_START_E[0]+$P_TOOLR*_FAK1/_NORM3*(_START_M[0]-_START_E[0]) AX[_YY]=_START_E[1]+$P_TOOLR*_FAK1/_NORM3*(_START_M[1]-_START_E[1])
;MSG("Startpunkt Schlichten")
;M0
_START_HELI[0]=_START_E[0] _START_HELI[1]=_START_E[1]
SBLOF
EXECSTRING(_S_FFP1)
GOTOF _NEXT2
ENDIF
N85 G0 G42 AX[_XX]=_START_S[0] AX[_YY]=_START_S[1]
ENDIF
S_DIST=1
IF(S_DISC_CUTTER)
S_DIST=0
ENDIF
IF(_DTI>_SDIS)OR(_T==1)
N90 G0 AX[_ZZ]=_RFP-(_T*_DTI-_SDIS*S_DIST)*_PMZ
ENDIF
SBLOF
IF(S_DISC_CUTTER)AND(_T==1)
N91 G0 G42 AX[_XX]=_START_S[0] AX[_YY]=_START_S[1]
ENDIF
EXECSTRING(_S_FFP1)
N100 G2 G[10]=_GG10 AX[_XX]=_START_E[0] AX[_YY]=_START_E[1] AX[_ZZ]=_RFP-_T*_DTI*_PMZ IP[_XX]=AC(_START_M[0]) IP[_YY]=AC(_START_M[1])
_NEXT2:
ENDIF
FOR _J=_J0 TO _EBEN
_RIV=_PRAD-_J*_DEB
_RUV=_RIV/COS(_PHI/2)
_LP =2*_RUV*SIN(_PHI/2)
_RIV=_RIV-_DEB
IF(_RC<0)
_RP =_R+(_RUV-_RUM-(_EBEN-_J)*_DEB)/COS(_ALFA/2)
_RPZ =_RZ+(_RIV/COS(_PHI/2)-_RUM-(_EBEN-_J-1)*_DEB)/COS(_ALFA/2)
_RVF =_FAL+_WR+(_EBEN-_J)*_DEB
_RPFZ=_RVFZ+(_EBEN-_J-1)*_DEB
ELSE
_RP =(_R+(_EBEN-_J)*_DEB)/TAN(_ALFA/2)
_RPZ=_RZ+(_EBEN-_J-1)*_DEB
ENDIF
_ZIEL_S[0]=_RIV/COS(_PHI/2)*COS(0*_PHI)+_PRAD*2/_NORM*(1-COS(_PHI))
_ZIEL_S[1]=_RIV/COS(_PHI/2)*SIN(0*_PHI)-_PRAD*2/_NORM*SIN(_PHI)
_ZIEL_E[0]=_RIV/COS(_PHI/2)*(COS(0*_PHI)-_RP/_LP*(1-COS(_PHI)))
_ZIEL_E[1]=_RIV/COS(_PHI/2)*(SIN(0*_PHI)+_RP/_LP*SIN(_PHI))
_MUN_ACT=_MUN
IF(_HELIKAL==1)
_MUN_ACT=_NUM-1
N101 G0 AX[_ZZ]=_RFP+_SDIS*_PMZ
_START_HELI[0]=_RUV*COS((_NUM)*_PHI)+_RP/_LP*_RUV*(COS((_NUM+1)*_PHI)-COS((_NUM)*_PHI))
_START_HELI[1]=_RUV*SIN((_NUM)*_PHI)+_RP/_LP*_RUV*(SIN((_NUM+1)*_PHI)-SIN((_NUM)*_PHI))
N102 G0 AX[_XX]=_START_HELI[0] AX[_YY]=_START_HELI[1]
N103 G1 AX[_ZZ]=_RFP
N950 CONTDCON(_KTS)
N104 G1 AX[_XX]=_START_HELI[0] AX[_YY]=_START_HELI[1]
ENDIF
FOR _I=0 TO _MUN_ACT
IF(_I<_MUN_ACT)OR(_J==_EBEN)OR(_HELIKAL==1)
IF(_RC<0)
_KANT_S[0]=_FASE_E[0] _KANT_S[1]=_FASE_E[1]
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)-_RP/_LP*_RUV*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)-_RP/_LP*_RUV*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_FASE_S[0]=_KANT_E[0] _FASE_S[1]=_KANT_E[1]
_FASE_E[0]=_RUV*COS((_I+1)*_PHI)+_RP/_LP*_RUV*(COS((_I+2)*_PHI)-COS((_I+1)*_PHI))
_FASE_E[1]=_RUV*SIN((_I+1)*_PHI)+_RP/_LP*_RUV*(SIN((_I+2)*_PHI)-SIN((_I+1)*_PHI))
IF(_RUNDUNG==TRUE)AND(_RVF>0)
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1]
_S2_A[0]=_FASE_S[0] _S2_A[1]=_FASE_S[1] _S2_E[0]=_FASE_E[0] _S2_E[1]=_FASE_E[1]
_RADIUS =_RVF
REPEAT _CALC_RND_A _CALC_RND_E
_FRND1_S[0]=_KR_A[0] _FRND1_S[1]=_KR_A[1] _FRND1_E[0]=_KR_E[0] _FRND1_E[1]=_KR_E[1] _FRND1_M[0]=_KR_M[0] _FRND1_M[1]=_KR_M[1]
_KANT_E[0]=_FRND1_S[0] _KANT_E[1]=_FRND1_S[1]
_FASE_S[0]=_FRND1_E[0] _FASE_S[1]=_FRND1_E[1]
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_KANT_S[0]=_FASE_E[0] _KANT_S[1]=_FASE_E[1]
_KANT_E[0]=_RUV*COS((_I+2)*_PHI)-_RP/_LP*_RUV*(COS((_I+2)*_PHI)-COS((_I+1)*_PHI))
_KANT_E[1]=_RUV*SIN((_I+2)*_PHI)-_RP/_LP*_RUV*(SIN((_I+2)*_PHI)-SIN((_I+1)*_PHI))
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1]
_S2_A[0]=_KANT_S[0] _S2_A[1]=_KANT_S[1] _S2_E[0]=_KANT_E[0] _S2_E[1]=_KANT_E[1]
_RADIUS =_RVF
REPEAT _CALC_RND_A _CALC_RND_E
_FRND2_S[0]=_KR_A[0] _FRND2_S[1]=_KR_A[1] _FRND2_E[0]=_KR_E[0] _FRND2_E[1]=_KR_E[1] _FRND2_M[0]=_KR_M[0] _FRND2_M[1]=_KR_M[1]
_FASE_E[0]=_FRND2_S[0] _FASE_E[1]=_FRND2_S[1]
_KANT_S[0]=_FRND2_E[0] _KANT_S[1]=_FRND2_E[1]
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FRND1_S[0] _S1_A[1]=_FRND1_S[1] _S1_E[0]=_FRND1_E[0] _S1_E[1]=_FRND1_E[1]
_S1_M[0]=_FRND1_M[0] _S1_M[1]=_FRND1_M[1] _S1_G=3
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FRND2_S[0] _S1_A[1]=_FRND2_S[1] _S1_E[0]=_FRND2_E[0] _S1_E[1]=_FRND2_E[1]
_S1_M[0]=_FRND2_M[0] _S1_M[1]=_FRND2_M[1] _S1_G=3
REPEAT _MOVE_A _MOVE_E
_FASE_E[0]=_FRND2_E[0] _FASE_E[1]=_FRND2_E[1]
ELSE
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
ENDIF
ELSE
IF(_OPTIMIZE==FALSE)
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)
_RUND_E[0]=_RUV*COS((_I+1)*_PHI)+_RP/_LP*_RUV*(COS((_I+2)*_PHI)-COS((_I+1)*_PHI))
_RUND_E[1]=_RUV*SIN((_I+1)*_PHI)+_RP/_LP*_RUV*(SIN((_I+2)*_PHI)-SIN((_I+1)*_PHI))
N110 G1 G[10]=_GG10 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1] RND=_R+(_EBEN-_J)*_DEB
ELSE
_KANT_S[0]=_RUND_E[0] _KANT_S[1]=_RUND_E[1]
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)-_RP/_LP*_RUV*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)-_RP/_LP*_RUV*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_RUND_M[0]=(_RUM-_R/SIN(_ALFA/2))*COS((_I+1)*_PHI)
_RUND_M[1]=(_RUM-_R/SIN(_ALFA/2))*SIN((_I+1)*_PHI)
_RUND_S[0]=_KANT_E[0] _RUND_S[1]=_KANT_E[1]
_RUND_E[0]=_RUV*COS((_I+1)*_PHI)+_RP/_LP*_RUV*(COS((_I+2)*_PHI)-COS((_I+1)*_PHI))
_RUND_E[1]=_RUV*SIN((_I+1)*_PHI)+_RP/_LP*_RUV*(SIN((_I+2)*_PHI)-SIN((_I+1)*_PHI))
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_RUND_S[0] _S1_A[1]=_RUND_S[1] _S1_E[0]=_RUND_E[0] _S1_E[1]=_RUND_E[1]
_S1_M[0]=_RUND_M[0] _S1_M[1]=_RUND_M[1] _S1_G=3
REPEAT _MOVE_A _MOVE_E
ENDIF
ENDIF
IF(_J==_EBEN)
_MUN_ACT=_NUM-1
ENDIF
IF(_HELIKAL==1)AND(_I==_NUM-1)AND(_J<>_EBEN)
REPEAT _ABFAHRT_HELIKAL_A _ABFAHRT_HELIKAL_E
ENDIF
ELSE
IF(_RC<0)
_KANT_S[0]=_FASE_E[0] _KANT_S[1]=_FASE_E[1]
ELSE
_KANT_S[0]=_RUND_E[0] _KANT_S[1]=_RUND_E[1]
ENDIF
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)+_PRAD*2/_NORM*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)+_PRAD*2/_NORM*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1] _S2_G=1
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_KANT_E[0]=_SP1[0] _KANT_E[1]=_SP1[1]
_ZIEL_S[0]=_SP1[0] _ZIEL_S[1]=_SP1[1]
IF(_RC<0)
IF(_RZ==0)
_KANT_E[0]=_RUV*COS((_I+1)*_PHI)-_RP/_LP*_RUV*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_RUV*SIN((_I+1)*_PHI)-_RP/_LP*_RUV*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_FASE_S[0]=_KANT_E[0] _FASE_S[1]=_KANT_E[1]
_FASE_E[0]=_RUV*COS((_NUM)*_PHI)+_RP/_LP*_RUV*(COS((_NUM+1)*_PHI)-COS((_NUM)*_PHI))
_FASE_E[1]=_RUV*SIN((_NUM)*_PHI)+_RP/_LP*_RUV*(SIN((_NUM+1)*_PHI)-SIN((_NUM)*_PHI))
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1] _S2_G=1
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_FASE_E[0]=_SP1[0] _FASE_E[1]=_SP1[1]
ELSE
_KANT_E[0]=_SP1[0]-_RPZ/_NORM*(COS((_I+1)*_PHI)-COS(_I*_PHI))
_KANT_E[1]=_SP1[1]-_RPZ/_NORM*(SIN((_I+1)*_PHI)-SIN(_I*_PHI))
_FASE_S[0]=_KANT_E[0] _FASE_S[1]=_KANT_E[1]
_FASE_E[0]=_SP1[0]+_RPZ/_NORM*(COS((_NUM+1)*_PHI)-COS((_NUM)*_PHI))
_FASE_E[1]=_SP1[1]+_RPZ/_NORM*(SIN((_NUM+1)*_PHI)-SIN((_NUM)*_PHI))
ENDIF
IF(_RUNDUNG== TRUE)AND(_RVF>0)
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1]
_S2_A[0]=_FASE_S[0] _S2_A[1]=_FASE_S[1] _S2_E[0]=_FASE_E[0] _S2_E[1]=_FASE_E[1]
_RADIUS =_RPFZ
REPEAT _CALC_RND_A _CALC_RND_E
_FRND1_S[0]=_KR_A[0] _FRND1_S[1]=_KR_A[1] _FRND1_E[0]=_KR_E[0] _FRND1_E[1]=_KR_E[1] _FRND1_M[0]=_KR_M[0] _FRND1_M[1]=_KR_M[1]
_KANT_E[0]=_FRND1_S[0] _KANT_E[1]=_FRND1_S[1]
_FASE_S[0]=_FRND1_E[0] _FASE_S[1]=_FRND1_E[1]
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_ZIEL_S[0]=_FASE_E[0] _ZIEL_S[1]=_FASE_E[1]
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1]
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1]
_RADIUS =_RPFZ
REPEAT _CALC_RND_A _CALC_RND_E
_FRND2_S[0]=_KR_A[0] _FRND2_S[1]=_KR_A[1] _FRND2_E[0]=_KR_E[0] _FRND2_E[1]=_KR_E[1] _FRND2_M[0]=_KR_M[0] _FRND2_M[1]=_KR_M[1]
_FASE_E[0]=_FRND2_S[0] _FASE_E[1]=_FRND2_S[1]
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FRND1_S[0] _S1_A[1]=_FRND1_S[1] _S1_E[0]=_FRND1_E[0] _S1_E[1]=_FRND1_E[1]
_S1_M[0]=_FRND1_M[0] _S1_M[1]=_FRND1_M[1] _S1_G=3
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FRND2_S[0] _S1_A[1]=_FRND2_S[1] _S1_E[0]=_FRND2_E[0] _S1_E[1]=_FRND2_E[1]
_S1_M[0]=_FRND2_M[0] _S1_M[1]=_FRND2_M[1] _S1_G=3
REPEAT _MOVE_A _MOVE_E
_FASE_E[0]=_FRND2_E[0] _FASE_E[1]=_FRND2_E[1]
ELSE
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_FASE_S[0] _S1_A[1]=_FASE_S[1] _S1_E[0]=_FASE_E[0] _S1_E[1]=_FASE_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
ENDIF
ELSE
IF(_OPTIMIZE==FALSE)
N120 G1 G[10]=_GG10 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1] RND=_R+(_EBEN-_J-0.5)*_DEB
ELSE
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1]
_S2_A[0]=_ZIEL_S[0] _S2_A[1]=_ZIEL_S[1] _S2_E[0]=_ZIEL_E[0] _S2_E[1]=_ZIEL_E[1]
_RADIUS =_RPZ
REPEAT _CALC_RND_A _CALC_RND_E
_RUND_S[0]=_KR_A[0] _RUND_S[1]=_KR_A[1] _RUND_E[0]=_KR_E[0] _RUND_E[1]=_KR_E[1] _RUND_M[0]=_KR_M[0] _RUND_M[1]=_KR_M[1]
_KANT_E[0]=_RUND_S[0] _KANT_E[1]=_RUND_S[1]
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_KANT_S[0] _S1_A[1]=_KANT_S[1] _S1_E[0]=_KANT_E[0] _S1_E[1]=_KANT_E[1] _S1_G=1
REPEAT _MOVE_A _MOVE_E
_RADIUS=_PRAD+_SDIS
_S1_A[0]=_RUND_S[0] _S1_A[1]=_RUND_S[1] _S1_E[0]=_RUND_E[0] _S1_E[1]=_RUND_E[1]
_S1_M[0]=_RUND_M[0] _S1_M[1]=_RUND_M[1] _S1_G=3
REPEAT _MOVE_A _MOVE_E
ENDIF
ENDIF
ENDIF
ENDFOR
ENDFOR
IF(_HELIKAL==1)OR(_GRUND)
_ABFAHRT_HELIKAL_A:
IF(_RC<0)
IF(_GRUND)
REPEAT _NEXT_KANTE_A _NEXT_KANTE_E
ENDIF
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
IF(_MODE==2)AND(_FALG)
IF(NOT _GRUND)
_NEXT_KANTE_A:
_KANT_S[0]=_FASE_E[0] _KANT_S[1]=_FASE_E[1]
_KANT_E[0]=_RUV*COS((0+1)*_PHI)-_RP/_LP*_RUV*(COS((0+1)*_PHI)-COS(0*_PHI))
_KANT_E[1]=_RUV*SIN((0+1)*_PHI)-_RP/_LP*_RUV*(SIN((0+1)*_PHI)-SIN(0*_PHI))
_NORM3=1;SQRT(POT((_KANT_E[0]-_KANT_S[0]))+POT((_KANT_E[1]-_KANT_S[1])))
_KANT_E[0]=_KANT_S[0]+0.5/_NORM3*(_KANT_E[0]-_KANT_S[0])
_KANT_E[1]=_KANT_S[1]+0.5/_NORM3*(_KANT_E[1]-_KANT_S[1])
N124 G1 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1]
_NEXT_KANTE_E:
ENDIF
_FASE_S[0]=_KANT_S[0] _FASE_S[1]=_KANT_S[1]
_FASE_E[0]=_KANT_E[0] _FASE_E[1]=_KANT_E[1]
_KANT_S[0]=0 _KANT_S[1]=0
_KANT_E[0]=_FASE_E[1]-_FASE_S[1]
_KANT_E[1]=_FASE_S[0]-_FASE_E[0]
_NORM3=SQRT(POT((_KANT_E[0]-_KANT_S[0]))+POT((_KANT_E[1]-_KANT_S[1])))
_KANT_E[0]=($P_TOOLR*_FAK1)/_NORM3*(_KANT_E[0]-_KANT_S[0])
_KANT_E[1]=($P_TOOLR*_FAK1)/_NORM3*(_KANT_E[1]-_KANT_S[1])
N126 G0 G40 AX[_XX]=IC(_KANT_E[0]) AX[_YY]=IC(_KANT_E[1])
;MSG("Abfahrt Schlichten Rand/Grund: GRUND="<<_GRUND)
;M0
GOTOF _SKIP_ABFAHRT
ENDIF
REPEAT _ABFAHRT_FASE_A _ABFAHRT_FASE_E
N121 G1 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1]
ELSE
REPEAT _ABFAHRT_RUND_A _ABFAHRT_RUND_E
N122 G1 AX[_XX]=_DEPART_S[0] AX[_YY]=_DEPART_S[1]
REPEAT _CALL_CYCLE72_A _CALL_CYCLE72_E
IF(_MODE==2)AND(_FALG)
_NORM3=SQRT(POT((_DEPART_S[0]-_DEPART_M[0]))+POT((_DEPART_S[1]-_DEPART_M[1])))
_KANT_E[0]=($P_TOOLR*_FAK1)/_NORM3*(_DEPART_M[0]-_DEPART_S[0])
_KANT_E[1]=($P_TOOLR*_FAK1)/_NORM3*(_DEPART_M[1]-_DEPART_S[1])
IF(_GRUND)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,360/_NUM)
ENDIF
N127 G1 G40 AX[_XX]=IC(_KANT_E[0]) AX[_YY]=IC(_KANT_E[1])
IF(_GRUND)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-360/_NUM)
ENDIF
;MSG("Abfahrt Schlichten Rand/Grund: GRUND="<<_GRUND)
;M0
GOTOF _SKIP_ABFAHRT
ENDIF
N123 G2 AX[_XX]=_DEPART_E[0] AX[_YY]=_DEPART_E[1] IP[_XX]=AC(_DEPART_M[0]) IP[_YY]=AC(_DEPART_M[1])
ENDIF
_ABFAHRT_HELIKAL_E:
N125 G0 AX[_ZZ]=_RFP+_SDIS*_PMZ
GOTOF _SKIP_ABFAHRT
ENDIF
S_DIST=_SDIS
IF(S_DISC_CUTTER)AND((_T==1)OR((_T-1)*_DTI<2*_SDIS))
S_DIST=ABS((_T-1)*_DTI/2)
ENDIF
IF(_RC<0)
IF(_OPTIMIZE==FALSE)OR(SQRT(POT(_FASE_E[0])+POT(_FASE_E[1]))<_PRAD+_SDIS)
_ABFAHRT_FASE_A:
_NORM3=SQRT(POT((_FASE_E[0]-_FASE_S[0]))+POT((_FASE_E[1]-_FASE_S[1])))
_KANT_S[0]=_FASE_E[0] _KANT_S[1]=_FASE_E[1]
_KANT_E[0]=_KANT_S[0]+_USCHI/_NORM3*(_FASE_E[0]-_FASE_S[0])
_KANT_E[1]=_KANT_S[1]+_USCHI/_NORM3*(_FASE_E[1]-_FASE_S[1])
_ABFAHRT_FASE_E:
N130 G1 G[10]=_GG10 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1] AX[_ZZ]=_RFP-(_T*_DTI-S_DIST)*_PMZ
ELSE
_KANT_S[0]=_WPKT[0] _KANT_S[1]=_WPKT[1]
ENDIF
IF(_MODE==1)AND(_T<>_TIEF)
_KANT_S[0]=_KANT_E[0] _KANT_S[1]=_KANT_E[1]
_KANT_E[0]=_START_S[0] _KANT_E[1]=_START_S[1]
EXECSTRING(_S_FFP1)
N140 G1 G[10]=_GG10 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1] AX[_ZZ]=_RFP-(_T*_DTI-S_DIST)*_PMZ
ENDIF
ELSE
IF(_OPTIMIZE==FALSE)
_ABFAHRT_RUND_A:
_RUND_M[0]=(_RUM-_R/SIN(_ALFA/2))*COS(0*_PHI)
_RUND_M[1]=(_RUM-_R/SIN(_ALFA/2))*SIN(0*_PHI)
_RUND_S[0]=_KANT_E[0] _RUND_S[1]=_KANT_E[1]
_RUND_E[0]=_RUV*COS(0*_PHI)+_RP/_LP*_RUV*(COS(1*_PHI)-COS(0*_PHI))
_RUND_E[1]=_RUV*SIN(0*_PHI)+_RP/_LP*_RUV*(SIN(1*_PHI)-SIN(0*_PHI))
_DEPART_D=2
_DEPART_S[0]=_RUND_E[0] _DEPART_S[1]=_RUND_E[1]
_DEPART_M[0]=_DEPART_S[0]+_USCHI*COS(_PHI/2)
_DEPART_M[1]=_DEPART_S[1]+_USCHI*SIN(_PHI/2)
_DEPART_E[0]=_DEPART_M[0]+_USCHI*(COS(_PHI)-1)/SQRT(2-2*COS(_PHI))
_DEPART_E[1]=_DEPART_M[1]+_USCHI*SIN(_PHI)/SQRT(2-2*COS(_PHI))
_ABFAHRT_RUND_E:
_KANT_S[0]=_DEPART_E[0] _KANT_S[1]=_DEPART_E[1]
N150 G1 G[10]=_GG10 AX[_XX]=_DEPART_S[0] AX[_YY]=_DEPART_S[1]
N155 G2 G[10]=_GG10 AX[_XX]=_DEPART_E[0] AX[_YY]=_DEPART_E[1] AX[_ZZ]=_RFP-(_T*_DTI-S_DIST)*_PMZ IP[_XX]=AC(_DEPART_M[0]) IP[_YY]=AC(_DEPART_M[1])
ELSE
IF(SQRT(POT(_RUND_E[0])+POT(_RUND_E[1]))<_PRAD+_SDIS)
_DEPART_D=2
_DEPART_S[0]=_RUND_E[0] _DEPART_S[1]=_RUND_E[1]
_DEPART_M[0]=_DEPART_S[0]+_USCHI*COS(_PHI/2)
_DEPART_M[1]=_DEPART_S[1]+_USCHI*SIN(_PHI/2)
_DEPART_E[0]=_DEPART_M[0]+_USCHI*(COS(_PHI)-1)/SQRT(2-2*COS(_PHI))
_DEPART_E[1]=_DEPART_M[1]+_USCHI*SIN(_PHI)/SQRT(2-2*COS(_PHI))
_KANT_S[0]=_DEPART_E[0] _KANT_S[1]=_DEPART_E[1]
N200 G2 G[10]=_GG10 AX[_XX]=_DEPART_E[0] AX[_YY]=_DEPART_E[1] AX[_ZZ]=_RFP-(_T*_DTI-S_DIST)*_PMZ IP[_XX]=AC(_DEPART_M[0]) IP[_YY]=AC(_DEPART_M[1])
ELSE
_KANT_S[0]=_WPKT[0] _KANT_S[1]=_WPKT[1]
ENDIF
ENDIF
IF((_MODE==1)AND(_T<>_TIEF))OR((_MODE==2)AND(_FALG==TRUE)AND(_T==_TIEF-1))OR((S_DISC_CUTTER==TRUE)AND(_T==_TIEF))
_NORM1=SQRT(POT(_DEPART_M[0]-_DEPART_S[0])+POT(_DEPART_M[1]-_DEPART_S[1]))
IF(_MODE==2)AND(((_FALG==TRUE)AND(_T==_TIEF-1))OR((S_DISC_CUTTER==TRUE)AND(_T==_TIEF)))
G0 G40 AX[_XX]=_KANT_S[0]+$P_TOOLR*_FAK1*(_DEPART_M[1]-_DEPART_S[1])/_NORM1 AX[_YY]=_KANT_S[1]-$P_TOOLR*_FAK1*(_DEPART_M[0]-_DEPART_S[0])/_NORM1
IF(S_DISC_CUTTER==TRUE)AND(_T==_TIEF)
REPEAT _GET_SCHLICHT_A _GET_SCHLICHT_E
REPEAT _GET_SCHLICHT_A2 _GET_SCHLICHT_E2
_START_S[0]=_XS
_START_S[1]=_YS
ELSE
REPEAT _GET_START_A _GET_START_E
_PR=($P_TOOLR*_FAK1+$P_OFFN*_FAK2)/SQRT(ABS(POT(_START_M[0]-_START_S[0])+POT(_START_M[1]-_START_S[1])))
_START_S[0]=_START_S[0]+_PR*(_START_M[0]-_START_S[0])
_START_S[1]=_START_S[1]+_PR*(_START_M[1]-_START_S[1])
ENDIF
_KANT_S[0]=$P_EP[_XX] _KANT_S[1]=$P_EP[_YY]
ENDIF
_KANT_E[0]=_START_S[0] _KANT_E[1]=_START_S[1]
_NORM2=SQRT(POT(_KANT_E[0]-_KANT_S[0])+POT(_KANT_E[1]-_KANT_S[1]))
_GAMA=ACOS(((_DEPART_M[0]-_DEPART_S[0])/_NORM1)*((_KANT_E[0]-_KANT_S[0])/_NORM2)+((_DEPART_M[1]-_DEPART_S[1])/_NORM1)*((_KANT_E[1]-_KANT_S[1])/_NORM2))
IF(_GAMA<=90)
SBLON
N210 G0 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1] AX[_ZZ]=_RFP-(_T*_DTI-S_DIST)*_PMZ
SBLOF
ELSE
_DEPART_D=2
_DEPART_S[0]=_KANT_S[0] _DEPART_S[1]=_KANT_S[1]
_DEPART_E[0]=_KANT_E[0] _DEPART_E[1]=_KANT_E[1]
_DEPART_M[0]=_DEPART_S[0]+0.5*(_DEPART_E[0]-_DEPART_S[0])
_DEPART_M[1]=_DEPART_S[1]+0.5*(_DEPART_E[1]-_DEPART_S[1])
EXECSTRING(_S_FFC)
N215 G2 G[10]=_GG10 AX[_XX]=_DEPART_E[0] AX[_YY]=_DEPART_E[1] AX[_ZZ]=_RFP-(_T*_DTI-S_DIST)*_PMZ IP[_XX]=AC(_DEPART_M[0]) IP[_YY]=AC(_DEPART_M[1])
EXECSTRING(_S_FFP1)
ENDIF
ENDIF
ENDIF
_SKIP_ABFAHRT:
ENDFOR
SBLON
IF(NOT(S_IS_ST))AND(NOT(_ZZSD[8]))
N250 G0 AX[_ZZ]=_RTP
ENDIF
SBLOF
IF(_MODE==2)AND(S_DISC_CUTTER==FALSE)AND(NOT _GRUND)
IF(_RC<0)
_FASE_S[0]=_KANT_E[0] _FASE_S[1]=_KANT_E[1]
_FASE_E[0]=_FASE_S[0]+(_KANT_E[1]-_KANT_S[1])
_FASE_E[1]=_FASE_S[1]-(_KANT_E[0]-_KANT_S[0])
_NORM3=SQRT(POT((_FASE_E[0]-_FASE_S[0]))+POT((_FASE_E[1]-_FASE_S[1])))
_FASE_E[0]=_FASE_S[0]+(_USCHI-_SDIS)/_NORM3*(_FASE_E[0]-_FASE_S[0])
_FASE_E[1]=_FASE_S[1]+(_USCHI-_SDIS)/_NORM3*(_FASE_E[1]-_FASE_S[1])
SBLON
N300 G0 G40 AX[_XX]=_FASE_E[0] AX[_YY]=_FASE_E[1]
SBLOF
ELSE
_NORM3=SQRT(POT((_DEPART_E[0]-_DEPART_M[0]))+POT((_DEPART_E[1]-_DEPART_M[1])))
_KANT_E[0]=_DEPART_E[0]+(_USCHI-_SDIS)/_NORM3*(_DEPART_M[0]-_DEPART_E[0])
_KANT_E[1]=_DEPART_E[1]+(_USCHI-_SDIS)/_NORM3*(_DEPART_M[1]-_DEPART_E[1])
SBLON
N310 G0 G40 AX[_XX]=_KANT_E[0] AX[_YY]=_KANT_E[1]
SBLOF
ENDIF
ENDIF
ENDIF
IF((_ARTIS[0]==11) OR (_ARTIS[11]==3))
M=QU(_ARTIS[8])
ENDIF
SBLON
IF(NOT(S_IS_ST))AND(NOT(_ZZSD[8]))
N600 G0 G90 AX[_ZZ]=_RTP
ENDIF
SBLOF
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-_STAFA*_STA)
IF(_MIRR)
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
IF(_NUM<=2)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-180)
ENDIF
ENDIF
IF(_NUM<=2)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,90)
ELSE
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-180/_NUM)
ENDIF
IF(_VARI _DEC1==5)
IF(_ZZSD[8]==0)
CYCLE203(0,_FS,_ZFS)
ENDIF
ENDIF
IF(($P_MC)AND(_SC_PC==1))
SBLON
N610 AX[_XX]=0 AX[_YY]=0
SBLOF
ENDIF
IF(_TIEF>1)
ENDIF
$P_CYCFRAME=_RE_CYCFR
IF $P_ADT[1]==140
TOFFR=S_TOFFR
ENDIF
SBLON
RET
_MOVE_A:
IF(_OPTIMIZE==TRUE)
_S2_A[0]=-_RADIUS _S2_A[1]=0 _S2_E[0]=-_RADIUS _S2_E[1]=0 _S1_M[0]=0 _S1_M[1]=0 _S2_G=3
REPEAT _SCHNITT_A _SCHNITT_E
_SP1[0]=_S[0] _SP1[1]=_S[1] _SP1[2]=_SII
_KR_A[0]=_S1_E[0] _KR_A[1]=_S1_E[1] _KR_E[0]=_S1_A[0] _KR_E[1]=_S1_A[1]
_S1_A[0]=_KR_A[0] _S1_A[1]=_KR_A[1] _S1_E[0]=_KR_E[0] _S1_E[1]=_KR_E[1]
IF(_S1_G==2)
_S1_G=3
ENDIF
IF(_S1_G==3)
_S1_G=2
ENDIF
REPEAT _SCHNITT_A _SCHNITT_E
_SP2[0]=_S[0] _SP2[1]=_S[1] _SP2[2]=_SII
_KR_A[0]=_S1_E[0] _KR_A[1]=_S1_E[1] _KR_E[0]=_S1_A[0] _KR_E[1]=_S1_A[1]
_S1_A[0]=_KR_A[0] _S1_A[1]=_KR_A[1] _S1_E[0]=_KR_E[0] _S1_E[1]=_KR_E[1]
_DIST_E=SQRT(POT(_S1_E[0])+POT(_S1_E[1]))
IF(_S1_G==2)
_S1_G=3
ENDIF
IF(_S1_G==3)
_S1_G=2
ENDIF
ENDIF
IF(_OPTIMIZE==FALSE)OR(_DRIN==TRUE)
IF(_OPTIMIZE==FALSE)OR(_SP1[2]==0)
_VPKT[0]=_S1_E[0] _VPKT[1]=_S1_E[1]
REPEAT _CUT_A _CUT_E
ELSE
_VPKT[0]=_SP1[0] _VPKT[1]=_SP1[1]
REPEAT _CUT_A _CUT_E
IF(_DIST_E<_RADIUS)
IF(_SP1[0]<>_SP2[0])OR(_SP1[1]<>_SP2[1])
EXECSTRING(_S_FFC)
N400 G3 G[10]=_GG10 AX[_XX]=_SP2[0] AX[_YY]=_SP2[1] IP[_XX]=AC(0) IP[_YY]=AC(0)
EXECSTRING(_S_FFP1)
ENDIF
_VPKT[0]=_S1_E[0] _VPKT[1]=_S1_E[1]
REPEAT _CUT_A _CUT_E
ELSE
_DRIN=FALSE
ENDIF
ENDIF
ELSE
IF(_SP1[2])
EXECSTRING(_S_FFC)
N410 G3 G[10]=_GG10 AX[_XX]=_SP1[0] AX[_YY]=_SP1[1] IP[_XX]=AC(0) IP[_YY]=AC(0)
EXECSTRING(_S_FFP1)
IF(_DIST_E<_RADIUS)
_VPKT[0]=_S1_E[0] _VPKT[1]=_S1_E[1]
REPEAT _CUT_A _CUT_E
_DRIN=TRUE
ELSE
_VPKT[0]=_SP2[0] _VPKT[1]=_SP2[1]
REPEAT _CUT_A _CUT_E
ENDIF
ELSE
ENDIF
ENDIF
_MOVE_E:
_CUT_A:
EXECSTRING(_S_FFP1)
IF(_S1_G==1)
N510 G1 G[10]=_GG10 AX[_XX]=_VPKT[0] AX[_YY]=_VPKT[1]
ENDIF
IF(_S1_G==2)
N520 G2 G[10]=_GG10 AX[_XX]=_VPKT[0] AX[_YY]=_VPKT[1] IP[_XX]=AC(_S1_M[0]) IP[_YY]=AC(_S1_M[1])
ENDIF
IF(_S1_G==3)
N530 G3 G[10]=_GG10 AX[_XX]=_VPKT[0] AX[_YY]=_VPKT[1] IP[_XX]=AC(_S1_M[0]) IP[_YY]=AC(_S1_M[1])
ENDIF
_WPKT[0]=_VPKT[0] _WPKT[1]=_VPKT[1]
_CUT_E:
_CALC_RND_A:
_NORM1=SQRT(POT(_S1_E[0]-_S1_A[0])+POT(_S1_E[1]-_S1_A[1]))
_NORM2=SQRT(POT(_S2_E[0]-_S2_A[0])+POT(_S2_E[1]-_S2_A[1]))
_GAMA =180-ACOS(((_S1_E[0]-_S1_A[0])/_NORM1)*((_S2_E[0]-_S2_A[0])/_NORM2)+((_S1_E[1]-_S1_A[1])/_NORM1)*((_S2_E[1]-_S2_A[1])/_NORM2))
_KR_A[0]=_S1_E[0]-(_RADIUS/TAN(_GAMA/2))/SQRT(POT(_S1_E[0]-_S1_A[0])+POT(_S1_E[1]-_S1_A[1]))*(_S1_E[0]-_S1_A[0])
_KR_A[1]=_S1_E[1]-(_RADIUS/TAN(_GAMA/2))/SQRT(POT(_S1_E[0]-_S1_A[0])+POT(_S1_E[1]-_S1_A[1]))*(_S1_E[1]-_S1_A[1])
_KR_E[0]=_S2_A[0]+(_RADIUS/TAN(_GAMA/2))/SQRT(POT(_S2_E[0]-_S2_A[0])+POT(_S2_E[1]-_S2_A[1]))*(_S2_E[0]-_S2_A[0])
_KR_E[1]=_S2_A[1]+(_RADIUS/TAN(_GAMA/2))/SQRT(POT(_S2_E[0]-_S2_A[0])+POT(_S2_E[1]-_S2_A[1]))*(_S2_E[1]-_S2_A[1])
_KR_M[0]=_S1_E[0]+(_RADIUS/SIN(_GAMA/2))/(2*_RADIUS/TAN(_ALFA/2)*COS(_GAMA/2))*(_KR_A[0]-_S1_E[0]+_KR_E[0]-_S2_A[0])
_KR_M[1]=_S1_E[1]+(_RADIUS/SIN(_GAMA/2))/(2*_RADIUS/TAN(_ALFA/2)*COS(_GAMA/2))*(_KR_A[1]-_S1_E[1]+_KR_E[1]-_S2_A[1])
_CALC_RND_E:
_SCHNITT_A:
_KT[0,3]=_S1_A[0] _KT[0,4]=_S1_A[1] _KT[0,5]=_S1_E[0] _KT[0,6]=_S1_E[1]
_KT[1,3]=_S2_A[0] _KT[1,4]=_S2_A[1] _KT[1,5]=_S2_E[0] _KT[1,6]=_S2_E[1]
_KT[0,9]=_S1_M[0] _KT[0,10]=_S1_M[1] _KT[0,2]=_S1_G
_KT[1,9]=_S2_M[0] _KT[1,10]=_S2_M[1] _KT[1,2]=_S2_G
_SII=INTERSEC(_KT[0],_KT[1],_S,1)
_SCHNITT_E:
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_XX]=_XS
$AA_MEAS_POINT1[_YY]=_YS
$AA_MEAS_POINT1[_ZZ]=_ZS
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_XX])+POT($AA_MEAS_POINT2[_YY])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_XX,_XS,_YY,_YS,_ZZ,_ZS)
_SC_POS[0]=$P_CYCFRAME[_XX,TR]
_SC_POS[1]=$P_CYCFRAME[_YY,TR]
_SC_POS[2]=$P_CYCFRAME[_ZZ,TR]
$P_CYCFRAME=_RE_CYCFR
IF $P_ADT[1]==140
TOFFR=S_TOFFR
ENDIF
RET
_CALL_CYCLE72_A:
N960 EXECUTE(_ERROR)
IF(ISFILE(_TEMP_FILE))
FOR _I=0 TO _KTS[0,5]
WRITE(_TEMP,_TEMP_FILE,"I="<<_I<<" G"<<_KTS[_I,0] MOD 10<<" "<<_KTS[_I,1]<<" "<<_KTS[_I,2]<<" "<<_KTS[_I,3]<<" "<<_KTS[_I,4]<<" F="<<_KTS[_I,5])
ENDFOR
ENDIF
IF(_ERROR) GOTOF _FEHL41
_CONT_TAB[1,0]=0
FOR _I=0 TO _KTS[0,5]
IF(_CONT_TAB[1,0]<2)AND((_KTS[_I,0] MOD 10)==2)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=1
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=0
_CONT_TAB[4,_CONT_TAB[1,0]]=0
ENDIF
IF((_KTS[_I,0] MOD 10)==1)OR((_KTS[_I,0] MOD 10)==3)
_CONT_TAB[1,0]=_CONT_TAB[1,0]+1
_CONT_TAB[0,_CONT_TAB[1,0]]=_KTS[_I,0] MOD 10
_CONT_TAB[1,_CONT_TAB[1,0]]=_KTS[_I,1]
_CONT_TAB[2,_CONT_TAB[1,0]]=_KTS[_I,2]
_CONT_TAB[3,_CONT_TAB[1,0]]=_KTS[_I,3]
_CONT_TAB[4,_CONT_TAB[1,0]]=_KTS[_I,4]
ENDIF
ENDFOR
_KNAME="_E_SP_EGD_ANF:_E_SP_EGD_END"
_VARI72=1+100000
IF(_MODE>1)
_VARI72=2+100000
ENDIF
IF(_MODE==2)AND(_FALG)
_VARI72=2+1100000
ENDIF
IF(_GRUND)
_VARI72=2+2100000+10000
ENDIF
_FRK=40
IF(_MODE>1)AND(_NUM>=3)
IF(_GRUND)
_FRK=41
G41
ELSE
_FRK=42
G42
ENDIF
ENDIF
IF(_GRUND)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,360/_NUM)
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
ENDIF
N970 CYCLE72(_KNAME,_RTP,_RFP,_SDIS,_DP,_MID,_FAL,_FALD,_FFP1,_FFP1,_VARI72,_FRK,0,0,_FFP1,0,0)
IF(_GRUND)
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-360/_NUM)
ENDIF
_CALL_CYCLE72_E:
_E_SP_EGD_ANF:
FOR _CONT_TAB[0,0]=1 TO _CONT_TAB[1,0]
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==1)
N910 G1 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]]
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==2)
N920 G2 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
IF(_CONT_TAB[0,_CONT_TAB[0,0]]==3)
N930 G3 AX[$P_AXN1]=_CONT_TAB[1,_CONT_TAB[0,0]] AX[$P_AXN2]=_CONT_TAB[2,_CONT_TAB[0,0]] IP[$P_AXN1]=AC(_CONT_TAB[3,_CONT_TAB[0,0]]) IP[$P_AXN2]=AC(_CONT_TAB[4,_CONT_TAB[0,0]])
ENDIF
ENDFOR
_E_SP_EGD_END:
_FEHL1:STOPRE
N707901 SETAL(61002)
RET
_FEHL2:STOPRE
N707902 SETAL(61003)
RET
_FEHL3:STOPRE
N707903 SETAL(61010)
RET
_FEHL4:STOPRE
N707904 SETAL(61012)
RET
_FEHL5:STOPRE
N707905 SETAL(61102)
RET
_FEHL6:STOPRE
N707906 SETAL(61112)
RET
_FEHL7:STOPRE
N707907 SETAL(61222)
RET
_FEHL8:STOPRE
N707908 SETAL(61246)
RET
_FEHL9:STOPRE
N707909 SETAL(61247)
RET
_FEHL10:STOPRE
N707910 SETAL(61248)
RET
_FEHL11:STOPRE
N707911 SETAL(61249)
RET
_FEHL12:STOPRE
N707912 SETAL(61250)
RET
_FEHL13:STOPRE
N707913 SETAL(61251)
RET
_FEHL14:STOPRE
N707914 SETAL(61252)
RET
_FEHL15: STOPRE
N707915 SETAL(62106)
RET
_FEHL16:STOPRE
N707916 SETAL(61024,"(SD 55230)")
RET
_FEHL17: STOPRE
N707917 SETAL(61019,"(_GMODE: dec3)")
RET
_FEHL18: STOPRE
N707918 SETAL(61019," R1/FS1 ")
RET
_FEHL19: STOPRE
N707919 SETAL(61158)
RET
_FEHL20: STOPRE
N707920 SETAL(61019,"(_RC)")
RET
_FEHL21:STOPRE
N707921 SETAL(61019,"(_MIDA)")
RET
_FEHL22: STOPRE
N707922 SETAL(61155)
RET
_FEHL23: STOPRE
N707923 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL24: STOPRE
N707924 SETAL(61101)
RET
_FEHL25: STOPRE
N707925 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL26: STOPRE
N707926 SETAL(61159)
RET
_FEHL27: STOPRE
N707927 SETAL(61156)
RET
_FEHL28: STOPRE
N707928 SETAL(61019," Z0/Z1 ")
RET
_FEHL29: STOPRE
N707929 SETAL(61216)
RET
_FEHL30: STOPRE
N707930 SETAL(61019,"(_DMODE: dec5)")
RET
_FEHL31: STOPRE
N707931 SETAL(61604)
RET
_FEHL32: STOPRE
N707932 SETAL(61711)
RET
_FEHL33: STOPRE
N707933 SETAL(61019,"(_VARI: dec6)")
RET
_FEHL39: STOPRE
N707939 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N707940 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_FEHL41: STOPRE
N707941 SETAL(61606)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE81_SPF
PROC CYCLE81(REAL RTP,REAL RFP,REAL _SDIS,REAL _DP,REAL _DPR,REAL __DTB,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Drilling, Centering
DEF AXIS _Z
DEF INT HH7,_II,_ARTIS[16],_TEMP,_TYP,_GMODE2,_DMODE1,_AMODE1,_AMODE2,_GG10
DEF REAL HH2,_FAK1=1,_AD24
DEF REAL DP,DPR,SDIS,_DTB
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE81_MPF", _SERR
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE81_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE81("<<RTP<<","<<RFP<<","<<_SDIS<<","<<_DP<<","<<_DPR<<","<<__DTB<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (_DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
SDIS=_SDIS DP=_DP DPR=_DPR _DTB=__DTB
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ENDIF
ENDIF
_END_ARTIS_STAT:
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_AMODE1=(_AMODE _DEC1)
_GMODE2=(_GMODE _DEC2)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF (_GMODE2==0)
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL25
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL26
ENDIF
_AMODE2=(_AMODE _DEC2)
IF(_AMODE2<0)OR(_AMODE2>2) GOTOF _FEHL27
IF ((_AMODE2==2)AND(_DTB>0))
_DTB=-_DTB
ENDIF
IF ((_AMODE2==1)AND(_DTB<0))
_DTB=ABS(_DTB)
ENDIF
IF ($P_GG[6]==2) AND (ISAXIS(2)==FALSE)
GOTOF _FEHL5
ELSE
_Z=$P_AXN3
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF($P_GG[13]<3)
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ENDIF
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299)AND(_TYP<>560)) GOTOF _FEHL3
ELSE
GOTOF _FEHL30
ENDIF
IF (_GMODE2==1)
IF RTP==RFP GOTOF _FEHL1
IF $P_SUBPAR[5] GOTOF _FEHL31
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL4
IF(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
_AD24=$P_ADT[24]
IF(_AD24>0)AND(_AD24<180)
DP=ABS(DP)
IF (($P_TOOLR*_FAK1) < (DP/2/TAN(_AD24/2))) GOTOF _FEHL28
DP=RFP-DP/2/TAN(_AD24/2)*(RTP-RFP)/ABS(RTP-RFP)
ELSE
GOTOF _FEHL28
ENDIF
ENDIF
ENDIF
IF ((DPR==0)AND(_GMODE2==1)) GOTOF _MM1
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MM1
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
N1 _MM0: DP=HH2
_MM1:HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL26
IF HH2==0 GOTOF _MM1A IF HH2/ABS(HH2) <> (RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
_MM1A: HH7=1
SBLON
G[10]=_GG10
AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP) G0 G90
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
IF ($P_GG[30]==6)
N2 G1 AX[_Z]=DP
ELSE
N2 G1 G60 AX[_Z]=DP
ENDIF
IF ABS(_DTB)<0.0001 gotof _NACH_G4_DTB
IF(((_DTB>=0)AND(_AMODE2==0))OR(_AMODE2==1))
N3 G4 F=_DTB
ELSE
N3 G4 S=-_DTB
ENDIF
_NACH_G4_DTB:
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
SBLON
G[10]=_GG10
N3 G0 AX[_Z]=RTP
SBLOF
_MM2:
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
;
_FEHL1:STOPRE
N708101 SETAL(61101)
RET
_FEHL2:STOPRE
N708102 SETAL(62106)
RET
_FEHL3: STOPRE
N708103 SETAL(61212)
RET
_FEHL4: STOPRE
N708104 SETAL(61070)
RET
_FEHL5: STOPRE
N708105 SETAL(61005)
RET
_FEHL18: STOPRE
N708118 SETAL(61019,_SERR)
RET
_FEHL22: STOPRE
N708122 SETAL(61158)
RET
_FEHL23: STOPRE
N708123 SETAL(61159)
RET
_FEHL24: STOPRE
N708124 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N708125 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL26: STOPRE
N708126 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL27: STOPRE
N708127 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL28: STOPRE
N708128 SETAL(61161)
RET
_FEHL29: STOPRE
N708129 SETAL(61162)
RET
_FEHL30: STOPRE
N708130 SETAL(61000)
RET
_FEHL31: STOPRE
N708131 SETAL(61019,"(_GMODE: dec2/DPR)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE82_SPF
PROC CYCLE82 (REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,INT _GMODE,INT _DMODE,INT _AMODE,INT _VARI,REAL S_ZA,REAL S_FA,REAL S_ZD,REAL S_FD,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Drilling, Counterboring
DEF AXIS _Z
DEF REAL HH2,_FAK1=1
DEF BOOL _MDG
DEF INT HH7,_II,_ARTIS[16],_TEMP,_DMODE1,_TYP,_PM1=-1,_AMODE1,_AMODE2
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE82_MPF",_SERR
DEF INT _VARI4,_VARI5,_AMODE3,_AMODE4,_AMODE5,_AMODE6,_WTYP
DEF REAL _HH1,_HH3,_HH4,_HH5,_HMF,_FB,S_SPITZE
DEF STRING[30] _SS_FA,_SS_FD,_SS_FB
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE82_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE82("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<","<<_VARI<<","<<S_ZA<<","<<S_FA<<","<<S_ZD<<","<<S_FD<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL14
ENDIF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE37") OR (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE38")
_ARTIS[0]=0
GOTOF _END_ARTIS_STAT
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ENDIF
ENDIF
_END_ARTIS_STAT:
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
_AMODE2=(_AMODE _DEC2)
IF(_AMODE2<0)OR(_AMODE2>2) GOTOF _FEHL26
IF ((_AMODE2==2)AND(DTB>0))
DTB=-DTB
ENDIF
IF ((_AMODE2==1)AND(DTB<0))
DTB=ABS(DTB)
ENDIF
_VARI5=_VARI _DEC5
_VARI4=_VARI _DEC4
_AMODE3=_AMODE _DEC3
_AMODe4=_AMODE _DEC4
_AMODe5=_AMODE _DEC5
_AMODe6=_AMODE _DEC6
IF (_VARI4<0) OR (_VARI4>1) GOTOF _FEHL32
IF (_VARI5<0) OR (_VARI5>1) GOTOF _FEHL33
IF (_AMODE3<0) OR (_AMODE3>1) GOTOF _FEHL18
IF (_AMODE4<0) OR (_AMODE4>2) GOTOF _FEHL19
IF (_AMODE5<0) OR (_AMODE5>1) GOTOF _FEHL20
IF (_AMODE6<0) OR (_AMODE6>2) GOTOF _FEHL21
IF ($P_GG[6]==2) AND (ISAXIS(2)==FALSE)
GOTOF _FEHL5
ELSE
_Z=$P_AXN3
ENDIF
IF HH7 GOTOF _MM1A
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MM1
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-(RTP-RFP)/ABS(RTP-RFP)*DPR
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
N1 _MM0: DP=HH2
_MM1:
IF RFP==DP GOTOF _FEHL30
IF($P_GG[13]<3)
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ENDIF
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560)) GOTOF _FEHL3
ELSE
GOTOF _FEHL31
ENDIF
IF ((_GMODE _DEC2)==1)
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL4
IF(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
IF ($P_ADT[24]>0)AND($P_ADT[24]<180)
S_SPITZE=$P_TOOLR*_FAK1/TAN($P_ADT[24]/2)
ENDIF
ENDIF
ENDIF
ENDIF
_HH1=(RFP-DP)/ABS(RFP-DP)
IF NOT (RTP==RFP)
IF ((RTP-RFP)/ABS(RTP-RFP) <> _HH1)
GOTOF _FEHL1
ENDIF
ENDIF
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2))
_HH5=ABS(RFP-DP)
ELSE
_HH5=ABS(DPR)
ENDIF
IF (_VARI5==1)
IF _AMODE3==1
IF (RFP==S_ZA) GOTOF _FEHL27
_HH3=(RFP-S_ZA)
IF (_HH3/ABS(_HH3)<>_HH1) GOTOF _FEHL27
ELSE
_HH3=ABS(S_ZA)
ENDIF
_HH3=ABS(_HH3)
ENDIF
IF (_VARI4==1)
IF _AMODE5==1
IF (DP==S_ZD) GOTOF _FEHL28
_HH4=(S_ZD-DP)
IF (_HH4/ABS(_HH4)<>_HH1) GOTOF _FEHL28
ELSE
_HH4=S_ZD
ENDIF
_HH4=ABS(_HH4)
ENDIF
_HMF=$P_ACTFRAME[_Z,SC]
_HH3=_HH3/_HMF _HH4=_HH4/_HMF
IF (_HH3+_HH4)>_HH5 GOTOF _FEHL25
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_SS_FB="G95 F"
_FB=$P_F
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_WTYP=$P_ADT[1]
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL34
ENDIF
_SS_FB="G95 FZ="
_FB=$P_FZ
ELSE
_SS_FB="G94 F"
_FB=$P_F
ENDIF
ENDIF
IF (_VARI5==1)
IF (S_FA==0) AND (_AMODE4>0) GOTOF _FEHL16
IF (_AMODE4==0)
_SS_FA=_SS_FB<<_FB*S_FA/100
ELSE
IF (_AMODE4==1)
_SS_FA="G94 F"<<S_FA
ELSE
_SS_FA="G95 F"<<S_FA
ENDIF
ENDIF
ENDIF
IF (_VARI4==1)
IF (S_FD==0) AND (_AMODE6>0) GOTOF _FEHL17
IF (_AMODE6==0)
_SS_FD=_SS_FB<<_FB*S_FD/100
ELSE
IF (_AMODE6==1)
_SS_FD="G94 F"<<S_FD
ELSE
_SS_FD="G95 F"<<S_FD
ENDIF
ENDIF
ENDIF
_SS_FB=_SS_FB<<_FB
_MM1A: HH7=1
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
N11 G0 G90 AX[_Z]=RFP+SDIS*_HH1/_HMF
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
IF _HH3>0
EXECSTRING(_SS_FA)
N12 G1 AX[_Z]=RFP-_HH1*(_HH3+S_SPITZE)
ENDIF
EXECSTRING(_SS_FB)
N2 G1 AX[_Z]=DP+_HH1*(_HH4-S_SPITZE)
IF _HH4>0
EXECSTRING(_SS_FD)
N13 G1 AX[_Z]=DP-_HH1*S_SPITZE
ENDIF
IF (_VARI4==0)
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF(((DTB>=0)AND(_AMODE2==0))OR(_AMODE2==1))
N3 G4 F=DTB
ELSE
N3 G4 S=-DTB
ENDIF
_NACH_G4_DTB:
ENDIF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
SBLON
N4 G0 AX[_Z]=RTP
SBLOF
_MM2:
EXECSTRING(_SS_FB)
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1:STOPRE
N708201 SETAL(61101)
RET
_FEHL2:STOPRE
N708202 SETAL(62106)
RET
_FEHL3: STOPRE
N708203 SETAL(61212)
RET
_FEHL4: STOPRE
N708204 SETAL(61070)
RET
_FEHL5: STOPRE
N708205 SETAL(61005)
RET
_FEHL14: STOPRE
N708214 SETAL(61019,_SERR)
RET
_FEHL16: STOPRE
N708216 SETAL(61019,"(S_FA)")
RET
_FEHL17: STOPRE
N708217 SETAL(61019,"(S_FD)")
RET
_FEHL18: STOPRE
N708218 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL19: STOPRE
N708219 SETAL(61019,"(_AMODE: dec4)")
RET
_FEHL20: STOPRE
N708220 SETAL(61019,"(_AMODE: dec5)")
RET
_FEHL21: STOPRE
N708221 SETAL(61019,"(_AMODE: dec6)")
RET
_FEHL22: STOPRE
N708222 SETAL(61158)
RET
_FEHL23: STOPRE
N708223 SETAL(61159)
RET
_FEHL24: STOPRE
N708224 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N708225 SETAL(61019,"(S_ZA/S_ZD)")
RET
_FEHL26: STOPRE
N708226 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL27: STOPRE
N708227 SETAL(61019,"(S_ZA)")
RET
_FEHL28: STOPRE
N708228 SETAL(61019,"(S_ZD)")
RET
_FEHL29: STOPRE
N708229 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N708230 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N708231 SETAL(61000)
RET
_FEHL32: STOPRE
N708232 SETAL(61019,"(_VARI: dec4)")
RET
_FEHL33: STOPRE
N708233 SETAL(61019,"(_VARI: dec5)")
RET
_FEHL34: STOPRE
N708234 SETAL(61216)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE83_SPF
PROC CYCLE83(REAL RTP,REAL RFP,REAL SDIS,REAL _DP,REAL _DPR,REAL _FDEP,REAL _FDPR,REAL _DAM,REAL _DTB,REAL _DTS,REAL FRF,INT VARI,INT _AXN,REAL _MDEP,REAL _VRT,REAL __DTD,REAL _DIS1,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Deep Hole Drilling
DEF AXIS _Z
DEF REAL HH1,HH2,HH3,HH4,HH5,HH8,_HH9,VHA,_HMF,HZ,_FAK1=1,_HHA,DAM,_FAK3,DP,DPR,S_SPITZE
DEF REAL DTB,DTS,_DTD,FDEP,FDPR
DEF INT HH6,HH7,_II,_PM1=-1
DEF INT _ABS,_ORD,_APP
DEF BOOL _MDG
DEF INT _ARTIS[16],_TEMP,_DMODE1,_DMODE5,_TYP,_VARI1,_AMODE1,_AMODE2,_AMODE3,_AMODE4,_AMODE5,_AMODE6,_AMODE7
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE83_MPF",_PROG,_SERR
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE83_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE83("<<RTP<<","<<RFP<<","<<SDIS<<","<<_DP<<","<<_DPR<<","<<FDEP<<","<<FDPR<<","<<_DAM<<","<<_DTB<<","<<_DTS<<","<<FRF<<","<<VARI<<","<<_AXN<<","<<_MDEP<<","<<_VRT<<","<<__DTD<<","<<_DIS1<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
FDEP=_FDEP FDPR=_FDPR
IF (_DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
IF($P_GG[13]<3)
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ENDIF
_DMODE1=_DMODE _DEC1
_DMODE5=_DMODE _DEC5
_AMODE1=_AMODE _DEC1 _AMODE2=_AMODE _DEC2 _AMODE3=_AMODE _DEC3 _AMODE4=_AMODE _DEC4 _AMODE5=_AMODE _DEC5 _AMODE6=_AMODE _DEC6 _AMODE7=_AMODE _DEC7
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL39
ENDIF
IF (_DMODE5==1)
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "E_DR_PEC")AND(_PROG <> "F_DR_PEC")AND(_PROG <> "F_DRILL") )
SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
FRF=$SCS_EASY_DRILL_DEEP_FD1
_DAM=$SCS_EASY_DRILL_DEEP_DF
_MDEP=($SCS_EASY_DRILL_DEEP_V1)*_FAK1
_VRT=($SCS_EASY_DRILL_DEEP_V2)*_FAK1
DTB=$SCS_EASY_DWELL_TIME
_DTD=$SCS_EASY_DWELL_TIME
DTS=$SCS_EASY_DWELL_TIME
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
_GMODE=0
_AMODE6=2
_AMODE7=1
ENDIF
DAM=_DAM
DP=_DP DPR=_DPR
DTB=_DTB DTS=_DTS _DTD=__DTD
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(_AMODE5<0)OR(_AMODE5>2) GOTOF _FEHL28
IF((_AMODE5==2) AND ($P_SUBPAR[6]==0)) GOTOF _FEHL31
IF((_AMODE5==1) AND ($P_SUBPAR[7]==0)) GOTOF _FEHL32
IF(_AMODE6<0)OR(_AMODE6>2) GOTOF _FEHL34
IF(_DTD==0)
_DTD=DTB
_AMODE4=_AMODE2
ENDIF
IF(_AMODE2<0)OR(_AMODE2>2) GOTOF _FEHL25
IF ((_AMODE2==2)AND(DTB>0))
DTB=-DTB
ENDIF
IF ((_AMODE2==1)AND(DTB<0))
DTB=ABS(DTB)
ENDIF
IF(_AMODE4<0)OR(_AMODE4>2) GOTOF _FEHL27
IF ((_AMODE4==2)AND(_DTD>0))
_DTD=-_DTD
ENDIF
IF ((_AMODE4==1)AND(_DTD<0))
_DTD=ABS(_DTD)
ENDIF
IF(_AMODE3<0)OR(_AMODE3>2) GOTOF _FEHL26
IF ((_AMODE3==2)AND(DTS>0))
DTS=-DTS
ENDIF
IF ((_AMODE3==1)AND(DTS<0))
DTS=ABS(DTS)
ENDIF
IF(_AMODE7<0)OR(_AMODE7>2) GOTOF _FEHL36
_VARI1 = VARI _DEC1 ;_VARI2 = VARI _DEC2
IF (_VARI1<0) OR (_VARI1>2) GOTOF _FEHL33
IF(_VARI1==1)
IF(_AMODE7==1)
_DIS1=0
ENDIF
IF(_AMODE7==2) AND ((_DIS1==0) OR ($P_SUBPAR[17]==0)) GOTOF _FEHL37
ENDIF
IF (_AMODE6==2)
IF DAM==100
DAM=0
ELSE
DAM=-(ABS(DAM))/100
ENDIF
ENDIF
IF (_AMODE6==1)
DAM=ABS(DAM)
ENDIF
IF DAM<-1 GOTOF _FEHL4
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE37") OR (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE38")
_ARTIS[0]=0
GOTOF _END_ARTIS_STAT
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL5
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL5
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL5
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_END_ARTIS_STAT:
HH2=FDEP HH4=$P_F HH6=0 HZ=1
CASE _AXN OF 1 GOTOF _AX1 2 GOTOF _AX2 DEFAULT GOTOF _AX3
_AX1:
IF ISAXIS(_ABS)
_Z=$P_AXN1
GOTOF _AX
ELSE
GOTOF _FEHL3
ENDIF
_AX2:
IF ISAXIS(_ORD)
_Z=$P_AXN2
GOTOF _AX
ELSE
GOTOF _FEHL3
ENDIF
_AX3:
IF ISAXIS(_APP)
_Z=$P_AXN3
ELSE
GOTOF _FEHL3
ENDIF
_AX:
FRF=ABS(FRF) FDPR=ABS(FDPR) DPR=ABS(DPR) SDIS=ABS(SDIS)
_HMF=$P_ACTFRAME[_Z,SC]
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560)) GOTOF _FEHL6
ELSE
GOTOF _FEHL38
ENDIF
IF ((_GMODE _DEC2)==1)
IF ((DP<>0) AND (DPR==0))
_HHA=DP
ENDIF
IF ((DP==0) AND (DPR<>0))
_HHA=DPR _PM1=1
ENDIF
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL7
IF(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
IF ($P_ADT[24]>0)AND($P_ADT[24]<180)
_HHA=_HHA+$P_TOOLR*_FAK1/TAN($P_ADT[24]/2)*(_PM1)
S_SPITZE=$P_TOOLR*_FAK1/TAN($P_ADT[24]/2)
ENDIF
IF ((DP<>0) AND (DPR==0))
DP=_HHA
ENDIF
IF ((DP==0) AND (DPR<>0))
DPR=_HHA
ENDIF
ENDIF
ENDIF
ENDIF
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MA1
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF(DP==0)GOTOF _MA0
IF(DP==HH2)GOTOF _MA1
_MA0:DP=HH2
_MA1:IF(RFP==DP)GOTOF _FEHL30
HH1=(RFP-DP)/ABS(RFP-DP)
IF NOT (RTP==RFP)
IF ((RTP-RFP)/ABS(RTP-RFP) <> HH1)
GOTOF _FEHL1
ENDIF
ENDIF
IF (_AMODE _DEC8==0)
IF(FRF<=1)AND(FRF>0.001)
GOTOF _MA3
ENDIF
IF(FRF<0.001)
GOTOF _MA2
ENDIF
FRF=1
GOTOF _MA3
_MA2:FRF=0.001
_MA3:HH3=FRF
ELSE
IF (FRF>999.999)
FRF=999.999
ENDIF
IF (FRF<0.001)
FRF=0.001
ENDIF
HH3=FRF/100
ENDIF
IF(((FDPR==0)AND(_AMODE5==0))OR(_AMODE5==2)) GOTOF _MA4A
HH2=RFP-HH1*FDPR
IF(FDEP==0)GOTOF _MA4
IF(FDEP==HH2)GOTOF _MA4A
_MA4:FDEP=HH2
_MA4A:FDPR=ABS(RFP-FDEP)
IF(FDPR==0)GOTOF _MM4B
HH2=(RFP-FDEP)/FDPR
IF(HH2<>HH1)GOTOF _FEHL2
_MM4B:HH2=FDEP
IF((HH2-DP)*HH1<0)
HH2=DP
FDEP=DP
FDPR=ABS(RFP-DP)
ENDIF
_HH9=FDPR
IF(_VARI1==0)
IF(_VRT<0)
_VRT=HZ/_FAK3
ENDIF
ENDIF
IF (_VARI1==2)
DTB=-1
ENDIF
FDEP=RFP*_HMF-FDPR*HH1 HH2=FDEP
HH7=1
_MA5:
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
N1 G0 G90 AX[_Z]=RFP+SDIS*HH1/_HMF
SBLOF
HH8=FDPR
_MA5A:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
IF (((_ARTISUP==0)AND(_ARTIS[15]==0)) OR ((_ARTISUP==1)AND(_ARTIS[15]==1)))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
ENDIF
N2 G90 G1 F=HH3*HH4 AX[_Z]=HH2/_HMF
HH3=1
IF(HH2<>DP*_HMF)
IF ( (_VARI1==0)AND(_VRT==0)AND(_DTB==0) )
N5 G4 S=1
GOTOF _NACH_G4
ENDIF
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF(((DTB>=0)AND(_AMODE2==0))OR(_AMODE2==1))
N5 G4 F=DTB
ELSE
N5 G4 S=-DTB
ENDIF
_NACH_G4_DTB:
ELSE
IF ABS(_DTD)<0.0001 gotof _NACH_G4_DTD
IF(((_DTD>=0)AND(_AMODE4==0))OR(_AMODE4==1))
N5 G4 F=_DTD
ELSE
N5 G4 S=-_DTD
ENDIF
_NACH_G4_DTD:
ENDIF
_NACH_G4:
IF(HH2==DP*_HMF)GOTOF _MA8
IF((DAM==0) OR (DAM==-1))
DAM=-1
_MDEP=FDPR
ENDIF
IF(DAM>0)GOTOF _MMD
HH8=-HH8*DAM
IF(HH8>=_MDEP)GOTOF _MMD1
HH8=_MDEP
_MMD1:
HH5=HH2-HH1*HH8
IF((HH5-DP*_HMF)*HH1>0)GOTOF _MMD2
HH5=DP*_HMF
GOTOF _MA6
_MMD2:
IF((HH5-DP*_HMF)*HH1>=_MDEP)GOTOF _MA6
HH5=HH2-(HH2-DP*_HMF)/2
GOTOF _MA6
_MMD:
_HH9=_HH9-DAM
IF(_HH9<DAM)
_HH9=DAM
ENDIF
IF(ABS(HH2-DP*_HMF)-_HH9>=DAM)
IF(ABS(HH2-DP*_HMF)>2*DAM)
HH5=HH2-_HH9*HH1
ELSE
IF(ABS(HH2-DP*_HMF)>DAM)
HH5=HH2-ABS(HH2-DP*_HMF)/2*HH1
ELSE
HH5=DP*_HMF
ENDIF
ENDIF
ELSE
IF(ABS(HH2-DP*_HMF)>_HH9)
IF(ABS(HH2-DP*_HMF)>2*DAM)
HH5=DP*_HMF+DAM*HH1
ELSE
HH5=HH2-ABS(HH2-DP*_HMF)/2*HH1
ENDIF
ELSE
HH5=DP*_HMF
ENDIF
ENDIF
_MA6:
IF ((_ARTIS[11]==3) OR ((_ARTISUP==1)AND(_ARTIS[15]==1)))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF(_VARI1<>1)GOTOF _MA_SPB
SBLON
N4 G90 G0 AX[_Z]=RFP+SDIS*HH1/_HMF
SBLOF
IF ABS(DTS)<0.0001 gotof _NACH_G4_DTS
IF(((DTS>=0)AND(_AMODE3==0))OR(_AMODE3==1))
N5 G4 F=DTS
ELSE
N5 G4 S=-DTS
ENDIF
_NACH_G4_DTS:
IF(ABS(RFP*_HMF-HH2)*_FAK3<=30)
VHA=0.6
ELSE
VHA=ABS(RFP*_HMF-HH2)*_FAK3/50
IF(VHA>7)
VHA=7
ENDIF
ENDIF
VHA=VHA/_FAK3
IF (_DIS1>0)
VHA=_DIS1
ENDIF
N6 G90 AX[_Z]=HH2/_HMF+VHA*HH1/_HMF
GOTOF _MA7
_MA_SPB:
IF(_VARI1==0)
IF (_VRT>0)
N7 G0 G91 AX[_Z]=HH1*_VRT/_HMF
ELSE
IF (_VRT<0)
N7 G0 G91 AX[_Z]=HH1*HZ/_FAK3/_HMF
ENDIF
ENDIF
ENDIF
N70 G1
_MA7:HH2=HH5
GOTOB _MA5A
_MA8:
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
SBLON
N8 G0 G90 AX[_Z]=RTP
SBLOF
N80 F=HH4
_MAE:
IF ((_SC_TOOL_VALI[0]<>0) AND (_ARTIS[15]==1))
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1: STOPRE
N708301 SETAL(61101)
RET
_FEHL2: STOPRE
N708302 SETAL(61107)
RET
_FEHL3: STOPRE
N708303 SETAL(61803)
RET
_FEHL4: STOPRE
N708304 SETAL(61019,"(_DAM)")
RET
_FEHL5: STOPRE
N708305 SETAL(62106)
RET
_FEHL6: STOPRE
N708306 SETAL(61212)
RET
_FEHL7: STOPRE
N708307 SETAL(61070)
RET
_FEHL18: STOPRE
N708318 SETAL(61019,_SERR)
RET
_FEHL22: STOPRE
N708322 SETAL(61158)
RET
_FEHL23: STOPRE
N708323 SETAL(61159)
RET
_FEHL24: STOPRE
N708324 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N708325 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL26: STOPRE
N708326 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL27: STOPRE
N708327 SETAL(61019,"(_AMODE: dec4)")
RET
_FEHL28: STOPRE
N708328 SETAL(61019,"(_AMODE: dec5)")
RET
_FEHL29: STOPRE
N708329 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N708330 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N708331 SETAL(61019,"(_AMODE: dec5/FDEP)")
RET
_FEHL32: STOPRE
N708332 SETAL(61019,"(_AMODE: dec5/FDPR)")
RET
_FEHL33: STOPRE
N708333 SETAL(61019,"(VARI: dec1)")
RET
_FEHL34: STOPRE
N708334 SETAL(61019,"(_AMODE: dec6)")
RET
_FEHL36: STOPRE
N708336 SETAL(61019,"(_AMODE: dec7)")
RET
_FEHL37: STOPRE
N708337 SETAL(61019,"(_AMODE: dec7/_DIS1)")
RET
_FEHL38: STOPRE
N708338 SETAL(61000)
RET
_FEHL39: STOPRE
N708339 SETAL(61019,"(_DMODE: dec5)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE832_SPF
PROC CYCLE832(REAL S_TOL,INT S_TOLM,REAL S_OTOL) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.003 ;DATE: 2024-02-28
;Cycle support HMIsl
;High Speed Settings
DEF INT _G17_18_19,_GG,_FFW,_NV_ACT,_OPC,_NCV,_IS_CTOL,_OPT,_TRAFO[2],_TRAFO_DYN[2],_II,_JJ,_MM,_NN,_OO,_NT1,_NK1,_TOLME,_IS_C800,_PST,_PST1,_TEMP,_OP_TS,_LOG_ON,_LOGSIZE,_LOG
DEF REAL _FACTOR,_FGREF,_TOLL,_TOLR,_FAK1,_FAK2,_FAK3,_V832
DEF AXIS _XX,_YY,_ZZ,_RAX1,_RAX2,_RAX3,_RAX
DEF STRING[40] _SERR,_PHILST,_TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE832_MPF",_LOG_FILE
DEF STRING[200] _STR
DEF STRING[5] _SRAX[6,2]
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE832_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,_LOGSIZE)
IF(_LOGSIZE>20000)
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,"*****************************")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"CYCLE832("<<S_TOL<<","<<S_TOLM<<","<<S_OTOL<<")")
_STR="Aufruf aus "
FOR _II=0 TO $P_STACK-1
_STR=_STR<<$P_PROG_NAME[_II]<<" -> "
ENDFOR
WRITE(_LOG,_LOG_FILE,_STR<<"CYCLE832")
ENDIF
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE832_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE832("<<S_TOL<<","<<S_TOLM<<","<<S_OTOL<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_OPC=$ON_IPO_FUNCTION_MASK
_OPT=$ON_TRAFO_TYPE_MASK B_AND 'B1'
_NCV=$AN_NCK_VERSION
_G17_18_19=$P_GG[6]
_FFW=$P_GG[24]
_NV_ACT=$P_GG[8]
_IS_CTOL=ISVAR("$P_CTOL")
IF NOT ISAXIS(1) GOTOF _ERR1
IF (ISAXIS(1))AND(ISAXIS(2))AND(ISAXIS(3))
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
ELSE
_G17_18_19=$P_GG[6]
IF ((_G17_18_19==1) AND ISAXIS(1) AND ISAXIS(2)) GOTOF _GEO_NKPL
IF ((_G17_18_19==2) AND ISAXIS(1) AND ISAXIS(3)) GOTOF _GEO_NKPL
IF ((_G17_18_19==3) AND ISAXIS(2) AND ISAXIS(3)) GOTOF _GEO_NKPL
GOTOF _ERR1
_GEO_NKPL: _XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN1
ENDIF
_RAX1=_XX _RAX2=_XX _RAX3=_XX
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
S_TOLM=ABS(S_TOLM) S_OTOL=S_OTOL MOD 360 _V832=ROUND(S_OTOL*1000)/1000
_TOLME=S_TOLM _DEC1
IF (S_TOLM==10)
S_TOLM=0
ENDIF
_OP_TS=0
IF (($ON_TECHNO_FUNCTION_MASK_1 B_AND 'H200')AND($ON_TECHNO_FUNCTION_MASK_1 B_AND 'H20000')AND(ISVAR("COMPSURF")))
_OP_TS=1
ENDIF
IF (_V832)
_SERR=<<"S_TOLM dec1"
IF (_TOLME>6) GOTOF _ERR6
_SERR=<<"S_TOLM dec2"
IF (S_TOLM _DEC2)>1 GOTOF _ERR6
IF (((S_TOLM _DEC2)>0) AND (_TOLME>4)) GOTOF _ERR6
IF (_NCV < 750200) GOTOF _ERR0
ENDIF
IF (_OP_TS==1)
_SERR=<<"S_TOLM dec7"
IF (_V832 AND ((S_TOLM _DEC7)>2)) GOTOF _ERR6
ELSE
_SERR=<<"S_TOLM dec1"
IF _TOLME==4 GOTOF _ERR6
ENDIF
IF ((S_TOLM _DEC2)==1)
IF (S_OTOL <= 0) GOTOF _ERR8
_V832=1
ELSE
IF ((_TOLME>0) AND (_V832<>1) AND $P_SUBPAR[3]) GOTOF _ERR5
ENDIF
_SERR=<<"S_OTOL = "<<S_OTOL
IF (((S_TOLM _DEC2)==1) AND (S_OTOL==0)) GOTOF _ERR6
IF NOT ($SCS_FUNCTION_MASK_MILL_TOL_SET B_AND 'H20')
IF ((S_TOLM _DEC2 == 1) AND ($P_TRAFO_PARSET == 0))
_SERR =<<"TRAORI before CYCLE832"
GOTOF _ERR9
ENDIF
ENDIF
_FACTOR=10
IF _V832
_FGREF=(360/(2*$PI))*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832(14,"<<_FACTOR<<","<<_FGREF<<")   ; INIT")
ENDIF
N83201 CUST_832(14,_FACTOR,_FGREF)
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832(4,"<<_FACTOR<<","<<_FGREF<<")   ; INIT")
ENDIF
N83202 CUST_832(4,_FACTOR,_FGREF)
ENDIF
IF _FACTOR <=0
_FACTOR=10
ENDIF
IF ((ISVAR("$SCS_MILL_TOL_VALUE_FINISH")) AND (S_TOL==0))
IF (_TOLME==1)
S_TOL=$SCS_MILL_TOL_VALUE_FINISH
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," S_TOL="<<S_TOL<<" ;=$SCS_MILL_TOL_VALUE_FINISH ")
ENDIF
ENDIF
IF (_TOLME==2)
S_TOL=$SCS_MILL_TOL_VALUE_SEMIFIN
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," S_TOL="<<S_TOL<<" ;=$SCS_MILL_TOL_VALUE_SEMIFIN ")
ENDIF
ENDIF
IF (_TOLME==3)
S_TOL=$SCS_MILL_TOL_VALUE_ROUGH
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," S_TOL="<<S_TOL<<" ;=$SCS_MILL_TOL_VALUE_ROUGH ")
ENDIF
ENDIF
IF (_TOLME==4)
S_TOL=$SCS_MILL_TOL_VALUE_PRECISION
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," S_TOL="<<S_TOL<<" ;=$SCS_MILL_TOL_VALUE_PRECISION ")
ENDIF
ENDIF
IF (_TOLME==5)
S_TOL=$SCS_STD_TOL_ROUGH
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," S_TOL="<<S_TOL<<" ;=$SCS_STD_TOL_ROUGH ")
ENDIF
ENDIF
IF (_TOLME==6)
S_TOL=$SCS_STD_TOL_FINISH
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," S_TOL="<<S_TOL<<" ;=$SCS_STD_TOL_FINISH ")
ENDIF
ENDIF
ENDIF
_TOLL=ABS(S_TOL)
IF ((_TOLME==0) AND ($P_SUBPAR[2]) AND (_TOLL<>0)) GOTOF _ERR7
_FAK1=1
_FAK2=1
_TOLR=_TOLL
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=$MN_SCALING_VALUE_INCH
IF NOT(_IS_CTOL)
_TOLL=_TOLL*$MN_SCALING_VALUE_INCH
_TOLR=_TOLL
ELSE
_TOLR=_TOLL*$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
_TOLR=_TOLL*$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK2=1/$MN_SCALING_VALUE_INCH
_FAK1=1/$MN_SCALING_VALUE_INCH
IF NOT(_IS_CTOL)
_TOLL=_TOLL/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF($P_GG[13]==1) OR ($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
_TOLR=_TOLL*$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF NOT(_IS_CTOL)
IF _TOLL<=0
_TOLL=(1/$MN_INT_INCR_PER_MM)
ENDIF
IF _TOLR<=0
_TOLR=(1/$MN_INT_INCR_PER_DEG)
ENDIF
ENDIF
IF _V832
IF ISVAR("$SCS_MILL_TOL_FACTOR_FINISH")
CASE _TOLME OF 0 GOTOF _FA_0 1 GOTOF _FA_1 2 GOTOF _FA_2 3 GOTOF _FA_3 4 GOTOF _FA_4 DEFAULT GOTOF _FAE
_FA_0: REPEAT _NOA _NOE
GOTOF _FAE
_FA_1: _FACTOR=$SCS_MILL_TOL_FACTOR_FINISH
GOTOF _FAE
_FA_2: _FACTOR=$SCS_MILL_TOL_FACTOR_SEMIFIN
GOTOF _FAE
_FA_3: _FACTOR=$SCS_MILL_TOL_FACTOR_ROUGH
GOTOF _FAE
_FA_4: _FACTOR=$SCS_MILL_TOL_FACTOR_PRECISION
_FAE:
IF _TOLME>4
_FACTOR=$SCS_STD_TOL_FACTOR
ENDIF
ENDIF
ELSE
IF ((_TOLME==0)AND($P_SUBPAR[2])) OR ($P_SUBPAR[1]==0)
REPEAT _NOA _NOE
ENDIF
ENDIF
_PST1 = 1
_NN = 1
FOR _II=1 TO 2
FOR _PST=_PST1 TO 20
_PHILST=<<"$MC_TRAFO_TYPE_"<<_PST
IF(ISVAR(_PHILST))
EXECSTRING("IF(("<<_PHILST<<">0) AND ("<<_PHILST<<"<256)) GOTOF _MYVAR2")
ENDIF
ENDFOR
GOTOF _TRAX2
_MYVAR2:
IF _TRAFO[0]==1
_TRAFO[1]=1
ENDIF
_TRAFO[0]=1
FOR _JJ=0 TO 2
EXECSTRING("IF $MC_TRAFO_AXES_IN_"<<_PST<<"["<<(_JJ+3)<<"]==0 GOTOF _TRAX1")
EXECSTRING("_RAX=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[$MC_TRAFO_AXES_IN_"<<_PST<<"["<<(_JJ+3)<<"]-1])")
IF $MA_IS_ROT_AX[_RAX]==0
EXECSTRING("_RAX"<<(_JJ+1)<<"=_XX")
ELSE
EXECSTRING("_RAX"<<(_JJ+1)<<"=_RAX")
ENDIF
IF _II==1
_SRAX[_JJ,0] = AXSTRING(_RAX)
ELSE
_SRAX[_JJ,1] = AXSTRING(_RAX)
ENDIF
_TRAX1:
ENDFOR
_TRAX1:
IF ($P_TRAFO_PARSET == 0)
REPEAT _FGREF_A _FGREF_E
ENDIF
_TRAX2:
IF ISVAR("$MN_MM_MAXNUM_KIN_CHAIN_ELEM")
IF ISVAR("$MN_MM_NUM_KIN_TRAFOS")
IF (($MN_MM_MAXNUM_KIN_CHAIN_ELEM >0) AND ($MN_MM_NUM_KIN_TRAFOS > 0))
FOR _NT1=_NN TO $MN_MM_NUM_KIN_TRAFOS
IF ($NT_NAME[_NT1] <> "")
IF ($NT_TRAFO_TYPE[_NT1]=="TRAORI_DYN") AND ((TRUNC($NT_TRAFO_INDEX[_NT1]/1000) MOD 100 == $P_CHANNO) OR (TRUNC($NT_TRAFO_INDEX[_NT1]/1000) MOD 100 == 0) OR (TRUNC($NT_TRAFO_INDEX[_NT1]/1000) MOD 100 == 99))
_NK1=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_NT1,0],TRUE)
IF _NK1>0
_RAX1=AXNAME($NK_AXIS[_NK1])
ENDIF
_NK1=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_NT1,1],TRUE)
IF _NK1>0
IF ($NK_NAME[_NK1]<>"")
_RAX2=AXNAME($NK_AXIS[_NK1])
ENDIF
ENDIF
IF _TRAFO_DYN[0]<>0
_TRAFO_DYN[1]=$NT_TRAFO_INDEX[_NT1] _DEC1
ENDIF
_TRAFO_DYN[0]=$NT_TRAFO_INDEX[_NT1] _DEC1
GOTOF _END_TRAORI_DYN
ENDIF
ENDIF
ENDFOR
_END_TRAORI_DYN:
FOR _JJ=0 TO 30
FOR _OO=1 TO 2
EXECSTRING("_RAX=_RAX"<<_OO)
IF(AXSTRING(_RAX) == $MN_AXCONF_MACHAX_NAME_TAB[_JJ])
FOR _MM=0 TO S_AXES_PER_CHAN-1
IF($MC_AXCONF_MACHAX_USED[_MM] == _JJ+1)
_RAX = AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_MM])
IF _II==1
_SRAX[2+_OO,0] = AXSTRING(_RAX)
ELSE
_SRAX[2+_OO,1] = AXSTRING(_RAX)
ENDIF
ENDIF
ENDFOR
EXECSTRING("_RAX"<<_OO<<"=_RAX")
ENDIF
ENDFOR
ENDFOR
IF ($P_TRAFO_PARSET == 0)
REPEAT _FGREF_A _FGREF_E
ENDIF
ENDIF
ENDIF
ENDIF
_PST1=_PST + 1
_NN = _NT1 + 1
ENDFOR
FOR _II=0 TO 5
FOR _JJ=0 TO 1
IF(_SRAX[_II,_JJ] == "")
_SRAX[_II,_JJ] = AXSTRING(_XX)
ENDIF
ENDFOR
ENDFOR
IF(($P_TRAFO_PARSET > 0) AND ($P_TRAFO_PARSET _DEC4 == 0))
_NN=$P_TRAFO_PARSET _DEC4
IF($P_TRAFO_PARSET _DEC1 == 1)
_RAX1 = AXNAME(_SRAX[3*_NN,0])
_RAX2 = AXNAME(_SRAX[(3*_NN)+1,0])
_RAX3 = AXNAME(_SRAX[(3*_NN)+2,0])
ELSE
_RAX1 = AXNAME(_SRAX[3*_NN,1])
_RAX2 = AXNAME(_SRAX[(3*_NN)+1,1])
_RAX3 = AXNAME(_SRAX[(3*_NN)+2,1])
ENDIF
REPEAT _FGREF_A _FGREF_E
ENDIF
IF (($P_TRAFO_PARSET==0) AND ($P_TC==0) AND (_V832==1))
IF (AXSTRING(_RAX1)<>AXSTRING(_XX))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"RELEASE("<<AXSTRING(_RAX1)<<")")
ENDIF
RELEASE(_RAX1)
ENDIF
IF (AXSTRING(_RAX2)<>AXSTRING(_XX))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"RELEASE("<<AXSTRING(_RAX2)<<")")
ENDIF
RELEASE(_RAX2)
ENDIF
IF (AXSTRING(_RAX3)<>AXSTRING(_XX))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"RELEASE("<<AXSTRING(_RAX3)<<")")
ENDIF
RELEASE(_RAX3)
ENDIF
ENDIF
IF (S_TOLM==0) OR (_V832==1)
IF (NOT $P_ISTEST)OR($MN_SIM_ENVIRONMENT==5)
REPEAT _R1A _R1E
ENDIF
GOTOF _END
ENDIF
IF ISVAR("$SCS_FUNCTION_MASK_MILL_TOL_SET")
IF ((($SCS_FUNCTION_MASK_MILL_TOL_SET B_AND 'H1')==0) AND (_TOLME>0) AND ($P_SUBPAR[3]==0)) GOTOF _ERR6
ENDIF
_IS_C800=(ISFILE("/_N_CST_DIR/_N_CYCLE800_SPF"))OR(ISFILE("/_N_CUS_DIR/_N_CYCLE800_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CYCLE800_SPF"))
CASE (S_TOLM _DEC3) OF 1 GOTOF _MT1 2 GOTOF _MT2 DEFAULT GOTOF _MT
_MT1:
IF (((_TRAFO[0]<>0)OR(_TRAFO_DYN[0]==1)OR(_TRAFO_DYN[1]==1)) AND _OPT)
IF $P_TC AND _IS_C800
TCARR=0
PAROTOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR=0")
WRITE(_LOG,_LOG_FILE,"PAROTOF")
ENDIF
ENDIF
UPATH
TRAORI(1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"UPATH ")
WRITE(_LOG,_LOG_FILE,"TRAORI(1)")
ENDIF
ELSE
GOTOF _ERR1
ENDIF
GOTOF _ME
_MT2:
IF (((_TRAFO[1]<>0)OR(_TRAFO_DYN[0]==2)OR(_TRAFO_DYN[1]==2)) AND _OPT)
UPATH
IF $P_TC AND _IS_C800
TCARR=0
PAROTOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCARR=0")
WRITE(_LOG,_LOG_FILE,"PAROTOF")
ENDIF
ENDIF
TRAORI(2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAORI(2)")
ENDIF
ELSE
GOTOF _ERR2
ENDIF
GOTOF _ME
_MT:
IF NOT( $P_TRAFO B_AND 'H300')
TRAFOOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAFOOF")
ENDIF
ENDIF
_ME: G[8]=_NV_ACT
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[8]="<<_NV_ACT)
ENDIF
IF (_OPC B_AND 'H4')OR(_OPC B_AND 'H100')
IF (((S_TOLM _DEC6) == 0) OR ((S_TOLM _DEC1)==5) OR ((S_TOLM _DEC1)==6))
COMPOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"COMPOF")
ENDIF
ELSE
IF (S_TOLM _DEC6) == 1
COMPCAD
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"COMPCAD")
ENDIF
ENDIF
IF (S_TOLM _DEC6) == 2
COMPCURV
IF NOT(_IS_CTOL)
IF (_NCV >= 480000)
$SC_COMPRESS_CONTUR_TOL=_TOLL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_COMPRESS_CONTUR_TOL="<<_TOLL<<"   ; only if $MC_COMPRESSOR_MODE <> 0")
ENDIF
IF _OPT
$SC_COMPRESS_ORI_TOL=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_COMPRESS_ORI_TOL="<<_TOLR*_FACTOR<<"   ; COMPCURV")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF (S_TOLM _DEC6)>0 GOTOF _ERR3
ENDIF
IF (S_TOLM _DEC6)==3
IF (_OPC B_AND 'B10')
IF (_OPC B_AND 'H4')OR(_OPC B_AND 'H100')
COMPOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"COMPOF")
ENDIF
ENDIF
BSPLINE
ELSE
GOTOF _ERR4
ENDIF
ENDIF
CASE (S_TOLM _DEC5) OF 0 GOTOF _MV0 1 GOTOF _MV1 2 GOTOF _MV2 DEFAULT GOTOF _MV0
_MV0:
SOFT
FFWOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"SOFT")
WRITE(_LOG,_LOG_FILE,"FFWOF")
ENDIF
GOTOF _MVE
_MV1:
SOFT
FFWON
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"SOFT")
WRITE(_LOG,_LOG_FILE,"FFWON")
ENDIF
GOTOF _MVE
_MV2:
BRISK
FFWOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"BRISK")
WRITE(_LOG,_LOG_FILE,"FFWOF")
ENDIF
GOTOF _MVE
_MVE:
CASE (S_TOLM _DEC4) OF 0 GOTOF _MB0 1 GOTOF _MB1 2 GOTOF _MB2 3 GOTOF _MB3 DEFAULT GOTOF _MB0
_MB0: G64
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G64")
ENDIF
IF _FFW==1
;CPRECON
$SC_CONTPREC=_TOLL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_CONTPREC="<<_TOLL)
ENDIF
ELSE
;CPRECOF
ENDIF
GOTOF _MB_E
_MB1:
G601 G641 ADIS=_TOLL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G601 G641 ADIS="<<_TOLL)
ENDIF
IF NOT(_IS_CTOL)
IF _FFW==1
;CPRECON
$SC_CONTPREC=_TOLL*3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_CONTPREC="<<_TOLL*3)
ENDIF
ELSE
;CPRECOF
ENDIF
ENDIF
GOTOF _MB_E
_MB2:
G601 G642 CPRECOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G601 G642 CPRECOF")
ENDIF
IF NOT(_IS_CTOL)
$SC_SMOOTH_CONTUR_TOL=_TOLL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_SMOOTH_CONTUR_TOL="<<_TOLL)
ENDIF
IF _OPT
$SC_SMOOTH_ORI_TOL=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_SMOOTH_ORI_TOL="<<_TOLR*_FACTOR)
ENDIF
ENDIF
ENDIF
GOTOF _MB_E
_MB3:
G601 G643 CPRECOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G601 G643 CPRECOF")
ENDIF
GOTOF _MB_E
_MB_E: REPEAT _R1A _R1E
_END:
REPEAT _FLIM_ACTIVATE_A _FLIM_ACTIVATE_E
IF _V832
IF ISVAR("$SC_MIN_SURF_RADIUS")
IF ($SC_MIN_SURF_RADIUS[0]<>(1*_FAK2)) OR ($SC_MIN_SURF_RADIUS[1]<>(1*_FAK2))
$SC_MIN_SURF_RADIUS[0]=1*_FAK2 $SC_MIN_SURF_RADIUS[1]=1*_FAK2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_MIN_SURF_RADIUS[0]="<<(1*_FAK2)<<" $SC_MIN_SURF_RADIUS[1]="<<(1*_FAK2))
ENDIF
ENDIF
ENDIF
IF (_OP_TS==1)
IF (($SCS_FUNCTION_MASK_MILL_TOL_SET B_AND 'H4') AND ((S_TOLM _DEC7)==0))
IF ((S_TOLM _DEC2)==1)
N83204 CUST_832(20+_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<20+_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ELSE
IF (_TOLME==0)
REPEAT _FLIM_DEACTIVATE_A _FLIM_DEACTIVATE_E
ENDIF
N83204 CUST_832(10+_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<10+_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ENDIF
ELSE
IF (_TOLME>0)
IF ((S_TOLM _DEC7)==1)
IF (_TOLL*_FAK1 < $SC_SURF_PERF_ADJUST)
$SC_MIN_SURF_RADIUS[0] = MAXVAL(_TOLL/_FAK3* 100,0.01)*_FAK2 ;Begrenzung auf minimalwert, (aber > 0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$SC_MIN_SURF_RADIUS[0]="<<(MAXVAL(_TOLL/_FAK3* 100,0.01)*_FAK2))
ENDIF
ENDIF
ENDIF
IF ((S_TOLM _DEC2)==1)
N83204 CUST_832(40+_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<40+_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ELSE
N83204 CUST_832(30+_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<30+_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ENDIF
ELSE
REPEAT _FLIM_DEACTIVATE_A _FLIM_DEACTIVATE_E
N83204 CUST_832(0,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832(0,"<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ENDIF
ENDIF
ELSE
IF ((S_TOLM _DEC2)==1)
N83204 CUST_832(20+_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<20+_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ELSE
IF (_TOLME==0)
REPEAT _FLIM_DEACTIVATE_A _FLIM_DEACTIVATE_E
ENDIF
N83204 CUST_832(10+_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<10+_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ENDIF
ENDIF
ELSE
N83205 CUST_832(_TOLME,_FACTOR,_FGREF)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_832("<<_TOLME<<","<<_FACTOR<<","<<_FGREF<<")")
ENDIF
ENDIF
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE832_MPF")
WRITE(_TEMP,_TEMP_FILE,";G[01]="<<$P_GG[1]<<" ; 1=G0 2=G1 3=G2 4=G3 5=CIP")
WRITE(_TEMP,_TEMP_FILE,";G[04]="<<$P_GG[4]<<" ; 1=STARTFIFO 2=STOPFIFO 3=FIFOCTRL")
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<" ; 1=G17 2=G18 3=G19")
WRITE(_TEMP,_TEMP_FILE,";G[10]="<<$P_GG[10]<<" ; 1=G60 2=G64 3=G641 4=G642 5=G643 6=G644 7=G645")
WRITE(_TEMP,_TEMP_FILE,";G[12]="<<$P_GG[12]<<" ; 1=G601 2=G602 3=G603")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<" ; 1=G70 2=G71 3=G700 4=G710")
WRITE(_TEMP,_TEMP_FILE,";G[15]="<<$P_GG[15]<<" ; 1=G93 2=G94 3=G95 4=G96 5=G97 6=G931 7=G961 8=G971")
IF ($P_GG[15]<10)
WRITE(_TEMP,_TEMP_FILE,";        ; 9=G942 10=G952 11=G962 12=G972 13=G973")
ELSE
WRITE(_TEMP,_TEMP_FILE,";         ; 9=G942 10=G952 11=G962 12=G972 13=G973")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[21]="<<$P_GG[21]<<" ; 1=BRISK 2=SOFT 3=DRIVE")
WRITE(_TEMP,_TEMP_FILE,";G[24]="<<$P_GG[24]<<" ; 1=FFWOF 2=FFWON")
WRITE(_TEMP,_TEMP_FILE,";G[30]="<<$P_GG[30]<<" ; 1=COMPOF 2=COMPON 3=COMPCURV 4=COMPCAD 5=COMPSURF")
WRITE(_TEMP,_TEMP_FILE,";G[45]="<<$P_GG[45]<<" ; 1=SPATH 2=UPATH")
WRITE(_TEMP,_TEMP_FILE,";G[59]="<<$P_GG[59]<<" ; 1=DYNNORM 2=DYNPOS 3=DYNROUGH 4=DYNSEMIFIN 5=DYNFINISH 6=DYNPREC")
WRITE(_TEMP,_TEMP_FILE,";G[61]="<<$P_GG[61]<<" ; 1=ORISOF 2=ORISON")
WRITE(_TEMP,_TEMP_FILE,";$P_FGROUP_MASK="<<$P_FGROUP_MASK)
WRITE(_TEMP,_TEMP_FILE,";$P_TRAFO="<<$P_TRAFO)
WRITE(_TEMP,_TEMP_FILE,";$AA_ATOL["<<AXSTRING(_XX)<<"]="<<$AA_ATOL[_XX]<<" $P_CTOL="<<$P_CTOL<<" $AC_CTOL="<<$AC_CTOL)
IF AXSTRING(_RAX1)<>AXSTRING(_XX)
WRITE(_TEMP,_TEMP_FILE,";$P_OTOL="<<$P_OTOL<<" $AC_OTOL="<<$AC_OTOL<<" _FACTOR="<<_FACTOR)
WRITE(_TEMP,_TEMP_FILE,";$AA_ATOL["<<AXSTRING(_RAX1)<<"]="<<$AA_ATOL[_RAX1]<<" $AA_FGREF["<<AXSTRING(_RAX1)<<"]="<<$AA_FGREF[_RAX1])
ENDIF
IF AXSTRING(_RAX2)<>AXSTRING(_XX)
WRITE(_TEMP,_TEMP_FILE,";$AA_ATOL["<<AXSTRING(_RAX2)<<"]="<<$AA_ATOL[_RAX2]<<" $AA_FGREF["<<AXSTRING(_RAX2)<<"]="<<$AA_FGREF[_RAX2])
ENDIF
IF AXSTRING(_RAX3)<>AXSTRING(_XX)
WRITE(_TEMP,_TEMP_FILE,";$AA_ATOL["<<AXSTRING(_RAX3)<<"]="<<$AA_ATOL[_RAX3]<<" $AA_FGREF["<<AXSTRING(_RAX3)<<"]="<<$AA_FGREF[_RAX3])
ENDIF
ENDIF
RET
_R1A:
IF _IS_CTOL
IF _TOLL==0
CTOL=-1 OTOL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CTOL=-1 OTOL=-1 ")
ENDIF
GOTOF _R1E
ENDIF
IF (((_OP_TS==0)OR(($SCS_FUNCTION_MASK_MILL_TOL_SET B_AND 'H4')AND((S_TOLM _DEC7)==0)))AND((S_TOLM _DEC1)<5))
CTOL=_TOLL*SQRT(3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CTOL="<<_TOLL*SQRT(3))
ENDIF
ELSE
CTOL=_TOLL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CTOL="<<_TOLL )
ENDIF
ENDIF
IF ((S_TOLM _DEC2)==1)
_TOLR=S_OTOL _FACTOR=1
IF S_OTOL > 0
OTOL=S_OTOL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"OTOL="<<S_OTOL)
ENDIF
ELSE
OTOL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"OTOL=-1")
ENDIF
ENDIF
ELSE
IF (AXSTRING(_RAX1)<>AXSTRING(_XX))
IF _FACTOR>0
IF ((S_TOLM _DEC1)<5)
OTOL=_TOLR*_FACTOR*SQRT(2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"OTOL="<<_TOLR*_FACTOR*SQRT(2))
ENDIF
ELSE
OTOL=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"OTOL="<<_TOLR*_FACTOR)
ENDIF
ENDIF
ELSE
OTOL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"OTOL=-1")
ENDIF
ENDIF
ENDIF
ENDIF
IF (($P_TRAFO==0) AND (_FACTOR>0) AND (AXSTRING(_RAX1)<>AXSTRING(_XX)))
ATOL[_RAX1]=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," ATOL["<<AXSTRING(_RAX1)<<"]="<<_TOLR*_FACTOR)
ENDIF
IF (AXSTRING(_RAX2)<>AXSTRING(_XX))
ATOL[_RAX2]=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," ATOL["<<AXSTRING(_RAX2)<<"]="<<_TOLR*_FACTOR)
ENDIF
ENDIF
IF (AXSTRING(_RAX3)<>AXSTRING(_XX))
ATOL[_RAX3]=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," ATOL["<<AXSTRING(_RAX3)<<"]="<<_TOLR*_FACTOR)
ENDIF
ENDIF
ENDIF
ELSE
IF _TOLL==0 GOTOF _R1E
IF (NOT $P_ISTEST)OR($MN_SIM_ENVIRONMENT==5)
$MA_COMPRESS_POS_TOL[_XX]=_TOLL
$MA_COMPRESS_POS_TOL[_YY]=_TOLL
$MA_COMPRESS_POS_TOL[_ZZ]=_TOLL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$MA_COMPRESS_POS_TOL["<<AXSTRING(_XX)<<"]="<<_TOLL)
WRITE(_LOG,_LOG_FILE,"$MA_COMPRESS_POS_TOL["<<AXSTRING(_YY)<<"]="<<_TOLL)
WRITE(_LOG,_LOG_FILE,"$MA_COMPRESS_POS_TOL["<<AXSTRING(_ZZ)<<"]="<<_TOLL)
ENDIF
IF AXSTRING(_RAX1)<>AXSTRING(_XX)
$MA_COMPRESS_POS_TOL[_RAX1]=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$MA_COMPRESS_POS_TOL["<<AXSTRING(_RAX1)<<"]="<<_TOLL*_FACTOR)
ENDIF
ENDIF
IF AXSTRING(_RAX2)<>AXSTRING(_XX)
$MA_COMPRESS_POS_TOL[_RAX2]=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$MA_COMPRESS_POS_TOL["<<AXSTRING(_RAX2)<<"]="<<_TOLL*_FACTOR)
ENDIF
ENDIF
IF AXSTRING(_RAX3)<>AXSTRING(_XX)
$MA_COMPRESS_POS_TOL[_RAX3]=_TOLR*_FACTOR
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$MA_COMPRESS_POS_TOL["<<AXSTRING(_RAX3)<<"]="<<_TOLL*_FACTOR)
ENDIF
ENDIF
STOPRE
NEWCONF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"NEWCONF")
ENDIF
ENDIF
ENDIF
_R1E:
_NOA:
_GG=$MC_GCODE_RESET_VALUES[0]
G[1]=_GG
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[1]="<<$MC_GCODE_RESET_VALUES[0])
ENDIF
_GG=$MC_GCODE_RESET_VALUES[3]
IF _GG==1
STARTFIFO
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"STARTFIFO")
ENDIF
ELSE
IF _GG==2
STOPFIFO
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"STARTFIFO")
ENDIF
ELSE
FIFOCTRL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FIFOCTRL")
ENDIF
ENDIF
ENDIF
_GG=$MC_GCODE_RESET_VALUES[9]
G[10]=_GG
_GG=$MC_GCODE_RESET_VALUES[11]
G[12]=_GG
_GG=$MC_GCODE_RESET_VALUES[20]
G[21]=_GG
_GG=$MC_GCODE_RESET_VALUES[23]
G[24]=_GG
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[10]="<<$MC_GCODE_RESET_VALUES[9])
WRITE(_LOG,_LOG_FILE,"G[12]="<<$MC_GCODE_RESET_VALUES[11])
WRITE(_LOG,_LOG_FILE,"G[21]="<<$MC_GCODE_RESET_VALUES[20])
WRITE(_LOG,_LOG_FILE,"G[24]="<<$MC_GCODE_RESET_VALUES[23])
ENDIF
_GG=$MC_GCODE_RESET_VALUES[29]
IF((_OPC B_AND 'H4')OR(_OPC B_AND 'H100'))
G[30]=_GG
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[30]="<<$MC_GCODE_RESET_VALUES[29])
ENDIF
ENDIF
_GG=$MC_GCODE_RESET_VALUES[44]
G[45]=_GG
_GG=$MC_GCODE_RESET_VALUES[58]
G[59]=_GG
_GG=$MC_GCODE_RESET_VALUES[60]
G[61]=_GG
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G[45]="<<$MC_GCODE_RESET_VALUES[44])
WRITE(_LOG,_LOG_FILE,"G[59]="<<$MC_GCODE_RESET_VALUES[58])
WRITE(_LOG,_LOG_FILE,"G[61]="<<$MC_GCODE_RESET_VALUES[60])
ENDIF
_NOE:
_FLIM_ACTIVATE_A:
IF ($MCS_LIMIT_RES_PATH_SPEED>0)
FLIM=$MCS_LIMIT_RES_PATH_SPEED
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," FLIM="<<$MCS_LIMIT_RES_PATH_SPEED)
ENDIF
ENDIF
_FLIM_ACTIVATE_E:
_FLIM_DEACTIVATE_A:
FLIM=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE," FLIM=-1")
ENDIF
_FLIM_DEACTIVATE_E:
_FGREF_A:
IF ((_V832) AND (_FGREF>0))
IF (AXSTRING(_RAX1)<>AXSTRING(_XX))
IF (_TOLME==0)
FGREF[_RAX1]=(360/(2*$PI))*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FGREF["<<AXSTRING(_RAX1)<<"]="<<(360/(2*$PI))*_FAK3<<" ; RA1")
ENDIF
ELSE
FGREF[_RAX1]=_FGREF*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FGREF["<<AXSTRING(_RAX1)<<"]="<<_FGREF*_FAK3<<" ; RA1")
ENDIF
ENDIF
ENDIF
IF (AXSTRING(_RAX2)<>AXSTRING(_XX))
IF (_TOLME==0)
FGREF[_RAX2]=(360/(2*$PI))*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FGREF["<<AXSTRING(_RAX2)<<"]="<<(360/(2*$PI))*_FAK3<<" ; RA2")
ENDIF
ELSE
FGREF[_RAX2]=_FGREF*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FGREF["<<AXSTRING(_RAX2)<<"]="<<_FGREF*_FAK3<<" ; RA2")
ENDIF
ENDIF
ENDIF
IF (AXSTRING(_RAX3)<>AXSTRING(_XX))
IF (_TOLME==0)
FGREF[_RAX3]=(360/(2*$PI))*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FGREF["<<AXSTRING(_RAX3)<<"]="<<(360/(2*$PI))*_FAK3<<" ; RA3")
ENDIF
ELSE
FGREF[_RAX3]=_FGREF*_FAK3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"FGREF["<<AXSTRING(_RAX3)<<"]="<<_FGREF*_FAK3<<" ; RA3")
ENDIF
ENDIF
ENDIF
ENDIF
_FGREF_E:
_ERR0: STOPRE
N783200 SETAL(61018,<<_NCV)
RET
_ERR1: STOPRE
N783201 SETAL(61191)
RET
_ERR2: STOPRE
N783202 SETAL(61192)
RET
_ERR3: STOPRE
N783203 SETAL(61193)
RET
_ERR4: STOPRE
N783204 SETAL(61194)
RET
_ERR5: STOPRE
N783205 SETAL(61019,"S_OTOL="<<S_OTOL)
RET
_ERR6: STOPRE
N783206 SETAL(61019,_SERR<<" "<<S_TOLM)
RET
_ERR7: STOPRE
N783207 SETAL(61019,"S_TOL <>0: "<<S_TOL)
RET
_ERR8: STOPRE
N783208 SETAL(61022,"S_OTOL: "<<S_OTOL)
RET
_ERR9:
N783209 SETAL(61147,_SERR)

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE84_SPF
PROC CYCLE84(REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,INT SDAC,REAL MPIT,REAL PIT,REAL POSS,REAL SST,REAL SST1,INT _AXN,INT _PITA,INT _TECHNO,INT _VARI,REAL _DAM,REAL _VRT,STRING[15] _PITM,STRING[20] _PTAB,STRING[20] _PTABA,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.002 ;DATE: 2023-09-21
;Cycle support HMIsl
;Rigid tapping
DEF AXIS _Z,_MAX
DEF REAL PP,HH1,HH2,HH3,HH4,HH5,_HH9,HH11,VHA,HZ,_FAK1,_FAK3,_HMF,_EPS=0.001
DEF INT HH7,_TEC_0,_TEC_1,_TEC_2,_TEC_3,_TEC_4,_OLD12,_OLD21,_OLD24,SPINU,_ISO,_GG10,_GG12
DEF INT _ABS,_ORD,_APP,_H_MSNUM,_MA_NR_SP,_KA_NR_SP=-1,_TYP
DEF INT _II
DEF INT _ARTIS[16],_TEMP,_DMODE1,_DMODE3,_DMODE4,_DMODE5,_AMODE1,_AMODE4,_AMODE7,_TEMPA,__DMODE3
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE84_MPF",_ACHSE,_PROG,_SERR
DEF STRING[30] _S_KA_NR
DEF INT _GGC[64],_GRUPPE[10],_MD_31050[6],_MD_31060[6]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE84_MPF")
_TEMPA=1
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[7]="<<_ZSD[7])
WRITE(_TEMP,_TEMP_FILE,"CYCLE84("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<SDAC<<","<<MPIT<<","<<PIT<<","<<POSS<<","<<SST<<","<<SST1<<","<<_AXN<<","<<_PITA<<","<<_TECHNO<<","<<_VARI<<","<<_DAM<<","<<_VRT<<","<<_PITM<<","<<_PTAB<<","<<_PTABA<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF HH7>0 GOTOF _MA3
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_DMODE1=_DMODE _DEC1
_DMODE3=_DMODE _DEC3
_DMODE4=_DMODE _DEC4
_DMODE5=_DMODE _DEC5
_AMODE1=_AMODE _DEC1 _AMODE4=_AMODE _DEC4 _AMODE7=_AMODE _DEC7
IF (_DMODE5<0)OR(_DMODE5>1)
GOTOF _FEHL34
ENDIF
IF (_DMODE5==1)
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF ( (_PROG <> "E_DR_TAP")AND(_PROG <> "F_TAP") )
SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
DTB=$SCS_EASY_DWELL_TIME
IF $MCS_DISP_PLANE_MILL<>0
_DMODE1=($MCS_DISP_PLANE_MILL-16)
G[6]=_DMODE1
ELSE
_DMODE1=0
ENDIF
SDAC=5
POSS=0
IF ((_VARI _DEC1)==1)
_AMODE7=1
ENDIF
_PITM="" _PTAB="" _PTABA="" _GMODE=0
ENDIF
_H_MSNUM=$P_MSNUM
IF (($SCS_DRILL_TAPPING_SET_GG12[0]==$SCS_DRILL_TAPPING_SET_GG12[1]) AND ($SCS_DRILL_TAPPING_SET_GG21[0]==$SCS_DRILL_TAPPING_SET_GG21[1]) AND ($SCS_DRILL_TAPPING_SET_GG24[0]==$SCS_DRILL_TAPPING_SET_GG24[1]) AND ($SCS_DRILL_TAPPING_SET_MC[0]==$SCS_DRILL_TAPPING_SET_MC[1])) GOTOF _WEITER1
IF ($ON_NUM_CHANNELS<=1) GOTOF _WEITER1
IF ($P_NUM_SPINDLES==1) GOTOF _WEITER1
IF ($MCS_FUNCTION_MASK_DRILL B_AND 'B1') GOTOF _WEITER1
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,5)
IF ((_PROG <> "F_TAP")) GOTOF _WEITER1
IF (_KA_NR_SP==-1)
_H_MSNUM=$P_MSNUM
IF(_H_MSNUM)
IF($AA_TYP[SPI(_H_MSNUM)])
REPEAT
REPEAT
_KA_NR_SP=_KA_NR_SP+1
_S_KA_NR="$MC_AXCONF_MACHAX_USED["<<_KA_NR_SP<<"]"
IF ISVAR(_S_KA_NR)
_MA_NR_SP=$MC_AXCONF_MACHAX_USED[_KA_NR_SP]
ELSE
GOTOF _FEHL12
ENDIF
UNTIL(_MA_NR_SP>0)
_ACHSE="AX"<<_MA_NR_SP
_MAX=(AXNAME(_ACHSE))
UNTIL(_H_MSNUM==$MA_SPIND_ASSIGN_TO_MACHAX[_MAX])
ELSE
GOTOF _FEHL12
ENDIF
ELSE
GOTOF _FEHL12
ENDIF
ENDIF
_WEITER1:
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
IF(_DMODE4<0)OR(_DMODE4>1) GOTOF _FEHL32
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,8)
IF (( _PROG == "F_DR_TAP" ) OR (SUBSTR(_PROG,0,5)=="F_TAP"))
IF(_DMODE3<0)OR(_DMODE3>1)
GOTOF _FEHL33
ENDIF
__DMODE3=ABS((_DMODE3)-1)
ELSE
IF ($P_GG[30]==6)
_H_MSNUM=$P_MSNUM
ENDIF
IF (_H_MSNUM)
IF (_H_MSNUM==1)
__DMODE3=0
ELSE
__DMODE3=1
ENDIF
ELSE
GOTOF _FEHL12
ENDIF
ENDIF
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF(_AMODE4<0)OR(_AMODE4>2) GOTOF _FEHL25
IF(_AMODE7<0)OR(_AMODE7>2) GOTOF _FEHL28
IF ((_AMODE7==2)AND($P_SUBPAR[18]==0)AND((_VARI MOD 10)==1)) GOTOF _FEHL31
IF(_AMODE4>0)
PIT=ABS(PIT) MPIT=ABS(MPIT)
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE37") OR (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE38")
_ARTIS[0]=0
GOTOF _END_ARTIS_STAT
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE37") OR (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE38")
_ARTIS[0]=0
GOTOF _END_ARTIS_STAT
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL5
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL5
ELSE
_ARTIS[11]=_II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL5
ELSE
_ARTIS[12]=_II MOD 10
ENDIF
ENDIF
_END_ARTIS_STAT:
IF HH7>0 GOTOF _MA3
IF (NOT($MCS_FUNCTION_MASK_DRILL B_AND 'B1'))
_TEC_0=$SCS_DRILL_TAPPING_SET_GG12[__DMODE3] _TEC_1=$SCS_DRILL_TAPPING_SET_GG24[__DMODE3] _TEC_2=$SCS_DRILL_TAPPING_SET_GG21[__DMODE3]
_TEC_3=$SCS_DRILL_TAPPING_SET_MC[__DMODE3]
ELSE
IF (_DMODE4==0)
_TEC_0=_TECHNO _DEC1 _TEC_1=_TECHNO _DEC2 _TEC_2=_TECHNO _DEC3 _TEC_3=_TECHNO _DEC4
ELSE
_TEC_0=0 _TEC_1=0 _TEC_2=0 _TEC_3=0
ENDIF
ENDIF
_TEC_4= ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B1000')
IF(_TEC_0<0)OR(_TEC_0>3)OR(_TEC_1<0)OR(_TEC_1>2)OR(_TEC_2<0)OR(_TEC_2>3)OR(_TEC_3<0)OR(_TEC_3>1)GOTOF _FEHL4
_GG12=_TEC_0
IF _GG12==0
_GG12=$P_GG[12]
ENDIF
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
CASE _AXN OF 1 GOTOF _AX1 2 GOTOF _AX2 DEFAULT GOTOF _AX3
_AX1:
IF ISAXIS(_ABS)
_Z=$P_AXN1
GOTOF _AX
ELSE
GOTOF _FEHL5
ENDIF
_AX2:
IF ISAXIS(_ORD)
_Z=$P_AXN2
GOTOF _AX
ELSE
GOTOF _FEHL5
ENDIF
_AX3:
IF ISAXIS(_APP)
_Z=$P_AXN3
ELSE
GOTOF _FEHL5
ENDIF
_AX:
_ISO=_VARI DIV 1000
IF _ISO>1 GOTOF _FEHL3
_VARI=_VARI MOD 10
IF(_VARI<0)OR(_VARI>2) GOTOF _FEHL3
IF _ISO==1 GOTOF _M6201
SPINU=$P_MSNUM
IF _TEC_4
FOR _II=0 TO 5
_MD_31050[_II]=$MA_DRIVE_AX_RATIO_DENOM[_II,_Z] _MD_31060[_II]=$MA_DRIVE_AX_RATIO_DENOM[_II,_Z]
ENDFOR
IF NOT( (_MD_31050[1]==_MD_31050[0])AND (_MD_31050[1]==_MD_31050[2])AND (_MD_31050[1]==_MD_31050[3])AND (_MD_31050[1]==_MD_31050[4])AND (_MD_31050[1]==_MD_31050[5]) ) GOTOF _CHECK_31050
IF ( (_MD_31060[1]==_MD_31060[0])AND (_MD_31060[1]==_MD_31060[2])AND (_MD_31060[1]==_MD_31060[3])AND (_MD_31060[1]==_MD_31060[4])AND (_MD_31060[1]==_MD_31060[5]) ) GOTOF _M6201
_CHECK_31050:
IF $MA_PARAMSET_CHANGE_ENABLE[_Z]==2
IF ($MA_DRIVE_AX_RATIO_DENOM[($AA_SCPAR[_Z]-1),_Z] <> $MA_DRIVE_AX_RATIO_DENOM[1,_Z]) GOTOF _FEHL7
IF ($MA_DRIVE_AX_RATIO_NUMERA[($AA_SCPAR[_Z]-1),_Z] <> $MA_DRIVE_AX_RATIO_NUMERA[1,_Z]) GOTOF _FEHL7
ELSE
IF ($MA_DRIVE_AX_RATIO_DENOM[$AC_SGEAR[SPINU],_Z] <> $MA_DRIVE_AX_RATIO_DENOM[1,_Z]) GOTOF _FEHL7
IF ($MA_DRIVE_AX_RATIO_NUMERA[$AC_SGEAR[SPINU],_Z] <> $MA_DRIVE_AX_RATIO_NUMERA[1,_Z]) GOTOF _FEHL7
ENDIF
ENDIF
_M6201:
_HMF=$P_ACTFRAME[_Z,SC]
IF(((_VRT<=0)AND(_AMODE7==0))OR(_AMODE7==1))
_VRT=1
IF($P_GG[13]==1)OR($P_GG[13]==3)
_VRT=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DPR=ABS(DPR) _DAM=ABS(_DAM) SDIS=ABS(SDIS) HH3=$P_S[0] HH4=$P_F
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MD1
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MB1 IF DP==HH2 GOTOF _MD1
_MB1:DP=HH2
_MD1:HH7=1 HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL30
IF RTP==RFP
HH11=1
ELSE
HH11=(RFP-DP)/ABS(RFP-DP)
ENDIF
IF((_DAM==0) AND (_VARI>0))
GOTOF _FEHL10
ENDIF
IF RFP==DP GOTOF _FEHL30 IF HH2==0 GOTOF _MA2 IF HH2/ABS(HH2)<>(RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
HH1=SDIS*(RFP-DP)/ABS(RFP-DP)
_MA2:
CASE _PITA OF 0 GOTOF _P0TAB 1 GOTOF _P1TAB 2 GOTOF _P2TAB 3 GOTOF _P3TAB 4 GOTOF _P4TAB DEFAULT GOTOF _FEHL2
_P0TAB:IF (PIT==0) AND (MPIT==0) GOTOF _FEHL2
PP=PIT
IF MPIT<>0
IF (ABS(MPIT)<3)OR(ABS(MPIT)>48) GOTOF _FEHL2
N2 CYCLE204(PP,ABS(MPIT))
PP=PP*MPIT/ABS(MPIT)
IF (PP<>PIT)AND(PIT<>0) GOTOF _FEHL2
ENDIF
PP=PP*_FAK3
GOTOF _ENDTAB
_P1TAB:IF (PIT==0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT/$MN_SCALING_VALUE_INCH
ELSE
PP=PIT
ENDIF
GOTOF _ENDTAB
_P2TAB:IF (PIT==0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=1/PIT
ELSE
PP=$MN_SCALING_VALUE_INCH/PIT
ENDIF
GOTOF _ENDTAB
_P3TAB:IF (PIT==0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT
ELSE
PP=$MN_SCALING_VALUE_INCH*PIT
ENDIF
GOTOF _ENDTAB
_P4TAB:IF (PIT==0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT*$PI/$MN_SCALING_VALUE_INCH
ELSE
PP=PIT*$PI
ENDIF
_ENDTAB:
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP==240) AND ($P_ADT[9]<>0)
IF(ABS(ABS(PP)-ABS($P_ADT[9])*_FAK1)>_EPS) GOTOF _FEHL13
ENDIF
ENDIF
IF (_AMODE4==2)
PP=-PP
ENDIF
IF ($MA_SPIND_FUNCTION_MASK[_MAX] B_AND 'B10000000000000000000000')
IF _ZSD[7]==-1
IF ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B1')
PP=-PP
ENDIF
ELSE
IF _ZSD[7]==1
IF (( NOT ( _PROG == "F_DR_TAP" ) ) AND ( NOT(SUBSTR(_PROG,0,5)=="F_TAP")))
PP=-PP
ENDIF
ENDIF
ENDIF
ENDIF
IF (SDAC<6)AND(SDAC>2) GOTOF _MD2
SDAC=5
_MD2:IF SST1>0 GOTOF _MA3A
SST1=SST
_MA3A:
_MA3:
HH2=RFP+HH1
IF(HH2<>$P_EP[_Z]*_FAK1)
IF ( ($P_GG[30]==6)AND(_TEC_0==0) )
SBLON
N20 G0 G90 AX[_Z]=RFP+HH1/_HMF
SBLOF
ELSE
SBLON
N20 G0 G9 G90 AX[_Z]=RFP+HH1/_HMF
SBLOF
ENDIF
ENDIF
IF (HH7==1) OR (_TEC_3==0)
HH7=2
IF ($MA_GEAR_STEP_CHANGE_ENABLE[SPI($P_MSNUM)] B_AND 'B100000')
N290 G331 S=SST
ELSE
N29 S=SST
ENDIF
ENDIF
IF (NOT((HH7==3)AND(_TEC_3==1)))
HH7=3
IF POSS<0
N30 SPOS=DC($SC_THREAD_START_ANGLE)
ELSE
N30 SPOS=DC(POSS)
ENDIF
ENDIF
_OLD12=$P_GG[12]
IF _TEC_0
G60 G[12]=_TEC_0
ENDIF
_OLD24=$P_GG[24]
IF _TEC_1==1
FFWON
ENDIF
IF _TEC_1==2
FFWOF
ENDIF
_OLD21=$P_GG[21]
CASE _TEC_2 OF 1 GOTOF _ACC1 2 GOTOF _ACC2 3 GOTOF _ACC3 DEFAULT GOTOF _ACCNIX
_ACC1: SOFT
GOTOF _ACCNIX
_ACC2: BRISK
GOTOF _ACCNIX
_ACC3: DRIVE
_ACCNIX:
IF(_VARI==0)
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
IF ( ($P_GG[30]==6)AND(_TEC_0==0) )
N32 G90 G331 AX[_Z]=DP IP[_Z]=PP/_HMF S=SST
ELSE
N32 G90 G60 G[12]=_GG12 G331 AX[_Z]=DP IP[_Z]=PP/_HMF S=SST
ENDIF
IF ABS(DTB)>=0.0001
N33 G4 F=DTB
ENDIF
N34 G332 AX[_Z]=RFP+HH1/_HMF IP[_Z]=PP/_HMF S=SST1
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
ELSE
HZ=1
IF _VARI MOD 10 ==2
_VRT=0
ENDIF
_HH9=_DAM
HH2=RFP*_HMF-_DAM*HH11
IF((HH2-DP*_HMF)*HH11)<0
HH2=DP*_HMF
ENDIF
IF(_VRT<=0)
_VRT=HZ*_FAK3
ENDIF
_MA5A:
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF (_ARTIS[6]<>0)
IF (_ARTIS[10]==_ARTIS[14])
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
ELSE
IF ((_SC_TOOL_VALI[4]<=_ARTIS[10]) AND (_ARTIS[10]<=_SC_TOOL_VALI[5]))
_ARTIS[4]=_ARTIS[10] _ARTIS[5]=_ARTIS[10]
ENDIF
ENDIF
IF (((_ARTISUP==0)AND(_ARTIS[15]==0)) OR ((_ARTISUP==1)AND(_ARTIS[15]==1)))
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
ENDIF
IF ( ($P_GG[30]==6)AND(_TEC_0==0) )
G90 G331 AX[_Z]=HH2/_HMF IP[_Z]=PP/_HMF S=SST
ELSE
G90 G60 G[12]=_GG12 G331 AX[_Z]=HH2/_HMF IP[_Z]=PP/_HMF S=SST
ENDIF
IF _ISO==0
IF ABS(DTB)>=0.0001
G4 F=DTB
ENDIF
ENDIF
IF(HH2==DP*_HMF)GOTOF _MA8
IF(ABS(HH2-DP*_HMF)-_HH9>=_DAM)
IF(ABS(HH2-DP*_HMF)>2*_DAM)
HH5=HH2-_HH9*HH11
ELSE
IF(ABS(HH2-DP*_HMF)>_DAM)
HH5=HH2-ABS(HH2-DP*_HMF)/2*HH11
ELSE
HH5=DP*_HMF
ENDIF
ENDIF
ELSE
IF(ABS(HH2-DP*_HMF)>_HH9)
IF(ABS(HH2-DP*_HMF)>2*_DAM)
HH5=DP*_HMF+_DAM*HH11
ELSE
HH5=HH2-ABS(HH2-DP*_HMF)/2*HH11
ENDIF
ELSE
HH5=DP*_HMF
ENDIF
ENDIF
_MA6:
IF(_VARI==2)
SBLON
N280 G90 G332 AX[_Z]=RFP+SDIS*HH11/_HMF IP[_Z]=PP/_HMF S=SST1
SBLOF
IF (_ARTIS[11]==3) AND (((_ARTISUP==0)AND(_ARTIS[15]==0)) OR ((_ARTISUP==1)AND(_ARTIS[15]==1)))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IF _ISO==0
IF ABS(DTB)>=0.0001
G4 F=DTB
ENDIF
ENDIF
ELSE
N365 G91 G332 AX[_Z]=HH11*_VRT/_HMF IP[_Z]=PP/_HMF S=SST1
IF (_ARTIS[11]==3) AND (((_ARTISUP==0)AND(_ARTIS[15]==0)) OR ((_ARTISUP==1)AND(_ARTIS[15]==1)))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
ENDIF
HH2=HH5
GOTOB _MA5A
_MA8:
IF _ISO==1
IF ABS(DTB)>=0.0001
G4 F=DTB
ENDIF
ENDIF
ENDIF
IF _VARI<>0 ;normales Gewindebohren
N580 G90 G332 AX[_Z]=RFP+SDIS*HH11/_HMF IP[_Z]=PP/_HMF S=SST1
IF (_ARTIS[11]==3) AND (((_ARTISUP==0)AND(_ARTIS[15]==0)) OR ((_ARTISUP==1)AND(_ARTIS[15]==1)))
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
ENDIF
IF _TEMPA
WRITE(_TEMP,_TEMP_FILE,";G[12]="<<$P_GG[12]<<" G[21]="<<$P_GG[21]<<" G[24]="<<$P_GG[24]<<"    ; G601.. SOFT.. FFWON")
ENDIF
G[12]=_OLD12 G[21]=_OLD21
IF NOT($P_GG[24]==_OLD24)
G[24]=_OLD24
ENDIF
G[10]=_GG10
IF _TEC_3==0
SBLON
N36 G0 AX[_Z]=RTP S=HH3 M=SDAC
SBLOF
ELSE
SBLON
N36 G0 AX[_Z]=RTP
SBLOF
ENDIF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
N37 MM2:
IF HH4==0 GOTOF _MX3
N38 F=HH4
N39 _MX3:
IF ((_SC_TOOL_VALI[0]<>0) AND (_ARTIS[15]==1))
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
SBLON
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
IF NOT($P_GG[24]==_OLD24)
G[24]=_OLD24
ENDIF
RET
_FEHL1:STOPRE
N708401 SETAL(61101)
RET
_FEHL2:STOPRE
N708402 SETAL(61001)
RET
_FEHL3:STOPRE
N708403 SETAL(61002)
RET
_FEHL4:STOPRE
N708401 SETAL(61125)
RET
_FEHL5:STOPRE
N708405 SETAL(61803)
RET
_FEHL7:STOPRE
N708407 SETAL(61127)
RET
_FEHL8:STOPRE
N708408 SETAL(61809)
RET
_FEHL9:
N708409 SETAL(62106)
RET
_FEHL10: STOPRE
N708410 SETAL(61156)
RET
_FEHL12: STOPRE
N708412 SETAL(61287)
RET
_FEHL13: STOPRE
N708413 SETAL(61262)
RET
_FEHL18: STOPRE
N708418 SETAL(61019,_SERR)
RET
_FEHL22: STOPRE
N708422 SETAL(61158)
RET
_FEHL23: STOPRE
N708423 SETAL(61159)
RET
_FEHL24: STOPRE
N708424 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL25: STOPRE
N708425 SETAL(61019,"(_AMODE: dec4)")
RET
_FEHL28: STOPRE
N708428 SETAL(61019,"(_AMODE: dec7)")
RET
_FEHL29: STOPRE
N708429 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N708430 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N708431 SETAL(61019,"(_AMODE: dec7/VRT)")
RET
_FEHL32: STOPRE
N708432 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL33: STOPRE
N708433 SETAL(61019,"(_DMODE: dec3)")
RET
_FEHL34: STOPRE
N708434 SETAL(61019,"(_DMODE: dec5)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE840_SPF
PROC CYCLE840(REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,INT SDR,INT SDAC,INT ENC,REAL MPIT,REAL PIT,INT _AXN,INT _PITA,INT _TECHNO,STRING[15] _PITM,STRING[20] _PTAB,STRING[20] _PTABA,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.006 ;DATE: 2023-05-17
;Cycle support HMIsl
;Tapping with compensating chuck, with or without encoder, G33 and G63
N11 DEF AXIS _Z
N12 DEF REAL PP,HH1,HH2,HH3,HH4,_FNEU,_HMF,_BEP,_BEPVOR,_NIST,_NSOLL,_EPS=0.001,_FAK1,_FAK3
N13 DEF INT SPINU,MRI,RRI,_TEC_0,_TEC_1,_TEC_2,_TEC_3,_II,_JJ,_CO1,_CO2,_OLD12,_OLD24,_AXZAHL
DEF INT _ABS,_ORD,_APP,_TYP
DEF INT _ARTIS[16],_TEMP,_DMODE1,_DMODE4,_AMODE1,_TEMPA
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE840_MPF",_SERR
DEF INT _GGC[64],_GRUPPE[10],_MD_31050[6],_MD_31060[6]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE840_MPF")
_TEMPA=1
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[12]="<<$P_GG[12]<<" G[21]="<<$P_GG[21]<<" G[24]="<<$P_GG[24]<<"    ; G601.. SOFT.. FFWON")
WRITE(_TEMP,_TEMP_FILE,"CYCLE840("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<SDR<<","<<SDAC<<","<<ENC<<","<<MPIT<<","<<PIT<<","<<_AXN<<","<<_PITA<<","<<_TECHNO<<","<<_PITM<<","<<_PTAB<<","<<_PTABA<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
IF (ENC==0) OR (ENC==1) OR (ENC==11) OR (ENC==20)
GOTOF _ENC_OK
ELSE
GOTOF _FEHL4
ENDIF
_ENC_OK:
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL10
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL10
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL10
ENDIF
ENDIF
_END_ARTIS_STAT:
_DMODE4=_DMODE _DEC4
IF(_DMODE4<0)OR(_DMODE4>1) GOTOF _FEHL31
IF (NOT($MCS_FUNCTION_MASK_DRILL B_AND 'B10'))
_TEC_0=$SCS_DRILL_TAPPING_SET_GG12[0] _TEC_1=$SCS_DRILL_TAPPING_SET_GG24[0]
ELSE
IF (_DMODE4==0)
_TEC_0=_TECHNO _DEC1 _TEC_1=_TECHNO _DEC2
ELSE
_TEC_0=0 _TEC_1=0
ENDIF
ENDIF
_TEC_3= ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B10000')
IF (_TEC_3>0)
_TEC_3=1
ENDIF
IF(_TEC_0<0)OR(_TEC_0>3)OR(_TEC_1<0)OR(_TEC_1>2) GOTOF _FEHL5
_ABS=1 _ORD=2 _APP=3
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
CASE _AXN OF 1 GOTOF _AX1 2 GOTOF _AX2 DEFAULT GOTOF _AX3
_AX1:
IF ISAXIS(_ABS)
_Z=$P_AXN1
GOTOF _AX
ELSE
GOTOF _FEHL9
ENDIF
_AX2:
IF ISAXIS(_ORD)
_Z=$P_AXN2
GOTOF _AX
ELSE
GOTOF _FEHL9
ENDIF
_AX3:
IF ISAXIS(_APP)
_Z=$P_AXN3
ELSE
GOTOF _FEHL9
ENDIF
_AX:
_HMF=$P_ACTFRAME[_Z,SC]
SPINU=$P_MSNUM
IF SPINU==0
GOTOF _FEHL32
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS) HH3=$P_S[0] HH4=$P_F
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MD1
IF RTP==RFP GOTOF _FEHL1
N16 HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MB1 IF DP==HH2 GOTOF _MD1
_MB1:DP=HH2
_MD1:HH2=RTP-RFP
N17 IF RFP==DP GOTOF _FEHL30 IF HH2==0 GOTOF _MA2 IF HH2/ABS(HH2)<>(RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
N18 HH1=SDIS*(RFP-DP)/ABS(RFP-DP)
_MA2:MRI=$P_SDIR[SPINU]
IF MRI==3
RRI=4
ENDIF
IF MRI==4
RRI=3
ENDIF
_AXZAHL=31
FOR _II=0 TO _AXZAHL
_JJ=$MC_AXCONF_MACHAX_USED[_II]
IF _JJ<>0
IF $MA_SPIND_ASSIGN_TO_MACHAX[AXNAME("AX"<<_JJ)]==SPINU GOTOF _MASAXEND
ENDIF
ENDFOR
GOTOF _GG63
_MASAXEND:IF $MA_NUM_ENCS[AXNAME("AX"<<_JJ)]==0 GOTOF _GG63
IF ((ENC==1) OR (ENC==11)) GOTOF _GG63
CASE _PITA OF 0 GOTOF _P0TAB 1 GOTOF _P1TAB 2 GOTOF _P2TAB 3 GOTOF _P3TAB 4 GOTOF _P4TAB DEFAULT GOTOF _FEHL2
_P0TAB:IF (PIT<=0) AND (MPIT==0) GOTOF _FEHL2
PP=PIT
IF MPIT<>0
IF (MPIT<3)OR(MPIT>48) GOTOF _FEHL2
N3 CYCLE204(PP,MPIT)
IF (PP<>PIT)AND(PIT<>0) GOTOF _FEHL2
ENDIF
PP=PP*_FAK3
GOTOF _ENDTAB
_P1TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT/$MN_SCALING_VALUE_INCH
ELSE
PP=PIT
ENDIF
GOTOF _ENDTAB
_P2TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=1/PIT
ELSE
PP=$MN_SCALING_VALUE_INCH/PIT
ENDIF
GOTOF _ENDTAB
_P3TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT
ELSE
PP=$MN_SCALING_VALUE_INCH*PIT
ENDIF
GOTOF _ENDTAB
_P4TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT*$PI/$MN_SCALING_VALUE_INCH
ELSE
PP=PIT*$PI
ENDIF
_ENDTAB:
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP==240) AND ($P_ADT[9]<>0)
IF(ABS(ABS(PP)-ABS($P_ADT[9])*_FAK1)>_EPS) GOTOF _FEHL13
ENDIF
ENDIF
_MB3:IF SDR==0 GOTOF _MD3
IF(SDR<3)OR(SDR>4) GOTOF _FEHL3
IF (SDAC<3)OR(SDAC>5) GOTOF _MC3
MRI=SDAC
_MC3:RRI=SDR
_MD3:IF (RRI<3)OR(RRI>4) GOTOF _FEHL3
_BEP=0
IF _TEC_3==1
FOR _II=0 TO 5
_MD_31050[_II]=$MA_DRIVE_AX_RATIO_DENOM[_II,_Z] _MD_31060[_II]=$MA_DRIVE_AX_RATIO_DENOM[_II,_Z]
ENDFOR
IF NOT( (_MD_31050[1]==_MD_31050[0])AND (_MD_31050[1]==_MD_31050[2])AND (_MD_31050[1]==_MD_31050[3])AND (_MD_31050[1]==_MD_31050[4])AND (_MD_31050[1]==_MD_31050[5]) ) GOTOF _CHECK_31050
IF ( (_MD_31060[1]==_MD_31060[0])AND (_MD_31060[1]==_MD_31060[2])AND (_MD_31060[1]==_MD_31060[3])AND (_MD_31060[1]==_MD_31060[4])AND (_MD_31060[1]==_MD_31060[5]) ) GOTOF _CHECK_FERTIG
_CHECK_31050:
IF $MA_PARAMSET_CHANGE_ENABLE[_Z]==2
IF ($MA_DRIVE_AX_RATIO_DENOM[($AA_SCPAR[_Z]-1),_Z] <> $MA_DRIVE_AX_RATIO_DENOM[1,_Z]) GOTOF _FEHL7
IF ($MA_DRIVE_AX_RATIO_NUMERA[($AA_SCPAR[_Z]-1),_Z] <> $MA_DRIVE_AX_RATIO_NUMERA[1,_Z]) GOTOF _FEHL7
ELSE
IF ($MA_DRIVE_AX_RATIO_DENOM[$AC_SGEAR[SPINU],_Z] <> $MA_DRIVE_AX_RATIO_DENOM[1,_Z]) GOTOF _FEHL7
IF ($MA_DRIVE_AX_RATIO_NUMERA[$AC_SGEAR[SPINU],_Z] <> $MA_DRIVE_AX_RATIO_NUMERA[1,_Z]) GOTOF _FEHL7
ENDIF
ENDIF
_CHECK_FERTIG:
IF ( ($P_GG[30]==6)AND(_TEC_0==0) )
SBLON
N30 G0 G90 LFOF AX[_Z]=RFP+HH1/_HMF
SBLOF
ELSE
SBLON
N30 G0 G09 G90 LFOF AX[_Z]=RFP+HH1/_HMF
SBLOF
ENDIF
_OLD12=$P_GG[12]
IF _TEC_0
G60 G[12]=_TEC_0
ENDIF
_OLD24=$P_GG[24]
IF _TEC_1==1
FFWON
ENDIF
IF _TEC_1==2
FFWOF
ENDIF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N31 G33 AX[_Z]=(DP+_BEP) IP[_Z]=PP
N33 G33 G90 AX[_Z]=RFP+HH1/_HMF IP[_Z]=PP M=RRI
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
IF _TEMPA
WRITE(_TEMP,_TEMP_FILE,";G[12]="<<$P_GG[12]<<" G[21]="<<$P_GG[21]<<" G[24]="<<$P_GG[24]<<"    ; G601.. SOFT.. FFWON")
ENDIF
G[12]=_OLD12 G[24]=_OLD24
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF ENC==20
N337 G4 F=DTB
ENDIF
_NACH_G4_DTB:
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
IF NOT ((SDR==0) AND (SDAC==5))
N34 G0 AX[_Z]=RTP S=HH3 M=MRI
ELSE
N34 G0 AX[_Z]=RTP S=HH3 M=SDAC
ENDIF
SBLOF
IF HH4
F=HH4
ENDIF
GOTOF _MRET
_GG63:
IF ENC==11
CASE _PITA OF 0 GOTOF _P5TAB 1 GOTOF _P6TAB 2 GOTOF _P7TAB 3 GOTOF _P8TAB DEFAULT GOTOF _FEHL2
_P5TAB:PP=PIT
IF MPIT<>0
IF (MPIT<3)OR(MPIT>48) GOTOF _FEHL2
CYCLE204(PP,MPIT)
IF (PP<>PIT)AND(PIT<>0) GOTOF _FEHL2
ENDIF
PP=PP*_FAK3
GOTOF _ENTTAB63
_P6TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT/$MN_SCALING_VALUE_INCH
ELSE
PP=PIT
ENDIF
GOTOF _ENTTAB63
_P7TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=1/PIT
ELSE
PP=$MN_SCALING_VALUE_INCH/PIT
ENDIF
GOTOF _ENTTAB63
_P8TAB:IF (PIT<=0) GOTOF _FEHL2
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
PP=PIT
ELSE
PP=$MN_SCALING_VALUE_INCH*PIT
ENDIF
_ENTTAB63:
IF PP==0
_FNEU=HH4 ENC=1
GOTOF _M5302
ENDIF
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP==240)
IF(ABS(ABS(PP)-ABS($P_ADT[9])*_FAK1)>_EPS) GOTOF _FEHL13
ENDIF
ENDIF
_FNEU=HH4
IF $P_GG[15]==2
_FNEU=PP*HH3
IF ($P_GG[13]==1) AND ($MN_SCALING_SYSTEM_IS_METRIC==1)
_FNEU=_FNEU*$MN_SCALING_VALUE_INCH
ENDIF
IF ($P_GG[13]==2) AND ($MN_SCALING_SYSTEM_IS_METRIC==0)
_FNEU=_FNEU/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF $P_GG[15]==3
_FNEU=PP
IF ($P_GG[13]==1) AND ($MN_SCALING_SYSTEM_IS_METRIC==1)
_FNEU=_FNEU*$MN_SCALING_VALUE_INCH
ENDIF
IF ($P_GG[13]==2) AND ($MN_SCALING_SYSTEM_IS_METRIC==0)
_FNEU=_FNEU/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FNEU=HH4
ENDIF
_M5302:
IF ((SDR<0) OR (SDR==1) OR (SDR==2) OR (SDR>4)) GOTOF _FEHL3
IF (SDAC<3)OR(SDAC>5) GOTOF _MA4
MRI=SDAC
IF (RRI<3)OR(RRI>4) GOTOF _FEHL3
IF _TEC_3==1
IF ($MA_DRIVE_AX_RATIO_DENOM[($AA_SCPAR[_Z]-1),_Z] <> $MA_DRIVE_AX_RATIO_DENOM[1,_Z]) GOTOF _FEHL7
IF ($MA_DRIVE_AX_RATIO_NUMERA[($AA_SCPAR[_Z]-1),_Z] <> $MA_DRIVE_AX_RATIO_NUMERA[1,_Z]) GOTOF _FEHL7
ENDIF
_MA4:
IF ( ($P_GG[30]==6)AND(_TEC_0==0) )
SBLON
N4 G0 G90 AX[_Z]=RFP+HH1/_HMF F=_FNEU
SBLOF
ELSE
SBLON
N4 G0 G09 G90 AX[_Z]=RFP+HH1/_HMF F=_FNEU
SBLOF
ENDIF
IF ( ($P_GG[30]==6)AND(_TEC_0==0) )
G0 G90 G94 AX[_Z]=RFP+HH1
ELSE
G0 G09 G90 G94 AX[_Z]=RFP+HH1
ENDIF
N400 SBLOF
IF (_TEC_3==1) AND ($P_SEARCH==0) AND ($P_DRYRUN==0)
IF ($AC_SDIR[SPINU]==SDR) OR ($AC_SDIR[SPINU]==5)GOTOF _FEHL8
ENDIF
IF (_TEC_3==1) AND ($P_SEARCH==0) AND ($P_DRYRUN==0)
_NSOLL=$P_S[SPINU]
IF _NSOLL>$MA_GEAR_STEP_MAX_VELO_LIMIT[$AC_SGEAR[SPINU],AXNAME("AX"<<_JJ)]
_NSOLL=$MA_GEAR_STEP_MAX_VELO_LIMIT[$AC_SGEAR[SPINU],AXNAME("AX"<<_JJ)]
ENDIF
IF _NSOLL<$MA_GEAR_STEP_MIN_VELO_LIMIT[$AC_SGEAR[SPINU],AXNAME("AX"<<_JJ)]
_NSOLL=$MA_GEAR_STEP_MIN_VELO_LIMIT[$AC_SGEAR[SPINU],AXNAME("AX"<<_JJ)]
ENDIF
IF _NSOLL>$SA_SPIND_MAX_VELO_G26[AXNAME("AX"<<_JJ)]
_NSOLL=$SA_SPIND_MAX_VELO_G26[AXNAME("AX"<<_JJ)]
ENDIF
IF _NSOLL<$SA_SPIND_MIN_VELO_G25[AXNAME("AX"<<_JJ)]
_NSOLL=$SA_SPIND_MIN_VELO_G25[AXNAME("AX"<<_JJ)]
ENDIF
_CO2=0
GOTOF _W13C
_W12C:
_W13C:
IF(ABS(_NSOLL-ABS($AA_S[SPINU]))>($MA_SPIND_DES_VELO_TOL[AXNAME("AX"<<_JJ)]*_NSOLL))
GOTOB _W12C
ENDIF
_CO2=_CO2+1
IF(_CO2<3)
GOTOB _W13C
ENDIF
ENDIF
_OLD12=$P_GG[12]
IF _TEC_0
G60 G[12]=_TEC_0
ENDIF
_OLD24=$P_GG[24]
IF _TEC_1==1
FFWON
ENDIF
IF _TEC_1==2
FFWOF
ENDIF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N41 G63 AX[_Z]=DP
_NIST=$AA_S[SPINU]
N42 M=RRI
IF NOT(ABS(DTB)<0.0001)
N43 G4 F=DTB
ENDIF
IF (_TEC_3==1) AND ($P_SEARCH==0) AND ($P_DRYRUN==0)
_CO1=0
GOTOF _W13B
_W12B:
_W13B:
IF(_NIST<0)
IF($AA_S[SPINU]<0) GOTOB _W12B
_CO1=_CO1+1
IF(_CO1<3) GOTOB _W13B
ELSE
IF($AA_S[SPINU]>0) GOTOB _W12B
_CO1=_CO1+1
IF(_CO1<3) GOTOB _W13B
ENDIF
ENDIF
N44 G63 AX[_Z]=RFP+HH1/_HMF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
IF _TEMPA
WRITE(_TEMP,_TEMP_FILE,";G[12]="<<$P_GG[12]<<" G[21]="<<$P_GG[21]<<" G[24]="<<$P_GG[24]<<"    ; G601.. SOFT.. FFWON")
ENDIF
G[12]=_OLD12 G[24]=_OLD24
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
IF NOT ((SDR==0) AND (SDAC==5))
N45 G0 AX[_Z]=RTP S=HH3 M=MRI
ELSE
N45 G0 AX[_Z]=RTP S=HH3 M=SDAC
ENDIF
SBLOF
IF HH4
F=HH4
ENDIF
_MRET:
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
IF NOT($P_GG[24]==_OLD24)
G[24]=_OLD24
ENDIF
RET
_FEHL1:STOPRE
N784001 SETAL(61101)
RET
_FEHL2:STOPRE
N784002 SETAL(61001)
RET
_FEHL3:STOPRE
N784003 SETAL(61102)
RET
_FEHL4:STOPRE
N784004 SETAL(61002)
RET
_FEHL5:STOPRE
N784005 SETAL(61125)
RET
_FEHL6:STOPRE
N784006 SETAL(61126)
RET
_FEHL7:STOPRE
N784007 SETAL(61127)
RET
_FEHL8:STOPRE
N784008 SETAL(61807)
RET
_FEHL9:STOPRE
N784009 SETAL(61803)
RET
_FEHL10:STOPRE
N784010 SETAL(62106)
RET
_FEHL13: STOPRE
N784013 SETAL(61262)
RET
_FEHL18: STOPRE
N784018 SETAL(61019,_SERR)
RET
_FEHL22: STOPRE
N784022 SETAL(61158)
RET
_FEHL23: STOPRE
N784023 SETAL(61159)
RET
_FEHL24: STOPRE
N784024 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL29: STOPRE
N784029 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N784030 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL31: STOPRE
N784031 SETAL(61019,"(_DMODE: dec4)")
RET
_FEHL32:STOPRE
N784032 SETAL(61287)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE85_SPF
PROC CYCLE85 (REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,REAL FFR,REAL RFF,INT _GMODE,INT _DMODE,INT _AMODE,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Boring 1, Reaming
DEF AXIS _Z
DEF REAL HH2
DEF INT HH7,_II
DEF INT _ARTIS[16],_TEMP,_DMODE1,_AMODE1,_AMODE2,_TYP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE85_MPF",_SERR
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE85_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE85("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<FFR<<","<<RFF<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE37") OR (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE38")
_ARTIS[0]=0
GOTOF _END_ARTIS_STAT
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ENDIF
ENDIF
_END_ARTIS_STAT:
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
_AMODE2=(_AMODE _DEC2)
IF(_AMODE2<0)OR(_AMODE2>2) GOTOF _FEHL26
IF ((_AMODE2==2)AND(DTB>0))
DTB=-DTB
ENDIF
IF ((_AMODE2==1)AND(DTB<0))
DTB=ABS(DTB)
ENDIF
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560))
GOTOF _FEHL3
ENDIF
ENDIF
ENDIF
IF HH7 GOTOF _MM1B
IF ($P_GG[6]==2) AND (ISAXIS(2)==FALSE)
GOTOF _FEHL5
ELSE
_Z=$P_AXN3
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MM1
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
N1 _MM0:DP=HH2
_MM1:HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL30 IF HH2==0 GOTOF _MM1A IF HH2/ABS(HH2)<>(RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
_MM1A:HH7=1
_MM1B: SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
N11 G0 G90 AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N2 G1 F=FFR AX[_Z]=DP
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF(((DTB>=0)AND(_AMODE2==0))OR(_AMODE2==1))
N3 G4 F=DTB
ELSE
N3 G4 S=-DTB
ENDIF
_NACH_G4_DTB:
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
IF ( (RFP+SDIS*(RFP-DP)/ABS(RFP-DP))==(RTP) )
SBLON
ENDIF
N4 F=RFF AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
SBLON
N5 G0 AX[_Z]=RTP
SBLOF
_MM2:
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1:STOPRE
N708501 SETAL(61101)
RET
_FEHL2:STOPRE
N708502 SETAL(62106)
RET
_FEHL3: STOPRE
N708503 SETAL(61212)
RET
_FEHL5: STOPRE
N708505 SETAL(61005)
RET
_FEHL18: STOPRE
N708518 SETAL(61019,_SERR)
RET
_FEHL22: STOPRE
N708522 SETAL(61158)
RET
_FEHL23: STOPRE
N708523 SETAL(61159)
RET
_FEHL24: STOPRE
N708524 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL26: STOPRE
N708526 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL29: STOPRE
N708529 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N708530 SETAL(61019,"(_AMODE: dec1/DPR)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE86_SPF
PROC CYCLE86 (REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,INT SDIR,REAL _RPA,REAL _RPO,REAL RPAP,REAL POSS,INT _GMODE,INT _DMODE,INT _AMODE,INT _UMODE,REAL S_D3D,REAL S_C3D) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Boring 2, Turning
DEF AXIS _X,_Y,_Z
DEF REAL HH2,_POSS,_RG[4],RPA,RPO
DEF INT HH7,_II,_H
DEF INT _ABS=1,_ORD=2,_APP=3,_ARTIS[16],_TEMP,_GMODE1,_DMODE1,_AMODE1,_AMODE2,_G17_18_19,_TC,_TC_TYP,_TYP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE86_MPF",_SERR
DEF REAL _DATC116[13]
DEF INT _STATC116
DEF STRING[40] _LOG_FILE
DEF INT _LOG,_LOG_ON=0
DEF REAL _X_POS,_Y_POS,_NORM,_WINKEL
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE86_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE86("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<SDIR<<","<<_RPA<<","<<_RPO<<","<<RPAP<<","<<POSS<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<","<<_UMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE86_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE86: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Input:")
WRITE(_LOG,_LOG_FILE,"Spindelposition POSS = "<<POSS)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Laufzeitumgebung:")
WRITE(_LOG,_LOG_FILE,"SD55216 $SCS_FUNCTION_MASK_DRILL_SET")
WRITE(_LOG,_LOG_FILE,"  Bit 1 =  "<<$SCS_FUNCTION_MASK_DRILL_SET B_AND 'B10'<<" ;Drehung der Werkzeugebene bercksichtigen")
WRITE(_LOG,_LOG_FILE,"  Bit 2 =  "<<$SCS_FUNCTION_MASK_DRILL_SET B_AND 'B100'<<" ;Geschwenkte Tischkinematik bercksichtigen")
WRITE(_LOG,_LOG_FILE,"  Bit 6 =  "<<$SCS_FUNCTION_MASK_DRILL_SET B_AND 'B1000000'<<" ;Spindelposition an Orientierung WZ anpassen")
WRITE(_LOG,_LOG_FILE,"-------------------")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
RPA=_RPA RPO=_RPO
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL4
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL4
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL4
ENDIF
ENDIF
_END_ARTIS_STAT:
_GMODE1=_GMODE _DEC1
IF(_GMODE1<0)OR(_GMODE1>1) GOTO _FEHL5
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL22
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL23
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL24
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL29
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL30
_AMODE2=(_AMODE _DEC2)
IF(_AMODE2<0)OR(_AMODE2>2) GOTOF _FEHL26
IF ((_AMODE2==2)AND(DTB>0))
DTB=-DTB
ENDIF
IF ((_AMODE2==1)AND(DTB<0))
DTB=ABS(DTB)
ENDIF
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560))
GOTOF _FEHL6
ENDIF
ENDIF
ENDIF
IF $P_GG[6]==2
_ABS=3 _ORD=1 _APP=2
ENDIF
IF $P_GG[6]==3
_ABS=2 _ORD=3 _APP=1
ENDIF
IF (ISAXIS(_APP)==0) GOTOF _FEHL2
IF HH7 GOTOF _MM1B
_Z=$P_AXN3
IF(ISAXIS(_ABS)==1)
_X=$P_AXN1
ENDIF
IF(ISAXIS(_ORD)==1)
_Y=$P_AXN2
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF (SDIR==3)OR(SDIR==4)OR(SDIR==5)
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MM1
IF RTP==RFP GOTOF _FEHL1
ELSE
GOTOF _FEHL3
ENDIF
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
_MM0:DP=HH2
_MM1:HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL30 IF HH2==0 GOTOF _MM1A IF HH2/ABS(HH2)<>(RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
_MM1A:HH7=1
_MM1B:
IF (SDIR<>5)
M=SDIR
ENDIF
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
N1 G0 G90 AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N2 G1 AX[_Z]=DP
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF(((DTB>=0)AND(_AMODE2==0))OR(_AMODE2==1))
N3 G4 F=DTB
ELSE
N3 G4 S=-DTB
ENDIF
_NACH_G4_DTB:
IF ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B1000000')
_POSS=POSS
IF ($P_TRAFO B_AND 'H100')
_STATC116=9
CYCLE216(_DATC116,_STATC116)
ELSE
_STATC116=2
CYCLE216(_DATC116,_STATC116)
ENDIF
CUST_TECHCYC(300)
_POSS=_POSS-_MEA_CORR_ANGLE[1]-_MEA_CORR_ANGLE[0]
_POSS=((_POSS MOD 360)+360) MOD 360
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Behandlung Bit 6 - CYCLE216 wurde durchlaufen")
WRITE(_LOG,_LOG_FILE,"_MEA_CORR_ANGLE[1] = "<<_MEA_CORR_ANGLE[1]<< " ;Output CYCLE216")
WRITE(_LOG,_LOG_FILE,"_MEA_CORR_ANGLE[0] = "<<_MEA_CORR_ANGLE[0]<< " ;vom Anwenwender aus CUST_TECHCYC(300)")
WRITE(_LOG,_LOG_FILE,"_POSS_NEU          = "<<_POSS<< " ;berechnete Spindelposition")
WRITE(_LOG,_LOG_FILE,"-------------------")
ENDIF
GOTOF _NO_CORRECT_OTHER_BITS
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Behandlung Bit 6 - CYCLE216 nicht durchlaufen")
WRITE(_LOG,_LOG_FILE,"-------------------")
ENDIF
ENDIF
_POSS=POSS _TC=$P_TC _G17_18_19=$P_GG[6]
IF (_TC AND (ISVAR("$P_PARTFRAME")) AND ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B100'))
_RG[3]=$P_PARTFRAME[_Z,RT]
IF ($TC_CARR23[_TC]<>"T")
_TC_TYP=1
ENDIF
IF ($TC_CARR_KIN_CNTRL[_TC] B_AND 'B1')
_RG[0]=ABS($PC_TCARR_AX_VECT[2,0]) _RG[1]=ABS($PC_TCARR_AX_VECT[2,1]) _RG[2]=ABS($PC_TCARR_AX_VECT[2,2])
IF ((_RG[0]+_RG[1]+_RG[2])==0)
_RG[0]=ABS($PC_TCARR_AX_VECT[1,0]) _RG[1]=ABS($PC_TCARR_AX_VECT[1,1]) _RG[2]=ABS($PC_TCARR_AX_VECT[1,2])
IF ($TC_CARR23[_TC]=="M")
_TC_TYP=0
ENDIF
ENDIF
ELSE
_RG[0]=ABS($TC_CARR10[_TC]) _RG[1]=ABS($TC_CARR11[_TC]) _RG[2]=ABS($TC_CARR12[_TC])
IF ((_RG[0]+_RG[1]+_RG[2])==0)
_RG[0]=ABS($TC_CARR7[_TC]) _RG[1]=ABS($TC_CARR8[_TC]) _RG[2]=ABS($TC_CARR9[_TC])
IF ($TC_CARR23[_TC]=="M")
_TC_TYP=0
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Behandlung Bit 2 - TCARR aktiv und PARTFRAME eingerichtet")
WRITE(_LOG,_LOG_FILE,"$P_TC        = "<<_TC)
WRITE(_LOG,_LOG_FILE,"Kinematiktyp = "<<$TC_CARR23[_TC])
WRITE(_LOG,_LOG_FILE,"  _TC_TYP    = "<<_TC_TYP)
WRITE(_LOG,_LOG_FILE,"Drehung aus $P_PARTFRAME = "<<_RG[3])
ENDIF
ELSE
_RG[3]=0 _TC_TYP=0
ENDIF
IF NOT(SUBSTR($P_PROG[$P_STACK-1],3,8)=="E_DR_BOR")
IF ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B10')
_POSS=(_POSS-$P_ACTFRAME[_Z,RT]+_RG[3]) MOD 360
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Behandlung Bit 1 - Drehung der Werkzeugebene bercksichtigen")
WRITE(_LOG,_LOG_FILE,"                   ! nur fr G-Code Programm")
WRITE(_LOG,_LOG_FILE,"Drehung aus $P_ACTFRAME = "<<$P_ACTFRAME[_Z,RT])
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"Behandlung Bit 1 - keine Drehung der Werkzeugebene bercksichtigen")
ENDIF
_POSS=(_POSS+_RG[3]) MOD 360
ENDIF
IF (_TC_TYP==1)
IF ((_G17_18_19==1) AND ((_RG[0]+_RG[1])==0)) OR ((_G17_18_19==2) AND ((_RG[0]+_RG[2])==0)) OR ((_G17_18_19==3) AND ((_RG[1]+_RG[2])==0))
_POSS=(_POSS-_RG[3]) MOD 360
ENDIF
ENDIF
IF _POSS<0
_POSS=(_POSS+360) MOD 360
ENDIF
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE86_MPF")
WRITE(_TEMP,_TEMP_FILE,"; SPOS:"<<_POSS<<" $P_ACTFRAME[_Z,RT]:"<<$P_ACTFRAME[_Z,RT]<<" $P_PARTFRAME[_Z,RT]:"<<_RG[3])
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,"_POSS_NEU letzt    = "<<_POSS<< " ;berechnete Spindelposition")
ENDIF
_NO_CORRECT_OTHER_BITS:
IF ((($P_ACTFRAME[_X,MI]==1) OR ($P_ACTFRAME[_Y,MI]==1)) AND (_POSS==POSS) AND ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B10000000'))
_II=0
IF $P_ACTFRAME[_X,MI]==1
_II=1
ENDIF
IF $P_ACTFRAME[_Y,MI]==1
_II=_II + 2
ENDIF
IF _II==1
RPA=-RPA
ENDIF
IF _II==2
RPO=-RPO
ENDIF
IF _II==3
RPA=-RPA RPO=-RPO
ENDIF
ENDIF
_NO_MIRROR:
N4 SPOS=_POSS
IF (_GMODE1==0)
IF(_UMODE)
N41 CUST_TECHCYC(_UMODE+1)
ENDIF
IF(ISAXIS(_ABS)==1) AND (ISAXIS(_ORD)==1) AND (ISAXIS(_APP)==1)
N5 G91 G0 AX[_X]=RPA AX[_Y]=RPO AX[_Z]=RPAP
ELSE
IF(ISAXIS(_ABS)==1) AND (ISAXIS(_APP)==1)
N51 G91 G0 AX[_X]=RPA AX[_Z]=RPAP
ELSE
IF(ISAXIS(_ORD)==1) AND (ISAXIS(_APP)==1)
N52 G91 G0 AX[_Y]=RPO AX[_Z]=RPAP
ELSE
GOTOF _FEHL2
ENDIF
ENDIF
ENDIF
ENDIF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
IF (_GMODE1==0)
N6 G90 G0 AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
ELSE
SBLON
N61 G90 G0 AX[_Z]=RTP
SBLOF
ENDIF
IF (_GMODE1==0)
IF(ISAXIS(_ABS)==1) AND (ISAXIS(_ORD)==1) AND (ISAXIS(_APP)==1)
SBLON
N7 G91 AX[_X]=-RPA AX[_Y]=-RPO AX[_Z]=RTP-(RFP+SDIS*(RFP-DP)/ABS(RFP-DP))
SBLOF
ELSE
IF(ISAXIS(_ABS)==1) AND (ISAXIS(_APP)==1)
SBLON
N71 G91 AX[_X]=-RPA AX[_Z]=RTP-(RFP+SDIS*(RFP-DP)/ABS(RFP-DP))
SBLOF
ELSE
SBLON
N72 G91 AX[_Y]=-RPO AX[_Z]=RTP-(RFP+SDIS*(RFP-DP)/ABS(RFP-DP))
SBLOF
ENDIF
ENDIF
ENDIF
_MM2:
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1:STOPRE
N708601 SETAL(61101)
RET
_FEHL2:STOPRE
N708602 SETAL(61005)
RET
_FEHL3:STOPRE
N708603 SETAL(61102)
RET
_FEHL4:
N708604 SETAL(62106)
RET
_FEHL5: STOPRE
N708605 SETAL(61019,"(_GMODE: dec1)")
RET
_FEHL6: STOPRE
N708606 SETAL(61212)
RET
_FEHL18: STOPRE
N708618 SETAL(61019,_SERR)
RET
_FEHL22: STOPRE
N708622 SETAL(61158)
RET
_FEHL23: STOPRE
N708623 SETAL(61159)
RET
_FEHL24: STOPRE
N708624 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL26: STOPRE
N708626 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL29: STOPRE
N708629 SETAL(61019,"(_AMODE: dec1/DP)")
RET
_FEHL30: STOPRE
N708630 SETAL(61019,"(_AMODE: dec1/DPR)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE861_SPF
PROC CYCLE861 (REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,INT SDIR,REAL RPA,REAL RPO,REAL RPAP,REAL POSS) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;ISO-M back boring
DEF AXIS _XX,_YY,_ZZ
DEF INT HH7
DEF REAL HH2
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE861_MPF",_SERR
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE861_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_AD[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_AD[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_AD[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_AD[15]<<"    ; Tool wear radius")
IF (($P_AD[1]>=200) AND ($P_AD[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_AD[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_AD[1]>=100) AND ($P_AD[1]<200))
IF ($P_AD[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_AD[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_AD[35]<<"    ; Number of teeth")
ENDIF
IF ($P_AD[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_AD[7]<<"   ; Outside radius ")
ENDIF
IF ($P_AD[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_AD[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE861("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<SDIR<<","<<RPA<<","<<RPO<<","<<RPAP<<","<<POSS<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (HH7==1) GOTOF _MM1B
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
_ZZ=$P_AXN3 _XX=$P_AXN1 _YY=$P_AXN2
IF (SDIR<>3)AND(SDIR<>4)AND(SDIR<>5) GOTOF _FEHL2
IF (ABS(DPR)==0) GOTOF _MM1
IF (RTP==RFP) GOTOF _FEHL1
HH2=RFP+((RTP-RFP)/ABS(RTP-RFP)*ABS(DPR))
IF (DP==0) GOTOF _MM0
IF (DP==HH2) GOTOF _MM1
_MM0:DP=HH2
_MM1:HH2=RTP-RFP
IF (RFP==DP) GOTOF _MM2
IF (HH2==0) GOTOF _MM1A
IF (HH2/ABS(HH2))==((RFP-DP)/ABS(RFP-DP)) GOTOF _FEHL1
_MM1A:HH7=1
_MM1B:
N1 G0 G64 G90 AX[_ZZ]=RTP
N2 SPOS=POSS
N3 G91 AX[_XX]=RPA AX[_YY]=RPO
N4 G90 AX[_ZZ]=RFP
N5 G91 AX[_XX]=-RPA AX[_YY]=-RPO
IF (SDIR<>5)
M=SDIR
ENDIF
N6 G1 G90 AX[_ZZ]=DP
N7 G4 F=DTB
N8 SPOS=POSS
N9 G0 G91 AX[_XX]=RPA AX[_YY]=RPO
N10 G90 AX[_ZZ]=RTP
N11 G91 AX[_XX]=-RPA AX[_YY]=-RPO
_MM2:
RET
_FEHL1: STOPRE
N386101 SETAL(61101)
RET
_FEHL2: STOPRE
N386102 SETAL(61102)
RET
_FEHL18: STOPRE
N386118 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE87_SPF
PROC CYCLE87(REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,INT SDIR) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Boring 3, with M5 M0 and dwell time at final drilling depth
DEF AXIS _Z
DEF INT HH7,_II,_ARTIS[16],_TEMP,_TYP
DEF REAL HH2
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE87_MPF",_SERR
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE87_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE87("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<SDIR<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ENDIF
ENDIF
_END_ARTIS_STAT:
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560))
GOTOF _FEHL4
ENDIF
ENDIF
ENDIF
IF HH7 GOTOF _MM1B
IF ($P_GG[6]==2) AND (ISAXIS(2)==FALSE)
GOTOF _FEHL5
ELSE
_Z=$P_AXN3
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF (SDIR==3) OR (SDIR==4) GOTOF _MM00
STOPRE
SETAL(61102)
RET
_MM00:IF DPR==0 GOTOF _MM1 IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP-RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
N1 _MM0:DP=HH2
_MM1:HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL3 IF HH2==0 GOTOF _MM1A IF HH2/ABS(HH2)<>(RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
_MM1A:HH7=1
_MM1B:M=SDIR
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
G0 G90 AX[_Z]=RFP+(RFP-DP)/ABS(RFP-DP)*SDIS
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N2 G1 AX[_Z]=DP
N3 M5 M0
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
SBLON
N4 G0 AX[_Z]=RTP
SBLOF
_MM2:
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1:STOPRE
N708701 SETAL(61101)
RET
_FEHL2:STOPRE
N708702 SETAL(62106)
RET
_FEHL3: STOPRE
N708703 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL4: STOPRE
N708704 SETAL(61212)
RET
_FEHL5: STOPRE
N708705 SETAL(61005)
RET
_FEHL18: STOPRE
N708718 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE88_SPF
PROC CYCLE88(REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB,INT SDIR) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Boring 4, with M5/M5M0 and dwell time at final drilling depth
DEF INT _GMODE,_DMODE,_AMODE
DEF AXIS _Z
DEF INT HH7,_II,_ARTIS[16],_TEMP,_ZZSD[15],_TYP,_PM1=-1,_GMODE2,_DMODE1,_AMODE1,_AMODE2
DEF REAL HH2,_FAK1=1,_HHA
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE88_MPF",_SERR
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
_GMODE=0 _DMODE=0 _AMODE=0
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE88_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[5]="<<_ZSD[5])
WRITE(_TEMP,_TEMP_FILE,"CYCLE88("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<","<<SDIR<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE37") OR (SUBSTR($P_PROG[$P_STACK-1],3,7)=="CYCLE38")
_ARTIS[0]=0
GOTOF _END_ARTIS_STAT
ENDIF
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ENDIF
ENDIF
_END_ARTIS_STAT:
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3)
GOTOF _FEHL5
ELSE
IF($P_MC)
IF(_DMODE1==0)OR($P_GG[6]==_DMODE1)
ELSE
GOTOF _FEHL6
ENDIF
ELSE
IF((_DMODE1>0)AND($P_GG[6]<>_DMODE1))
G[6]=_DMODE1
ENDIF
ENDIF
ENDIF
_AMODE1=(_AMODE _DEC1)
IF(_AMODE1<0)OR(_AMODE1>2) GOTOF _FEHL7
IF((_AMODE1==2) AND ($P_SUBPAR[4]==0)) GOTOF _FEHL9
IF((_AMODE1==1) AND ($P_SUBPAR[5]==0)) GOTOF _FEHL10
_AMODE2=(_AMODE _DEC2)
IF(_AMODE2<0)OR(_AMODE2>2) GOTOF _FEHL8
IF ((_AMODE2==2)AND(DTB>0))
DTB=-DTB
ENDIF
IF ((_AMODE2==1)AND(DTB<0))
DTB=ABS(DTB)
ENDIF
IF(_ZSD[5]<>-1)
_ZZSD[5]=_ZSD[5]
ENDIF
IF(_ZZSD[5]<0)OR(_ZZSD[5]>1) GOTOF _FEHL4
IF($P_GG[13]<3)
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ENDIF
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560)) GOTOF _FEHL14
ELSE
GOTOF _FEHL12
ENDIF
_GMODE2=(_GMODE _DEC2)
IF (_GMODE2<0) OR (_GMODE2>1) GOTOF _FEHL11
IF (_GMODE2==1)
IF ((DP<>0) AND (DPR==0))
_HHA=DP
ENDIF
IF ((DP==0) AND (DPR<>0))
_HHA=DPR _PM1=1
ENDIF
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL15
IF(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
IF ($P_ADT[24]>0)AND($P_ADT[24]<180)
_HHA=_HHA+$P_TOOLR*_FAK1/TAN($P_ADT[24]/2)*(_PM1)
ENDIF
IF ((DP<>0) AND (DPR==0))
DP=_HHA
ENDIF
IF ((DP==0) AND (DPR<>0))
DPR=_HHA
ENDIF
ENDIF
ENDIF
ENDIF
IF ($P_GG[6]==2) AND (ISAXIS(2)==FALSE)
GOTOF _FEHL16
ELSE
_Z=$P_AXN3
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF (SDIR<3)OR(SDIR>5) GOTOF _FEHL3
IF(((DPR==0)AND(_AMODE1==0))OR(_AMODE1==2)) GOTOF _MM1
IF RTP==RFP GOTOF _FEHL1
HH2=RFP-(RTP-RFP)/ABS(RTP-RFP)*DPR
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
N1 _MM0: DP=HH2
_MM1:HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL13
IF HH2==0 GOTOF _MM1A IF HH2/ABS(HH2) <> (RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
_MM1A:HH7=1
_MM1B:
IF (SDIR<>5)
M=SDIR
ENDIF
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
G0 G90 AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N2 G1 AX[_Z]=DP
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF(((DTB>=0)AND(_AMODE2==0))OR(_AMODE2==1))
N3 G4 F=DTB
ELSE
N3 G4 S=-DTB
ENDIF
_NACH_G4_DTB:
IF(_ZZSD[5]==0)
N4 M5 M0
ELSE
N4 M5
IF NOT $P_SEARCH
WHILE($AA_S[$P_MSNUM]>0)
ENDWHILE
G4 F0.1
ENDIF
ENDIF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
SBLON
N5 G0 AX[_Z]=RTP
SBLOF
_MM2:
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1:STOPRE
N708801 SETAL(61101)
RET
_FEHL2:STOPRE
N708802 SETAL(62106)
RET
_FEHL3:STOPRE
N708803 SETAL(61102)
RET
_FEHL4:STOPRE
N708804 SETAL(61019)
RET
_FEHL5: STOPRE
N708805 SETAL(61158)
RET
_FEHL6: STOPRE
N708806 SETAL(61159)
RET
_FEHL7:STOPRE
N708807 SETAL(61019,"(_AMODE: dec1)")
RET
_FEHL8: STOPRE
N708808 SETAL(61019,"(_AMODE: dec2)")
RET
_FEHL9: STOPRE
N708809 SETAL(61019,"(_AMODE: dec1/Z1)")
RET
_FEHL10: STOPRE
N708810 SETAL(61019,"(_AMODE: dec1/Z1)")
RET
_FEHL11: STOPRE
N708811 SETAL(61019,"(_GMODE: dec2)")
RET
_FEHL12: STOPRE
N708812 SETAL(61000)
RET
_FEHL13: STOPRE
N708813 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL14: STOPRE
N708814 SETAL(61212)
RET
_FEHL15: STOPRE
N708815 SETAL(61070)
RET
_FEHL16: STOPRE
N708816 SETAL(61005)
RET
_FEHL18: STOPRE
N708818 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE89_SPF
PROC CYCLE89(REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DTB) SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-03-28
;Cycle support HMIsl
;Boring 5, Retraction by G1
DEF AXIS _Z
DEF INT HH7,_II,_ARTIS[16],_TEMP,_TYP
DEF REAL HH2
DEF BOOL _MDG
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE89_MPF",_SERR
DEF INT _GGC[64],_GRUPPE[10]
DEF STRING[256] _GC
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE89_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; Tool wear radius")
IF (($P_ADT[1]>=200) AND ($P_ADT[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_ADT[1]>=100) AND ($P_ADT[1]<200))
IF ($P_ADT[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_ADT[35]<<"    ; Number of teeth")
ENDIF
IF ($P_ADT[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"   ; Outside radius ")
ENDIF
IF ($P_ADT[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE89("<<RTP<<","<<RFP<<","<<SDIS<<","<<DP<<","<<DPR<<","<<DTB<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
_GRUPPE[0]=SET(1,6,10,12,13,14,21,29,24,7)
FOR _II=0 TO 63
_GGC[_II]=$P_GG[_II+1]
ENDFOR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES1") OR (SUBSTR($P_PROG[$P_STACK-1],3,6)=="HOLES2") OR (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE801")
_ARTIS[15]=1
GOTOF _END_ARTIS_STAT
ENDIF
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL2
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL2
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL2
ENDIF
ENDIF
_END_ARTIS_STAT:
IF NOT((SUBSTR($P_PROG[$P_STACK-1],3,6)=="CYCLE3"))
IF($P_TOOL>0)
_TYP=$P_ADT[1]
IF(_TYP<100) OR ((_TYP>299) AND NOT (_TYP==560))
GOTOF _FEHL4
ENDIF
ENDIF
ENDIF
IF HH7 GOTOF _MM1B
IF ($P_GG[6]==2) AND (ISAXIS(2)==FALSE)
GOTOF _FEHL5
ELSE
_Z=$P_AXN3
ENDIF
DPR=ABS(DPR) SDIS=ABS(SDIS)
IF DPR==0 GOTOF _MM1 IF RTP==RFP GOTOF _FEHL1
HH2=RFP-((RTP - RFP)/ABS(RTP-RFP)*DPR)
IF DP==0 GOTOF _MM0 IF DP==HH2 GOTOF _MM1
_MDG=1
N1 _MM0:DP=HH2
_MM1:HH2=RTP-RFP
IF RFP==DP GOTOF _FEHL3 IF HH2==0 GOTOF _MM1A IF HH2/ABS(HH2)<>(RFP-DP)/ABS(RFP-DP) GOTOF _FEHL1
_MM1A:HH7=1
_MM1B:
SBLON
IF ($P_GG[10] < 2)
G[10]=2
ENDIF
G0 G90 AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
SBLOF
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[7])
ENDIF
N2 G1 AX[_Z]=DP
IF ABS(DTB)<0.0001 gotof _NACH_G4_DTB
IF(DTB>=0)
N3 G4 F=DTB
ELSE
N3 G4 S=-DTB
ENDIF
_NACH_G4_DTB:
IF ((_ARTIS[0]==11) OR((_ARTIS[15]==1)AND(_ARTISUP==1)))
M=QU(_ARTIS[8])
ENDIF
N4 AX[_Z]=RFP+SDIS*(RFP-DP)/ABS(RFP-DP)
SBLON
N5 G0 AX[_Z]=RTP
SBLOF
_MM2:
IF _MDG==1
MSG("")
ENDIF
SBLON
FOR _II=1 TO 8
_GC=_GC<<" G["<<_GRUPPE[_II-1]<<"]="<<_GGC[_GRUPPE[_II-1]-1]
ENDFOR
EXECSTRING(_GC)
_GC=""
RET
_FEHL1:STOPRE
N708901 SETAL(61101)
RET
_FEHL2:STOPRE
N708902 SETAL(62106)
RET
_FEHL3: STOPRE
N708903 SETAL(61019,"(_AMODE: dec1/DPR)")
RET
_FEHL4: STOPRE
N708904 SETAL(61212)
RET
_FEHL5: STOPRE
N708905 SETAL(61005)
RET
_FEHL18: STOPRE
N708918 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE899_SPF
PROC CYCLE899(REAL _RTP,REAL _RFP,REAL __SDIS,REAL __DP,REAL _LENG,REAL _WID,REAL __PA,REAL __PO,REAL __STA,REAL __MID,REAL __MIDA,REAL _FAL,REAL __FALD,REAL _FFP1,INT __CDIR,INT __VARI,INT _GMODE,INT _DMODE,INT _AMODE,INT _UMODE,REAL _FS,REAL __ZFS,REAL S_C3D) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Open slot
DEF AXIS _XX,_YY,_ZZ
DEF INT _AZ,_IZ,_IXY1,_IXY2,_IXY3,_VI[7],_GM[7],_DM[7],_AM[7],_ABE,_AKB,_SPG,_MIRR=0,_ERR,_UFNT,_RFZ,_DM0
DEF INT _VARI,_CDIR,_ZZSD[15],_TRAFO,_GG10,_ANFAS,S_WF=0
DEF REAL _XR,_YR,_ZR,_FAK1,_BRF,_UM,_DPI,_XD,_YD,_XK,_YK,_FAK2,_HH1
DEF REAL _SF1,_SF2,_WZR,_ZPBE,_SRSB=0,_BVP,_LENGGES,_BRI
DEF REAL _W_UMS,_W_K,_W_CC,_W_SK,_DIST_CC,_FF_X,_FF_Y,_ZRFP,_H1,_TOOLOFFN,_OFFN1
DEF REAL _PA,_PO,_DP,_MID,_MIDA,_FALD,_SDIS,_ZFS,_STA,_SDISX
DEF BOOL _FF_T,_WM
DEF STRING[30] _S_FFP1
DEF FRAME _RE_CYCFR,_FRAMEVAR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE899_MPF",_SERR,_PROG
CYCLE218(1)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_POCKET3_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_AD[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_AD[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_AD[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_AD[15]<<"    ; Tool wear radius")
IF (($P_AD[1]>=200) AND ($P_AD[1]<300))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_AD[24]<<"    ; Tool tip angle")
ENDIF
IF (($P_AD[1]>=100) AND ($P_AD[1]<200))
IF ($P_AD[1]<>145)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_AD[11]<<"    ; Tool angle")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";$TC_DPNT[1,1]="<<$P_AD[35]<<"    ; Number of teeth")
ENDIF
IF ($P_AD[1]==140)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_AD[7]<<"   ; Outside radius ")
ENDIF
IF ($P_AD[1]==240)
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_AD[9]<<"   ; Thread pitch")
ENDIF
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/... $P_F_TYPE="<<$P_F_TYPE)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
WRITE(_TEMP,_TEMP_FILE,"FZ="<<$P_FZ)
ELSE
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
ENDIF
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[1]="<<_ZSD[1]<<"  _ZSD[8]="<<_ZSD[8])
WRITE(_TEMP,_TEMP_FILE,"CYCLE899("<<_RTP<<","<<_RFP<<","<<__SDIS<<","<<__DP<<","<<_LENG<<","<<_WID<<","<<__PA<<","<<__PO<<","<<__STA<<","<<__MID<<","<<__MIDA<<","<<_FAL<<","<<__FALD<<","<<_FFP1<<","<<__CDIR<<","<<__VARI<<","<<_GMODE<<","<<_DMODE<<","<<_AMODE<<","<<_UMODE<<","<<_FS<<","<<__ZFS<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
DIAMCYCOF
_WM=FALSE
IF ($P_GG[30]>1)
COMPOF
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_PA=__PA
_PO=__PO
_DP=__DP
_MID=__MID
_MIDA=__MIDA
_FALD=__FALD
_CDIR=__CDIR
_SDIS=__SDIS
_VARI=__VARI
_SDIS=ABS(_SDIS) _LENG=ABS(_LENG) _WID=ABS(_WID)
_FAL=ABS(_FAL) _FALD=ABS(_FALD) _MID=ABS(_MID) _MIDA=ABS(_MIDA) _VARI=ABS(_VARI) _FFP1=ABS(_FFP1) _CDIR=ABS(_CDIR)
_ZFS=__ZFS _STA=__STA
_SRSB=0 _RFZ=1
IF (((_VARI _DEC1)==1) AND ((_VARI _DEC4)==1))
IF ($P_TRAFO B_AND 'H201')=='H201'
GOTOF _FEHL39
ENDIF
IF ($P_TRAFO B_AND 'H202')=='H202'
IF ($P_TRAFO_PAR[1]==1) GOTOF _FEHL40
ENDIF
ENDIF
_DM[0]=_DMODE _DEC1
_DM[4]=_DMODE _DEC5
IF (_DM[4]<0)OR(_DM[4]>1)
GOTOF _FEHL43
ENDIF
IF (_DM[4]==1)
IF ($P_MC)
GOTOF _FEHL43
ENDIF
_PROG=SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-7)
IF (_PROG <> "E_SL_OPN")
_SDIS=($SCS_EASY_SAFETY_CLEARANCE)*_FAK1
ENDIF
IF $MCS_DISP_PLANE_MILL<>0
_DM[0]=($MCS_DISP_PLANE_MILL-16)
_DM0=_DM[0]
G[6]=_DM0
ELSE
_DM[0]=0
ENDIF
_GM[3]=0
_STA=0
ENDIF
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
_S_FFP1="G95 F"<<_FFP1
ELSE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_S_FFP1="G95 FZ="<<_FFP1
ELSE
_S_FFP1="G94 F"<<_FFP1
ENDIF
ENDIF
EXECSTRING(_S_FFP1)
IF($P_MC)
_STA=_STA+_SC_WO
ENDIF
IF(_ZSD[1]==-1)
_ZZSD[1]=($SCS_FUNCTION_MASK_MILL_SET B_AND 'B100') DIV 4
ELSE
_ZZSD[1]=_ZSD[1]
IF(_ZZSD[1]<0)OR(_ZZSD[1]>1) GOTOF _FEHL9
ENDIF
IF(_GMODE _DEC3 == 0)
IF(_ZSD[8]==-1)
_ZZSD[8]=0
ELSE
_ZZSD[8]=_ZSD[8]
ENDIF
ELSE
_ZZSD[8]=_GMODE _DEC3 -1
ENDIF
IF(_ZZSD[8]<0)OR(_ZZSD[8]>1) GOTOF _FEHL25
IF (_VARI MOD 10 == 6)
_ANFAS=1
_OFFN1=$P_OFFN*_FAK2
_AM[2]=_AMODE _DEC3
IF((_AM[2]<0)OR(_AM[2]>1)) GOTOF _FEHL26
IF(_AM[2]==1)
_DP=_RFP-ABS(_ZFS)
_ZFS=ABS(_ZFS)
ELSE
_DP=_ZFS
_ZFS=ABS(_RFP-_ZFS) _AM[2]=1
ENDIF
IF(_ZZSD[1]==0)
_MID=_ZFS+_SDIS
ELSE
_MID=_ZFS
ENDIF
_MIDA=_FS _FALD=0 _FAL=_FS
IF(_ZZSD[8]==0)
CYCLE203(1,_FS,_ZFS)
ENDIF
_TOOLOFFN=$P_OFFN*_FAK2 _VARI=_VARI-2
ENDIF
_WZR=$P_TOOLR*_FAK1+_TOOLOFFN
_VI[0]=_VARI MOD 10
_VI[2]=(_VARI DIV 100) MOD 10
_VI[3]=(_VARI DIV 1000) MOD 10
IF((_VI[3]<1)OR(_VI[3]>2)) GOTOF _FEHL5
IF((_VI[2]<0)OR(_VI[2]>2)OR(_VI[2]==1)) GOTOF _FEHL5
IF((_VI[0]<1)OR(_VI[0]>6)) GOTOF _FEHL5
_AM[0]=_AMODE _DEC1
_AM[1]=_AMODE _DEC2
IF((_AM[1]<0)OR(_AM[1]>1)) GOTOF _FEHL4
IF((_AM[0]<0)OR(_AM[0]>1)) GOTOF _FEHL3
IF((_AM[2]<0)OR(_AM[2]>1)) GOTOF _FEHL26
_GM[2]=(_GMODE DIV 100) MOD 10
_GM[3]=(_GMODE DIV 1000) MOD 10
IF((_GM[3]<0)OR(_GM[3]>2)) GOTOF _FEHL10
IF((_GM[2]<0)OR(_GM[2]>2)) GOTOF _FEHL21
_DM[1]=_DMODE _DEC2
IF((_DM[0]<0)OR(_DM[0]>3)) GOTOF _FEHL11
IF(_VI[0]==1)
IF(_VI[3]==2)
IF(_WID-2*_FAL>4*_WZR)
GOTOF _FEHL1
ENDIF
ENDIF
IF(_VI[3]==1)
IF(_WID<((1.15*2*_WZR)+2*_FAL))
GOTOF _FEHL2
ENDIF
ENDIF
ELSE
IF((_WID<2*_WZR)AND(__VARI MOD 10 <> 6))
GOTOF _FEHL2
ENDIF
IF(_VI[0]==5)
IF(_WID-2*_FAL<2*_WZR)
GOTOF _FEHL2
ENDIF
ENDIF
ENDIF
IF(_VI[0]==1)OR(_VI[0]==2)OR(_VI[0]==3)
IF(_VI[0]==2)OR(_VI[0]==3)
IF((_AMODE _DEC4)==0)
_MIDA=100
_AM[1]=1
ENDIF
ENDIF
IF(_AM[1]==1)
IF((_MIDA<=0)OR(_MIDA>100)) GOTOF _FEHL8
_MIDA=_MIDA/100*(2*_WZR)
ELSE
IF((_MIDA>2*_WZR)OR(_MIDA<=0)) GOTOF _FEHL8
ENDIF
ELSE
_MIDA=100
_AM[1]=1
ENDIF
IF((_VI[3]==2)AND(_VI[0]==1))
IF((_WID-(_WZR*2+2*_FAL)) > (_WZR+SQRT( _WZR*_WZR-_MIDA*_MIDA/4)))
GOTOF _FEHL17
ENDIF
ENDIF
IF ((_VI[3]==2)AND(_VI[0]==1)AND((2*_WZR)>(_WID-2*_FAL))) GOTOF _FEHL2
IF ((_VI[3]==2)AND(_VI[0]==1)AND(_FALD>=ABS(_RFP-_DP))) GOTOF _FEHL19
IF((_VI[3]==1)AND((_CDIR<0)OR((_CDIR>1)AND(_CDIR<>4)))) GOTOF _FEHL12
IF(_MID<0) GOTOF _FEHL16
IF($P_MC)
IF((_DM[0]==0)OR((_DM[0]>0)AND($P_GG[6]==_DM[0])))
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
_PA=$P_EP[_XX]*_FAK1 _PO=$P_EP[_YY]*_FAK1
ELSE
IF(_DM[0]<>$P_GG[6]) GOTOF _FEHL13
ENDIF
ELSE
IF(_DM[0]<>0)
_ABE=_DM[0]
G[6]=_ABE
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL27
IF(_AM[0]==1)
_DPI=ABS(_DP)
IF(_RTP==_RFP) GOTOF _FEHL6
_UFNT=(_RTP-_RFP)/ABS(_RTP-_RFP)
IF(_DPI==0)
GOTOF _FEHL3
ELSE
_DP=_RFP-_DPI*_UFNT
ENDIF
ENDIF
IF NOT(_RTP==_RFP)
_RFZ=(_RTP-_RFP)/ABS(_RTP-_RFP)
ELSE
IF NOT(_RFP==_DP)
_RFZ=(_RFP-_DP)/ABS(_RFP-_DP)
ELSE
GOTOF _FEHL3
ENDIF
ENDIF
IF (_ANFAS==1) GOTOF _MAF1
IF(_FALD>ABS(_RFP-_DP))
IF(_ZZSD[1]==1)
_FALD=ABS(_RFP-_DP)
ELSE
_FALD=ABS(_RFP-_DP)+ABS(_SDIS)
ENDIF
ENDIF
IF ((_VI[0]==2) OR (_VI[0]==3))
IF(_MID>=ABS(_RFP-_DP))
IF(_ZZSD[1]==1)
_MID=ABS(_RFP-_DP)
ELSE
_MID=ABS(_RFP-_DP)+ABS(_SDIS)
ENDIF
ENDIF
ELSE
IF _MID>=ABS(_RFP-_DP)-ABS(_FALD)
IF _ZZSD[1]==1
_MID=ABS(_RFP-_DP)-ABS(_FALD)
ELSE
_MID=ABS(_RFP-_DP)+ABS(_SDIS)-ABS(_FALD)
ENDIF
ENDIF
ENDIF
_MAF1:
IF (_LENG<=0) GOTOF _FEHL14
IF(__SDIS<=0) GOTOF _FEHL15
IF((_VI[3]==1)AND(_VI[0]==1)AND(_WID/2-_FAL<_MIDA)) GOTOF _FEHL20
IF _VI[2]==2
_TRAFO=$P_TRAFO
IF ($P_TRAFO B_AND 'H1300')
GOTOF _FEHL5
ENDIF
SBLOF
N200 CUST_TECHCYC(_UMODE)
SBLON
ENDIF
_RE_CYCFR=$P_CYCFRAME
IF(_GM[3]==0)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_PA/_FAK1,_YY,_PO/_FAK1):CROT(_ZZ,_STA)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-(_LENG/2)/_FAK1)
ELSE
IF(_GM[3]==1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_PA/_FAK1,_YY,_PO/_FAK1):CROT(_ZZ,_STA)
ELSE
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_PA/_FAK1,_YY,_PO/_FAK1):CROT(_ZZ,_STA)
$P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,180)
ENDIF
ENDIF
IF $P_SMODE[0]==1
_H1=$P_SDIR[$P_MSNUM]
ENDIF
IF (_H1<3) OR (_H1>4) GOTOF _FEHL18
_MIRR=$P_ACTFRAME[_XX,MI]+$P_ACTFRAME[_YY,MI]
_MIRR=_MIRR+$P_ACTFRAME[_ZZ,MI]
IF (_RFZ==-1)
_MIRR=_MIRR+1
ENDIF
IF (_H1==4)
_MIRR=_MIRR+1
ENDIF
IF (_CDIR==4)
S_WF=_CDIR
ENDIF
IF (_MIRR MOD 2==1)
_CDIR=1-_CDIR
ENDIF
_SDISX=_SDIS
IF(($P_EP[_ZZ]*_FAK1)<(_RTP))
N10 G0 G90 AX[_ZZ]=_RTP
ENDIF
IF(_VI[0]==2)OR(_VI[0]==3)
_FALD=0
IF _ZZSD[1]==0
_SDIS=0
ENDIF
ENDIF
IF (_ANFAS==1) GOTOF _MAF2
IF(((_VI[3]==2)AND(_VI[0]==1))OR(_VI[0]==3))
_AZ=1
_ZPBE=(_RFP-(_DP+_FALD*_RFZ))/_AZ
ELSE
IF(_ZZSD[1]==0)
IF(_MID==0)
_MID=(_RFP+_SDIS*_RFZ)-(_DP+_FALD*_RFZ)
ENDIF
_AZ=ABS((((_RFP+_SDIS*_RFZ)-(_DP+_FALD*_RFZ))/_MID*_RFZ)+0.49999)
IF _AZ==0
GOTOF _FEHL9
ENDIF
_ZPBE=((_RFP+_SDIS*_RFZ)-(_DP+_FALD*_RFZ))/_AZ
ELSE
IF(_MID==0)
_MID=_RFP-(_DP+_FALD*_RFZ)
ENDIF
_AZ=ABS(((_RFP-(_DP+_FALD*_RFZ))/_MID*_RFZ)+0.49999)
IF _AZ==0
GOTOF _FEHL9
ENDIF
_ZPBE=(_RFP-(_DP+_FALD*_RFZ))/_AZ
ENDIF
ENDIF
_MAF2:
IF (_ANFAS==1)
_ZPBE=_MID _AZ=1
ENDIF
IF(_VI[0]==1)
IF(_VI[3]==1)
CFC
IF(S_WF==4)
REPEAT _SCHRUPPENWW_A _SCHRUPPENWW_E
ELSE
IF(_CDIR==0)
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
ENDIF
REPEAT _SCHRUPPEN_A _SCHRUPPEN_E
ENDIF
ELSE
IF(2*_WZR==_WID)
REPEAT _SCHRUPPENT1_A _SCHRUPPENT1_E
ELSE
REPEAT _SCHRUPPENT_A _SCHRUPPENT_E
ENDIF
ENDIF
ELSE
IF(_CDIR==1)
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
ENDIF
REPEAT S_SCHLICHTEN_UNIVERSAL_A S_SCHLICHTEN_UNIVERSAL_E
ENDIF
IF(_ZZSD[8]==1)
RET
ENDIF
SBLON
N20 G0 G90 AX[_ZZ]=_RTP
$P_CYCFRAME=_RE_CYCFR
IF (_TOOLOFFN<>0)
IF(_ZZSD[8]==0)
OFFN=_OFFN1
ENDIF
ENDIF
IF(($P_MC)AND(_SC_PC==1))
N21 G40 G90 AX[_XX]=_PA AX[_YY]=_PO
ENDIF
IF _VI[2]==2
SBLOF
N22 CUST_TECHCYC(_UMODE+1)
SBLON
ENDIF
RET
_SCHRUPPENWW_A:
IF (($P_ACTFRAME[_ZZ,MI]==1) and ($P_GG[22]<>2)) GOTOF _FEHL41
_BRF=((_WID-(2*_FAL))/2)
_LENGGES=_LENG+(_BRF)
_AKB=((_LENGGES/_MIDA)+0.49999)
_MIDA=_LENGGES/_AKB
_FRAMEVAR=$P_CYCFRAME
FOR _IZ=1 TO _AZ
_YR=0
_XR=-(2*_BRF)
IF(_ZZSD[8]==1)
_XR=_XR+_WZR
GOTOF _M_ST_POS
ENDIF
N30 G0 G40 AX[_XX]=_XR+_WZR AX[_YY]=_YR
N31 G0 G42 AX[_XX]=_XR AX[_YY]=_YR
IF (_ZZSD[1]==0)
_ZR=(_RFP+_SDIS*_RFZ)-(_IZ*_ZPBE)
ELSE
_ZR=_RFP-(_IZ*_ZPBE)
ENDIF
N40 G0 G90 AX[_ZZ]=_ZR
G91
G[10]=_GG10
N50 G2 AX[_XX]=2*_BRF AX[_YY]=0 IP[_XX]=_BRF IP[_YY]=0
N60 G2 AX[_XX]=-_BRF AX[_YY]=-_BRF IP[_XX]=-_BRF IP[_YY]=0
_XR=_MIDA
N70 G1 G41 AX[_XX]=_XR
FOR _IXY2=0 TO _AKB-1
N80 G3 AX[_XX]=0 AX[_YY]=2*_BRF IP[_XX]=0 IP[_YY]=_BRF
$P_CYCFRAME=$P_CYCFRAME:CMIRROR(_YY)
_XR=_MIDA
N90 G1 G41 AX[_XX]=_XR
ENDFOR
N100 G3 AX[_XX]=_BRF AX[_YY]=_BRF IP[_XX]=0 IP[_YY]=_BRF
G60
_XR=-_WZR _YR=0
N110 G0 G40 AX[_XX]=_XR AX[_YY]=_YR
_ZR=_SDIS*_RFZ
N120 G0 AX[_ZZ]=_ZR
G90
_FRAMEVAR=_FRAMEVAR:CTRANS(_XX,_LENG/_FAK1):CROT(_ZZ,180)
$P_CYCFRAME=_FRAMEVAR
ENDFOR
_SCHRUPPENWW_E:
_SCHRUPPEN_A:
IF (($P_ACTFRAME[_ZZ,MI]==1) and ($P_GG[22]<>2)) GOTOF _FEHL41
_HH1=2*(_WID-(2*_FAL)-(2*_WZR))
IF _HH1<_MIDA
_MIDA=_HH1
ENDIF
_BRF=((_WID-(2*_FAL))/2)
_SF2=1-(_MIDA/2)/(2*_BRF)
_LENGGES=_LENG+_BRF*_SF2+_MIDA/2
_AKB=((_LENGGES/_MIDA)+0.49999)
_MIDA=_LENGGES/_AKB
_SF1=1+(_MIDA/2)/(2*_BRF)
_SF2=1-(_MIDA/2)/(2*_BRF)
_FRAMEVAR=$P_CYCFRAME
FOR _IZ=1 TO _AZ
_XD=0 _YD=0 _XK=0 _YK=0
_YR=0
_XR=-(2*_BRF*_SF1)+_MIDA/2
IF(NOT _WM)
_XD=_BRF*_SF1-SQRT(POT(_BRF*_SF1-_WZR)-POT(_BRF*(_SF1-1)))-_WZR
_YD=_BRF*(_SF1-1)
_XR=_XR+_XD
_YK=_WZR*_BRF*(_SF1-1)/(_BRF*_SF1-_WZR)
_XK=_WZR-SQRT(POT(_WZR)-POT(_YK))
ENDIF
IF(_ZZSD[8]==1)
_XR=_XR+_WZR
GOTOF _M_ST_POS
ENDIF
N130 G0 G40 AX[_XX]=_XR+_WZR AX[_YY]=_YR
N131 G0 G42 AX[_XX]=_XR+_XK AX[_YY]=_YR+_YK
IF (_ZZSD[1]==0)
_ZR=(_RFP+_SDIS*_RFZ)-(_IZ*_ZPBE)
ELSE
_ZR=_RFP-(_IZ*_ZPBE)
ENDIF
N140 G0 G90 AX[_ZZ]=_ZR
G91
G[10]=_GG10
FOR _IXY2=0 TO _AKB-1
IF(_WM)
$P_CYCFRAME=_FRAMEVAR:CSCALE(_XX,_SF1)
N150 G2 AX[_XX]=(_WID-(2*_FAL)) AX[_YY]=0 IP[_XX]=_BRF IP[_YY]=0
$P_CYCFRAME=_FRAMEVAR:CSCALE(_XX,_SF2)
N160 G2 AX[_XX]=-(_WID-(2*_FAL)) AX[_YY]=0 IP[_XX]=-(_BRF) IP[_YY]=0
ELSE
IF(_IXY2==0)
N151 G2 AX[_XX]=2*_BRF*_SF1-(_XD+_XK) AX[_YY]=-(_YD+_YK) IP[_XX]=_BRF*_SF1-(_XD+_XK) IP[_YY]=-(_YD+_YK)
ELSE
N152 G2 AX[_XX]=2*_BRF*_SF1 AX[_YY]=0 IP[_XX]=_BRF*_SF1 IP[_YY]=0
ENDIF
N161 G2 AX[_XX]=-2*_BRF*_SF2 AX[_YY]=0 IP[_XX]=-_BRF*_SF2 IP[_YY]=0
ENDIF
ENDFOR
IF(_WM)
$P_CYCFRAME=_FRAMEVAR:CSCALE(_XX,_SF1)
N170 G2 AX[_XX]=(_WID-(2*_FAL)) AX[_YY]=0 IP[_XX]=_BRF IP[_YY]=0
ELSE
N171 G2 AX[_XX]=2*_BRF*_SF1-(_XD+_XK) AX[_YY]=_BRF*(_SF1-1)+_YK IP[_XX]=_BRF*_SF1 IP[_YY]=0
ENDIF
G60
_XR=-_WZR+_XK _YR=-_YK
N180 G0 G40 AX[_XX]=_XR AX[_YY]=_YR
_ZR=_SDIS*_RFZ
N190 G0 AX[_ZZ]=_ZR
G90
_FRAMEVAR=_FRAMEVAR:CTRANS(_XX,_LENG/_FAK1):CROT(_ZZ,180)
$P_CYCFRAME=_FRAMEVAR
ENDFOR
_SCHRUPPEN_E:
_SCHLICHTENB_A:
_YR=-_WID/2+(_WZR+_FAL)
_XR=-(_WZR+_SDISX)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N200 G0 AX[_XX]=_XR AX[_YY]=_YR
_ZR=_DP
N210 G0 AX[_ZZ]=_ZR
_XR=_LENG+_WZR+_SDISX
N220 G1 AX[_XX]=_XR
IF (_WID>(2*_WZR+2*_FAL))
_YR=_WID/2-(_WZR+_FAL)
N230 G0 AX[_YY]=_YR
_XR=-(_WZR+_SDISX)
N240 G1 AX[_XX]=_XR
ENDIF
_SCHLICHTENB_E:
_SCHLICHTEN_A:
IF(_WID==2*_WZR) OR ((_VI[0]==5) AND (_WID==2*_WZR+2*_FAL))
_FRAMEVAR=$P_CYCFRAME
_YR=0
_XR=-(_WZR+_SDISX)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N250 G0 AX[_XX]=_XR AX[_YY]=_YR
FOR _IZ=1 TO _AZ
IF (_ZZSD[1]==0)
_ZR=(_RFP+_SDIS*_RFZ)-(_IZ*_ZPBE)
ELSE
_ZR=_RFP-(_IZ*_ZPBE)
ENDIF
N260 G0 AX[_ZZ]=_ZR
_XR=_LENG+_WZR+_SDISX
N270 G1 AX[_XX]=_XR
_FRAMEVAR=_FRAMEVAR:CTRANS(_XX,_LENG/_FAK1):CROT(_ZZ,180)
$P_CYCFRAME=_FRAMEVAR
ENDFOR
ELSE
_YR=-_WID/2+(_WZR)
_XR=-(_WZR+_SDISX)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N280 G0 AX[_XX]=_XR AX[_YY]=_YR
FOR _IZ=1 TO _AZ
IF (_ZZSD[1]==0)
_ZR=(_RFP+_SDIS*_RFZ)-(_IZ*_ZPBE)
ELSE
_ZR=_RFP-(_IZ*_ZPBE)
ENDIF
N290 G0 AX[_ZZ]=_ZR
_XR=_LENG+_WZR+_SDISX
N300 G1 AX[_XX]=_XR
_YR=+_WID/2-(_WZR)
N310 G0 AX[_YY]=_YR
_XR=-(_WZR+_SDISX)
N320 G1 AX[_XX]=_XR
_YR=-_WID/2+(_WZR)
N330 G0 AX[_YY]=_YR
ENDFOR
ENDIF
_SCHLICHTEN_E:
_VORSCHL_A:
_YR=-_WID/2+(_WZR+_FAL)
_XR=-(_WZR+_SDISX)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N340 G0 AX[_XX]=_XR AX[_YY]=_YR
FOR _IZ=1 TO _AZ
IF (_ZZSD[1]==0)
_ZR=(_RFP+_SDIS*_RFZ)-(_IZ*_ZPBE)
ELSE
_ZR=_RFP-(_IZ*_ZPBE)
ENDIF
N350 G0 AX[_ZZ]=_ZR
_XR=_LENG+_WZR+_SDISX
N360 G1 AX[_XX]=_XR
_YR=_WID/2-(_WZR+_FAL)
N370 G0 AX[_YY]=_YR
_XR=-(_WZR+_SDISX)
N380 G1 AX[_XX]=_XR
_YR=-_WID/2+(_WZR+_FAL)
N390 G0 AX[_YY]=_YR
ENDFOR
_VORSCHL_E:
S_SCHLICHTEN_UNIVERSAL_A:
IF(_VI[0]==2)OR(_VI[0]==4)
_FAL=0
ENDIF
_YR=-_WID/2+(_WZR+_FAL)
_XR=-(_WZR+_SDISX)
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
IF(_MIDA>0)
_IXY2=ROUNDUP(1+(_WID-2*_FAL-2*_WZR)/_MIDA)
ELSE
_IXY2=2
ENDIF
;msg("ROUNDUP: _IXY2="<<_IXY2<<" = 1 + B="<<_WID-2*_FAL<<" - T="<<2*_WZR<<" / _MIDA="<<_MIDA<<")")
;M0
IF(_IXY2>1)
IF(_VI[0]==4)OR(_VI[0]==5)
_IXY2=2
_BRI=2*_WZR
ELSE
_BRI=(_WID-2*_FAL-2*_WZR)/(_IXY2-1)
ENDIF
ENDIF
;IF((_WID-2*_FAL)>4*_WZR)
;ENDIF
IF (_ZZSD[1]==0)
_ZR=(_RFP+_SDIS*_RFZ)
ELSE
_ZR=_RFP
ENDIF
;msg("neu: B="<<_WID-2*_FAL<<" T="<<2*_WZR<<" n="<<_IXY2<<" dxy="<<_BRI<<" ("<<_MIDA<<")")
;M0
_FRAMEVAR=$P_CYCFRAME
FOR _IZ=1 TO _AZ
_YR=-_WID/2+(_WZR+_FAL)
_XR=-(_WZR+_SDISX)
N391 G0 AX[_XX]=_XR AX[_YY]=_YR
_ZR=_ZR-_ZPBE
N392 G0 AX[_ZZ]=_ZR
_XR=_LENG+_WZR+_SDISX
IF(_IXY2>2)AND(_IZ<>_AZ)
_IXY3=2
ELSE
_IXY3=_IXY2
ENDIF
FOR _IXY1=1 TO _IXY3
N393 G1 AX[_XX]=_XR
IF((_IXY1 B_AND 1)==0)
_YR=_YR+_BRI
ENDIF
_FRAMEVAR=_FRAMEVAR:CTRANS(_XX,_LENG/_FAK1):CROT(_ZZ,180)
$P_CYCFRAME=_FRAMEVAR
IF(_IXY1<>_IXY3)
N394 G0 AX[_YY]=_YR
ENDIF
ENDFOR
ENDFOR
;MSG("Schleife fertig")
;M0
;msg()
S_SCHLICHTEN_UNIVERSAL_E:
_SCHRUPPENT1_A:
_SPG=((_LENG+_SDISX+_WZR)/_MIDA+0.49999)
_MIDA=(_LENG+_SDISX+_WZR)/_SPG
_SPG= _SPG-1
_YR=0
_XR=-_SDISX+_MIDA/2-_WZR
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N400 G0 AX[_XX]=_XR AX[_YY]=_YR
_ZR=_RFP+_SDIS*_RFZ
N410 G0 AX[_ZZ]=_ZR
FOR _IXY1=0 TO _SPG
_YR=0
_XR=-_SDISX-_WZR+_MIDA/2+_IXY1*_MIDA
G90
N420 G0 AX[_XX]=_XR AX[_YY]=_YR
N430 G1 AX[_ZZ]=(_RFP-_ZPBE)
G90
N440 G0 AX[_ZZ]=_ZR
ENDFOR
_SCHRUPPENT1_E:
_SCHRUPPENT_A:
_BRF=((_WID-(_WZR*2+2*_FAL))/2)
_DIST_CC=2*_BRF
_W_CC=90+ASIN(_MIDA/SQRT(4*_DIST_CC*_DIST_CC+_MIDA*_MIDA))
_W_SK=ACOS(SQRT((_MIDA*_MIDA/4)+(_DIST_CC*_DIST_CC))/(2*_WZR))
_W_K=90+ASIN(_MIDA/_WZR/2)
_W_UMS=_W_K+(_W_CC-_W_SK)
IF (_W_UMS < 180)
_FF_T=1
_FF_X=_SDISX*COS(_W_K-_W_UMS/2)
_FF_Y=_SDISX*SIN(_W_K-_W_UMS/2)
IF (ABS(_FF_Y)>_BRF)
_FF_X=_FF_X*_BRF/ABS(_FF_Y)
_FF_Y=_BRF
ENDIF
ELSE
_FF_T = 0
_FF_X = 0
_FF_Y = 0
ENDIF
_SPG=((_LENG+_SDISX+_WZR)/_MIDA +0.49999)
_MIDA=(_LENG+_SDISX+_WZR)/_SPG
_SPG=_SPG-1
G60
_YR=_BRF
_XR=-_SDISX+_MIDA/2-_WZR
IF(_ZZSD[8]==1) GOTOF _M_ST_POS
N450 G0 AX[_XX]=_XR AX[_YY]=_YR
_ZR=_RFP-_ZPBE
_ZRFP=_RFP+_SDIS*_RFZ
N460 G0 AX[_ZZ]=_ZRFP
FOR _IXY1=0 TO _SPG
_YR=_BRF
_XR=-_SDISX-_WZR+_MIDA/2+_IXY1*_MIDA
G90
N470 G0 AX[_XX]=_XR AX[_YY]=_YR
N480 G1 AX[_ZZ]=_ZR
G91
N490 G1 AX[_XX]=-_FF_X AX[_YY]=-_FF_Y AX[_ZZ]=SQRT(_FF_X*_FF_X+_FF_Y*_FF_Y)*_RFZ
G90
N500 G0 AX[_ZZ]=_ZRFP
_YR=-_BRF
_XR=-_SDISX-_WZR+_MIDA+_IXY1*_MIDA
N510 G0 AX[_XX]=_XR AX[_YY]=_YR
N520 G1 AX[_ZZ]=_ZR
G91
N530 G1 AX[_XX]=-_FF_X AX[_YY]=_FF_Y AX[_ZZ]=SQRT(_FF_X*_FF_X+_FF_Y*_FF_Y)*_RFZ
G90
N540 G0 AX[_ZZ]=_ZRFP
ENDFOR
_SCHRUPPENT_E:
_M_ST_POS:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AA_MEAS_POINT1[_XX]=_XR
$AA_MEAS_POINT1[_YY]=_YR
$AA_MEAS_POINT1[_ZZ]=_RFP+_SDIS*_RFZ
_ERR=MEASURE()
_SC_POS[3]=SQRT(ABS(POT($AA_MEAS_POINT2[_XX])+POT($AA_MEAS_POINT2[_YY])))
$P_CYCFRAME=INVFRAME(_RE_CYCFR):$P_CYCFRAME:CTRANS(_XX,_XR,_YY,_YR,_ZZ,_RFP+_SDIS*_RFZ)
_SC_POS[0]=$P_CYCFRAME[_XX,TR]
_SC_POS[1]=$P_CYCFRAME[_YY,TR]
_SC_POS[2]=$P_CYCFRAME[_ZZ,TR]
$P_CYCFRAME=_RE_CYCFR
RET
_FEHL1:STOPRE
N789901 SETAL(61007)
RET
_FEHL2:STOPRE
N789902 SETAL(61006)
RET
_FEHL3:STOPRE
N789903 SETAL(61154)
RET
_FEHL4:STOPRE
N789904 SETAL(61155)
RET
_FEHL5:STOPRE
N789905 SETAL(61002)
RET
_FEHL6:STOPRE
N789906 SETAL(61101)
RET
_FEHL8:STOPRE
N789908 SETAL(61019,"MIDA")
RET
_FEHL9:STOPRE
N789909 SETAL(61156)
RET
_FEHL10:STOPRE
N789910 SETAL(61157)
RET
_FEHL11:STOPRE
N789911 SETAL(61158)
RET
_FEHL12:STOPRE
N789912 SETAL(61109)
RET
_FEHL13:STOPRE
N789913 SETAL(61159)
RET
_FEHL14:STOPRE
N789914 SETAL(61019,"LENG")
RET
_FEHL15:STOPRE
N789915 SETAL(61019,"SDIS")
RET
_FEHL16:STOPRE
N789916 SETAL(61019,"MID")
RET
_FEHL17:STOPRE
N789917 SETAL(61160)
RET
_FEHL18:STOPRE
N789918 SETAL(61102)
RET
_FEHL19:STOPRE
N789919 SETAL(61010)
RET
_FEHL20:STOPRE
N789920 SETAL(61163)
RET
_FEHL21: STOPRE
N789921 SETAL(61019,"(_GMODE: dec3)")
RET
_FEHL25: STOPRE
N789925 SETAL(61019,"(_GMODE: dec3)")
RET
_FEHL26: STOPRE
N789926 SETAL(61019,"(_AMODE: dec3)")
RET
_FEHL27: STOPRE
N789927 SETAL(61012)
RET
_FEHL39: STOPRE
N789939 SETAL(61026,"TRACYL (TRAFO_TYPE=513)")
RET
_FEHL40: STOPRE
N789940 SETAL(61026,"TRACYL (TRAFO_TYPE=514 MODE=1)")
RET
_FEHL41: STOPRE
N789941 SETAL(61801,"(_MIRR Z and CUT2DF)")
RET
_FEHL42: STOPRE
N789942 SETAL(61027,"CUST_TECHCYC")
RET
_FEHL43: STOPRE
N789943 SETAL(61019,"(_DMODE: dec5)")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE90_SPF
PROC CYCLE90(REAL RTP,REAL RFP,REAL SDIS,REAL DP,REAL DPR,REAL DIATH,REAL KDIAM,REAL PIT,REAL FFR,INT CDIR,INT TYPTH,REAL CPA,REAL CPO) SAVE SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Thread milling
DEF AXIS _X,_Y,_Z
DEF REAL WR,ARAD,XWEG,YWEG,RDIF,HRD,HH1,HH2,HH3,HH4,HH5,HH50,HH6,_FAK1,HRDI,_EPS=0.002
DEF INT DNUM,ANZG,RFAK,_GG10
DEF INT _MIRR=0
DEF INT _II,_TYPTH_I,_ZZSD[15]
DEF INT _ARTIS[16]
DEF STRING[35] _SERR
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
IF (DPR==0)
IF NOT($P_SUBPAR[4])
_SERR=<<"(DP,DPR)"
GOTOF _FEHL18
ENDIF
ENDIF
DIAMCYCOF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
IF (_ZSD[10]<>-1)
_ZZSD[10]=_ZSD[10]
ENDIF
IF (_ZSD[12]<>-1)
_ZZSD[12]=_ZSD[12]
ENDIF
_TYPTH_I=TYPTH
IF (TYPTH==1) AND (_ZZSD[12]==1)
_TYPTH_I=2
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL5
ENDIF
_II=_ARTIS[0] DIV 10
IF ((_II MOD 10 > 3) OR (_II MOD 10 < 1))
GOTOF _FEHL5
ENDIF
_II=_II DIV 10
IF ((_II MOD 10 > 2) OR (_II MOD 10 < 0))
GOTOF _FEHL5
ENDIF
_ARTIS[0]=_ARTIS[0] MOD 100
ENDIF
_X=$P_AXN1 _Y=$P_AXN2 _Z=$P_AXN3 DNUM=$P_TOOL WR=$P_TOOLR DPR=ABS(DPR) SDIS=ABS(SDIS)
IF ((DNUM==0)OR(WR==0)) GOTOF FEHL1
_MIRR=$P_ACTFRAME[_X,MI]+$P_ACTFRAME[_Y,MI]
IF _MIRR==1
IF CDIR==2
CDIR=CDIR+1
ELSE
CDIR=CDIR-1
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
WR=WR*_FAK1
IF ((WR>=KDIAM/2) AND (_TYPTH_I==0)) GOTOF FEHL2
IF(WR<0)GOTOF FEHL4
IF DPR==0 GOTOF _MB1 IF RTP==RFP GOTOF FEHL3
RFAK=(RTP-RFP)/ABS(RTP-RFP) HH2=RFP-RFAK*DPR
IF DP==0 GOTOF _MMA1
IF ABS(DP-HH2)<_EPS GOTOF _MB1
_MMA1:DP=HH2
_MB1:HH2=RTP-RFP
IF RFP==DP GOTOF _MX8
RFAK=(RFP-DP)/ABS(RFP-DP)
IF ABS(HH2)<_EPS GOTOF _MD1
_MD1:
IF (_TYPTH_I==1)
ARAD=ABS(DIATH)/2
ELSE
ARAD=ABS(KDIAM)/2
ENDIF
SDIS=SDIS*RFAK HH1=ABS(RFP+SDIS-DP) ANZG=TRUNC(HH1/PIT) HH2=ANZG*PIT
IF ABS(HH2-HH1)<_EPS GOTOF _MH1
ANZG=ANZG+1 SDIS=SDIS+(PIT*ANZG-HH1)*RFAK
_MH1:
RDIF=ARAD+WR
IF (_TYPTH_I<>0) GOTOF _MJ1
RDIF=ARAD-WR
_MJ1:
IF (_TYPTH_I==0)
HH3=ABS(DIATH/2-WR)/ABS(DIATH/2)*FFR
ELSE
IF (_TYPTH_I==1)
HH3=ABS(DIATH/2+WR)/ABS(DIATH/2)*FFR
ELSE
HH3=ABS(KDIAM/2+WR)/ABS(KDIAM/2)*FFR
ENDIF
ENDIF
HRD=RDIF/2 HH4=PIT/4*(WR+HRD)/ARAD HH5=CPA+RDIF XWEG=HH5-HRD
IF (_TYPTH_I==0)
HRDI=(RDIF/2+(DIATH-KDIAM)/2)/2
HH4=PIT/2*(WR+(DIATH/2))/DIATH
HH5=CPA+RDIF
XWEG=HH5-RDIF/2
IF(WR>=0.667*(DIATH/2))
HRDI=(2*RDIF+(DIATH-KDIAM)/2)/2
HH4=PIT/2*KDIAM/DIATH
XWEG=CPA-RDIF
ENDIF
HH50=HH5+(DIATH-KDIAM)/2
YWEG=0
RDIF=DIATH/2-WR
ENDIF
HH6=DP-HH4*RFAK
IF (CDIR==2)OR(CDIR==3) GOTOF _ML1
CDIR=3
_ML1:IF CDIR==2 GOTOF _MN1
HRD=-HRD
_MN1:RDIF=-RDIF YWEG=CPO+HRD
IF (_TYPTH_I==0)
IF CDIR==2 GOTOF _ML10
HRDI=-HRDI
_ML10:
YWEG=CPO
ENDIF
IF (_TYPTH_I<>0) GOTOF _MA3
SBLON
N2 G0 G90 G60 G40 AX[_X]=CPA AX[_Y]=CPO
IF ABS($P_EP[_Z]*_FAK1-RTP)>ABS($P_EP[_Z]*_FAK1-RFP+SDIS) GOTOF _MY20
N20 AX[_Z]=RTP
N21 _MY20:G0 AX[_Z]=RFP+SDIS+RFAK*HH4
SBLOF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
N22 G1 G[10]=_GG10 F=HH3 AX[_X]=XWEG AX[_Y]=YWEG
IF CDIR==2
IF _ZZSD[10]==1
N230 G2 F=FFR AX[_X]=HH50 AX[_Y]=CPO AX[_Z]=RFP+SDIS CR=ABS(HRDI)
ELSE
N231 G2 F=HH3 AX[_X]=HH50 AX[_Y]=CPO AX[_Z]=RFP+SDIS CR=ABS(HRDI)
ENDIF
ELSE
IF _ZZSD[10]==1
N232 G3 F=FFR AX[_X]=HH50 AX[_Y]=CPO AX[_Z]=RFP+SDIS CR=ABS(HRDI)
ELSE
N233 G3 F=HH3 AX[_X]=HH50 AX[_Y]=CPO AX[_Z]=RFP+SDIS CR=ABS(HRDI)
ENDIF
ENDIF
_MB2:IF ANZG<1 GOTOF _MD2
N24 AX[_X]=HH50 AX[_Y]=CPO AX[_Z]=DP IP[_X]=RDIF IP[_Y]=0 TURN=ANZG-1
_MD2:
N25 AX[_X]=XWEG AX[_Y]=CPO AX[_Z]=HH6 CR=ABS(HRDI)
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
SBLON
N26 G0 G60 AX[_X]=CPA AX[_Y]=CPO
N27 AX[_Z]=RTP
RET
_MA3:HH2=ABS(HRD) HH1=HH5+HH2
SBLON
N3 G0 G90 G60 G40 AX[_X]=HH1 AX[_Y]=CPO+HRD
IF ABS($P_EP[_Z]*_FAK1-RTP)>ABS($P_EP[_Z]*_FAK1-RFP+SDIS) GOTOF _MY30
N30 AX[_Z]=RTP
N31 _MY30:G0 AX[_Z]=RFP+SDIS+RFAK*HH4
SBLOF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
IF ANZG<1 GOTOF _MD3
IF CDIR==2
N33 G3 G[10]=_GG10 F=HH3 AX[_X]=HH5 AX[_Y]=CPO AX[_Z]=RFP+SDIS CR=HH2
IF _ZZSD[10]==1
N340 G2 F=FFR AX[_X]=HH5 AX[_Y]=CPO AX[_Z]=DP IP[_X]=RDIF IP[_Y]=0 TURN=ANZG-1
ELSE
N341 G2 F=HH3 AX[_X]=HH5 AX[_Y]=CPO AX[_Z]=DP IP[_X]=RDIF IP[_Y]=0 TURN=ANZG-1
ENDIF
SBLON
N35 G3 G60 F=HH3 AX[_X]=HH1 AX[_Y]=CPO+HRD CR=HH2
ELSE
N33 G2 G[10]=_GG10 F=HH3 AX[_X]=HH5 AX[_Y]=CPO AX[_Z]=RFP+SDIS CR=HH2
IF _ZZSD[10]==1
N342 G3 F=FFR AX[_X]=HH5 AX[_Y]=CPO AX[_Z]=DP IP[_X]=RDIF IP[_Y]=0 TURN=ANZG-1
ELSE
N343 G3 F=HH3 AX[_X]=HH5 AX[_Y]=CPO AX[_Z]=DP IP[_X]=RDIF IP[_Y]=0 TURN=ANZG-1
ENDIF
SBLON
N35 G2 G60 F=HH3 AX[_X]=HH1 AX[_Y]=CPO+HRD CR=HH2
ENDIF
_MD3:
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
N37 G0 AX[_Z]=RTP
N38 _MX8:
_MX9:RET
FEHL1:STOPRE
SETAL(61000)
RET
FEHL2:STOPRE
SETAL(61105)
RET
FEHL3:STOPRE
SETAL(61101)
RET
FEHL4:STOPRE
SETAL(61112)
RET
_FEHL5:STOPRE
SETAL(62106)
RET
_FEHL18: STOPRE
N709018 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE92_SPF
PROC CYCLE92(REAL __SPD,REAL _SPL,REAL __DIAG1,REAL __DIAG2,REAL __RC,REAL _SDIS,REAL _SV1,REAL _SV2,INT _SDAC,REAL _FF1,REAL _FF2,REAL _SS2,REAL __DIAGM,INT _VARI,INT _DN,INT _DMODE,INT _AMODE) SAVE SBLOF DISPLOF ;ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-02-08
;Cycle support HMIsl
;Part off cycle
DEF AXIS _XX,_ZZ
DEF REAL _FAK1,_OFFZ,_WR,_WB,_ZB,_DZ,_SR,_RX,_RZ,_FV,_FW,_SPD,_DIAG1,_DIAG2,_DIAGM,_RC,_L[5]
DEF INT _G60_64,_GG10,_I,_N,_TYP,_SL,_DMODE1,_TEMP,_H_AMODE[5],_DD[2],_DN1,_II=2,_PLAN=1,_ZAF=1,_XAF=1,_ARTIS[16],_H_VARI[2],_DL_NUM,_GG15
DEF INT _SLT[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,2,1,4,3,7,6,5,8,9)
DEF INT _SLX[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,4,3,2,1,5,8,7,6,9)
DEF BOOL _PART_EN
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE92_MPF",_SERR
DEF STRING[40] _LOG_FILE
DEF INT _LOG,_LOG_ON=0
CYCLE218(11)
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE92_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"CYCLE92("<<__SPD<<","<<_SPL<<","<<__DIAG1<<","<<__DIAG2<<","<<__RC<<","<<_SDIS<<","<<_SV1<<","<<_SV2<<","<<_SDAC<<","<<_FF1<<","<<_FF2<<","<<_SS2<<","<<__DIAGM<<","<<_VARI<<","<<_DN<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE92_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
; DELETE(_LOG,_LOG_FILE)
FILESIZE(_LOG,_LOG_FILE,_I)
IF(_I>10000)
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE92: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"-----------------------------------")
ENDIF
WORKPIECE(,,,"SHOW_PARTOF",1)
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL9
ENDIF
_I=_ARTIS[0] DIV 10
IF ((_I MOD 10 > 3) OR (_I MOD 10 < 1))
GOTOF _FEHL9
ELSE
_ARTIS[11]=_I MOD 10
ENDIF
_I=_I DIV 10
IF ((_I MOD 10 > 2) OR (_I MOD 10 < 0))
GOTOF _FEHL9
ELSE
_ARTIS[12]=_I MOD 10
ENDIF
ENDIF
_END_ARTIS_STAT:
_H_AMODE[0]=(_AMODE _DEC1) _H_AMODE[1]=(_AMODE _DEC2) _H_AMODE[3]=(_AMODE _DEC4) _H_AMODE[4]=(_AMODE _DEC5)
IF ( (_H_AMODE[0]<0)OR(_H_AMODE[0]>1) )
_SERR=<<"(_AMODE: dec1)"
GOTOF _FEHL7
ENDIF
IF ( (_H_AMODE[1]<0)OR(_H_AMODE[1]>1) )
_SERR=<<"(_AMODE: dec2)"
GOTOF _FEHL7
ENDIF
IF ( (_H_AMODE[3]<0)OR(_H_AMODE[3]>1) )
_SERR=<<"(_AMODE: dec4)"
GOTOF _FEHL7
ENDIF
IF ( (_H_AMODE[4]<0)OR(_H_AMODE[4]>1) )
_SERR=<<"(_AMODE: dec5)"
GOTOF _FEHL7
ENDIF
IF ( __RC<0 )
_SERR=<<"(R, FS)"
GOTOF _FEHL7
ENDIF
_H_VARI[0]=(_VARI _DEC1) _H_VARI[1]=(_VARI _DEC2)
IF ( (_H_VARI[0]<0)OR(_H_VARI[0]>1) )
_SERR=<<"(_VARI: dec1)"
GOTOF _FEHL7
ENDIF
IF ( (_H_VARI[1]<0)OR(_H_VARI[1]>1) )
_SERR=<<"(_VARI: dec2)"
GOTOF _FEHL7
ENDIF
IF (_H_AMODE[0]==0)
_DIAG1=__DIAG1
ELSE
_DIAG1=__SPD+(2*__DIAG1)
ENDIF
IF (_H_AMODE[1]==0)
_DIAG2=__DIAG2
ELSE
_DIAG2=_DIAG1+(2*__DIAG2)
ENDIF
IF (_H_AMODE[3]==0)
_RC=__RC
ELSE
_RC=(-1)*__RC
ENDIF
IF (_H_AMODE[4]==0)
IF ( (_SDAC<>3)AND(_SDAC<>4) )
GOTOF _FEHL10
ENDIF
S=_SV1 M=_SDAC G972
ELSE
G962 S=_SV1 M=_SDAC LIMS=_SV2
ENDIF
_PART_EN=(($MCS_FUNCTION_MASK_TURN) B_AND 'B10')
_SPD=__SPD/2 _DIAG1=_DIAG1/2 _DIAG2=_DIAG2/2 _DIAGM=__DIAGM/2
_G60_64=$P_GG[10]
IF _G60_64<2
_GG10=2
ELSE
_GG10=_G60_64
ENDIF
_DMODE1=_DMODE _DEC1
IF(_DMODE1<0)OR(_DMODE1>3) GOTOF _FEHL8
IF(_DMODE1>0)AND($P_GG[6]<>_DMODE1)
G[6]=_DMODE1
ENDIF
_XX=$P_AXN2 _ZZ=$P_AXN1
_SDIS=ABS(_SDIS)
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_PLAN=1
ELSE
_PLAN=2
DIAMON
ENDIF
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _XAF=1
DIAMOF
ELSE
IF _ZZ==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=_PLAN
ENDIF
IF _XX==AXNAME($MC_DIAMETER_AX_DEF)
_XAF=_PLAN
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($P_TOOLNO==0) GOTOF _FEHL0
IF($P_TOOL==0) GOTOF _FEHL3
_TYP=$P_ADT[1]
IF ( (_TYP<500)OR(_TYP>599) ) GOTOF _FEHL2
IF (_SC_Y_TURN==0)
IF ((_TYP _DEC1)==5) GOTOF _FEHL2
ELSE
IF ((_TYP _DEC1)<>5) GOTOF _FEHL2
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Werkzeug:")
WRITE(_LOG,_LOG_FILE,"=========")
WRITE(_LOG,_LOG_FILE,"T="<<$TC_TP2[$P_TOOLNO])
WRITE(_LOG,_LOG_FILE,"D="<<$P_TOOL)
WRITE(_LOG,_LOG_FILE,"DL="<<$P_DLNO)
WRITE(_LOG,_LOG_FILE,"Werkzeugtyp="<<_TYP)
ENDIF
_WR=$P_TOOLR*_FAK1
_DL_NUM=$P_DLNO
_DN1=_DN
IF ($P_ADT[9]<>0)
_WB=$P_ADT[9]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Plattenbreite(DP9)="<<$P_ADT[9])
WRITE(_LOG,_LOG_FILE,"<== Plattenbreite aus DP9")
ENDIF
ELSE
IF (_SC_Y_TURN<>0) GOTOF _FEHL11
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"<== Plattenbreite aus 2 D-Nummern")
ENDIF
_DD[0]=$P_TOOL
_L[0]=$P_TOOLL[_II]
_L[2]=$P_TOOLL[1] _L[3]=$P_TOOLL[2] _L[4]=$P_TOOLL[3]
IF _DN1<>0
_DD[1]=_DN1
ELSE
_DD[1]=_DD[0]+1
ENDIF
D=_DD[1]
DL=_DL_NUM
_L[1]=$P_TOOLL[_II]
_L[2]=_L[2]-$P_TOOLL[1] _L[3]=_L[3]-$P_TOOLL[2] _L[4]=_L[4]-$P_TOOLL[3]
D=_DD[0]
DL=_DL_NUM
_WB=ABS(_L[0]-_L[1])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"1. Schneide: D"<<_DD[0])
WRITE(_LOG,_LOG_FILE,"2. Schneide: D"<<_DD[1])
WRITE(_LOG,_LOG_FILE,"Lngendifferenzen: _L[2]="<<_L[2]<<" _L[3]="<<_L[3]<<" _L[4]="<<_L[4])
WRITE(_LOG,_LOG_FILE,"<== BWZ_fertig")
ENDIF
IF _WB==0
IF ((_L[2]<>0) AND (_L[3]==0) AND (_L[4]==0))
_WB=ABS(_L[2])
GOTOF _WB_FERTIG
ENDIF
IF ((_L[2]==0) AND (_L[3]<>0) AND (_L[4]==0))
_WB=ABS(_L[3])
GOTOF _WB_FERTIG
ENDIF
IF ((_L[2]==0) AND (_L[3]==0) AND (_L[4]<>0))
_WB=ABS(_L[4])
GOTOF _WB_FERTIG
ENDIF
IF ((_L[2]<>0) AND (_L[3]<>0) AND (_L[4]<>0)) GOTOF _FEHL1
IF ((_L[2]<>0) AND (_L[3]<>0)) GOTOF _FEHL1
IF ((_L[2]<>0) AND (_L[4]<>0)) GOTOF _FEHL1
IF ((_L[3]<>0) AND (_L[4]<>0)) GOTOF _FEHL1
ELSE
IF ((_L[2]<>0) AND (_L[3]<>0))
IF (ABS(_L[2])>=ABS(_L[3]))
_WB=ABS(_L[2])
ELSE
_WB=ABS(_L[3])
ENDIF
GOTOF _WB_FERTIG
ENDIF
IF ((_L[2]<>0) AND (_L[4]<>0))
IF (ABS(_L[2])>=ABS(_L[4]))
_WB=ABS(_L[2])
ELSE
_WB=ABS(_L[4])
ENDIF
GOTOF _WB_FERTIG
ENDIF
IF ((_L[4]<>0) AND (_L[4]<>0))
IF (ABS(_L[3])>=ABS(_L[4]))
_WB=ABS(_L[3])
ELSE
_WB=ABS(_L[4])
ENDIF
ENDIF
ENDIF
ENDIF
_WB_FERTIG:
_WB=_WB*_FAK1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"BWZ="<<_WB)
ENDIF
IF(_WB<=0) GOTOF _FEHL1
IF(_WR<=0) GOTOF _FEHL6
_SL=$P_ADT[2]
IF(NOT(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'H00200000')AND($P_CUTMOD))AND NOT(($P_CUTMODK==$PC_TRAFO_NAME)AND($P_CUTMODK<>""))AND(NOT _SC_Y_TURN))
_SL=_SLT[$P_ACTFRAME[_ZZ,MI],_SL]
_SL=_SLX[$P_ACTFRAME[_XX,MI],_SL]
ENDIF
IF(_SL<>3)AND(_SL<>4) GOTOF _FEHL5
IF(_SL==4)
_OFFZ=_WB
ELSE
_OFFZ=0
ENDIF
IF((_SPD-_DIAG1)<ABS(_RC)) GOTOF _FEHL4
IF(_DIAG1>=_SPD) GOTOF _FEHL4
IF(_DIAG2>_DIAG1) GOTOF _FEHL4
IF(_H_VARI[1]<>0)AND(_PART_EN)AND(_DIAGM>_SPD-ABS(_RC)) GOTOF _FEHL4
IF(_RC==0)
_N=-1
ELSE
_ZB=0.8*_WB
_RX=_SPD-ABS(_RC)-_WR
_RZ=_SPL+ABS(_RC)+_WR-_WB
_N=ROUND(ABS(_RC)/_ZB)
IF(_N<ABS(_RC)/_ZB)
_N=_N+1
ENDIF
_DZ=ABS(_RC)/_N
IF(_RC>0)
_SR=_RC+_WR
ELSE
_FV=_RX+_WR*(SQRT(2)-1)
_FW=_RZ-_WR*(SQRT(2)-1)
ENDIF
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[7])
ENDIF
SBLON
N100 G0 G90 AX[_XX]=(_SPD+_SDIS)*_XAF AX[_ZZ]=(_SPL-_WB+_OFFZ)*_ZAF F=_FF1
SBLOF
IF(_RC)
N110 G1 AX[_XX]=(_SPD-ABS(_RC))*_XAF
N120 G0 AX[_XX]=(_SPD+_SDIS)*_XAF
FOR _I=1 TO _N-1
N130 G0 AX[_ZZ]=(_SPL-_WB+_I*_DZ+_OFFZ)*_ZAF
IF(_RC>0)
N140 G1 AX[_XX]=(_RX+SQRT(POT(_SR)-POT(_I*_DZ-_SR)))*_XAF
N150 G3 AX[_XX]=(_RX+SQRT(POT(_SR)-POT((_I-1)*_DZ-_SR)))*_XAF AX[_ZZ]=(_SPL-_WB+(_I-1)*_DZ+_OFFZ)*_ZAF IP[_XX]=AC(_RX*_XAF) IP[_ZZ]=AC((_RZ+_OFFZ)*_ZAF)
ELSE
N160 G1 AX[_XX]=(_I*_DZ+_FV)*_XAF
N170 G1 AX[_XX]=(((_I-1)*_DZ+_FV))*_XAF AX[_ZZ]=(_SPL-_WB+(_I-1)*_DZ+_OFFZ)*_ZAF
ENDIF
SBLON
N180 G0 AX[_XX]=(_SPD+_SDIS)*_XAF
SBLOF
ENDFOR
IF(_RC>0)
N200 G0 AX[_ZZ]=(_RZ+_SDIS+_OFFZ)*_ZAF
N210 G2 G[10]=_GG10 AX[_XX]=_SPD*_XAF AX[_ZZ]=(_RZ+_OFFZ)*_ZAF IP[_XX]=AC((_SPD+_SDIS)*_XAF) IP[_ZZ]=AC((_RZ+_OFFZ)*_ZAF)
N220 G3 AX[_XX]=_RX*_XAF AX[_ZZ]=(_SPL-_WB+_OFFZ)*_ZAF IP[_XX]=AC((_RX)*_XAF) IP[_ZZ]=AC((_RZ+_OFFZ)*_ZAF)
ELSE
N230 G0 AX[_ZZ]=(_FW+_SDIS+_OFFZ)*_ZAF
N240 G1 G[10]=_GG10 AX[_XX]=_FV*_XAF AX[_ZZ]=(_SPL-_WB+_OFFZ)*_ZAF
ENDIF
ENDIF
IF(_H_VARI[1]<>0)AND(_PART_EN)AND(_DIAGM*_XAF>=_DIAG1*_XAF)
N300 G1 AX[_XX]=_DIAGM*_XAF
_GG15=$P_GG[15]
CUST_TECHCYC(101)
N310 G1 AX[_XX]=_DIAG1*_XAF G[15]=_GG15 F=_FF1
ELSE
N320 G1 AX[_XX]=_DIAG1*_XAF
ENDIF
IF(_H_VARI[1]<>0)AND(_PART_EN)AND(_DIAGM*_XAF>=_DIAG2*_XAF)AND(_DIAGM*_XAF<_DIAG1*_XAF)
N330 G1 AX[_XX]=_DIAGM*_XAF G95 S=_SS2 F=_FF2
CUST_TECHCYC(101)
N345 G1 G9 AX[_XX]=_DIAG2*_XAF G95 F=_FF2
ELSE
N350 G1 G9 AX[_XX]=_DIAG2*_XAF G95 S=_SS2 F=_FF2
ENDIF
IF(_H_VARI[1]<>0)AND(_PART_EN)AND(_DIAGM*_XAF>=_DIAG2*_XAF)
CUST_TECHCYC(102)
ENDIF
IF(_H_VARI[0]==0)
SBLON
N360 G0 AX[_XX]=(_SPD+_SDIS)*_XAF
SBLOF
ENDIF
IF (_ARTIS[0]==11)
M=QU(_ARTIS[8])
ENDIF
G[10]=_G60_64
SBLON
WORKPIECE(,,,"SHOW_PARTOF",0)
CUST_TECHCYC(103)
IF (_H_AMODE[4]==1)
LIMS=$AC_SMAXVELO[$P_MSNUM]
ENDIF
RET
_FEHL0: STOPRE
N709200 SETAL(61009)
RET
_FEHL1: STOPRE
N709201 SETAL(61602)
RET
_FEHL2: STOPRE
N709202 SETAL(61212)
RET
_FEHL3: STOPRE
N709203 SETAL(61000)
RET
_FEHL4: STOPRE
N709204 SETAL(61609)
RET
_FEHL5: STOPRE
N709205 SETAL(61608)
RET
_FEHL6: STOPRE
N709206 SETAL(61007)
RET
_FEHL7: STOPRE
N709207 SETAL(61019,_SERR)
RET
_FEHL8: STOPRE
N709208 SETAL(61158)
RET
_FEHL9:STOPRE
N709209 SETAL(62106)
RET
_FEHL10:STOPRE
N709210 SETAL(61102)
RET
_FEHL11:STOPRE
N709211 SETAL(61631)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE93_SPF
PROC CYCLE93(REAL SPD,REAL SPL,REAL WIDG,REAL DIAG,REAL STA1,REAL ANG1,REAL ANG2,REAL RCO1,REAL RCO2,REAL RCI1,REAL RCI2,REAL FAL1,REAL FAL2,REAL IDEPL,REAL DTB,INT VARI,REAL _VRT,INT _DN) SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.001 ;DATE: 2023-08-31
;Cycle support HMIsl
;Grooving
DEF AXIS _ZA,_SA
DEF INT LP,DD[3],II,JJ,KK,IH1,IH2,LL[4],_IS[11]=(0,0,0,1),_DIAMFAK=1,_SAF=1,_ZAF=1,IH3,IH4,_DL_NUM,_TYP,_BWZFAK
DEF INT _LENTAB[6,7],_ZZSD[15],_GG7,_GG7B,_GG7F,_GG10,_IS_TRACE
DEF INT _ARTIS[16]
DEF REAL _KR[9,11],_KL[9,11],PP[15,2],EK[4,2],MF[2],MNP[2],HH1,HH2,HH3,HH4,HH5,HH6,HH7,HH8,HH15,HH17,HH18,HH19,RWEG,_RWS,MPK,HOE,BR,BWZ,TIEF,_SC_TLEN[11],_VTLEN[2,3]
DEF REAL _GER[11]=SET(0,0,11),SEC[2],_INCHFAK=1, _H1,_BRG, _VRTI[3],_WZR,_CYCFSL1,_BWZG,_RCHRFAK
DEF CHAR BTA
DEF BOOL _FLAG
DEF FRAME _RE_CYCFR
DEF INT _TEMP
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE93_MPF"
DEF STRING[40] _LOG_FILE
DEF INT _LOG,_LOG_ON=0
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE93_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP,_TEMP_FILE,";T-Number: $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number 1.CUTTING EDGE: $P_TOOL="<<$P_TOOL)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";TOOL CORRECTION 1.CUTTING EDGE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,1]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,1]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,1]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,1]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,1]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,1]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
WRITE(_TEMP,_TEMP_FILE,";REPEAT _LAB1A _LAB1E    ; SUBROUTINE TOOL CORRECTION 2.CUTTING EDGE")
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
WRITE(_TEMP,_TEMP_FILE,";M6")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
WRITE(_TEMP,_TEMP_FILE,";M6")
ENDIF
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,"G[06]="<<$P_GG[6]<<"    ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,"G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,"G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,"G[15]="<<$P_GG[15]<<"    ; G94/G95/...")
WRITE(_TEMP,_TEMP_FILE,"F"<<$P_F)
IF $P_MSNUM==0
WRITE(_TEMP,_TEMP_FILE,";$P_MSNUM=0 no spindle existant")
ELSE
WRITE(_TEMP,_TEMP_FILE,"S"<<$P_S[0]<<" M"<<$P_SDIR[$P_MSNUM])
ENDIF
WRITE(_TEMP,_TEMP_FILE,"_ZSD[4]="<<_ZSD[4]<<"  ; ")
WRITE(_TEMP,_TEMP_FILE,"_ZSD[6]="<<_ZSD[6]<<"  ; ")
WRITE(_TEMP,_TEMP_FILE,"CYCLE93("<<SPD<<","<<SPL<<","<<WIDG<<","<<DIAG<<","<<STA1<<","<<ANG1<<","<<ANG2<<","<<RCO1<<","<<RCO2<<","<<RCI1<<","<<RCI2<<","<<FAL1<<","<<FAL2<<","<<IDEPL<<","<<DTB<<","<<VARI<<","<<_VRT<<","<<_DN<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
GOTOF _LAB1E
_LAB1A:
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,"_LAB1A:   ; BEGIN SUBROUTINE")
WRITE(_TEMP,_TEMP_FILE,";D-Number 2.CUTTING EDGE: $P_TOOL="<<$P_TOOL)
WRITE(_TEMP,_TEMP_FILE,";TOOL CORRECTION 2.CUTTING EDGE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,2]="<<$P_ADT[1]<<"    ; TOOL-TYPE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,2]="<<$P_ADT[2]<<"    ; CUTTING EDGE POSITION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,2]="<<$P_ADT[3]<<"    ; TOOL GEO LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,2]="<<$P_ADT[4]<<"    ; TOOL GEO LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP12[1,2]="<<$P_ADT[12]<<"    ; TOOL WEAR LENGTH 1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP13[1,2]="<<$P_ADT[13]<<"    ; TOOL WEAR LENGTH 2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,2]="<<$P_ADT[6]<<"    ; TOOL RADIUS GEOMETRY")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,2]="<<$P_ADT[15]<<"    ; TOOL RADIUS WEAR")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP8[1,2]="<<$P_ADT[8]<<"    ; PLATE LENGTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP9[1,2]="<<$P_ADT[9]<<"    ; PLATE WIDTH")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,2]="<<$P_ADT[10]<<"    ; TOOLHOLDER ANGLE")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP11[1,2]="<<$P_ADT[11]<<"    ; CUTTING DIRECTION")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP24[1,2]="<<$P_ADT[24]<<"    ; CLEARANCE ANGLE")
WRITE(_TEMP,_TEMP_FILE,"_LAB1E:   ; END SUBROUTINE")
ENDIF
_LAB1E:
ENDIF
IF (($P_GG[30]>1)AND($P_GG[30]<>6))
COMPOF
ENDIF
CYCLE218(10,0)
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE93_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
; DELETE(_LOG,_LOG_FILE)
FILESIZE(_LOG,_LOG_FILE,II)
IF(II>10000)
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,"Logfile CYCLE93: "<<$A_DAY<<"."<<$A_MONTH<<"."<<$A_YEAR<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"-----------------------------------")
ENDIF
_IS_TRACE=VARI DIV 1000 VARI=VARI-_IS_TRACE*1000
IF IDEPL<=0 GOTOF _FEHL5
IF(($P_GG[29]==1) OR ($P_GG[29]==4))
_DIAMFAK=1
ELSE
_DIAMFAK=2
DIAMON
ENDIF
IF _VRT<=0
_VRT=1 _VRTI[2]=1
ENDIF
IF ($MN_SCALING_SYSTEM_IS_METRIC==1) AND ($P_GG[13]==1)
_INCHFAK=1/$MN_SCALING_VALUE_INCH
ENDIF
IF ($MN_SCALING_SYSTEM_IS_METRIC==0) AND ($P_GG[13]==2)
_INCHFAK=$MN_SCALING_VALUE_INCH
ENDIF
_GG10=$P_GG[10]
IF _GG10<2
_GG10=2
ENDIF
_RE_CYCFR=$P_CYCFRAME
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[7]=_SC_TOOL_ON_OFF[0] _ARTIS[8]=_SC_TOOL_ON_OFF[1]
IF (_ARTIS[0] MOD 10 <>1 )
GOTOF _FEHL6
ENDIF
II=_ARTIS[0] DIV 10
IF ((II MOD 10 > 3) OR (II MOD 10 < 1))
GOTOF _FEHL6
ELSE
_ARTIS[11]=II MOD 10
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
II=II DIV 10
IF ((II MOD 10 > 2) OR (II MOD 10 < 0))
GOTOF _FEHL6
ELSE
_ARTIS[12]=II MOD 10
ENDIF
ENDIF
_IS[0]=1 _IS[1]=1 _VRTI[0]=1 _VRTI[1]=1 _ZA=$P_AXN2 _SA=$P_AXN1 LP=VARI MOD 2 BTA="L" DD[0]=$P_TOOL LL[2]=DD[0] MF[0]=$P_ACTFRAME[_SA,SC] MF[1]=$P_ACTFRAME[_ZA,SC] II=VARI MOD 10
_BWZFAK=1
_DL_NUM=$P_DLNO _WZR=$P_TOOLR
IF((RCI1<_WZR)AND(RCI1>0))OR((RCI2<_WZR)AND(RCI2>0))GOTOF _FEHL11
IF (DD[0]==0) AND (DD[2]==0) GOTOF FEHL3
IF (VARI<=0)OR(VARI>8)AND(VARI<=10)OR(VARI>18) GOTOF FEHL4
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
MF[0]=MF[0]*$MN_SCALING_VALUE_INCH MF[1]=MF[1]*$MN_SCALING_VALUE_INCH
_VRTI[0]=_IS[0]/$MN_SCALING_VALUE_INCH _VRTI[1]=_IS[1]/$MN_SCALING_VALUE_INCH
ENDIF
_MA1:LL[3]=42
IF (II==1)OR(II==4)OR(II==6)OR(II==7) GOTOF _MAX1
LL[3]=41
_MAX1:IF LP GOTOF _MBX1
LP=0 _ZA=$P_AXN1 _SA=$P_AXN2 BTA="P"
IH4=$MC_TOOL_PARAMETER_DEF_MASK MOD 2
IF IH4
_BWZFAK=2
ENDIF
_MBX1:
IF (($MC_DIAMETER_AX_DEF=="") OR ($MC_DIAMETER_AX_DEF==" "))
_ZAF=1 _SAF=1
DIAMOF
ELSE
IF _ZA==AXNAME($MC_DIAMETER_AX_DEF)
_ZAF=_DIAMFAK
ENDIF
IF _SA==AXNAME($MC_DIAMETER_AX_DEF)
_SAF=_DIAMFAK
ENDIF
ENDIF
IF ((II-1)MOD 4)<2 GOTOF _MCX1
_IS[0]=-1 _VRTI[0]=-_VRTI[0]
_MCX1:IF II>4 GOTOF _MDX1
_IS[1]=-1 _VRTI[1]=-_VRTI[1]
_MDX1:IF LP==0 GOTOF _MFX1 IF (II MOD 4)==1 GOTOF _MA_ZSD
BTA="G"
GOTOF _MA_ZSD
_MFX1:IF II>4 GOTOF _MA_ZSD
BTA="N"
_MA_ZSD:
IF (_ZSD[4]<>-1)
_ZZSD[4]=_ZSD[4]
ENDIF
IF (_ZSD[6]<>-1)
_ZZSD[6]=_ZSD[6]
ENDIF
_MAX2:IF(LP==0)AND((STA1==0)OR(STA1==180))OR(LP AND(STA1==90)) GOTOF FEHL2
IF(RCI1 AND RCI2)AND((RCI1+RCI2)/2>WIDG) GOTOF FEHL2
IF ((RCI1>0) AND (ABS(RCI1-DIAG)<0.001)) OR ((RCI2>0) AND (ABS(RCI2-DIAG)<0.001)) GOTOF FEHL2
IF (WIDG<FAL2*2) GOTOF _FEHL7
EK[0,0]=SPL EK[0,1]=SPD/_DIAMFAK MNP[0]=TAN(STA1) HH1=ABS(TAN(ANG1)*DIAG) MNP[1]=EK[0,1]-MNP[0]*EK[0,0] HH3=_IS[LP] HH2=_IS[1-LP] HH5=TAN(ANG2*_IS[1]*_IS[0]+90)
IF LP GOTOF _MBX2
HH5=TAN(-ANG2*_IS[0]*_IS[1])
_MBX2:EK[1,LP]=EK[0,LP]-DIAG*HH2 EK[1,1-LP]=EK[0,1-LP]-HH1*HH3 EK[2,LP]=EK[1,LP] EK[2,1-LP]=EK[1,1-LP]-WIDG*HH3 HH4=EK[2,1]-HH5*EK[2,0] EK[3,0]=(HH4-MNP[1])/(MNP[0]-HH5) EK[3,1]=MNP[0]*EK[3,0]+MNP[1]
IF ABS(STA1-90)>0.0001 GOTOF _MCX2
EK[3,1]=HH5*EK[3,0]+HH4
_MCX2:
_GER[3+LP]=EK[0,LP]+_IS[LP]*1000 _GER[5+LP]=EK[1,LP]-_IS[LP]*1000
IF (EK[0,LP]-EK[1,LP])*(EK[3,LP]-EK[2,LP])<0 GOTOF FEHL2
II=_IS[1-LP] HH1=EK[1,1-LP] MPK=HH1-(HH1-EK[2,1-LP])/2
_RCHRFAK=0.999
IF (ABS(RCO1)+ABS(RCI1)==DIAG)
RCO1=RCO1*_RCHRFAK RCI1=RCI1*_RCHRFAK
ENDIF
IF (ABS(RCO2)+ABS(RCI2)==DIAG)
RCO2=RCO2*_RCHRFAK RCI2=RCI2*_RCHRFAK
ENDIF
IF _VRTI[2]==1
HOE=EK[0,LP]+_VRTI[1-LP]+ABS(RCO1)*II
ELSE
HOE=EK[0,LP]+(_VRT+ABS(RCO1))*II
ENDIF
IF (EK[0,LP]-EK[3,LP])*II>=0 GOTOF _MDX2
IF _VRTI[2]==1
HOE=EK[3,LP]+_VRTI[1-LP]+ABS(RCO2)*II
ELSE
HOE=EK[3,LP]+(_VRT+ABS(RCO2))*II
ENDIF
_MDX2:HH8=$P_EP[_ZA]*_INCHFAK/_ZAF HH6=EK[0,LP] HH7= EK[3,LP]
IF (HH6-HH7)*_IS[1-LP]>0
HH7=HH6 HH6=EK[3,LP]
ENDIF
IF NOT(((HH8-HH7) * _IS[1-LP] > 0 ))
N19 G0 G90 AX[_ZA]=HH7*_ZAF + _VRTI[1-LP]* _ZAF
ENDIF
N2 G0 G90 AX[_SA]=MPK*_SAF
IF NOT(($P_EP[_ZA]*_INCHFAK/_ZAF-HOE)*(EK[0,LP]-EK[1,LP])/ABS(EK[0,LP]-EK[1,LP])<0)
N20 AX[_ZA]=HOE*_ZAF
ENDIF
N200 DIAMOF
N21 CONTPRON(_KL,BTA,II)
N22 G1 G90 AX[_ZA]=EK[2,LP]
IF RCI2>0 GOTOF _MEX2 IF (VARI DIV 10)==1 GOTOF _KF1
N23 AX[_SA]=EK[2,1-LP] CHF=-RCI2
GOTOF _MFX2
N23 _KF1:AX[_SA]=EK[2,1-LP] CHR=-RCI2
GOTOF _MFX2
N23 _MEX2:AX[_SA]=EK[2,1-LP] RND=RCI2
_MFX2:IF RCO2>0 GOTOF _MGX2 IF (VARI DIV 10)==1 GOTOF _KF2
N24 AX[_SA]=EK[3,1-LP] AX[_ZA]=EK[3,LP] CHF=-RCO2
GOTOF _MHX2
N24 _KF2:AX[_SA]=EK[3,1-LP] AX[_ZA]=EK[3,LP] CHR=-RCO2
GOTOF _MHX2
N24 _MGX2:AX[_SA]=EK[3,1-LP] AX[_ZA]=EK[3,LP] RND=RCO2
_MHX2:HH1=EK[0,1-LP]-EK[3,1-LP] HH2=EK[0,LP]-EK[3,LP]
N25 G91 AX[_SA]=-HH1 AX[_ZA]=-HH2
N26 EXECUTE(KK)
IF _KL[1,3+LP]<>_KL[1,5+LP] GOTOF FEHL2
N27 CONTPRON(_KR,BTA,II)
N28 G1 G90 AX[_ZA]=EK[1,LP]
IF RCI1>0 GOTOF _MJ2 IF (VARI DIV 10)==1 GOTOF _KF3
N29 AX[_SA]=EK[1,1-LP] CHF=-RCI1
GOTOF _MM2
N29 _KF3:AX[_SA]=EK[1,1-LP] CHR=-RCI1
GOTOF _MM2
N29 _MJ2:AX[_SA]=EK[1,1-LP] RND=RCI1
_MM2:IF RCO1>0 GOTOF _MP2 IF (VARI DIV 10)==1 GOTOF _KF4
N200 AX[_SA]=EK[0,1-LP] AX[_ZA]=EK[0,LP] CHF=-RCO1
GOTOF _MQ2
N200 _KF4:AX[_SA]=EK[0,1-LP] AX[_ZA]=EK[0,LP] CHR=-RCO1
GOTOF _MQ2
_MP2:AX[_SA]=EK[0,1-LP] AX[_ZA]=EK[0,LP] RND=RCO1
N201 _MQ2:G91 AX[_SA]=HH1 AX[_ZA]=HH2
N202 EXECUTE(KK)
IF _KR[1,3+LP]<>_KR[1,5+LP] GOTOF FEHL2
II=_KL[0,0] _KL[0,0]=_KL[0,0]-1
IF (_KL[II,3]==_KL[II,5])AND(_KL[II,4]==_KL[II,6]) GOTOF _YE2
_KL[0,0]=_KL[0,0]+1
_YE2:II=_KR[0,0] _KR[0,0]=_KR[0,0]-1
IF (_KR[II,3]==_KR[II,5])AND(_KR[II,4]==_KR[II,6]) GOTOF _YFX2
_KR[0,0]=_KR[0,0]+1
_YFX2:II=1
MR2:PP[3,0]=_KR[1,5] PP[3,1]=_KR[1,6]
IF RCI1==0 GOTOF _MS2
II=II+1
_MS2:PP[2,0]=_KR[II,5] PP[2,1]=_KR[II,6] II=II+1 PP[1,0]=_KR[II,5] PP[1,1]=_KR[II,6]
IF RCO1==0 GOTOF _MT2 IF RCO1<0 GOTOF _MST2 IF _KR[0,0]<=5 GOTOF _MST2
II=II+1
_MST2:II=II+1
_MT2:PP[0,0]=_KR[II,5] PP[0,1]=_KR[II,6]
IF ((RCO1>0) AND (RCI1>0) AND (RCO1+RCI1)==ABS(EK[0,LP]-EK[1,LP]))
PP[0,0]=_KR[II,3] PP[0,1]=_KR[II,4]
ENDIF
LL[0]=II II=1 PP[4,0]=_KL[1,5] PP[4,1]=_KL[1,6]
IF RCI2==0 GOTOF _MU2
II=II+1
_MU2:PP[5,0]=_KL[II,5] PP[5,1]=_KL[II,6] II=II+1 PP[6,0]=_KL[II,5] PP[6,1]=_KL[II,6]
IF RCO2==0 GOTOF _YB2 IF RCO2<0 GOTOF _YA2 IF _KL[0,0]<=5 GOTOF _YA2
II=II+1
_YA2:II=II+1
_YB2:PP[7,0]=_KL[II,5] PP[7,1]=_KL[II,6]
IF ((RCO2>0) AND (RCI2>0) AND (RCO2+RCI2)==ABS(EK[2,LP]-EK[3,LP]))
PP[7,0]=_KL[II,3] PP[7,1]=_KL[II,4]
ENDIF
LL[1]=II HH1=FAL1*_IS[1-LP] HH2=ABS(PP[0,1-LP]-PP[7,1-LP])*_IS[LP] _KL[8,2]=11 _KL[8,3+LP]=PP[3,LP]+HH1 _KL[8,4-LP]=PP[3,1-LP]+HH2 _KL[8,5+LP]=PP[4,LP]+HH1 _KL[8,6-LP]=PP[4,1-LP]-HH2 KK=1
_BRG=ABS(PP[3,1-LP]-PP[4,1-LP])
IF ($P_GG[13]==1) OR ($P_GG[13]==3)
_KL[8,2]=1
ENDIF
_YF2:KK=KK+1 PP[8,0]=PP[8,0] PP[8,1]=PP[8,1] PP[9,0]=PP[9,0] PP[9,1]=PP[9,1]
N901 IF KK>8 GOTOF FEHL2 IF INTERSEC(_KR[KK],_KL[8],SEC)==0 GOTOB _YF2
PP[8,0]=SEC[0] PP[8,1]=SEC[1]
KK=1
_YXG2:KK=KK+1
N902 IF KK>8 GOTOF FEHL2 IF INTERSEC(_KL[KK],_KL[8],SEC)==0 GOTOB _YXG2
PP[9,0]=SEC[0] PP[9,1]=SEC[1]
HH1=FAL2*_IS[LP] PP[8,1-LP]=PP[8,1-LP]-HH1 PP[9,1-LP]=PP[9,1-LP]+HH1 PP[10,1-LP]=PP[2,1-LP]-HH1 PP[10,LP]=PP[2,LP] PP[11,1-LP]=PP[5,1-LP]+HH1 PP[11,LP]=PP[5,LP] KK=0
IF ABS(PP[10,LP]-PP[3,LP])>=ABS(FAL1) GOTOF _MV21
PP[10,LP]=PP[8,LP]
_MV21:IF ABS(PP[11,LP]-PP[4,LP])>=ABS(FAL1) GOTOF _MVX2
PP[11,LP]=PP[9,LP]
_MVX2:KK=KK+1 HH1=_KL[KK,3] HH2=_KL[KK,4] _KL[KK,3]=_KL[KK,5] _KL[KK,4]=_KL[KK,6] _KL[KK,5]=HH1 _KL[KK,6]=HH2 JJ=_KL[KK,2] JJ=JJ MOD 10
IF JJ<2 GOTOF _MX2 IF JJ==3 GOTOF _MW2
_KL[KK,2]=_KL[KK,2]+1
GOTOF _MX2
_MW2:_KL[KK,2]=_KL[KK,2]-1
_MX2:IF KK<LL[1] GOTOB _MVX2
KK=0
_YXC2:KK=KK+1 HH1=_KR[KK,3] HH2=_KR[KK,4] _KR[KK,3]=_KR[KK,5] _KR[KK,4]=_KR[KK,6] _KR[KK,5]=HH1 _KR[KK,6]=HH2 JJ=_KR[KK,2] JJ=JJ MOD 10
IF JJ<2 GOTOF _MZ2 IF JJ==3 GOTOF _MY2
_KR[KK,2]=_KR[KK,2]+1
GOTOF _MZ2
_MY2:_KR[KK,2]=_KR[KK,2]-1
_MZ2:IF KK<LL[0] GOTOB _YXC2
KK=1 II=0
CASE (VARI MOD 10) OF 1 GOTOF _YXD2 5 GOTOF _YXD2 6 GOTOF _YXD2 8 GOTOF _YXD2
KK=-1
_YXD2:IF KK*(PP[II,LP]-PP[II+1,LP])<0 GOTOF FEHL2 IF KK*(PP[7-II,LP]-PP[6-II,LP])<0 GOTOF FEHL2
II=II+1
IF II<3 GOTOB _YXD2
_GG7=LL[3]-39
IF LL[3]==41
_GG7B=3
ELSE
_GG7B=2
ENDIF
_TYP=$P_ADT[1]
IF ( (_TYP<500)OR(_TYP>599) ) GOTOF _FEHL10
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Werkzeug:")
WRITE(_LOG,_LOG_FILE,"=========")
WRITE(_LOG,_LOG_FILE,"T="<<$TC_TP2[$P_TOOLNO])
WRITE(_LOG,_LOG_FILE,"D="<<$P_TOOL)
WRITE(_LOG,_LOG_FILE,"DL="<<$P_DLNO)
WRITE(_LOG,_LOG_FILE,"Werkzeugtyp="<<_TYP)
ENDIF
IF ( (_TYP==520)OR(_TYP==521)OR(_TYP==530)OR(_TYP==531) )
BWZ=$P_ADT[9]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Plattenbreite(DP9)="<<$P_ADT[9])
ENDIF
ENDIF
IF BWZ<>0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"<== Plattenbreite aus DP9")
ENDIF
DD[1]=DD[0]
_IS[9]=1
_GG7=1 _GG7B=1
_WZR=0
_IS[10]=1
II=$P_ADT[2]
IF (LP==1)
IF ((II==3) OR (II==2))
IF _IS[1]==-1
ELse
_CYCFSL1=BWZ
ENDIF
ELSE
IF _IS[1]==-1
_CYCFSL1=BWZ
ELSE
_CYCFSL1=2*BWZ
ENDIF
ENDIF
ELSE
IF ((II==3) OR (II==4))
IF _IS[0]==1
_CYCFSL1=BWZ
ELSE
ENDIF
ELSE
IF _IS[0]==1
_CYCFSL1=2*BWZ
ELSE
_CYCFSL1=BWZ
ENDIF
ENDIF
ENDIF
GOTOF _END_BWZ_FROM_DD
ENDIF
_BWZ_FROM_DD:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"<== Plattenbreite aus 2 D-Nummern")
ENDIF
IF (($P_SUBPAR[18]==0) OR (_DN==0))
DD[1]=DD[0]+1
ELSE
IF $MN_MM_TYPE_OF_CUTTING_EDGE==0
KK=$P_TOOLNO
DD[1]=_DN
ELSE
DD[1]=_DN
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"1. Schneide: D"<<DD[0])
WRITE(_LOG,_LOG_FILE,"2. Schneide: D"<<DD[1])
ENDIF
IF ((($P_TC>0) OR (($P_TRAFO>0) AND ($P_TRAFO<256)))) GOTOF _MIT_B_AX
_LENTAB[0,0]=SET(2,2,1,3,1,2,3)
_LENTAB[1,0]=SET(1,1,3,2,2,3,1)
_LENTAB[2,0]=SET(2,3,2,1,3,1,2)
_LENTAB[3,0]=SET(1,2,1,3,1,2,3)
_LENTAB[4,0]=SET(2,1,3,2,2,3,1)
_LENTAB[5,0]=SET(1,3,2,1,3,1,2)
IH1=$SC_TOOL_LENGTH_CONST
IH1= IH1 MOD 100
IF ((IH1<-19) OR (IH1>19))
IH1=18
ENDIF
IF (((IH1>-17) AND (IH1<0)) OR ((IH1>0) AND (IH1<17)))
IH1=18
ENDIF
IF IH1==0
KK=0
ELSE
JJ=IH1
IF JJ>0
KK=JJ-16
ELSE
IF JJ==-17
KK=4
ELSE
IF JJ==-18
KK=5
ELSE
KK=6
ENDIF
ENDIF
ENDIF
ENDIF
JJ=$P_GG[6]
IF LP==1
JJ=(JJ-1)*2
ELSE
JJ=(JJ-1)*2+1
ENDIF
II=_LENTAB[JJ,KK]
HH1=$P_TOOLL[II]
N3 D=DD[1]
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE93_MPF")
IF ((DD[1]<>DD[0]) AND (($P_TOOL)AND($P_TOOLNO)))
REPEAT _LAB1A _LAB1E
ENDIF
ENDIF
DL=_DL_NUM
HH2=$P_TOOLL[II] BWZ=ABS(HH1-HH2)*_BWZFAK HH19=HH1-HH2
GOTOF _BWZ_FERTIG
_MIT_B_AX:
JJ=GETTCOR(_SC_TLEN,"SEW:W",,,,$P_DLNO)
IF JJ==0
_VTLEN[0,0]=_SC_TLEN[2] _VTLEN[0,1]=_SC_TLEN[3] _VTLEN[0,2]=_SC_TLEN[4]
ELSE
GOTOF _FEHL9
ENDIF
JJ=GETTCOR(_SC_TLEN,"-T:W")
IF JJ
GOTOF _FEHL9
ELSE
HH1=_SC_TLEN[II]
HH17=_SC_TLEN[2] HH18=_SC_TLEN[3] HH8=_SC_TLEN[4]
ENDIF
N3 D=DD[1]
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE93_MPF")
IF ((DD[1]<>DD[0]) AND (($P_TOOL)AND($P_TOOLNO)))
REPEAT _LAB1A _LAB1E
ENDIF
ENDIF
DL=_DL_NUM
JJ=GETTCOR(_SC_TLEN,"SEW:W",,,,$P_DLNO)
IF JJ==0
_VTLEN[1,0]=_SC_TLEN[2] _VTLEN[1,1]=_SC_TLEN[3] _VTLEN[1,2]=_SC_TLEN[4]
ELSE
GOTOF _FEHL9
ENDIF
JJ=GETTCOR(_SC_TLEN,"-T:W")
IF JJ
GOTOF _FEHL9
ELSE
HH2=_SC_TLEN[II]
HH17=(HH17-(_SC_TLEN[2])) HH18=(HH18-(_SC_TLEN[3])) HH8=ABS(HH8-(_SC_TLEN[4])) HH15=SQRT(HH17*HH17+HH18*HH18)
ENDIF
BWZ=HH15
IF (HH17*HH18)==0
IF ABS(HH17)==HH15
HH19=HH17
ELSE
HH19=HH18
ENDIF
ELSE
IF ABS(HH17)<ABS(HH18)
HH19=HH18
ELSE
HH19=HH17
ENDIF
ENDIF
_BWZ_FERTIG:
IF DD[2]==1
BWZ=1
ENDIF
_END_BWZ_FROM_DD:
BWZ=BWZ*_INCHFAK
IF _IS_TRACE==1
_SC_TR[0]=BWZ
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"<== BWZ_fertig")
WRITE(_LOG,_LOG_FILE,"BWZ="<<BWZ)
ENDIF
IF ABS(BWZ)==ABS(WIDG)
_IS[5]=1
ENDIF
IF BWZ<=FAL2 GOTOF FEHL1
IF ABS(WIDG)-ABS(BWZ)<-0.000001 GOTOF FEHL1
_BWZG=ABS(BWZ-2*$P_TOOLR)
IF _BWZG>_BRG GOTOF FEHL1
IF ( (RCI1<0) OR (RCI2<0))
IF _BRG<BWZ
GOTOF FEHL1
ENDIF
ENDIF
IF ((_BRG<=$P_TOOLR*2) OR (_BRG<=BWZ) OR (_BRG-BWZ<=$P_TOOLR*2))
_GG7=1 _GG7B=1
_IS[10]=1
ENDIF
IF (HH19)*(EK[0,1-LP]-EK[3,1-LP])<0
GOTOF _MK3
ELSE
JJ=DD[0] DD[0]=DD[1] DD[1]=JJ
ENDIF
_MK3:
IF $MN_MIRROR_REF_AX==0
IF ( ( ( $P_ACTFRAME[_SA,MI]<>0 ) AND (_ZZSD[6]==0) ) OR ( ( $P_ACTFRAME[_SA,MI]==0 ) AND (_ZZSD[6]==2) ) )
JJ=DD[0] DD[0]=DD[1] DD[1]=JJ
N30 D=DD[1]
ENDIF
ELSE
IF ( ( ( $P_ACTFRAME[_ZA,MI]<>0 ) AND (_ZZSD[6]==0) ) OR ( ( $P_ACTFRAME[_ZA,MI]==0 ) AND (_ZZSD[6]==2) ) )
JJ=DD[0] DD[0]=DD[1] DD[1]=JJ
N30 D=DD[1]
ENDIF
ENDIF
DL=_DL_NUM
HH1=_IS[LP] HH2=_IS[1-LP]*_VRT HH4=1/MF[1-LP]
IF _VRTI[2]==1
HOE=PP[0,LP]+HH2/MF[LP]
ELSE
HOE=PP[0,LP]+HH2
ENDIF
IF (PP[0,LP]-PP[7,LP])*HH2>=0 GOTOF _MP3
HOE=PP[7,LP]+HH2
_MP3:BR=ABS(PP[10,1-LP]-PP[11,1-LP]) MPK=PP[3,1-LP]-HH1*ABS(PP[3,1-LP]-PP[4,1-LP])/2
_MAX4:HH2=BWZ*0.95 II=(BR-BWZ)/HH2+0.499
IF II==0
II=1
ENDIF
IF ((II MOD 2 <> 0) AND (_BRG<BWZ))
II=II+1
ENDIF
N900 HH1=(BWZ-BR)/II*_IS[LP] HH8=MNP[0]*_IS[LP]/MF[LP]
IF BR-BWZ<-0.000001 GOTOF FEHL1
IF NOT(HH1==0) AND (ABS(PP[8,1-LP]-PP[10,1-LP])>0)
_IS[3]=TRUNC(ABS(PP[8,1-LP]-PP[10,1-LP])/ABS(HH1))+2
ENDIF
IF NOT (LP)
HH8=_IS[LP]/MF[LP]/MNP[0]
ENDIF
_MBX4:II=II+1 HH6=PP[10,1-LP]-_IS[LP]*BWZ
IF (_IS[9]==1)
IF (LP==1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_SA,_CYCFSL1):CTRANS(_SA,-BWZ)
ENDIF
IF (LP==0)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_SA,_CYCFSL1):CTRANS(_SA,-BWZ)
ENDIF
ENDIF
_IS[4]=II
IF II==2
IF NOT((RCI1==0) AND (RCI2==0))
_IS[8]=1
ENDIF
ENDIF
IF _DIAMFAK<>1
N4 DIAMON
ENDIF
IF DD[2]==1
N41 G0 G90 G[10]=_GG10 AX[_ZA]=HOE*_ZAF AX[_SA]=HH6*_SAF D1
GOTOF _MAX6
ELSE
N4 G0 G90 G[10]=_GG10 AX[_ZA]=HOE*_ZAF AX[_SA]=HH6*_SAF D=DD[1] DL=_DL_NUM
ENDIF
JJ=0 HH4=HH6
IF NOT(_IS[5])
IF NOT(HH1==0)
HH6=-HH1/ABS(HH1)/MF[1-LP]
ELSE
HH6=0
ENDIF
IF (FAL1==0) AND (FAL2==0) AND (RCI1==0) AND (RCI2==0) AND (ABS(PP[0,1-LP]-PP[7,1-LP])<1.9*BWZ)
_IS[5]=2
ENDIF
ENDIF
_RWS=_IS[1-LP]/MF[1-LP] MNP[1]=MNP[1]+_IS[0]/MF[1]
IF _VRTI[2]==1
RWEG=_VRTI[1-LP]
ELSE
RWEG=_VRT*_IS[1-LP]
ENDIF
IF LP GOTOF _MCX4
MNP[1]=MNP[1]-_VRTI[0]-_VRTI[1]*MNP[0]
_MCX4:IF JJ==0 GOTOF _MCXC4
HH4=HH4+HH1
_MCXC4:IH1=0 HH5=MNP[0]*HH4+MNP[1] IH2=_IS[1-LP] HH15=HH5-_RWS+RWEG
IF LP GOTOF _MDX4
HH5=(HH4-MNP[1])/MNP[0] HH15=HH5-_RWS+RWEG
_MDX4:HH7=HH5-_IS[1-LP]/MF[1-LP]
IF (JJ>0)AND(JJ<II-1)
TIEF=ABS(HH5-PP[3,LP]-_IS[1-LP]*(1/MF[LP]+FAL1))
IF ((HH4+HH6/ABS(HH6)*BWZ-PP[8,1-LP])*(HH4+HH6/ABS(HH6)*BWZ-PP[10,1-LP])<=0) AND (((II MOD 2 == 0) AND (JJ<_IS[3])) OR (II MOD 2 ==1))
IF RCI1==0
GOTOF _ME4
ENDIF
IF RCI1<0
TIEF=TIEF-ABS((PP[8,LP]-PP[10,LP])/(PP[8,1-LP]-PP[10,1-LP])*(PP[8,1-LP]-_IS[LP]*BWZ-HH4))
PP[12,LP]=HH5-TIEF*_IS[1-LP]-_IS[1-LP]*(1/MF[LP]+FAL1) PP[12,1-LP]=HH4+HH6/ABS(HH6)*BWZ _IS[6]=2 PP[13,LP]=PP[12,LP]
GOTOF _ME4
ELSE
IH3=1
_SUCHRAD1:IH4=_KR[IH3,2] MOD 10
IF IH4>1
_GER[4-LP]=HH4+HH6/ABS(HH6)*BWZ _GER[6-LP]=HH4+HH6/ABS(HH6)*BWZ
_FLAG=INTERSEC(_KR[IH3],_GER,SEC)
IF _FLAG
TIEF=ABS(HH5-SEC[LP]-_IS[1-LP]*(1/MF[LP]+FAL1))
PP[12,0]=SEC[0] PP[12,1]=SEC[1] _IS[6]=IH3 PP[13,LP]=SEC[LP]
GOTOF _ME4
ENDIF
ELSE
IH3=IH3+1
IF IH3>=9
GOTOF _ME4
ELSE
GOTOB _SUCHRAD1
ENDIF
ENDIF
ENDIF
ENDIF
IF ((HH4-PP[8,1-LP])*(HH4-PP[9,1-LP])<=0)
GOTOF _ME4
ELSE
IF RCI2==0
GOTOF _ME4
ENDIF
IF RCI2<0
TIEF=TIEF-ABS((PP[9,LP]-PP[11,LP])/(PP[9,1-LP]-PP[11,1-LP])*(PP[9,1-LP]-HH4))
ELSE
IH3=1
_SUCHRAD2:IH4=_KL[IH3,2] MOD 10
IF IH4>1
_GER[4-LP]=HH4 _GER[6-LP]=HH4
_FLAG=INTERSEC(_KL[IH3],_GER,SEC)
IF _FLAG
TIEF=ABS(HH5-SEC[LP]-_IS[1-LP]*(1/MF[LP]+FAL1))
GOTOF _ME4
ENDIF
ELSE
IH3=IH3+1
IF IH3>=9
GOTOF _ME4
ELSE
GOTOB _SUCHRAD2
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF JJ==0
TIEF=ABS(HH5-PP[10,LP]-_IS[1-LP]/MF[1-LP])
ELSE
TIEF=ABS(HH5-PP[11,LP]-_IS[1-LP]/MF[1-LP])
ENDIF
ENDIF
_ME4:KK=TRUNC(TIEF/IDEPL)
IF _IS[6]<>0
IF ABS(PP[8,1-LP]-PP[9,1-LP])>=(BWZ-_WZR*2)
_IS[6]=0
ELSE
PP[13,1-LP]=PP[12,1-LP]-HH6/ABS(HH6)*BWZ
IF (II MOD 2 ==0) AND (JJ>= II/2)
PP[13,1-LP]=PP[13,1-LP]+HH1
ENDIF
IF (_KL[2,4-LP]-PP[13,1-LP])*(_KL[2,6-LP]-PP[13,1-LP])<0
_IS[7]=2
ELSE
_IS[7]=2
ENDIF
ENDIF
ENDIF
_M5212:
IF (TIEF/IDEPL-KK)==0 GOTOF _MDD4
KK=KK+1
N021 _MDD4:HH3=-TIEF/KK*IH2
IF ((LP==1) AND (STA1<>0)) OR ((LP==0) AND (STA1<>90))
IF (( JJ==0 ) AND (ABS(HOE-HH5)>(1+2*_WZR)))
N41 G0 AX[_ZA]=(HH5+_VRTI[0]*(1+2*_WZR))*_ZAF AX[_SA]=HH4*_SAF
N41 G1 AX[_ZA]=HH5*_ZAF AX[_SA]=HH4*_SAF
ELSE
N41 G1 AX[_ZA]=HH5*_ZAF AX[_SA]=HH4*_SAF
ENDIF
ELSE
N41 G0 AX[_ZA]=HH15*_ZAF AX[_SA]=HH4*_SAF
ENDIF
_MEX4:HH7=HH7+HH3
IF (_ARTIS[11]==3)
_ARTIS[10]=_ARTIS[10]+1
IF ((_ARTIS[6]<>0) AND (_ARTIS[10]==_ARTIS[14]))
_ARTIS[4]=_ARTIS[14] _ARTIS[5]=_ARTIS[14]
IF (_ARTIS[14]+_ARTIS[6]<=_SC_TOOL_VALI[5])
_ARTIS[14]=_ARTIS[14]+_ARTIS[6]
ENDIF
ENDIF
IF (_ARTIS[10]==_ARTIS[4])
M=QU(_ARTIS[7])
ENDIF
ENDIF
N42 G1 AX[_ZA]=HH7*_ZAF
IF (_ARTIS[11]==3)
IF (_ARTIS[10]==_ARTIS[5])
M=QU(_ARTIS[8])
ENDIF
ENDIF
IH1=IH1+1
IF ((_IS[8]==1) AND (IH1==KK)AND(JJ==II-1))
N431 AX[_ZA]=(HH7+RWEG)*_ZAF
N432 G91 AX[_SA]=(-HH1/2)*_SAF
N433 G90 AX[_ZA]=(PP[3,LP]+FAL1*_IS[1-LP])*_ZAF
ENDIF
IF IH1==KK GOTOF _MFX4
N43 AX[_ZA]=(HH7+RWEG)*_ZAF
GOTOB _MEX4
_MFX4:G4 F=DTB
IF JJ<>II-1 GOTOF _MG4
IF (II==2) OR (RCI2==0) GOTOF _MG4
IF ABS(PP[9,1-LP]-PP[8,1-LP])<BWZ GOTOF _MG4
_H1=ABS($P_EP[_SA]*_INCHFAK-PP[9,1-LP]*_SAF)
_H1=_H1*HH8 HH5=HH5+_H1 HH15=HH15+_H1
_MG4:IF JJ==0 GOTOF _MGX4
IF ABS(HH1)>=1/MF[1-LP] GOTOF _MHX4 IF ABS(HH1)<0.1/MF[1-LP] GOTOF _MLX4
IF JJ==1
HH6=HH6*(ABS(HH1)-0.1)
ENDIF
GOTOF _MHX4
_MLX4:HH6=HH6*0.9*ABS(HH1)
_MHX4:
IF _IS[2]==0
N44 G0 G91 AX[_ZA]=_RWS*_ZAF AX[_SA]=HH6*_SAF
HH5=HH5+HH8 HH15=HH15+HH8
ENDIF
_MGX4:
IF _ZZSD[4]==0
N45 G90 AX[_ZA]=HH15*_ZAF
ELSE
N45 G0 G90 AX[_ZA]=HH15*_ZAF
ENDIF
JJ=JJ+1
IF JJ<_IS[3]
_IS[2]=1
ELSE
_IS[2]=0
ENDIF
IF _SC_TOOL_VALI[0]<>0
_ARTIS[0]=_SC_TOOL_VALI[0] _ARTIS[1]=_SC_TOOL_VALI[1] _ARTIS[2]=_SC_TOOL_VALI[2] _ARTIS[3]=_SC_TOOL_VALI[3] _ARTIS[4]=_SC_TOOL_VALI[4] _ARTIS[5]=_SC_TOOL_VALI[5] _ARTIS[6]=_SC_TOOL_VALI[6]
_ARTIS[9]=0 _ARTIS[10]=0
IF (_ARTIS[3]<>0)
_ARTIS[13]=_ARTIS[1]
ENDIF
IF (_ARTIS[6]<>0)
_ARTIS[14]=_ARTIS[4]
ENDIF
ENDIF
IF (NOT((_IS[5]==1) OR (HH1==0))) AND (JJ<II) GOTOB _MCX4
IF (_IS[5]==2) AND (ANG1==0) AND (ANG2==0)
IF (RCO1==0) AND (RCO2==0)
GOTOF _ML6
ELSE
N450 D=DD[0]
IF (_IS[9]==1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_SA,BWZ*(-_IS[LP]))
ENDIF
DL=_DL_NUM
GOTOF _MAX6
ENDIF
ENDIF
IF (_IS[5]==1) AND (FAL1==0) AND (RCO1==0) AND (RCO2==0) AND(ANG1==0) AND (ANG2==0)GOTOF _ML6
IF (_IS[5]==1) AND (ANG1==0) AND (ANG2==0)
HH6=0
N401 D=DD[0]
IF (_IS[9]==1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_SA,BWZ*(-_IS[LP]))
ENDIF
DL=_DL_NUM
GOTOF _MAX6
ENDIF
HH6=0.1*_INCHFAK
HH4=_IS[LP] HH6=ABS(PP[7,LP]-PP[11,LP]) HH5=HH6*TAN(ANG2) II=HH5/HH2+0.499 HH1=II
IF II==0 GOTOF _MCX5
HH6=HH6+ABS(HH4)*_VRT/MF[LP] HH5=HH6*TAN(ANG2) HH1=-HH5/II*HH4
_MCX5:HH6=ABS(PP[0,LP]-PP[10,LP]) HH5=HH6*TAN(ANG1) KK=HH5/HH2+0.499 HH3=KK
IF KK==0 GOTOF _MDX5
HH6=HH6+ABS(HH4)*_VRT/MF[LP] HH5=HH6*TAN(ANG1) HH3=HH5/KK*HH4
_MDX5:IH1=0 HH4=PP[11,1-LP] HH5=HH4 HH6=_WZR*_INCHFAK*RWEG/ABS(RWEG)+PP[11,LP]
HH8=PP[11,0]*MNP[0]+MNP[1] HH18=HH8-_RWS+RWEG
_GG7F=1
IF LP GOTOF _MFX5
HH8=(PP[11,1]-MNP[1])/MNP[0] HH18=HH8-_RWS+RWEG
_MFX5:IF (ANG2==0)AND(IH1==0) GOTOF _MLX5
_MFXF5:
IF IH1==0
HH4=HH4+HH1
ENDIF
HH7=MNP[0]*HH4+MNP[1]
IF LP GOTOF _MGX5
HH7=(HH4-MNP[1])/MNP[0]
_MGX5:HH17=HH7-_RWS+RWEG
IF IH1==1
HH4=HH4+HH1
ENDIF
IF FAL2==0
IF (IH1==0) AND (KK==1) AND (RCI2==0) AND (ABS(PP[7,1-LP]-PP[4,1-LP])<BWZ)
GOTOF _MLX5
ENDIF
IF (IH1==1) AND (II==1) AND (RCI1==0) AND (ABS(PP[0,1-LP]-PP[3,1-LP])<BWZ)
GOTOF _MAX6
ENDIF
ELSE
IF (IH1==0) AND (RCI2==0) AND (ANG2==0)
GOTOF _MLX5
ENDIF
IF ((IH1==1) AND (RCI1==0)) AND (ANG1==0)
GOTOF _MAX6
ENDIF
ENDIF
IF (_WZR>0) AND (IH2==1)
N49 G0 G91 AX[_ZA]=_IS[1-LP]*_WZR
ENDIF
N5 G0 G90 G[7]=_GG7F G[10]=_GG10 AX[_SA]=HH4*_SAF AX[_ZA]=HH17*_ZAF
N50 _MA5:G1 AX[_SA]=HH5*_SAF AX[_ZA]=HH6*_ZAF
N51 G4 F=DTB
IF NOT((IH1==1)AND(II<=1)) GOTOF _MG5
IF (_IS[4]==2) OR (RCI1==0) GOTOF _MG5
IF ABS(PP[9,1-LP]-PP[8,1-LP])<BWZ GOTOF _MG5
N510 G1 G40 AX[_ZA]=PP[8,LP]*_ZAF AX[_SA]=PP[8,1-LP]*_SAF
N52 _MG5:G0 G40 G90 AX[_ZA]=HH18*_ZAF
II=II-1
IF II>0 GOTOB _MFX5 IF IH1==1 GOTOF _MAX6
_MLX5:II=KK HH1=HH3 IH1=1 HH5=PP[10,1-LP] HH4=HH5 HH6=_WZR*_INCHFAK*RWEG/ABS(RWEG)+PP[10,LP]
HH8=PP[10,0]*MNP[0]+MNP[1] _H1=-HH1*MNP[0]
N53 D=DD[0]
IF (_IS[9]==1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_SA,BWZ*(-_IS[LP]))
ENDIF
DL=_DL_NUM
IF LP GOTOF _MP5
HH8=(PP[10,1]-MNP[1])/MNP[0] _H1=-HH1/MNP[0]
_MP5:HH8=HH8+_H1 HH18=HH8-_RWS+RWEG
IF ANG1 GOTOB _MFXF5
IF _IS[5]==2 GOTOF _ML6
_MAX6:
_MAXX6:IF ABS(PP[8,1-LP]-MPK)<=ABS(PP[3,1-LP]-MPK) GOTOF _A6
PP[8,1-LP]=PP[3,1-LP]
_A6:IF ABS(PP[9,1-LP]-MPK)<=ABS(PP[4,1-LP]-MPK) GOTOF _B6
PP[9,1-LP]=PP[4,1-LP]
_B6:HH7=_IS[LP] HH1=PP[1,1-LP] HH2=PP[0,1-LP] HH3=PP[6,1-LP] HH4=PP[7,1-LP]
IF ANG1>0 GOTOF _MC6
HH1=PP[3,1-LP]
_MC6:IF ANG2>0 GOTOF _MD6
HH3=PP[4,1-LP]
_MD6:IF NOT(ABS(RCO1)+ABS(RCI1)==0) GOTOF _MA6
HH1=PP[8,1-LP]
_MA6:IF NOT(ABS(RCO2)+ABS(RCI2)==0) GOTOF _MB6
HH3=PP[9,1-LP]
_MB6:HOE=HOE+_IS[1-LP]*_WZR
N6 G0 G90 G64 AX[_ZA]=HOE*_ZAF
_H1=(_WZR*2+1)*_INCHFAK
IF _IS[9]<>1
N6101 G0 AX[_SA]=HH2*_SAF
ENDIF
IF _IS[10]==0
IF ABS(HOE-PP[0,LP])>_H1
N6110 G[7]=_GG7B AX[_ZA]=(PP[0,LP]+_IS[1-LP]*_H1)*_ZAF AX[_SA]=HH2*_SAF
N6111 G1 AX[_ZA]=PP[0,LP]*_ZAF AX[_SA]=HH2*_SAF
ELSE
N6112 G1 G[7]=_GG7B AX[_ZA]=PP[0,LP]*_ZAF AX[_SA]=HH2*_SAF
ENDIF
II=LL[0]
ENDIF
IF _IS[10]==1
IF ABS(HOE-PP[0,LP])>_H1
N6120 G[7]=_GG7B AX[_ZA]=(PP[0,LP]+_IS[1-LP]*_H1)*_ZAF AX[_SA]=(HH2+$P_TOOLR*HH7)*_SAF
N6121 G1 AX[_ZA]=PP[0,LP]*_ZAF AX[_SA]=(HH2+$P_TOOLR*HH7)*_SAF
ELSE
N6122 G1 G[7]=_GG7B AX[_ZA]=PP[0,LP]*_ZAF AX[_SA]=HH2*_SAF+$P_TOOLR*HH7
ENDIF
II=LL[0]
HH1=ABS(RCO1)
IF RCO1>0
N6130 G1 G90 AX[_SA]=EK[0,1-LP]*_SAF AX[_ZA]=EK[0,LP]*_ZAF RND=HH1+$P_TOOLR
ELSE
IF (VARI DIV 10)==1
N6131 G1 G90 AX[_SA]=EK[0,1-LP]*_SAF AX[_ZA]=EK[0,LP]*_ZAF CHR=HH1+$P_TOOLR*0.612
ELSE
N6132 G1 G90 AX[_SA]=EK[0,1-LP]*_SAF AX[_ZA]=EK[0,LP]*_ZAF CHF=HH1+$P_TOOLR*0.866
ENDIF
ENDIF
HH1=ABS(RCI1)-$P_TOOLR
IF HH1<=0
HH1=0.01*_INCHFAK
ENDIF
IF RCI1>0
N6140 G1 AX[_SA]=EK[1,1-LP]*_SAF AX[_ZA]=EK[1,LP]*_ZAF RND=HH1
ELSE
IF (VARI DIV 10)==1
HH1=ABS(RCI1)-$P_TOOLR/1.414
IF HH1<0
HH1=0
ENDIF
N6141 G1 AX[_SA]=EK[1,1-LP]*_SAF AX[_ZA]=EK[1,LP]*_ZAF CHR=HH1
ELSE
N6142 G1 AX[_SA]=EK[1,1-LP]*_SAF AX[_ZA]=EK[1,LP]*_ZAF CHF=HH1
ENDIF
ENDIF
N6150 G1 AX[_SA]=(MPK+(BWZ/2)*_IS[LP])*_SAF
GOTOF _M5210
ENDIF
_MGX6:
IF II==_IS[6]
_KR[II,5+LP]=PP[12,LP] _KR[II,6-LP]=PP[12,1-LP]
ENDIF
IF (_IS[5]==1) AND (II==2)
_KR[II,5+LP]=_KR[II,5+LP]+RWEG/ABS(RWEG)*_WZR*_INCHFAK
ENDIF
_KR[II,3+LP]=_KR[II,3+LP]*_ZAF _KR[II,5+LP]=_KR[II,5+LP]*_ZAF _KR[II,9+LP]=_KR[II,9+LP]*_ZAF
_KR[II,4-LP]=_KR[II,4-LP]*_SAF _KR[II,6-LP]=_KR[II,6-LP]*_SAF _KR[II,10-LP]=_KR[II,10-LP]*_SAF
N6160 EXECTAB(_KR[II])
IF II==_IS[6] GOTOF _M5210
II=II-1
IF _IS[4]==2
IF (RCI1<>0) AND (II==2)
IF NOT(_BRG>=BWZ)
G4 S1
GOTOF _ML6NEU
ENDIF
ENDIF
IF (RCI1<>0) AND (II==1)
GOTOF _M5210
ENDIF
ENDIF
IF II>1 GOTOB _MGX6
_M5210:
IF (_BRG-2*FAL2>2*BWZ)
N6200 G1 G90 G64 AX[_SA]=MPK*_SAF
N6201 G0 G90 G40 AX[_ZA]=HOE*_ZAF AX[_SA]=MPK*_SAF
GOTOF _ML6NEU
ENDIF
IF (_BRG-2*FAL2>BWZ)
IF _GG7>1
N6210 G1 G90 G64 AX[_SA]=(MPK+(_BWZG-_BRG/2)*HH7)*_SAF
ELSE
N6211 G1 G91 G64 AX[_SA]=-((_BRG-BWZ)/2-FAL2)*HH7/_SAF
ENDIF
N6212 G0 G90 AX[_ZA]=HOE*_ZAF
N6213 G0 G90 G40 AX[_ZA]=HOE*_ZAF AX[_SA]=MPK*_SAF
GOTOF _ML6NEU
ENDIF
IF _GG7>1
IF (_BRG-_BWZG)/2>FAL2
N6220 G1 G90 G64 AX[_SA]=MPK*_SAF
ELSE
N6221 G1 G91 G64 AX[_SA]=-((_BRG-_BWZG)/2)*HH7/_SAF
ENDIF
N6222 G0 G90 G40 AX[_ZA]=HOE*_ZAF AX[_SA]=MPK*_SAF
GOTOF _ML6NEU
ELSE
IF (_BRG-_BWZG)/2>FAL2
N6230 G1 G91 G64 AX[_SA]=-((_BRG-_BWZG)/2-FAL2)*HH7/_SAF
ELSE
N6231 G1 G91 G64 AX[_SA]=-((_BRG-_BWZG)/2)*HH7/_SAF
ENDIF
N6232 G0 G90 AX[_ZA]=HOE*_ZAF
ENDIF
_ML6NEU:
IF (_IS[9]==1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_SA,-BWZ*(-_IS[LP]))
ENDIF
IF (_IS[5]==1) AND (RCO2==0) AND (ANG2==0) AND (FAL2==0) GOTOF _ML6
IF DD[2]==1
N6301 T0 D1
ELSE
N6302 D=DD[1]
DL=_DL_NUM
ENDIF
IF _IS[9]<>1
N6400 G0 AX[_SA]=HH4*_SAF
ELSE
N6402 AX[_SA]=(HH3+_IS[1-LP]*FAL2)*_SAF
ENDIF
IF _IS[10]==0
IF ABS(HOE-PP[7,LP])>_H1
N6410 G0 G[7]=_GG7 AX[_ZA]=(PP[7,LP]+_IS[1-LP]*_H1)*_ZAF AX[_SA]=HH4*_SAF
N6411 G1 AX[_ZA]=PP[7,LP]*_ZAF AX[_SA]=HH4*_SAF
ELSE
N6412 G[7]=_GG7 AX[_ZA]=PP[7,LP]*_ZAF AX[_SA]=HH4*_SAF
ENDIF
II=LL[1]
ENDIF
IF _IS[10]==1
IF ABS(HOE-PP[7,LP])>_H1
N6420 G0 G[7]=_GG7 AX[_ZA]=(PP[7,LP]+_IS[1-LP]*_H1)*_ZAF AX[_SA]=(HH4-$P_TOOLR*HH7)*_SAF
N6421 G1 AX[_ZA]=PP[7,LP]*_ZAF AX[_SA]=(HH4-$P_TOOLR*HH7)*_SAF
ELSE
N6422 G[7]=_GG7 AX[_ZA]=PP[7,LP]*_ZAF AX[_SA]=HH4*_SAF-$P_TOOLR*HH7
ENDIF
II=LL[1]
HH1=ABS(RCO2)
IF RCO2>0
N6430 G1 G90 AX[_SA]=EK[3,1-LP]*_SAF AX[_ZA]=EK[3,LP]*_ZAF RND=HH1+$P_TOOLR
ELSE
IF (VARI DIV 10)==1
N6431 G1 G90 AX[_SA]=EK[3,1-LP]*_SAF AX[_ZA]=EK[3,LP]*_ZAF CHR=HH1+$P_TOOLR*0.612
ELSE
N6432 G1 G90 AX[_SA]=EK[3,1-LP]*_SAF AX[_ZA]=EK[3,LP]*_ZAF CHF=HH1+$P_TOOLR*0.866
ENDIF
ENDIF
HH1=ABS(RCI2)-$P_TOOLR
IF HH1<=0
HH1=0.01*_INCHFAK
ENDIF
IF RCI2>0
N6440 G1 AX[_SA]=EK[2,1-LP]*_SAF AX[_ZA]=EK[2,LP]*_ZAF RND=HH1
ELSE
IF (VARI DIV 10)==1
HH1=ABS(RCI1)-$P_TOOLR/1.414
IF HH1<0
HH1=0
ENDIF
N6441 G1 AX[_SA]=EK[2,1-LP]*_SAF AX[_ZA]=EK[2,LP]*_ZAF CHR=HH1
ELSE
N6442 G1 AX[_SA]=EK[2,1-LP]*_SAF AX[_ZA]=EK[2,LP]*_ZAF CHF=HH1
ENDIF
ENDIF
N6443 G1 AX[_SA]=(MPK-(BWZ/2)*_IS[LP])*_SAF
GOTOF _M5211
ENDIF
_MK6:
IF II==_IS[7]
_KL[II,5+LP]=PP[13,LP] _KL[II,6-LP]=PP[13,1-LP]
ENDIF
IF (_IS[5]==1) AND (II==2)
_KL[II,5+LP]=_KL[II,5+LP]+RWEG/ABS(RWEG)*_WZR*_INCHFAK
ENDIF
_KL[II,3+LP]=_KL[II,3+LP]*_ZAF _KL[II,5+LP]=_KL[II,5+LP]*_ZAF _KL[II,9+LP]=_KL[II,9+LP]*_ZAF
_KL[II,4-LP]=_KL[II,4-LP]*_SAF _KL[II,6-LP]=_KL[II,6-LP]*_SAF _KL[II,10-LP]=_KL[II,10-LP]*_SAF
N6450 EXECTAB(_KL[II])
IF II==_IS[7]
GOTOF _M5211
ENDIF
II=II-1
IF _IS[4]==2
IF (RCI2<>0) AND (II==2)
IF NOT(_BRG>=BWZ)
G4 S1
GOTOF _ML6
ENDIF
ENDIF
IF (RCI2<>0) AND (II==1)
GOTOF _M5211
ENDIF
ENDIF
IF II>1 GOTOB _MK6
_M5211:
IF (_BRG-2*FAL2>2*BWZ)
N6500 G1 G90 G64 AX[_SA]=MPK*_SAF
N6501 G0 G90 G40 AX[_ZA]=HOE*_ZAF AX[_SA]=MPK*_SAF
GOTOF _ML6
ENDIF
IF (_BRG-2*FAL2>BWZ)
IF _GG7>1
N6510 G1 G90 G64 AX[_SA]=(MPK-(_BWZG-_BRG/2)*HH7)*_SAF
ELSE
N6511 G1 G91 G64 AX[_SA]=(ABS(_BRG-BWZ)/2)*HH7/_SAF
ENDIF
N6512 G0 G90 AX[_ZA]=HOE*_ZAF
N6513 G0 G90 G40 AX[_ZA]=HOE*_ZAF AX[_SA]=MPK*_SAF
GOTOF _ML6
ENDIF
IF _GG7>1
IF (_BRG-_BWZG)/2>FAL2
N6520 G1 G90 G64 AX[_SA]=MPK*_SAF
ELSE
N6521 G1 G91 G64 AX[_SA]=((_BRG-_BWZG)/2)*HH7/_SAF
ENDIF
N6522 G0 G90 G40 AX[_ZA]=HOE*_ZAF AX[_SA]=MPK*_SAF
GOTOF _ML6
ELSE
IF (_BRG-_BWZG)/2>FAL2
N6530 G1 G91 G64 AX[_SA]=((_BRG-_BWZG)/2-FAL2)*HH7/_SAF
ELSE
N6531 G1 G91 G64 AX[_SA]=((_BRG-_BWZG)/2)*HH7/_SAF
ENDIF
N6532 G0 G90 AX[_ZA]=HOE*_ZAF
ENDIF
_ML6:
IF (_ARTIS[0]<>0)
M=QU(_ARTIS[8])
ENDIF
N6600 D=LL[2]
DL=_DL_NUM
$P_CYCFRAME=_RE_CYCFR
RET
FEHL1:STOPRE
N709301 SETAL(61602)
_MX7:RET
FEHL2:STOPRE
N709302 SETAL(61603)
RET
FEHL3:STOPRE
N709303 SETAL(61000)
RET
FEHL4:STOPRE
N709304 SETAL(61002)
RET
_FEHL5:STOPRE
N709305 SETAL(61610)
RET
_FEHL6:
N709306 SETAL(62106)
RET
_FEHL7:STOPRE
N709307 SETAL(61019,"FAL2")
RET
_FEHL8:
N709308 SETAL(61328)
RET
_FEHL9:STOPRE
N709309 SETAL(61025)
RET
_FEHL10: STOPRE
N7093010 SETAL(61212)
RET
_FEHL11: STOPRE
SETAL(61006)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_STORE_TOOL_SPF
PROC STORE_TOOL SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.05.01.00 ;DATE: 2011-05-12
;Store tool
IF(_E_SM_PRG)
E_TFS("0",,,,,,,4)
ENDIF
IF(_E_ST_PRG)
F_TFS("0",,,,,,,2,6)
ENDIF
RET

