;----------------------------------------------------------
;
;@(#)$program_version_id:V06.24.00.00 15/07/24 15:00:00, ShopMill Cycles,
;
;----------------------------------------------------------
;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CI_CO_SPF
PROC E_CI_CO(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,STRING[70] _NAME,INT _BA,REAL _R1,REAL _Z0,REAL _Z1,INT _Z1A,REAL _DXY,REAL _DZ,REAL _UXY,REAL _UZ,REAL _X,REAL _Y,REAL _FZ,INT _FZA,REAL _FZR,REAL _RP,REAL _SC,INT _DIR,STRING[21] _CHECK1,STRING[21] _CHECK2,INT _ST,INT _METRIC,REAL _SCAL_XY,REAL _SCAL_Z,STRING[70] _NAME_DR,INT _DXYA,REAL _MAX_R,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.06.01.00 ;DATE: 2012-03-22
;ShopMill contour pintle
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
_ST=_ST+100
N10 E_CP_CO(_T,_TF,_DD,_F,_FAA,_S,_SA,_NAME,_BA,,_Z0,_Z1,_Z1A,_DXY,_DZ,_UXY,_UZ,_X,_Y,_FZ,_FZA,_FZR,,,,,,_ST,,,,,_DXYA,,_FS,_ZFS,_ZFSA)
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CI_RE_SPF
PROC E_CI_RE(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,STRING[70] _NAME,REAL _R1,REAL _R2,REAL _Z0,REAL _Z1,INT _Z1A,REAL _DXY,REAL _DZ,REAL _UXY,REAL _UZ,REAL _RP,REAL _SC,INT _DIR,STRING[21] _CHECK1,STRING[21] _CHECK2,INT _ST,STRING[32] _TR,INT _DR,INT _METRIC,REAL _SCAL_XY,REAL _SCAL_Z,INT _DXYA,REAL _X, REAL _Y) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.15.00 ;DATE: 2009-04-21
;ShopMill contour pintle residual material
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF($P_SUBPAR[30]==0)
_X=_SC_NO_VAL
_Y=_SC_NO_VAL
ENDIF
_ST=_ST+100
N10 E_CP_RE(_T,_TF,_DD,_F,_FAA,_S,_SA,_NAME,,,_Z0,_Z1,_Z1A,_DXY,_DZ,_UXY,_UZ,,,,,,_ST,_TR,_DR,,,,_DXYA,_X,_Y)
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CLAMP_SPF
PROC E_CLAMP(INT _NPV,INT _PREV,INT _ACT,INT _NEXT) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.05.01.00 ;DATE: 2011-05-11
;ShopMill: Multiple clampings
N100 CUST_CLAMP(_NPV,_PREV,_ACT,_NEXT)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CON_SPF
PROC E_CON(STRING[140] _KNAME,INT _TYPE,STRING[32] _LAB1,STRING[32] _LAB2) DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.01.00 ;DATE: 2008-10-16
;ShopMill Contour definitions for Roughing and Pockets
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF(_TYPE==0)
CYCLE62("/_N_WKS_DIR/_N_CONTOUR_WPD/_N_"<<_KNAME<<"_MPF",0);
ELSE
CYCLE62(_KNAME,1);
ENDIF
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CONFIG_SPF
PROC E_CONFIG(INT _ST,INT _TA,REAL _SC,REAL _RP,INT _DIR,INT _POS_RP,REAL _X0,REAL _Y0,REAL _Z0,REAL _X1,REAL _Y1,REAL _Z1,INT _NPV,INT _BLA,INT _N,REAL _L,INT S_CHUCK,INT S_RP_T,INT S_ST_T,REAL S_XRA,REAL S_ZRA,REAL S_XRI,REAL S_ZRI,REAL S_XRR,REAL S_S2) DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.06.07.00 ;DATE: 2012-12-05
;ShopMill: Settings
_ST=_ST B_OR 'H18000000'
_ST=_ST B_AND (B_NOT 'H0040')
E_HEAD(_ST,_X0,_Y0,_Z0,_X1,_Y1,_Z1,,_TA,_SC,_RP,_DIR,_POS_RP,,,_NPV,_BLA,_N,_L,S_CHUCK,S_RP_T,S_ST_T,S_XRA,S_ZRA,S_XRI,S_ZRI,S_XRR,S_S2)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CP_CE_SPF
PROC E_CP_CE(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,STRING[70] _NAME,REAL _Z0,REAL _Z1,INT _Z1A,INT _ST,INT _METRIC,REAL _SCAL_XY,REAL _SCAL_Z,REAL _MAX_R,STRING[32] _TR,INT _DR,REAL _DXY,REAL _UXY,INT _DXYA,STRING[21] _CHECK1,STRING[21] _CHECK2,REAL _X,REAL _Y,INT _BA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.19.00 ;DATE: 2011-07-06
;ShopMill contour pocket pre centering
DEF AXIS _ZZ
DEF INT _VARI
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
_ST=_ST+100
N10 E_CP_DR(_T,_TF,_DD,_F,_FAA,_S,_SA,_NAME,_Z0,_Z1,_Z1A,,_ST,,,,,_TR,_DR,_DXY,_UXY,_DXYA,,,_X,_Y,_BA)
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CP_CO_SPF
PROC E_CP_CO(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,STRING[70] _NAME,INT _BA,REAL _R1,REAL _Z0,REAL _Z1,INT _Z1A,REAL _DXY,REAL _DZ,REAL _UXY,REAL _UZ,REAL _X,REAL _Y,REAL _FZ,INT _FZA,REAL _FZR,REAL _RP,REAL _SC,INT _DIR,STRING[21] _CHECK1,STRING[21] _CHECK2,INT _ST,INT _METRIC,REAL _SCAL_XY,REAL _SCAL_Z,STRING[70] _NAME_DR,INT _DXYA,REAL _MAX_R,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill contour pocket
DEF AXIS _ZZ
DEF INT _VARI,_GMODE,_DMODE,_AMODE,_BA02,_P29
DEF REAL _FAK1,_FAK2
DEF FRAME _CYC_FR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
_VARI=_BA B_AND 'B111'
IF(_VARI==2)
_VARI=3
ENDIF
IF(_FZA>=1)
_VARI=_VARI+10*(_FZA-1)
ENDIF
_VARI=_VARI+1000*_ST
IF(_BA B_AND 'B10000000')
_VARI=_VARI+10000
ENDIF
_GMODE=0
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FZA==0)
_DMODE=10
ELSE
_DMODE=20
ENDIF
ELSE
IF(_FZA==0)
_DMODE=20
ELSE
_DMODE=10
ENDIF
ENDIF
_DMODE=_DMODE+100
IF((_ST DIV 100) MOD 10)
_DMODE=_DMODE+100
ENDIF
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
_AMODE=0
IF(_Z1A==91)
_AMODE=_AMODE+1
ENDIF
IF(_DXYA==1)
_AMODE=_AMODE+10
ENDIF
IF(_ZFSA==91)
_AMODE=_AMODE+100
ENDIF
IF(((_BA B_AND 'H100')=='H100')AND(((_BA B_AND 'H7')=='H1')OR((_BA B_AND 'H7')=='H2')))OR(_FZA==2)
_AMODE=_AMODE+1000
ENDIF
_NAME="/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_NAME<<"_MPF"
_BA02=_BA B_AND 'B111'
IF((_BA B_AND 'B10000000')=='B00000000')OR(_BA02==4)OR(_BA02==5)
_CYC_FR=$P_CYCFRAME
N11 CYCLE63(_NAME,_VARI,_RP,_Z0,_SC,_Z1,_F,_FZ,_DXY,_DZ,_UXY,_UZ,_E_DIR,_X,_Y,_FZR,_FZ,_FZ,_FS,_ZFS,,,0,200,_DMODE,_AMODE)
$P_CYCFRAME=_CYC_FR
_X=_SC_POS[0]*_FAK1
_Y=_SC_POS[1]*_FAK1
ENDIF
N20 E_SP_RP(2,_RP,_X,_Y,_RP)
N30 CYCLE63(_NAME,_VARI,_RP,_Z0,_SC,_Z1,_F,_FZ,_DXY,_DZ,_UXY,_UZ,_E_DIR,_X,_Y,_FZR,_FZ,_FZ,_FS,_ZFS,,,0,_GMODE,_DMODE,_AMODE)
SBLON
N40 G0 G90 AX[_ZZ]=_RP
SBLOF
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CP_DR_SPF
PROC E_CP_DR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,STRING[70] _NAME,REAL _Z0,REAL _Z1,INT _Z1A,REAL _UZ,INT _ST,INT _METRIC,REAL _SCAL_XY,REAL _SCAL_Z,REAL _MAX_R,STRING[32] _TR,INT _DR,REAL _DXY,REAL _UXY,INT _DXYA,STRING[21] _CHECK1,STRING[21] _CHECK2,REAL _X,REAL _Y,INT _BA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill contour pocket pre drilling
DEF AXIS _ZZ
DEF INT _VARI,_GMODE,_DMODE,_AMODE,_P29
DEF REAL _FAK1,_FAK2,_SC,_RP
DEF FRAME _CYC_FR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
_VARI=0
_VARI=_VARI+1000*(_ST MOD 10)
IF(_BA B_AND 'H80')
_VARI=_VARI+10000
ENDIF
_GMODE=0
_DMODE=10
IF((_ST DIV 100) MOD 10)
_DMODE=_DMODE+10
ENDIF
_AMODE=0
IF(_Z1A==91)
_AMODE=_AMODE+1
ENDIF
IF(_DXYA==1)
_AMODE=_AMODE+10
ENDIF
IF((_BA B_AND 'H100')=='H100')
_AMODE=_AMODE+1000
ENDIF
_NAME="/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_NAME<<"_MPF"
_CYC_FR=$P_CYCFRAME
N111 CYCLE64(_NAME,_VARI,_RP,_Z0,_SC,_Z1,_F,_DXY,_UXY,_UZ,_E_DIR,_TR,_DR,0,200,_DMODE,_AMODE,_X,_Y)
$P_CYCFRAME=_CYC_FR
N120 E_SP_RP(2,_RP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP)
N130 CYCLE64(_NAME,_VARI,_RP,_Z0,_SC,_Z1,_F,_DXY,_UXY,_UZ,_E_DIR,_TR,_DR,0,_GMODE,_DMODE,_AMODE,_X,_Y)
SBLON
N140 G0 G90 AX[_ZZ]=_RP
SBLOF
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CP_RE_SPF
PROC E_CP_RE(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,STRING[70] _NAME,REAL _R1,REAL _R2,REAL _Z0,REAL _Z1,INT _Z1A,REAL _DXY,REAL _DZ,REAL _UXY,REAL _UZ,REAL _RP,REAL _SC,INT _DIR,STRING[21] _CHECK1,STRING[21] _CHECK2,INT _ST,STRING[32] _TR,INT _DR,INT _METRIC,REAL _SCAL_XY,REAL _SCAL_Z,INT _DXYA,REAL _X, REAL _Y) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill contour pocket residual material
DEF AXIS _ZZ
DEF INT _VARI,_GMODE,_DMODE,_AMODE,_P29
DEF REAL _FAK1,_FAK2
DEF FRAME _CYC_FR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
_VARI=1
_VARI=_VARI+1000*(_ST MOD 10)
_DMODE=1100
IF((_ST DIV 100) MOD 10)
_DMODE=_DMODE+100
ENDIF
_GMODE=0
_AMODE=0
IF(_Z1A==91)
_AMODE=_AMODE+1
ENDIF
IF(_DXYA==1)
_AMODE=_AMODE+10
ENDIF
_NAME="/_N_WKS_DIR/_N_TEMP_WPD/_N_"<<_NAME<<"_MPF"
_CYC_FR=$P_CYCFRAME
N11 CYCLE63(_NAME,_VARI,_RP,_Z0,_SC,_Z1,_F,,_DXY,_DZ,_UXY,_UZ,_E_DIR,,,,,,,,_TR,_DR,0,200,_DMODE,_AMODE)
$P_CYCFRAME=_CYC_FR
N20 E_SP_RP(2,_RP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP)
N30 CYCLE63(_NAME,_VARI,_RP,_Z0,_SC,_Z1,_F,,_DXY,_DZ,_UXY,_UZ,_E_DIR,,,,,,,,_TR,_DR,0,_GMODE,_DMODE,_AMODE)
SBLON
N40 G0 G90 AX[_ZZ]=_RP
SBLOF
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_CR_HEL_SPF
PROC E_CR_HEL(REAL _I,REAL _J,REAL _P,REAL _Z,INT _ST1,INT _ST2,INT _RI,REAL _F1,REAL _F2,REAL _F3,INT _FAA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.01.00 ;DATE: 2008-07-23
;ShopMill: Helix cycle
DEF AXIS _XX,_YY,_ZZ
DEF REAL _F,_FAK1,_X,_Y,_DZ,_II,_JJ,_TURN,_R,_WA,_WD,_WE
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL3
IF(_P<=0) GOTOF _FEHL1
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF (_ST1 B_AND 1==0)
_II=_I
_I=_I+$P_EP[_XX]*_FAK1
ELSE
_II=_I-$P_EP[_XX]*_FAK1
ENDIF
IF (_ST1 B_AND 2==0)
_JJ=_J
_J=_J+$P_EP[_YY]*_FAK1
ELSE
_JJ=_J-$P_EP[_YY]*_FAK1
ENDIF
IF(_I==$P_EP[_XX]*_FAK1)AND(_J==$P_EP[_YY]*_FAK1) GOTOF _FEHL2
IF (_ST1 B_AND 8==0)
_DZ=_Z
_Z=$P_EP[_ZZ]*_FAK1+_Z
ELSE
_DZ=_Z-$P_EP[_ZZ]*_FAK1
ENDIF
IF(_DZ==0) GOTOF _RET
_R=SQRT(POT(_II)+POT(_JJ))
_WA=ATAN2(-_JJ,-_II)
_WD=ABS(_DZ/_P)*360
IF _RI==2
_WE=_WA-_WD
ELSE
_WE=_WA+_WD
ENDIF
_X=_I+_R*COS(_WE)
_Y=_J+_R*SIN(_WE)
_TURN=TRUNC(ABS(_DZ/_P))
IF(_WD<360)
_TURN=0
ENDIF
IF(_WD-_TURN*360)<0.000001
_TURN=_TURN-1
ENDIF
IF(_FAA==1)AND(_ST2 B_AND 'B001')
_F=_F1
ELSE
IF(_FAA==2)AND(_ST2 B_AND 'B010')
_F=_F2
ELSE
IF(_FAA==3)AND(_ST2 B_AND 'B100')
_F=_F3
ELSE
_F=0
_FAA=0
ENDIF
ENDIF
ENDIF
N10 E_TFS(,,,_F,_FAA)
SBLON
IF(_RI==2)
N20 G2 G90 AX[_XX]=_X AX[_YY]=_Y AX[_ZZ]=_Z IP[_XX]=AC(_I) IP[_YY]=AC(_J) TURN=_TURN
ELSE
N30 G3 G90 AX[_XX]=_X AX[_YY]=_Y AX[_ZZ]=_Z IP[_XX]=AC(_I) IP[_YY]=AC(_J) TURN=_TURN
ENDIF
SBLOF
_RET: RET
_FEHL1: STOPRE
N832701 SETAL(61214)
RET
_FEHL2: STOPRE
N832702 SETAL(61213)
RET
_FEHL3: STOPRE
N832703 SETAL(61012)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_SPF
PROC E_DR(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,REAL _Z1,INT _Z1A,REAL _DT,INT _POS,INT _BA,INT _MODE,REAL S_ZA,REAL S_FA,REAL S_ZD,REAL S_FD,REAL S_D3D) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Drilling
DEF AXIS _ZZ
DEF INT _AMODE[3],_GMODE,_PM,_TYP=0,_VARI
DEF REAL _FAK1,_FAK2,_SD,_SC,_Z,_ZREF,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T =_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _Z1=_E_TR[_IDD,6] _Z1A=_E_TR[_IDD,7] _DT=_E_TR[_IDD,8]
_BA=_E_TR[_IDD,9] _MODE=_E_TR[_IDD,10]
S_ZA=_E_TR[_IDD,11] S_FA=_E_TR[_IDD,12] S_ZD=_E_TR[_IDD,13] S_FD=_E_TR[_IDD,14]
_IDD=-1
ENDIF
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
IF(_Z1A==0) OR (_Z1A==1)
IF($P_TOOLNO)
_TYP=$P_AD[1]
ENDIF
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL1
IF($P_TOOLNO>0)AND(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
IF(_Z1A<90)AND($P_AD[24]>0)AND($P_AD[24]<180)
_Z=_Z+$P_TOOLR*_FAK1/TAN($P_AD[24]/2)*_PM
ENDIF
ENDIF
ENDIF
_AMODE[1]=2 _GMODE=0
_AMODE[2]=(_BA B_AND 'B11000')/'B1000'*10
_VARI=(_BA B_AND 'B10000000')/'B10000000'*1000+(_BA B_AND 'B100000000')/'B100000000'*10000
E_SP_ED(_SD)
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
N10 E_TFS(,,,_F,_FAA)
_AMODE[0]=_AMODE[1]+_AMODE[2]+_MODE
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE82(_RTP,_ZREF,_SC,_Z,,_DT,_GMODE,0,_AMODE[0],_VARI,S_ZA,S_FA,S_ZD,S_FD)
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(2,_DD,_F,_FAA,_S,_SA,_Z1,_Z1A,_DT,_BA,_MODE,S_ZA,S_FA,S_ZD,S_FD)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N808201 SETAL(61070)
RET
_FEHL2: STOPRE
N808202 SETAL(61200)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_BGF_SPF
PROC E_DR_BGF(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z1,INT _Z1A,REAL _D,REAL _DF,REAL _V1,REAL _ZR,REAL _FR,INT _FRA,REAL _F2,INT _F2A,REAL _Z2,REAL _DG,REAL _P,INT _PA,REAL _FI,REAL _FM,INT _FZG,INT _FZZ,INT _FZN,REAL _FS,INT _FSA,INT _POS,STRING[20] _PTAB,STRING[20] _PTABA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Drill and thread milling
DEF AXIS _ZZ
DEF INT _PM,_VARI,_CDIR,_INI=1,_FFA,_PITA,_AMODE[3]
DEF REAL _FAK1,_FAK2,_DAM,_SC,_SD,_Z,_ZREF,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T =_E_TS1[_IDD] _TF =_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA =_E_TR[_IDD,6] _Z1 =_E_TR[_IDD,7] _Z1A=_E_TR[_IDD,8]
_DG=_E_TR[_IDD,9] _DF =_E_TR[_IDD,10] _V1 =_E_TR[_IDD,11] _ZR =_E_TR[_IDD,12]
_FR=_E_TR[_IDD,13] _FRA=_E_TR[_IDD,14] _F2A=_E_TR[_IDD,16]
_Z2=_E_TR[_IDD,17] _D =_E_TR[_IDD,18] _P =_E_TR[_IDD,19] _PA =_E_TR[_IDD,20]
_FSA=_E_TR[_IDD,22]
_INI=0
ENDIF
_F2=_E_TR[_IDD,15] _FS=_E_TR[_IDD,21]
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z) _AMODE[1]=0
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
IF((_BA B_AND 'B11000000')=='B10000000')
_AMODE[2]=10 _DAM=_DF
ELSE
IF((_BA B_AND 'B11000000')=='B01000000')
_AMODE[2]=0 _DAM=_DF
ELSE
_AMODE[2]=10 _DAM=_DF*100
ENDIF
ENDIF
_AMODE[0]=_AMODE[1]+_AMODE[2]
_VARI=0
_VARI=_VARI+10*(_BA B_AND 'B000010')/'B000010'
_VARI=_VARI+100*(_BA B_AND 'B100000')/'B100000'
_VARI=_VARI+1000*(_BA B_AND 'B000100')/'B000100'
_VARI=_VARI+10000*(_BA B_AND 'B000001')
IF(_BA B_AND 'B011000'=='B000000')
_CDIR=0
ELSE
IF(_BA B_AND 'B011000'=='B001000')
_CDIR=1
ELSE
_CDIR=4
ENDIF
ENDIF
_FFA=0
IF(_FAA==3)
_FFA=_FFA+1
ENDIF
IF(_FRA==3)
_FFA=_FFA+10
ENDIF
IF(_F2A==2)
_FFA=_FFA+100
ENDIF
IF(_FSA==2)
_FFA=_FFA+1000
ENDIF
IF(_PA _DEC2 == 0)
_PITA=1
ELSE
IF(_PA _DEC1 == 0)
_PITA=1
ELSE
IF(_PA _DEC1 == 1)
_PITA=3
ELSE
IF(_PA _DEC1 == 2)
_PITA=4
ELSE
_PITA=2
ENDIF
ENDIF
ENDIF
ENDIF
E_SP_ED(_SD)
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
N10 E_TFS(,,,_F,_FAA)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE78(_RTP,_ZREF,_SC,_Z,$SCS_DRILL_SPOT_DIST*_FAK1,_D,_ZR,_DG,_P,_PITA,_DAM,_V1,_VARI,_CDIR,_Z2,_F,_FR,_F2,_FS,_FFA,,,,,0,_AMODE[0])
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(8,_DD,_F,_FAA,_S,_SA,_BA,_Z1,_Z1A,_DG,_DF,_V1,_ZR,_FR,_FRA,_F2,_F2A,_Z2,_D,_P,_PA,_FS,_FSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
N807802 SETAL(61200)
RET
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_BOR_SPF
PROC E_DR_BOR(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,REAL _Z1,INT _Z1A,REAL _DT,INT _ST,INT _POS,REAL _A0,REAL _D0,INT _BA,REAL S_D3D) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Boring 2, Turning
; Funktion ist so:
DEF AXIS _XX,_ZZ
DEF INT _PM,_SDIR,_M3_5,_DIR,_AMODE[3],_GMODE
DEF REAL _FAK1,_FAK2,_RPE,_RPA,_RPAP,_POSS,_SC,_SD,_Z,_ZREF,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_XX=$P_AXN1 _ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _Z1=_E_TR[_IDD,6] _Z1A=_E_TR[_IDD,7] _DT=_E_TR[_IDD,8]
_ST=_E_TR[_IDD,9] _A0=_E_TR[_IDD,10] _D0 =_E_TR[_IDD,11] _BA =_E_TR[_IDD,12]
_IDD=-1
ENDIF
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
_M3_5=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF(_M3_5==2)
_SDIR=4
ELSE
_SDIR=3
ENDIF
IF(_D0<0)OR(_A0<0)GOTOF FEHL1
IF (NOT ($SCS_FUNCTION_MASK_DRILL_SET B_AND 'B1000000') )
_POSS=(_A0+2*360+_E_C_DIR*$P_ACTFRAME[_ZZ,RT])MOD 360
ELSE
_POSS=_A0
ENDIF
IF(_ST==1)
_RPE=_D0
_RPA=-_RPE/$P_ACTFRAME[_XX,SC]
_RPAP=-_PM*_RPE/$P_ACTFRAME[_ZZ,SC]
ELSE
_RPA=0
_RPAP=0
ENDIF
_AMODE[1]=2
_GMODE=0
_AMODE[2]=(_BA B_AND 'B11000')/'B1000'*10
E_SP_ED(_SD)
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
N10 E_TFS(,,,_F,_FAA)
_AMODE[0]=_AMODE[1]+_AMODE[2]
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE86(_RTP,_ZREF,_SC,_Z,,_DT,_SDIR,_RPA,0,_RPAP,_POSS,_GMODE,0,_AMODE[0])
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(5,_DD,_F,_FAA,_S,_SA,_Z1,_Z1A,_DT,_ST,_A0,_D0,_BA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
N808602 SETAL(61200)
RET
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
FEHL1:STOPRE
N808601SETAL(61224)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_PEC_SPF
PROC E_DR_PEC(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z1,INT _Z1A,REAL _D,REAL _DF,REAL _U,REAL _DT,INT _POS,REAL _V2,REAL _V3,REAL _FRF,REAL S_D3D) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Deep Hole Drilling
DEF AXIS _ZZ
DEF INT _PM,_TYP,_AMODE[9],_GMODE,_DMODE
DEF REAL _FAK1,_FAK2,_SC,_SD,_Z,_ZREF,_VRT,_RP,_RTP,_DTB,_VARI,_DIS1,_DAM,_FD1,_FDPR,_MDEP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T =_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6] _Z1 =_E_TR[_IDD,7] _Z1A=_E_TR[_IDD,8]
_D =_E_TR[_IDD,9] _DF=_E_TR[_IDD,10] _U =_E_TR[_IDD,11] _DT =_E_TR[_IDD,12]
_V2=_E_TR[_IDD,13] _V3=_E_TR[_IDD,14] _FRF=_E_TR[_IDD,15]
_IDD=-1
ENDIF
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
_FDPR=_D
IF(_Z1A==0) OR (_Z1A==1)
IF($P_TOOLNO)
_TYP=$P_AD[1]
ENDIF
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL1
IF($P_TOOLNO>0)AND(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
IF(_Z1A<90)AND($P_AD[24]>0)AND($P_AD[24]<180)
IF(_FDPR==ABS(_ZREF-_Z))
_FDPR=_FDPR+$P_TOOLR*_FAK1/TAN($P_AD[24]/2)
ENDIF
_Z=_Z+$P_TOOLR*_FAK1/TAN($P_AD[24]/2)*_PM
ENDIF
ENDIF
ENDIF
_AMODE[1]=2 _GMODE=0
E_SP_ED(_SD)
IF(_BA B_AND 'B0001')
_VARI=0 _DTB=0
_VRT=_V2
_AMODE[2]=10
IF(_VRT==0)
_VARI=2 _DTB=1
_AMODE[2]=20
ENDIF
ELSE
_VARI=1
IF(_BA B_AND 'B0010')
_DIS1=_V3 _AMODE[7]=2000000
ELSE
_DIS1=0 _AMODE[7]=1000000
ENDIF
ENDIF
_AMODE[3]=100
_AMODE[4]=(_BA B_AND 'B1100000')/'B100000'*1000
_AMODE[5]=10000
_DAM=_DF _MDEP=_U
_AMODE[6]=(_BA B_AND 'B1100')/'B100'*100000
IF(_AMODE[6]==0)
_DAM=_DAM*100 _AMODE[6]=200000
ENDIF
IF(_AMODE[6]==200000)
IF(_DAM==100)
_MDEP=_FDPR
ENDIF
ENDIF
_FD1=_FRF
_AMODE[8]=(_BA B_AND 'B1100000')/'B100000'
IF(_AMODE[8]==0)
_FD1=100
ENDIF
_AMODE[8]=10000000
_AMODE[0]=_AMODE[1]+_AMODE[2]+_AMODE[3]+_AMODE[4]+_AMODE[5]+_AMODE[6]+_AMODE[7]+_AMODE[8]
_DMODE=0
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
N10 E_TFS(,,,_F,_FAA)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE83(_RTP,_ZREF,_SC,_Z,,,_FDPR,_DAM,_DTB,0,_FD1,_VARI,,_MDEP,_VRT,_DT,_DIS1,_GMODE,_DMODE,_AMODE[0])
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(4,_DD,_F,_FAA,_S,_SA,_BA,_Z1,_Z1A,_D,_DF,_U,_DT,_V2,_V3,_FRF)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N808301 SETAL(61070)
RET
_FEHL2: STOPRE
N808302 SETAL(61200)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_REA_SPF
PROC E_DR_REA(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,REAL _FR,INT _FRA,REAL _Z1,INT _Z1A,REAL _DT,INT _POS,INT _BA,REAL S_D3D) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Reaming
DEF AXIS _ZZ
DEF INT _PM,_AMODE[3]
DEF REAL _FAK1,_FAK2,_SC,_SD,_RP,_RTP,_Z,_ZREF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _FR=_E_TR[_IDD,6] _FRA=_E_TR[_IDD,7] _Z1=_E_TR[_IDD,8]
_Z1A=_E_TR[_IDD,9] _DT=_E_TR[_IDD,10] _BA=_E_TR[_IDD,11]
_IDD=-1
ENDIF
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
_AMODE[1]=2
_AMODE[2]=(_BA B_AND 'B11000')/'B1000'*10
E_SP_ED(_SD)
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
N10 E_TFS(,,,_F,_FAA)
_AMODE[0]=_AMODE[1]+_AMODE[2]
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE85(_RTP,_ZREF,_SC,_Z,,_DT,_F,_FR,,0,_AMODE[0])
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(3,_DD,_F,_FAA,_S,_SA,_FR,_FRA,_Z1,_Z1A,_DT,_BA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
N808501 SETAL(61200)
RET
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_SIN_SPF
PROC E_DR_SIN(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,REAL __Z1,INT _Z1A,REAL _DT,INT _POS,INT _BA,REAL S_D3D) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Centering
DEF AXIS _ZZ
DEF INT _PM,_TYP,_AMODE[3],_GMODE,_Z1AI
DEF REAL _FAK1,_FAK2,_SC,_SD,_RP,_RTP,_Z,_ZREF,_Z1,S_DM
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] __Z1=_E_TR[_IDD,6] _Z1A=_E_TR[_IDD,7] _DT=_E_TR[_IDD,8]
_BA=_E_TR[_IDD,9]
_IDD=-1
ENDIF
_Z=__Z1
IF(_Z1A==2)
IF($P_TOOLNO)
_TYP=$P_AD[1]
ENDIF
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL1
IF($P_TOOLNO>0)AND(_TYP<>205)AND(_TYP<>210)AND(_TYP<>231)AND(_TYP<>240)AND(_TYP<>241)AND(_TYP<>242)AND(_TYP<>250)
IF($P_AD[24]>0)AND($P_AD[24]<180)
_Z=_ZREF-_Z/2/TAN($P_AD[24]/2)
ELSE
_Z=_ZREF
ENDIF
ELSE
_Z=_ZREF
ENDIF
ENDIF
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
_AMODE[1]=2 _GMODE=0
_AMODE[2]=(_BA B_AND 'B11000')/'B1000'*10
E_SP_ED(_SD)
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
IF($MCS_FUNCTION_MASK_DRILL B_AND 'B1000')
IF(_SA==2)
REPEAT S_DM_A S_DM_E
REPEAT S_SV_A S_SV_E
N20 E_TFS(,,,,,_S,1)
ENDIF
ENDIF
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
_AMODE[0]=_AMODE[1]+_AMODE[2]
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE82(_RTP,_ZREF,_SC,_Z,,_DT,_GMODE,0,_AMODE[0])
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5]
S_DM=0
REPEAT S_SV_A S_SV_E
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(1,_DD,_F,_FAA,_S,_SA,__Z1,_Z1A,_DT,_BA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
S_DM_A:
S_DM=0
IF($MCS_FUNCTION_MASK_DRILL B_AND 'B1000')
IF(_Z1A==2)
S_DM=__Z1
ELSE
_Z1=__Z1
_Z1AI=_Z1A
IF(_Z1AI==90)
_Z1=_ZREF-_Z1
_Z1AI=91
ENDIF
IF(_Z1AI==91)
IF($P_TOOLNO)
_TYP=$P_AD[1]
ENDIF
IF(_TYP<200) OR (_TYP>299) GOTOF _FEHL1
IF($P_TOOLNO>0)
IF($P_AD[24]>0)AND($P_AD[24]<180)
S_DM=_Z1*2*TAN($P_AD[24]/2)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
S_DM_E:
S_SV_A:
IF($MCS_FUNCTION_MASK_DRILL B_AND 'B1000')
IF(_SA==2)
IF(_Z1A==2)
S_DM=__Z1
ENDIF
IF(S_DM)
IF(__Z1==0) GOTOF _FEHL3
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]<>3)
_S=1000*_S/($PI*S_DM/_FAK2)
ELSE
_S=12*_S/($PI*S_DM)
ENDIF
ELSE
IF($P_GG[13]<>4)
_S=12*_S/($PI*S_DM/_FAK2)
ELSE
_S=1000*_S/($PI*S_DM)
ENDIF
ENDIF
IF(_S>999999)
_S=999999
ENDIF
_SA=1
ELSE
_S=0
_SA=1
ENDIF
ENDIF
ENDIF
S_SV_E:
_FEHL1: STOPRE
N808101 SETAL(61070)
RET
_FEHL2: STOPRE
N808102 SETAL(61200)
RET
_FEHL3: STOPRE
N808103 SETAL(61217)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_TAP_SPF
PROC E_DR_TAP(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,REAL _Z1,INT _Z1A,REAL _FI,REAL _FM,INT _FZG,INT _FZZ,INT _FZN,INT _POS,INT _SE,INT _BA,REAL _D,REAL _V2,REAL _SR,STRING[20] _PTAB,STRING[20] _PTABA,INT _TECHNO,REAL _DT,REAL S_D3D) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Tapping
DEF AXIS _ZZ
DEF INT _PM,_TYP,_SDIR,_M3_4,_M3_5,_M_SDR,_M_AGF,_DMODE,_AMODE,_PITA,_VARI,S_ENC
DEF REAL _FAK1,_FAK2,_FAK3,_FAK4,_SC,_SD,_Z,_ZREF,_RP,_RTP,_VRT,_F1
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
_FAK4=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK4=$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK4=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _Z1=_E_TR[_IDD,6] _Z1A=_E_TR[_IDD,7] _SE=_E_TR[_IDD,8]
_BA=_E_TR[_IDD,9] _D=_E_TR[_IDD,10] _V2=_E_TR[_IDD,11] _SR=_E_TR[_IDD,12]
_TECHNO=_E_TR[_IDD,13] _DT=_E_TR[_IDD,14]
_IDD=-1
IF(_SR==0)
_SR=_S
ENDIF
IF(_SA==2)
D=_DD
IF($P_TOOLR>0)
IF($MN_SCALING_SYSTEM_IS_METRIC)
_S=1000*_S/($PI*2*$P_TOOLR*_FAK4)
_SR=1000*_SR/($PI*2*$P_TOOLR*_FAK4)
ELSE
_S=12*_S/($PI*2*$P_TOOLR*_FAK4)
_SR=12*_SR/($PI*2*$P_TOOLR*_FAK4)
ENDIF
IF(_S>999999)
_S=999999
ENDIF
IF(_SR>999999)
_SR=999999
ENDIF
ELSE
GOTOF _FEHL1
ENDIF
ENDIF
IF(_FAA _DEC2 == 0)
_PITA=1
ELSE
IF(_FAA _DEC1 == 0)
_PITA=1
ELSE
IF(_FAA _DEC1 == 1)
_PITA=3
ELSE
IF(_FAA _DEC1 == 2)
_PITA=4
ELSE
_PITA=2
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
E_SP_ED(_SD)
IF(_BA B_AND 'B1100000'=='B1000000')
_M_AGF=1
IF($MCS_FUNCTION_MASK_DRILL B_AND 'B100')AND(_BA B_AND 'B10000000'=='B10000000')
S_ENC=11
ELSE
S_ENC=0
ENDIF
ELSE
_M_AGF=0
S_ENC=0
IF(_BA B_AND 'B11'=='B01')
_VARI=1
IF(_BA B_AND 'B1100'=='B1000')
_VRT=_V2
ELSE
IF(_BA B_AND 'B1100'=='B0100')
_VRT=_F
ELSE
IF(_V2==0)
_VRT=_F
ELSE
_VRT=_V2
ENDIF
ENDIF
ENDIF
ELSE
IF(_BA B_AND 'B11'=='B10')
_VARI=2
ELSE
_VARI=0
ENDIF
ENDIF
ENDIF
_DMODE=0
IF(_BA B_AND 'B10000'==0)
_DMODE=_DMODE+1000
ENDIF
_AMODE=2
_M3_5=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF(_M3_5==1)
_AMODE=_AMODE+1000
_M3_4=3
ELSE
IF(_M3_5==2)
_AMODE=_AMODE+2000
_M3_4=4
ELSE
GOTOF _FEHL2
ENDIF
ENDIF
IF(_BA B_AND 'B1100'=='B0100')
_AMODE=_AMODE+1000000
ELSE
_AMODE=_AMODE+2000000
ENDIF
IF(_SE==0)
_M3_4=5
ENDIF
IF(_M_AGF==1)
_SDIR=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF(_SDIR==2)
_M_SDR=3
ELSE
_M_SDR=4
ENDIF
_M3_4=5
S=_S M=7-_M_SDR
ENDIF
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
IF(_M_AGF==0)
N30 CYCLE84(_RTP,_ZREF,_SC,_Z,,0,_M3_4,,_F,0,_S,_SR,3,_PITA,_TECHNO,_VARI,_D,_VRT,,,,,_DMODE,_AMODE)
ELSE
IF(_F1==0)
_F1=$P_F
ELSE
G95 F=_F1
ENDIF
N31 CYCLE840(_RTP,_ZREF,_SC,_Z,,_DT,_M_SDR,_M3_4,S_ENC,,_F,3,_PITA,_TECHNO,,,,,_DMODE,2)
ENDIF
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
S=_SE
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
_SE=_E_TR[_IDD,8] _BA =_E_TR[_IDD,9] _D =_E_TR[_IDD,10] _V2=_E_TR[_IDD,11]
_SR=_E_TR[_IDD,12] _TECHNO=_E_TR[_IDD,13] _DT=_E_TR[_IDD,14]
IF(_FAA _DEC2 == 0)
_F1=_F*_FAK3
ELSE
IF(_FAA _DEC1 == 0)
_F1=_F*_FAK3
ELSE
IF(_FAA _DEC1 == 1)
_F1=_F*$MN_SCALING_VALUE_INCH*_FAK3
ELSE
IF(_FAA _DEC1 == 2)
_F1=_F*$PI*_FAK3
ELSE
_F1=$MN_SCALING_VALUE_INCH/_F*_FAK3
ENDIF
ENDIF
ENDIF
ENDIF
N40 E_TFS(_T,_TF,_DD,_F1,3,_SE,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(6,_DD,_F,_FAA,_S,_SA,_Z1,_Z1A,_SE,_BA,_D,_V2,_SR,_TECHNO,_DT)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
N808400 SETAL(61200)
RET
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N808401 SETAL(61217)
RET
_FEHL2: STOPRE
N808402 SETAL(61293,_T)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_DR_PEC2_SPF
PROC E_DR_PEC2(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z1,INT _Z1A,REAL _D,REAL FRF,REAL _DF,REAL _V1,REAL _V2,REAL _V3,REAL _DT,INT _POS,_E_MAC_DR_PEC2) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Deep Hole Drilling 2
DEF AXIS _ZZ
DEF INT _PM,_GMODE,_DMODE,_M7_8,_MB2,_MB3,_MB5,_MB9,_SDAC,S_SA,S_AMODEI,S_AMODE2I
DEF REAL _FAK1,_FAK2,_SC,_SD,_Z,_ZREF,_RP,_RTP,S_S
DEF STRING[10] S_CON,S_COFF
DEF INT _LOG,_LOG_ON,S_LOGSIZE
DEF STRING[35] _LOG_FILE="/_N_MPF_DIR/_N_LOG_E_DR_PEC2_MPF"
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,S_LOGSIZE)
IF(S_LOGSIZE>20000)
_LOG_ON=0
ENDIF
ENDIF
IF(_LOG_ON)
; DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_DR_PEC2(_OB="<<_OB<<",_BO="<<_BO<<",_IDD="<<_IDD<<",_T="<<_T<<",_TF="<<_TF<<",_DD="<<_DD<<",_F="<<_F<<",_FAA="<<_FAA<<",_S="<<_S<<",_SA="<<_SA<<",")
WRITE(_LOG,_LOG_FILE,"          _BA="<<_BA<<",_Z1="<<_Z1<<",_Z1A="<<_Z1A<<",_D="<<_D<<",FRF="<<FRF<<",_DF="<<_DF<<",_V1="<<_V1<<",_V2="<<_V2<<",_V3="<<_V3<<",_DT="<<_DT<<",_POS="<<_POS<<",")
WRITE(_LOG,_LOG_FILE,"          DTB="<<DTB<<",DTS="<<DTS<<",VARI="<<VARI<<",S_FP="<<S_FP<<",S_SDAC2="<<S_SDAC2<<",S_SV2="<<S_SV2<<",S_SPOS="<<S_SPOS<<",S_ZA="<<S_ZA<<",S_FA="<<S_FA<<",")
WRITE(_LOG,_LOG_FILE,"          S_ZP="<<S_ZP<<",S_FS="<<S_FS<<",S_ZS1="<<S_ZS1<<",S_ZS2="<<S_ZS2<<",S_N="<<S_N<<",S_ZD="<<S_ZD<<",S_FD="<<S_FD<<",S_FR="<<S_FR<<",S_SDAC3="<<S_SDAC3<<",S_SV3="<<S_SV3<<",")
WRITE(_LOG,_LOG_FILE,"          _AMODE="<<_AMODE<<",S_AMODE2="<<S_AMODE2<<",S_AMODE3="<<S_AMODE3<<",S_ZPV="<<S_ZPV<<")")
WRITE(_LOG,_LOG_FILE,"Aufruf aus "<<SUBSTR($P_PROG[$P_STACK-1],3,STRLEN($P_PROG[$P_STACK-1])-3-4))
ENDIF
_ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK2
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK2
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T =_E_TS1[_IDD] _TF =_E_TS2[_IDD]
_DD =_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA =_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA =_E_TR[_IDD,5] _BA =_E_TR[_IDD,6] _Z1 =_E_TR[_IDD,7] _Z1A =_E_TR[_IDD,8]
_D =_E_TR[_IDD,9] FRF =_E_TR[_IDD,10] _DF =_E_TR[_IDD,11] _V1 =_E_TR[_IDD,12]
_V2 =_E_TR[_IDD,13] _V3 =_E_TR[_IDD,14] _DT =_E_TR[_IDD,15] DTB =_E_TR[_IDD,16]
DTS =_E_TR[_IDD,17] VARI =_E_TR[_IDD,18] S_FP =_E_TR[_IDD,19] S_SDAC2 =_E_TR[_IDD,20]
S_SV2 =_E_TR[_IDD,21] S_SPOS =_E_TR[_IDD,22] S_ZA =_E_TR[_IDD,23] S_FA =_E_TR[_IDD,24]
S_ZP =_E_TR[_IDD,25] S_FS =_E_TR[_IDD,26] S_ZS1 =_E_TR[_IDD,27] S_ZS2 =_E_TR[_IDD,28]
S_N =_E_TR[_IDD,29] S_ZD =_E_TR[_IDD,30] S_FD =_E_TR[_IDD,31] S_FR =_E_TR[_IDD,32]
S_SDAC3 =_E_TR[_IDD,33] S_SV3 =_E_TR[_IDD,34] _AMODE =_E_TR[_IDD,35] S_AMODE2=_E_TR[_IDD,36]
S_AMODE3=_E_TR[_IDD,37] S_ZPV =_E_TR[_IDD,38]
_IDD=-1
ENDIF
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
IF(_Z>_ZREF)
_PM=1
ELSE
_PM=-1
ENDIF
E_SP_ED(_SD)
_SDAC=3
IF($P_TOOLNO)
IF((TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4)==2)
_SDAC=4
ENDIF
ENDIF
_GMODE=0
IF(_Z1A<=1)
_GMODE=_GMODE+10
ENDIF
_DMODE=0
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
S_AMODEI=_AMODE
IF(_Z1A MOD 2==0)
S_AMODEI=S_AMODEI+1
ENDIF
S_AMODE2I=S_AMODE2
IF(_FAA==3)
S_AMODE2I=S_AMODE2I+1
ENDIF
IF(_SA==2)
S_AMODE2I=S_AMODE2I+1000000
ENDIF
IF($P_TOOL)
_M7_8=TRUNC($P_AD[25]/1024)MOD 4
IF((_M7_8 B_AND 3)==3)AND($MCS_M_CODE_COOLANT_1_AND_2_ON > -1)
_MB9=$MCS_M_CODE_ALL_COOLANTS_OFF
_MB5=$MCS_M_CODE_COOLANT_1_AND_2_ON
ELSE
IF(_M7_8 B_AND 1)
_MB2=$MCS_M_CODE_COOLANT_1_ON
ENDIF
IF(_M7_8 B_AND 2)
_MB3=$MCS_M_CODE_COOLANT_2_ON
ENDIF
IF(_M7_8==1)OR(_M7_8==2)
_MB9=$MCS_M_CODE_ALL_COOLANTS_OFF
ENDIF
ENDIF
IF(_MB5)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B1000')
S_CON="M=QU("<<_MB5<<")"
ELSE
S_CON="M="<<_MB5
ENDIF
ELSE
IF(_MB2)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B0010')
S_CON="M=QU("<<_MB2<<")"
ELSE
S_CON="M="<<_MB2
ENDIF
ELSE
IF(_MB3)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B0100')
S_CON="M=QU("<<_MB3<<")"
ELSE
S_CON="M="<<_MB3
ENDIF
ENDIF
ENDIF
ENDIF
IF(S_CON<>"")
IF(_MB9)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B0001')
S_COFF="M=QU("<<_MB9<<")"
ELSE
S_COFF="M="<<_MB9
ENDIF
ENDIF
ENDIF
ENDIF
_E_BO=_BO+(_E_BO B_AND 65535)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PM
ELSE
_RTP=_RP-_SD*_PM
ENDIF
N10 E_TFS(,,,_F,_FAA)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE830(_RTP,_ZREF,_SC,_Z1,_D,_DF,DTB,DTS,FRF,VARI,_V1,_V2,_DT,_V3,S_FP,S_SDAC2,S_SV2,_F,_SDAC,_S,S_SPOS,S_ZA,S_FA,S_ZP,S_FS,S_ZS1,S_ZS2,S_N,S_ZD,S_FD,S_FR,S_SDAC3,S_SV3,S_CON,S_COFF,_GMODE,_DMODE,S_AMODEI,S_AMODE2I,S_AMODE3,S_ZPV)
ELSE
N35 G0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] VARI=_E_TR[_IDD,18] S_SDAC2 =_E_TR[_IDD,20]
S_SV2=_E_TR[_IDD,21] S_AMODE2=_E_TR[_IDD,36]
IF((VARI _DEC5)<2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"ohne Pilotbohrung")
ENDIF
S_SA=_SA
S_S=_S
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"mit Pilotbohrung")
ENDIF
IF((S_AMODE2 _DEC8)==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Anfahren mit konstanter Spindeldrehzahl")
ENDIF
S_SA=1+(S_SDAC2*10)
S_S=S_SV2
ELSE
IF((S_AMODE2 _DEC8)==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Anfahren mit konstanter Schnittgeschwindigkeit")
ENDIF
S_SA=2+(S_SDAC2*10)
S_S=S_SV2
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Anfahren mit Spindeldrehzahl in % von der Bohrdrehzahl")
ENDIF
S_SA=1+(S_SDAC2*10)
S_S=_S*S_SV2/100
ENDIF
ENDIF
IF(S_SDAC2==5)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"M5")
ENDIF
S_S=0
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"E_TFS(_T="<<_T<<",_TF="<<_TF<<",_DD="<<_DD<<",_F="<<_F<<",_FAA="<<_FAA<<",S_S="<<S_S<<",S_SA="<<S_SA<<")")
ENDIF
N40 E_TFS(_T,_TF,_DD,_F,_FAA,S_S,S_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(9,_DD,_F,_FAA,_S,_SA,_BA,_Z1,_Z1A,_D,FRF,_DF,_V1,_V2,_V3,_DT,DTB,DTS,VARI,S_FP,S_SDAC2,S_SV2,S_SPOS,S_ZA,S_FA,S_ZP,S_FS,S_ZS1,S_ZS2,S_N,S_ZD,S_FD,S_FR,S_SDAC3,S_SV3,_AMODE,S_AMODE2,S_AMODE3,S_ZPV)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL1
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N808302 SETAL(61200)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_END_SPF
PROC E_END(INT _ST,INT _N,INT _NNR) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.94.00.00.004 ;DATE: 2020-03-23
;ShopMill: End of program
DEF STRING[40] _STR
IF(_E_REPEAT)
_E_REPEAT=0
RET("E_HEAD")
ENDIF
IF($P_STACK==_E_JS_PRG)AND(_ST B_AND 1)
_E_FIRST_PART=0
_E_REPEAT=1
CUST_TECHCYC(235)
GOTOS
ENDIF
IF($P_STACK==_E_JS_PRG)
CUST_TECHCYC(236)
_E_JS_PRG=0
_E_SM_PRG=0
ENDIF
_E_PRG_TYPE[$P_STACK-1]=0
SBLON
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_HEAD_SPF
PROC E_HEAD(INT _ST,REAL _X0,REAL _Y0,REAL _Z0,REAL _X1,REAL _Y1,REAL _Z1,INT _MU,INT _TA,REAL _SC,REAL _RP,INT _DIR,INT _POS_RP,INT _VER,INT _DUMMY,INT _NPV,INT _BLA,INT _N,REAL _L,INT S_CHUCK,INT S_RP_T,INT S_ST_T,REAL _XRA,REAL _ZRA,REAL _XRI,REAL _ZRI,REAL _XRR,REAL _S2) SBLOF DISPLOF PREPRO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.007 ;DATE: 2024-04-23
;ShopMill: Program head
DEF INT _I,_NPV1,_G42,_G52,_G53,_VARI1,_XRAA,_XRAE,_ZRAA,_ZRAE,_XRIA,_XRIE,_ZRIA,_ZRIE
DEF INT _BLT[2,10]=SET(-1,0,5,2,0,0,4,3,1,5, -2,-1,6,1,5,4,7)
DEF REAL _FAK2,_B,_H,_ZB,_A1,_A2
DEF REAL _XA,_ZA,_XI,S_N,S_L,S_B,S_H
DEF STRING[30] _SERR
DEF STRING[40] _STR
DEF INT _LOG,_LOG_ON
DEF STRING[35] _LOG_FILE
_E_PRG_TYPE[$P_STACK-1]=1
IF(_E_JS_PRG==0)
_E_JS_PRG=$P_STACK
_E_SM_PRG=1
ENDIF
_E_MAN=0
IF(NOT(_ST B_AND 'H10000000'))
_SERR=<<$P_PROG_NAME[$P_STACK-1]
IF($P_STACK==_E_JS_PRG)
GOTOF _FEHL1
ELSE
GOTOF _FEHL2
ENDIF
ENDIF
_LOG_FILE="/_N_MPF_DIR/_N_LOG_E_HEAD_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
IF(NOT(_ST B_AND 'H08000000'))AND($P_STACK==_E_JS_PRG)
DELETE(_LOG,_LOG_FILE)
ENDIF
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_HEAD(...)")
WRITE(_LOG,_LOG_FILE,"  _E_S_LINE="<<_E_S_LINE)
ENDIF
IF(NOT(_ST B_AND 'H08000000'))AND($P_STACK==_E_JS_PRG)
CYCLE218(1)
ENDIF
IF(_ST B_AND 'H1000')
_NPV1=_NPV+1
G[8]=_NPV1
ENDIF
IF(_ST B_AND 'H40')
IF(_MU==70)
G70
ELSE
G71
ENDIF
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_ST B_AND 'H80')
CASE _TA OF 18 GOTOF _M18 19 GOTOF _M19 DEFAULT GOTOF _M17
_M17:_E_PLANE=1
GOTOF _MTA
_M18:_E_PLANE=2
GOTOF _MTA
_M19:_E_PLANE=3
_MTA:
IF($P_CUTMODK=="")
N5 G[6]=_E_PLANE
ENDIF
ENDIF
IF(_ST B_AND 'H100')
_E_SC=_SC*1/_FAK2
ENDIF
IF(_ST B_AND 'H200')
_E_RP=_RP*1/_FAK2
ENDIF
IF(_ST B_AND 'H400')
_E_DIR=_DIR
ENDIF
IF(_ST B_AND 'H800')
_E_POS_RP=_POS_RP
ENDIF
IF(NOT(_ST B_AND 'H08000000'))
IF($P_STACK==_E_JS_PRG)
N10 CYCLE210(0)
ENDIF
ENDIF
IF($P_STACK==_E_JS_PRG)OR(_ST B_AND 'H08000000')
IF(S_ST_T B_AND 'H1')
_E_CHUCK=0
IF(S_CHUCK>1)AND(S_CHUCK<=21)
IF(_SC_CHUCK[S_CHUCK-1,0])
_E_CHUCK=S_CHUCK
ELSE
_I=1
WHILE(_I<=20)AND(_E_CHUCK==0)
IF(_SC_CHUCK[_I,0])AND(_SC_CHUCK[_I,1]==3)
_E_CHUCK=_I+1
ENDIF
_I=_I+1
ENDWHILE
IF(_E_CHUCK==0)
_E_CHUCK=2
ENDIF
ENDIF
ELSE
IF(S_CHUCK==1)
_E_CHUCK=1
ELSE
_E_CHUCK=0
ENDIF
ENDIF
IF(_E_CHUCK>1)AND(_SC_CHUCK[_E_CHUCK-1,0])
_E_WP_SOCKET=$MC_AXCONF_CHANAX_NAME_TAB[_SC_CHUCK[_E_CHUCK-1,0]-1]
ENDIF
ENDIF
ENDIF
IF(NOT(_ST B_AND 'H08000000'))
IF($P_STACK==_E_JS_PRG)
IF(_E_FIRST_PART)
N15 CUST_TECHCYC(231)
ENDIF
IF($P_SEARCHL)
IF($P_SEARCHL==2)OR($P_SEARCHL==4)
IF($MCS_FUNCTION_MASK_TECH B_AND 'B1000' == 0)
_SERR="MD 52212 (Bit 3=1)"
GOTOF _FEHL9
ENDIF
ELSE
GOTOF _FEHL10
ENDIF
ENDIF
N20 E_SP_INI(2)
_E_IR=0
_E_BO=0
_E_POS=0
_SC_WO=0
_E_POL_X=_SC_NO_VAL
_E_POL_Y=_SC_NO_VAL
_E_POL_L=_SC_NO_VAL
_E_POL_A=_SC_NO_VAL
_E_POSMU=0
_E_RT[0,0]=REP(0)
_E_RT[0,0]=-1
_F_TAILSTOCK[0]=0
G4F0
MMC("CMM_INTERN,BLOCKOFFSET,0,0","N")
G4F0
WRTPR("BLOCK_OFFSET(0)",1)
ENDIF
IF($PC_TRAFO_TYPE_NAME<>"TRAORI_STAT")AND(NOT _SC_IS_ROBOT)
TRAFOOF
ENDIF
OFFN=0
_E_TS_OFFN=0
_E_TRA_OFFN=0
_E_TRA_AKT=0
_F_TRA_D=0
IF($P_TC)
N50 CUST_800(11,$P_TC)
ENDIF
N70 E_SP_INI(3)
ENDIF
IF($P_STACK==_E_JS_PRG)OR(_ST B_AND 'H08000000')
_VARI1=1
IF(_ST B_AND 'H00004000')
_VARI1=_VARI1+100
ENDIF
IF(_ST B_AND 'H00080000')
_VARI1=_VARI1+1000
ENDIF
IF(_ST B_AND 'H00100000')
_VARI1=_VARI1+100000000
ENDIF
IF(_ST B_AND 'H00200000')
_VARI1=_VARI1+10000
_VARI1=_VARI1+100000
ENDIF
_B=_Y1-_Y0
_H=_X1-_X0
_ZB=_Z1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Rohteil: "<<_BLT[0,_BLA+2]<<" ("<<_BLA<<")")
ENDIF
IF(S_ST_T B_AND 'H02')
_E_RP_T=S_RP_T
IF(_E_RP_T>0)AND($MCS_TECHNOLOGY_EXTENSION<>1) GOTOF _FEHL6
ENDIF
_E_TURN=0
IF(_BLA<>7)AND(_E_RP_T>0)
IF(_E_CHUCK>1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehbearbeitung gewünscht")
ENDIF
IF(_SC_CHUCK[_E_CHUCK-1,0]==0)
GOTOF _FEHL4
ENDIF
_F_AX_EXISTS[0]=TRUE
_F_AX_NR[0]=_SC_CHUCK[_E_CHUCK-1,0]
_F_S_AX[0]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[0]-1])
_F_S_AX[5]=_F_S_AX[0]
_F_S_STR[0]=AXSTRING(_F_S_AX[0])
_F_S_STR[5]=AXSTRING(_F_S_AX[5])
_F_S_NR[0]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[0]]
IF(_F_S_NR[0]==0)
WRITE(_LOG,_LOG_FILE,"  "<<_F_S_STR[0]<<"=S"<<_F_S_NR[0]<<"=AX"<<_F_AX_NR[0])
GOTOF _FEHL7
ENDIF
IF($MCS_AXIS_USAGE[_F_AX_NR[0]-1]<>3)AND($MCS_AXIS_USAGE[_F_AX_NR[0]-1]<>5)
WRITE(_LOG,_LOG_FILE,"  "<<_F_S_STR[0]<<"=S"<<_F_S_NR[0]<<"=AX"<<_F_AX_NR[0]<<" $MCS_AXIS_USAGE="<<$MCS_AXIS_USAGE[_F_AX_NR[0]-1])
GOTOF _FEHL7
ENDIF
_E_TURN=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehbearbeitung möglich")
WRITE(_LOG,_LOG_FILE,"  "<<_F_S_STR[0]<<"=S"<<_F_S_NR[0]<<"=AX"<<_F_AX_NR[0])
ENDIF
ELSE
GOTOF _FEHL7
ENDIF
ENDIF
IF(NOT _E_TURN)OR(NOT(S_ST_T B_AND 'H00000040'))
_S2=-1
ENDIF
IF((_ST B_AND 'H1000')==0)
_NPV=$P_GG[8]-1
ENDIF
N100 CYCLE209(_MU,_VARI1,_NPV,,_BLT[0,_BLA+2],_X0,_X1,_Z0,_Z1,_ZB,_N,_L,_B,_H,_S2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,_Y0,_Y1)
ENDIF
IF($P_STACK==_E_JS_PRG)OR(($P_STACK==_E_JS_PRG+1)AND(_ST B_AND 'H08000000'))
IF(_BLT[0,_BLA+2]>=0)
IF($P_TCNUM)
_NPV1=$P_GG[8]
_G42=$P_GG[42]
_G52=$P_GG[52]
_G53=$P_GG[53]
IF($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10000')
$P_WPFRAME=CTRANS()
IF($MN_SIM_ENVIRONMENT B_AND 'B100')AND NOT(_ST B_AND 'H08000000')
$P_WPFR=$P_WPFRAME
ENDIF
ENDIF
IF($MN_SIM_ENVIRONMENT B_AND 'B100')AND($MC_TOOL_CARRIER_RESET_VALUE<>$P_TC)
TCARR=$MC_TOOL_CARRIER_RESET_VALUE
ENDIF
IF($P_TC)
_A1=$TC_CARR13[$P_TC]
_A2=$TC_CARR14[$P_TC]
$TC_CARR13[$P_TC]=0
$TC_CARR14[$P_TC]=0
IF($MN_SIM_ENVIRONMENT B_AND 'B100')AND NOT(_ST B_AND 'H08000000')
E_SWIV_H($P_TC,0,0)
ENDIF
TCARR=$P_TC TCOABS
G[52]=_G52
G[53]=_G53
ELSE
IF($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100')
PAROTOF
$P_PARTFRAME=CTRANS()
$P_PARTFR=CTRANS()
ENDIF
IF($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1000')
TOROTOF
$P_TOOLFRAME=CTRANS()
$P_TOOLFR=CTRANS()
ENDIF
ENDIF
ENDIF
_F_NPV[0]=$P_UIFRNUM
N200 CYCLE211(0)
IF($P_TCNUM)
IF($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10000')
G[8]=_NPV1
ENDIF
IF($P_TC)
IF(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))OR(_ST B_AND 'H08000000')
$TC_CARR13[$P_TC]=_A1
$TC_CARR14[$P_TC]=_A2
ENDIF
TCARR=$P_TC TCOABS ;G[42]=_G42
G[52]=_G52
G[53]=_G53
ENDIF
ENDIF
ENDIF
ENDIF
IF(_E_TURN)
_XRAA=S_ST_T B_AND 'H00001000'
_XRAE=S_ST_T B_AND 'H00000004'
_ZRAA=S_ST_T B_AND 'H00002000'
_ZRAE=S_ST_T B_AND 'H00000008'
_XRIA=S_ST_T B_AND 'H00004000'
_XRIE=S_ST_T B_AND 'H00000010'
_ZRIA=1
_ZRIE=S_ST_T B_AND 'H00000020'
REPEAT _M_RP_A _M_RP_E
IF((S_ST_T B_AND 'H00100080')=='H00100080')AND($MCS_FUNCTION_MASK_TURN B_AND 'H04')
_F_TAILSTOCK[0]=1
IF(S_ST_T B_AND 'H100')
_F_RPT[4]=_XRR/_FAK2/2
ENDIF
ELSE
_F_TAILSTOCK[0]=0
_F_RPT[4]=_SC_NO_VAL
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Reitstock: "<<_F_TAILSTOCK[0])
IF(_F_RPT[4]<>_SC_NO_VAL)
WRITE(_LOG,_LOG_FILE,"    XRR="<<_F_RPT[4])
ENDIF
ENDIF
_E_TURN_TRAFO=""
_I=0
WHILE(_I<10)AND(_E_TURN_TRAFO=="")
IF($MC_AXCONF_MACHAX_USED[_F_AX_NR[0]-1]==_E_TURN_TR_AX[_I])
_E_TURN_TRAFO=_E_TURN_TR_STR[_I]
ENDIF
_I=_I+1
ENDWHILE
IF(_E_TURN_TRAFO=="")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Transformation nicht eingerichtet: M-Achse="<<$MC_AXCONF_MACHAX_USED[_F_AX_NR[0]-1])
ENDIF
GOTOF _FEHL8
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehtrafo="<<_E_TURN_TRAFO)
ENDIF
ENDIF
IF(NOT(_ST B_AND 'H08000000'))AND($P_STACK==_E_JS_PRG)
IF(_E_FIRST_PART)
N400 CUST_TECHCYC(232)
ENDIF
ENDIF
RET
_M_RP_A:
IF(S_ST_T B_AND 'H00000002')
IF(_BLA==-2)
_BLA=_BLT[1,_E_RT[0,0]+1]
ENDIF
_XA=_E_RT[0,1]*_FAK2
_ZA=_E_RT[0,3]*_FAK2
_XI=_E_RT[0,4]*_FAK2
S_N=_E_RT[0,8]
S_L=_E_RT[0,9]*_FAK2
S_B=_E_RT[0,10]*_FAK2
S_H=_E_RT[0,11]*_FAK2
IF(_BLA>=0)
IF(_BLA<>1)
IF(S_RP_T==1)
_XRIE=0
_ZRIE=0
S_ST_T=S_ST_T B_AND (B_NOT 'H00000020')
ELSE
IF(S_RP_T==3)
S_ST_T=S_ST_T B_AND (B_NOT 'H00000020')
ENDIF
ENDIF
ELSE
IF(S_RP_T==1)
S_ST_T=S_ST_T B_AND (B_NOT 'H00000020')
ENDIF
ENDIF
ENDIF
IF(_XRAE)
_F_RPT[6]=_SC_NO_VAL
IF(_XRAA)
_F_RPT[0]=_XRA/2/_FAK2
ELSE
IF(_BLA<0) GOTOF _FEHL3
IF(_BLA==4)
_F_RPT[0]=(SQRT(POT(S_B)+POT(S_H))/2+_XRA)/_FAK2
ELSE
IF(_BLA==5)
_F_RPT[0]=(S_L/(2*SIN(180/S_N))+_XRA)/_FAK2
ELSE
_F_RPT[0]=(_XA+_XRA)/_FAK2
_F_RPT[6]=_XRA/_FAK2
ENDIF
ENDIF
ENDIF
ELSE
IF(_F_RPT[6]<>_SC_NO_VAL)
IF(_BLA<0)
_F_RPT[0]=_SC_NO_VAL
ELSE
IF(_BLA==4)
_F_RPT[0]=(SQRT(POT(S_B)+POT(S_H))/2)/_FAK2+_F_RPT[6]
ELSE
IF(_BLA==5)
_F_RPT[0]=(S_L/(2*SIN(180/S_N)))/_FAK2+_F_RPT[6]
ELSE
_F_RPT[0]=_XA/_FAK2+_F_RPT[6]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_ZRAE)
IF(_ZRAA)
_F_RPT[1]=_ZRA/_FAK2
_F_RPT[7]=_SC_NO_VAL
ELSE
IF(_BLA<0) GOTOF _FEHL3
_F_RPT[1]=(_ZA+_ZRA)/_FAK2
_F_RPT[7]=_ZRA/_FAK2
ENDIF
ELSE
IF(_F_RPT[7]<>_SC_NO_VAL)
IF(_BLA<0)
_F_RPT[1]=_SC_NO_VAL
ELSE
_F_RPT[1]=_ZA/_FAK2+_F_RPT[7]
ENDIF
ENDIF
ENDIF
IF(_XRIE)
_F_RPT[8]=_SC_NO_VAL
IF(_XRIA)
_F_RPT[2]=_XRI/2/_FAK2
ELSE
IF(_BLA==1)
_F_RPT[2]=(_XI-_XRI)/_FAK2
_F_RPT[8]=_XRI/_FAK2
ELSE
GOTOF _FEHL3
ENDIF
ENDIF
ELSE
IF(_F_RPT[8]<>_SC_NO_VAL)
IF(_BLA==1)
_F_RPT[2]=_XI/_FAK2-_F_RPT[8]
ELSE
_F_RPT[2]=_SC_NO_VAL
ENDIF
ENDIF
ENDIF
IF(_ZRIE)
IF(_ZRIA)
_F_RPT[3]=_ZRI/_FAK2
ELSE
GOTOF _FEHL3
ENDIF
ENDIF
IF(_XRAE OR _ZRAE OR _XRIE OR _ZRIE)
IF(_BLA<>1)
IF(S_RP_T==1)
_F_RPT[2]=_SC_NO_VAL
_F_RPT[3]=_SC_NO_VAL
ELSE
IF(S_RP_T==3)
_F_RPT[3]=_SC_NO_VAL
ENDIF
ENDIF
ELSE
IF(S_RP_T==1)
_F_RPT[3]=_SC_NO_VAL
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Rückzug Drehen: (X im Radius)")
WRITE(_LOG,_LOG_FILE,"  XRA="<<_F_RPT[0])
WRITE(_LOG,_LOG_FILE,"  ZRA="<<_F_RPT[1])
WRITE(_LOG,_LOG_FILE,"  XRI="<<_F_RPT[2])
WRITE(_LOG,_LOG_FILE,"  ZRI="<<_F_RPT[3])
WRITE(_LOG,_LOG_FILE,"  XRA,ink="<<_F_RPT[6])
WRITE(_LOG,_LOG_FILE,"  ZRA,ink="<<_F_RPT[7])
WRITE(_LOG,_LOG_FILE,"  XRI,ink="<<_F_RPT[8])
ENDIF
ENDIF
_M_RP_E:
_FEHL1: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61231 ShopMill-Programm "<<_SERR<<" nicht ausfuehrbar, da nicht von ShopMill getestet")
ENDIF
N832801 SETAL(61231,_SERR)
RET
_FEHL2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61234 ShopMill-Unterprogramm "<<_SERR<<" nicht ausfuehrbar, da nicht von ShopMill getestet")
ENDIF
N832802 SETAL(61234,_SERR)
RET
_FEHL3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61297 Bezug für inkrementale Rückzugsebene fehlt")
ENDIF
N832803 SETAL(61297)
RET
_FEHL4: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61857 keine Rundachse zur Rohteilaufnahme eingerichtet")
ENDIF
N832804 SETAL(61857)
RET
_FEHL6: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61859 Drehbearbeitung nicht freigegeben")
ENDIF
N832806 SETAL(61859)
RET
_FEHL7: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61860 Drehbearbeitung nur auf Drehspindel möglich")
ENDIF
N832807 SETAL(61860)
RET
_FEHL8: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61167 Transformation nicht eingerichtet: TRAORI_STAT")
ENDIF
N832808 SETAL(61167,"TRAORI_STAT")
RET
_FEHL9: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61166 Maschinendatum prüfen: "<<_SERR)
ENDIF
N832809 SETAL(61166,_SERR)
RET
_FEHL10: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61869 Satzsuchlauf nur mit Berechnung möglich")
ENDIF
N832810 SETAL(61869)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MANAGE_SPF
PROC E_MANAGE SBLOF DISPLOF PREPRO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Management
DEF AXIS _XX,_YY,_ZZ
DEF INT _I,_IT,_IP,_TEC,_POS,_BOT,_BOP,_S_TEC,_S_POS,_OB,_CUR_POS,_CUR_TEC
DEF REAL _FAK1,_FAK2,_RP,_SC,_SD
DEF STRING[128] _STR
DEF INT _LOG,_LOG_ON
DEF STRING[35] _LOG_FILE
_LOG_FILE="/_N_MPF_DIR/_N_LOG_E_MANAGE_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
DELETE(_LOG,_LOG_FILE)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_MANAGE")
ENDIF
E_SP_BC("0")
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL7
IF(_E_POSMU) GOTOF _FEHL8
_E_POSMU=1
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
E_SP_ED(_SD)
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
_TEC=0
_POS=0
FOR _I=0 TO _E_IR-1
IF(_E_TR[_I,0]>0)AND(_POS==0)
_TEC=_TEC+1
ENDIF
IF(_E_TR[_I,0]<0)
_POS=_POS+1
ENDIF
ENDFOR
IF((_TEC+_POS)<>_E_IR) GOTOF _FEHL1
IF(_TEC<=0) GOTOF _FEHL2
IF(_POS<=0) GOTOF _FEHL3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TEC="<<_TEC)
WRITE(_LOG,_LOG_FILE,"_POS="<<_POS)
ENDIF
IF($AC_SERUPRO)
IF(_E_SEARCH[3]==$P_LINENO[0])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"SERUPRO")
WRITE(_LOG,_LOG_FILE,"  _E_SEARCH:"<<_E_SEARCH[0]<<","<<_E_SEARCH[1]<<","<<_E_SEARCH[2]<<","<<_E_SEARCH[3])
ENDIF
_S_TEC=_E_SEARCH[0]
_S_POS=_E_SEARCH[1]
_E_NSP=MAXVAL(0,_E_SEARCH[2])
_E_SEARCH[0]=0
_E_SEARCH[1]=0
_E_SEARCH[2]=0
ELSE
_S_TEC=0
_S_POS=0
_E_NSP=0
ENDIF
ELSE
IF($P_SEARCH)
_S_TEC=0
_S_POS=0
_E_NSP=0
ELSE
IF(_E_SEARCH[0]>=_TEC)OR(_E_SEARCH[1]>=_POS) GOTOF _FEHL4
_S_TEC=_E_SEARCH[0]
_S_POS=_E_SEARCH[1]
_E_NSP=MAXVAL(0,_E_SEARCH[2])
_E_SEARCH[0]=0
_E_SEARCH[1]=0
_E_SEARCH[2]=0
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_S_TEC="<<_S_TEC)
WRITE(_LOG,_LOG_FILE,"_S_POS="<<_S_POS)
WRITE(_LOG,_LOG_FILE,"_E_NSP="<<_E_NSP)
ENDIF
_STR="CMM_INTERN"<<","<<"BLOCKOFFSET"<<","<<_POS-1<<","<<_POS-1+_TEC
G4F0
MMC(_STR,"N")
G4F0
WRTPR("BLOCK_OFFSET("<<_POS-1+_TEC-_S_TEC<<","<<_POS-1-_S_POS<<")",1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"BLOCK_OFFSET("<<_POS-1+_TEC-_S_TEC<<","<<_POS-1-_S_POS<<")")
ENDIF
;_E_ZREF=$P_EP[_ZZ]*_FAK1*1/_FAK2
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
IF($P_TOOLNO)
N13 E_SP_RP(20,_RP+_SD)
ENDIF
ENDIF
_E_ONETIME=0
S_E_ACT_TECH=_S_TEC
FOR _IT=_S_TEC TO _TEC-1
_BOT=(_E_IR-_IT-1)*65536
S_E_ACT_TECH=S_E_ACT_TECH+1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Tec _IT="<<_IT)
WRITE(_LOG,_LOG_FILE,"    S_E_ACT_TECH="<<S_E_ACT_TECH)
WRITE(_LOG,_LOG_FILE,"    Zyk:"<<_E_TR[_IT,0])
WRITE(_LOG,_LOG_FILE,"    _BOT:"<<_BOT)
ENDIF
CASE _E_TR[_IT,0] OF 1 GOTOF _M_T1 2 GOTOF _M_T2 3 GOTOF _M_T3 4 GOTOF _M_T4 5 GOTOF _M_T5 6 GOTOF _M_T6 7 GOTOF _M_T7 8 GOTOF _M_T8 9 GOTOF _M_T9
CASE _E_TR[_IT,0] OF 11 GOTOF _M_T11 12 GOTOF _M_T12 13 GOTOF _M_T13 14 GOTOF _M_T14 15 GOTOF _M_T15 16 GOTOF _M_T16 17 GOTOF _M_T17
CASE _E_TR[_IT,0] OF 21 GOTOF _M_T21
CASE _E_TR[_IT,0] OF 101 GOTOF _M_T101 102 GOTOF _M_T102 103 GOTOF _M_T103 104 GOTOF _M_T104 105 GOTOF _M_T105 106 GOTOF _M_T106 107 GOTOF _M_T107 108 GOTOF _M_T108
GOTOF _FEHL5
_M_T1:E_DR_SIN(3,_BOT,_IT)
MCALL E_DR_SIN(0,_BOT,_IT)
GOTOF _MCT
_M_T2:E_DR(3,_BOT,_IT)
MCALL E_DR(0,_BOT,_IT)
GOTOF _MCT
_M_T3:E_DR_REA(3,_BOT,_IT)
MCALL E_DR_REA(0,_BOT,_IT)
GOTOF _MCT
_M_T4:E_DR_PEC(3,_BOT,_IT)
MCALL E_DR_PEC(0,_BOT,_IT)
GOTOF _MCT
_M_T5:E_DR_BOR(3,_BOT,_IT)
MCALL E_DR_BOR(0,_BOT,_IT)
GOTOF _MCT
_M_T6:E_DR_TAP(3,_BOT,_IT)
MCALL E_DR_TAP(0,_BOT,_IT)
GOTOF _MCT
_M_T7:E_MI_TR(3,_BOT,_IT)
MCALL E_MI_TR(0,_BOT,_IT)
GOTOF _MCT
_M_T8:E_DR_BGF(3,_BOT,_IT)
MCALL E_DR_BGF(0,_BOT,_IT)
GOTOF _MCT
_M_T9:E_DR_PEC2(3,_BOT,_IT)
MCALL E_DR_PEC2(0,_BOT,_IT)
GOTOF _MCT
_M_T11:E_PO_REC(3,_BOT,_IT)
MCALL E_PO_REC(0,_BOT,_IT)
GOTOF _MCT
_M_T12:E_PO_CIR(3,_BOT,_IT)
MCALL E_PO_CIR(0,_BOT,_IT)
GOTOF _MCT
_M_T13:E_PI_REC(3,_BOT,_IT)
MCALL E_PI_REC(0,_BOT,_IT)
GOTOF _MCT
_M_T14:E_PI_CIR(3,_BOT,_IT)
MCALL E_PI_CIR(0,_BOT,_IT)
GOTOF _MCT
_M_T15:E_SL_LON(3,_BOT,_IT)
MCALL E_SL_LON(0,_BOT,_IT)
GOTOF _MCT
_M_T16:E_SL_OPN(3,_BOT,_IT)
MCALL E_SL_OPN(0,_BOT,_IT)
GOTOF _MCT
_M_T17:E_MI_EDG(3,_BOT,_IT)
MCALL E_MI_EDG(0,_BOT,_IT)
GOTOF _MCT
_M_T21:
MCALL E_CALL(0,_BOT,_IT)
GOTOF _MCT
_M_T101:E_DR_O1(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O1(0,_BOT,_IT)
GOTOF _MCT
_M_T102:E_DR_O2(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O2(0,_BOT,_IT)
GOTOF _MCT
_M_T103:E_DR_O3(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O3(0,_BOT,_IT)
GOTOF _MCT
_M_T104:E_DR_O4(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O4(0,_BOT,_IT)
GOTOF _MCT
_M_T105:E_DR_O5(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O5(0,_BOT,_IT)
GOTOF _MCT
_M_T106:E_DR_O6(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O6(0,_BOT,_IT)
GOTOF _MCT
_M_T107:E_DR_O7(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O7(0,_BOT,_IT)
GOTOF _MCT
_M_T108:E_DR_O8(3,_BOT,_IT)
IF(_E_ONETIME)GOTOF _M_ONETIME
MCALL E_DR_O8(0,_BOT,_IT)
GOTOF _MCT
_MCT:
E_SP_ED(_SD)
S_E_ACT_POSM=0
FOR _IP=_TEC TO _E_IR-1
_BOP=_E_IR-_IP-1
S_E_ACT_POSM=S_E_ACT_POSM+1
IF(_IP<_TEC+_S_POS)
_OB=4
_E_MC=0
ELSE
_OB=0
_CUR_POS=_BOP
_CUR_TEC=_BOT DIV 65536
_STR="CMM_INTERN"<<","<<"BLOCKOFFSET"<<","<<_CUR_POS<<","<<_CUR_TEC
G4F0
MMC(_STR,"N")
G4F0
WRTPR("BLOCK_OFFSET("<<_CUR_TEC<<","<<_CUR_POS<<")",1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"BLOCK_OFFSET("<<_CUR_TEC<<","<<_CUR_POS<<")")
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    Pos _IP="<<_IP)
WRITE(_LOG,_LOG_FILE,"      Zyk:"<<_E_TR[_IP,0])
WRITE(_LOG,_LOG_FILE,"      _OB:"<<_OB)
ENDIF
CASE _E_TR[_IP,0] OF -1 GOTOF _M_P1 -2 GOTOF _M_P2 -3 GOTOF _M_P3 -4 GOTOF _M_P4 -5 GOTOF _M_P5 -6 GOTOF _M_P6 -7 GOTOF _M_P7 -8 GOTOF _M_P8
GOTOF _FEHL6
_M_P1:E_PS_SEQ(_OB,_BOP,_IP)
GOTOF _MCP
_M_P2:E_PS_ROW(_OB,_BOP,_IP)
GOTOF _MCP
_M_P3:E_PS_MRX(_OB,_BOP,_IP)
GOTOF _MCP
_M_P4:E_PS_CIR(_OB,_BOP,_IP)
GOTOF _MCP
_M_P5:E_PS_HIN(_OB,_BOP,_IP)
GOTOF _MCP
_M_P6:E_PS_POL(_OB,_BOP,_IP)
GOTOF _MCP
_M_P7:E_PS_XYA(_OB,_BOP,_IP)
GOTOF _MCP
_M_P8:E_PS_FRA(_OB,_BOP,_IP)
GOTOF _MCP
_MCP:
IF(_IP==_TEC+_S_POS)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"    normal weiter")
ENDIF
_E_NSP=0
ENDIF
ENDFOR
MCALL
N19 SBLON
N20 G0 G90 AX[_ZZ]=_RP+_SD
N21 SBLOF
_M_ONETIME:
_E_ONETIME=0
_S_POS=0
ENDFOR
_RET:
_E_IR=0
_E_BO=0
_E_POSMU=0
WRTPR("POSITIONS(0)")
G4F0
MMC("CMM_INTERN,BLOCKOFFSET,0,0","N")
G4F0
WRTPR("BLOCK_OFFSET(0,0)",1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"BLOCK_OFFSET(0,0)")
ENDIF
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N833001 SETAL(61201)
RET
_FEHL2: STOPRE
N833002 SETAL(61202)
RET
_FEHL3: STOPRE
N833003 SETAL(61203)
RET
_FEHL4: STOPRE
N833004 SETAL(61210)
RET
_FEHL5: STOPRE
N833005 SETAL(61204)
RET
_FEHL6: STOPRE
N833006 SETAL(61205)
RET
_FEHL7: STOPRE
N833007 SETAL(61012)
RET
_FEHL8: STOPRE
N833008 SETAL(61263)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MI_CON_SPF
PROC E_MI_CON(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,REAL _UXY,REAL _UZ,INT _ST1,REAL _LS1,INT _FRK,INT _ST2,REAL _LS2,REAL _FZ,INT _FZA,REAL _FS,REAL _ZFS,INT _ZFSA,REAL _X,REAL _Y) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Contour milling
DEF AXIS _ZZ
DEF INT _AS1,_AS2,_BA1,_BA10,_BA100,_BA10000,_PMZ,_VARI,_DMODE,_AMODE[4],_P29
DEF REAL _FAK1,_FAK2,_FF3,_SD,_SC,_RP,_ZREF
DEF REAL _LSM=0.001,_LSI=0.0001
DEF FRAME _CYC_FR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0])
_SC_FIRST_CONT=0
GOTOF _RETS
ENDIF
_E_S_LINE=0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_ZZ=$P_AXN3
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE[1]=0
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
OFFN=_E_TRA_OFFN*_FAK2
E_SP_ED(_SD)
_BA1=_BA B_AND 'B111'
IF(_BA1==5)
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_DZ=_ZFS _UZ=0 _UXY=_FS
_AMODE[3]=100
ENDIF
_AMODE[2]=0
_AMODE[0]=_AMODE[1]+_AMODE[2]+_AMODE[3]
IF(_BA1==1)AND(_DZ<=0) GOTOF _FEHL4
_BA10=0
_BA100=(_BA B_AND 'B11000')/8
_BA10000=(_BA B_AND 'B1000000')/64
_VARI=_BA1+_BA10*10+_BA100*100+_BA10000*10000
IF(((_BA B_AND 'B110000000000')/'B10000000000')==1)
_VARI=_VARI+100000
ENDIF
IF(((_BA B_AND 'B110000000000')/'B10000000000')==2)
_VARI=_VARI+200000
ENDIF
_AS1=(_ST1 B_AND 'B1111')
IF(_FRK==40)AND((_AS1>0)AND(_AS1<>4)) GOTOF _FEHL6
IF(_AS1<>4)
_AS1=_AS1+1
IF(_ST1 B_AND 'B00010000')
_AS1=_AS1+10
ENDIF
_AS2=(_ST2 B_AND 'B1111')
IF(_FRK==40)AND(_AS2>0) GOTOF _FEHL6
_AS2=_AS2+1
IF(_ST2 B_AND 'B00010000')
_AS2=_AS2+10
ENDIF
IF(_LS1<0) GOTOF _FEHL2 IF(_LS2<0) GOTOF _FEHL3
IF(_LS1==0)
IF($P_GG[13]==2)OR($P_GG[13]==4)
_LS1=_LSM
ELSE
_LS1=_LSI
ENDIF
ENDIF
IF(_LS2==0)
IF($P_GG[13]==2)OR($P_GG[13]==4)
_LS2=_LSM
ELSE
_LS2=_LSI
ENDIF
ENDIF
ENDIF
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FZA==0)
_DMODE=10
ELSE
_DMODE=20
ENDIF
ELSE
IF(_FZA==0)
_DMODE=20
ELSE
_DMODE=10
ENDIF
ENDIF
_DMODE=_DMODE+1000
_CYC_FR=$P_CYCFRAME
N12 CYCLE72(,_RP,_Z0,_SC,_Z1,_DZ,_UXY,_UZ,_F,_FZ,_VARI,_FRK,_AS1,_LS1,_FF3,_AS2,_LS2,0,_FS,_ZFS,200,_DMODE,_AMODE[0])
$P_CYCFRAME=_CYC_FR
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N36 E_SP_RP(0,_RP-_SD*_PMZ,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP-_SD*_PMZ)
ELSE
IF($P_TC)
IF($TC_CARR23[$P_TC]<>"P")
N38 E_SP_RP(1,0,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP-_SD*_PMZ)
ENDIF
ELSE
IF($P_TRAFO>0)AND($P_TRAFO<256)
N39 E_SP_RP(1,0,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP-_SD*_PMZ)
ENDIF
ENDIF
ENDIF
IF(_BA1==1)AND(_FRK==40)
_UXY=0
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE72(,_RP-_SD*_PMZ,_Z0,_SC,_Z1,_DZ,_UXY,_UZ,_F,_FZ,_VARI,_FRK,_AS1,_LS1,_FF3,_AS2,_LS2,0,_FS,_ZFS,100,_DMODE,_AMODE[0])
ELSE
_SC_FIRST_CONT=0
N35 G0 AX[_ZZ]=_Z0
ENDIF
IF(_E_TRA_OFFN)
OFFN=_E_TRA_OFFN*_FAK2
ENDIF
_RET:
G[29]=_P29
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N807201 SETAL(61002)
RET
_FEHL2: STOPRE
N807202 SETAL(61223)
RET
_FEHL3: STOPRE
N807203 SETAL(61224)
RET
_FEHL4: STOPRE
N807204 SETAL(61610)
RET
_FEHL5: STOPRE
N807205 SETAL(61211)
RET
_FEHL6: STOPRE
N807206 SETAL(61115)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MI_EDG_SPF
PROC E_MI_EDG(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _D,REAL _Z0,REAL _Z1,INT _Z1A,REAL _X0,REAL _Y0,INT _N,REAL _SWL,REAL _A0,REAL _RF1,REAL _DZ,REAL _DXY,REAL _UZ,REAL _UXY,INT _DXYA,REAL _FS,REAL _ZFS,INT _ZFSA,INT _POS) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Multi Edge Milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA2,_BA3,_DIR,_FFA,_I,_INI=1,_M3_5,_PMZ,_VARI,_AMODE[5],_DMODE,_P29
DEF REAL _FAK1,_FAK2,_RC,_RP,_RTP,_SC,_SD,_XS1,_YS1,_XREF,_YREF,_ZREF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL1
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)OR(_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6] _D=_E_TR[_IDD,7] ;_Z0=_E_TR[_IDD,8]
_Z1=_E_TR[_IDD,9] _Z1A=_E_TR[_IDD,10] ;_X0=_E_TR[_IDD,11] _Y0=_E_TR[_IDD,12]
_N=_E_TR[_IDD,13] _SWL=_E_TR[_IDD,14] _A0=_E_TR[_IDD,15] _RF1=_E_TR[_IDD,16]
_DZ=_E_TR[_IDD,17] _DXY=_E_TR[_IDD,18] _UZ=_E_TR[_IDD,19] _UXY=_E_TR[_IDD,20]
_DXYA=_E_TR[_IDD,21] _FS=_E_TR[_IDD,22]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF
_Z1=_E_TR[_IDD,9] _ZFS=_E_TR[_IDD,23] _ZFSA=_E_TR[_IDD,24]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL2
_E_XREF=_X0*1/_FAK2
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL2
_E_YREF=_Y0*1/_FAK2
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL2
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE[1]=0
_BA1=_BA B_AND 'B111'
IF(_BA1<1)OR(_BA1==3)OR(_BA1>5) GOTOF _FEHL3
_VARI=_BA1
IF(_BA1==4)
_VARI=3
ENDIF
_AMODE[2]=10*_DXYA
IF(_BA1==5)
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_DZ=_ZFS _DXY=_FS
_AMODE[2]=0
_AMODE[3]=100
ENDIF
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
_BA3=(_BA B_AND 'B110000')/'B10000'
IF(_BA3<0)OR(_BA3>2) GOTOF _FEHL4
IF(_BA3==0)
IF(_RF1>=0)
_AMODE[4]=0
ELSE
_AMODE[4]=1000
ENDIF
ELSE
IF(_RF1<0) GOTOF _FEHL5
IF(_BA3==1)
_AMODE[4]=0
ELSE
_AMODE[4]=1000
ENDIF
ENDIF
_RC=ABS(_RF1)
_BA2=(_BA B_AND 'B00001000')/'B00001000'
_VARI=_VARI+_BA2*10
IF(_BA B_AND 'B10000000000')
_VARI=_VARI+100000
ENDIF
_FFA=_FAA-1
E_SP_ED(_SD)
_AMODE[0]=_AMODE[1]+_AMODE[2]+_AMODE[3]+_AMODE[4]
_DMODE=0
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_Z0-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
IF(_F<=0) GOTOF _FEHL6
IF(_OB==4)
N38 CYCLE79(_RTP,_Z0,_SC,_Z1,_N,_SWL,_X0,_Y0,_A0,_RC,_D,_DXY,_DZ,_UXY,_UZ,_F,_E_DIR,_VARI,_FS,_ZFS,200,_DMODE,_AMODE[0])
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 CYCLE79(_RTP,_Z0,_SC,_Z1,_N,_SWL,_X0,_Y0,_A0,_RC,_D,_DXY,_DZ,_UXY,_UZ,_F,_E_DIR,_VARI,_FS,_ZFS,100,_DMODE,_AMODE[0])
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(17,_DD,_F,_FAA,_S,_SA,_BA,_D,_Z0,_Z1,_Z1A,_X0,_Y0,_N,_SWL,_A0,_RF1,_DZ,_DXY,_UZ,_UXY,_DXYA,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL8
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N807901 SETAL(61012)
RET
_FEHL2: STOPRE
N807902 SETAL(61211)
RET
_FEHL3: STOPRE
N807903 SETAL(61002)
RET
_FEHL4:STOPRE
N807904 SETAL(61019," R1/FS1 ")
RET
_FEHL5: STOPRE
N807905 SETAL(61022," R1/FS1 ")
RET
_FEHL6:STOPRE
N807906 SETAL(61003)
RET
_FEHL7: STOPRE
N807907 SETAL(61112)
RET
_FEHL8: STOPRE
N807908 SETAL(61200)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MI_PL_SPF
PROC E_MI_PL(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,REAL _UZ,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _X1,INT _X1A,REAL _Y1,INT _Y1A,REAL _DXY,INT _DXYA,INT _LIM,REAL _A0) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Extended face milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_PMZ,_AMODE[6],_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP,_WZR,_XREF,_YREF,_ZREF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL4
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE[1]=0
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL4
_X0=_X0+_XREF
ENDIF
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL4
_Y0=_Y0+_YREF
ENDIF
ENDIF
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
IF(_X1A<>91)
_AMODE[4]=1
ELSE
_AMODE[4]=0
ENDIF
IF(_Y1A<>91)
_AMODE[5]=1
ELSE
_AMODE[5]=0
ENDIF
_BA1=0 _BA10=0
IF(_BA B_AND 'B00000001')
_BA1=1
ENDIF
IF(_BA B_AND 'B00000010')
_BA1=_BA1+2
ENDIF
IF(_BA1==0) OR (_BA1==3) GOTOF _FEHL1
IF(_BA B_AND 'B00000100')
_BA10=20
ELSE
_BA10=10
ENDIF
IF(_BA B_AND 'B00001000')
_BA10=_BA10+20
ENDIF
_BA=_BA1+_BA10
IF(_BA1==1)AND(_DZ<=0) GOTOF _FEHL2
IF((_BA==12)OR(_BA==22))AND(_UZ<=0) GOTOF _FEHL3
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
E_SP_ED(_SD)
_AMODE[2]=_DXYA
_AMODE[0]=_AMODE[1]+10*_AMODE[2]+1000*_AMODE[4]+10000*_AMODE[5]
_RTP=_RP-_SD*_PMZ
N38 CYCLE61(_RTP,_Z0,_SC,_Z1,_X0,_Y0,_X1,_Y1,_DZ,_DXY,_UZ,_F,_BA,_LIM,0,_AMODE[0],200,_A0)
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 CYCLE61(_RTP,_Z0,_SC,_Z1,_X0,_Y0,_X1,_Y1,_DZ,_DXY,_UZ,_F,_BA,_LIM,0,_AMODE[0],0,_A0)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N806101 SETAL(61002)
RET
_FEHL2: STOPRE
N806102 SETAL(61610)
RET
_FEHL3: STOPRE
N806103 SETAL(62103)
RET
_FEHL4: STOPRE
N806104 SETAL(61211)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MI_TR_SPF
PROC E_MI_TR(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z1,INT _Z1A,REAL _P,INT _PA,REAL _D,REAL _KK,REAL _DXY,REAL _U,REAL _A0,INT _NT,REAL _FI,REAL _FM,INT _FZG,INT _FZZ,INT _FZN,INT _POS,INT _DXYA,STRING[20] _PTAB,STRING[20] _PTABA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.005 ;DATE: 2024-04-03
;ShopMill: Thread milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_BA100,_PMZ,_TYP,_VARI,_PITA,_AMODE,_P29
DEF REAL _DK,_FAK1,_FAK2,_RP,_RTP,_SC,_SD,_X0,_Y0,_Z,_ZREF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_IDD>=0)
_T =_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA =_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5]
_BA=_E_TR[_IDD,6] _Z1=_E_TR[_IDD,7] _Z1A =_E_TR[_IDD,8] _P=_E_TR[_IDD,9]
_D =_E_TR[_IDD,10] _KK=_E_TR[_IDD,11] _DXY =_E_TR[_IDD,12] _U=_E_TR[_IDD,13]
_A0=_E_TR[_IDD,14] _NT=_E_TR[_IDD,15] _DXYA=_E_TR[_IDD,16] _PA=_E_TR[_IDD,17]
IF(_DXYA==1)
_DXY=_DXY/100*(2*$P_TOOLR*_FAK1)
ENDIF
_IDD=-1
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1
_Z=_Z1
IF(_Z1A MOD 2==1)
_Z=_ZREF-ABS(_Z)
ENDIF
_AMODE=0
IF(_Z>_ZREF)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
E_SP_ED(_SD)
_BA1=0 _BA10=10 _BA100=0 _TYP=0
IF(_BA B_AND 'B00000001')
_BA1=1
ENDIF
IF(_BA B_AND 'B00000010')
_BA1=_BA1+2
ENDIF
IF(_BA1==0)OR(_BA1==3) GOTOF _FEHL1
IF(_BA B_AND 16)
_BA10=20
ENDIF
IF(_BA B_AND 4)
_BA100=100
ENDIF
IF(_BA B_AND 8)
_TYP=1
ENDIF
_VARI=_BA1+_BA10+_BA100
IF(_PA _DEC2 <0)OR(_PA _DEC2 >1)OR(_PA _DEC1 <0)OR(_PA _DEC1 >3) GOTOF _FEHL3
IF(_PA _DEC2 ==0)
_PITA=0
ELSE
IF(_PA _DEC1 ==0)
_PITA=1
ELSE
IF(_PA _DEC1 ==1)
_PITA=3
ENDIF
IF(_PA _DEC1 ==2)
_PITA=4
ENDIF
IF(_PA _DEC1 ==3)
_PITA=2
ENDIF
ENDIF
ENDIF
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
IF(_E_POS_RP==0)
_RTP=_ZREF-(_SC+_SD)*_PMZ/$P_ACTFRAME[_ZZ,SC]
ELSE
_RTP=_RP-_SD*_PMZ/$P_ACTFRAME[_ZZ,SC]
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N30 CYCLE70(_RTP,_ZREF,_SC,_Z,_D,_KK,_U,_P,_NT,_DXY,_F,_TYP,_X0,_Y0,_A0,_VARI,_PITA,,_PTAB,_PTABA,100,0,_AMODE)
ELSE
N35 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_ZREF
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N40 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(7,_DD,_F,_FAA,_S,_SA,_BA,_Z1,_Z1A,_P,_D,_KK,_DXY,_U,_A0,_NT,_DXYA,_PA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N807001 SETAL(61002)
RET
_FEHL2: STOPRE
N807002 SETAL(61200)
RET
_FEHL3: STOPRE
N807003 SETAL(61001)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MI_TXT_SPF
PROC E_MI_TXT(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,REAL _FZ,INT _FZA,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _W,REAL _DX,INT _LAGE,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _A1,STRING[100] _TEXT,INT _COD,REAL _XM,REAL _YM) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Engraving
DEF AXIS _XX,_ZZ,_YY
DEF INT _PMZ,_WTYP,_VAR,_VAR1,_VAR2,_VAR3,_VAR4,_VAR5,_VAR6,_VAR7,_VAR8,_AMODE,_DMODE,_P29
DEF REAL _CP1,_CP2,_FAK1,_FAK2,_RP,_SC,_SD,_SD1,_SD2,_RTP
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE=2
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA,0,0)
IF($P_TOOLNO)
_WTYP=$P_AD[1]
ENDIF
IF(($P_TOOL>1)AND($P_TOOLNO))
_SD2=$P_TOOLL[2]
_SD1=$TC_DP4[$P_TOOLNO,1]+$TC_DP13[$P_TOOLNO,1]+$TC_DP22[$P_TOOLNO,1]
IF(_SD2<_SD1)
_SD=(_SD1-_SD2)*_FAK1
ELSE
_SD=0
ENDIF
ELSE
_SD=0
ENDIF
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FZA==0)
_DMODE=10
ELSE
_DMODE=20
ENDIF
ELSE
IF(_FZA==0)
_DMODE=20
ELSE
_DMODE=10
ENDIF
ENDIF
_VAR1=_LAGE MOD 10
_VAR2=10*(TRUNC(_LAGE/10) MOD 10)
IF(_VAR2==0)
_VAR1=0
ENDIF
_VAR3=0
_VAR4=1000*(TRUNC(_LAGE/100) MOD 10)
_VAR5=10000*(TRUNC(_LAGE/1000) MOD 10)
_VAR6=TRUNC(_LAGE/10000) MOD 10
IF(_VAR2==0)AND(_VAR6<>0)
_VAR6=1
ENDIF
IF(_VAR2<>0)AND(_VAR6<>0)
_VAR6=2
ENDIF
_VAR6=100000*_VAR6
_VAR7=1000000*0
_VAR8=10000000*(TRUNC(_LAGE/100000) MOD 10)
_VAR=_VAR1+_VAR2+_VAR3+_VAR4+_VAR5+_VAR6+_VAR7+_VAR8
_RTP=_RP-_SD*_PMZ
_CP1=_XM _CP2=_YM
N38 CYCLE60(_TEXT,_RTP,_Z0,_SC,_Z1,,_X0,_Y0,_A1,_CP1,_CP2,_W,_DX,_FZ,_F,_VAR,_COD,0,200,_DMODE,_AMODE)
N39 E_SP_RP(2,_RP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 CYCLE60(_TEXT,_RTP,_Z0,_SC,_Z1,,_X0,_Y0,_A1,_CP1,_CP2,_W,_DX,_FZ,_F,_VAR,_COD,0,100,_DMODE,_AMODE)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
SBLON
RET
_FEHL1: STOPRE
N806001 SETAL(61212)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PI_CIR_SPF
PROC E_PI_CIR(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,REAL _UZ,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _D,REAL _UXY,REAL _D1,REAL _DXY,REAL _A0,INT _POS,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Circular spigot milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _AS,_BA1,_DIR,_FRK,_INI=1,_M3_5,_PMZ,_AMODE,_AMODE3,_DMODE,_P29,_VARI
DEF REAL _AR,_FAK1,_FAK2,_LL,_PA,_PO,_SC,_SD,_RP,_RTP,_XREF,_YREF,_ZREF,_XS1,_YS1
DEF STRING[70] _KNAME
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
OFFN=0
_E_TS_OFFN=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0) OR (_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T =_E_TS1[_IDD] _TF =_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA =_E_TR[_IDD,6] _Z0A=_E_TR[_IDD,8]
_Z1A=_E_TR[_IDD,10] _DZ =_E_TR[_IDD,11] _UZ =_E_TR[_IDD,12]
_X0A=_E_TR[_IDD,14] _Y0A=_E_TR[_IDD,16]
_D =_E_TR[_IDD,17] _UXY=_E_TR[_IDD,18] _D1 =_E_TR[_IDD,19] _DXY=_E_TR[_IDD,20]
_A0=_E_TR[_IDD,21] _FS =_E_TR[_IDD,22]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF _Z1=_E_TR[_IDD,9]
_ZFS=_E_TR[_IDD,23] _ZFSA=_E_TR[_IDD,24]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL7
_Z0=_Z0+_ZREF
ENDIF
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL7
_X0=_X0+_XREF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL7
_Y0=_Y0+_YREF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
E_SP_ED(_SD)
_BA1=0
IF((_BA B_AND 'B111')==1)
_BA1=1
ENDIF
IF((_BA B_AND 'B111')==2)
_BA1=2
ENDIF
IF((_BA B_AND 'B111')==5)
_BA1=5
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_DZ=_ZFS _DXY=_FS _UZ=0 _UXY=_FS
_AMODE3=100
ENDIF
_AMODE=2+_AMODE3
_DMODE=0
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_ZREF-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
_VARI=_BA1
IF(_BA B_AND 'B10000000000')
_VARI=_VARI+100000
ENDIF
IF(_OB==4)
N38 CYCLE77(_RTP,_Z0,_SC,_Z1,,_D,_X0,_Y0,_DZ,_UXY,_UZ,_F,_F,_E_DIR,_VARI,_D1,_FS,_ZFS,200,_DMODE,_AMODE)
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 CYCLE77(_RTP,_Z0,_SC,_Z1,,_D,_X0,_Y0,_DZ,_UXY,_UZ,_F,_F,_E_DIR,_VARI,_D1,_FS,_ZFS,100,_DMODE,_AMODE)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(14,_DD,_F,_FAA,_S,_SA,_BA,_Z0,_Z0A,_Z1,_Z1A,_DZ,_UZ,_X0,_X0A,_Y0,_Y0A,_D,_UXY,_D1,_DXY,_A0,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N807701 SETAL(61002)
RET
_FEHL2: STOPRE
N807702 SETAL(61200)
RET
_FEHL3: STOPRE
N807703 SETAL(61213)
RET
_FEHL4: STOPRE
N807704 SETAL(61215)
RET
_FEHL5: STOPRE
N807705 SETAL(61112)
RET
_FEHL6: STOPRE
N807706 SETAL(61610)
RET
_FEHL7: STOPRE
N807707 SETAL(61211)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PI_REC_SPF
PROC E_PI_REC(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,REAL _UZ,INT _REF,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _L,REAL _W,REAL _R,REAL _A0,REAL _DXY,REAL _UXY,REAL _L1,REAL _W1,INT _POS,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Rectangular spigot milling
DEF AXIS _XX,_YY,_ZZ
DEF INT _AS1,_AS2,_BA1,_DIR,_FRK,_M3_5,_PMZ,_INI=1,_AMODE3,_GMODE,_DMODE,_P29,_VARI
DEF REAL _FAK1,_FAK2,_LP1,_LP2,_LL,_WW,_PA,_PO,_RP,_RTP,_SC,_SD,_XS1,_YS1,_XREF,_YREF,_ZREF
DEF STRING[70] _KNAME
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL8
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)OR(_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T =_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F =_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6] _Z0A=_E_TR[_IDD,8]
_Z1A=_E_TR[_IDD,10] _DZ =_E_TR[_IDD,11] _UZ =_E_TR[_IDD,12]
_REF=_E_TR[_IDD,13] _X0A=_E_TR[_IDD,15]
_Y0A=_E_TR[_IDD,17] _R =_E_TR[_IDD,20]
_A0 =_E_TR[_IDD,21] _DXY=_E_TR[_IDD,22] _UXY=_E_TR[_IDD,23] _L1 =_E_TR[_IDD,24]
_W1 =_E_TR[_IDD,25] _FS =_E_TR[_IDD,26]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF _Z1=_E_TR[_IDD,9]
_L=_E_TR[_IDD,18] _W=_E_TR[_IDD,19] _ZFS=_E_TR[_IDD,27] _ZFSA=_E_TR[_IDD,28]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF(_L<=0)OR(_W<=0) GOTOF _FEHL3
IF(_R<0)OR(_W<2*_R)OR(_L<2*_R) GOTOF _FEHL3
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL7
_Z0=_Z0+_ZREF
ENDIF
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL7
_X0=_X0+_XREF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL7
_Y0=_Y0+_YREF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
E_SP_ED(_SD)
_GMODE=(1+_REF)*1000
_BA1=0
IF((_BA B_AND 'B111')==1)
_BA1=1
ENDIF
IF((_BA B_AND 'B111')==2)
_BA1=2
ENDIF
IF((_BA B_AND 'B111')==5)
_BA1=5
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_DZ=_ZFS _DXY=_FS _UZ=0 _UXY=_FS
_AMODE3=100
ENDIF
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_ZREF-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
_DMODE=0
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
_VARI=_BA1
IF(_BA B_AND 'B10000000000')
_VARI=_VARI+100000
ENDIF
IF(_OB==4)
N38 CYCLE76(_RTP,_Z0,_SC,_Z1,,_L,_W,_R,_X0,_Y0,_A0,_DZ,_UXY,_UZ,_F,_F,_E_DIR,_VARI,_L1,_W1,_FS,_ZFS,_GMODE+200,_DMODE,2+_AMODE3)
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 CYCLE76(_RTP,_Z0,_SC,_Z1,,_L,_W,_R,_X0,_Y0,_A0,_DZ,_UXY,_UZ,_F,_F,_E_DIR,_VARI,_L1,_W1,_FS,_ZFS,_GMODE+100,_DMODE,2+_AMODE3)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF =_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S =_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(13,_DD,_F,_FAA,_S,_SA,_BA,_Z0,_Z0A,_Z1,_Z1A,_DZ,_UZ,_REF,_X0,_X0A,_Y0,_Y0A,_L,_W,_R,_A0,_DXY,_UXY,_L1,_W1,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N807601 SETAL(61002)
RET
_FEHL2: STOPRE
N807602 SETAL(61200)
RET
_FEHL3: STOPRE
N807603 SETAL(61605)
RET
_FEHL4: STOPRE
N807604 SETAL(61215)
RET
_FEHL5: STOPRE
N807605 SETAL(61112)
RET
_FEHL6: STOPRE
N807606 SETAL(61610)
RET
_FEHL7: STOPRE
N807607 SETAL(61211)
RET
_FEHL8: STOPRE
N807608 SETAL(61012)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PO_CIR_SPF
PROC E_PO_CIR(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _FZ,INT _FZA,REAL _FZR,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _D,REAL _UXY,REAL _UZ,REAL _D1,REAL _AZ,REAL _DXY,INT _POS, INT _DXYA,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Circular pocket
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_BA1000,_INI=1,_PMZ,_VARI,_GMODE,_DMODE,_AMODE,_AMODE2,_AMODE3,_P29
DEF REAL _FAK1,_FAK2,_RP,_SC,_SD,_XREF,_YREF,_ZREF,_RTP
DEF FRAME _CYC_FR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL13
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0) OR (_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6] _FZ=_E_TR[_IDD,7] _FZA=_E_TR[_IDD,8]
_FZR=_E_TR[_IDD,9] _Z0A=_E_TR[_IDD,11]
_Z1A=_E_TR[_IDD,13] _DZ=_E_TR[_IDD,14] _X0A=_E_TR[_IDD,16]
_Y0A=_E_TR[_IDD,18] _D=_E_TR[_IDD,19] _UXY=_E_TR[_IDD,20]
_UZ=_E_TR[_IDD,21] _D1=_E_TR[_IDD,22] _AZ=_E_TR[_IDD,23]
_DXYA=_E_TR[_IDD,25] _FS=_E_TR[_IDD,26]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF _Z1=_E_TR[_IDD,12]
_DXY=_E_TR[_IDD,24] _ZFS=_E_TR[_IDD,27] _ZFSA=_E_TR[_IDD,28]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL9
_Z0=_Z0+_ZREF
ENDIF
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL9
_X0=_X0+_XREF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL9
_Y0=_Y0+_YREF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
ENDIF
IF(_DXYA<0)OR(_DXYA>1) GOTOF _FEHL11
_AMODE2=_DXYA
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
IF($P_TOOLR<0) GOTOF _FEHL7
;
IF NOT ((_BA B_AND 'B111')==5)
IF(_UXY<0) GOTOF _FEHL6
ENDIF
IF(_FZA==2) AND NOT ((_BA B_AND 'B111')==5)
IF(_FZ>_DZ)
_FZ=_DZ
ENDIF
ENDIF
E_SP_ED(_SD)
_BA1=0 _BA1000=(_BA B_AND 'B110000000')/'B10000000'
IF((_BA B_AND 'B111')==1)OR((_BA B_AND 'B111')==3)
_BA1=1
ENDIF
IF((_BA B_AND 'B111')==2)OR((_BA B_AND 'B111')==3)
_BA1=_BA1+2
ENDIF
IF((_BA B_AND 'B111')==4)
_BA1=4
ENDIF
IF((_BA B_AND 'B111')==5)
_BA1=5 _AMODE3=0
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_AMODE3=1
_FZ=_F
ENDIF
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
IF(_BA1<1)OR(_BA1>5) GOTOF _FEHL3
IF NOT(_BA1==5)
IF(_DZ<=0) GOTOF _FEHL5
ENDIF
IF(_BA1==1)
IF(_UXY>=_D/2) GOTOF _FEHL12
ENDIF
IF(_BA B_AND 'B01000000'==0)
_GMODE=10000
ELSE
_GMODE=20000
ENDIF
IF(_BA B_AND 'B01000000'==0)OR(_BA1<>1)
_D1=0 _AZ=0
ELSE
IF($P_TOOLR*_FAK1*2>_D1) GOTOF _FEHL10
IF(_AZ<=0) GOTOF _FEHL10
IF(_UXY>(_D-_D1)/2) GOTOF _FEHL12
ENDIF
IF(_BA1<>5)
IF(_UXY>$P_TOOLR*_FAK1*2) GOTOF _FEHL12
ENDIF
IF(_BA1000)
IF((_BA1000==1)AND(_FZA==2))
_FZA=1
ENDIF
ENDIF
IF(_FZA<>2)OR((_BA B_AND 'B111')==5)
_BA10=1
ELSE
_BA10=2
ENDIF
_VARI=_BA1+_BA10*10+_BA1000*1000
;N30 E_TFS("","",_DD,_F,_FAA,_S,_SA)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FZA==0)
_DMODE=10
ELSE
_DMODE=20
ENDIF
ELSE
IF(_FZA==0)
_DMODE=20
ELSE
_DMODE=10
ENDIF
ENDIF
_DMODE=_DMODE+100
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
_AMODE=_AMODE2*10+_AMODE3*100
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_ZREF-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
IF(_OB==4)
N38 POCKET4(_RTP,_Z0,_SC,_Z1,_D,_X0,_Y0,_DZ,_UXY,_UZ,_F,_FZ,_E_DIR,_VARI,_DXY,_D1,_AZ,_FZR,_FZ,0,_FS,_ZFS,_GMODE+200,_DMODE,_AMODE)
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 POCKET4(_RTP,_Z0,_SC,_Z1,_D,_X0,_Y0,_DZ,_UXY,_UZ,_F,_FZ,_E_DIR,_VARI,_DXY,_D1,_AZ,_FZR,_FZ,0,_FS,_ZFS,_GMODE+100,_DMODE,_AMODE)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(12,_DD,_F,_FAA,_S,_SA,_BA,_FZ,_FZA,_FZR,_Z0,_Z0A,_Z1,_Z1A,_DZ,_X0,_X0A,_Y0,_Y0A,_D,_UXY,_UZ,_D1,_AZ,_DXY,_DXYA,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL4
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL3: STOPRE
N830803 SETAL(61002)
RET
_FEHL4: STOPRE
N830804 SETAL(61200)
RET
_FEHL5: STOPRE
N830805 SETAL(61610)
RET
_FEHL6: STOPRE
N830806 SETAL(61253)
RET
_FEHL7: STOPRE
N830807 SETAL(61112)
RET
_FEHL9: STOPRE
N830809 SETAL(61211)
RET
_FEHL10: STOPRE
N830810 SETAL(61215)
RET
_FEHL11: STOPRE
N830811 SETAL(61155)
RET
_FEHL12: STOPRE
N830812 SETAL(61010)
RET
_FEHL13: STOPRE
N830813 SETAL(61012)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PO_REC_SPF
PROC E_PO_REC(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _FZ,INT _FZA,REAL _FZR,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,INT _REF,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _L,REAL _W,REAL _R,REAL _A0,REAL _UXY,REAL _UZ,REAL _L1,REAL _W1,REAL _AZ,REAL _DXY,INT _POS,INT _DXYA,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Rectangular pocket
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_INI=1,_PMZ,_VARI,_GMODE,_DMODE,_AMODE,_AMODE2,_AMODE3,_P29
DEF REAL _FAK1,_FAK2,_DP1,_RAD1,_SD,_SC,_RP,_XREF,_YREF,_ZREF,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL13
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0) OR (_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6] _FZ=_E_TR[_IDD,7] _FZA=_E_TR[_IDD,8]
_FZR=_E_TR[_IDD,9] _Z0A=_E_TR[_IDD,11]
_Z1A=_E_TR[_IDD,13] _DZ=_E_TR[_IDD,14] _REF=_E_TR[_IDD,15]
_X0A=_E_TR[_IDD,17] _Y0A=_E_TR[_IDD,19] _L=_E_TR[_IDD,20]
_W=_E_TR[_IDD,21] _R=_E_TR[_IDD,22] _A0=_E_TR[_IDD,23] _UXY=_E_TR[_IDD,24]
_UZ=_E_TR[_IDD,25] _L1=_E_TR[_IDD,26] _W1=_E_TR[_IDD,27] _AZ=_E_TR[_IDD,28]
_DXYA=_E_TR[_IDD,30] _FS=_E_TR[_IDD,31]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF
_Z1=_E_TR[_IDD,12] _DXY=_E_TR[_IDD,29] _ZFS=_E_TR[_IDD,32] _ZFSA=_E_TR[_IDD,33]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL7
_Z0=_Z0+_ZREF
ENDIF
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL7
_X0=_X0+_XREF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL7
_Y0=_Y0+_YREF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
ENDIF
IF(_DXYA<0)OR(_DXYA>1) GOTOF _FEHL14
_AMODE2=_DXYA
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
IF($P_TOOLR<0) GOTOF _FEHL8
IF NOT ((_BA B_AND 'B111')==5)
IF(_UXY<0) GOTOF _FEHL6
ENDIF
IF(_FZA==2) AND NOT ((_BA B_AND 'B111')==5)
IF(_FZ<=0) GOTOF _FEHL1
IF(_FZR<=0) GOTOF _FEHL2
IF(_FZ>_DZ)
_FZ=_DZ
ENDIF
ENDIF
E_SP_ED(_SD)
_BA1=0 _BA10=_FZA
IF((_BA B_AND 'B111')==1)OR((_BA B_AND 'B111')==3)
_BA1=1
ENDIF
IF((_BA B_AND 'B111')==2)OR((_BA B_AND 'B111')==3)
_BA1=_BA1+2
ENDIF
IF((_BA B_AND 'B111')==4)
_BA1=4
ENDIF
IF((_BA B_AND 'B111')==5)
_BA1=5 _AMODE3=0
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_AMODE3=1
ENDIF
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
IF(_BA1<1)OR(_BA1>5) GOTOF _FEHL3
IF NOT(_BA1==5)
IF(_DZ<=0) GOTOF _FEHL5
ENDIF
IF(_BA B_AND 'B01000000'==0)
_GMODE=10000
ELSE
_GMODE=20000
ENDIF
_GMODE=_GMODE+(1+_REF)*1000
IF(_BA B_AND 'B01000000'==0)OR(_BA1<>1)
_L1=0 _W1=0 _AZ=0
ELSE
IF($P_TOOLR*_FAK1>_L1/2)OR($P_TOOLR*_FAK1>_W1/2) GOTOF _FEHL11
IF(_AZ<=0) GOTOF _FEHL11
IF(_UXY>(_L-_L1)/2)OR(_UXY>(_W-_W1)/2) GOTOF _FEHL10
ENDIF
IF(_BA1<>5)
IF(_UXY>$P_TOOLR*_FAK1*2) GOTOF _FEHL10
ENDIF
IF(_BA10<2)OR(_BA10>3)OR((_BA B_AND 'B111')==5)
_BA10=1
ENDIF
_VARI=_BA1+_BA10*10
IF(_BA B_AND 'B10000000000')
_VARI=_VARI+100000
ENDIF
;N30 E_TFS("","",_DD,_F,_FAA,_S,_SA)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FZA==0)
_DMODE=10
ELSE
_DMODE=20
ENDIF
ELSE
IF(_FZA==0)
_DMODE=20
ELSE
_DMODE=10
ENDIF
ENDIF
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
IF NOT ((_BA B_AND 'B111')==5)
IF(_FZA==2)
_RAD1=_FZR _DP1=_FZ
ENDIF
IF(_FZA==3)
_RAD1=_FZ
ENDIF
ENDIF
_AMODE=_AMODE2*10+_AMODE3*100
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_ZREF-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
IF(_OB==4)
N38 POCKET3(_RTP,_Z0,_SC,_Z1,_L,_W,_R,_X0,_Y0,_A0,_DZ,_UXY,_UZ,_F,_FZ,_E_DIR,_VARI,_DXY,_L1,_W1,_AZ,_RAD1,_DP1,0,_FS,_ZFS,_GMODE+200,_DMODE,_AMODE)
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 POCKET3(_RTP,_Z0,_SC,_Z1,_L,_W,_R,_X0,_Y0,_A0,_DZ,_UXY,_UZ,_F,_FZ,_E_DIR,_VARI,_DXY,_L1,_W1,_AZ,_RAD1,_DP1,0,_FS,_ZFS,_GMODE+100,_DMODE,_AMODE)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(11,_DD,_F,_FAA,_S,_SA,_BA,_FZ,_FZA,_FZR,_Z0,_Z0A,_Z1,_Z1A,_DZ,_REF,_X0,_X0A,_Y0,_Y0A,_L,_W,_R,_A0,_UXY,_UZ,_L1,_W1,_AZ,_DXY,_DXYA,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL4
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N830701 SETAL(61214)
RET
_FEHL2: STOPRE
N830702 SETAL(61213)
RET
_FEHL3: STOPRE
N830703 SETAL(61002)
RET
_FEHL4: STOPRE
N830704 SETAL(61200)
RET
_FEHL5: STOPRE
N830705 SETAL(61610)
RET
_FEHL6: STOPRE
N830706 SETAL(61253)
RET
_FEHL7: STOPRE
N830707 SETAL(61211)
RET
_FEHL8: STOPRE
N830708 SETAL(61112)
RET
_FEHL10: STOPRE
N830710 SETAL(61010)
RET
_FEHL11: STOPRE
N830711 SETAL(61215)
RET
_FEHL13: STOPRE
N830713 SETAL(61012)
RET
_FEHL14: STOPRE
N830714 SETAL(61155)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_CIR_SPF
PROC E_PS_CIR(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _R,REAL _A0,REAL _A1,INT _N,INT _ST,INT _NR,REAL _FC,STRING[200] _HIDE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill positions circle
DEF AXIS _XX,_YY,_ZZ,_AA
DEF INT _I,_II,_G,_ST3,_TRAC=0,_ABRI,_POS,_MAX_POS,_INI,_FIRST,_FOUND,_NUM,_NSP,_FIRST_POSMU=0,_INT,_P29,S_ST3R,S_ACT_POS,S_NUM_POS
DEF INT S_GEO[3,4]=SET(0,1,2,3, 0,2,3,1, 0,3,1,2)
DEF REAL _DX,_DY,_FAK1,_FAK2,_SC,_XREF,_YREF,_ZREF,_RP,_SD,_TRAD,_MODR,_MODS,_AP
DEF STRING[200] _STR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_TRAFO B_AND 'H200')
_TRAC=1
_TRAD=$P_TRAFO_PAR[0]
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ELSE
_XREF=_E_XREF
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ELSE
_YREF=_E_YREF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_E_ZREF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_OB==0)
IF(_IDD>=0)
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2] _X0=_E_TR[_IDD,3] _X0A=_E_TR[_IDD,4]
_Y0=_E_TR[_IDD,5] _Y0A=_E_TR[_IDD,6] _R =_E_TR[_IDD,7] _A0 =_E_TR[_IDD,8]
_A1=_E_TR[_IDD,9] _N =_E_TR[_IDD,10] _ST=_E_TR[_IDD,11] _FC=_E_TR[_IDD,12]
_HIDE=_E_TS1[_IDD]
ENDIF
S_ST3R=TRUNC(_ST/100) MOD 10
_ST3=S_GEO[$P_GG[6]-1,S_ST3R]
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
IF($P_MC==0) GOTOF _FEHL6
IF(_N<=0) GOTOF _FEHL1
_HIDE=","<<_HIDE<<","
_INI=1
_NUM=0
REPEAT
REPEAT _NPOS1 _NPOS2
UNTIL _FOUND==FALSE
S_NUM_POS=S_ACT_POS
_INI=1
_NSP=_E_NSP
_NUM=_NSP
REPEAT _NPOS1 _NPOS2
_NUM=0
IF(_NSP>=1)
S_ACT_POS=S_ACT_POS+_NSP
ENDIF
IF(NOT _FOUND)
IF(_NSP==0)
GOTOF _FEHL1
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
IF(_ST3>0)
IF(_ST3>3)GOTOF _FEHL8
IF(_SC_ROT_AX[0,S_ST3R-1]==0)GOTOF _FEHL8
_II=10*(_ST _DEC5)+_ST _DEC4
IF(_II>_SC_ROT_AX[0,S_ST3R-1]-1)
_II=0
ENDIF
_AA=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_SC_ROT_AX[_II+1,S_ST3R-1]-1])
IF($MA_ROT_IS_MODULO[_AA])
_MODR=$MA_MODULO_RANGE[_AA]
_MODS=$MA_MODULO_RANGE_START[_AA]
ENDIF
IF(_TRAC)
IF($PC_TRAFO_TYPE_NAME=="TRACYL_K")
IF($NT_CNTRL[$P_TRAFO_PARSET MOD 1000] B_AND 'H800'=='H800')
_ABRI=1
ELSE
_ABRI=-1
ENDIF
ELSE
_STR="_INT=$MC_TRACYL_ROT_SIGN_IS_PLUS_"<<$P_TRAFO_PARSET
EXECSTRING(_STR)
IF(_INT==0)
_ABRI=-1
ELSE
_ABRI=1
ENDIF
ENDIF
ENDIF
ENDIF
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_RP<=_Z0) GOTOF _FEHL7
E_SP_ED(_SD)
_E_BO=_BO
_E_MC=0
_E_ZREF=_Z0*1/_FAK2
IF(_ST3==0)
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_E_XREF=_X0*1/_FAK2
_E_YREF=_Y0*1/_FAK2
IF((_ST MOD 10)==0)
_A1=360/_N
ENDIF
IF((TRUNC(_ST/10)MOD 10)==0)
_G=0
ELSE
IF(_A1>0)
_G=3
ELSE
_G=2
ENDIF
ENDIF
IF(_E_TR[_IDD-1,0]>0)
_FIRST_POSMU = 1
ENDIF
IF(_E_POS_RP==0)AND(_FIRST_POSMU==0)
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
N10 E_SP_RP(0,_Z0+_SC+_SD,_X0+COS(_A0+_I*_A1)*_R,_Y0+SIN(_A0+_I*_A1)*_R,_Z0+_SC+_SD)
ELSE
N15 E_SP_RP(1,0,_X0+COS(_A0+_I*_A1)*_R,_Y0+SIN(_A0+_I*_A1)*_R,_Z0+_SC+_SD)
ENDIF
ELSE
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
N13 E_SP_RP(0,_RP+_SD,_X0+COS(_A0+_I*_A1)*_R,_Y0+SIN(_A0+_I*_A1)*_R,_RP+_SD)
ELSE
N16 E_SP_RP(1,0,_X0+COS(_A0+_I*_A1)*_R,_Y0+SIN(_A0+_I*_A1)*_R,_RP+_SD)
ENDIF
ENDIF
_FIRST=1
_E_MC=1
WHILE(_FOUND)
_SC_WO=_A0+_I*_A1
_DX=COS(_SC_WO)*_R _DY=SIN(_SC_WO)*_R
_E_BO=_BO
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
IF(_G==0)OR(_FIRST)
SBLON
N20 G0 G9 G40 G90 AX[_XX]=_X0+_DX AX[_YY]=_Y0+_DY
SBLOF
_FIRST=0
ELSE
IF(_G==2)
SBLON
N30 G94 FB=_FC G2 G9 G40 G90 AX[_XX]=_X0+_DX AX[_YY]=_Y0+_DY IP[_XX]=AC(_X0) IP[_YY]=AC(_Y0)
SBLOF
ELSE
SBLON
N40 G94 FB=_FC G3 G9 G40 G90 AX[_XX]=_X0+_DX AX[_YY]=_Y0+_DY IP[_XX]=AC(_X0) IP[_YY]=AC(_Y0)
SBLOF
ENDIF
ENDIF
IF((_G>0)AND(($P_EP[_XX]*_FAK1<>_X0+_DX)OR($P_EP[_YY]*_FAK1<>_Y0+_DY)))
_E_MC=0
SBLON
N50 G0 G9 G40 G90 AX[_XX]=_X0+_DX AX[_YY]=_Y0+_DY
SBLOF
_E_MC=1
ENDIF
_E_BO=_BO
REPEAT _NPOS1 _NPOS2
ENDWHILE
_SC_WO=0;
ELSE
_SC_WO=0
IF(_ST3==1)
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
_E_XREF=_X0*1/_FAK2
ELSE
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
IF((_ST MOD 10)==0)
_A1=360/_N
ENDIF
IF(_E_TR[_IDD-1,0]>0)
_FIRST_POSMU = 1
ENDIF
IF(_E_POS_RP==0)AND(_FIRST_POSMU==0)
_E_MC=0
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
SBLON
N10 G90 G0 AX[_ZZ]=_Z0+_SC+_SD
SBLOF
ENDIF
ELSE
_E_MC=0
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
SBLON
N13 G90 G0 AX[_ZZ]=_RP+_SD
SBLOF
ENDIF
ENDIF
_E_MC=1
WHILE(_FOUND)
_AP=_A0+_I*_A1
IF(_TRAC==0)
IF($MA_ROT_IS_MODULO[_AA])
_AP=((((_AP-_MODS) MOD _MODR) + _MODR) MOD _MODR) + _MODS
ENDIF
ENDIF
IF(_TRAC==1)
_AP=(_TRAD*$PI*_AP/360)*_ABRI
ENDIF
_E_BO=_BO
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
IF(_ST3==1)
IF(_TRAC==0)
SBLON
N60 G9 G0 G40 G90 AX[_XX]=_X0 AX[_AA]=_AP AX[_YY]=_Y0
IF($P_EP[_YY]*_FAK1<>_Y0)
_E_MC=0
SBLON
N62 G0 G9 G40 G90 AX[_YY]=_Y0
SBLOF
_E_MC=1
ENDIF
SBLOF
ELSE
SBLON
N70 G9 G0 G40 G90 AX[_XX]=_X0 AX[_YY]=_AP
SBLOF
ENDIF
ELSE
IF(_TRAC==0)
SBLON
N80 G9 G0 G40 G90 AX[_AA]=_AP AX[_YY]=_Y0 AX[_XX]=_X0
IF($P_EP[_XX]*_FAK1<>_X0)
_E_MC=0
SBLON
N82 G0 G9 G40 G90 AX[_XX]=_X0
SBLOF
_E_MC=1
ENDIF
SBLOF
ELSE
SBLON
N90 G9 G0 G40 G90 AX[_XX]=_AP AX[_YY]=_Y0
SBLOF
ENDIF
ENDIF
_E_BO=_BO
REPEAT _NPOS1 _NPOS2
ENDWHILE
ENDIF
G[29]=_P29
ELSE
IF(_OB==4)
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_ST=_E_TR[_IDD,11]
S_ST3R=TRUNC(_ST/100) MOD 10
_ST3=S_GEO[$P_GG[6]-1,S_ST3R]
IF(_ST3==0)OR(_ST3==1)
_X0=_E_TR[_IDD,3] _X0A=_E_TR[_IDD,4]
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_ST3==0)OR(_ST3==2)
_Y0=_E_TR[_IDD,5] _Y0A=_E_TR[_IDD,6]
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_FC=$SCS_CIRCLE_RAPID_FEED
S_ST3R=TRUNC(_ST/100) MOD 10
_ST3=S_GEO[$P_GG[6]-1,S_ST3R]
IF(_ST3==1)
_Y0=$P_EP[_YY]*_FAK1
ENDIF
IF(_ST3==2)
_X0=$P_EP[_XX]*_FAK1
ENDIF
_E_TR[_E_IR,0]=SET(-4,_Z0,_Z0A,_X0,_X0A,_Y0,_Y0A,_R,_A0,_A1,_N,_ST,_FC)
_E_TS1[_E_IR]=_HIDE
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RETS:
RET
_NPOS1:
IF(_INI)
_INI=0
_POS=0
S_ACT_POS=0
_MAX_POS=_N
ENDIF
_FOUND=0
WHILE(_FOUND<=_NUM)AND(_POS<_MAX_POS)
_POS=_POS+1
_I=(_POS-1)
IF(MATCH(_HIDE,","<<_POS<<",")<0)AND(_POS<=_MAX_POS)
_FOUND=_FOUND+1
ENDIF
ENDWHILE
IF(_FOUND<=_NUM)
_FOUND=0
ELSE
S_ACT_POS=S_ACT_POS+1
ENDIF
_NPOS2:
_FEHL1: STOPRE
N830301 SETAL(61103)
RET
_FEHL2: STOPRE
N830302 SETAL(61200)
RET
_FEHL3: STOPRE
N830303 SETAL(61205)
RET
_FEHL4: STOPRE
N830304 SETAL(61210)
RET
_FEHL5: STOPRE
N830305 SETAL(61211)
RET
_FEHL6: STOPRE
N830306 SETAL(62100)
M0
RET
_FEHL7: STOPRE
N830307 SETAL(61101)
RET
_FEHL8: STOPRE
N830308 SETAL(61329)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_FRA_SPF
PROC E_PS_FRA(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _A0,REAL _L1,INT _N1,REAL _L2,INT _N2,INT _NR,REAL _AX,REAL _AY,STRING[200] _HIDE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.01.00 ;DATE: 2008-02-12
;ShopMill positions frame
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF(_OB==0)OR(_OB==4)
E_PS_MRX(_OB,_BO,_IDD)
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_E_TR[_E_IR,0]=-8 _E_TR[_E_IR,1]=_Z0 _E_TR[_E_IR,2]=_Z0A _E_TR[_E_IR,3]=_X0
_E_TR[_E_IR,4]=_X0A _E_TR[_E_IR,5]=_Y0 _E_TR[_E_IR,6]=_Y0A _E_TR[_E_IR,7]=_A0
_E_TR[_E_IR,8]=_L1 _E_TR[_E_IR,9]=_N1 _E_TR[_E_IR,10]=_L2 _E_TR[_E_IR,11]=_N2
_E_TR[_E_IR,12]=_AX _E_TR[_E_IR,13]=_AY _E_TR[_E_IR,14]=1
_E_TS1[_E_IR]=_HIDE
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
_RETS:
RET
_FEHL2: STOPRE
N880122 SETAL(61200)
RET
_FEHL3: STOPRE
N880123 SETAL(61205)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_HIN_SPF
PROC E_PS_HIN(INT _OB,INT _BO,INT _IDD,REAL _Z1,INT _Z1A,INT _NR) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Obstacle cycle
DEF AXIS _ZZ
DEF INT _P29
DEF REAL _FAK1,_FAK2,_SC,_SD,_ZREF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_SC_NO_VAL
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
ELSE
_SC=_E_SC*_FAK2
ENDIF
IF(_OB==0)
_ZZ=$P_AXN3
IF(_IDD>=0)
_Z1=_E_TR[_IDD,1] _Z1A=_E_TR[_IDD,2]
_IDD=-1
ENDIF
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
E_SP_ED(_SD)
IF(_Z1A==91)
_Z1=$P_EP[_ZZ]*_FAK1+_Z1
ELSE
IF(_Z1A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL1
_Z1=_ZREF+_Z1
ENDIF
ENDIF
_E_BO=_BO
IF(_Z1+_SC+_SD>$P_EP[_ZZ]*_FAK1)
_E_MC=0
SBLON
N10 G90 G0 AX[_ZZ]=_Z1+_SC+_SD
SBLOF
ENDIF
_E_MC=1
G[29]=_P29
ELSE
IF(_OB==4)
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_E_TR[_E_IR,0]=-5 _E_TR[_E_IR,1]=_Z1 _E_TR[_E_IR,2]=_Z1A
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N833101 SETAL(61211)
RET
_FEHL2: STOPRE
N833102 SETAL(61200)
RET
_FEHL3: STOPRE
N833103 SETAL(61202)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_MRX_SPF
PROC E_PS_MRX(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _A0,REAL _L1,INT _N1,REAL _L2,INT _N2,INT _NR,REAL _AX,REAL _AY,STRING[200] _HIDE,INT _MODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill posistions matrix
DEF AXIS _XX,_YY,_ZZ
DEF INT _I1,_I2,_FOUND,_NSP,_POS,_MAX_POS,_NUM,_INI,_FIRST_POSMU=0,_P29,S_ACT_POS,S_NUM_POS
DEF REAL _X,_Y,_DX,_DY,_SII,_CO,_FAK1,_FAK2,_SC,_XREF,_YREF,_ZREF,_RP,_SD
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ELSE
_XREF=_E_XREF
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ELSE
_YREF=_E_YREF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_E_ZREF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(_IDD>=0)
_Z0 =_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2] _X0 =_E_TR[_IDD,3] _X0A=_E_TR[_IDD,4]
_Y0 =_E_TR[_IDD,5] _Y0A=_E_TR[_IDD,6] _A0 =_E_TR[_IDD,7] _L1 =_E_TR[_IDD,8]
_N1 =_E_TR[_IDD,9] _L2 =_E_TR[_IDD,10] _N2 =_E_TR[_IDD,11] _AX =_E_TR[_IDD,12]
_AY =_E_TR[_IDD,13] _MODE=_E_TR[_IDD,14]
_HIDE=_E_TS1[_IDD]
ENDIF
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
IF($P_MC==0) GOTOF _FEHL6
IF(_N1<=0)OR(_N2<=0) GOTOF _FEHL1
IF(_AX<=-90)OR(_AX>=90) GOTOF _FEHL8
IF(_AY<=-90)OR(_AY>=90) GOTOF _FEHL8
IF(_N1>1)AND(_L1==0) GOTOF _FEHL9
IF(_N2>1)AND(_L2==0) GOTOF _FEHL9
IF(_MODE==1)AND((_N1==1)OR(_N2==1))
_MODE=0
ENDIF
_HIDE=","<<_HIDE<<","
_INI=1
_NUM=0
REPEAT
REPEAT _NPOS1 _NPOS2
UNTIL _FOUND==FALSE
S_NUM_POS=S_ACT_POS
_INI=1
_NSP=_E_NSP
_NUM=_NSP
REPEAT _NPOS1 _NPOS2
_NUM=0
IF(_NSP>=1)
S_ACT_POS=S_ACT_POS+_NSP
ENDIF
IF(NOT _FOUND)
IF(_NSP==0)
GOTOF _FEHL1
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_RP<=_Z0) GOTOF _FEHL7
E_SP_ED(_SD)
_E_BO=_BO
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_SII=SIN(_A0)
_CO=COS(_A0)
IF(_E_TR[_IDD-1,0]>0)
_FIRST_POSMU = 1
ENDIF
IF(_E_POS_RP==0)AND(_FIRST_POSMU==0)
_E_MC=0
_X=_I1*_L1-_I2*_L2*TAN(_AY)
_Y=_I2*_L2+_I1*_L1*TAN(_AX)
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
N10 E_SP_RP(0,_Z0+_SC+_SD,_X0+_CO*_X-_SII*_Y,_Y0+_SII*_X+_CO*_Y,_Z0+_SC+_SD)
ELSE
N15 E_SP_RP(1,0,_X0+_CO*_X-_SII*_Y,_Y0+_SII*_X+_CO*_Y,_Z0+_SC+_SD)
ENDIF
ELSE
_E_MC=0
_X=_I1*_L1-_I2*_L2*TAN(_AY)
_Y=_I2*_L2+_I1*_L1*TAN(_AX)
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
N13 E_SP_RP(0,_RP+_SD,_X0+_CO*_X-_SII*_Y,_Y0+_SII*_X+_CO*_Y,_RP+_SD)
ELSE
N16 E_SP_RP(1,0,_X0+_CO*_X-_SII*_Y,_Y0+_SII*_X+_CO*_Y,_RP+_SD)
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_E_MC=1
_E_XREF=_X0*1/_FAK2
_E_YREF=_Y0*1/_FAK2
WHILE(_FOUND)
_X=_I1*_L1-_I2*_L2*TAN(_AY)
_Y=_I2*_L2+_I1*_L1*TAN(_AX)
_DX=_CO*_X-_SII*_Y _DY=_SII*_X+_CO*_Y
_E_BO=_BO
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
N19 SBLON
N20 G0 G9 G40 G90 AX[_XX]=_X0+_DX AX[_YY]=_Y0+_DY
N21 SBLOF
_E_BO=_BO
REPEAT _NPOS1 _NPOS2
ENDWHILE
G[29]=_P29
ELSE
IF(_OB==4)
_XX=$P_AXN1
_YY=$P_AXN2
_ZZ=$P_AXN3
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_X0=_E_TR[_IDD,3] _X0A=_E_TR[_IDD,4]
_Y0=_E_TR[_IDD,5] _Y0A=_E_TR[_IDD,6]
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_E_XREF=_X0*1/_FAK2
_E_YREF=_Y0*1/_FAK2
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_E_TR[_E_IR,0]=SET(-3,_Z0,_Z0A,_X0,_X0A,_Y0,_Y0A,_A0,_L1,_N1,_L2,_N2,_AX,_AY,_MODE)
_E_TS1[_E_IR]=_HIDE
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RETS:
RET
_NPOS1:
IF(_INI)
_INI=0
_POS=0
S_ACT_POS=0
IF(_MODE==0)
_MAX_POS=_N1*_N2
ELSE
_MAX_POS=2*(_N1+_N2)-4
ENDIF
ENDIF
_FOUND=0
WHILE(_FOUND<=_NUM)AND(_POS<_MAX_POS)
_POS=_POS+1
IF(_MODE==0)
_I1=(_POS-1)MOD _N1
_I2=(_POS-1)DIV _N1
IF(_I2 MOD 2)
_I1=_N1-_I1-1
ENDIF
ELSE
IF(_POS<=_N1-1)
_I1=_POS-1
_I2=0
ELSE
IF(_POS<=_N1+_N2-2)
_I1=_N1-1
_I2=_POS-_N1
ELSE
IF(_POS<=2*_N1+_N2-3)
_I1=2*_N1+_N2-2-_POS
_I2=_N2-1
ELSE
_I1=0
_I2=_MAX_POS-_POS+1
ENDIF
ENDIF
ENDIF
ENDIF
IF(MATCH(_HIDE,","<<_POS<<",")<0)AND(_POS<=_MAX_POS)
_FOUND=_FOUND+1
ENDIF
ENDWHILE
IF(_FOUND<=_NUM)
_FOUND=0
ELSE
S_ACT_POS=S_ACT_POS+1
ENDIF
_NPOS2:
_FEHL1: STOPRE
N880101 SETAL(61103)
RET
_FEHL2: STOPRE
N880102 SETAL(61200)
RET
_FEHL3: STOPRE
N880103 SETAL(61205)
RET
_FEHL4: STOPRE
N880104 SETAL(61210)
RET
_FEHL5: STOPRE
N880105 SETAL(61211)
RET
_FEHL6: STOPRE
N880106 SETAL(62100)
M0
RET
_FEHL7: STOPRE
N880107 SETAL(61101)
RET
_FEHL8: STOPRE
N880108 SETAL(61184)
RET
_FEHL9: STOPRE
N880109 SETAL(61118)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_POL_SPF
PROC E_PS_POL(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,REAL _XP,INT _XPA,REAL _YP,INT _YPA,REAL _L0,INT _L0A,REAL _A0,INT _A0A,REAL _L1,INT _L1A,REAL _A1,INT _A1A,REAL _L2,INT _L2A,REAL _A2,INT _A2A,REAL _L3,INT _L3A,REAL _A3,INT _A3A,REAL _L4,INT _L4A,REAL _A4,INT _A4A,REAL _L5,INT _L5A,REAL _A5,INT _A5A,REAL _L6,INT _L6A,REAL _A6,INT _A6A,REAL _L7,INT _L7A,REAL _A7,INT _A7A,INT _NR) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.011 ;DATE: 2024-06-04
;ShopMill: Positioning Cycle, polar
DEF AXIS _XX,_YY,_ZZ
DEF INT _I,_IDM,_NSP,_LA,_AA,_TRI,_FIRST_POSMU=0,_P29,S_SSL,S_ACT_POS,S_NUM_POS
DEF REAL _FAK1,_FAK2,_SC,_X,_XPOS,_Y,_YPOS,_XREF,_YREF,_ZREF,_RP,_SD,_POL_L,_POL_A,_L,_A,_TR[8,2]
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ELSE
_XREF=_E_XREF
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ELSE
_YREF=_E_YREF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_E_ZREF
ENDIF
IF(_E_POL_L<>_SC_NO_VAL)
_POL_L=_E_POL_L*_FAK2
ELSE
_POL_L=_E_POL_L
ENDIF
_POL_A=_E_POL_A
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(_IDD>=0)
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
_XP=_E_TR[_IDD,3] _XPA=_E_TR[_IDD,4]
_YP=_E_TR[_IDD,5] _YPA=_E_TR[_IDD,6]
_IDM=_IDD
ENDIF
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
IF($P_MC==0) GOTOF _FEHL6
_NSP=_E_NSP
IF(_NSP)
S_SSL=1
ENDIF
IF(_NSP>=9) GOTOF _FEHL4
S_ACT_POS=_NSP+1
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_RP<=_Z0) GOTOF _FEHL7
E_SP_ED(_SD)
_E_BO=_BO
_XPOS=$P_EP[_XX]*_FAK1
_YPOS=$P_EP[_YY]*_FAK1
IF(_XPA>0)
IF(_XPA==91)
_XP=_XP+_XPOS
ELSE
IF(_XPA==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_XP=_XP+_XREF
ENDIF
ENDIF
ELSE
_XP=_E_POL_X
ENDIF
IF(_YPA>0)
IF(_YPA==91)
_YP=_YP+_YPOS
ELSE
IF(_YPA==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_YP=_YP+_YREF
ENDIF
ENDIF
ELSE
_YP=_E_POL_Y
ENDIF
IF(_XP==_SC_NO_VAL)OR(_YP==_SC_NO_VAL)GOTOF _FEHL5
_E_POL_X=_XP
_E_POL_Y=_YP
_TRI=-1
_POL_L=0
_POL_A=0
FOR _I=0 TO 7
_L =_E_TR[_IDM,7+4*_I]
_LA=_E_TR[_IDM,8+4*_I]
_A =_E_TR[_IDM,9+4*_I]
_AA=_E_TR[_IDM,10+4*_I]
IF(_LA>0)OR(_AA>0)
IF(_LA==0)
_L=_POL_L
ELSE
IF(_LA==91)OR(_LA==92)
_L=_L+_POL_L
ENDIF
ENDIF
IF(_AA==0)
_A=_POL_A
ELSE
IF(_AA==91)OR(_AA==92)
_A=_A+_POL_A
ENDIF
ENDIF
_POL_L=_L
_POL_A=_A
_X=_XP+_L*COS(_A)
_Y=_YP+_L*SIN(_A)
ENDIF
IF((_LA>0)OR(_AA>0))AND(_I>=_NSP)
_TRI=_TRI+1
_TR[_TRI,0]=_X
_TR[_TRI,1]=_Y
ENDIF
ENDFOR
IF(_TRI<0)AND(S_SSL) GOTOF _FEHL4
IF(_TRI<0) GOTOF _FEHL1
S_NUM_POS=S_ACT_POS+_TRI
IF(_E_TR[_IDD-1,0]>0)
_FIRST_POSMU = 1
ENDIF
IF(_E_POS_RP==0)AND(_FIRST_POSMU==0)
_E_MC=0
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
N10 E_SP_RP(0,_Z0+_SC+_SD,_TR[0,0],_TR[0,1],_Z0+_SC+_SD)
ELSE
N15 E_SP_RP(1,0,_TR[0,0],_TR[0,1],_Z0+_SC+_SD)
ENDIF
ELSE
_E_MC=0
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
N13 E_SP_RP(0,_RP+_SD,_TR[0,0],_TR[0,1],_RP+_SD)
ELSE
N15 E_SP_RP(1,0,_TR[0,0],_TR[0,1],_RP+_SD)
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_E_MC=1
FOR _I=0 TO _TRI
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
S_ACT_POS=S_ACT_POS+1
N19 SBLON
N20 G90 G0 G40 AX[_XX]=_TR[_I,0] AX[_YY]=_TR[_I,1]
N21 SBLOF
_E_BO=_BO
ENDFOR
_E_XREF=_XP/_FAK2
_E_YREF=_YP/_FAK2
_E_POL_L=_POL_L/_FAK2
_E_POL_A=_POL_A
G[29]=_P29
ELSE
IF(_OB==4)
_E_XREF=_SC_NO_VAL
_E_YREF=_SC_NO_VAL
_E_ZREF=_SC_NO_VAL
_E_POL_L=_SC_NO_VAL
_E_POL_A=_SC_NO_VAL
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_E_TR[_E_IR, 0]=SET(-6,_Z0,_Z0A,_XP,_XPA,_YP,_YPA,_L0,_L0A,_A0,_A0A)
_E_TR[_E_IR,11]=SET(_L1,_L1A,_A1,_A1A,_L2,_L2A,_A2,_A2A,_L3,_L3A,_A3,_A3A)
_E_TR[_E_IR,23]=SET(_L4,_L4A,_A4,_A4A,_L5,_L5A,_A5,_A5A,_L6,_L6A,_A6,_A6A)
_E_TR[_E_IR,35]=SET(_L7,_L7A,_A7,_A7A)
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N880221 SETAL(61103)
RET
_FEHL2: STOPRE
N880222 SETAL(61200)
RET
_FEHL3: STOPRE
N880223 SETAL(61205)
RET
_FEHL4: STOPRE
N880224 SETAL(61210)
RET
_FEHL5: STOPRE
N880225 SETAL(61211)
RET
_FEHL6: STOPRE
N880226 SETAL(62100)
M0
RET
_FEHL7: STOPRE
N880227 SETAL(61101)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_ROW_SPF
PROC E_PS_ROW(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _A0,REAL _L,INT _N,INT _NR,STRING[200] _HIDE,REAL _L0) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: positions row
DEF AXIS _XX,_YY,_ZZ
DEF INT _I,_FOUND,_NSP,_POS,_MAX_POS,_NUM,_INI,_FIRST_POSMU=0,_P29,S_ACT_POS,S_NUM_POS
DEF REAL _X,_DX,_DY,_SII,_CO,_FAK1,_FAK2,_SC,_XREF,_YREF,_ZREF,_RP,_SD
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ELSE
_XREF=_E_XREF
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ELSE
_YREF=_E_YREF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_E_ZREF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(_IDD>=0)
_Z0 =_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2] _X0 =_E_TR[_IDD,3] _X0A=_E_TR[_IDD,4]
_Y0 =_E_TR[_IDD,5] _Y0A=_E_TR[_IDD,6] _A0 =_E_TR[_IDD,7] _L0 =_E_TR[_IDD,8]
_L =_E_TR[_IDD,9] _N =_E_TR[_IDD,10]
_HIDE=_E_TS1[_IDD]
ENDIF
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
IF($P_MC==0) GOTOF _FEHL6
IF(_N<=0) GOTOF _FEHL1
IF(_N>1)AND(_L==0) GOTOF _FEHL9
_HIDE=","<<_HIDE<<","
_INI=1
_NUM=0
REPEAT
REPEAT _NPOS1 _NPOS2
UNTIL _FOUND==FALSE
S_NUM_POS=S_ACT_POS
_INI=1
_NSP=_E_NSP
_NUM=_NSP
REPEAT _NPOS1 _NPOS2
_NUM=0
IF(_NSP>=1)
S_ACT_POS=S_ACT_POS+_NSP
ENDIF
IF(NOT _FOUND)
IF(_NSP==0)
GOTOF _FEHL1
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_RP<=_Z0) GOTOF _FEHL7
E_SP_ED(_SD)
_E_BO=_BO
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_SII=SIN(_A0)
_CO=COS(_A0)
IF(_E_TR[_IDD-1,0]>0)
_FIRST_POSMU = 1
ENDIF
IF(_E_POS_RP==0)AND(_FIRST_POSMU==0)
_E_MC=0
_X=_L0+_I*_L
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
N10 E_SP_RP(0,_Z0+_SC+_SD,_X0+_CO*_X,_Y0+_SII*_X,_Z0+_SC+_SD)
ELSE
N15 E_SP_RP(1,0,_X0+_CO*_X,_Y0+_SII*_X,_Z0+_SC+_SD)
ENDIF
ELSE
_E_MC=0
_X=_L0+_I*_L
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
N13 E_SP_RP(0,_RP+_SD,_X0+_CO*_X,_Y0+_SII*_X,_RP+_SD)
ELSE
N16 E_SP_RP(1,0,_X0+_CO*_X,_Y0+_SII*_X,_RP+_SD)
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_E_MC=1
_E_XREF=_X0*1/_FAK2
_E_YREF=_Y0*1/_FAK2
WHILE(_FOUND)
_X=_L0+_I*_L
_DX=_CO*_X _DY=_SII*_X
_E_BO=_BO
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
N19 SBLON
N20 G0 G9 G40 G90 AX[_XX]=_X0+_DX AX[_YY]=_Y0+_DY
N21 SBLOF
_E_BO=_BO
REPEAT _NPOS1 _NPOS2
ENDWHILE
G[29]=_P29
ELSE
IF(_OB==4)
_XX=$P_AXN1
_YY=$P_AXN2
_ZZ=$P_AXN3
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_X0=_E_TR[_IDD,3] _X0A=_E_TR[_IDD,4]
_Y0=_E_TR[_IDD,5] _Y0A=_E_TR[_IDD,6]
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
ENDIF
_E_XREF=_X0*1/_FAK2
_E_YREF=_Y0*1/_FAK2
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_E_TR[_E_IR,0]=SET(-2,_Z0,_Z0A,_X0,_X0A,_Y0,_Y0A,_A0,_L0,_L,_N)
_E_TS1[_E_IR]=_HIDE
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RETS:
RET
_NPOS1:
IF(_INI)
_INI=0
_POS=0
S_ACT_POS=0
_MAX_POS=_N
ENDIF
_FOUND=0
WHILE(_FOUND<=_NUM)AND(_POS<_MAX_POS)
_POS=_POS+1
_I=_POS-1
IF(MATCH(_HIDE,","<<_POS<<",")<0)AND(_POS<=_MAX_POS)
_FOUND=_FOUND+1
ENDIF
ENDWHILE
IF(_FOUND<=_NUM)
_FOUND=0
ELSE
S_ACT_POS=S_ACT_POS+1
ENDIF
_NPOS2:
_FEHL1: STOPRE
N830201 SETAL(61103)
RET
_FEHL2: STOPRE
N830202 SETAL(61200)
RET
_FEHL3: STOPRE
N830203 SETAL(61205)
RET
_FEHL4: STOPRE
N830204 SETAL(61210)
RET
_FEHL5: STOPRE
N830205 SETAL(61211)
RET
_FEHL6: STOPRE
N830206 SETAL(62100)
M0
RET
_FEHL7: STOPRE
N830207 SETAL(61101)
RET
_FEHL9: STOPRE
N830209 SETAL(61118)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_SEQ_SPF
PROC E_PS_SEQ(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _X1,INT _X1A,REAL _Y1,INT _Y1A,REAL _X2,INT _X2A,REAL _Y2,INT _Y2A,REAL _X3,INT _X3A,REAL _Y3,INT _Y3A,REAL _X4,INT _X4A,REAL _Y4,INT _Y4A,REAL _X5,INT _X5A,REAL _Y5,INT _Y5A,REAL _X6,INT _X6A,REAL _Y6,INT _Y6A,REAL _X7,INT _X7A,REAL _Y7,INT _Y7A,REAL _X8,INT _X8A,REAL _Y8,INT _Y8A,INT _NR) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: positions sequential
DEF AXIS _XX,_YY,_ZZ
DEF INT _I,_XA,_YA,_IDM,_NSP,_TRI,_FIRST_POSMU=0,S_SSL,_P29,S_ACT_POS,S_NUM_POS
DEF REAL _FAK1,_FAK2,_RP,_SC,_SD,_X,_XP,_Y,_YP,_XREF,_YREF,_ZREF,_TR[9,2]
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ELSE
_XREF=_E_XREF
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ELSE
_YREF=_E_YREF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_E_ZREF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(_IDD>=0)
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
_IDM=_IDD
ENDIF
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
IF($P_MC==0) GOTOF _FEHL6
_NSP=_E_NSP
IF(_NSP)
S_SSL=1
ENDIF
IF(_NSP>=9) GOTOF _FEHL4
S_ACT_POS=_NSP+1
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_RP<=_Z0) GOTOF _FEHL7
E_SP_ED(_SD)
_E_BO=_BO
_XP=$P_EP[_XX]*_FAK1
_YP=$P_EP[_YY]*_FAK1
_TRI=-1
FOR _I=0 TO 8
_X =_E_TR[_IDM,3+4*_I]
_XA=_E_TR[_IDM,4+4*_I]
_Y =_E_TR[_IDM,5+4*_I]
_YA=_E_TR[_IDM,6+4*_I]
IF(_XA>0)OR(_YA>0)
IF(_XA==0)
_X=_XP
ELSE
IF(_XA==91)
_X=_X+_XP
ELSE
IF(_XA==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X=_X+_XREF
ENDIF
ENDIF
ENDIF
IF(_YA==0)
_Y=_YP
ELSE
IF(_YA==91)
_Y=_Y+_YP
ELSE
IF(_YA==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y=_Y+_YREF
ENDIF
ENDIF
ENDIF
_XREF=_X
_YREF=_Y
_XP=_X
_YP=_Y
IF(_I>=_NSP)
_TRI=_TRI+1
_TR[_TRI,0]=_X
_TR[_TRI,1]=_Y
ENDIF
ELSE
_NSP=_NSP+1
IF(_I==0)
_XREF=_SC_NO_VAL
_YREF=_SC_NO_VAL
_XP=_SC_NO_VAL
_YP=_SC_NO_VAL
ENDIF
ENDIF
IF(_I==0)
IF(_XREF==_SC_NO_VAL)
_E_XREF=_SC_NO_VAL
ELSE
_E_XREF=_XREF*1/_FAK2
ENDIF
IF(_YREF==_SC_NO_VAL)
_E_YREF=_SC_NO_VAL
ELSE
_E_YREF=_YREF*1/_FAK2
ENDIF
ENDIF
ENDFOR
IF(_TRI<0)AND(S_SSL) GOTOF _FEHL4
IF(_TRI<0) GOTOF _FEHL1
S_NUM_POS=S_ACT_POS+_TRI
IF(_E_TR[_IDD-1,0]>0)
_FIRST_POSMU = 1
ENDIF
IF(_E_POS_RP==0)AND(_FIRST_POSMU==0)
_E_MC=0
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
N10 E_SP_RP(0,_Z0+_SC+_SD,_TR[0,0],_TR[0,1],_Z0+_SC+_SD)
ELSE
N15 E_SP_RP(1,0,_TR[0,0],_TR[0,1],_Z0+_SC+_SD)
ENDIF
ELSE
_E_MC=0
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
N13 E_SP_RP(0,_RP+_SD,_TR[0,0],_TR[0,1],_RP+_SD)
ELSE
N15 E_SP_RP(1,0,_TR[0,0],_TR[0,1],_RP+_SD)
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_E_MC=1
FOR _I=0 TO _TRI
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
S_ACT_POS=S_ACT_POS+1
SBLON
N20 G90 G0 G40 AX[_XX]=_TR[_I,0] AX[_YY]=_TR[_I,1]
SBLOF
_E_BO=_BO
ENDFOR
G[29]=_P29
ELSE
IF(_OB==4)
_XX=$P_AXN1
_YY=$P_AXN2
_ZZ=$P_AXN3
_XP=$P_EP[_XX]*_FAK1
_YP=$P_EP[_YY]*_FAK1
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_X =_E_TR[_IDD,3]
_XA=_E_TR[_IDD,4]
_Y =_E_TR[_IDD,5]
_YA=_E_TR[_IDD,6]
IF(_XA>0)OR(_YA>0)
IF(_XA==0)
_X=_XP
ELSE
IF(_XA==91)
_X=_X+_XP
ELSE
IF(_XA==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X=_X+_XREF
ENDIF
ENDIF
ENDIF
IF(_YA==0)
_Y=_YP
ELSE
IF(_YA==91)
_Y=_Y+_YP
ELSE
IF(_YA==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y=_Y+_YREF
ENDIF
ENDIF
ENDIF
ELSE
_X=_SC_NO_VAL
_Y=_SC_NO_VAL
ENDIF
IF(_X==_SC_NO_VAL)
_E_XREF=_SC_NO_VAL
ELSE
_E_XREF=_X*1/_FAK2
ENDIF
IF(_Y==_SC_NO_VAL)
_E_YREF=_SC_NO_VAL
ELSE
_E_YREF=_Y*1/_FAK2
ENDIF
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
_E_TR[_E_IR, 0]=SET(-1,_Z0,_Z0A,_X0,_X0A,_Y0,_Y0A,_X1,_X1A,_Y1,_Y1A)
_E_TR[_E_IR,11]=SET(_X2,_X2A,_Y2,_Y2A,_X3,_X3A,_Y3,_Y3A,_X4,_X4A,_Y4,_Y4A)
_E_TR[_E_IR,23]=SET(_X5,_X5A,_Y5,_Y5A,_X6,_X6A,_Y6,_Y6A,_X7,_X7A,_Y7,_Y7A)
_E_TR[_E_IR,35]=SET(_X8,_X8A,_Y8,_Y8A)
_E_IR=_E_IR+1
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N880201 SETAL(61103)
RET
_FEHL2: STOPRE
N880202 SETAL(61200)
RET
_FEHL3: STOPRE
N880203 SETAL(61205)
RET
_FEHL4: STOPRE
N880204 SETAL(61210)
RET
_FEHL5: STOPRE
N880205 SETAL(61211)
RET
_FEHL6: STOPRE
N880206 SETAL(62100)
M0
RET
_FEHL7: STOPRE
N880207 SETAL(61101)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PS_XYA_SPF
PROC E_PS_XYA(INT _OB,INT _BO,INT _IDD,REAL _Z0,INT _Z0A,INT _ST,_E_MAC_XYA_0_4,_E_MAC_XYA_5_8,INT _NR) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.011 ;DATE: 2024-06-04
;ShopMill: Positioning cycle with rotary axis
DEF AXIS _XX,_YY,_ZZ,_AA
DEF INT _ABA,_ABRI,_I,_II,_III,_IDM,_XA,_YA,_NSP,_ST1,_ST2,_TRI,_TRAC=0,_INT,_P29,S_SSL,S_ACT_POS,S_NUM_POS
DEF INT _GEO[3,3]=SET(1,2,0,2,0,1,0,1,2)
DEF REAL _A,_AP,_FAK1,_FAK2,_MODR,_MODS,_RP,_SC,_SD,_TR[9,3],_TRAD,_X,_XP,_Y,_YP,_XREF,_YREF,_ZREF
DEF STRING[200] _STR
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
G4 F0
IF($P_TRAFO B_AND 'H200')
_TRAC=1
_TRAD=$P_TRAFO_PAR[0]
ENDIF
IF(_TRAC==1)AND((_ST MOD 10)==1) GOTOF _FEHL9
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ELSE
_XREF=_E_XREF
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ELSE
_YREF=_E_YREF
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ELSE
_ZREF=_E_ZREF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0)
IF(_IDD>=0)
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2] _ST=_E_TR[_IDD,3]
_IDM=_IDD
_IDD=-1
_ST1=_ST _DEC1
_ST2=_ST _DEC2
IF(_ST1==1)
_III=5
ELSE
_III=8
ENDIF
ENDIF
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
IF($P_MC==0) GOTOF _FEHL6
_NSP=_E_NSP
IF(_NSP)
S_SSL=1
ENDIF
IF(_NSP>_III) GOTOF _FEHL4
S_ACT_POS=_NSP+1
_I=_ST _DEC2
IF(_I<0)OR(_I>2)GOTOF _FEHL8
IF(_SC_ROT_AX[0,_I]==0)GOTOF _FEHL8
_II=10*(_ST _DEC4)+_ST _DEC3
IF(_II>_SC_ROT_AX[0,_I]-1)
_II=0
ENDIF
_AA=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_SC_ROT_AX[_II+1,_I]-1])
IF($MA_ROT_IS_MODULO[_AA])
_MODR=$MA_MODULO_RANGE[_AA]
_MODS=$MA_MODULO_RANGE_START[_AA]
ENDIF
IF(_TRAC)
IF($PC_TRAFO_TYPE_NAME=="TRACYL_K")
IF($NT_CNTRL[$P_TRAFO_PARSET MOD 1000] B_AND 'H800'=='H800')
_ABRI=1
ELSE
_ABRI=-1
ENDIF
ELSE
_STR="_INT=$MC_TRACYL_ROT_SIGN_IS_PLUS_"<<$P_TRAFO_PARSET
EXECSTRING(_STR)
IF(_INT==0)
_ABRI=-1
ELSE
_ABRI=1
ENDIF
ENDIF
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
IF(_RP<=_Z0) GOTOF _FEHL7
E_SP_ED(_SD)
_E_BO=_BO
IF(_E_POS_RP==0)
_E_MC=0
IF(_Z0+_SC+_SD>$P_EP[_ZZ]*_FAK1)
SBLON
N10 G90 G0 AX[_ZZ]=_Z0+_SC+_SD
SBLOF
ENDIF
ELSE
_E_MC=0
IF(_RP+_SD>$P_EP[_ZZ]*_FAK1)
SBLON
N15 G90 G0 AX[_ZZ]=_RP+_SD
SBLOF
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_E_MC=1
_XP=$P_EP[_XX]*_FAK1 _YP=$P_EP[_YY]*_FAK1
IF(_TRAC==0)
_AP=$P_EP[_AA]
ENDIF
_TRI=-1
FOR _I=0 TO _III
IF(_ST1==1)
_X=_E_TR[_IDM,4+6*_I] _XA=_E_TR[_IDM,5+6*_I]
_Y=_E_TR[_IDM,6+6*_I] _YA=_E_TR[_IDM,7+6*_I]
_A=_E_TR[_IDM,8+6*_I] _ABA=_E_TR[_IDM,9+6*_I]
IF(_XA>0)OR(_YA>0)OR(_ABA>0)
IF(_XA==0)
_X=_XP
ELSE
IF(_XA==91)
_X=_X+_XP
ELSE
IF(_XA==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X=_X+_XREF
ENDIF
ENDIF
ENDIF
IF(_YA==0)
_Y=_YP
ELSE
IF(_YA==91)
_Y=_Y+_YP
ELSE
IF(_YA==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y=_Y+_YREF
ENDIF
ENDIF
ENDIF
IF(_ABA==0)
_A=_AP
ELSE
IF(_ABA==91)OR(_ABA==92)
_A=_A+_AP
ENDIF
ENDIF
IF($MA_ROT_IS_MODULO[_AA])
_A=((((_A-_MODS) MOD _MODR) + _MODR) MOD _MODR) + _MODS
ENDIF
_XREF=_X _YREF=_Y
_XP=_X _YP=_Y
_AP=_A
IF(_I>=_NSP)
_TRI=_TRI+1
_TR[_TRI,0]=_X _TR[_TRI,1]=_Y _TR[_TRI,2]=_A
ENDIF
ELSE
IF(_I==0)
_XREF=_SC_NO_VAL
_YREF=_SC_NO_VAL
_XP=_SC_NO_VAL
_YP=_SC_NO_VAL
ENDIF
ENDIF
IF(_I==0)
IF(_XREF==_SC_NO_VAL)
_E_XREF=_SC_NO_VAL
ELSE
_E_XREF=_XREF*1/_FAK2
ENDIF
IF(_YREF==_SC_NO_VAL)
_E_YREF=_SC_NO_VAL
ELSE
_E_YREF=_YREF*1/_FAK2
ENDIF
ENDIF
ELSE
IF(_GEO[$P_GG[6]-1,_ST2]==1)
_X=_E_TR[_IDM,4+4*_I] _XA=_E_TR[_IDM,5+4*_I]
_A=_E_TR[_IDM,6+4*_I] _ABA=_E_TR[_IDM,7+4*_I]
IF(_XA>0)OR(_ABA>0)
IF(_XA==0)
_X=_XP
ELSE
IF(_XA==91)
_X=_X+_XP
ELSE
IF(_XA==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X=_X+_XREF
ENDIF
ENDIF
ENDIF
IF(_ABA==0)
_A=_AP
ELSE
IF(_ABA==91)OR(_ABA==92)
_A=_A+_AP
ENDIF
ENDIF
IF(($MA_ROT_IS_MODULO[_AA])AND(_TRAC==0))
_A=((((_A-_MODS) MOD _MODR) + _MODR) MOD _MODR) + _MODS
ENDIF
_XREF=_X
_XP=_X _AP=_A
IF(_I>=_NSP)
_TRI=_TRI+1
_TR[_TRI,0]=_X
IF(_TRAC==0)
_TR[_TRI,2]=_A
ELSE
_A=_TRAD*$PI*_A/360
_TR[_TRI,1]=_A*_ABRI
ENDIF
ENDIF
ELSE
IF(_I==0)
_XREF=_SC_NO_VAL
_XP=_SC_NO_VAL
ENDIF
ENDIF
IF(_I==0)
IF(_XREF==_SC_NO_VAL)
_E_XREF=_SC_NO_VAL
ELSE
_E_XREF=_XREF*1/_FAK2
ENDIF
ENDIF
ELSE
_Y=_E_TR[_IDM,4+4*_I] _YA=_E_TR[_IDM,5+4*_I]
_A=_E_TR[_IDM,6+4*_I] _ABA=_E_TR[_IDM,7+4*_I]
IF(_YA>0)OR(_ABA>0)
IF(_YA==0)
_Y=_YP
ELSE
IF(_YA==91)
_Y=_Y+_YP
ELSE
IF(_YA==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y=_Y+_YREF
ENDIF
ENDIF
ENDIF
IF(_ABA==0)
_A=_AP
ELSE
IF(_ABA==91)OR(_ABA==92)
_A=_A+_AP
ENDIF
ENDIF
IF(($MA_ROT_IS_MODULO[_AA])AND(_TRAC==0))
_A=((((_A-_MODS) MOD _MODR) + _MODR) MOD _MODR) + _MODS
ENDIF
_YREF=_Y
_YP=_Y _AP=_A
IF(_I>=_NSP)
_TRI=_TRI+1
_TR[_TRI,1]=_Y
IF(_TRAC==0)
_TR[_TRI,2]=_A
ELSE
_A=_TRAD*$PI*_A/360
_TR[_TRI,0]=_A*_ABRI
ENDIF
ENDIF
ELSE
IF(_I==0)
_YREF=_SC_NO_VAL
_YP=_SC_NO_VAL
ENDIF
ENDIF
IF(_I==0)
IF(_YREF==_SC_NO_VAL)
_E_YREF=_SC_NO_VAL
ELSE
_E_YREF=_YREF*1/_FAK2
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
IF(_TRI<0)AND(S_SSL) GOTOF _FEHL4
IF(_TRI<0) GOTOF _FEHL1
S_NUM_POS=S_ACT_POS+_TRI
FOR _I=0 TO _TRI
WRTPR("POSITIONS("<<S_E_ACT_TECH<<","<<S_E_ACT_POSM<<","<<S_ACT_POS<<","<<S_NUM_POS<<","<<$P_LINENO[0]<<","<<$P_PROG[0]<<")")
S_ACT_POS=S_ACT_POS+1
IF(_ST1==1)
SBLON
N20 G90 G0 G40 AX[_XX]=_TR[_I,0] AX[_YY]=_TR[_I,1] AX[_AA]=_TR[_I,2]
SBLOF
_E_BO=_BO
ELSE
IF(_GEO[$P_GG[6]-1,_ST2]==1)
IF(_TRAC==0)
SBLON
N25 G90 G0 G40 AX[_XX]=_TR[_I,0] AX[_AA]=_TR[_I,2]
SBLOF
ELSE
SBLON
N30 G90 G0 G40 AX[_XX]=_TR[_I,0] AX[_YY]=_TR[_I,1]
SBLOF
ENDIF
_E_BO=_BO
ELSE
IF(_TRAC==0)
SBLON
N35 G90 G0 G40 AX[_YY]=_TR[_I,1] AX[_AA]=_TR[_I,2]
SBLOF
ELSE
SBLON
N40 G90 G0 G40 AX[_YY]=_TR[_I,1] AX[_XX]=_TR[_I,0]
SBLOF
ENDIF
_E_BO=_BO
ENDIF
ENDIF
ENDFOR
G[29]=_P29
ELSE
IF(_OB==4)
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
_XP=$P_EP[_XX]*_FAK1 _YP=$P_EP[_YY]*_FAK1
_Z0=_E_TR[_IDD,1] _Z0A=_E_TR[_IDD,2]
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
ENDIF
_E_ZREF=_Z0*1/_FAK2
_ST=_E_TR[_IDD,3]
_ST1=_ST _DEC1
_ST2=_ST _DEC2
IF(_ST1)
_X=_E_TR[_IDD,4] _XA=_E_TR[_IDD,5]
_Y=_E_TR[_IDD,6] _YA=_E_TR[_IDD,7]
_A=_E_TR[_IDD,8] _ABA=_E_TR[_IDD,9]
ELSE
IF(_GEO[$P_GG[6]-1,_ST2]==1)
_X=_E_TR[_IDD,4] _XA=_E_TR[_IDD,5]
_A=_E_TR[_IDD,6] _ABA=_E_TR[_IDD,7]
ELSE
_Y=_E_TR[_IDD,4] _YA=_E_TR[_IDD,5]
_A=_E_TR[_IDD,6] _ABA=_E_TR[_IDD,7]
ENDIF
ENDIF
IF(_ST1)OR(_GEO[$P_GG[6]-1,_ST2]==1)
IF(_XA==0)
_X=_XP
ELSE
IF(_XA==91)
_X=_X+_XP
ELSE
IF(_XA==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X=_X+_XREF
ENDIF
ENDIF
ENDIF
_E_XREF=_X*1/_FAK2
ENDIF
IF(_ST1)OR(_GEO[$P_GG[6]-1,_ST2]==2)
IF(_YA==0)
_Y=_YP
ELSE
IF(_YA==91)
_Y=_Y+_YP
ELSE
IF(_YA==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y=_Y+_YREF
ENDIF
ENDIF
ENDIF
_E_YREF=_Y*1/_FAK2
ENDIF
ELSE
IF(_E_IR>=_E_MAX) GOTOF _FEHL2
IF(_ST _DEC1)
_E_TR[_E_IR, 0]=SET(-7,_Z0,_Z0A,_ST,_X0,_X0A,_Y0,_Y0A,_AB0,_AB0A,_X1,_X1A,_Y1,_Y1A,_AB1,_AB1A)
_E_TR[_E_IR,16]=SET(_X2,_X2A,_Y2,_Y2A,_AB2,_AB2A,_X3,_X3A,_Y3,_Y3A,_AB3,_AB3A)
_E_TR[_E_IR,28]=SET(_X4,_X4A,_Y4,_Y4A,_AB4,_AB4A,_X5,_X5A,_Y5,_Y5A,_AB5,_AB5A)
_E_IR=_E_IR+1
ELSE
_I=_ST _DEC2
IF(_I<0)OR(_I>2)
_I=0
ENDIF
IF(_GEO[$P_GG[6]-1,_I]==0)GOTOF _FEHL10
IF(_GEO[$P_GG[6]-1,_I]==1)
_E_TR[_E_IR, 0]=SET(-7,_Z0,_Z0A,_ST,_X0,_X0A,_AB0,_AB0A,_X1,_X1A,_AB1,_AB1A)
_E_TR[_E_IR,12]=SET(_X2,_X2A,_AB2,_AB2A,_X3,_X3A,_AB3,_AB3A,_X4,_X4A,_AB4,_AB4A)
_E_TR[_E_IR,24]=SET(_X5,_X5A,_AB5,_AB5A,_X6,_X6A,_AB6,_AB6A,_X7,_X7A,_AB7,_AB7A)
_E_TR[_E_IR,36]=SET(_X8,_X8A,_AB8,_AB8A)
_E_IR=_E_IR+1
ELSE
_E_TR[_E_IR, 0]=SET(-7,_Z0,_Z0A,_ST,_Y0,_Y0A,_AB0,_AB0A,_Y1,_Y1A,_AB1,_AB1A)
_E_TR[_E_IR,12]=SET(_Y2,_Y2A,_AB2,_AB2A,_Y3,_Y3A,_AB3,_AB3A,_Y4,_Y4A,_AB4,_AB4A)
_E_TR[_E_IR,24]=SET(_Y5,_Y5A,_AB5,_AB5A,_Y6,_Y6A,_AB6,_AB6A,_Y7,_Y7A,_AB7,_AB7A)
_E_TR[_E_IR,36]=SET(_Y8,_Y8A,_AB8,_AB8A)
_E_IR=_E_IR+1
ENDIF
ENDIF
IF(_E_POS<1) GOTOF _FEHL3
_E_POS=_E_POS-1
IF(_E_POS==0)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
_RETS:
RET
_FEHL1: STOPRE
N880241 SETAL(61103)
RET
_FEHL2: STOPRE
N880242 SETAL(61200)
RET
_FEHL3: STOPRE
N880243 SETAL(61205)
RET
_FEHL4: STOPRE
N880244 SETAL(61210)
RET
_FEHL5: STOPRE
N880245 SETAL(61211)
RET
_FEHL6: STOPRE
N880246 SETAL(62100)
M0
RET
_FEHL7: STOPRE
N880247 SETAL(61101)
RET
_FEHL8: STOPRE
N880248 SETAL(61329)
RET
_FEHL9: STOPRE
N880249 SETAL(61020)
RET
_FEHL10: STOPRE
N880250 SETAL(61853,"G"<<$P_GG[6]+16)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_S_ASUP_SPF
PROC E_S_ASUP SBLOF SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.005 ;DATE: 2024-03-27
;ShopMill: Cycle for Actions after Block Search
DEF AXIS _AX
DEF INT _TI,_TII,_TFI,_DD,_SA,_T_ST_NEW,_G44=0,_I,_S_NR,S_TI,S_THNR,_SMODE,_WTYP,_P15,_MSNUM,S_DL=-1
DEF REAL _S,_POS,_MODR,_MODS
DEF STRING[32] _T,_TF
DEF STRING[40] _STR,S_F_STR
DEF INT _LOG,_LOG_ON
DEF STRING[35] _LOG_FILE
_LOG_FILE="/_N_MPF_DIR/_N_LOG_E_S_ASUP_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
DELETE(_LOG,_LOG_FILE)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"$P_SEARCHL ="<<$P_SEARCHL)
WRITE(_LOG,_LOG_FILE,"$AC_SERUPRO="<<$AC_SERUPRO)
WRITE(_LOG,_LOG_FILE,"_E_T_NEW   ="<<_E_T_NEW)
WRITE(_LOG,_LOG_FILE,"_E_D_NEW   ="<<_E_D_NEW)
WRITE(_LOG,_LOG_FILE,"_E_S_NEW   ="<<_E_S_NEW)
WRITE(_LOG,_LOG_FILE,"_E_SA_NEW  ="<<_E_SA_NEW)
ENDIF
IF($P_SEARCHL==2)OR($P_SEARCHL==4)OR($AC_SERUPRO)
IF($MN_MM_EXTERN_LANGUAGE==1)
IF($P_EXTGG[8]==2)
_G44=1
ENDIF
ENDIF
_MSNUM=$P_MSNUM
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Masterspindel: S"<<_MSNUM)
ENDIF
_P15=$P_GG[15]
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF($P_FZ>0)
S_F_STR="FZ="<<$P_FZ
ENDIF
ELSE
IF($P_F>0)
S_F_STR="F="<<$P_F
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G"<<_P15+92<<" aktiv "<<S_F_STR)
ENDIF
N8 G40
IF($P_TC)OR(_TC_NUM)
IF($P_TC)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC Anwahl/Umwahl")
ENDIF
E_TCARR(,,,,128,,,,,,,,,,,)
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC Abwahl")
ENDIF
E_TCARR("0",,,,128,,,,,,,,,,,)
ENDIF
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")
IF(($NT_IDENT[$P_TRAFO_PARSET MOD 1000,0] _DEC5)>=2)
IF(_F_S_NR[0]>0)
IF($P_MSNUM<>_F_S_NR[0])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAORI_STAT -> SETMS("<<_F_S_NR[0]<<")")
ENDIF
SETMS(_F_S_NR[0])
ENDIF
ENDIF
ENDIF
ENDIF
GETEXET(_TII)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TII="<<_TII)
ENDIF
IF(_E_T_NEW=="")
_T_ST_NEW=0
IF(_TII)
_T=$TC_TP2[_TII]
_DD=$P_TOOL
S_DL=$P_DLNO
ELSE
_T="0"
_DD=0
S_DL=-1
ENDIF
_S=$P_SEARCH_S[$P_MSNUM]
_SA=$P_SEARCH_S_TYPE[$P_MSNUM]
_SMODE=$P_MSNUM
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"nicht SM:")
WRITE(_LOG,_LOG_FILE,"  T="<<_T)
WRITE(_LOG,_LOG_FILE,"  D="<<_DD)
WRITE(_LOG,_LOG_FILE,"  DL="<<S_DL)
WRITE(_LOG,_LOG_FILE,"  S="<<_S)
WRITE(_LOG,_LOG_FILE,"  SA="<<_SA)
WRITE(_LOG,_LOG_FILE,"  SMODE="<<_SMODE)
ENDIF
ELSE
_E_SSL_JS_T=1
_T_ST_NEW=1
_T=_E_T_NEW
_DD=_E_D_NEW
_S=_E_S_NEW
_SA=_E_SA_NEW
_SMODE=_F_SMODE
IF(_S<0)
_S=0
_SA=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindel noch nicht starten!")
ENDIF
ENDIF
_TI=GETT(_T,0)
IF(_TI>0)AND(_DD>0)
_WTYP=$TC_DP1[_TI,_DD]
ENDIF
IF(_WTYP>=500)AND(_WTYP<=599)
_S=0
_SA=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindel bei Drehwerkzeug noch nicht starten!")
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"SM:")
WRITE(_LOG,_LOG_FILE,"  T="<<_T)
WRITE(_LOG,_LOG_FILE,"  D="<<_DD)
WRITE(_LOG,_LOG_FILE,"  S="<<_S)
WRITE(_LOG,_LOG_FILE,"  SA="<<_SA)
WRITE(_LOG,_LOG_FILE,"  SMODE="<<_SMODE)
ENDIF
ENDIF
_E_T_NEW=""
_E_D_NEW=0
_E_S_NEW=-1
_E_SA_NEW=0
_F_SMODE=0
IF(_T_ST_NEW==1)
_TFI=-1
ELSE
GETSELT(_TFI)
ENDIF
IF(_TFI>0)
_TF=$TC_TP2[_TFI]
ELSE
IF(_TFI==0)
_TF="0"
ELSE
_TF=""
ENDIF
ENDIF
_TI=GETT(_T,0)
GETEXET(S_TI,,"S")
IF(S_TI==_TI)
T=_T
IF($MC_TOOL_CHANGE_MODE==1)
M=$MC_TOOL_CHANGE_M_CODE
ENDIF
D=_DD
ENDIF
_E_INIT=1
IF($P_MSNUM)
IF($MA_GEAR_STEP_CHANGE_ENABLE[SPI($P_MSNUM)]B_AND'B11')
IF($P_SEARCH_SMODE[$P_MSNUM]==1)OR($P_SEARCH_SMODE[$P_MSNUM]==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N90 M["<<$P_MSNUM<<"]="<<$P_SEARCH_SGEAR[$P_MSNUM])
ENDIF
N90 M[$P_MSNUM]=$P_SEARCH_SGEAR[$P_MSNUM]
ENDIF
ENDIF
ENDIF
IF(_T_ST_NEW)
IF(_SA==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N100 E_TFS("<<_T<<","<<_TF<<","<<_DD<<",0,0,0,0,2,0,"<<_SMODE<<")")
ENDIF
N100 E_TFS(_T,_TF,_DD,0,0,0,0,2,0,_SMODE)
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N105 E_TFS("<<_T<<","<<_TF<<","<<_DD<<",0,0,"<<_S<<","<<_SA<<",2,0,"<<_SMODE<<")")
ENDIF
N105 E_TFS(_T,_TF,_DD,0,0,_S,_SA,2,0,_SMODE)
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N110 E_TFS("<<_T<<","<<_TF<<","<<_DD<<",0,0,0,0,6)")
ENDIF
N110 E_TFS(_T,_TF,_DD,0,0,0,0,6)
IF S_DL>=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"DL="<<S_DL)
ENDIF
DL=S_DL
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE210(1)")
ENDIF
N111 CYCLE210(1)
IF($P_MSNUM<>_MSNUM)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"SETMS("<<_MSNUM<<")")
ENDIF
SETMS(_MSNUM)
ENDIF
IF(_P15<>$P_GG[15])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G"<<_P15+92<<" "<<S_F_STR)
ENDIF
G[15]=_P15
EXECSTRING(S_F_STR)
ENDIF
IF($MN_SEARCH_RUN_MODE B_AND 'B100')
FOR _I=0 TO S_AXES_PER_CHAN-1
_STR="$MC_AXCONF_CHANAX_NAME_TAB["<<_I<<"]"
IF(ISVAR(_STR))
_STR=$MC_AXCONF_CHANAX_NAME_TAB[_I]
IF(_STR<>"")AND($MC_AXCONF_MACHAX_USED[_I])
_AX=AXNAME(_STR)
_S_NR=$MA_SPIND_ASSIGN_TO_MACHAX[_AX]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"AX"<<_I+1<<" "<<AXSTRING(_AX)<<" S"<<_S_NR)
IF _S_NR>0
WRITE(_LOG,_LOG_FILE,"  $P_SEARCH_S="<<$P_SEARCH_S[_S_NR])
WRITE(_LOG,_LOG_FILE,"  $P_SEARCH_SDIR="<<$P_SEARCH_SDIR[_S_NR])
WRITE(_LOG,_LOG_FILE,"  $P_SEARCH_SMODE="<<$P_SEARCH_SMODE[_S_NR])
WRITE(_LOG,_LOG_FILE,"  $P_SEARCH_SPOS="<<$P_SEARCH_SPOS[_S_NR])
WRITE(_LOG,_LOG_FILE,"  $P_SEARCH_SPOSMODE="<<$P_SEARCH_SPOSMODE[_S_NR])
WRITE(_LOG,_LOG_FILE,"  $P_SEARCH_SGEAR="<<$P_SEARCH_SGEAR[_S_NR])
ENDIF
ENDIF
IF(_S_NR<>$P_MSNUM)
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")
IF(_STR==AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[2]))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  -> Werkzeugspindel in Dreh-Trafo")
ENDIF
_S_NR=0
ENDIF
ENDIF
ENDIF
IF(_S_NR>0)AND($P_SEARCH_SMODE[_S_NR]==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  -> Spindel im Positionierbetrieb")
WRITE(_LOG,_LOG_FILE,"     N114 SPOS["<<_S_NR<<"]="<<$P_SEARCH_SPOS[_S_NR])
ENDIF
N114 SPOS[_S_NR]=$P_SEARCH_SPOS[_S_NR]
ENDIF
IF(_S_NR>0)AND($P_SEARCH_SMODE[_S_NR]<>1)AND(($P_GG[15]<>4)OR($P_SEARCH_S[_S_NR]<>0))
IF($P_SEARCH_SMODE[_S_NR]<>0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  -> kein Spindelbetrieb ($P_SEARCH_SMODE="<<$P_SEARCH_SMODE[_S_NR]<<")")
WRITE(_LOG,_LOG_FILE,"     N112 S["<<_S_NR<<"]="<<$P_SEARCH_S[_S_NR])
ENDIF
N112 S[_S_NR]=$P_SEARCH_S[_S_NR]
ENDIF
_S_NR=0
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  S"<<_S_NR<<" WSP="<<_F_S_NR[1]<<" $P_TOOLNO="<<$P_TOOLNO<<" T,SSL="<<_TII)
ENDIF
IF(_S_NR>0)AND((_S_NR<>_F_S_NR[1])OR($P_TOOLNO==_TII))
IF($P_SEARCH_SDIR[_S_NR]<>-19)AND($P_SEARCH_SDIR[_S_NR]<>-5)
IF(_S_NR==$P_MSNUM)AND($P_GG[15]==4)AND($P_SEARCH_S[_S_NR]==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"     N115 M["<<_S_NR<<"]="<<$P_SEARCH_SDIR[_S_NR])
ENDIF
N115 M[_S_NR]=$P_SEARCH_SDIR[_S_NR]
ELSE
IF($P_SEARCH_S_TYPE[_S_NR]==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"     N120 G972 S["<<_S_NR<<"]="<<$P_SEARCH_S[_S_NR]<<" M["<<_S_NR<<"]="<<$P_SEARCH_SDIR[_S_NR])
ENDIF
N120 G972 S[_S_NR]=$P_SEARCH_S[_S_NR] M[_S_NR]=$P_SEARCH_SDIR[_S_NR]
ENDIF
IF($P_SEARCH_S_TYPE[_S_NR]==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"     N121 SVC["<<_S_NR<<"]="<<$P_SEARCH_S[_S_NR]<<" M["<<_S_NR<<"]="<<$P_SEARCH_SDIR[_S_NR])
ENDIF
N121 SVC[_S_NR]=$P_SEARCH_S[_S_NR] M[_S_NR]=$P_SEARCH_SDIR[_S_NR]
ENDIF
IF($P_SEARCH_S_TYPE[_S_NR]==3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"     N122 G962 S["<<_S_NR<<"]="<<$P_SEARCH_S[_S_NR]<<" M["<<_S_NR<<"]="<<$P_SEARCH_SDIR[_S_NR])
ENDIF
N122 G962 S[_S_NR]=$P_SEARCH_S[_S_NR] M[_S_NR]=$P_SEARCH_SDIR[_S_NR]
ENDIF
IF($P_SEARCH_S_TYPE[_S_NR]==4)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"     N123 G962 S["<<_S_NR<<"]="<<$P_SEARCH_S[_S_NR]<<" M["<<_S_NR<<"]="<<$P_SEARCH_SDIR[_S_NR])
ENDIF
N123 G962 S[_S_NR]=$P_SEARCH_S[_S_NR] M[_S_NR]=$P_SEARCH_SDIR[_S_NR]
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  -> nichts ausgeben (M=-19) oder (M=-5)")
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  -> nichts ausgeben")
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
ENDIF
ENDIF
_E_INIT=2
IF($MN_MM_EXTERN_LANGUAGE==1)
IF(_G44)
G291
G44
G290
ENDIF
ENDIF
IF($P_TC)AND(_TC_FR MOD 10)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC freifahren")
ENDIF
CYCLE202(2,_TC_P[8])
CUST_800(46,$P_TC)
ENDIF
IF(_E_JS_PRG)AND($P_TC)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N500 CUST_800(15)")
ENDIF
N500 CUST_800(15)
ENDIF
ENDIF
M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SIM_SPF
PROC E_SIM(INT _TYPE,INT _STAT,REAL _P1,REAL _P2,REAL _P3,REAL _P4,REAL _P5,REAL _P6)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.15.00 ;DATE: 2009-04-29
;ShopMill: Simulation Cycle
DEF STRING[128] _STR
CASE _TYPE OF 0 GOTOF _M_T0 1 GOTOF _M_T1 2 GOTOF _M_T2 3 GOTOF _M_T3 10 GOTOF _M_T10 11 GOTOF _M_T11 DEFAULT GOTOF _M_RET
_M_T0: WRTPR("END()")
GOTOF _M_T
_M_T1: WRTPR("CLEAN()")
GOTOF _M_T
_M_T2: WRTPR("STOP()")
GOTOF _M_T
_M_T3: WRTPR("START()")
GOTOF _M_T
_M_T10:_STR="BLOCK("<<_P1<<","<<_P2<<","<<_P3<<","
IF(_STAT==0)
_STR=_STR<<_P4<<","<<_P5<<","<<_P6<<")"
ELSE
_STR=_STR<<_P4+_P1<<","<<_P5+_P2<<","<<_P6+_P3<<")"
ENDIF
WRTPR(_STR)
GOTOF _M_T
_M_T11:_STR="CYL("<<_P2<<","<<_P3<<","<<_P4<<","
IF(_STAT==0)
_STR=_STR<<_P5<<","
ELSE
IF(_P1==1)
_STR=_STR<<_P5+_P2<<","
ELSE
IF(_P1==2)
_STR=_STR<<_P5+_P3<<","
ELSE
_STR=_STR<<_P5+_P4<<","
ENDIF
ENDIF
ENDIF
_STR=_STR<<_P6<<","<<_P1<<")"
WRTPR(_STR)
GOTOF _M_T
_M_T:
N10 G4 F0
_M_RET:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SL_CIR_SPF
PROC E_SL_CIR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _FZ,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,REAL _U,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _W,REAL _R,REAL _A0,REAL _A1,REAL _A2,INT _N,INT _ST,REAL _FC,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Circumferential Slot
DEF AXIS _XX,_YY,_ZZ
DEF INT _VARI,_DIR,_M3_5,_PMZ,_DMODE,_AMODE[4],_P29
DEF REAL _FAK1,_FAK2,_SD,_WZR,_RP,_SC,_XREF,_YREF,_ZREF,_RTP
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL6
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
_DMODE=1000
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE[1]=2
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
_VARI=0
IF((_BA B_AND 'B111')== 'B001')
_VARI=1
ENDIF
IF((_BA B_AND 'B111')== 'B010')
_VARI=2
ENDIF
IF((_BA B_AND 'B111')== 'B100')
_VARI=3
ENDIF
IF((_BA B_AND 'B111')== 'B101')
_VARI=5
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_AMODE[3]=100
ENDIF
IF NOT(_VARI==5)
IF(_DZ<=0) GOTOF _FEHL1
ENDIF
IF(_VARI==2)AND(_U<=0) GOTOF _FEHL4
_WZR=$P_TOOLR*_FAK1
IF(_VARI==1)
IF(2*_WZR<_W/2-_U) GOTOF _FEHL3
ENDIF
IF(_VARI==2)
IF(2*_WZR<_W/2) GOTOF _FEHL3
ENDIF
IF(_BA B_AND 'B10000000')
_VARI=_VARI+10
ENDIF
IF(_ST==0)
_VARI=_VARI+1000
ELSE
_VARI=_VARI+2000
ENDIF
IF(_BA B_AND 'B10000000000')
_VARI=_VARI+100000
ENDIF
E_SP_ED(_SD)
_M3_5=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF(_E_DIR==0)
IF(_M3_5==2)
_DIR=2
ELSE
_DIR=3
ENDIF
ELSE
IF(_M3_5==2)
_DIR=3
ELSE
_DIR=2
ENDIF
ENDIF
_AMODE[0]=_AMODE[1]+_AMODE[3]
_RTP=_RP-_SD*_PMZ
N38 SLOT2(_RTP,_Z0,_SC,_Z1,0,_N,_A1,_W,_X0,_Y0,_R,_A0,_A2,_FZ,_F,_DZ,_DIR,_U,_VARI,_DZ,,,,0,_FS,_ZFS,200,_DMODE,_AMODE[0])
N39 E_SP_RP(2,_RP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RP)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 SLOT2(_RTP,_Z0,_SC,_Z1,0,_N,_A1,_W,_X0,_Y0,_R,_A0,_A2,_FZ,_F,_DZ,_DIR,_U,_VARI,_DZ,,,,0,_FS,_ZFS,100,_DMODE,_AMODE[0])
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N831101 SETAL(61610)
RET
_FEHL3: STOPRE
N831103 SETAL(61007)
RET
_FEHL4: STOPRE
N831104 SETAL(61253)
RET
_FEHL5: STOPRE
N831105 SETAL(61211)
RET
_FEHL6: STOPRE
N831106 SETAL(61012)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SL_LON_SPF
PROC E_SL_LON(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,REAL _FZ,INT _FZA,REAL _Z0,INT _Z0A,REAL _Z1,INT _Z1A,REAL _DZ,INT _REF,REAL _X0,INT _X0A,REAL _Y0,INT _Y0A,REAL _L,REAL _W,REAL _A0,REAL _UXY,REAL _UZ,REAL _DXY,INT _POS,INT _DXYA,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Longitudinal Slot
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA10,_PMZ,_VARI,_INI=1,_AMODE[4],_DMODE,_GMODE,_P29
DEF REAL _FAK1,_FAK2,_RAD1,_RP,_SC,_SD,_XREF,_YREF,_ZREF,_RTP,_TX,_WO
DEF FRAME _CYC_FR
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
G4 F0
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL6
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0) OR (_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6] _FZ=_E_TR[_IDD,7] _FZA=_E_TR[_IDD,8]
_Z0A=_E_TR[_IDD,10] _Z1A=_E_TR[_IDD,12]
_DZ=_E_TR[_IDD,13] _REF=_E_TR[_IDD,14] _X0A=_E_TR[_IDD,16]
_Y0A=_E_TR[_IDD,18] _L=_E_TR[_IDD,19] _W=_E_TR[_IDD,20]
_A0=_E_TR[_IDD,21] _UXY=_E_TR[_IDD,22] _UZ=_E_TR[_IDD,23]
_DXYA=_E_TR[_IDD,25] _FS=_E_TR[_IDD,26]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF _Z1=_E_TR[_IDD,11]
_DXY=_E_TR[_IDD,24] _ZFS=_E_TR[_IDD,27] _ZFSA=_E_TR[_IDD,28]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
IF(_Z0A==91)
_Z0=_Z0+$P_EP[_ZZ]*_FAK1
ELSE
IF(_Z0A==92)
IF(_ZREF==_SC_NO_VAL) GOTOF _FEHL5
_Z0=_Z0+_ZREF
ENDIF
_E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_X0A==91)
_X0=_X0+$P_EP[_XX]*_FAK1
ELSE
IF(_X0A==92)
IF(_XREF==_SC_NO_VAL) GOTOF _FEHL5
_X0=_X0+_XREF
ENDIF
_E_XREF=_X0*1/_FAK2
ENDIF
IF(_Y0A==91)
_Y0=_Y0+$P_EP[_YY]*_FAK1
ELSE
IF(_Y0A==92)
IF(_YREF==_SC_NO_VAL) GOTOF _FEHL5
_Y0=_Y0+_YREF
ENDIF
_E_YREF=_Y0*1/_FAK2
ENDIF
ENDIF
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FZA==0)
_DMODE=10
ELSE
_DMODE=20
ENDIF
ELSE
IF(_FZA==0)
_DMODE=20
ELSE
_DMODE=10
ENDIF
ENDIF
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE[1]=0
IF(_DXYA<0)OR(_DXYA>1) GOTOF _FEHL7
IF(_DXYA==1)
_DXY=_DXY/100*(2*$P_TOOLR*_FAK1)
ENDIF
_AMODE[2]=0
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
E_SP_ED(_SD)
_BA1=0
IF((_BA B_AND 'B111')==1)OR((_BA B_AND 'B111')==3)
_BA1=1
ENDIF
IF((_BA B_AND 'B111')==2)OR((_BA B_AND 'B111')==3)
_BA1=_BA1+2
ENDIF
IF((_BA B_AND 'B111')==4)
_BA1=4
ENDIF
IF((_BA B_AND 'B111')==5)
_BA1=5
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_DZ=_ZFS _DXY=_FS _UZ=0 _UXY=_FS
_AMODE[3]=100
ENDIF
IF(_BA1==0)OR(_BA1==3) GOTOF _FEHL2
IF(_BA1==1)AND(_DZ<=0) GOTOF _FEHL1
IF(_BA1==2)AND(_UZ<0) GOTOF _FEHL4
IF(_BA1==2)AND(_UXY<0) GOTOF _FEHL4
IF(_FZA<>2)OR((_BA B_AND 'B111')==5)
_BA10=10
ELSE
_BA10=30
ENDIF
_VARI=_BA1+_BA10
IF(_BA B_AND 'B10000000000')
_VARI=_VARI+100000
ENDIF
IF NOT ((_BA B_AND 'B111')==5)
IF(_FZA==2)
_RAD1=_FZ
ENDIF
ENDIF
CASE _REF OF 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 DEFAULT GOTOF _M0
_M1: _TX=(_L-_W)/2
GOTOF _MREF
_M2: _TX=-(_L-_W)/2
GOTOF _MREF
_M3: _TX=_L/2
GOTOF _MREF
_M4: _TX=-_L/2
GOTOF _MREF
_M0: _TX=0
_MREF:
_GMODE=1000
_AMODE[0]=_AMODE[1]+_AMODE[2]+_AMODE[3]
_GMODE=_GMODE+10000
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_ZREF-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
IF(_OB==4)
_CYC_FR=$P_CYCFRAME
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_X0*1/_FAK1,_YY,_Y0*1/_FAK1)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,_WO+_A0)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_TX*1/_FAK1)
N38 POCKET3(_RTP,_Z0,_SC,_Z1,_L,_W,_W/2,0,0,0,_DZ,_UXY,_UZ,_F,_FZ,_E_DIR,_VARI,_DXY,0,0,0,_RAD1,0,,_FS,_ZFS,_GMODE+200,_DMODE,_AMODE[0])
$P_CYCFRAME=INVFRAME(_CYC_FR):$P_CYCFRAME:CTRANS(_XX,_SC_POS[0],_YY,_SC_POS[1],_ZZ,_SC_POS[2])
_SC_POS[0]=$P_CYCFRAME[_XX,TR]
_SC_POS[1]=$P_CYCFRAME[_YY,TR]
_SC_POS[2]=$P_CYCFRAME[_ZZ,TR]
$P_CYCFRAME=_CYC_FR
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(_OB==4) ;Einzelposition
_WO=0
ELSE
_WO=_SC_WO
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_X0*1/_FAK1,_YY,_Y0*1/_FAK1)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,_WO+_A0)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,_TX*1/_FAK1)
N40 G0 AX[_XX]=0 AX[_YY]=0
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
_SC_WO=0
N41 POCKET3(_RTP,_Z0,_SC,_Z1,_L,_W,_W/2,0,0,0,_DZ,_UXY,_UZ,_F,_FZ,_E_DIR,_VARI,_DXY,0,0,0,_RAD1,0,,_FS,_ZFS,_GMODE+100,_DMODE,_AMODE[0])
_SC_WO=_WO
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-_TX*1/_FAK1)
$P_CYCFRAME=$P_CYCFRAME:CRPL(0,-(_WO+_A0))
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-_X0*1/_FAK1,_YY,-_Y0*1/_FAK1)
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(15,_DD,_F,_FAA,_S,_SA,_BA,_FZ,_FZA,_Z0,_Z0A,_Z1,_Z1A,_DZ,_REF,_X0,_X0A,_Y0,_Y0A,_L,_W,_A0,_UXY,_UZ,_DXY,_DXYA,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL3
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N831001 SETAL(61610)
RET
_FEHL2: STOPRE
N831002 SETAL(61002)
RET
_FEHL3: STOPRE
N831003 SETAL(61200)
RET
_FEHL4: STOPRE
N831004 SETAL(61253)
RET
_FEHL5: STOPRE
N831005 SETAL(61211)
RET
_FEHL6: STOPRE
N831006 SETAL(61012)
RET
_FEHL7: STOPRE
N831007 SETAL(61155)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SL_OPN_SPF
PROC E_SL_OPN(INT _OB,INT _BO,INT _IDD,STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _BA,INT _CDIR,REAL _Z0,REAL _Z1,INT _Z1A,REAL _DZ,INT _REF,REAL _X0,REAL _Y0,REAL _L,REAL _W,REAL _A0,REAL _UXY,REAL _UZ,REAL _DXY,INT _DXYA,INT _POS,REAL _FS,REAL _ZFS,INT _ZFSA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Open Slot
DEF AXIS _XX,_YY,_ZZ
DEF INT _BA1,_BA2,_PMZ,_INI=1,_VARI,_AMODE[5],_DMODE,_P29
DEF REAL _FAK1,_FAK2,_RP,_RTP,_SC,_SD,_TX,_XREF,_YREF,_ZREF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_E_TS_OFFN=0
IF($P_ACTFRAME[_XX,SC]<>$P_ACTFRAME[_YY,SC]) GOTOF _FEHL1
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_E_XREF<>_SC_NO_VAL)
_XREF=_E_XREF*_FAK2
ENDIF
IF(_E_YREF<>_SC_NO_VAL)
_YREF=_E_YREF*_FAK2
ENDIF
IF(_E_ZREF<>_SC_NO_VAL)
_ZREF=_E_ZREF*_FAK2
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
IF($P_MC==0)
_E_INIT=1
ENDIF
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
IF(_OB==0) OR (_OB==4)
IF(_OB==0)
IF(NOT _E_MC)
GOTOF _RET
ENDIF
IF(_INI)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD]
_DD=_E_TR[_IDD,1] _F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4]
_SA=_E_TR[_IDD,5] _BA=_E_TR[_IDD,6]
_Z1A=_E_TR[_IDD,10] _DZ=_E_TR[_IDD,11] _REF=_E_TR[_IDD,12]
_L=_E_TR[_IDD,15] _W=_E_TR[_IDD,16]
_A0=_E_TR[_IDD,17] _UXY=_E_TR[_IDD,18] _UZ=_E_TR[_IDD,19]
_DXYA=_E_TR[_IDD,21] _FS=_E_TR[_IDD,22]
_INI=0
ENDIF
_X0=$P_EP[_XX]*_FAK1 _Y0=$P_EP[_YY]*_FAK1 _Z0=_ZREF
_CDIR=_E_TR[_IDD,7] _Z1=_E_TR[_IDD,9] _DXY=_E_TR[_IDD,20]
_ZFS=_E_TR[_IDD,23] _ZFSA=_E_TR[_IDD,24]
_E_BO=_BO+(_E_BO B_AND 65535)
N10 E_TFS(,,,_F,_FAA)
ELSE
_E_BO=0
N20 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
_E_XREF=_X0*1/_FAK2 _E_YREF=_Y0*1/_FAK2 _E_ZREF=_Z0*1/_FAK2
ENDIF
IF(_Z1A<>90)
_Z1=_Z0-ABS(_Z1)
ENDIF
_AMODE[1]=0
IF(_Z1>_Z0)
_PMZ=1
ELSE
_PMZ=-1
ENDIF
E_SP_ED(_SD)
_BA1=(_BA B_AND 'B111') _BA2=0
IF(_BA1<1)OR(_BA1==3)OR(_BA1>7) GOTOF _FEHL2
IF(_BA1==1)OR(_BA1==2)OR(_BA1==4)
_VARI=_BA1
ENDIF
IF(_BA1==6)
_VARI=3
ENDIF
IF(_BA1==7)
_VARI=5
ENDIF
_AMODE[2]=10*_DXYA
_AMODE[4]=1000*(_BA B_AND 'H400')/'H400'
IF(_BA1==5)
_VARI=6
IF(_ZFSA==91)
_Z1=_Z0-ABS(_ZFS)
ELSE
_Z1=_ZFS
_ZFS=ABS(_Z0-_ZFS)
ENDIF
_DZ=_ZFS _DXY=_FS _UZ=0 _UXY=_FS
_AMODE[2]=0
_AMODE[3]=100
ENDIF
IF(_BA B_AND 'B1000')
_BA2=1
ENDIF
IF(_BA B_AND 'B10000')
_BA2=_BA2+2
ENDIF
IF(_BA2<1)OR(_BA2>2) GOTOF _FEHL2
_VARI=_VARI+_BA2*1000
_TX=0
IF(_REF==1)
_TX=_L/2
ENDIF
IF(_REF==2)
_TX=-_L/2
ENDIF
N30 E_TFS("","",_DD,_F,_FAA,_S,_SA)
_AMODE[0]=_AMODE[1]+_AMODE[2]+_AMODE[3]+_AMODE[4]
_DMODE=0
IF(_BA B_AND 'H200')
_DMODE=_DMODE+10000
ENDIF
IF(_E_POS_RP==0)AND(_OB<>4)
_RTP=_ZREF-(_SC+_SD)*_PMZ
ELSE
_RTP=_RP-_SD*_PMZ
ENDIF
IF(_OB==4)
N38 CYCLE899(_RTP,_Z0,_SC,_Z1,_L,_W,_X0,_Y0,_A0,_DZ,_DXY,_UXY,_UZ,_F,_CDIR,_VARI,200+_REF*1000,_DMODE,_AMODE[0],,_FS,_ZFS)
N39 E_SP_RP(2,_RTP,_SC_POS[0]*_FAK1,_SC_POS[1]*_FAK1,_RTP)
ENDIF
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N40 CYCLE899(_RTP,_Z0,_SC,_Z1,_L,_W,_X0,_Y0,_A0,_DZ,_DXY,_UXY,_UZ,_F,_CDIR,_VARI,100+_REF*1000,_DMODE,_AMODE[0],,_FS,_ZFS)
ELSE
N45 G0 AX[_XX]=_X0 AX[_YY]=_Y0 AX[_ZZ]=_Z0
ENDIF
ELSE
IF(_OB==3)
_T=_E_TS1[_IDD] _TF=_E_TS2[_IDD] _DD=_E_TR[_IDD,1]
_F=_E_TR[_IDD,2] _FAA=_E_TR[_IDD,3] _S=_E_TR[_IDD,4] _SA=_E_TR[_IDD,5]
N50 E_TFS(_T,_TF,_DD,_F,_FAA,_S,_SA)
ELSE
IF(_E_IR<_E_MAX)
_E_TS1[_E_IR]=_T _E_TS2[_E_IR]=_TF
_E_TR[_E_IR,0]=SET(16,_DD,_F,_FAA,_S,_SA,_BA,_CDIR,_Z0,_Z1,_Z1A,_DZ,_REF,_X0,_Y0,_L,_W,_A0,_UXY,_UZ,_DXY,_DXYA,_FS,_ZFS,_ZFSA)
_E_IR=_E_IR+1
IF(_POS>=0)
_E_POS=_POS
ENDIF
ELSE
GOTOF _FEHL3
ENDIF
IF(_OB==2)
E_MANAGE
ENDIF
ENDIF
ENDIF
_RET:
G[29]=_P29
_E_S_LINE=0
_RETS:
IF($P_GG[15]<>2)
G94
ENDIF
RET
_FEHL1: STOPRE
N889901 SETAL(61012)
RET
_FEHL2: STOPRE
N889902 SETAL(61002)
RET
_FEHL3: STOPRE
N889903 SETAL(61200)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SP_CHA_SPF
PROC E_SP_CHA(INT _MODE,REAL _FS,REAL _ZFS) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.16.00 ;DATE: 2011-05-30
;ShopMill: Internal Cycle for Champfering
DEF INT _TYP,_VORZ
DEF REAL _TOOLR,_TANGO,_DEEP,_FAK1,_FAK2
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_TYP=$P_AD[1]
_TOOLR=$P_TOOLR*_FAK1
_TANGO=0
_DEEP=0
_VORZ=1
IF(_TYP==200)OR(_TYP==220)
_TANGO=$P_AD[24]/2
REPEAT _FASAN_A _FASAN_E
IF(_TANGO)
_DEEP=_TOOLR/_TANGO
ENDIF
ENDIF
IF(_TYP==140)
IF($P_AD[11])
_TANGO=90-$P_AD[11]
ENDIF
REPEAT _FASAN_A _FASAN_E
IF(_TANGO)
_DEEP=($P_AD[7]-$P_TOOLR*_FAK1)/_TANGO
ENDIF
_TOOLR=0
ENDIF
IF(_TYP==155)OR(_TYP==156)
_TANGO=$P_AD[11]
REPEAT _FASAN_A _FASAN_E
_TOOLR=0
ENDIF
IF(_FS<=0) GOTOF _FEHL1
IF(_ZFS<=0) GOTOF _FEHL3
IF(_TYP==140)
IF($P_AD[7]>0)
IF(_FS>$P_AD[7]-$P_TOOLR*_FAK1) GOTOF _FEHL2
ENDIF
ELSE
IF(_TYP<>155)AND(_TYP<>156)
IF(_FS>$P_TOOLR*_FAK1) GOTOF _FEHL2
ENDIF
ENDIF
IF(_TANGO)
IF(_ZFS*_TANGO<_FS) GOTOF _FEHL3
IF(_DEEP)
IF(_ZFS>_DEEP) GOTOF _FEHL4
ENDIF
ENDIF
IF(NOT _TANGO)
_TANGO=1
ENDIF
IF(NOT _MODE)
_VORZ=-_VORZ
ENDIF
OFFN=$P_OFFN*_FAK2-_VORZ*(_TOOLR-(_ZFS*_TANGO-_FS))
RET
_FASAN_A:
IF(_TANGO>=0)AND(_TANGO<90)
_TANGO=TAN(_TANGO)
ELSE
GOTOF _FEHL5
ENDIF
_FASAN_E:
_FEHL1: STOPRE
N701 SETAL(61270)
RET
_FEHL2: STOPRE
N702 SETAL(61271)
RET
_FEHL3: STOPRE
N703 SETAL(61272)
RET
_FEHL4: STOPRE
N704 SETAL(61273)
RET
_FEHL5: STOPRE
N705 SETAL(61274)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SP_INI_SPF
PROC E_SP_INI(INT _MODE,REAL _SC,REAL _RP) SBLOF DISPLOF PREPRO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.004 ;DATE: 2023-04-20
;ShopMill: Initialization Cycle
DEF AXIS _AX
DEF INT _J,_S_NR,_WS_CINV,_P29,_R29,_KODIR[48]
DEF REAL _FAK1,_FAK2
DEF STRING[200] _STR
DEF INT _LOG,_LOG_ON
DEF STRING[35] _LOG_FILE="/_N_MPF_DIR/_N_LOG_E_SP_INI_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_SP_INI(_MODE="<<_MODE<<",_SC="<<_SC<<",_RP="<<_RP<<")")
ENDIF
IF(_MODE==0)OR(_MODE==1)
_F_AX_EXISTS[1]=FALSE
_F_AX_NR[1]=0
FOR _J=0 TO S_AXES_PER_CHAN-1
IF(_F_AX_EXISTS[1]==FALSE)AND($MCS_AXIS_USAGE[_J]==1)
_F_AX_EXISTS[1]=TRUE
_F_AX_NR[1]=_J+1
ENDIF
ENDFOR
IF(_F_AX_EXISTS[1]==FALSE)
FOR _J=0 TO S_AXES_PER_CHAN-1
_STR="$MC_AXCONF_CHANAX_NAME_TAB["<<_J<<"]"
IF(ISVAR(_STR))
_STR=$MC_AXCONF_CHANAX_NAME_TAB[_J]
IF(_STR<>"")AND($MC_AXCONF_MACHAX_USED[_J])
_AX=AXNAME(_STR)
_S_NR=$MA_SPIND_ASSIGN_TO_MACHAX[_AX]
IF(_S_NR>0)AND(_S_NR==$P_MSNUM)AND(_F_AX_EXISTS[1]==FALSE)
_F_AX_EXISTS[1]=TRUE
_F_AX_NR[1]=_J+1
ENDIF
ENDIF
ENDIF
ENDFOR
ENDIF
IF(_F_AX_EXISTS[1]==FALSE) GOTOF _FEHL1
_KODIR[0 ]=SET( 1,-1,-1 ,1,-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1)
_KODIR[24]=SET(-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1, 1,-1,-1, 1,-1, 1, 1,-1, 1,-1,-1, 1)
_WS_CINV=($MCS_AXIS_USAGE_ATTRIB[_F_AX_NR[1]-1] B_AND'B1000')/'B1000'
_E_C_DIR=_KODIR[$MCS_DISP_COORDINATE_SYSTEM]*(2*_WS_CINV-1)
ENDIF
IF(_MODE==0)OR(_MODE==2)
_E_INIT=1
_E_XREF=_SC_NO_VAL
_E_YREF=_SC_NO_VAL
_E_ZREF=_SC_NO_VAL
_TC_FR=0
IF NOT ($MCS_FUNCTION_MASK_TECH B_AND 'H01')
_TC_NUM=0
ENDIF
ENDIF
IF(_MODE==0)
_P29=$P_GG[29]
_R29=$MC_GCODE_RESET_VALUES[28]
IF(_P29<>_R29)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"G-Gruppe[29]="<<_P29<<" <> Resetval.="<<_R29)
ENDIF
;GOTOF _FEHL2
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_E_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1/_FAK2
_E_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1/_FAK2
_E_S_LINE=0
_E_SEARCH[0]=REP(0)
ENDIF
IF(_MODE==4)
IF(_E_JS_PRG==0)
_E_JS_PRG=1
ENDIF
IF($MCS_TECHNOLOGY==1)
_E_ST_PRG=1
ENDIF
IF($MCS_TECHNOLOGY==2)
_E_SM_PRG=1
ENDIF
ENDIF
SBLON
RET
_FEHL1: STOPRE
N833601 SETAL(61290)
RET
_FEHL2: STOPRE
N833602 SETAL(61294)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SP_RP_SPF
PROC E_SP_RP(INT _MODE,REAL _RP,REAL _XE,REAL _YE,REAL _ZE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.94.00.00.002 ;DATE: 2020-02-02
;ShopMill: Retract Cycle
DEF AXIS _XX,_YY,_ZZ
DEF INT _NUM,_I,_TESTLIM,_STAT,_STATUS[7],_INC,_AXT[3],_MOD10,_RETVAL,_P6,_P29
DEF REAL _P[7,3],_STARTPOS[3],_MOVDIST[3],_DLIMIT[5],_MAXDIST[3],_START[3],_NORMAL[3],_NORM,_LAMBDA,_LAMX,_LAMY,_LAMZ,_FAK1,S_FAK_PLAN
DEF STRING[4] _STR
DEF FRAME _VECT,_FRAME
DEF INT _LOG,_LOG_ON
DEF STRING[35] _LOG_FILE="/_N_MPF_DIR/_N_LOG_E_SP_RP_MPF"
_NUM=-1
_STAT=0
_TESTLIM=3
_INC=$MN_INT_INCR_PER_MM
_DLIMIT[0]=0 _DLIMIT[1]=0 _DLIMIT[2]=0
_MOD10=TRUNC(_MODE/10) MOD 10
_MODE=_MODE MOD 10
_P29=$P_GG[29]
DIAMCYCOF
IF(_MODE==0)
IF(_MOD10==3)
_RP=_E_RP
ENDIF
ENDIF
IF($P_TC)
IF($TC_CARR23[$P_TC]=="P")
_TESTLIM=0
ENDIF
ELSE
IF($P_TRAFO==0)OR($P_TRAFO>=256)
_TESTLIM=0
ELSE
IF(NOT($P_TRAFO B_AND 'H10'))
_TESTLIM=0
ENDIF
ENDIF
ENDIF
IF($P_TRAFO>=256)
_TESTLIM=0
ENDIF
IF($MCS_FUNCTION_MASK_TECH B_AND 'H02');OR($MN_SIM_ENVIRONMENT B_AND 'B100')
_TESTLIM=0
ENDIF
_XX=$P_AXN1
_YY=$P_AXN2
_ZZ=$P_AXN3
_P6=$P_GG[6]
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')AND($MC_DIAMETER_AX_DEF<>"")
S_FAK_PLAN=1/2
ELSE
S_FAK_PLAN=1
ENDIF
IF(_TESTLIM==0)
_FEHL0:
IF(_MODE==0)OR(_MODE==2)
IF(_RP>$P_EP[_ZZ]*_FAK1)
N10 SBLON
N11 G0 G90 G40 AX[_ZZ]=_RP
N12 SBLOF
ENDIF
ENDIF
IF(_MODE==1)OR(_MODE==2)
N20 SBLON
N21 G0 G90 G40 AX[_XX]=_XE AX[_YY]=_YE
N22 SBLOF
ENDIF
IF(_MODE==2)
N30 SBLON
N31 G0 G90 G40 AX[_ZZ]=_ZE
N32 SBLOF
ENDIF
GOTOF _RET
ENDIF
_START[0]=$P_EP[_XX]*_FAK1 _START[1]=$P_EP[_YY]*_FAK1 _START[2]=$P_EP[_ZZ]*_FAK1
IF(_MODE==0)
IF(_MOD10==2)OR(_MOD10==3)
REPEAT _MKS2WKS_A _MKS2WKS_E
ENDIF
ENDIF
_STARTPOS[0]=_START[0] _STARTPOS[1]=_START[1] _STARTPOS[2]=_START[2]
_NORMAL[0]=-(_YE-_START[1]) _NORMAL[1]=_XE-_START[0] _NORMAL[2]=0
_NORM=SQRT(POT(_NORMAL[0])+POT(_NORMAL[1])+POT(_NORMAL[2]))
IF(_NORM)
_NORMAL[0]=_NORMAL[0]/_NORM _NORMAL[1]=_NORMAL[1]/_NORM _NORMAL[2]=_NORMAL[2]/_NORM
ENDIF
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
_STR=" +*#"
_AXT[0]=$MC_AXCONF_GEOAX_ASSIGN_TAB[0]
_AXT[1]=$MC_AXCONF_GEOAX_ASSIGN_TAB[1]
_AXT[2]=$MC_AXCONF_GEOAX_ASSIGN_TAB[2]
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Logfile E_SP_RP:")
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"SM:       "<<_E_JS_PRG)
WRITE(_LOG,_LOG_FILE,"NCK:      "<<$AN_NCK_VERSION)
IF($P_TC)
WRITE(_LOG,_LOG_FILE,"TCARR:    "<<$TC_CARR34[$P_TC])
ENDIF
WRITE(_LOG,_LOG_FILE,"EBENE:    G"<<$P_GG[6]+16)
IF($MN_SCALING_SYSTEM_IS_METRIC)
WRITE(_LOG,_LOG_FILE,"SYSTEM:   METRIC")
ELSE
WRITE(_LOG,_LOG_FILE,"SYSTEM:   INCH")
ENDIF
IF($P_GG[13]==2)OR($P_GG[13]==4)
WRITE(_LOG,_LOG_FILE,"PROGRAMM: METRIC")
ELSE
WRITE(_LOG,_LOG_FILE,"PROGRAMM: INCH")
ENDIF
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"MODE:     "<<_MOD10<<_MODE)
WRITE(_LOG,_LOG_FILE,"RP:       "<<_RP)
WRITE(_LOG,_LOG_FILE,"START MKS:"<<ROUND(_INC*$P_EPM[_XX]*_FAK1)/_INC<<"  "<<ROUND(_INC*$P_EPM[_YY]*_FAK1)/_INC<<"  "<<ROUND(_INC*$P_EPM[_ZZ]*_FAK1)/_INC)
WRITE(_LOG,_LOG_FILE,"START:    "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<ROUND(_INC*_START[2])/_INC)
WRITE(_LOG,_LOG_FILE,"ZIEL:     "<<_XE<<"  "<<_YE<<"  "<<_ZE)
WRITE(_LOG,_LOG_FILE,"NORMALE:  "<<ROUND(_INC*_NORMAL[0])/_INC<<"  "<<ROUND(_INC*_NORMAL[1])/_INC<<"  "<<ROUND(_INC*_NORMAL[2])/_INC)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Aktueller Gesamtframe:")
WRITE(_LOG,_LOG_FILE,"TRANS:    "<<$P_ACTFRAME[_XX,TR]<<"  "<<$P_ACTFRAME[_YY,TR]<<"  "<<$P_ACTFRAME[_ZZ,TR])
WRITE(_LOG,_LOG_FILE,"ROT:      "<<$P_ACTFRAME[_XX,RT]<<"  "<<$P_ACTFRAME[_YY,RT]<<"  "<<$P_ACTFRAME[_ZZ,RT])
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Softwareendschalter:")
WRITE(_LOG,_LOG_FILE,"Achse X:  "<<ROUND(_INC*$MA_POS_LIMIT_MINUS[AXNAME("AX"<<_AXT[0])])/_INC<<"  "<<ROUND(_INC*$MA_POS_LIMIT_PLUS[AXNAME("AX"<<_AXT[0])])/_INC)
WRITE(_LOG,_LOG_FILE,"Achse Y:  "<<ROUND(_INC*$MA_POS_LIMIT_MINUS[AXNAME("AX"<<_AXT[1])])/_INC<<"  "<<ROUND(_INC*$MA_POS_LIMIT_PLUS[AXNAME("AX"<<_AXT[1])])/_INC)
WRITE(_LOG,_LOG_FILE,"Achse Z:  "<<ROUND(_INC*$MA_POS_LIMIT_MINUS[AXNAME("AX"<<_AXT[2])])/_INC<<"  "<<ROUND(_INC*$MA_POS_LIMIT_PLUS[AXNAME("AX"<<_AXT[2])])/_INC)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Arbeitsfeldbegrenzung:")
WRITE(_LOG,_LOG_FILE,"Achse X:  "<<ROUND(_INC*$SA_WORKAREA_LIMIT_MINUS[AXNAME("AX"<<_AXT[0])])/_INC<<"  "<<ROUND(_INC*$SA_WORKAREA_LIMIT_PLUS[AXNAME("AX"<<_AXT[0])])/_INC)
WRITE(_LOG,_LOG_FILE,"Achse Y:  "<<ROUND(_INC*$SA_WORKAREA_LIMIT_MINUS[AXNAME("AX"<<_AXT[1])])/_INC<<"  "<<ROUND(_INC*$SA_WORKAREA_LIMIT_PLUS[AXNAME("AX"<<_AXT[1])])/_INC)
WRITE(_LOG,_LOG_FILE,"Achse Z:  "<<ROUND(_INC*$SA_WORKAREA_LIMIT_MINUS[AXNAME("AX"<<_AXT[2])])/_INC<<"  "<<ROUND(_INC*$SA_WORKAREA_LIMIT_PLUS[AXNAME("AX"<<_AXT[2])])/_INC)
ENDIF
_DLIMIT[0]=10/_INC _DLIMIT[1]=10/_INC _DLIMIT[2]=10/_INC
_MOVDIST[0]=0 _MOVDIST[1]=0 _MOVDIST[2]=0
IF(_MODE>0)
_MOVDIST[0]=_XE-_STARTPOS[0] _MOVDIST[1]=_YE-_STARTPOS[1] _MOVDIST[2]=_ZE-_STARTPOS[2]
ENDIF
G17
_I=0
_CALC:
_STAT=CALCPOSI(_STARTPOS,_MOVDIST,_DLIMIT,_MAXDIST,0,_TESTLIM)
IF(_STAT==-6)
IF($MC_REFP_NC_START_LOCK==0)
GOTOB _FEHL0
ELSE
GOTOF _FEHL7
ENDIF
ENDIF
IF((TRUNC(_STAT/10) MOD 10)==1)
IF(($P_SEARCH)OR(($AC_SERUPRO)AND(($MN_SIM_ENVIRONMENT B_AND 'B100')==0))OR((_STAT MOD 10)==3))
GOTOB _FEHL0
ELSE
_I=_I+1
IF(_I<10)
REPEAT _STARTCORR_A _STARTCORR_E
GOTOB _CALC
ELSE
GOTOB _FEHL0
ENDIF
ENDIF
ENDIF
IF((TRUNC(_STAT/10) MOD 10)==2) GOTOF _FEHL2
IF(ROUND(_INC*ABS(_XE-_START[0]))/_INC)OR(ROUND(_INC*ABS(_YE-_START[1]))/_INC)
_TESTLIM=_TESTLIM+16
ENDIF
IF(_MODE==0)
IF(_MOD10==2)
_MOD10=0
ENDIF
IF(_MOD10==3)
_MOD10=1
ENDIF
ENDIF
IF(_MODE==1)
_RP=_ZE
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"DLIMIT:   "<<_DLIMIT[0])
WRITE(_LOG,_LOG_FILE,"TESTLIM:  "<<_TESTLIM)
ENDIF
IF(_MODE==0)OR(_MODE==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Rueckzug auf RP:")
ENDIF
_MOVDIST[0]=0 _MOVDIST[1]=0 _MOVDIST[2]=_RP-_STARTPOS[2]
_MAXDIST[0]=_XE-_START[0] _MAXDIST[1]=_YE-_START[1] _MAXDIST[2]=0
REPEAT _CALCPOSI_A _CALCPOSI_E
IF(_MAXDIST[2]>0)
REPEAT _SET_POINT_A _SET_POINT_E
ELSE
_RP=_STARTPOS[2]
ENDIF
IF(_MODE==0)
_XE=_START[0] _YE=_START[1]
ENDIF
IF(TRUNC(_STAT/100000) MOD 10)AND(_START[2]<_RP)
REPEAT _NEWDIR_A _NEWDIR_E
REPEAT _CALCPOSI_A _CALCPOSI_E
REPEAT _SET_POINT_A _SET_POINT_E
IF(TRUNC(_STAT/100000) MOD 10)
REPEAT _NEWDIR_A _NEWDIR_E
REPEAT _CALCPOSI_A _CALCPOSI_E
REPEAT _SET_POINT_A _SET_POINT_E
IF(TRUNC(_STAT/100000) MOD 10)
IF(_MOD10)AND(_MODE==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Zielpunkt E:")
ENDIF
GOTOF _ZIELPUNKT_E
ENDIF
ELSE
IF(_LAMBDA<>_LAMZ)
IF(_MOD10) GOTOF _ZIELPUNKT_Z
ENDIF
ENDIF
ELSE
IF(_LAMBDA<>_LAMZ)
IF(_MOD10) GOTOF _ZIELPUNKT_Z
ENDIF
ENDIF
ENDIF
IF(_MOD10==0)AND(_STARTPOS[2]<_RP) GOTOF _FEHL3
ENDIF
IF(_XE==_START[0])AND(_YE==_START[1])
IF(_MODE==0)
GOTOF _LETSGO
ELSE
GOTOF _ZIELPUNKT_Z
ENDIF
ENDIF
IF(_MODE==1)OR(_MODE==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Zielpunkt XY:")
ENDIF
_MOVDIST[0]=_XE-_STARTPOS[0] _MOVDIST[1]=_YE-_STARTPOS[1] _MOVDIST[2]=0
_MAXDIST[0]=0 _MAXDIST[1]=0 _MAXDIST[2]=-1
REPEAT _CALCPOSI_A _CALCPOSI_E
REPEAT _SET_POINT_A _SET_POINT_E
_ZIELPUNKT_E:
IF(TRUNC(_STAT/100000) MOD 10)
REPEAT _NEWDIR_A _NEWDIR_E
REPEAT _CALCPOSI_A _CALCPOSI_E
REPEAT _SET_POINT_A _SET_POINT_E
IF(TRUNC(_STAT/100000) MOD 10)
REPEAT _NEWDIR_A _NEWDIR_E
REPEAT _CALCPOSI_A _CALCPOSI_E
REPEAT _SET_POINT_A _SET_POINT_E
ENDIF
ENDIF
ENDIF
_ZIELPUNKT_Z:
IF(_MODE==1)OR(_MODE==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Zielpunkt Z:")
ENDIF
IF(_TESTLIM>16)
_TESTLIM=_TESTLIM-16
ENDIF
_MOVDIST[0]=_XE-_STARTPOS[0] _MOVDIST[1]=_YE-_STARTPOS[1] _MOVDIST[2]=_ZE-_STARTPOS[2]
REPEAT _CALCPOSI_A _CALCPOSI_E
REPEAT _SET_POINT_A _SET_POINT_E
ENDIF
_LETSGO:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
IF(_MODE==0)
WRITE(_LOG,_LOG_FILE,"Sollpositionen: 1")
WRITE(_LOG,_LOG_FILE,"0   WKS:  "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<ROUND(_INC*_START[2])/_INC)
WRITE(_LOG,_LOG_FILE,"1   WKS:  "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<_RP)
ENDIF
IF(_MODE==1)
WRITE(_LOG,_LOG_FILE,"Sollpositionen: 2")
WRITE(_LOG,_LOG_FILE,"0   WKS:  "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<ROUND(_INC*_START[2])/_INC)
WRITE(_LOG,_LOG_FILE,"1   WKS:  "<<_XE<<"  "<<_YE<<"  "<<ROUND(_INC*_START[2])/_INC)
WRITE(_LOG,_LOG_FILE,"2   WKS:  "<<_XE<<"  "<<_YE<<"  "<<_ZE)
ENDIF
IF(_MODE==2)
WRITE(_LOG,_LOG_FILE,"Sollpositionen: 3")
WRITE(_LOG,_LOG_FILE,"0   WKS:  "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<ROUND(_INC*_START[2])/_INC)
WRITE(_LOG,_LOG_FILE,"1   WKS:  "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<_RP)
WRITE(_LOG,_LOG_FILE,"2   WKS:  "<<_XE<<"  "<<_YE<<"  "<<_RP)
WRITE(_LOG,_LOG_FILE,"3   WKS:  "<<_XE<<"  "<<_YE<<"  "<<_ZE)
ENDIF
ENDIF
IF(_NUM>=0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Istpositionen: "<<_NUM+1)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"0   WKS:  "<<ROUND(_INC*_START[0])/_INC<<"  "<<ROUND(_INC*_START[1])/_INC<<"  "<<ROUND(_INC*_START[2])/_INC)
FOR _I=0 TO _NUM
WRITE(_LOG,_LOG_FILE,_I+1<<_STR[_STATUS[_I]]<<"  WKS:  "<<ROUND(_INC*_P[_I,0])/_INC<<"  "<<ROUND(_INC*_P[_I,1])/_INC<<"  "<<ROUND(_INC*_P[_I,2])/_INC)
ENDFOR
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"0   MKS:  "<<ROUND(_INC*$P_EPM[_XX])/_INC<<"  "<<ROUND(_INC*$P_EPM[_YY])/_INC<<"  "<<ROUND(_INC*$P_EPM[_ZZ])/_INC)
ENDIF
IF(_NUM>0)AND(_STAT)AND(_STATUS[_NUM])
IF(_MOD10==1)
_NUM=_NUM-1
ELSE
GOTOF _FEHL8
ENDIF
ENDIF
IF(_NUM>4) GOTOF _FEHL5
FOR _I=0 TO _NUM
N40 SBLON
N41 G0 G90 G40 AX[_XX]=_P[_I,0] AX[_YY]=_P[_I,1] AX[_ZZ]=_P[_I,2]
N42 SBLOF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,_I+1<<_STR[_STATUS[_I]]<<"  MKS:  "<<ROUND(_INC*$P_EPM[_XX])/_INC<<"  "<<ROUND(_INC*$P_EPM[_YY])/_INC<<"  "<<ROUND(_INC*$P_EPM[_ZZ])/_INC)
ENDIF
ENDFOR
ENDIF
IF(_LOG_ON)
_LOG_END_A:
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Markierungen:")
WRITE(_LOG,_LOG_FILE,_STR[0]<<" = Position ohne Grenzverletzung erreicht")
WRITE(_LOG,_LOG_FILE,_STR[2]<<" = Position wegen Grenzverletzung nicht erreicht")
WRITE(_LOG,_LOG_FILE,_STR[1]<<" = Position per Abkuerzung erreicht")
WRITE(_LOG,_LOG_FILE,_STR[3]<<" = Position mit zwei Grenzverletzungen")
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Ende Logfile")
WRITE(_LOG,_LOG_FILE,"--------------------")
_LOG_END_E:
ENDIF
_RET:
G[6]=_P6
G[29]=_P29
IF($MN_SIM_ENVIRONMENT B_AND 'B100')
G4F0
ENDIF
RET
_CALCPOSI_A:
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"CALCPOSI: Input "<<_NUM+2)
WRITE(_LOG,_LOG_FILE,"STARTPOS: "<<ROUND(_INC*_STARTPOS[0])/_INC<<"  "<<ROUND(_INC*_STARTPOS[1])/_INC<<"  "<<ROUND(_INC*_STARTPOS[2])/_INC)
WRITE(_LOG,_LOG_FILE,"MOVDIST:  "<<ROUND(_INC*_MOVDIST[0])/_INC<<"  "<<ROUND(_INC*_MOVDIST[1])/_INC<<"  "<<ROUND(_INC*_MOVDIST[2])/_INC)
WRITE(_LOG,_LOG_FILE,"MAXDIST:  "<<ROUND(_INC*_MAXDIST[0])/_INC<<"  "<<ROUND(_INC*_MAXDIST[1])/_INC<<"  "<<ROUND(_INC*_MAXDIST[2])/_INC)
ENDIF
_STAT=CALCPOSI(_STARTPOS,_MOVDIST,_DLIMIT,_MAXDIST,0,_TESTLIM)
_DLIMIT[0]=_DLIMIT[0]-2/_INC _DLIMIT[1]=_DLIMIT[1]-2/_INC _DLIMIT[2]=_DLIMIT[2]-2/_INC
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CALCPOSI: Output "<<_NUM+2)
WRITE(_LOG,_LOG_FILE,"STATUS:   "<<_STAT)
WRITE(_LOG,_LOG_FILE,"MOVDIST:  "<<ROUND(_INC*_MOVDIST[0])/_INC<<"  "<<ROUND(_INC*_MOVDIST[1])/_INC<<"  "<<ROUND(_INC*_MOVDIST[2])/_INC)
WRITE(_LOG,_LOG_FILE,"MAXDIST:  "<<ROUND(_INC*_MAXDIST[0])/_INC<<"  "<<ROUND(_INC*_MAXDIST[1])/_INC<<"  "<<ROUND(_INC*_MAXDIST[2])/_INC)
ENDIF
IF(_STAT==-6) GOTOF _FEHL7
IF(_STAT<0) GOTOF _FEHL8
_CALCPOSI_E:
_SET_POINT_A:
IF(_MAXDIST[0]<>0)OR(_MAXDIST[1]<>0)OR(_MAXDIST[2]<>0)
_STARTPOS[0]=_STARTPOS[0]+_MAXDIST[0]
_STARTPOS[1]=_STARTPOS[1]+_MAXDIST[1]
_STARTPOS[2]=_STARTPOS[2]+_MAXDIST[2]
_NUM=_NUM+1
_P[_NUM,0]=_STARTPOS[0] _P[_NUM,1]=_STARTPOS[1] _P[_NUM,2]=_STARTPOS[2]
IF(_STAT==0)
_STATUS[_NUM]=0
IF(_NUM>0)
IF(_STATUS[_NUM-1]>1)
_STATUS[_NUM]=1
ENDIF
ENDIF
ELSE
_STATUS[_NUM]=2
IF(_NUM>0)
IF(_STATUS[_NUM-1]>1)
_STATUS[_NUM]=3
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,_NUM+1<<_STR[_STATUS[_NUM]]<<"  WKS:  "<<ROUND(_INC*_P[_NUM,0])/_INC<<"  "<<ROUND(_INC*_P[_NUM,1])/_INC<<"  "<<ROUND(_INC*_P[_NUM,2])/_INC)
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,_NUM+2<<"   WKS:   Verfahrweg = 0")
ENDIF
ENDIF
_SET_POINT_E:
_NEWDIR_A:
_LAMBDA=0 _LAMX=0 _LAMY=0 _LAMZ=0
IF(_MOVDIST[0]<>0)
_LAMX=(_XE-_STARTPOS[0])/_MOVDIST[0]
ENDIF
IF(_MOVDIST[1]<>0)
_LAMY=(_YE-_STARTPOS[1])/_MOVDIST[1]
ENDIF
IF(_MOVDIST[2]<>0)
_LAMZ=(_RP-_STARTPOS[2])/_MOVDIST[2]
IF(_MOD10)
_LAMBDA=_LAMZ
ENDIF
ENDIF
IF(_LAMZ>0)AND((_LAMZ<_LAMX)OR(_LAMX<=0))AND((_LAMZ<_LAMY)OR(_LAMY<=0))
_LAMBDA=_LAMZ
ELSE
IF(_LAMX>0)AND((_LAMX<=_LAMZ)OR(_LAMZ<=0))AND((_LAMX<=_LAMY)OR(_LAMY<=0))
_LAMBDA=_LAMX
ELSE
IF(_LAMY>0)AND((_LAMY<=_LAMZ)OR(_LAMZ<=0))AND((_LAMY<=_LAMX)OR(_LAMX<=0))
_LAMBDA=_LAMY
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"LAMBDA:   "<<ROUND(_INC*_LAMX)/_INC<<"  "<<ROUND(_INC*_LAMY)/_INC<<"  "<<ROUND(_INC*_LAMZ)/_INC<<" => "<<ROUND(_INC*_LAMBDA)/_INC)
ENDIF
;IF(_LAMBDA>=0)
_MOVDIST[0]=_LAMBDA*_MOVDIST[0]
_MOVDIST[1]=_LAMBDA*_MOVDIST[1]
_MOVDIST[2]=_LAMBDA*_MOVDIST[2]
_MAXDIST[0]=_NORMAL[1]*_MOVDIST[2]-_NORMAL[2]*_MOVDIST[1]
_MAXDIST[1]=_NORMAL[2]*_MOVDIST[0]-_NORMAL[0]*_MOVDIST[2]
_MAXDIST[2]=_NORMAL[0]*_MOVDIST[1]-_NORMAL[1]*_MOVDIST[0]
;ENDIF
_NEWDIR_E:
_MKS2WKS_A:
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=2
$AA_MEAS_POINT1[_XX]=_START[0]/_FAK1
$AA_MEAS_POINT1[_YY]=_START[1]/_FAK1
$AA_MEAS_POINT1[_ZZ]=_START[2]/_FAK1
_RETVAL=MEASURE()
IF(_RETVAL<>0) GOTOF _FEHL6
_XE=$AA_MEAS_POINT2[_XX]*_FAK1*S_FAK_PLAN
_YE=$AA_MEAS_POINT2[_YY]*_FAK1
_ZE=$AA_MEAS_POINT2[_ZZ]*_FAK1
_ZE=_ZE+10
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=24
$AC_MEAS_P1_COORD=2
$AC_MEAS_P2_COORD=0
$AA_MEAS_POINT1[_XX]=_XE/_FAK1
$AA_MEAS_POINT1[_YY]=_YE/_FAK1
$AA_MEAS_POINT1[_ZZ]=_ZE/_FAK1
_RETVAL=MEASURE()
IF(_RETVAL<>0) GOTOF _FEHL6
_XE=$AA_MEAS_POINT2[_XX]*_FAK1*S_FAK_PLAN
_YE=$AA_MEAS_POINT2[_YY]*_FAK1
_ZE=$AA_MEAS_POINT2[_ZZ]*_FAK1
_MKS2WKS_E:
_STARTCORR_A:
_VECT=CTRANS()
IF((TRUNC(_STAT/1000) MOD 10)==1)
IF((TRUNC(_STAT/100) MOD 10)==1)
_VECT[_XX,TR]=-_DLIMIT[0]*5
ENDIF
IF((TRUNC(_STAT/100) MOD 10)==2)
_VECT[_XX,TR]=_DLIMIT[0]*5
ENDIF
ENDIF
IF((TRUNC(_STAT/1000) MOD 10)==2)
IF((TRUNC(_STAT/100) MOD 10)==1)
_VECT[_YY,TR]=-_DLIMIT[1]*5
ENDIF
IF((TRUNC(_STAT/100) MOD 10)==2)
_VECT[_YY,TR]=_DLIMIT[1]*5
ENDIF
ENDIF
IF((TRUNC(_STAT/1000) MOD 10)==3)
IF((TRUNC(_STAT/100) MOD 10)==1)
_VECT[_ZZ,TR]=-_DLIMIT[2]*5
ENDIF
IF((TRUNC(_STAT/100) MOD 10)==2)
_VECT[_ZZ,TR]=_DLIMIT[2]*5
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"STATUS:   "<<_STAT)
WRITE(_LOG,_LOG_FILE,"STARTOLD: "<<_STARTPOS[0]<<"  "<<_STARTPOS[1]<<"  "<<_STARTPOS[2])
WRITE(_LOG,_LOG_FILE,"CORR MKS: "<<_VECT[_XX,TR]<<"  "<<_VECT[_YY,TR]<<"  "<<_VECT[_ZZ,TR])
ENDIF
_FRAME=$P_ACTFRAME
_FRAME[_XX,TR]=0
_FRAME[_YY,TR]=0
_FRAME[_ZZ,TR]=0
_VECT=INVFRAME(_FRAME):_VECT
_STARTPOS[0]=_STARTPOS[0]+_VECT[_XX,TR]
_STARTPOS[1]=_STARTPOS[1]+_VECT[_YY,TR]
_STARTPOS[2]=_STARTPOS[2]+_VECT[_ZZ,TR]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CORR WKS: "<<_VECT[_XX,TR]<<"  "<<_VECT[_YY,TR]<<"  "<<_VECT[_ZZ,TR])
WRITE(_LOG,_LOG_FILE,"STARTNEW: "<<_STARTPOS[0]<<"  "<<_STARTPOS[1]<<"  "<<_STARTPOS[2])
ENDIF
_STARTCORR_E:
_FEHL1:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 1: Startpunkt verletzt Grenze! STATUS="<<_STAT)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833801 SETAL(61099,"1")
RET
_FEHL2:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 2: Zielpunkt verletzt Grenze! STATUS="<<_STAT)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833802 SETAL(61275)
RET
_FEHL3:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 3: Rückzugsebene nicht erreicht! NUM="<<_NUM+1)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833803 SETAL(61228)
RET
_FEHL4:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 4: Keine Loesung gefunden! NUM="<<_NUM+1)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833804 SETAL(61099,"2")
RET
_FEHL5:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 5: Mehr als 5 Punkte! NUM="<<_NUM+1)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833805 SETAL(61099,"3")
RET
_FEHL6:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 6: MEASURE(MKS->WKS)! NUM="<<_NUM+1)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833806 SETAL(61403)
RET
_FEHL7:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 7: Achse nicht referenziert! NUM="<<_NUM+1)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833807 SETAL(61069)
RET
_FEHL8:STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"--------------------")
WRITE(_LOG,_LOG_FILE,"Fehler 8: Zielposition nicht erreichbar! NUM="<<_NUM+1)
REPEAT _LOG_END_A _LOG_END_E
ENDIF
N833808 SETAL(61227,$MC_AXCONF_GEOAX_NAME_TAB[0]<<"="<<ROUND(_INC*_XE)/_INC<<" "<<$MC_AXCONF_GEOAX_NAME_TAB[1]<<"="<<ROUND(_INC*_YE)/_INC<<" "<<$MC_AXCONF_GEOAX_NAME_TAB[2]<<"="<<ROUND(_INC*_ZE)/_INC)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SP_BC_SPF
PROC E_SP_BC(STRING[32] S_TRA,REAL _BETA,REAL _GAMA,INT _MODE,REAL _FR_I,REAL S_POLA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Swivelling Cycle
DEF INT _P29,_I,S_TRA_NO,S_AX_M_I
DEF STRING[30] S_STRAL
DEF STRING[12] S_AX_M
DEF INT _LOG,_LOG_ON,S_LOGSIZE
DEF STRING[35] _LOG_FILE
_LOG_FILE="/_N_MPF_DIR/_N_LOG_E_SP_BC_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,S_LOGSIZE)
IF(S_LOGSIZE>20000)
_LOG_ON=0
ENDIF
ENDIF
; DELETE(_LOG,_LOG_FILE)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_SP_BC("<<S_TRA<<","<<_BETA<<","<<_GAMA<<","<<_MODE<<","<<_FR_I<<","<<S_POLA<<")")
ENDIF
IF(S_TRA=="0")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Fräsen")
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE809(0)")
ENDIF
N10 CYCLE809()
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ebene G"<<16+_E_PLANE)
ENDIF
N20 G[6]=_E_PLANE
ELSE
_P29=$P_GG[29]
IF($P_TC)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE800()")
ENDIF
N100 CYCLE800()
ENDIF
IF(S_TRA=="")
S_TRA=_E_TURN_TRAFO
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehtrafo="<<S_TRA)
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Manuell: "<<S_TRA)
ENDIF
IF(S_TRA=="")
S_STRAL="TRAORI_STAT"
GOTOF _FEHL2
ENDIF
S_TRA_NO=NAMETOINT("$NT_NAME",S_TRA,TRUE)
S_STRAL=S_TRA
IF(S_TRA_NO<0)
GOTOF _FEHL2
ENDIF
_I=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[S_TRA_NO,0],TRUE)
IF(_I<0) GOTOF _FEHL3
S_AX_M=$NK_AXIS[_I]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Drehtisch: "<<S_AX_M)
ENDIF
_I=0
S_AX_M_I=0
WHILE(_I<31)AND(S_AX_M_I==0)
IF($MN_AXCONF_MACHAX_NAME_TAB[_I]==S_AX_M)
S_AX_M_I=_I+1
ENDIF
_I=_I+1
ENDWHILE
IF(S_AX_M_I==0) GOTOF _FEHL3
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  M-AX="<<S_AX_M_I)
ENDIF
_I=0
_F_AX_NR[0]=0
WHILE(_I<20)AND(_F_AX_NR[0]==0)
IF($MC_AXCONF_MACHAX_USED[_I]==(S_AX_M_I))
_F_AX_NR[0]=_I+1
_F_AX_EXISTS[0]=TRUE
_F_S_AX[0]=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_F_AX_NR[0]-1])
_F_S_AX[5]=_F_S_AX[0]
_F_S_STR[0]=AXSTRING(_F_S_AX[0])
_F_S_STR[5]=AXSTRING(_F_S_AX[5])
_F_S_NR[0]=$MA_SPIND_ASSIGN_TO_MACHAX[_F_S_AX[0]]
_E_TURN=1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  CH-AX="<<_F_AX_NR[0]<<" "<<_F_S_STR[0]<<" S"<<_F_S_NR[0])
ENDIF
ENDIF
_I=_I+1
ENDWHILE
IF(_F_AX_NR[0]==0) GOTOF _FEHL3
ENDIF
IF(_E_TURN==0) GOTOF _FEHL1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CYCLE809("<<S_TRA<<","<<_BETA<<","<<_GAMA<<","<<_MODE<<","<<_FR_I<<","<<S_POLA<<",2)")
ENDIF
N110 CYCLE809(S_TRA,_BETA,_GAMA,_MODE,_FR_I,S_POLA,2)
N200 G[29]=_P29
ENDIF
RET
_FEHL1: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61859 Drehbearbeitung nicht freigegeben")
ENDIF
N880051 SETAL(61859)
RET
_FEHL2: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61167 Transformation nicht eingerichtet: TRAORI_STAT")
ENDIF
N880052 SETAL(61167,"TRAORI_STAT")
RET
_FEHL3: STOPRE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Alarm 61165 Transformation falsch eingerichtet: "<<S_TRA)
ENDIF
N880053 SETAL(61165,S_TRA)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SP_ED_SPF
PROC E_SP_ED(VAR REAL S_ED) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.01.00 ;DATE: 2013-12-09
;ShopMill: Edge Difference
DEF INT S_LI
DEF REAL _FAK1,_SD=0,_SD1,_SD2
DEF INT _LOG,_LOG_ON,S_LOGSIZE
DEF STRING[35] _LOG_FILE
_LOG_FILE="/_N_MPF_DIR/_N_LOG_E_SP_ED_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,S_LOGSIZE)
IF(S_LOGSIZE>20000)
_LOG_ON=0
ENDIF
ENDIF
IF(_LOG_ON)
;DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
ENDIF
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
IF(($P_TOOL>1)AND($P_TOOLNO))
S_LI=ABS($P_ACT_TOOL_LENGTH_INDEX[3-$P_GG[6]])
_SD2=$P_ATDT[2+S_LI,$P_TOOL]+$P_ATDT[11+S_LI,$P_TOOL]+$P_ATDT[20+S_LI,$P_TOOL]
_SD1=$P_ATDT[2+S_LI,1]+$P_ATDT[11+S_LI,1]+$P_ATDT[20+S_LI,1]
IF(_SD2<_SD1)
_SD=(_SD1-_SD2)*_FAK1
ELSE
_SD=0
ENDIF
ELSE
_SD=0
ENDIF
_RET:
S_ED=_SD
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schneidendifferenz="<<S_ED)
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_SWIV_H_SPF
PROC E_SWIV_H(INT _TCI,REAL _A1,REAL _A2) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.02.00.085 ;DATE: 2017-11-17
;ShopMill: Swivelling Cycle
DEF INT _I,_II,_III,_H,_FOUND
DEF INT _AX1_MODE,_AX2_MODE,_TCBA=0
DEF STRING[30] _SERR
IF(_TCI>0)AND((_A1<>_SC_A_NO_VAL)OR(_A2<>_SC_A_NO_VAL))
_AX1_MODE=TRUNC($TC_CARR37[_TCI]/10) MOD 10
_AX2_MODE=TRUNC($TC_CARR37[_TCI]/100) MOD 10
IF(_AX1_MODE==0)AND(_AX2_MODE==0)
_TCBA=20
ELSE
IF(_AX1_MODE>0)AND(_AX2_MODE>0)
_TCBA=31
ELSE
IF(_AX1_MODE>0)AND(_AX2_MODE==0)
_TCBA=21
ENDIF
IF(_AX1_MODE==0)AND(_AX2_MODE>0)
_TCBA=30
ENDIF
ENDIF
ENDIF
CYCLE213(_TCI)
IF($TC_CARR36[_TCI]=="")OR(_A2==_SC_A_NO_VAL)
_TCBA=_TCBA+2
IF (_TCBA==32)OR(_TCBA==33)
_TCBA=_TCBA-10
ENDIF
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)AND(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))
IF(_TCBA==31)AND(_AX1_MODE==1)AND(_AX2_MODE==1)
_SERR=<<$TC_CARR35[_TCI]<<": "<<_A1<<"  "<<$TC_CARR36[_TCI]<<": "<<_A2
N880021 SETAL(62180,_SERR)
WRTPR("MANAX("<<$TC_CARR35[_TCI]<<","<<_A1<<")",1)
WRTPR("MANAX("<<$TC_CARR36[_TCI]<<","<<_A2<<")",1)
ENDIF
IF((_TCBA==21)OR(_TCBA==23))AND(_AX1_MODE==1)
_SERR=<<$TC_CARR35[_TCI]<<": "<<_A1
N880022 SETAL(62181,_SERR)
WRTPR("MANAX("<<$TC_CARR35[_TCI]<<","<<_A1<<")",1)
ENDIF
IF(_TCBA==30)AND(_AX2_MODE==1)
_SERR=<<$TC_CARR36[_TCI]<<": "<<_A2
N880023 SETAL(62181,_SERR)
WRTPR("MANAX("<<$TC_CARR36[_TCI]<<","<<_A2<<")",1)
ENDIF
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)
IF((_A1<$TC_CARR30[_TCI])OR(_A1>$TC_CARR32[_TCI]))OR((_A2<>_SC_A_NO_VAL)AND((_A2<$TC_CARR31[_TCI])OR(_A2>$TC_CARR33[_TCI])))
N880024 SETAL(61189)
ELSE
STOPRE
$TC_CARR13[_TCI]=_A1
IF(_A2<>_SC_A_NO_VAL)
$TC_CARR14[_TCI]=_A2
ENDIF
ENDIF
ENDIF
N100 CUST_800(_TCBA,_TCI,_A1,_A2)
_TC_A1=_A1
;_TC_A2=_A2
ENDIF
G4 F0
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_TCARR_SPF
PROC E_TCARR(STRING[32] _TC,STRING[32] _T,STRING[32] _TF,INT _DD,INT _ST,REAL _X0,REAL _Y0,REAL _Z0,REAL _A,REAL _B,REAL _C,INT _MODE,REAL _X1,REAL _Y1,REAL _Z1,INT _DIR,INT __FRE,INT _HEB,REAL _FR_I) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Swivelling Cycle
DEF INT _ST0,_ST1,_ST7,_ST8,_ST9,_ST10,_STATUS,_FR,_I,_FRE
DEF INT _TC_NUM_AKTIV,_TCI,_TCPR,_TC37_A,_TC37_N,_TI,S_INIT
DEF STRING[30] _SERR
DEF FRAME _FRAME
DEF INT _LOG,_LOG_ON
DEF STRING[35] _LOG_FILE="/_N_MPF_DIR/_N_LOG_E_TCARR_MPF"
_FRE=__FRE
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_TCARR(_TC="<<_TC<<",_T="<<_T<<",_TF="<<_TF<<",_DD="<<_DD<<",_ST="<<_ST<<",_X0="<<_X0<<",_Y0="<<_Y0<<",_Z0="<<_Z0<<",_A="<<_A<<",_B="<<_B<<",_C="<<_C<<",_MODE="<<_MODE<<",_X1="<<_X1<<",_Y1="<<_Y1<<",_Z1="<<_Z1<<",_DIR="<<_DIR<<",_FRE="<<_FRE<<",_HEB="<<_HEB<<",_FR_I="<<_FR_I<<")")
ENDIF
E_SP_BC("0")
_TC_N_WZ=(_ST B_AND 'B00000010')/2
IF(_TC=="0")
IF($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B100')
_TCI=0
ELSE
GOTOF _FEHL2
ENDIF
ELSE
_TC_NUM_AKTIV=0
FOR _I=1 TO $P_TCNUM
_TC37_A=TRUNC($TC_CARR37[_I]/100000000) MOD 10
IF(_TC37_A B_AND 'B100')
_TC_NUM_AKTIV=_TC_NUM_AKTIV+1
_TCI=_I
ENDIF
IF(_LOG_ON)
IF(_TC37_A B_AND 'B100')
WRITE(_LOG,_LOG_FILE,"  TC"<<_I<<" (Name:"<<$TC_CARR34[_I]<<"): aktiv")
ELSE
WRITE(_LOG,_LOG_FILE,"  TC"<<_I<<" (Name:"<<$TC_CARR34[_I]<<"): deaktiv")
ENDIF
ENDIF
ENDFOR
IF(_TC=="")
IF($P_TC>0)
_TCI=$P_TC
ELSE
IF(_TC_NUM_AKTIV==1)
ELSE
GOTOF _FEHL3
ENDIF
ENDIF
ELSE
IF(_TC_NUM_AKTIV==1)
ELSE
_TCI=$P_TCNUM
_I=TRUNC($TC_CARR37[_TCI]/100000000) MOD 10
WHILE((_TCI>0)AND(($TC_CARR34[_TCI]<>_TC)OR((_I B_AND 'B100')==0)))
_TCI=_TCI-1
_I=TRUNC($TC_CARR37[_TCI]/100000000) MOD 10
ENDWHILE
IF(_TCI<1) GOTOF _FEHL1
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCI="<<_TCI)
ENDIF
IF(_TCI)
_TC=$TC_CARR34[_TCI]
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
IF(_TC=="0")
_FRE=1
ENDIF
ENDIF
_ST7=(_ST B_AND 'B10000000')
IF(_ST7)
_TCI=$P_TC
_TCPR=_TC_NUM
ELSE
_TCPR=$P_TC
IF(_FRE==1)
_FR=0
ELSE
IF(_FRE==0)
_FR=1
ELSE
_FR=_FRE
ENDIF
ENDIF
_TC_FR=_TC_FR-(_TC_FR MOD 10)+_FR
_TC_FR_I=_FR_I
ENDIF
IF(_TCI<>_TCPR)
IF(_TCPR>0)
_TC37_A=TRUNC($TC_CARR37[_TCPR]/100000000) MOD 10
ENDIF
IF(_TCI>0)
_TC37_N=TRUNC($TC_CARR37[_TCI]/100000000) MOD 10
ENDIF
CYCLE202(2,_TC_P[8])
IF(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))
IF(_TCPR==0)
IF(_TCI==0)
ELSE
IF(_TC37_N B_AND 'B010')
_SERR=<<$TC_CARR34[_TCI]
SETAL(62182,_SERR)
N20 CUST_800(5,_TCI)
ELSE
N30 CUST_800(4,_TCI)
ENDIF
ENDIF
ELSE
IF(_TC37_A B_AND 'B010')
IF(_TCI==0)
_SERR=<<$TC_CARR34[_TCPR]
SETAL(62183,_SERR)
N40 CUST_800(7,_TCPR)
ELSE
IF(_TC37_N B_AND 'B010')
_SERR=<<$TC_CARR34[_TCPR]<<"->"<<$TC_CARR34[_TCI]
SETAL(62184,_SERR)
N50 CUST_800(9,_TCPR,,,_TCI)
ELSE
_SERR=<<$TC_CARR34[_TCPR]
SETAL(62183,_SERR)
N60 CUST_800(7,_TCPR)
N70 CUST_800(4,_TCI)
ENDIF
ENDIF
ELSE
IF(_TCI==0)
N80 CUST_800(6,_TCPR)
ELSE
IF(_TC37_N B_AND 'B010')
N90 CUST_800(6,_TCPR)
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)
CYCLE800()
_TC_NUM=0
IF($MC_TOOL_CARRIER_RESET_VALUE<>0)
STOPRE
$MC_TOOL_CARRIER_RESET_VALUE=0
ENDIF
D=$P_TOOL
ENDIF
_SERR=<<$TC_CARR34[_TCI]
SETAL(62182,_SERR)
N100 CUST_800(5,_TCI)
ELSE
N110 CUST_800(8,_TCPR,,,_TCI)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)AND(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))
IF($MC_TOOL_CARRIER_RESET_VALUE<>_TCI)
STOPRE
$MC_TOOL_CARRIER_RESET_VALUE=_TCI
ENDIF
_TC_NUM=_TCI
ENDIF
ENDIF
IF(_TCI>0)AND(NOT _ST7)
IF _T<>""
_TI=$P_TOOLNO
S_INIT=_E_INIT
N300 E_TFS(_T,_TF,_DD,,,,,5)
IF(_TI<>$P_TOOLNO)OR(S_INIT)
_E_INIT=2
ENDIF
ENDIF
ENDIF
IF(NOT _ST7)
_ST0=1-(_ST B_AND 'B00000001')
_ST1=(_ST B_AND 'B00000010')/2
_ST8=(_ST B_AND 'H100')/256
_ST9=(_ST B_AND 'H200') AND _ST8
_ST10=(_ST B_AND 'HC00')/'H400'
_STATUS=_ST0+_ST1*10+(_ST8+_ST9)*1000+_ST10*100000000
IF(_HEB==1)
IF(_DIR==1)
_STATUS=_STATUS+200000
ENDIF
IF(_DIR==-1)
_STATUS=_STATUS+100000
ENDIF
_DIR=0
ENDIF
CYCLE800(_FR,_TC,_STATUS,_MODE,_X0,_Y0,_Z0,_A,_B,_C,_X1,_Y1,_Z1,_DIR,_FR_I)
IF(NOT _ST8)AND(_HEB==0)
N500 CUST_800(14,_TCI)
ENDIF
ENDIF
RET
_FEHL1: STOPRE
N880001 SETAL(61225)
RET
_FEHL2: STOPRE
N880002 SETAL(61226)
RET
_FEHL3: STOPRE
N880003 SETAL(61182)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_TCTOOL_SPF
PROC E_TCTOOL(STRING[32] _TC,INT _ST,REAL _A,REAL _B,INT _MODE,INT _FRE,REAL _FR_I) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 02.06.19.00 ;DATE: 2009-06-15
;ShopMill: Approach Tool
DEF INT _FR800,_MODE800,_ST800
IF(_ST B_AND 'B10')
_ST800=111
ELSE
_ST800=101
ENDIF
CASE _MODE OF 0 GOTOF _M0 1 GOTOF _M1 2 GOTOF _M2 3 GOTOF _M3 4 GOTOF _M4 5 GOTOF _M5 DEFAULT GOTOF _MMODF
_M0:
_MODE800='B111001'
GOTOF _MMOD
_M1:
_MODE800='B101101'
GOTOF _MMOD
_M2:
_MODE800='B110110'
GOTOF _MMOD
_M3:
_MODE800='B011110'
GOTOF _MMOD
_M4:
_MODE800='B100111'
GOTOF _MMOD
_M5:
_MODE800='B011011'
GOTOF _MMOD
_MMODF:
GOTOF _FEHL1
_MMOD:
IF(_FRE==1)
_FR800=0
ELSE
IF(_FRE==0)
_FR800=1
ELSE
_FR800=_FRE
ENDIF
ENDIF
N100 CYCLE800(_FR800,_TC,_ST800,_MODE800,,,,_A,_B,0,,,,-1,_FR_I,0)
RET
_FEHL1:
N880041 SETAL(61295)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_TFS_SPF
PROC E_TFS(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _F,INT _FAA,REAL _S,INT _SA,INT _MODE,INT _DP,INT _SMODE) SBLOF DISPLOF PREPRO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.009 ;DATE: 2024-05-22
;ShopMill: Tool Change/Feedrate/Spindle
DEF AXIS _XX,_YY,_ZZ
DEF INT _TI,_TFI,_TFA,_WTYP,_M3_5,S_M3_5,_M7_8,_M7_8_ALT=0,_I,_HND_ALT=0,_HND_NEU=0,_NPV,_MB1,_MB2,_MB3,_MB5,_TCI
DEF INT _WZGW=0,_TC37,_AX1_MODE,_AX2_MODE,S_TI,S_THNR,S_GETR,_MB9,_DPA,_P6,_P29,S_P52,S_P53,_MAN=0
DEF INT S_TC_FR,S_TC_ST,S_TC_MODE,S_TC_N_WZ,S_TC_A_WZ,S_TC_NUM
DEF INT _II,_III,_H,_FOUND
DEF REAL _FAK1,_FAK2,_FAK4,_POS1,_POS2,_POS3,_A1,_A2,S_A1TC,S_A2TC,_OFFN=0
DEF REAL S_TC_P[10],S_TC_A1,S_TC_A2
DEF BOOL _T_NEU=FALSE,_TF_NEU=FALSE,_D_NEU=FALSE,_M_NEU=FALSE,_MK_NEU=FALSE,_S_NEU=FALSE,_MS_NEU=FALSE,_F_NEU=FALSE,_WZW=FALSE,_F_OK=FALSE,S_MK_OFF=FALSE
DEF FRAME _FRAME,_WPFR
DEF STRING[200] _CMD
DEF STRING[200] S_STR
DEF STRING[32] _AX1_NAME,_AX2_NAME
DEF INT _LOG,_LOG_ON,S_LOGSIZE
DEF STRING[35] _LOG_FILE="/_N_MPF_DIR/_N_LOG_E_TFS_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
FILESIZE(_LOG,_LOG_FILE,S_LOGSIZE)
IF(S_LOGSIZE>20000)
_LOG_ON=0
ENDIF
ENDIF
IF(_LOG_ON)
; DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"-------------------")
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_TFS(_T="<<_T<<",_TF="<<_TF<<",_DD="<<_DD<<",_F="<<_F<<",_FAA="<<_FAA<<",_S="<<_S<<",_SA="<<_SA<<",_MODE="<<_MODE<<",_DP="<<_DP<<",_SMODE="<<_SMODE<<")")
S_STR="Aufruf aus "
FOR _I=0 TO $P_STACK-1
S_STR=S_STR<<SUBSTR($P_PROG[_I],3,STRLEN($P_PROG[_I])-3-4)<<" -> "
ENDFOR
WRITE(_LOG,_LOG_FILE,S_STR<<"E_TFS")
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_P6=$P_GG[6]
_P29=$P_GG[29]
S_M3_5=_SA _DEC2
_SA=_SA _DEC1
IF(_MODE==10)
S_MK_OFF=TRUE
_MODE=0
ENDIF
IF(_T<>"")
REPEAT S_GET_T_NR_A S_GET_T_NR_E
_TI=S_TI
IF(_TI>0)
_DPA=$TC_TP1[_TI]
ELSE
_DPA=-1
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"aktiv: TI="<<_TI<<" DPA="<<_DPA)
ENDIF
IF(_T=="0")
_TI=0
_DD=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_DD=0 (wegen T0)")
ENDIF
ELSE
_TI=GETT(_T,_DP)
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"neu:   TI="<<_TI<<" DP="<<_DP)
ENDIF
IF(_MODE==2)OR(_MODE==6)
IF(S_TI<>_TI)
_T_NEU=TRUE
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_T_NEU=TRUE")
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE")
ENDIF
ELSE
_D_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_D_NEU=TRUE")
ENDIF
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_TOOLNO="<<$P_TOOLNO<<" _TI="<<_TI)
ENDIF
IF($P_TOOLNO>0)
IF(_T==$TC_TP2[$P_TOOLNO])
_TI=$P_TOOLNO
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Duplo -> _TI="<<_TI)
ENDIF
ENDIF
ENDIF
IF($P_TOOLNO<>_TI)
_T_NEU=TRUE
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_T_NEU=TRUE ($P_TOOLNO<>_TI)")
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE ($P_TOOLNO<>_TI)")
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_TOOL="<<$P_TOOL<<" _DD="<<_DD)
ENDIF
IF($P_TOOL<>_DD)
_D_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_D_NEU=TRUE ($P_TOOL<>_DD)")
ENDIF
ELSE
IF($MC_CUTTING_EDGE_DEFAULT==-2)OR($MC_CUTTING_EDGE_DEFAULT==0)
_D_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_D_NEU=TRUE wegen $MC_CUTTING_EDGE_DEFAULT="<<$MC_CUTTING_EDGE_DEFAULT)
ENDIF
ENDIF
ENDIF
ENDIF
IF($P_TOOLNO>0)AND($MCS_FUNCTION_MASK_TECH B_AND 'H80')
STOPRE
IF($TC_TP8[$P_TOOLNO] B_AND 'B100')
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Standzeit abgelaufen -> Wkz. auswechseln!")
WRITE(_LOG,_LOG_FILE,"_T_NEU=TRUE")
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE")
ENDIF
_WZW=TRUE
_T_NEU=TRUE
ENDIF
ENDIF
ENDIF
ELSE
_TI=$P_TOOLNO
IF(_DD==0)
_DD=$P_TOOL
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_D_NEU=TRUE (_DD==0)")
ENDIF
ENDIF
IF($P_TOOL<>_DD)AND((_MODE==1)OR(_MODE==3))
_D_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_D_NEU=TRUE (_DD<>)")
ENDIF
ENDIF
ENDIF
IF($MC_TOOL_CHANGE_MODE==1)AND(_TF<>"")AND(($SCS_FUNCTION_MASK_TECH_SET B_AND 'B001'==1)OR(_MODE==2)OR(_MODE==6))
IF(_TF=="0")
_TFI=0
ELSE
_TFI=GETT(_TF,0)
ENDIF
IF(_TFI>=0)
IF(_T_NEU)
IF(_TFI<>_TI)
_TF_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TF_NEU=TRUE (_TFI<>_TI)")
ENDIF
ENDIF
ELSE
IF(_TFI<>$P_TOOLNO)
_TF_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TF_NEU=TRUE (_TFI<>$P_TOOLNO)")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_E_INIT)
_M_NEU=TRUE
_MK_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=TRUE (init)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=TRUE (init)")
ENDIF
IF(_E_INIT==1)
_T_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_T_NEU=TRUE (_E_INIT==1)")
ENDIF
ENDIF
S_M_OK=0
S_MK_OK=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_E_INIT -> S_M_OK=0, S_MK_OK=0")
ENDIF
_E_INIT=0
ENDIF
IF(_SA>0)
_S_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_S_NEU=TRUE (_SA>0)")
ENDIF
ENDIF
IF(_FAA>0)
_F_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_F_NEU=TRUE (_FAA>0)")
ENDIF
ENDIF
IF(_T_NEU)OR((_MODE==1)AND(_S_NEU))
_M_NEU=TRUE
_MK_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=TRUE (T neu oder E_TS(1))")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=TRUE (T neu oder E_TS(1))")
ENDIF
ENDIF
IF(_TI<=0)
_M_NEU=FALSE
_MK_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (_TI<=0)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (_TI<=0)")
ENDIF
ENDIF
IF(_MODE==5)
_M_NEU=FALSE
_MK_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (_MODE==5)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (_MODE==5)")
ENDIF
ENDIF
IF(_MODE==3)
_TF_NEU=FALSE
_M_NEU=FALSE
_MK_NEU=FALSE
_S_NEU=FALSE
_F_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TF_NEU=FALSE (_MODE==3)")
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (_MODE==3)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (_MODE==3)")
WRITE(_LOG,_LOG_FILE,"_S_NEU=FALSE (_MODE==3)")
WRITE(_LOG,_LOG_FILE,"_F_NEU=FALSE (_MODE==3)")
ENDIF
ENDIF
IF(_MODE==6)
_M_NEU=FALSE
_MK_NEU=FALSE
_S_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (_MODE==6)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (_MODE==6)")
WRITE(_LOG,_LOG_FILE,"_S_NEU=FALSE (_MODE==6)")
ENDIF
ENDIF
IF(_TI>0)AND((_MODE==0)OR(_MODE==1))
_M_NEU=TRUE
_MK_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=TRUE (Werkzeugwechsel)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=TRUE (Werkzeugwechsel)")
ENDIF
_M3_5=TRUNC($TC_DP25[_TI,1]/256)MOD 4
IF($MCS_TECHNOLOGY_EXTENSION==1)AND($TC_DP1[_TI,1]>=500)AND($TC_DP1[_TI,1]<=599)
IF($P_CUT_INV)AND((_M3_5==1)OR(_M3_5==2))
_M3_5=3-_M3_5
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehrichtung bei Drehwerkzeug invertiert: M"<<SUBSTR("5345",_M3_5,1))
ENDIF
ENDIF
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")AND(S_C809_FIXED)AND(S_C809_INV)
IF((_M3_5==1)OR(_M3_5==2))
_M3_5=3-_M3_5
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"DFM: Werkzeug fest und Richtung Drehebene invertiert: M"<<SUBSTR("5345",_M3_5,1))
ENDIF
ENDIF
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAINT")
IF(S_INV_S_IPT)AND((_M3_5==1)OR(_M3_5==2))
_M3_5=3-_M3_5
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"IPT: M"<<SUBSTR("5345",_M3_5,1))
ENDIF
ENDIF
ENDIF
IF($P_MSNUM==0)
GOTOF _FEHL6
ENDIF
IF(($P_SDIR[0]-2)MOD 3<>_M3_5)AND(_S_NEU)
S_M_OK=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"S_M_OK=0 (M3/4 und S)")
ENDIF
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"M"<<$P_SDIR[0]<<" ist aktiv")
ENDIF
ENDIF
ENDIF
IF(S_M3_5)AND(_S_NEU)
_M_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=TRUE (M3/4/5 und S)")
ENDIF
ENDIF
IF(NOT _S_NEU)
_M_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (NOT _S_NEU)")
ENDIF
ENDIF
IF(_SMODE==0)
ELSE
_MS_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_MS_NEU=TRUE (_S_MODE<>0)")
ENDIF
ENDIF
IF((_MODE==0)OR(_MODE==11))AND(_FAA==0)AND(_SA==0)
_M_NEU=FALSE
_MK_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (nur Werkzeugwechsel)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (nur Werkzeugwechsel)")
ENDIF
ENDIF
IF(S_MK_OFF==TRUE)
_MK_NEU=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_MK_NEU=TRUE (S_MK_OFF)")
ENDIF
ENDIF
IF(_D_NEU)AND($P_TOOL<>_DD)AND(NOT _T_NEU)
D=_DD
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"D="<<_DD<<" ;Wechsel der D-Nr. bei gleichem Werkzeug zulassen:")
ENDIF
ENDIF
IF(_T_NEU)
S_M_OK=0
S_MK_OK=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_T_NEU -> S_M_OK=0, S_MK_OK=0")
ENDIF
ENDIF
IF(_M_NEU)AND(S_M_OK==1)
_M_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (wurde schon ausgegeben)")
ENDIF
ENDIF
IF(_MK_NEU)AND(S_MK_OK==1)
_MK_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (wurde schon ausgegeben)")
ENDIF
ENDIF
IF(_LOG_ON)
_CMD=""
IF(_T_NEU)
_CMD=_CMD<<" _T_NEU"
ENDIF
IF(_D_NEU)
_CMD=_CMD<<" (_D_NEU)"
ENDIF
IF(_TF_NEU)
_CMD=_CMD<<" _TF_NEU"
ENDIF
IF(_M_NEU)
_CMD=_CMD<<" _M_NEU"
ENDIF
IF(_MK_NEU)
_CMD=_CMD<<" _MK_NEU"
ENDIF
IF(_S_NEU)
_CMD=_CMD<<" _S_NEU"
ENDIF
IF(_MS_NEU)
_CMD=_CMD<<" _MS_NEU"
ENDIF
IF(_F_NEU)
_CMD=_CMD<<" _F_NEU"
ENDIF
WRITE(_LOG,_LOG_FILE,"To do:"<<_CMD)
ENDIF
IF(NOT(_T_NEU OR _TF_NEU OR _M_NEU OR _MK_NEU OR _S_NEU OR _MS_NEU OR _F_NEU))
RET
ENDIF
_TCI=$P_TC
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK4=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK4=$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK4=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_TI>0)AND(_DD>0)
_WTYP=$TC_DP1[_TI,_DD]
ENDIF
N10 G0 AX[$P_AXN3]=AC($P_EP[$P_AXN3]*_FAK1)
IF(_T_NEU)
IF(_MODE==3)
_E_L6=0
ELSE
_E_L6=1
ENDIF
IF(_T<>"")
IF($P_TOOLNO>0)AND($P_TOOL>0)
_M7_8_ALT=TRUNC($TC_DP25[$P_TOOLNO,1]/1024)MOD 4
ENDIF
IF(_MODE<>2)AND(_MODE<>6)
OFFN=0
_E_TS_OFFN=0
ENDIF
IF($P_GG[6]==1)
_XX=$P_AXN1
_YY=$P_AXN2
_ZZ=$P_AXN3
ELSE
IF($P_GG[6]==2)
_XX=$P_AXN2
_YY=$P_AXN3
_ZZ=$P_AXN1
ELSE
_XX=$P_AXN3
_YY=$P_AXN1
_ZZ=$P_AXN2
ENDIF
ENDIF
IF($P_TRAFO)
_OFFN=$P_OFFN*_FAK2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"F_SP_TRA(300) Trafo speichern")
ENDIF
F_SP_TRA(300)
_FRAME=$P_PFRAME
_NPV=$P_GG[8]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAFOOF")
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")
IF(($NT_IDENT[$P_TRAFO_PARSET MOD 1000,0] _DEC5)>=2)
CYCLE809()
_P6=$P_GG[6]
_F_TRA_T=0
ENDIF
ENDIF
IF(NOT _SC_IS_ROBOT)
TRAFOOF
ENDIF
_POS1=$P_EP[_XX]
_POS2=$P_EP[_YY]
_POS3=$P_EP[_ZZ]
ENDIF
IF(_TCI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schwenkdaten merken")
ENDIF
_NPV=$P_GG[8]
S_P52=$P_GG[52]
S_P53=$P_GG[53]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME merken")
WRITE(_LOG,_LOG_FILE,"  Trans("<<$P_WPFRAME[_XX,TR]<<"/"<<$P_WPFRAME[_YY,TR]<<"/"<<$P_WPFRAME[_ZZ,TR]<<")")
WRITE(_LOG,_LOG_FILE,"  Rot  ("<<$P_WPFRAME[_XX,RT]<<"/"<<$P_WPFRAME[_YY,RT]<<"/"<<$P_WPFRAME[_ZZ,RT]<<")")
ENDIF
_WPFR=$P_WPFRAME
_AX1_MODE=TRUNC($TC_CARR37[_TCI]/10) MOD 10
_AX2_MODE=TRUNC($TC_CARR37[_TCI]/100) MOD 10
CYCLE213(_TCI)
_AX1_NAME=$TC_CARR35[_TCI]
_AX2_NAME=$TC_CARR36[_TCI]
IF(_MODE<>2)AND(_MODE<>6)AND(_AX1_MODE==0)AND(_AX1_NAME<>"")
_A1=$P_EP[AXNAME(_AX1_NAME)]
ELSE
_A1=$TC_CARR13[_TCI]
ENDIF
IF(_MODE<>2)AND(_MODE<>6)AND(_AX2_MODE==0)AND(_AX2_NAME<>"")
_A2=$P_EP[AXNAME(_AX2_NAME)]
ELSE
_A2=$TC_CARR14[_TCI]
ENDIF
S_A1TC=$P_TCANG[1]
S_A2TC=$P_TCANG[2]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Position Schwenkkopf merken:")
WRITE(_LOG,_LOG_FILE,"  Rundachspositionen: "<<_A1<<"/"<<_A2)
WRITE(_LOG,_LOG_FILE,"  Toolcarrier:        "<<S_A1TC<<"/"<<S_A2TC)
ENDIF
_TC37=TRUNC($TC_CARR37[_TCI]/100000000) MOD 10
IF(_TC37 B_AND 'B001')AND($TC_CARR23[_TCI]<>"P")
_WZGW=1
ELSE
_WZGW=2
ENDIF
S_TC_FR=_TC_FR
S_TC_ST=_TC_ST
S_TC_MODE=_TC_MODE
S_TC_P[5]=_TC_P[5]
S_TC_P[6]=_TC_P[6]
S_TC_P[7]=_TC_P[7]
S_TC_N_WZ=_TC_N_WZ
S_TC_A_WZ=_TC_A_WZ
S_TC_A1=_TC_A1
S_TC_A2=_TC_A2
S_TC_NUM=_TC_NUM
ENDIF
IF(_MODE<>2)AND(_MODE<>6)AND(_E_POSMU==0)
MCALL
ENDIF
IF(_TI==-1)
GOTOF _FEHL5
ENDIF
IF($P_TOOLNO>0)
IF($A_MYMN[$P_TOOLNO]==0)
_HND_ALT=1
ELSE
_HND_ALT=0
ENDIF
ENDIF
IF(_TI>0)
IF($A_MYMN[_TI]==0)
_HND_NEU=1
ELSE
_HND_NEU=0
ENDIF
ENDIF
IF(_TI>0)AND(_TCI>0)AND(_WZGW<>2)AND(NOT _HND_NEU) GOTOF _FEHL4
IF(_HND_ALT)AND(_HND_NEU)
IF(_TCI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N100 CUST_800(3,"<<_TCI<<")")
ENDIF
N100 CUST_800(3,_TCI)
ENDIF
ELSE
IF(_HND_ALT)
IF(_TCI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N110 CUST_800(3,"<<_TCI<<")")
ENDIF
N110 CUST_800(3,_TCI)
ENDIF
ENDIF
IF(_HND_NEU)
REPEAT S_GET_T_NR_A S_GET_T_NR_E
IF(S_TI)
IF(_TCI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N120 CUST_800(2,"<<_TCI<<")")
ENDIF
N120 CUST_800(2,_TCI)
ENDIF
_F_T_STR="0"
_F_DP_NO=-1
_F_T_MP=-1
_F_MTL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(117)")
ENDIF
CUST_TECHCYC(117)
T0
IF($MC_TOOL_CHANGE_MODE==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"M6")
ENDIF
M6
ENDIF
ENDIF
IF(_TCI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N130 CUST_800(3,"<<_TCI<<")")
ENDIF
N130 CUST_800(3,_TCI)
ENDIF
ENDIF
ENDIF
IF(NOT _HND_ALT)AND(NOT _HND_NEU)
REPEAT S_GET_T_NR_A S_GET_T_NR_E
IF(S_TI<>_TI)
IF(_TCI)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N140 CUST_800(2,"<<_TCI<<")")
ENDIF
N140 CUST_800(2,_TCI)
ENDIF
ENDIF
ENDIF
IF(_T=="0")
_F_T_STR="0"
_F_DP_NO=-1
_F_T_MP=-1
_F_MTL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(117)")
ENDIF
CUST_TECHCYC(117)
T0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"T0  ;Werkzeug entladen")
ENDIF
ELSE
IF(_DP)
_F_T_STR=_T
_F_DP_NO=_DP
_F_T_MP=-1
_F_MTL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(117)")
ENDIF
CUST_TECHCYC(117)
TCA(_T,_DP)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TCA("<<_T<<","<<_DP<<")")
ENDIF
ELSE
_F_T_STR=_T
_F_DP_NO=-1
_F_T_MP=-1
_F_MTL=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(117)")
ENDIF
CUST_TECHCYC(117)
T=_T
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"T="<<_T)
ENDIF
ENDIF
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)AND(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))AND(NOT $P_DRYRUN)AND(NOT(_MODE==3))AND(NOT(_E_JS_PRG==0))
SETPIECE(0)
ENDIF
IF($MC_TOOL_CHANGE_MODE==1)
M6
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"M6")
ENDIF
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)AND(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))AND(NOT $P_DRYRUN)AND(NOT(_MODE==3))AND(NOT(_E_JS_PRG==0))
SETPIECE(1)
ENDIF
IF(_TCI)AND(_MODE<>4)AND(_MODE<>5)AND(_A1<>_SC_A_NO_VAL)AND(_A2<>_SC_A_NO_VAL)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TC wiederherstellen? TC="<<_TCI<<" MODE="<<_MODE)
ENDIF
IF(NOT $P_ISTEST)
REPEAT S_GET_T_NR_A S_GET_T_NR_E
_TI=S_TI
IF(_TI>0)
IF(_DPA<>$TC_TP1[_TI])
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE Duplo")
ENDIF
ENDIF
ENDIF
ENDIF
IF($P_TC==0)
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE $P_TC=0")
ENDIF
ENDIF
IF(_MODE==2)
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE SSL")
ENDIF
ENDIF
IF(_MODE<>2)AND(_AX1_MODE==0)AND(_AX1_NAME<>"")
IF($P_EP[AXNAME(_AX1_NAME)]<>_A1)
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE AX1")
ENDIF
ENDIF
ENDIF
IF(_MODE<>2)AND(_AX2_MODE==0)AND(_AX2_NAME<>"")
IF($P_EP[AXNAME(_AX2_NAME)]<>_A2)
_WZW=TRUE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=TRUE AX2")
ENDIF
ENDIF
ENDIF
IF((_WTYP>=500)AND(_WTYP<=599))
IF(_MODE==11)
_MODE=0
ELSE
_WZW=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=FALSE Drehwerkzeug")
ENDIF
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_MAN=1
ENDIF
IF(_E_SM_PRG==0)AND(NOT _MAN)
_WZW=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_WZW=FALSE G-Code")
ENDIF
ENDIF
IF(_WZW)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schwenkkopf wieder ausrichten ("<<_A1<<"/"<<_A2<<")")
ENDIF
IF(_MODE<>3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N12 CUST_800(12,"<<_TCI<<","<<_A1<<","<<_A2<<")")
ENDIF
N12 CUST_800(12,_TCI,_A1,_A2)
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N13 CUST_800(13,"<<_TCI<<","<<_A1<<","<<_A2<<")")
ENDIF
N13 CUST_800(13,_TCI,_A1,_A2)
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_WPFRAME rekonstruieren ("<<_WPFR[_XX,RT]<<"/"<<_WPFR[_YY,RT]<<"/"<<_WPFR[_ZZ,RT]<<")")
ENDIF
$P_WPFRAME=_WPFR
$P_WPFR=$P_WPFRAME
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Toolcarrier neu anwaehlen")
ENDIF
G[8]=_NPV
$TC_CARR13[_TCI]=S_A1TC
$TC_CARR14[_TCI]=S_A2TC
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$TC_CARR13="<<$TC_CARR13[_TCI]<<" $TC_CARR14="<<$TC_CARR14[_TCI])
ENDIF
N800 TCARR=_TCI TCOABS
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N800 TCARR="<<_TCI<<" TCOABS")
ENDIF
IF(NOT $P_SEARCH)AND(NOT $AC_SERUPRO)AND(NOT $P_ISTEST)AND(NOT($MN_SIM_ENVIRONMENT B_AND 'B100'))
IF($MC_TOOL_CARRIER_RESET_VALUE<>_TCI)
STOPRE
$MC_TOOL_CARRIER_RESET_VALUE=_TCI
ENDIF
ENDIF
_TC_A1=$P_TCANG[1]
_TC_A2=$P_TCANG[2]
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  _TC_A1="<<_TC_A1<<" _TC_A2="<<_TC_A2)
ENDIF
_TC_FR=S_TC_FR
_TC_ST=S_TC_ST
_TC_MODE=S_TC_MODE
_TC_P[5]=S_TC_P[5]
_TC_P[6]=S_TC_P[6]
_TC_P[7]=S_TC_P[7]
_TC_N_WZ=S_TC_N_WZ
_TC_A_WZ=S_TC_A_WZ
_TC_A1=S_TC_A1
_TC_A2=S_TC_A2
_TC_NUM=S_TC_NUM
N52 G[52]=S_P52
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N52 G[52]="<<S_P52<<" -> "<<SUBSTR("PAROTOFPAROT",(S_P52-1)*7,7))
ENDIF
N53 G[53]=S_P53
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"N53 G[53]="<<S_P53<<" -> "<<SUBSTR("TOROTOF TOROT   TOROTZ  TOROTY  TOROTX  TOFRAME TOFRAMEZTOFRAMEYTOFRAMEX",(S_P53-1)*8,8))
ENDIF
ENDIF
ENDIF
IF(_MODE==2)
IF($P_TC)
IF((_WTYP>=500)AND(_WTYP<=599))
IF(S_JS_SSL_STEP==1)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Toolcarrier nach SSL auf Drehen auf Fräsmaschinen abwaehlen")
ENDIF
CYCLE800()
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_TRA_T)
IF(_F_TRA_T==256)OR(_F_TRA_T==257)OR(_F_TRA_T==512)OR(_F_TRA_T==513)OR(_F_TRA_T==514)
N20 G0 AX[$P_AXN3]=AC(_POS3*_FAK1)
N25 G0 AX[$P_AXN1]=AC(_POS1*_FAK1)
N30 G0 AX[$P_AXN2]=AC(_POS2*_FAK1)
ENDIF
IF(_F_TRA_TS=="TRAORI_STAT")AND((_WTYP<500)OR(_WTYP>599))
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehtrafo nicht wieder aktivieren (T:"<<_WTYP<<")")
ENDIF
_F_TRA_T=0
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"F_SP_TRA(200) Trafo wieder aktivieren")
ENDIF
F_SP_TRA(200)
_P6=$P_GG[6]
ENDIF
OFFN=_OFFN
$P_PFRAME=_FRAME
N300 G[8]=_NPV
ENDIF
ELSE
_TI=$P_TOOLNO
_DD=$P_TOOL
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"$P_TOOL="<<$P_TOOL<<" _DD="<<_DD<<" $P_TOOLNO="<<$P_TOOLNO<<" $MC_CUTTING_EDGE_DEFAULT="<<$MC_CUTTING_EDGE_DEFAULT)
ENDIF
IF(($P_TOOL<>_DD)AND($P_TOOLNO))OR($MC_CUTTING_EDGE_DEFAULT==-2)OR($MC_CUTTING_EDGE_DEFAULT==0)OR(_DD==0)
D=_DD
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"D="<<_DD)
ENDIF
ENDIF
_E_L6=0
ELSE
_TI=$P_TOOLNO
_DD=$P_TOOL
IF(_TI==0)
_M_NEU=FALSE
_MK_NEU=FALSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_M_NEU=FALSE (T=0)")
WRITE(_LOG,_LOG_FILE,"_MK_NEU=FALSE (T=0)")
ENDIF
ENDIF
ENDIF
IF(_MS_NEU)
_CMD="SETMS("<<_F_S_NR[_SMODE-1]<<")"
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Kommandostring 1: "<<_CMD)
ENDIF
EXECSTRING(_CMD)
ENDIF
IF(_M_NEU)AND(S_M_OK==0)
IF(S_M3_5)
_M3_5=S_M3_5-2
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehrichtung direkt übergeben: M"<<SUBSTR("5345",_M3_5,1))
ENDIF
ELSE
IF($P_TOOLNO>0)AND($P_TOOL>0)
_M3_5=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehrichtung aus WZ: M"<<SUBSTR("5345",_M3_5,1))
ENDIF
ENDIF
ENDIF
IF(_M3_5==1)
_MB1=3
ELSE
IF(_M3_5==2)
_MB1=4
ELSE
_MB1=5
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehrichtung: M"<<_MB1)
ENDIF
IF($P_TOOLNO)AND($P_TOOL)
IF($MCS_TECHNOLOGY_EXTENSION==1)AND($P_AD[1]>=500)AND($P_AD[1]<=599)
IF($P_CUT_INV)AND((_MB1==3)OR(_MB1==4))
_MB1=7-_MB1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Drehrichtung bei Drehwerkzeug invertiert: M"<<_MB1)
ENDIF
ENDIF
ENDIF
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAORI_STAT")AND(S_C809_FIXED)AND(S_C809_INV)
IF((_MB1==3)OR(_MB1==4))
_MB1=7-_MB1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"DFM: Werkzeug fest und Richtung Drehebene invertiert: M"<<_MB1)
ENDIF
ENDIF
ENDIF
IF($PC_TRAFO_TYPE_NAME=="TRAINT")
IF(S_INV_S_IPT)AND((_MB1==3)OR(_MB1==4))
_MB1=7-_MB1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"IPT: M"<<_MB1)
ENDIF
ENDIF
ENDIF
ENDIF
IF(_MK_NEU)AND(S_MK_OK==0)
S_MK_OK=1
IF($P_TOOLNO>0)AND($P_TOOL>0)
_M7_8=TRUNC($TC_DP25[$P_TOOLNO,1]/1024)MOD 4
IF(S_MK_OFF)
_M7_8=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"S_MK_OFF: Kuehlmittel AUS")
ENDIF
ENDIF
ENDIF
IF((_M7_8 B_AND 3)==3)AND($MCS_M_CODE_COOLANT_1_AND_2_ON > -1)
_MB9=$MCS_M_CODE_ALL_COOLANTS_OFF
_MB5=$MCS_M_CODE_COOLANT_1_AND_2_ON
ELSE
IF(_M7_8 B_AND 1)
_MB2=$MCS_M_CODE_COOLANT_1_ON
ENDIF
IF(_M7_8 B_AND 2)
_MB3=$MCS_M_CODE_COOLANT_2_ON
ENDIF
IF(_M7_8==1)OR(_M7_8==2)
_MB9=$MCS_M_CODE_ALL_COOLANTS_OFF
ENDIF
ENDIF
IF(_M7_8==0)
_MB9=$MCS_M_CODE_ALL_COOLANTS_OFF
ENDIF
ENDIF
IF(_S_NEU)
IF(_WTYP>=100)AND(_WTYP<300)
IF(_SA==2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Schnittgeschwindigkeit V="<<_S<<" WR="<<$P_TOOLR<<" metric="<<$MN_SCALING_SYSTEM_IS_METRIC<<" "<<SUBSTR("G70 G71 G700G710",4*$P_GG[13]-4,4))
ENDIF
IF($P_TOOLR>0)
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]<>3)
_S=1000*_S/($PI*2*$P_TOOLR*_FAK4)
ELSE
_S=12*_S/($PI*2*$P_TOOLR)
ENDIF
ELSE
IF($P_GG[13]<>4)
_S=12*_S/($PI*2*$P_TOOLR*_FAK4)
ELSE
_S=1000*_S/($PI*2*$P_TOOLR)
ENDIF
ENDIF
IF(_S>999999)
_S=999999
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-> S="<<_S)
ENDIF
ELSE
GOTOF _FEHL2
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"-> Drehzahl S="<<_S)
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_NEU)
_F_OK=TRUE
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
IF(_FAA<>2)
_F_OK=FALSE
ENDIF
ELSE
IF($P_F_TYPE==1)OR($P_F_TYPE==3)
IF(_FAA<>3)
_F_OK=FALSE
ENDIF
ELSE
IF(_FAA<>1)
_F_OK=FALSE
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_NEU)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_F_NEU: G[15]="<<$P_GG[15]<<" _FAA="<<_FAA<<" _SA="<<_SA<<" _WTYP="<<_WTYP)
ENDIF
IF(_FAA==1)
IF(_WTYP>=100)AND(_WTYP<300)
IF($P_GG[15]<>2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G94")
ENDIF
G94
ENDIF
ELSE
IF(_FAA==1)AND(_SA==0)
IF($P_GG[15]<>2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G942")
ENDIF
G942
ENDIF
ENDIF
IF(_FAA==1)AND(_SA==1)
IF($P_GG[15]<>2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G94 S="<<_S)
ENDIF
G94 S=_S
ENDIF
ENDIF
IF(_FAA==1)AND(_SA==2)
IF($P_GG[15]<>7)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G961 S="<<_S)
ENDIF
G961 S=_S
ENDIF
ENDIF
ENDIF
ENDIF
IF(_FAA==2)OR(_FAA==3)
IF(_FAA==2)
IF((_WTYP<100)OR(_WTYP>199))AND(_WTYP<>220)
GOTOF _FEHL1
ENDIF
ENDIF
IF(_WTYP>=100)AND(_WTYP<300)
IF($P_GG[15]<>3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G95")
ENDIF
G95
ENDIF
ELSE
IF(_FAA==3)AND(_SA==0)
IF($P_GG[15]<>3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G952")
ENDIF
G952
ENDIF
ENDIF
IF(_FAA==3)AND(_SA==1)
IF($P_GG[15]<>3)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G95 S="<<_S)
ENDIF
G95 S=_S
ENDIF
ENDIF
IF(_FAA==3)AND(_SA==2)
IF($P_GG[15]<>4)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  G96 S="<<_S)
ENDIF
G96 S=_S
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF(_F_OK)
IF($P_F_TYPE==11)OR($P_F_TYPE==33)
_F_OK=(_F==$P_FZ)
ELSE
_F_OK=(_F==$P_F)
ENDIF
ENDIF
IF(_F_NEU==FALSE)OR(_FAA<1)OR(_FAA>3)OR(_F_OK)
_F=-1
ENDIF
IF(_SMODE==1)
IF(_F_S_AX[0]<>NO_AXIS)
IF(($MA_GEAR_STEP_CHANGE_ENABLE[_F_S_AX[0]] B_AND 'B11')>0)
S_GETR=1
ENDIF
ENDIF
ELSE
IF(_F_S_AX[1]<>NO_AXIS)
IF(($MA_GEAR_STEP_CHANGE_ENABLE[_F_S_AX[1]] B_AND 'B11')>0)
S_GETR=1
ENDIF
ENDIF
ENDIF
IF((_S_NEU==FALSE)OR(_SA<1)OR(_SA>2))
_S=-1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"S nicht neu")
ENDIF
ENDIF
IF(_S_NEU==TRUE)AND($P_MSNUM==0)
GOTOF _FEHL6
ENDIF
_CMD=""
IF(_S>=0)
IF(NOT _F_NEU)
IF(_WTYP>=100)AND(_WTYP<300)
_CMD=_CMD<<"G972 "
ELSE
IF((_SA _DEC1)==1)
_CMD=_CMD<<"G972 "
ENDIF
IF((_SA _DEC1)==2)
_CMD=_CMD<<"G962 "
ENDIF
ENDIF
ENDIF
_CMD=_CMD<<"S="<<_S<<" "
ENDIF
IF(_F>=0)
IF(_FAA==2)
_CMD=_CMD<<"FZ="<<_F<<" "
ELSE
IF(_FAA==3)
_CMD=_CMD<<"F="<<_F<<" "
ELSE
_CMD=_CMD<<"F="<<_F<<" "
ENDIF
ENDIF
ENDIF
IF(_MB1)
_CMD=_CMD<<"M="<<_MB1<<" "
ENDIF
IF(_MB2)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B0010')
_CMD=_CMD<<"M=QU("<<_MB2<<") "
ELSE
_CMD=_CMD<<"M="<<_MB2<<" "
ENDIF
ENDIF
IF(_MB3)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B0100')
_CMD=_CMD<<"M=QU("<<_MB3<<") "
ELSE
_CMD=_CMD<<"M="<<_MB3<<" "
ENDIF
ENDIF
IF(_MB5)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B1000')
_CMD=_CMD<<"M=QU("<<_MB5<<") "
ELSE
_CMD=_CMD<<"M="<<_MB5<<" "
ENDIF
ENDIF
IF(_MB9)
IF($MCS_ENABLE_QUICK_M_CODES B_AND 'B0001')
M=QU(_MB9)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"M=QU("<<_MB9<<")")
ENDIF
ELSE
M=_MB9
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"M="<<_MB9)
ENDIF
ENDIF
ENDIF
IF(_CMD<>"")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Kommandostring 2: "<<_CMD)
ENDIF
EXECSTRING(_CMD)
ENDIF
IF(_MK_NEU)
_CMD=""
IF($P_TOOLNO>0)AND($P_TOOL>0)
_I=$TC_DP25[$P_TOOLNO,1]
ENDIF
IF(_I B_AND 1)
IF($MCS_TOOL_MCODE_FUNC_ON[0] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_ON[0]<<" "
ENDIF
ELSE
IF($MCS_TOOL_MCODE_FUNC_OFF[0] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_OFF[0]<<" "
ENDIF
ENDIF
IF(_I B_AND 2)
IF($MCS_TOOL_MCODE_FUNC_ON[1] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_ON[1]<<" "
ENDIF
ELSE
IF($MCS_TOOL_MCODE_FUNC_OFF[1] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_OFF[1]<<" "
ENDIF
ENDIF
IF(_I B_AND 4)
IF($MCS_TOOL_MCODE_FUNC_ON[2] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_ON[2]<<" "
ENDIF
ELSE
IF($MCS_TOOL_MCODE_FUNC_OFF[2] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_OFF[2]<<" "
ENDIF
ENDIF
IF(_I B_AND 8)
IF($MCS_TOOL_MCODE_FUNC_ON[3] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_ON[3]<<" "
ENDIF
ELSE
IF($MCS_TOOL_MCODE_FUNC_OFF[3] <> -1)
_CMD=_CMD<<"M="<<$MCS_TOOL_MCODE_FUNC_OFF[3]<<" "
ENDIF
ENDIF
IF(_CMD<>"")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Kommandostring 3: "<<_CMD)
ENDIF
EXECSTRING(_CMD)
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"CUST_TECHCYC(118)")
ENDIF
CUST_TECHCYC(118)
ENDIF
IF(_TF_NEU)
GETSELT(_TFA)
IF(_TFI<>_TFA)
IF(_TFI==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Folgewerkzeug: T0")
ENDIF
T0
ELSE
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Folgewerkzeug: T="<<_TF)
ENDIF
T=_TF
ENDIF
ENDIF
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ende Werkzeugwechselzyklus E_TFS (G[15]="<<$P_GG[15]<<")")
ENDIF
G[6]=_P6
G[29]=_P29
RET
S_GET_T_NR_A:
GETEXET(S_TI,,"S")
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Spindelwerkzeug: S_TI="<<S_TI)
ENDIF
S_GET_T_NR_E:
_FEHL1: STOPRE
N832101 SETAL(61216)
RET
_FEHL2: STOPRE
N832102 SETAL(61217)
RET
_FEHL3: STOPRE
N832103 SETAL(61218)
RET
_FEHL4: STOPRE
N832104 SETAL(61232)
RET
_FEHL5: STOPRE
N832105 SETAL(61343,_T)
RET
_FEHL6: STOPRE
N832106 SETAL(61287)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_TRACYL_SPF
PROC E_TRACYL(INT _BA,REAL _ZD,INT _ST,REAL _DD) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.02.00.084 ;DATE: 2017-10-24
;ShopMill: Cylinder Surface transformation
DEF INT _TRAFO_NR,_I
DEF REAL _FAK2
DEF INT _LOG,_LOG_ON
DEF STRING[40] _LOG_FILE
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_E_TRACYL_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,SPRINT(";! only for internal diagnostics ! %s.%s.%s %s:%s:%s",SUBSTR(""<<100+$A_DAY,1),SUBSTR(""<<100+$A_MONTH,1),""<<2000+$A_YEAR,SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1)))
WRITE(_LOG,_LOG_FILE,"E_TRACYL("<<_BA<<","<<_ZD<<","<<_ST<<","<<_DD<<")")
ENDIF
G4 F0
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(_BA _DEC1)
IF(NOT($MCS_FUNCTION_MASK_MILL B_AND 'B01')) GOTOF _FEHL1
_TRAFO_NR=((_BA MOD 1000)DIV 10)+1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TRAFO_NR="<<_TRAFO_NR)
ENDIF
IF(_TRAFO_NR>=1)AND(_TRAFO_NR<=99)
IF(_SC_TRACYL[_TRAFO_NR-1,0])
IF(_ST==1)
IF(_SC_TRACYL[_TRAFO_NR-1,0]<>512)AND(_SC_TRACYL[_TRAFO_NR-1,0]<>514)
_TRAFO_NR=0
ENDIF
ELSE
IF(_SC_TRACYL[_TRAFO_NR-1,0]<>513)AND(_SC_TRACYL[_TRAFO_NR-1,0]<>514)
_TRAFO_NR=0
ENDIF
ENDIF
IF(_TRAFO_NR>0)
IF((_BA _DEC1)>=2)
IF(_SC_TRACYL[_TRAFO_NR-1,1])
IF((_BA _DEC1)-1<>_SC_TRACYL[_TRAFO_NR-1,1])
_TRAFO_NR=0
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
_TRAFO_NR=0
ENDIF
ELSE
_TRAFO_NR=0
ENDIF
IF(_TRAFO_NR==0)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TRAFO_NR passt nicht")
ENDIF
_I=0
REPEAT
_I=_I+1
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"TRAFO "<<_I<<" pruefen")
ENDIF
IF(_SC_TRACYL[_I-1,0])
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  TRACYL")
ENDIF
IF(_ST==1)
IF(_SC_TRACYL[_I-1,0]==512)OR(_SC_TRACYL[_I-1,0]==514)
_TRAFO_NR=_I
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  ohne Nutwandkorrektur")
ENDIF
ENDIF
ELSE
IF(_SC_TRACYL[_I-1,0]==513)OR(_SC_TRACYL[_I-1,0]==514)
_TRAFO_NR=_I
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  mit Nutwandkorrektur")
ENDIF
ENDIF
ENDIF
IF(_TRAFO_NR>0)
IF((_BA _DEC1)>=2)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  Achse "<<(_BA _DEC1)-1)
ENDIF
IF(_SC_TRACYL[_I-1,1])
IF((_BA _DEC1)-1<>_SC_TRACYL[_I-1,1])
_TRAFO_NR=0
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"  -> passt nicht")
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
UNTIL(_TRAFO_NR>0)OR(_I>=99)
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"_TRAFO_NR neu="<<_TRAFO_NR)
ENDIF
ENDIF
IF(_TRAFO_NR==0)GOTOF _FEHL2
IF(NOT $P_TC)
IF(_SC_TRACYL[_TRAFO_NR-1,2]<>$P_GG[6]+16)GOTOF _FEHL3
ENDIF
F_SP_TRA(400)
IF(_SC_TRACYL[_TRAFO_NR-1,0]==514)
TRACYL(_ZD,_TRAFO_NR,_ST-1)
ELSE
TRACYL(_ZD,_TRAFO_NR)
ENDIF
IF(_ST==2)
_E_TRA_OFFN=-_DD*1/_FAK2
ELSE
_E_TRA_OFFN=0
ENDIF
_E_TRA_AKT=_ST
_F_TRA_D=_ZD
ELSE
TRAFOOF
_E_TRA_OFFN=0
_E_TRA_AKT=0
_F_TRA_D=0
ENDIF
OFFN=(_E_TS_OFFN+_E_TRA_OFFN)*_FAK2
RET
_FEHL1: STOPRE
N343001 SETAL(61850)
RET
_FEHL2: STOPRE
N343002 SETAL(61851,"TRACYL")
RET
_FEHL3: STOPRE
N343003 SETAL(61852,"TRACYL G"<<$P_GG[6]+16)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_TS_SPF
PROC E_TS(STRING[32] _T,STRING[32] _TF,INT _DD,REAL _S,INT _SA,REAL _DR,INT _DRA,INT _ST,INT _BA,INT _FR,REAL _FR_I,REAL _BETA,INT _BETAA,REAL _GAMA,REAL S_POLA,STRING[32] S_TRA) DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.93.00.00.009 ;DATE: 2019-11-05
;ShopMill: Tool/Spindle Speed
DEF INT S_MODE_BC,_SMODE
DEF REAL _FAK2
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
N10 E_TFS(_T,,_DD,,,,,1)
_E_XREF=_SC_NO_VAL _E_YREF=_SC_NO_VAL _E_ZREF=_SC_NO_VAL
IF(_ST==0)
_SMODE=2
E_SP_BC("0")
IF(_DRA)
_E_TS_OFFN=_DR*1/_FAK2
OFFN=(_E_TS_OFFN+_E_TRA_OFFN)*_FAK2
ENDIF
ELSE
_SMODE=1
IF($P_SUBPAR[12]<>0)AND(($P_SUBPAR[14]<>0)OR(_BA B_AND 'H00080000'))
F_SP_TRA(2040)
S_MODE_BC=_FR
S_MODE_BC=S_MODE_BC+10*((_BA B_AND 'H00100000')/'H00100000')
S_MODE_BC=S_MODE_BC+1000*(((_BA B_AND 'H00200000')/'H00200000')+1)
S_MODE_BC=S_MODE_BC+10000*((_BA B_AND 'H00010000')/'H00010000')
S_MODE_BC=S_MODE_BC+100000*((_BA B_AND 'H00060000')/'H00020000')
S_MODE_BC=S_MODE_BC+1000000*((_BA B_AND 'H00080000')/'H00080000')
E_SP_BC(S_TRA,_BETA,_GAMA,S_MODE_BC,_FR_I,S_POLA)
IF(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'HC000')=='H0000')
DIAM90
ELSE
IF(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'HC000')=='H8000')
DIAMON
ELSE
DIAMOF
ENDIF
ENDIF
ELSE
CYCLE800()
CUST_800(70)
G18
ENDIF
ENDIF
N100 E_TFS(_T,_TF,_DD,0,0,_S,_SA,1,0,_SMODE)
SBLON
G4 F0.0001
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_SPH_SPF
PROC E_MP_SPH(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_INCA,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_SETV6,REAL S_SETV7,REAL S_SETV8,REAL S_TNVL,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.11.00 ;DATE: 2011-03-09
;ShopMill: Measure part: Sphere
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_3SP(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_PRNUM,S_SETV,S_FA,S_TSA,S_STA1,S_INCA,S_SETV0,S_SETV1,S_SETV2,S_SETV3,S_SETV4,S_SETV5,S_SETV6,S_SETV7,S_SETV8,S_TNVL,S_NMSP,S_MCBIT,_DMODE,_AMODE)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_SL_SPF
PROC E_MP_SL(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure part: Slot
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N977 CYCLE977(S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_SETV0,S_SETV1,S_FA,S_TSA,S_STA1,S_ID,S_SZA,S_SZO,S_MA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_XM,S_YM,_DP)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
N1100 G0 AX[_ZZ]=_RP-_SD*_PMZ
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_POR_SPF
PROC E_MP_POR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.001 ;DATE: 2018-02-22
;ShopMill: Measure part: Rectangular pocket
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_SL(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_SETV0,S_SETV1,S_FA,S_TSA,S_STA1,S_ID,S_SZA,S_SZO,S_MA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_XM,S_YM,_DP)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_PL_SPF
PROC E_MP_PL(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_RA,INT S_PRNUM,REAL S_SETV,REAL S_STA1,REAL S_INCA,REAL S_FA,REAL S_TSA,INT S_MA,INT S_MD,REAL S_ID,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure part: Align plane
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N998 CYCLE998(S_MVAR,S_KNUM,S_RA,S_PRNUM,S_SETV,S_STA1,S_INCA,S_FA,S_TSA,S_MA,S_MD,S_ID,S_SETV0,S_SETV1,S_SETV2,S_SETV3,S_NMSP,S_MCBIT,_DMODE,_AMODE)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
N1100 G0 AX[_ZZ]=_RP-_SD*_PMZ
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_PIR_SPF
PROC E_MP_PIR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.001 ;DATE: 2018-02-22
;ShopMill: Measure part: Rectangular spigot
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_SL(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_SETV0,S_SETV1,S_FA,S_TSA,S_STA1,S_ID,S_SZA,S_SZO,S_MA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_XM,S_YM,_DP)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_PIC_SPF
PROC E_MP_PIC(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.001 ;DATE: 2018-02-22
;ShopMill: Measure part: Circular spigot
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_SL(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_SETV0,S_SETV1,S_FA,S_TSA,S_STA1,S_ID,S_SZA,S_SZO,S_MA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_XM,S_YM,_DP)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_LIN_SPF
PROC E_MP_LIN(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_RA,INT S_PRNUM,REAL S_SETV,REAL S_STA1,REAL S_INCA,REAL S_FA,REAL S_TSA,INT S_MA,INT S_MD,REAL S_ID,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.05.00 ;DATE: 2010-11-30
;ShopMill: Measure part: Align edge
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_PL(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_RA,S_PRNUM,S_SETV,S_STA1,S_INCA,S_FA,S_TSA,S_MA,S_MD,S_ID,S_SETV0,S_SETV1,S_SETV2,S_SETV3,S_NMSP,S_MCBIT,_DMODE,_AMODE)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_EDG_SPF
PROC E_MP_EDG(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,INT S_MA,INT S_MD,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure part: Set edge
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N978 CYCLE978(S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_FA,S_TSA,S_MA,S_MD,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,_DP)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
N1100 G0 AX[_ZZ]=_RP-_SD*_PMZ
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_DR_SPF
PROC E_MP_DR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.001 ;DATE: 2018-02-22
;ShopMill: Measure part: Hole
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_SL(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_SETV0,S_SETV1,S_FA,S_TSA,S_STA1,S_ID,S_SZA,S_SZO,S_MA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_XM,S_YM,_DP)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_CSO_SPF
PROC E_MP_CSO(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_CPA,REAL S_CPO,REAL S_STA1,REAL S_INCA,INT S_NMSP,STRING[32] S_TNAME,REAL S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_MPVAL1,REAL S_MPVAL2,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure part: Circle segment outside
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N979 CYCLE979(S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_FA,S_TSA,S_CPA,S_CPO,S_STA1,S_INCA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_MPVAL1,S_MPVAL2,_DP)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
N1100 G0 AX[_ZZ]=_RP-_SD*_PMZ
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_CSI_SPF
PROC E_MP_CSI(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_CPA,REAL S_CPO,REAL S_STA1,REAL S_INCA,INT S_NMSP,STRING[32] S_TNAME,REAL S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_MPVAL1,REAL S_MPVAL2,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.001 ;DATE: 2018-02-22
;ShopMill: Measure part: Circle segment inside
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_CSO(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_FA,S_TSA,S_CPA,S_CPO,S_STA1,S_INCA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_MPVAL1,S_MPVAL2,_DP)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_COR_SPF
PROC E_MP_COR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_SETV6,REAL S_SETV7,REAL S_SETV8,REAL S_SETV9,REAL S_STA1,REAL S_INCA,REAL S_ID,REAL S_FA,REAL S_TSA,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure part: Any corner
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N961 CYCLE961(S_MVAR,S_KNUM,S_PRNUM,S_SETV0,S_SETV1,S_SETV2,S_SETV3,S_SETV4,S_SETV5,S_SETV6,S_SETV7,S_SETV8,S_SETV9,S_STA1,S_INCA,S_ID,S_FA,S_TSA,S_NMSP,S_MCBIT,_DMODE,_AMODE)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
N1100 G0 AX[_ZZ]=_RP-_SD*_PMZ
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_C90_SPF
PROC E_MP_C90(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_SETV6,REAL S_SETV7,REAL S_SETV8,REAL S_SETV9,REAL S_STA1,REAL S_INCA,REAL S_ID,REAL S_FA,REAL S_TSA,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.01.00 ;DATE: 2010-08-04
;ShopMill: Measure part: Rectangular corner
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_COR(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_PRNUM,S_SETV0,S_SETV1,S_SETV2,S_SETV3,S_SETV4,S_SETV5,S_SETV6,S_SETV7,S_SETV8,S_SETV9,S_STA1,S_INCA,S_ID,S_FA,S_TSA,S_NMSP,S_MCBIT,_DMODE,_AMODE)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_BAR_SPF
PROC E_MP_BAR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.90.00.00.001 ;DATE: 2018-02-22
;ShopMill: Measure part: Bar
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MP_SL(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_KNUM,S_KNUM1,S_PRNUM,S_SETV,S_SETV0,S_SETV1,S_FA,S_TSA,S_STA1,S_ID,S_SZA,S_SZO,S_MA,S_NMSP,S_TNAME,S_DLNUM,S_TZL,S_TDIF,S_TUL,S_TLL,S_TMV,S_K,S_EVNUM,S_MCBIT,_DMODE,_AMODE,S_XM,S_YM,_DP)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MP_3SP_SPF
PROC E_MP_3SP(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_INCA,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_SETV6,REAL S_SETV7,REAL S_SETV8,REAL S_TNVL,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure part: 3 spheres
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N997 CYCLE997(S_MVAR,S_KNUM,S_PRNUM,S_SETV,S_FA,S_TSA,S_STA1,S_INCA,S_SETV0,S_SETV1,S_SETV2,S_SETV3,S_SETV4,S_SETV5,S_SETV6,S_SETV7,S_SETV8,S_TNVL,S_NMSP,S_MCBIT,_DMODE,_AMODE)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
N1100 G0 AX[_ZZ]=_RP-_SD*_PMZ
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MC_RSP_SPF
PROC E_MC_RSP(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,INT S_MA,INT S_MD,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-02-06
;ShopMill: Measure calibration: Part probe radius at sphere
DEF AXIS _XX,_YY,_ZZ
DEF INT _PMZ,_P29
DEF REAL _FAK1,_FAK2,_SD,_SC,_RP,_RTP
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF S_CALL_FROM_MA_JOG_STEP
_E_INIT=1
_SC=$SCS_MAJOG_SAFETY_CLEARANCE*_FAK1
_RP=$SCS_MAJOG_RELEASE_PLANE*_FAK1
ELSE
_SC=_E_SC*_FAK2
_RP=_E_RP*_FAK2
ENDIF
N10 E_TFS(_T,_TF,_DD)
E_SP_ED(_SD)
_PMZ=-1
IF($P_EP[_ZZ]*_FAK1<_RP-_SD*_PMZ)
N20 E_SP_RP(2,_RP-_SD*_PMZ,S_X,S_Y,_RP-_SD*_PMZ)
ELSE
N25 E_SP_RP(1,0,S_X,S_Y,_RP-_SD*_PMZ)
ENDIF
N30 G0 AX[_ZZ]=S_Z
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N976 CYCLE976(S_MVAR,S_PRNUM,S_SETV,S_SETV0,S_MA,S_MD,S_FA,S_TSA,S_VMS,S_STA1,S_NMSP,S_MCBIT,_DMODE,_AMODE)
ELSE
N1000 G0 AX[_XX]=S_X AX[_YY]=S_Y AX[_ZZ]=S_Z
ENDIF
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MC_RR_SPF
PROC E_MC_RR(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,INT S_MA,INT S_MD,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.06.00 ;DATE: 2010-12-07
;ShopMill: Measure calibration: Part probe radius in ring
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MC_RSP(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_PRNUM,S_SETV,S_SETV0,S_MA,S_MD,S_FA,S_TSA,S_VMS,S_STA1,S_NMSP,S_MCBIT,_DMODE,_AMODE)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MC_RC_SPF
PROC E_MC_RC(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,INT S_MA,INT S_MD,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.06.00 ;DATE: 2010-12-07
;ShopMill: Measure calibration: Part probe radius at edge
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MC_RSP(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_PRNUM,S_SETV,S_SETV0,S_MA,S_MD,S_FA,S_TSA,S_VMS,S_STA1,S_NMSP,S_MCBIT,_DMODE,_AMODE)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MC_MPT_SPF
PROC E_MC_MPT(STRING[32] _T,STRING[32] _TF,INT _DD,INT S_MVAR,INT S_KNUM,INT S_PRNUM,INT S_MA,INT S_MD,REAL S_ID,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_TZL,REAL S_TDIF,INT S_NMSP,REAL S_F1,REAL S_S1,REAL S_F2,REAL S_S2,REAL S_F3,REAL S_S3,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.92.00.00.001 ;DATE: 2018-11-21
;ShopMill: Measure calibration: Measure probe tool
DEF INT _M3_5,_P29
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
E_SP_BC("0")
_P29=$P_GG[29]
DIAMCYCOF
N10 E_TFS(_T,_TF,_DD,,,,,10)
_E_INIT=2
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
_M3_5=$P_SDIR[$P_MSNUM]
IF((S_MVAR _DEC1)==0)
IF(_M3_5==3)OR(_M3_5==4)
M5
ENDIF
ENDIF
IF((S_MVAR _DEC1)==2)
IF((_M3_5==3)OR(_M3_5==4))AND(_M3_5<>$SNS_MEA_CM_SPIND_ROT_DIR[0])
M5
ENDIF
ENDIF
IF($P_SUBPAR[16])
N9710 CYCLE971(S_MVAR,S_KNUM,S_PRNUM,S_MA,S_MD,S_ID,S_FA,S_TSA,S_VMS,S_TZL,S_TDIF,S_NMSP,S_F1,S_S1,S_F2,S_S2,S_F3,S_S3,S_EVNUM,S_MCBIT,_DMODE,_AMODE)
ELSE
N9711 CYCLE971(S_MVAR,S_KNUM,S_PRNUM,S_MA,S_MD,S_ID,S_FA,S_TSA,S_VMS,S_TZL,S_TDIF,S_NMSP,,,,,,,S_EVNUM,S_MCBIT,_DMODE,_AMODE)
ENDIF
ENDIF
G[29]=_P29
_E_S_LINE=0
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MC_LP_SPF
PROC E_MC_LP(STRING[32] _T,STRING[32] _TF,INT _DD,REAL S_X,REAL S_Y,REAL S_Z,INT S_MVAR,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,INT S_MA,INT S_MD,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.06.00 ;DATE: 2010-12-07
;ShopMill: Measure calibration: Part probe length on plane
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
E_MC_RSP(_T,_TF,_DD,S_X,S_Y,S_Z,S_MVAR,S_PRNUM,S_SETV,S_SETV0,S_MA,S_MD,S_FA,S_TSA,S_VMS,S_STA1,S_NMSP,S_MCBIT,_DMODE,_AMODE)
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MT_LR_SPF
PROC E_MT_LR(STRING[32] _T,STRING[32] _TF,INT _DD,INT S_MVAR,INT S_KNUM,INT S_PRNUM,INT S_MA,INT S_MD,REAL S_ID,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_TZL,REAL S_TDIF,INT S_NMSP,REAL S_F1,REAL S_S1,REAL S_F2,REAL S_S2,REAL S_F3,REAL S_S3,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.04.26.00 ;DATE: 2012-03-29
;ShopMill: Measure tool: Tool length
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF($P_SUBPAR[16])
E_MC_MPT(_T,_TF,_DD,S_MVAR,S_KNUM,S_PRNUM,S_MA,S_MD,S_ID,S_FA,S_TSA,S_VMS,S_TZL,S_TDIF,S_NMSP,S_F1,S_S1,S_F2,S_S2,S_F3,S_S3,S_EVNUM,S_MCBIT,_DMODE,_AMODE)
ELSE
E_MC_MPT(_T,_TF,_DD,S_MVAR,S_KNUM,S_PRNUM,S_MA,S_MD,S_ID,S_FA,S_TSA,S_VMS,S_TZL,S_TDIF,S_NMSP,,,,,,,S_EVNUM,S_MCBIT,_DMODE,_AMODE)
ENDIF
_RETS:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MT_TUR_SPF
PROC E_MT_TUR(STRING[32] _T,STRING[32] _TF,INT _DD,INT _BA,INT _FR,REAL _FR_I,REAL _BETA,INT _BETAA,REAL _GAMA,REAL S_POLA,REAL S_Z,REAL S_X,REAL S_Y,INT S_MVAR,INT S_KNUM,INT S_PRNUM,INT S_MA,INT S_MD,REAL S_ID,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,REAL S_CORA,REAL S_TZL,REAL S_TDIF,INT S_NMSP,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,STRING[32] S_TRA) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.67.00 ;DATE: 2016-09-23
;ShopMill: Measure tool: Turning tool
DEF AXIS _XX,_YY,_ZZ
DEF INT _P29,_SL,_P2,S_MVAR5,_WTYP,S_MODE_BC
DEF INT _SLT[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,2,1,4,3,7,6,5,8,9)
DEF INT _SLX[2,10]=set(0,1,2,3,4,5,6,7,8,9,0,4,3,2,1,5,8,7,6,9)
DEF INT S_MAT[10]=set(-1,4,5,5,4,4,0,5,1,5)
DEF REAL _FAK1,_FAK2
DEF FRAME _VECT
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'HC000')=='H0000')
DIAM90
ELSE
IF(($MC_TOOL_PARAMETER_DEF_MASK B_AND 'HC000')=='H8000')
DIAMON
ELSE
DIAMOF
ENDIF
ENDIF
_P29=$P_GG[29]
DIAMCYCOF
N10 G40 G90
F_SP_TRA(2040)
_ZZ=$P_AXN1 _XX=$P_AXN2 _YY=$P_AXN3
N20 E_TFS(_T,_TF,_DD,,,,,10)
_F_INIT=1
S_MODE_BC=_FR
S_MODE_BC=S_MODE_BC+10*((_BA B_AND 'H00100000')/'H00100000')
S_MODE_BC=S_MODE_BC+1000*(((_BA B_AND 'H00200000')/'H00200000')+1)
S_MODE_BC=S_MODE_BC+10000*((_BA B_AND 'H00010000')/'H00010000')
S_MODE_BC=S_MODE_BC+100000*((_BA B_AND 'H00060000')/'H00020000')
S_MODE_BC=S_MODE_BC+1000000*((_BA B_AND 'H00080000')/'H00080000')
N21 E_SP_BC(S_TRA,_BETA,_GAMA,S_MODE_BC,_FR_I,S_POLA)
_VECT=CTRANS(_XX,$P_TOOLBIN[1],_YY,$P_TOOLBIN[2],_ZZ,$P_TOOLBIN[3])
_VECT=INVFRAME(CTRANS(_XX,-$P_ACTFRAME[_XX,TR],_YY,-$P_ACTFRAME[_YY,TR],_ZZ,-$P_ACTFRAME[_ZZ,TR]):$P_ACTFRAME):_VECT
IF(ABS(_VECT[_ZZ,TR])>0.7)
S_MVAR5=0
ELSE
S_MVAR5=1
ENDIF
S_MVAR=S_MVAR-(S_MVAR _DEC5)*10000
S_MVAR=S_MVAR+S_MVAR5*10000
_SL=_SLT[$P_ACTFRAME[_ZZ,MI],$P_ADT[2]]
_SL=_SLX[$P_ACTFRAME[_XX,MI],_SL]
_P2=S_MAT[_SL]
_DMODE=_DMODE-(_DMODE _DEC1)
IF(NOT(($P_SEARCH)OR($AC_SERUPRO)))OR($MN_SIM_ENVIRONMENT B_AND 'B100')
N982 CYCLE982(S_MVAR,S_KNUM,S_PRNUM,S_MA,S_MD,S_ID,S_FA,S_TSA,S_VMS,S_STA1,S_CORA,S_TZL,S_TDIF,S_NMSP,S_EVNUM,S_MCBIT,_DMODE,_AMODE)
ENDIF
G[29]=_P29
_RETS:
_F_RELEAS=0
SBLON
RET

