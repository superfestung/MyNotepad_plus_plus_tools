;----------------------------------------------------------
;
;@(#)$program_version_id:V06.24.00.00 15/07/24 15:00:00, Measuring Cycles,
;
;----------------------------------------------------------
;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_MEACYC_SPF
PROC CUST_MEACYC(INT _MODE,REAL _SPOS_POS,INT _SPOS_MOD)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.001 ;DATE: 2023-06-20
;User-specific cycle - Comment in English
;
GROUP_BEGIN(1000, "DO_UPGRADE: Logic for compatibility if you upgrade software", 0,0)
  ;BEGIN_DO_UPGRADE
  ; logic for compatibility if you upgrade software
  IF (($P_PATH[$P_STACK]=="/_N_CST_DIR/") AND ($P_SUBPAR[1]==0))
    _MODE=_SC_CUST_MODE[0]
    _SPOS_POS=_SC_CUST_MODE[1] 
    _SPOS_MOD=_SC_CUST_MODE[2]
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1000,0)
;
IF _MODE==2 GOTOF _MEACYC_END  IF _MODE==3 GOTOF _MEACYC_MTOFFON IF _MODE==4 GOTOF _MEACYC_ERROR IF _MODE==5 GOTOF _MEACYC_ERROR_WP
;
GROUP_BEGIN(1000,"(Mode 1) Before the measuring cycle calls",0,0)
GROUP_BEGIN(1001, "CASE _OVI[2] OF ...", 0,0)
  CASE _OVI[2] OF 961 GOTOF _M961 971 GOTOF _M971 972 GOTOF _M972 973 GOTOF _M973 974 GOTOF _M974 976 GOTOF _M976 977 GOTOF _M977 978 GOTOF _M978 979 GOTOF _M979 982 GOTOF _M982 994 GOTOF _M994 995 GOTOF _M995 9961 GOTOF _M9961 996 GOTOF _M996 997 GOTOF _M997 998 GOTOF _M998
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"DO_UPGRADE: Logic for compatibility if you upgrade software",0,0)
  ;BEGIN_DO_UPGRADE
  IF ($P_PATH[$P_STACK]<>"/_N_CST_DIR/")
    _SC_CUST_MODE[0]=REP(0)
    _SC_CUST_MODE[0]=SET(_MODE,_SPOS_POS,_SPOS_MOD)
    N990 CALL "/_N_CST_DIR/_N_CUST_MEACYC_SPF"
    GOTOF _END_MEACYC
  ELSE
    N631001 SETAL(61019," _OVI[2] in CUST_MEACYC " ); Parameter _MODE=n incorrectly defined
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1001,0)
;
GROUP_BEGIN(1001,"_M976: Before workpiece measurement with cycle976(Calibrate workpiece probe)",0,0)
  _M976:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M961: Before workpiece measurement with cycle961(Measure corner automatically)",0,0)
  _M961:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M977: Before workpiece measurement with cycle977(Measure hole/shaft/groove/web)",0,0)
  _M977:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M978: Before workpiece measurement with cycle978(Measure surface)",0,0)  
  _M978:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M979: Before workpiece measurement with cycle979(Measure hole/shaft/groove/web at angle)",0,0) 
  _M979:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M995: Before positioning with cycle995",0,0) 
  _M995:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)  
	;
GROUP_BEGIN(1001,"_M9961: Before Kinematic measure with cycle996",0,0)  
  _M9961:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M996: Before Kinematic calculate with cycle996",0,0) 
  _M996:
  M17
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M997: Before workpiece measurement with cycle997(Measure sphere automatically)",0,0) 
  _M997:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M998: Before workpiece measurement with cycle998(Measure angle automatically)",0,0) 
  _M998:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M973: Before workpiece measurement with cycle973(Calibrate workpiece probe)",0,0) 
  _M973:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M974: Before workpiece measurement with cycle974(1-point measurement)",0,0) 
  _M974:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M994: Before workpiece measurement with cycle994(2-point measurement)",0,0) 
  _M994:
  GOTOF _AM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M971: Before tool measurement with cycle971(Measure tool/Calibrate tool probe)",0,0) 
  _M971:
  GOTOF _AM_T_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M972: Before tool measurement with cycle972(Measure tool/Calibrate tool probe)",0,0) 
  _M972:
  GOTOF _AM_T_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M982: Before tool measurement with cycle982(Measure tool/Calibrate tool probe)",0,0) 
  _M982:
  GOTOF _AM_T_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_AM_WP_MES: Before workpiece measurement",0,0)  
  _AM_WP_MES:
  ;
  ;
  ; User example for spindel positioning, if you do not have a coupling between the
  ; spindel and the coordinate system!
  ; If this lines are not necessary, the user can delete this example!
  ;
  ; cycle is calling from the AUTOMATIC-mode AND the spindel is positionable
  IF NOT(_OVI[14]) AND NOT(_SPOS_MOD)
    ;  no coupling between the spindel and the coordinate system! SD55740, Bit 1 = 0
    IF ($SCS_MEA_FUNCTION_MASK B_AND 'B10')==0
      SPOS=0
    ENDIF
  ENDIF
  M17
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_AM_T_MES: Before tool measurement",0,0)   
  _AM_T_MES:
  M17
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_MEACYC_END: (Mode 2) After measuring variants with several cycle calls",0,0)
  _MEACYC_END:
  ;
  IF (_OVI[14]>=100)AND(_OVI[14]<200) GOTOF _OVI14E ; Only for measuring in JOG/ShopMill after measuring variants with several cycle calls
  ;
GROUP_BEGIN(1001, "CASE _OVI[2] OF ...", 0,0)
  CASE _OVI[2] OF 961 GOTOF _ME961 971 GOTOF _ME971 972 GOTOF _ME972 973 GOTOF _ME973 974 GOTOF _ME974 976 GOTOF _ME976 977 GOTOF _ME977 978 GOTOF _ME978 979 GOTOF _ME979 982 GOTOF _ME982 994 GOTOF _ME994 995 GOTOF _ME995 9961 GOTOF _ME9961 996 GOTOF _ME996 997 GOTOF _ME997 998 GOTOF _ME998
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"DO_UPGRADE: Logic for compatibility if you upgrade software",0,0)
  ;BEGIN_DO_UPGRADE
  IF ($P_PATH[$P_STACK]<>"/_N_CST_DIR/")
    _SC_CUST_MODE[0]=REP(0)
    _SC_CUST_MODE[0]=SET(_MODE,_SPOS_POS,_SPOS_MOD)
    N990 CALL "/_N_CST_DIR/_N_CUST_MEACYC_SPF"
    GOTOF _END_MEACYC
  ELSE
     N631002 SETAL(61019," _OVI[2] in CUST_MEACYC " ); Parameter _MODE=n incorrectly defined
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME976: After workpiece measurement with cycle976(Calibrate workpiece probe)",0,0) 
  _ME976:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME961: After workpiece measurement with cycle961(Measure corner automatically)",0,0) 
  _ME961:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME977: After workpiece measurement with cycle977(Measure hole/shaft/groove/web)",0,0) 
  _ME977:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME978: After workpiece measurement with cycle978(Measure surface)",0,0) 
  _ME978:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME979: After workpiece measurement with cycle979(Measure hole/shaft/groove/web at angle)",0,0) 
  _ME979:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME995: After positioning with cycle995",0,0) 
  _ME995:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
	;
GROUP_BEGIN(1001,"_ME9961: After Kinematic measure with cycle996",0,0)   
  _ME9961:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME996: After Kinematic calculate with cycle996",0,0) 
  _ME996:
  M17
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME997: After workpiece measurement with cycle997(Measure sphere automatically)",0,0) 
  _ME997:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME998: After workpiece measurement with cycle998(Measure angle automatically)",0,0) 
  _ME998:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME973: After workpiece measurement with cycle973(Calibrate workpiece probe)",0,0) 
  _ME973:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME974: After workpiece measurement with cycle974(1-point measurement)",0,0) 
  _ME974:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME994: After workpiece measurement with cycle994(2-point measurement)",0,0) 
  _ME994:
  GOTOF _BM_WP_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME971: After tool measurement with cycle971(Measure tool/Calibrate tool probe)",0,0) 
  _ME971:
  GOTOF _BM_T_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME972: After tool measurement with cycle972(Measure tool/Calibrate tool probe)",0,0) 
  _ME972:
  GOTOF _BM_T_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_ME982: After tool measurement with cycle982(Measure tool/Calibrate tool probe)",0,0) 
  _ME982:
  GOTOF _BM_T_MES
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_BM_WP_MES: After workpiece measurement",0,0)   
  _BM_WP_MES:
  M17
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_BM_T_MES: After tool measurement",0,0)   
  _BM_T_MES:
  M17
GROUP_END(1001,0)
  ;
  _OVI14E:
  ; After completion of measuring variants with several cycle calls in measuring in JOG/ShopMill
GROUP_BEGIN(1001, "CASE _OVI[14] OF ...", 0,0)
  CASE _OVI[14] OF 100 GOTOF _M_DIS 103 GOTOF _M_HOL3 104 GOTOF _M_HOL4 105 GOTOF _M_COR3_OUT 106 GOTOF _M_COR4_OUT 110 GOTOF _M_ANG1 111 GOTOF _M_ANG1_SET 113 GOTOF _M_HOL3_ROT 114 GOTOF _M_HOL4_ROT 115 GOTOF _M_COR3_IN 116 GOTOF _M_COR4_IN 120 GOTOF _M_ANG2
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"DO_UPGRADE: Logic for compatibility if you upgrade software",0,0)
  ;BEGIN_DO_UPGRADE
  IF ($P_PATH[$P_STACK]<>"/_N_CST_DIR/")
    _SC_CUST_MODE[0]=REP(0)
    _SC_CUST_MODE[0]=SET(_MODE,_SPOS_POS,_SPOS_MOD)
    N990 CALL "/_N_CST_DIR/_N_CUST_MEACYC_SPF"
    GOTOF _END_MEACYC
  ELSE
     N631003 SETAL(61019," _OVI[14] in CUST_MEACYC " ) ; Parameter _MODE=n incorrectly defined
  ENDIF
  ;END_DO_UPGRADE
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_DIS: After measure distance with offset",0,0) 
  _M_DIS:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_ANG1: After align corner/Base rotation over 2 holes/Spigot with offset",0,0) 
  _M_ANG1:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_ANG1_SET: After base rotation over 2 holes/Set spigot with P1 with offset",0,0) 
  _M_ANG1_SET:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_ANG2: After align plane with offset",0,0) 
  _M_ANG2:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_HOL3: After center point calculation for 3 holes/spigot with offset",0,0) 
  _M_HOL3:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_HOL3_ROT: After center point calculation for 3 holes/spigot with angle offset",0,0) 
  _M_HOL3_ROT:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_HOL4: After calculation of intersection for 4 holes/spigot with offset",0,0) 
  _M_HOL4:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_HOL4_ROT: After calculation of intersection for 4 holes/spigot with angle offset",0,0) 
  _M_HOL4_ROT:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_COR3_OUT: After calculation of right-angled outside corner with offset",0,0) 
  _M_COR3_OUT:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_COR3_IN: After calculation of right-angled inside corner with offset",0,0) 
  _M_COR3_IN:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_COR4_OUT: After calculation of outside corner with offset",0,0) 
  _M_COR4_OUT:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_COR4_IN: After calculation of inside corner with offset",0,0) 
  _M_COR4_IN:
  GOTOF _M_CORREC
GROUP_END(1001,0)
  ;
GROUP_BEGIN(1001,"_M_CORREC: After completion of calculation in Measuring in JOG/ShopMill with offset",0,0)
  _M_CORREC:
  M17
GROUP_END(1001,0)
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_MEACYC_MTOFFON: (Mode 3) User-specific deactivation/activation of measuring probe",0,0) 
  _MEACYC_MTOFFON: IF _OVI[15] GOTOF _END_MEACYC
  ;
  ; NC-commands to disable the measuring probe,
  ; for example M-commands, H-commands or other user spezific commands.
  ; G4 Fxy
  ; 
  ; positioning the spindle
  CASE _SPOS_MOD OF 1 GOTOF _MOD_ACP 2 GOTOF _MOD_ACN 3 GOTOF _MOD_AC 4 GOTOF _MOD_IC 5 GOTOF _MOD_STD
  ;
  SUPA SPOS=DC(_SPOS_POS)
  GOTOF _MEACYC_MTON
  ;
  _MOD_ACP: SUPA SPOS=ACP(_SPOS_POS)
  GOTOF _MEACYC_MTON
  ;
  _MOD_ACN: SUPA SPOS=ACN(_SPOS_POS)
  GOTOF _MEACYC_MTON
  
  _MOD_AC: SUPA SPOS=AC(_SPOS_POS)
  GOTOF _MEACYC_MTON
  ;
  _MOD_IC: SUPA SPOS=IC(_SPOS_POS)
  GOTOF _MEACYC_MTON
  ;
  _MOD_STD: SUPA SPOS=_SPOS_POS
  ;
  _MEACYC_MTON:
  ; 
  ; G4 Fxy
  ; NC-commands to enable the measuring probe,
  ; for example M-commands, H-commands or other user spezific commands.
  GOTOF _END_MEACYC
GROUP_END(1000,0)
;
GROUP_BEGIN(1000,"_MEACYC_ERROR: (Mode 4) extended alarm reaction for tool measurement",0,0)
  _MEACYC_ERROR:
  ;
  ; NC-commands to run in the case of a alarm (only for tool measurement)
  ; for example M-commands, H-commands or other user spezific commands.
  ; _OVI[2]= CYCLE number (971 or 982)
  ; _OVI[9]= Alarm number
  ;          Possible:
  ;          61301 - "Probe not switching"
  ;          61303 - "Safety margin exceeded"
  ;          61306 - "Permissible measuring difference exceeded"
  ;          62320 - "Individual edges lie outside the dimensional difference" 
  ;
  ; Example:
  ; IF _OVI[2]==971
  ;   IF _OVI[9] == 61303 ;Safety margin exceeded
  ;     ...do something...
  ;   ENDIF
  ;   IF _OVI[9] == ...
  ;   ...
  ; ENDIF
  GOTOF _END_MEACYC
GROUP_END(1000,0)
GROUP_BEGIN(1000,"_MEACYC_ERROR_WP: (Mode 5) extended alarm reaction for workpiece measurement",0,0)
  _MEACYC_ERROR_WP:
  ;
  ; NC-commands to run in the case of a alarm (only for workpiece measurement)
  ; for example M-commands, H-commands or other user spezific commands.
  ; _OVI[2]= CYCLE number (961, 977, 978, 979, 997, 998, 974, 994)
  ; _OVI[9]= Alarm number
  ;          Possible:
  ;          61301 - "Probe not switching"
  ;          61303 - "Safety margin exceeded"
  ;          61304 - "Allowance"
  ;          61305 - "Dimension too small"
  ;          61306 - "Permissible measuring difference exceeded"
  ;
  ; Example:
  ; IF _OVI[2]==977
  ;   IF _OVI[9] == 61303 ;Safety margin exceeded
  ;     ...do something...
  ;   ENDIF
  ;   IF _OVI[9] == ...
  ;   ...
  ; ENDIF
  GOTOF _END_MEACYC
GROUP_END(1000,0)
_END_MEACYC: RET 

;$ACCESS=71771
;$PATH=/_N_CST_DIR/_N_CUST_MEAPROT_SPF
PROC CUST_MEAPROT(INT _MODE)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.21.00.00.001 ;DATE: 2022-07-20
;Cycle support HMIsl
;Report measuring results - input data
; Call parameter:
; ===============
; No.|Input mask |Cycle      |notation
;    |parameter  |parameter  |
;--------------------------------------
;  1                _MODE  :  0 = default - Standard protocol
;                             1 = Standard protocol (Siemens)
;                             2 = User protocol
;-----------------------------------------------------------------
DEF INT _I,_I1,_I2,_IDX1,_IDX2,_STRL,_STRL1,_STRL2,_STRL3,_RES,_RES_ROT,_RES_ANG                 
DEF REAL _VMS_RD,_REAL_VAL
DEF STRING[80] _BLKSP1
DEF STRING[12] _LEER12
DEF STRING[32] _TAB[10]=REP("")
DEF STRING[4] _LEER4,_MM
DEF STRING[80] _STR2
DEF STRING[200] _STR1
IF ($P_PROG[$P_STACK-1]=="_N_CYCLE157_SPF") GOTOF _MARK3
_LEER12="            "
_BLKSP1=""
S_TXT[63]=SPRINT("%S-%S-%S",""<<2000+$A_YEAR,SUBSTR(""<<100+$A_MONTH,1),SUBSTR(""<<100+$A_DAY,1))         
CASE (_MODE) OF 1 GOTOF _MARK1 2 GOTOF _MARK2 0 GOTOF _MARK1
;------------------------------------------------------------------
_MARK2: ; my standard protocol
;------------------------------------------------------------------
N10 GOTOF _MARK1 ; default settings
_MARK2_1:
N20 ; my changed settings:
; only different parameters declare
; copy relevant lines between N50 and N60
; insert these here between N30 and N40
; adapting input data
; select workpiece counter (if wanted):
; remove comment character ";" before N21 or N22
; counter after "<<" may be changed
_MARK2_2:
;N21 S_TXT[1]=<<R1
; counter reading from R1 (for example R1, programming required)
;N22 S_TXT[1]=<<$AC_SPECIAL_PARTS
; counter from $MC_PART_COUNTER Bit 12=1
_MARK2_3:
N30
N40
GOTOF _LAB1
RET
;------------------------------------------------------------------
_MARK1: ; Standard protocol default setting
;------------------------------------------------------------------
; input data (default values):
N50
_PROTFORM[1]=66  ; number of signs
_PROTFORM[5]=14  ; number of signs in column for values
S_TXT[1]=""       ; part counter (in standard empty)
S_TXT[4]="  "     ; space between columns (2 Blanks)
S_TXT[29]="#"    ; marking values with tolerance 
S_TXT[30]="!"    ; marking transgression of tolerance
S_TXT[31]=""      ; log block of correction values ("1"= no)
; Line 5-7, additional informations for header:
_HEADLINE[4]=""
_HEADLINE[5]=""
_HEADLINE[6]=""
N60
S_TXT[8]="3"      ; number of columns for values
; Column heading 1-4:
_TAB[0]="Results:"       ; column 1 (max. 12 signs)
_TAB[1]="Setpoint"       ; column 2 (max. 14 signs)
_TAB[2]="Measured"       ; column 3 (max. 14 signs)
_TAB[3]="Difference"     ; column 4 (max. 14 signs)
;------------------------------------------------------------------
; Action part (following): Do not change!
;------------------------------------------------------------------
IF _MODE==2 GOTOB _MARK2_1                                                
IF (_MODE==1) AND (_PROTFORM[0]==2)                                       
  REPEAT _MARK2_2 _MARK2_3                                                
ENDIF
GOTOF _LAB1
_MARK3: ; jumping in and out (CSV- data list)
_I=MATCH(SUBSTR(_HEADLINE[8],17)," /CYCLE")
IF _I<0
  _STR2=SUBSTR(_HEADLINE[8],17)
ELSE
  _STR2=SUBSTR(_HEADLINE[8],17,_I)
ENDIF
IF (STRLEN(_STR2)>32)
  _I=MATCH(_STR2," (")
  IF ((_I>32) OR (_I<0))
    _STR2=SUBSTR(_STR2,0,32)
  ELSE
    _STR2=SUBSTR(_STR2,0,_I)
  ENDIF
ENDIF
IF ($P_PROG[$P_STACK-1]=="_N_CYCLE157_SPF")
  IF ((_PROTFORM[0]==2) AND (_PROTNAME[1]<>"_N_E_PRT_JOG_SPF"))             
    
    
    
    
    _TAB[0]=SPRINT("%10S","Date")
    _TAB[1]=SPRINT("%8S","Time")
    _TAB[2]=SPRINT("%32S","Program")
    _TAB[3]=SPRINT("%14S","Workpiece no.")
    _TAB[4]=SPRINT("%14S","Testpoint")
    _TAB[5]=SPRINT("%5S","Plane")
    _TAB[6]=SPRINT("%14S","Probe no.")
    _TAB[7]=SPRINT("%14S","Cycle")
    _TAB[8]=SPRINT("%14S","S_MVAR")
    _TAB[9]=SPRINT("%32S","Measuring variant")
    _I=0 _PROTVAL[32]=""
    WHILE _I<10
      IF (_TAB[_I]<>"")
        IF (_PROTVAL[32]<>"")
          _PROTVAL[32]=_PROTVAL[32]<<";" 
        ENDIF    
        _PROTVAL[32]=_PROTVAL[32]<<_TAB[_I]
      ENDIF
      _I=_I+1
    ENDWHILE
    
    
    _TAB[0]=SPRINT("%10S",<<S_TXT[63])
    _TAB[1]=SPRINT("%8S",<<S_TXT[41])
    _TAB[2]=SPRINT("%32S",<<$P_PROG[0])
    _TAB[3]=SPRINT("%14S",<<S_TXT[1])
    _TAB[4]=SPRINT("%14S",<<S_TXT[2])
    _TAB[5]=SPRINT("%5S",<<"G"<<(NUMBER(S_TXT[25])+16))
    _TAB[6]=SPRINT("%14S",<<_OVI[5])
    _TAB[7]=SPRINT("%14S",<<_OVI[2])
    _TAB[8]=SPRINT("%14S",<<_OVI[3])
    
    _TAB[9]=SPRINT("%32S",<<_STR2)    
    _I=0 _PROTVAL[33]=""
    WHILE _I<10
      IF (_TAB[_I]<>"")
        IF (_PROTVAL[33]<>"")
          _PROTVAL[33]=_PROTVAL[33]<<";" 
        ENDIF    
        _PROTVAL[33]=_PROTVAL[33]<<_TAB[_I]
      ENDIF
      _I=_I+1
    ENDWHILE
  ENDIF
ENDIF
IF ($P_PROG[$P_STACK-1]=="_N_CYCLE157_SPF")
  IF (_PROTNAME[1]=="_N_E_PRT_JOG_SPF")                                   
    
    
    _TAB[0]=SPRINT("%10S","Date")
    _TAB[1]=SPRINT("%8S","Time")
    _TAB[2]=SPRINT("%32S","Program")
    _TAB[3]=SPRINT("%14S","Workpiece no.")
    _TAB[4]=SPRINT("%14S","Testpoint")
    _TAB[5]=SPRINT("%5S","Plane")
    _TAB[6]=SPRINT("%14S","Probe no.")
    _TAB[7]=SPRINT("%14S","Cycle")
    _TAB[8]=SPRINT("%14S","S_MVAR")
    _TAB[9]=SPRINT("%32S","Measuring variant")
    _I=0 _PROTVAL[32]=""
    WHILE _I<10
      IF (_TAB[_I]<>"")
        IF (_PROTVAL[32]<>"")
          _PROTVAL[32]=_PROTVAL[32]<<";" 
        ENDIF    
        _PROTVAL[32]=_PROTVAL[32]<<_TAB[_I]
      ENDIF
      _I=_I+1
    ENDWHILE
    
    _TAB[0]=SPRINT("%10S",<<S_TXT[63])
    _TAB[1]=SPRINT("%8S",<<S_TXT[41])
    _TAB[2]=SPRINT("%32S",<<_PROTNAME[1])                              
    _TAB[3]=SPRINT("%14S",<<S_TXT[1])
    _TAB[4]=SPRINT("%14S",<<S_TXT[2])
    _TAB[5]=SPRINT("%5S",<<"G"<<(NUMBER(S_TXT[25])+16))
    _TAB[6]=SPRINT("%14S",<<_OVI[5])
    _TAB[7]=SPRINT("%14S",<<_OVI[2])
    _TAB[8]=SPRINT("%14S",<<_OVI[3])
    
    _TAB[9]=SPRINT("%32S",<<_STR2)
    _I=0 _PROTVAL[33]=""
    WHILE _I<10
      IF (_TAB[_I]<>"")
        IF (_PROTVAL[33]<>"")
          _PROTVAL[33]=_PROTVAL[33]<<";" 
        ENDIF    
        _PROTVAL[33]=_PROTVAL[33]<<_TAB[_I]
      ENDIF
      _I=_I+1
    ENDWHILE
  ENDIF
ENDIF
RET
;------------------------------------------------------------------
_LAB1: ; detect number of signs for column 1
;------------------------------------------------------------------
IF (_PROTFORM[0]==2)  
  S_TXT[4]="; "  
ENDIF
_I=0
_I1=STRLEN(S_TXT[4])
IF (((NUMBER(S_TXT[8])+1)*_I1)+(NUMBER(S_TXT[8])*_PROTFORM[5])+4+12)>200
  SETAL(62307) 
  M0
  STOPRE
  GOTOB _MARK1
ENDIF
_I2=_PROTFORM[1]-4-((NUMBER(S_TXT[8])+1)*_I1)-(NUMBER(S_TXT[8])*_PROTFORM[5])
IF (_I2<12)
  IF (_PROTFORM[1]<=(200-(12-_I2)))
    SETAL(62311) 
    _PROTFORM[1]=_PROTFORM[1]+(12-_I2) 
    GOTOB _LAB1
  ELSE
    SETAL(62307) 
    M0
    STOPRE
    GOTOB _MARK1 
  ENDIF
ENDIF
IF (_I2<=30)
  S_TXT[9]=<<_I2
ELSE
  S_TXT[9]="30"
ENDIF
_I2=NUMBER(S_TXT[9])
_STRL=STRLEN(_TAB[0])
_I2=_I2-_STRL
WHILE _I<_I2
  _BLKSP1=_BLKSP1<<" "
  _I=_I+1
ENDWHILE
S_TXT[60]=_TAB[0]
_TAB[0]=_TAB[0]<<_BLKSP1
_HEADLINE[19]=_TAB[0]
;------------------------------------------------------------------
_LAB2: ; Formatting column headings
;------------------------------------------------------------------
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I=1
WHILE _I<=NUMBER(S_TXT[8])
  IF STRLEN(_TAB[_I])>0
    _TAB[_I]=SUBSTR(_TAB[_I],0,_PROTFORM[5])
  ENDIF
  _TAB[_I]=SPRINT(S_TXT[10],_TAB[_I])
  S_TXT[50+_I]=_TAB[_I]
  _I=_I+1  
ENDWHILE
_I=0
;------------------------------------------------------------------
_LAB3: ; Formatting "_HEADLINE[7]" and "test point counter"
;------------------------------------------------------------------
S_TXT[41]=SPRINT("%S:%S:%S",SUBSTR(""<<100+$A_HOUR,1),SUBSTR(""<<100+$A_MINUTE,1),SUBSTR(""<<100+$A_SECOND,1))         
IF (SUBSTR($P_PROG[$P_STACK-1],3,8)=="CYCLE160")  GOTOF _NEXT  
IF S_TXT[1]<>S_TXT[110]                    
  S_TXT[110]=S_TXT[1]
ENDIF
IF (S_TXT[2]=="")                         
  S_TXT[2]="0"
ENDIF
S_TXT[2]=<<(NUMBER(S_TXT[2])+1)
S_TXT[42]=S_TXT[2]<<"     "
S_TXT[42]=SUBSTR(S_TXT[42],0,5)
_I=_PROTFORM[1]-17-16-2  
_IDX1=MATCH(_HEADLINE[7],"<")                                           
_IDX2=MATCH(_HEADLINE[7],">")
IF (_IDX1>=0)AND(_IDX2>_IDX1)  
  _HEADLINE[7]=SUBSTR(_HEADLINE[7],1,_IDX2-1)  
  _STRL1=STRLEN(_HEADLINE[7])
  _STRL2=0                                                                           
  _STRL=_STRL1+_STRL2
  IF _STRL>_I
    _STRL3=_STRL-_I
    _HEADLINE[7]=SUBSTR(_HEADLINE[7],0,_STRL1-_STRL3)
  ENDIF
ELSE
  _HEADLINE[7]=""  
ENDIF
IF (_I>80)  
  S_TXT[34]="80"  
ELSE
  S_TXT[34]=<<_I
ENDIF
S_TXT[32]="_HEADLINE" S_TXT[33]="[7]"  
CYCLE153  
_STR1="_STR1="<<S_TXT[32]<<S_TXT[33]
EXECSTRING(_STR1)
_NEXT:
;------------------------------------------------------------------
_LAB4: ; Formatting column heading for measured values
;------------------------------------------------------------------
_PROTVAL[4]=_TAB[0]<<S_TXT[4]  
_I=1
WHILE _I<=NUMBER(S_TXT[8])
  _PROTVAL[4]=_PROTVAL[4]<<_TAB[_I]<<S_TXT[4]  
  _I=_I+1
ENDWHILE
_PROTVAL[4]=_PROTVAL[4]<<_LEER4
;------------------------------------------------------------------
_LAB5: ; Measuring system and format effectors for values
;------------------------------------------------------------------
IF (_OVI[2]==995) OR (_OVI[2]==996) OR (_OVI[2]==9960)
  IF($MN_SCALING_SYSTEM_IS_METRIC)
    S_TXT[3]="mm"
    _RES=$MNS_DISP_RES_MM    
  ELSE
    S_TXT[3]="in"
    _RES=$MNS_DISP_RES_INCH
  ENDIF
ELSE
  IF (($P_GG[13]==2) OR ($P_GG[13]==4))
    S_TXT[3]="mm"
    _RES=$MNS_DISP_RES_MM   
  ELSE
    S_TXT[3]="in"
    _RES=$MNS_DISP_RES_INCH
  ENDIF
ENDIF
S_TXT[64]=<<_RES
S_TXT[7]="%"<<_PROTFORM[5]<<"."<<_RES<<"F"
S_TXT[37]="%"<<_PROTFORM[5]-2<<"."<<_RES<<"F"
S_TXT[76]="["<<S_TXT[3]<<"]"
_RES_ROT=$MNS_DISP_RES_ROT_WO
_RES_ANG=$MNS_DISP_RES_ANGLE
IF _RES_ROT==0                      
  _RES_ROT=_RES_ANG
ENDIF
S_TXT[78]="%"<<_PROTFORM[5]<<"."<<_RES_ROT<<"F"  
S_TXT[79]="%"<<_PROTFORM[5]<<"."<<_RES_ANG<<"F"  
_IDX1=MATCH(_PROTVAL[29],",F")
IF _IDX1>0                                                 
  _IDX2=INDEX(SUBSTR(_PROTVAL[29],_IDX1+2),",")            
  IF _IDX2==-1                                             
    IF ISNUMBER(SUBSTR(_PROTVAL[29],_IDX1+2))==TRUE
      _REAL_VAL=NUMBER(SUBSTR(_PROTVAL[29],_IDX1+2))
    ELSE
      GOTOF _FEHL1                                         
    ENDIF
  ELSE                                                     
    IF ISNUMBER(SUBSTR(_PROTVAL[29],_IDX1+2,_IDX2))==TRUE
      _REAL_VAL=NUMBER(SUBSTR(_PROTVAL[29],_IDX1+2,_IDX2))
    ELSE
      GOTOF _FEHL1                                         
    ENDIF
  ENDIF
  IF (_OVI[2]==971) OR (_OVI[2]==973) OR (_OVI[2]==976) OR (_OVI[2]==982)            
    
    _VMS_RD=(ROUND(_REAL_VAL*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))                     
    _HEADLINE[12]="Measuring feed : "<<_VMS_RD<<" "<<_MM<<"/min"                     
  ENDIF
ENDIF
;------------------------------------------------------------------
_LAB6: ; limiting "_HEADLINE[4]-[6]"
;------------------------------------------------------------------
_I=4
WHILE _I<=6
  IF STRLEN(_HEADLINE[_I])>_PROTFORM[1]
    _HEADLINE[_I]=SUBSTR(_HEADLINE[_I],0,_PROTFORM[1])
  ENDIF
  _I=_I+1
ENDWHILE
;------------------------------------------------------------------
_LAB7: ; "_HEADLINE[9]" Measurement variant
;------------------------------------------------------------------
_HEADLINE[9]="Variant        : "<<S_TXT[68]<<"="<<ABS(_OVI[3])<<" "  
;------------------------------------------------------------------
_LAB8: ; "_PROTVAL[35],[36]" Format string
;------------------------------------------------------------------
IF (_PROTFORM[2]<>3)AND(_PROTFORM[0]==2) 
  S_TXT[75]=";"
ELSE
  _I=MATCH(_PROTNAME[0],".CSV")
  
  IF ((_PROTFORM[2]==3) AND (_I>0))  
    S_TXT[75]=";"
  ELSE
    S_TXT[75]=S_TXT[4]
  ENDIF
ENDIF
_I=0
_I=1 _PROTVAL[35]="" _PROTVAL[36]=""
_PROTVAL[35]=_PROTVAL[35]<<"%"<<NUMBER(S_TXT[9])<<"S"<<S_TXT[75]
_PROTVAL[36]=_PROTVAL[36]<<"%"<<NUMBER(S_TXT[9])<<"S"<<S_TXT[75]
WHILE (_I<=NUMBER(S_TXT[8]))
  _PROTVAL[35]=_PROTVAL[35]<<S_TXT[10]<<S_TXT[75]
  _PROTVAL[36]=_PROTVAL[36]<<S_TXT[7]<<S_TXT[75]
 _I=_I+1
ENDWHILE
_PROTVAL[35]=_PROTVAL[35]<<"%4S"
_PROTVAL[36]=_PROTVAL[36]<<"%3S"
RET
_FEHL1: STOPRE
 N615081 SETAL(61019,"(_PROTVAL[29]="<<_PROTVAL[29]<<")")                       
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE102_SPF
PROC CYCLE102(INT _SPEZ,INT _H_MN28)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.93.00.00.005 ;DATE: 2019-09-13
;Cycle : measure result display
DEF INT _II
DEF STRING[100] _MMCK="MCYCLES,LM,"
DEF STRING[50] _HELP1="WSMES"
DEF STRING[2] S_MMC_INFO=""
IF NOT($P_SIM)
IF $P_SEARCH OR $P_DRYRUN
RET
ENDIF
ENDIF
S_CHANNO_RESULT_DISPLAY=$P_CHANNO
IF _SPEZ==1 GOTOF _MEBA
N470 MMC("MCYCLES,PICTURE_OFF","A")
N471 STOPRE
RET
_MEBA:IF _MVAR DIV 100 MOD 10==0 GOTOF _MEBA1
_HELP1=_HELP1<<"NV"
_MEBA1:IF (_OVI[2]<>976)AND(_OVI[2]<>978) GOTOF _MEBA2 IF _MA<>3 GOTOF _MEBA2
_HELP1=_HELP1<<"A"
_MEBA2:IF NOT((_OVI[2]==977)AND(_MVAR MOD 10 >4)) GOTOF _MY1
_HELP1=_HELP1<<"_R"
_MY1:
CASE _OVI[2] OF 976 GOTOF _MZ976 977 GOTOF _MZ977 978 GOTOF _MZ978 979 GOTOF _MZ979 998 GOTOF _MZ998 971 GOTOF _MZ971 972 GOTOF _MZ972 973 GOTOF _MZ973 974 GOTOF _MZ974 994 GOTOF _MZ994 961 GOTOF _MZ961 982 GOTOF _MZ982 997 GOTOF _MZ997 995 GOTOF _MZ995 9960 GOTOF _MZ9960
_MZ976:IF (_MVAR<>0)AND(_MVAR<>10000)AND(_MVAR<>1000) GOTOF _C976E IF _MA<>3 GOTOF _C976E
_C976A_MP: _MMCK=_MMCK<<"MZBILD03.com,KALIBWSA"
GOTOF _PON
_C976E:IF _MVAR MOD 10 ==8 GOTOF _C976E_MP IF (_MVAR MOD 10==3)AND(_MVAR _DEC7 ==0) GOTOF _C976F_MP IF (_MVAR MOD 10==3)AND(_MVAR _DEC7 >0) GOTOF _C976G_MP
IF(_MVAR MOD 10==0)AND(_MVAR _DEC4 ==1)AND(_MVAR _DEC7 ==1)AND(_MA==1) GOTOF _C976E_MP IF(_MVAR MOD 10==0)AND(_MVAR _DEC4 ==1)AND(_MVAR _DEC7 ==1)AND(_MA==3) GOTOB _C976A_MP
_MMCK=_MMCK<<"MZBILD03.com,KALIBWSE"
GOTOF _PON
_C976E_MP:_MMCK=_MMCK<<"MZBILD03.com,KALIBWSE_MP"
GOTOF _PON
_C976F_MP:_MMCK=_MMCK<<"MZBILD03.com,kalibku1"
GOTOF _PON
_C976G_MP:IF(_H_MN28 _DEC2 ==1)AND(_MVAR _DEC7 <2)GOTOF _C976I_MP
_C976H_MP: _MMCK=_MMCK<<"MZBILD03.com,kalibku3"
GOTOF _PON
_C976I_MP: _MMCK=_MMCK<<"MZBILD03.com,kalibku2"
GOTOF _PON
_MZ977:_MMCK=_MMCK<<"MZBILD04.com,"<<_HELP1
GOTOF _PON
_MZ978:_MMCK=_MMCK<<"MZBILD04.com,"<<_HELP1
IF _MA<>3
_MMCK=_MMCK<<"A"
ENDIF
GOTOF _PON
_MZ979:_MMCK=_MMCK<<"MZBILD04.com,"<<_HELP1
GOTOF _PON
_MZ997: _MMCK=_MMCK<<"MZBILD04.com,"<<"wsmesnv_k"
GOTOF _PON
_MZ998:_MMCK=_MMCK<<"MZBILD01.com,WINKEL"
IF _MVAR MOD 10 == 6
_MMCK=_MMCK<<"_2"
ENDIF
GOTOF _PON
_MZ972:IF _MVAR==1 GOTOF _MZ9721
_MMCK=_MMCK<<"MZBILD02.com,KALIB_WZ"
GOTOF _PON
_MZ9721:_MMCK=_MMCK<<"MZBILD02.com,WZMESSEN"
GOTOF _PON
_MZ982: _II= _MVAR MOD 1000000
IF (_II<>0)AND(_II<>10)AND(_II<>100010)AND(_II<>100000) GOTOF _MZ9821
_MMCK=_MMCK<<"MZBILD02.com,KALIB_WZ"
GOTOF _PON
_MZ9821:_MMCK=_MMCK<<"MZBILD02.com,WZMESSEN_DF"
GOTOF _PON
_MZ971:IF ((_MVAR MOD 10)>0) GOTOF _MZ9711
_MMCK=_MMCK<<"MZBILD02.com,KALIB_FWZ"
GOTOF _PON
_MZ9711:
IF (_MVAR _DEC3)
_MMCK=_MMCK<<"MZBILD05.com,FWZ_MSCHN"
ELSE
_MMCK=_MMCK<<"MZBILD02.com,FWZMESSEN"
ENDIF
GOTOF _PON
_MZ973:
IF _MVAR _DEC7
_MMCK=_MMCK<<"MZBILD03.com,KALIBWSE1"
ELSE
_MMCK=_MMCK<<"MZBILD03.com,KALIBWSE"
ENDIF
GOTOF _PON
_MZ974:
IF(_MVAR==1000)AND(_KNUM==0)
_HELP1=_HELP1<<"NV"
ENDIF
_MMCK=_MMCK<<"MZBILD04.com,"<<_HELP1
_MMCK=_MMCK<<"A"
GOTOF _PON
_MZ994:
IF _KNUM==0
_HELP1=_HELP1<<"NV"
ENDIF
_MMCK=_MMCK<<"MZBILD04.com,"<<_HELP1
_MMCK=_MMCK<<"A"
GOTOF _PON
_MZ961:
IF (_MVAR==107)OR(_MVAR>=108)
_MMCK=_MMCK<<"MZBILD01.com,ECKE_EIN1"
ELSE
_MMCK=_MMCK<<"MZBILD01.com,ECKE_EIN2"
ENDIF
GOTOF _PON
_MZ995:_MMCK=_MMCK<<"MZBILD05.com,CYC995_SPI"
GOTOF _PON
_MZ9960:_MMCK=_MMCK<<"MZBILD06.com,CYC9960"
GOTOF _PON
N180 _PON:STOPRE
MMC(_MMCK,"A")
STOPRE
S_MMC_INFO = SUBSTR($P_MMCA,0,1)
IF S_MMC_INFO=="B"
G4 F1
GOTOB _PON
ENDIF
IF (_OVI[2]==9960) GOTOF _END
IF ((_H_MN28==1)AND((_OVI[9]>=62303)AND(_OVI[9]<=62306)))OR(_H_MN28>2)
N190 MSG("$83005")
N200 M0
N210 MSG("")
ENDIF
_END:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE109_SPF
PROC CYCLE109(VAR BOOL _INTERN[],VAR REAL _M_SPE[],VAR INT _M_N[]) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.014 ;DATE: 2024-07-04
DEF STRING[32] _H_CHSUM,_H_STR,_PN,_PN1
DEF REAL _ER,_H_ARRAY[6,30],_H_TMP[3]=SET(0,0,1),_CAL[13]
DEF INT _H_CHSERR,_PN_IDX,_PN_IDX2,_CL_IDX,_CTS,_CTZ,_H_MV,_H_EV,_TMP,_PRNUM_OLD, _TOOLTYP
IF _OVI[2]==972
_OVI[9]= 61342
N610901 SETAL(_OVI[9])
M17
ENDIF
_OVI[19]=0
IF($MA_CTRLOUT_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[1,AX1]==0)AND($MA_CTRLOUT_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[1,AX2]==0)AND($MA_CTRLOUT_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[1,AX3]==0)
_M_N[19]=1
ENDIF
_H_MV=$P_MSNUM
IF _H_MV
IF ($MA_NUM_ENCS[SPI(_H_MV)])AND($MA_CTRLOUT_TYPE[0,SPI(_H_MV)])AND(($MA_ENC_TYPE[0,SPI(_H_MV)])OR($MA_ENC_TYPE[1,SPI(_H_MV)]))
_TMP=1 _M_N[19]=_M_N[19]+100
ENDIF
ENDIF
IF _OVI[2]==997
FOR _H_EV=1 TO $P_STACK
_H_STR=SUBSTR($P_PROG[$P_STACK- _H_EV],8,4)
IF _H_STR=="9960"
_H_EV=$P_STACK _M_N[4]=NUMBER(_H_STR)
ENDIF
ENDFOR
ENDIF
_PN=SUBSTR($P_PROG[$P_STACK-2],3,7) _PN1=SUBSTR($P_PROG[$P_STACK-2],3,3)
IF ((_PN=="E_MS_CA")OR(_PN=="E_MS_PI")OR(_PN=="E_MS_HO")OR(_PN=="E_MT_CA")OR(_PN=="E_MT_LE")OR(_PN=="E_MT_RA")OR(_PN=="CYC_JMC")OR(_PN=="E_MS_SP")OR(_PN=="E_MS_PO")OR(_PN=="CYCLE14")OR(_PN=="F_MS_CA")OR(_PN=="F_MS_DI")OR(_OVI[2]==130))
IF _SMI_R[10]==93101.901
_SMI_R[10]=93101.901 _M_SPE[61]=_MEA_CORR_ANGLE[0]+_MEA_CORR_ANGLE[1]
ELSE
N610902 SETAL(61099," Messen in Auto oder MiJ unklar ")
ENDIF
ELSE
IF (_PN1=="F_M")
_SMI_R[10]=11
ELSE
_SMI_R[10]=0
ENDIF
_H_EV=2 _OVI[14]=0
CYCLE216(_CAL,_H_EV)
IF (_OVI[2]==973)OR(_OVI[2]==974)OR(_OVI[2]==994)OR(_OVI[2]==982)
_CTZ=1
ENDIF
_H_EV=0
IF ((NOT(_M_N[19])OR NOT(_H_MV))AND NOT(_TMP))OR(_CTZ==1)
_H_EV=1 _M_N[4]=_M_N[4]+10000
ENDIF
CUST_MEACYC(1,,_H_EV)
_M_SPE[61]=_MEA_CORR_ANGLE[0]+_MEA_CORR_ANGLE[1]
IF _CTZ
_M_SPE[61]=0
ENDIF
ENDIF
IF $SCS_MEA_RESULT_MRD
IF (_CHBIT[10] == -1)
IF S_PROTMEA_RESULT_DISPLAY == -9999
_M_N[28]= $SCS_MEA_RESULT_DISPLAY
ELSE
_M_N[28]= S_PROTMEA_RESULT_DISPLAY
ENDIF
ELSE
_M_N[28]=0
IF _CHBIT[10]==1
IF _CHBIT[11]==1
_M_N[28]= 3
ELSE
_M_N[28]= 1
IF _CHBIT[18]==1
_M_N[28]= 2
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
G290
D=$P_TOOL DL=$P_DLNO
ENDIF
_TOOLTYP=$P_ADT[1]
IF ($SNS_MEA_FUNCTION_MASK B_AND 'B100000') AND ((_TOOLTYP == 710) OR (_TOOLTYP == 712) OR (_TOOLTYP == 713) OR (_TOOLTYP == 714) OR (_TOOLTYP == 580))
_PRNUM_OLD = _PRNUM
_PRNUM = $TC_DPNT[$P_TOOLNO,$P_TOOL]
IF(_PRNUM == 0)
SETAL(61971,""<<$TC_TP2[$P_TOOLNO])
ENDIF
IF((_PRNUM < 0) OR (_PRNUM > 40))
SETAL(61019,"$TC_DPNT")
ENDIF
IF (_PRNUM_OLD _DEC3)
_PRNUM = _PRNUM + 100
ENDIF
ENDIF
_M_N[20]=SET(_NMSP,_PRNUM,_EVNUM,_M_N[23]+_K) _PN_IDX=(_M_N[21] MOD 100)-1 _PN_IDX2=_PN_IDX+1
IF((_OVI[2]==978)OR(_OVI[2]==998)OR(_OVI[2]==977)OR(_OVI[2]==979))AND(_MVAR _DEC5 ==1)
_PN_IDX=0 _PN_IDX2=0
ELSE
IF ((_PN_IDX < 0)OR(_PN_IDX > ($MNS_MEA_CAL_WP_NUM - 1)))AND(NOT(_OVI[2]==971))AND(NOT(_OVI[2]==982))
N610903 SETAL(61313)
ENDIF
ENDIF
IF (_OVI[2]==973)OR(_OVI[2]==976)
_M_SPE[30]=SET(_VMS,_FA,_TSA,_TZL,_TDIF,_TUL,_TLL,_TMV,_CORA)
ELSE
_M_SPE[30]=SET($SNS_MEA_WP_FEED[_PN_IDX],_FA,_TSA,_TZL,_TDIF,_TUL,_TLL,_TMV,_CORA)
IF((_OVI[2]==978)OR(_OVI[2]==998)OR(_OVI[2]==977)OR(_OVI[2]==979))AND(_MVAR _DEC5 ==1)
_M_SPE[30]=$SCS_MEA_FEED_MEASURE
ENDIF
ENDIF
_H_STR="_SPEED[5]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_SPEED")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"ed31471ac346228d6c17190ffdc4a98b"
FOR _CTS=0 TO 3
_H_ARRAY[0,_CTS]=_SPEED[_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610904 SETAL(61019," SGUD _SPEED ")
ENDIF
_M_SPE[48]=SET($SCS_MEA_FEED_RAPID_IN_PERCENT,$SCS_MEA_FEED_PLANE_VALUE,$SCS_MEA_FEED_FEEDAX_VALUE,$SCS_MEA_FEED_FAST_MEASURE)
IF _H_TMP[0]==1
FOR _CTS=0 TO 3
IF _H_ARRAY[0,_CTS]<> -0.777
_M_SPE[48+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
IF (_OVI[2]==971)OR(_OVI[2]==982)
_H_STR="_CBIT[16]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_CBIT")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"621f107a76ec6edd92846e9065090b36"
FOR _CTS=0 TO 16
_H_ARRAY[0,_CTS]=_CBIT[_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610905 SETAL(61019," SGUD _CBIT ")
ENDIF
_INTERN[20+00]=SET($SNS_MEA_FUNCTION_MASK B_AND 'B10000000000000000',$SNS_MEA_FUNCTION_MASK B_AND 'B100000000000000000')
_INTERN[20+6]=SET(0,$MNS_MEA_FUNCTION_MASK B_AND 'B10000000000000000',0,S_PROTSTAT[0])
IF _H_TMP[0]==1
FOR _CTS=0 TO 16
IF _H_ARRAY[0,_CTS]<> -1
_INTERN[20+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
_INTERN[20+11]=0
_H_STR="_CHBIT[29]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_CHBIT")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"cbe6d15e968dc8757f8e69ed60fa2450"
FOR _CTS=0 TO 23
_H_ARRAY[0,_CTS]=_CHBIT[_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610906 SETAL(61019," SGUD _CHBIT ")
ENDIF
_INTERN[40+00]=SET($MCS_MEA_FUNCTION_MASK B_AND 'B1',$MCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000',$SCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000')
_INTERN[40+15]=SET($SCS_MEA_FUNCTION_MASK B_AND 'B100000000000000000',$SCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000000',$SCS_MEA_FUNCTION_MASK B_AND 'B1000000000000000000')
_INTERN[40+22]=NOT($SNS_MEA_FUNCTION_MASK B_AND 'B10000000000000000000') _INTERN[40+23]=$MCS_MEA_FUNCTION_MASK B_AND 'B100000000000000000'
IF _H_TMP[0]==1
FOR _CTS=0 TO 23
IF _H_ARRAY[0,_CTS]<> -1
_INTERN[40+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
_PN_IDX=(_M_N[21] MOD 100)-1 _PN_IDX2=_PN_IDX+1
IF (_MVAR MOD 100)<10
IF (_PN_IDX < 0) OR (_PN_IDX > ($MNS_MEA_CAL_TP_NUM - 1))
N610922 SETAL(61313)
ENDIF
IF (_MVAR MOD 10) > 0
_M_SPE[30]=$SNS_MEA_TP_FEED[_PN_IDX]
ELSE
_M_SPE[30]=_VMS
ENDIF
_H_STR="_TP["<<$MNS_MEA_CAL_TP_NUM-1<<",9]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_TP") _M_SPE[20]=-777
IF ISVAR(_H_STR)
IF _H_CHSUM<>"01f18d552ad05bc2ace353bf48247f76"
_H_TMP[0]=1
ENDIF
ELSE
N610907 SETAL(61019," SGUD _TP ")
ENDIF
IF _H_TMP[0]==0
_TP[_PN_IDX,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_PN_IDX],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_PN_IDX],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_PN_IDX],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_PN_IDX])
_TP[_PN_IDX,4]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_PN_IDX],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_PN_IDX],$SNS_MEA_TP_EDGE_DISK_SIZE[_PN_IDX],$SNS_MEA_TP_AX_DIR_AUTO_CAL[_PN_IDX])
_TP[_PN_IDX,8]=SET($SNS_MEA_TP_TYPE[_PN_IDX],$SNS_MEA_TP_CAL_MEASURE_DEPTH[_PN_IDX])
ENDIF
IF _H_TMP[0]==1
FOR _CTS=0 TO 9
IF _TP[_PN_IDX,_CTS]<> -9999
_H_TMP[1]=_H_TMP[1]+_CTS*_H_TMP[2] _H_TMP[2]=_H_TMP[2]*10
ENDIF
ENDFOR
_H_TMP[0]=0 _M_SPE[20]=_H_TMP[1]
ENDIF
IF (($SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] ==10)OR($SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] ==11))AND(_OVI[2]==982)
_INTERN[40+1]=$SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] - 10
ENDIF
ELSE
IF (_PN_IDX < 0) OR (_PN_IDX > ($MNS_MEA_CAL_TPW_NUM - 1))
N610908 SETAL(61313)
ENDIF
IF (_MVAR MOD 10) > 0
_M_SPE[30]=$SNS_MEA_TPW_FEED[_PN_IDX]
ELSE
_M_SPE[30]=_VMS
ENDIF
_H_STR="_TPW["<<$MNS_MEA_CAL_TPW_NUM-1<<",9]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_TPW") _M_SPE[20]=-777
IF ISVAR(_H_STR)
IF _H_CHSUM<>"01f18d552ad05bc2ace353bf48247f76"
_H_TMP[0]=1
ENDIF
ELSE
N610909 SETAL(61019," SGUD _TPW ")
ENDIF
IF _H_TMP[0]==0
_TPW[_PN_IDX,0]=SET($SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_PN_IDX],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_PN_IDX],$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_PN_IDX],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_PN_IDX])
_TPW[_PN_IDX,4]=SET($SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_PN_IDX],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_PN_IDX],$SNS_MEA_TPW_EDGE_DISK_SIZE[_PN_IDX],$SNS_MEA_TPW_AX_DIR_AUTO_CAL[_PN_IDX])
_TPW[_PN_IDX,8]=SET($SNS_MEA_TPW_TYPE[_PN_IDX],$SNS_MEA_TPW_CAL_MEASURE_DEPTH[_PN_IDX])
ENDIF
IF _H_TMP[0]==1
FOR _CTS=0 TO 9
IF _TPW[_PN_IDX,_CTS]<> -9999
_H_TMP[1]=_H_TMP[1]+_CTS*_H_TMP[2] _H_TMP[2]=_H_TMP[2]*10
ENDIF
ENDFOR
_H_TMP[0]=0 _M_SPE[20]=_H_TMP[1]
ENDIF
IF (($SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] ==10)OR($SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] ==11))AND(_OVI[2]==982)
_INTERN[40+1]=$SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] - 10
ENDIF
ENDIF
IF _OVI[2]==971
IF _TP_CF==0
_M_N[26]=$SNS_MEA_T_PROBE_MANUFACTURER
ELSE
_M_N[26]=_TP_CF
ENDIF
IF _MT_COMP== -1
_M_N[25]=$SNS_MEA_T_PROBE_OFFSET
ELSE
_M_N[25]=_MT_COMP
ENDIF
_H_STR="_CM[8]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_CM")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"b3531234e2f0b0081e0793e4dbf7ffce"
FOR _CTS=0 TO 7
_H_ARRAY[0,_CTS]= _CM[_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610910 SETAL(61019," SGUD _CM ")
ENDIF
_M_SPE[40]=SET($SNS_MEA_CM_MAX_PERI_SPEED[0],$SNS_MEA_CM_MAX_REVOLUTIONS[0],$SNS_MEA_CM_MIN_FEEDRATE[0],$SNS_MEA_CM_MEASURING_ACCURACY[0])
_M_SPE[44]=SET($SNS_MEA_CM_MAX_FEEDRATE[0],$SNS_MEA_CM_SPIND_ROT_DIR[0],$SNS_MEA_CM_FEEDFACTOR_1[0],$SNS_MEA_CM_FEEDFACTOR_2[0])
IF _H_TMP[0]==1
FOR _CTS=0 TO 7
IF _H_ARRAY[0,_CTS]<> -0.777
_M_SPE[40+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
IF (_M_N[25]==2) AND(_MVAR==2)
IF _MA MOD 10==3
_H_STR="_MT_EC_L[5,4]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_MT_EC_L")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"828589ce9aea5e394d9007cdb0ce7874"
FOR _CTS=0 TO 4
FOR _CTZ=0 TO 5
_H_ARRAY[_CTZ,_CTS]=_MT_EC_L[_CTZ,_CTS]
ENDFOR
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610911 SETAL(61019,"SGUD _MT_EC_L")
ENDIF
_MT_EC_L[0,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_LEN1[0],$SNS_MEA_RESULT_OFFSET_TAB_LEN1[1],$SNS_MEA_RESULT_OFFSET_TAB_LEN1[2], $SNS_MEA_RESULT_OFFSET_TAB_LEN1[3],$SNS_MEA_RESULT_OFFSET_TAB_LEN1[4])
_MT_EC_L[1,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_LEN2[0],$SNS_MEA_RESULT_OFFSET_TAB_LEN2[1],$SNS_MEA_RESULT_OFFSET_TAB_LEN2[2], $SNS_MEA_RESULT_OFFSET_TAB_LEN2[3],$SNS_MEA_RESULT_OFFSET_TAB_LEN2[4])
_MT_EC_L[2,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_LEN3[0],$SNS_MEA_RESULT_OFFSET_TAB_LEN3[1],$SNS_MEA_RESULT_OFFSET_TAB_LEN3[2], $SNS_MEA_RESULT_OFFSET_TAB_LEN3[3],$SNS_MEA_RESULT_OFFSET_TAB_LEN3[4])
_MT_EC_L[3,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_LEN4[0],$SNS_MEA_RESULT_OFFSET_TAB_LEN4[1],$SNS_MEA_RESULT_OFFSET_TAB_LEN4[2], $SNS_MEA_RESULT_OFFSET_TAB_LEN4[3],$SNS_MEA_RESULT_OFFSET_TAB_LEN4[4])
_MT_EC_L[4,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_LEN5[0],$SNS_MEA_RESULT_OFFSET_TAB_LEN5[1],$SNS_MEA_RESULT_OFFSET_TAB_LEN5[2], $SNS_MEA_RESULT_OFFSET_TAB_LEN5[3],$SNS_MEA_RESULT_OFFSET_TAB_LEN5[4])
_MT_EC_L[5,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_LEN6[0],$SNS_MEA_RESULT_OFFSET_TAB_LEN6[1],$SNS_MEA_RESULT_OFFSET_TAB_LEN6[2], $SNS_MEA_RESULT_OFFSET_TAB_LEN6[3],$SNS_MEA_RESULT_OFFSET_TAB_LEN6[4])
IF _H_TMP[0]==1
FOR _CTS=0 TO 4
FOR _CTZ=0 TO 5
IF _H_ARRAY[_CTZ,_CTS]<> -0.777
_MT_EC_L[_CTZ,_CTS]=_H_ARRAY[_CTZ,_CTS]
ENDIF
ENDFOR
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
ELSE
_H_STR="_MT_EC_R[5,4]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_MT_EC_R")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"828589ce9aea5e394d9007cdb0ce7874"
FOR _CTS=0 TO 4
FOR _CTZ=0 TO 5
_H_ARRAY[_CTZ,_CTS]=_MT_EC_R[_CTZ,_CTS]
ENDFOR
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610912 SETAL(61019,"SGUD _MT_EC_R")
ENDIF
_MT_EC_R[0,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_RAD1[0],$SNS_MEA_RESULT_OFFSET_TAB_RAD1[1],$SNS_MEA_RESULT_OFFSET_TAB_RAD1[2], $SNS_MEA_RESULT_OFFSET_TAB_RAD1[3],$SNS_MEA_RESULT_OFFSET_TAB_RAD1[4])
_MT_EC_R[1,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_RAD2[0],$SNS_MEA_RESULT_OFFSET_TAB_RAD2[1],$SNS_MEA_RESULT_OFFSET_TAB_RAD2[2], $SNS_MEA_RESULT_OFFSET_TAB_RAD2[3],$SNS_MEA_RESULT_OFFSET_TAB_RAD2[4])
_MT_EC_R[2,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_RAD3[0],$SNS_MEA_RESULT_OFFSET_TAB_RAD3[1],$SNS_MEA_RESULT_OFFSET_TAB_RAD3[2], $SNS_MEA_RESULT_OFFSET_TAB_RAD3[3],$SNS_MEA_RESULT_OFFSET_TAB_RAD3[4])
_MT_EC_R[3,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_RAD4[0],$SNS_MEA_RESULT_OFFSET_TAB_RAD4[1],$SNS_MEA_RESULT_OFFSET_TAB_RAD4[2], $SNS_MEA_RESULT_OFFSET_TAB_RAD4[3],$SNS_MEA_RESULT_OFFSET_TAB_RAD4[4])
_MT_EC_R[4,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_RAD5[0],$SNS_MEA_RESULT_OFFSET_TAB_RAD5[1],$SNS_MEA_RESULT_OFFSET_TAB_RAD5[2], $SNS_MEA_RESULT_OFFSET_TAB_RAD5[3],$SNS_MEA_RESULT_OFFSET_TAB_RAD5[4])
_MT_EC_R[5,0]=SET($SNS_MEA_RESULT_OFFSET_TAB_RAD6[0],$SNS_MEA_RESULT_OFFSET_TAB_RAD6[1],$SNS_MEA_RESULT_OFFSET_TAB_RAD6[2], $SNS_MEA_RESULT_OFFSET_TAB_RAD6[3],$SNS_MEA_RESULT_OFFSET_TAB_RAD6[4])
IF _H_TMP[0]==1
FOR _CTS=0 TO 4
FOR _CTZ=0 TO 5
IF _H_ARRAY[_CTZ,_CTS]<> -0.777
_MT_EC_R[_CTZ,_CTS]=_H_ARRAY[_CTZ,_CTS]
ENDIF
ENDFOR
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
ENDIF
ENDIF
ELSE
IF _CM[8]== -0.777
_M_SPE[39]=$MNS_MEA_CM_ROT_AX_POS_TOL
ELSE
_M_SPE[39]=_CM[8]
ENDIF
ENDIF
IF _EVNUM > 0
IF _EVNUM > 9999
_H_MV =(_EVNUM DIV 10000)-1
IF ((_EVNUM MOD 10000)-1)>=0
_H_EV=(_EVNUM MOD 10000)-1
ENDIF
ELSE
_H_MV =_EVNUM-1 _H_EV=_H_MV
ENDIF
_H_STR="_EV["<<_H_EV<<"]"
IF ISVAR(_H_STR)
IF _EV[_H_EV]==99999
_EV[_H_EV]=$SCS_MEA_EMPIRIC_VALUE[_H_EV]
ENDIF
ELSE
N610913 SETAL(61019," SGUD _EV ")
ENDIF
ENDIF
ELSE
_H_STR="_CBIT[16]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_CBIT")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"621f107a76ec6edd92846e9065090b36"
FOR _CTS=0 TO 16
_H_ARRAY[0,_CTS]=_CBIT[_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610914 SETAL(61019," SGUD _CBIT ")
ENDIF
_INTERN[20+00]=SET($SNS_MEA_FUNCTION_MASK B_AND 'B1',$SNS_MEA_FUNCTION_MASK B_AND 'B10',$SNS_MEA_FUNCTION_MASK B_AND 'B100')
_INTERN[20+06]=SET(0,$MNS_MEA_FUNCTION_MASK B_AND 'B100',1,S_PROTSTAT[0])
_INTERN[20+14]=SET($MNS_MEA_FUNCTION_MASK B_AND 'B10',$SNS_MEA_FUNCTION_MASK B_AND 'B1000',$MNS_MEA_FUNCTION_MASK B_AND 'B1')
IF _H_TMP[0]==1
FOR _CTS=0 TO 16
IF _H_ARRAY[0,_CTS]<> -1
_INTERN[20+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
_INTERN[20+11]=0
_PN_IDX=29
_H_STR="_CHBIT[29]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_CHBIT")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"cbe6d15e968dc8757f8e69ed60fa2450"
FOR _CTS=0 TO _PN_IDX
_H_ARRAY[0,_CTS]=_CHBIT[_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610915 SETAL(61019," SGUD _CHBIT ")
ENDIF
_INTERN[40+00]=SET($MCS_MEA_FUNCTION_MASK B_AND 'B1',$MCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000',$SCS_MEA_FUNCTION_MASK B_AND 'B1')
_INTERN[40+13]=SET($SCS_MEA_FUNCTION_MASK B_AND 'B10',$SCS_MEA_FUNCTION_MASK B_AND 'B100',$SCS_MEA_FUNCTION_MASK B_AND 'B1000',$SCS_MEA_FUNCTION_MASK B_AND 'B100000')
_INTERN[40+17]=SET($SCS_MEA_FUNCTION_MASK B_AND 'B10000',$SCS_MEA_FUNCTION_MASK B_AND 'B1000000',$MCS_MEA_FUNCTION_MASK B_AND 'B10')
IF _H_TMP[0]==1
FOR _CTS=0 TO _PN_IDX
IF _H_ARRAY[0,_CTS]<> -1
_INTERN[40+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
_PN_IDX=(_M_N[21] MOD 100)-1 _PN_IDX2=_PN_IDX+1
IF (_OVI[2]==973)AND(_MVAR MOD 100000 <>0)
IF (_CALNUM < 1) OR (_CALNUM > $MNS_MEA_CAL_EDGE_NUM)
N610916 SETAL(61333)
ENDIF
_CL_IDX=(_CALNUM - 1) _H_STR="_KB["<<$MNS_MEA_CAL_EDGE_NUM-1<<",6]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_KB")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"192374929526ef19f8179070cb795f3b"
FOR _CTS=0 TO 6
_H_ARRAY[0,_CTS]= _KB[_CL_IDX,_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610917 SETAL(61019," SGUD _KB ")
ENDIF
_KB[_CL_IDX,0]=SET($SNS_MEA_CAL_EDGE_PLUS_DIR_AX2[_CL_IDX],$SNS_MEA_CAL_EDGE_MINUS_DIR_AX2[_CL_IDX],$SNS_MEA_CAL_EDGE_BASE_AX1[_CL_IDX],$SNS_MEA_CAL_EDGE_PLUS_DIR_AX1[_CL_IDX])
_KB[_CL_IDX,4]=SET($SNS_MEA_CAL_EDGE_MINUS_DIR_AX1[_CL_IDX],$SNS_MEA_CAL_EDGE_UPPER_AX2[_CL_IDX],$SNS_MEA_CAL_EDGE_BASE_AX2[_CL_IDX])
IF _H_TMP[0]==1
FOR _CTS=0 TO 6
IF _H_ARRAY[0,_CTS]<> -9999
_KB[_CL_IDX,_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
ENDIF
IF _EVNUM > 0
IF _EVNUM > 9999
_H_MV =(_EVNUM DIV 10000)-1
IF ((_EVNUM MOD 10000)-1)>=0
_H_EV=(_EVNUM MOD 10000)-1
ENDIF
ELSE
_H_MV =_EVNUM-1 _H_EV=_H_MV
ENDIF
_H_STR="_EV["<<_H_EV<<"]"
IF ISVAR(_H_STR)
IF _EV[_H_EV]==99999
_EV[_H_EV]=$SCS_MEA_EMPIRIC_VALUE[_H_EV]
ENDIF
ELSE
N610918 SETAL(61019," SGUD _EV ")
ENDIF
_H_STR="_MV["<<_H_MV<<"]"
IF ISVAR(_H_STR)
IF _MV[_H_MV]==99999
_MV[_H_MV]=$SCS_MEA_AVERAGE_VALUE[_H_MV]
ENDIF
ELSE
N610919 SETAL(61019," SGUD _MV ")
ENDIF
ENDIF
ENDIF
ELSE
IF (_OVI[2]==971)OR(_OVI[2]==982)
_INTERN[20+4]=SET(0,0,0) _INTERN[20+12]=0
_M_SPE[40]=SET($SNS_MEA_CM_MAX_PERI_SPEED[0],$SNS_MEA_CM_MAX_REVOLUTIONS[0],$SNS_MEA_CM_MIN_FEEDRATE[0],$SNS_MEA_CM_MEASURING_ACCURACY[0])
_M_SPE[44]=SET($SNS_MEA_CM_MAX_FEEDRATE[0],_MIJ_I[5],$SNS_MEA_CM_FEEDFACTOR_1[0],$SNS_MEA_CM_FEEDFACTOR_2[0])
_MT_EC_L[0,0]= REP(0) _MT_EC_R[0,0]= REP(0)
_M_N[20]=SET(1,_MIJ_I[2],0,1,0,$SNS_MEA_T_PROBE_OFFSET,$SNS_MEA_T_PROBE_MANUFACTURER) _M_N[28]=0
_INTERN[40+1]=$MCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000' _INTERN[40+15]=SET(1,$SCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000000',0,0,0,1)
_INTERN[40+22]=NOT($SNS_MEA_FUNCTION_MASK B_AND 'B10000000000000000000') _INTERN[40+23]=$MCS_MEA_FUNCTION_MASK B_AND 'B100000000000000000'
IF _OVI[2]==982
_PN_IDX=_M_N[21]-1
IF ($SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] ==10)OR($SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] ==11)
_INTERN[40+1]=$SNS_MEA_INPUT_TOOL_PROBE_SUB[_PN_IDX] - 10
ENDIF
_TP[_PN_IDX,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_PN_IDX],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_PN_IDX],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_PN_IDX],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_PN_IDX])
_TP[_PN_IDX,4]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_PN_IDX],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_PN_IDX])
_TP[_PN_IDX,6]=SET($SNS_MEA_TP_EDGE_DISK_SIZE[_PN_IDX],$SNS_MEA_TP_AX_DIR_AUTO_CAL[_PN_IDX],$SNS_MEA_TP_TYPE[_PN_IDX],$SNS_MEA_TP_CAL_MEASURE_DEPTH[_PN_IDX])
ENDIF
_INTERN[20+07]=$MNS_MEA_FUNCTION_MASK B_AND 'B10000000000000000'
ELSE
_TOOLTYP=$P_ADT[1]
IF ($SNS_MEA_FUNCTION_MASK B_AND 'B100000') AND ((_TOOLTYP == 710) OR (_TOOLTYP == 712) OR (_TOOLTYP == 713) OR (_TOOLTYP == 714) OR (_TOOLTYP == 580))
_PRNUM_OLD = _MIJ_I[1]
_MIJ_I[1] = $TC_DPNT[$P_TOOLNO,$P_TOOL]
IF(_MIJ_I[1] == 0)
SETAL(61971,""<<$TC_TP2[$P_TOOLNO])
ENDIF
IF((_MIJ_I[1] < 0) OR (_MIJ_I[1] > 40))
SETAL(61019,"$TC_DPNT")
ENDIF
IF (_PRNUM_OLD _DEC3)
_MIJ_I[1] = _MIJ_I[1] + 100
ENDIF
ENDIF
_M_N[20]=SET(1,_MIJ_I[1],0,1,0,0,0,0,0) _PN_IDX=(_M_N[21] MOD 100)-1 _PN_IDX2=_PN_IDX+1 _INTERN[20+4]=SET(0,0,0,0,1) _INTERN[20+13]=SET(0,$MNS_MEA_FUNCTION_MASK B_AND 'B10',$SNS_MEA_FUNCTION_MASK B_AND 'B1000',1)
_INTERN[40+0]=$MCS_MEA_FUNCTION_MASK B_AND 'B1' _INTERN[40+15]=SET(1,$SCS_MEA_FUNCTION_MASK B_AND 'B100000',$SCS_MEA_FUNCTION_MASK B_AND 'B10000',$SCS_MEA_FUNCTION_MASK B_AND 'B1000000',$MCS_MEA_FUNCTION_MASK B_AND 'B10')
IF (_CBIT[10] <> -1)
_INTERN[20+10]=_CBIT[10]
ENDIF
IF (_CHBIT[27] <> -1)
_INTERN[40+27]=_CHBIT[27]
ENDIF
IF (_OVI[2]==973)AND(_MVAR MOD 100000 <>0)
IF (_CALNUM < 1) OR (_CALNUM > $MNS_MEA_CAL_EDGE_NUM)
N610916 SETAL(61333)
ENDIF
_CL_IDX=(_CALNUM - 1) _H_STR="_KB["<<$MNS_MEA_CAL_EDGE_NUM-1<<",6]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_KB")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"192374929526ef19f8179070cb795f3b"
FOR _CTS=0 TO 6
_H_ARRAY[0,_CTS]= _KB[_CL_IDX,_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610917 SETAL(61019," SGUD _KB ")
ENDIF
_KB[_CL_IDX,0]=SET($SNS_MEA_CAL_EDGE_PLUS_DIR_AX2[_CL_IDX],$SNS_MEA_CAL_EDGE_MINUS_DIR_AX2[_CL_IDX],$SNS_MEA_CAL_EDGE_BASE_AX1[_CL_IDX],$SNS_MEA_CAL_EDGE_PLUS_DIR_AX1[_CL_IDX])
_KB[_CL_IDX,4]=SET($SNS_MEA_CAL_EDGE_MINUS_DIR_AX1[_CL_IDX],$SNS_MEA_CAL_EDGE_UPPER_AX2[_CL_IDX],$SNS_MEA_CAL_EDGE_BASE_AX2[_CL_IDX])
IF _H_TMP[0]==1
FOR _CTS=0 TO 6
IF _H_ARRAY[0,_CTS]<> -9999
_KB[_CL_IDX,_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
_H_TMP[0]=0 _H_ARRAY[0,0]=REP(0)
ENDIF
ENDIF
ENDIF
_INTERN[20+0]=SET(0,0,0) _INTERN[20+9]=0 _INTERN[20+11]=SET(0,0) _INTERN[40+2]=SET(1,0,0,0,0,0,0,0,0,0,0,1,$SCS_MEA_FUNCTION_MASK B_AND 'B100')
_M_SPE[30]=SET(_SMI_R[0],_SMI_R[1],_SMI_R[2],_SMI_R[3],_SMI_R[4],_SMI_R[5],_SMI_R[6],_SMI_R[7],_SMI_R[8])
_M_SPE[48+1]=SET($MNS_J_MEA_COLL_MONIT_FEED, $MNS_J_MEA_COLL_MONIT_POS_FEED, $SCS_MEA_FEED_FAST_MEASURE)
ENDIF
IF((ISFILE("/_N_CUS_DIR/_N_CYCLE110_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CYCLE110_SPF"))OR(ISFILE("/_N_CST_DIR/_N_CYCLE110_SPF")))AND($SNS_MEA_FUNCTION_MASK B_AND 'B1000000000000000'==0)
SETAL(61099,"Cycle110 exists multiple")
ENDIF
IF (_OVI[2]==971)OR(_OVI[2]==982)OR(((_OVI[2]==978)OR(_OVI[2]==998)OR(_OVI[2]==977)OR(_OVI[2]==979))AND(_MVAR _DEC5 ==1)) OR (_OVI[2]==130) GOTOF _NOWP
IF (_PN_IDX < 0) OR (_PN_IDX > ($MNS_MEA_CAL_WP_NUM - 1))
N610920 SETAL(61313)
ENDIF
_H_STR="_WP["<<$MNS_MEA_CAL_WP_NUM-1<<",10]" _H_CHSERR=CHECKSUM(_H_CHSUM,"_WP")
IF ISVAR(_H_STR)
IF _H_CHSUM<>"21311dd248b683d5a53f6448d9649cf7"
FOR _CTS=0 TO 10
_H_ARRAY[0,_CTS]= _WP[_PN_IDX,_CTS]
ENDFOR
_H_TMP[0]=1
ENDIF
ELSE
N610921 SETAL(61019," SGUD _WP ")
ENDIF
_M_SPE[20]=SET($SNS_MEA_WP_BALL_DIAM[_PN_IDX],$SNS_MEA_WP_TRIG_MINUS_DIR_AX1[_PN_IDX],$SNS_MEA_WP_TRIG_PLUS_DIR_AX1[_PN_IDX],$SNS_MEA_WP_TRIG_MINUS_DIR_AX2[_PN_IDX])
_M_SPE[24]=SET($SNS_MEA_WP_TRIG_PLUS_DIR_AX2[_PN_IDX],$SNS_MEA_WP_TRIG_MINUS_DIR_AX3[_PN_IDX],$SNS_MEA_WP_TRIG_PLUS_DIR_AX3[_PN_IDX],$SNS_MEA_WP_POS_DEV_AX1[_PN_IDX]) _M_SPE[28]=$SNS_MEA_WP_POS_DEV_AX2[_PN_IDX]
_M_SPE[53]=SET($SNS_MEA_WP_STATUS_RT[_PN_IDX],$SNS_MEA_WP_STATUS_GEN[_PN_IDX])
IF _H_TMP[0]==1
FOR _CTS=0 TO 8
IF _H_ARRAY[0,_CTS]<> -9999
_M_SPE[20+_CTS]= _H_ARRAY[0,_CTS]
ENDIF
ENDFOR
IF _H_ARRAY[0,9] <> -9999
_M_SPE[53]=_H_ARRAY[0,9]
ENDIF
IF _H_ARRAY[0,10] <> -9999
_M_SPE[54]=_H_ARRAY[0,10]
ENDIF
_H_TMP[0]=0
IF (_OVI[2]==973)OR(_OVI[2]==976)
_WP[0,0]=REP(-9999)
ENDIF
ENDIF
_NOWP:
IF _INTERN[40+27]
_M_SPE[61]=_MEA_CORR_ANGLE[0]
ENDIF
IF (NOT(_M_N[18] _DEC3))AND(_M_N[18] _DEC1)
_INTERN[40+2]=0 _M_N[28]=0 _KNUM=0 _M_N[18]=1
ELSE
IF (_M_N[18] _DEC3 ==3)
_INTERN[40+2]=0 _M_N[18]=1
ENDIF
ENDIF
_INTERN[64]=$SNS_MEA_ALARM_MASK B_AND 'B100'
IF (($MNS_MEA_FUNCTION_MASK B_AND 'B100000000000000' == 16384) AND ((_OVI[2]==977) OR (_OVI[2]==978) OR (_OVI[2]==998) OR (_OVI[2]==961) OR (_OVI[2]==979) OR (_OVI[2]==976)))
_INTERN[68]=1
_M_SPE[64]=SET($SNS_MEA_WP_BALL_DIAM[_PN_IDX2],$SNS_MEA_WP_TRIG_MINUS_DIR_AX1[_PN_IDX2],$SNS_MEA_WP_TRIG_PLUS_DIR_AX1[_PN_IDX2],$SNS_MEA_WP_TRIG_MINUS_DIR_AX2[_PN_IDX2])
_M_SPE[68]=SET($SNS_MEA_WP_TRIG_PLUS_DIR_AX2[_PN_IDX2],$SNS_MEA_WP_TRIG_MINUS_DIR_AX3[_PN_IDX2],$SNS_MEA_WP_TRIG_PLUS_DIR_AX3[_PN_IDX2],$SNS_MEA_WP_POS_DEV_AX1[_PN_IDX2])
_M_SPE[72]=SET($SNS_MEA_WP_POS_DEV_AX2[_PN_IDX2],$SNS_MEA_WP_STATUS_RT[_PN_IDX2],$SNS_MEA_WP_STATUS_GEN[_PN_IDX2])
ELSE
_INTERN[68]=0
ENDIF
IF NOT((_SMI_R[10] == 93101.901) OR (_SMI_R[10] == 2))
IF ($SNS_MEA_ALARM_MASK B_AND 'B10000' == 'H10')
_INTERN[12]=1
ENDIF
IF ($SNS_MEA_ALARM_MASK B_AND 'B100000' == 'H20')
_INTERN[13]=1
ENDIF
IF ($SNS_MEA_ALARM_MASK B_AND 'B10000000000000000' == 'H10000')
_INTERN[4]=1
ENDIF
IF ($SNS_MEA_ALARM_MASK B_AND 'B100000000000000000' == 'H20000')
_INTERN[5]=1
ENDIF
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE111_SPF
PROC CYCLE111(VAR AXIS _MAV, VAR AXIS _XX,VAR AXIS _YY,VAR AXIS _ZZ,VAR REAL _M_SPE[], VAR REAL _M_ME[], VAR INT _M_N[],VAR INT _ALARM,VAR BOOL _M_ZUST[],VAR BOOL _VB[],VAR BOOL _INTERN[],VAR REAL _DAT[3,6],VAR REAL _KF[3,3],REAL _ANG2) ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.010 ;DATE: 2023-12-08
N100 DEF INT _SPOS_MOD=0,_Z=0,_AXIND,_H_AXIND,_H=1,_H1[3],_H2=1,_H3,_SIMAL,_MESRI,_MD13230,_MD51740_6,_RETV,_I
N101 DEF REAL _HR,_HR1,_INC=1000,_DELTA=1,_M_POS
N102 DEF REAL _SDIF,_SIMPOS,_H_SPE8,_SD55619,_MD10200_MM
N105 DEF REAL _STARTPOS[3],_MOVDIST[3],_DLIMIT[5],_MAXDIST[3],_DISTUEW
N106 DEF INT _MODE_2MESS=1
N107 DEF STRING[18] _CALCPOS_AX
_H1[0]=REP(1)
IF _M_N[18]
_SDIF=$SCS_MEA_SIM_MEASURE_DIFF _MESRI=1 _SIMAL=0
IF (_M_SPE[9]<_M_ME[11])
_MESRI=-1
ENDIF
IF (ABS(_SDIF)>ABS(_M_SPE[3]))
_SIMAL=61301
_SIMPOS=_M_SPE[9]
ELSE
_SIMPOS=_M_ME[11]+_SDIF
IF ((_OVI[2]==973) OR(_OVI[2]==976) OR (_OVI[2]==977) AND (_M_ZUST[4]==1) OR (_OVI[2]==994) OR (_OVI[2]==997))
_SIMPOS=_M_ME[11]-_SDIF*_MESRI
ENDIF
IF ((_OVI[2]==977) AND (_M_ZUST[4]==0))
_SIMPOS=_M_ME[11]+_SDIF*_MESRI
ENDIF
ENDIF
ENDIF
IF (_MAV == _XX)
_AXIND=0
ELSE
IF (_MAV == _YY)
_AXIND=1
ELSE
_AXIND=2
ENDIF
ENDIF
IF (_INTERN[0+_AXIND*8])
IF ((_INTERN[1+_AXIND*8] == 0) AND ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000'))
_H=2
ENDIF
IF (_INTERN[1+_AXIND*8] == 1)
_H2=2
ENDIF
ENDIF
IF (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]<>3))OR(($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==4)) GOTOF _M03
_INC=1000*$MN_SCALING_VALUE_INCH _DELTA=1/$MN_SCALING_VALUE_INCH
_M03: IF _M_ZUST[14] OR _M_ZUST[15] GOTOF _MT4 IF _VB[3]==0 GOTOF _MT4 IF _VB[2]==0 GOTOF _MT3
IF _VB[31]==0 GOTOF _MST
_M_SPE[8]=_KF[2,1] + _KF[2,2] _SPOS_MOD=0
IF((_INTERN[18])AND(_MAV==_ZZ)AND(_VB[51])) GOTOF _MT4 IF ((_INTERN[18])AND(_MAV==_ZZ)) GOTOF _MT1 IF _M_ZUST[0] GOTOF _MT1
_HR=180 _SPOS_MOD=1
IF _INTERN[37]
_SPOS_MOD=2
ENDIF
IF _M_ZUST[1] GOTOF _MT1
_HR=90 _SPOS_MOD=0
IF _M_ZUST[2] GOTOF _MT1
IF((_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND (_OVI[2] == 961)) OR (_INTERN[37])
_HR=270 _SPOS_MOD=0
ELSE
_HR=270 _SPOS_MOD=2
ENDIF
GOTOF _MT1
_MST:_M_SPE[8]=360-(_KF[2,1] + _KF[2,2]) _SPOS_MOD=0
IF ((_INTERN[18])AND(_MAV==_ZZ)) GOTOF _MT1 IF _M_ZUST[0] GOTOF _MT1
_HR=180 _SPOS_MOD=1
IF _INTERN[37]
_SPOS_MOD=2
ENDIF
IF _M_ZUST[1] GOTOF _MT1
_HR=270 _SPOS_MOD=0
IF _M_ZUST[2] GOTOF _MT1
IF((_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND (_OVI[2]==961)) OR (_INTERN[37])
_HR=90 _SPOS_MOD=0
ELSE
_HR=90 _SPOS_MOD=2
ENDIF
_MT1: _M_SPE[8]=_M_SPE[8]+_HR+_ANG2
IF (_M_ZUST[4]==0)OR((_OVI[2]==997)AND(_M_ZUST[4])AND(_INTERN[69])) GOTOF _MT2
_M_SPE[8]=_M_SPE[8]+180
_MT2:_M_SPE[8]=_M_SPE[8]-TRUNC(_M_SPE[8]/ 360)*360
IF _VB[45] GOTOF _MT3 IF NOT _INTERN[20+8] GOTOF _MT3
_M_SPE[8]=_M_SPE[8]+_M_SPE[38]
_M_SPE[8]=_M_SPE[8]-TRUNC(_M_SPE[8]/ 360)*360
_MT3:_M_SPE[8]=((_M_SPE[8] MOD 360) + 360) MOD 360
CASE _SPOS_MOD OF 2 GOTOF _MOD_ACN 1 GOTOF _MOD_ACP
IF (_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND (_OVI[2] == 961)
_H_SPE8=(((_M_SPE[8]+_M_SPE[47]) MOD 360) + 360) MOD 360
IF _INTERN[40+18]
N150 CUST_MEACYC(3,_H_SPE8,0)
ELSE
N151 SUPA SPOS=DC(_H_SPE8)
ENDIF
ELSE
IF NOT((_VB[55]==1)AND(_M_ZUST[4]==1))
IF _INTERN[40+18]
N152 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N153 SUPA SPOS=DC(_M_SPE[8])
ENDIF
ENDIF
ENDIF
GOTOF _MT4
N156 _MOD_ACN:
IF _INTERN[40+18]
N154 CUST_MEACYC(3,_M_SPE[8],2)
ELSE
N155 SUPA SPOS=ACN(_M_SPE[8])
ENDIF
GOTOF _MT4
N157 _MOD_ACP:
IF _INTERN[40+18]
N156 CUST_MEACYC(3,_M_SPE[8],1)
ELSE
N157 SUPA SPOS=ACP(_M_SPE[8])
ENDIF
_MT4:IF _INTERN[3] OR _INTERN[11] OR _INTERN[19] OR _INTERN[64] GOTOF _MT4A
IF ((_OVI[2]== 978)OR(_OVI[2]== 977)OR(_OVI[2]== 997))AND(_MVAR _DEC5 >0)
IF (ABS(_M_SPE[27])) >= (ABS(_M_SPE[28]))
_HR1=(ABS(_M_SPE[27]))*2
ELSE
_HR1=(ABS(_M_SPE[28]))*2
ENDIF
ENDIF
_HR1=_HR1 + 0.0005/_M_SPE[52]
_MOVDIST[0]=SET(0,0,0) _MD10200_MM=$MN_INT_INCR_PER_MM
IF _VB[32]
_STARTPOS[0]=(ROUND(_M_SPE[5]*_MD10200_MM)/_MD10200_MM)
_STARTPOS[1]=(ROUND(_M_SPE[6]*_MD10200_MM)/_MD10200_MM)
_STARTPOS[2]=(ROUND(_M_SPE[7]*_MD10200_MM)/_MD10200_MM)
_H_AXIND=_AXIND
ELSE
IF _VB[33]
IF (_INTERN[1])
_H1[0]=2
ENDIF
IF (_INTERN[9])
_H1[1]=2
ENDIF
IF (_INTERN[17])
_H1[2]=2
ENDIF
_STARTPOS[0]=((ROUND(_M_SPE[6]*_MD10200_MM)/_MD10200_MM)/_H1[1])
_STARTPOS[1]=((ROUND(_M_SPE[7]*_MD10200_MM)/_MD10200_MM)/_H1[2])
_STARTPOS[2]=((ROUND(_M_SPE[5]*_MD10200_MM)/_MD10200_MM)/_H1[0])
IF _AXIND
_H_AXIND= _AXIND - 1
ELSE
_H_AXIND= 2
ENDIF
ELSE
IF _VB[34]
_STARTPOS[0]=(ROUND(_M_SPE[7]*_MD10200_MM)/_MD10200_MM)
_STARTPOS[1]=(ROUND(_M_SPE[5]*_MD10200_MM)/_MD10200_MM)
_STARTPOS[2]=(ROUND(_M_SPE[6]*_MD10200_MM)/_MD10200_MM)
IF _AXIND == 2
_H_AXIND= 0
ELSE
_H_AXIND= _AXIND + 1
ENDIF
ENDIF
ENDIF
ENDIF
IF _M_ZUST[4] OR _M_ZUST[15]
_MOVDIST[_H_AXIND]=((_M_SPE[10]/_H2)-_STARTPOS[_H_AXIND])*_M_SPE[29]
_DLIMIT[_H_AXIND]=0
FOR _I=0 TO 2
_STARTPOS[_I]= _STARTPOS[_I]*_M_SPE[29]
ENDFOR
_RETV=CALCPOSI(_STARTPOS,_MOVDIST,_DLIMIT,_MAXDIST,0,1)
_MAXDIST[_H_AXIND]=(ROUND(_MAXDIST[_H_AXIND]*_MD10200_MM)/_MD10200_MM)/_M_SPE[29]
_MOVDIST[_H_AXIND] = _MOVDIST[_H_AXIND]/_M_SPE[29]
FOR _I=0 TO 2
_STARTPOS[_I]= _STARTPOS[_I]/_M_SPE[29]
ENDFOR
IF _RETV > 0
_M_ZUST[13]=1
IF _RETV _DEC3 == 1
IF(_SMI_R[10] ==93101.901)OR(_SMI_R[10] ==2)
_M_SPE[10]=_STARTPOS[_H_AXIND] + _MAXDIST[_H_AXIND]
ELSE
IF _M_SPE[10] > _M_SPE[9]
_M_SPE[10]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])-_HR1)*_H2
_M_SPE[9]=_M_SPE[10] -(_M_SPE[3]*_M_SPE[60])
ELSE
_M_SPE[10]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])+_HR1)*_H2
_M_SPE[9]=_M_SPE[10] +(_M_SPE[3]*_M_SPE[60])
ENDIF
ENDIF
_CALCPOS_AX="+ "<<$MN_AXCONF_MACHAX_NAME_TAB[(_RETV _DEC4)-1]
ENDIF
IF _RETV _DEC3 == 2
IF(_SMI_R[10] ==93101.901)OR(_SMI_R[10] ==2)
_M_SPE[10]=_STARTPOS[_H_AXIND] + _MAXDIST[_H_AXIND]
ELSE
IF _M_SPE[10] < _M_SPE[9]
_M_SPE[10]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])+_HR1)*_H2
_M_SPE[9]=_M_SPE[10] +(_M_SPE[3]*_M_SPE[60])
ELSE
_M_SPE[10]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])-_HR1)*_H2
_M_SPE[9]=_M_SPE[10] -(_M_SPE[3]*_M_SPE[60])
ENDIF
ENDIF
_CALCPOS_AX="- "<<$MN_AXCONF_MACHAX_NAME_TAB[(_RETV _DEC4)-1]
ENDIF
ELSE
_M_ZUST[12]=0 _M_ZUST[13]=0 _CALCPOS_AX=""
ENDIF
ELSE
_MOVDIST[_H_AXIND]=((_M_SPE[9]/_H2)-_STARTPOS[_H_AXIND])*_M_SPE[29]
FOR _I=0 TO 2
_STARTPOS[_I]= _STARTPOS[_I]*_M_SPE[29]
ENDFOR
_DLIMIT[_H_AXIND]=0
_RETV=CALCPOSI(_STARTPOS,_MOVDIST,_DLIMIT,_MAXDIST,0,1)
_MAXDIST[_H_AXIND]=(ROUND(_MAXDIST[_H_AXIND]*_MD10200_MM)/_MD10200_MM)/_M_SPE[29]
_MOVDIST[_H_AXIND] = _MOVDIST[_H_AXIND]/_M_SPE[29]
FOR _I=0 TO 2
_STARTPOS[_I]= _STARTPOS[_I]/_M_SPE[29]
ENDFOR
IF _RETV > 0
_M_ZUST[12]=1
IF _RETV _DEC3 == 1
IF(_SMI_R[10] ==93101.901)OR(_SMI_R[10] ==2)
_M_SPE[9]=_STARTPOS[_H_AXIND] + _MAXDIST[_H_AXIND]
ELSE
IF _M_SPE[9] > _M_SPE[10]
_M_SPE[9]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])-_HR1)*_H2
_M_SPE[10]=_M_SPE[9] -(_M_SPE[3]*_M_SPE[60])
ELSE
_M_SPE[9]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])+_HR1)*_H2
_M_SPE[10]=_M_SPE[9] +(_M_SPE[3]*_M_SPE[60])
ENDIF
_DISTUEW=(ABS(_STARTPOS[_H_AXIND]-(_M_SPE[10]/_H2)))+((_M_SPE[3]*_M_SPE[60])/_H2)
IF _DISTUEW > (ABS(_MAXDIST[_H_AXIND]))
_M_SPE[10]=_STARTPOS[_H_AXIND]*_H2
ENDIF
ENDIF
_CALCPOS_AX="+ "<<$MN_AXCONF_MACHAX_NAME_TAB[(_RETV _DEC4)-1]
ENDIF
IF _RETV _DEC3 == 2
IF(_SMI_R[10] ==93101.901)OR(_SMI_R[10] ==2)
_M_SPE[9]=_STARTPOS[_H_AXIND] + _MAXDIST[_H_AXIND]
ELSE
IF _M_SPE[9] < _M_SPE[10]
_M_SPE[9]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])+_HR1)*_H2
_M_SPE[10]=_M_SPE[9] +(_M_SPE[3]*_M_SPE[60])
ELSE
_M_SPE[9]=((_STARTPOS[_H_AXIND]+ _MAXDIST[_H_AXIND])-_HR1)*_H2
_M_SPE[10]=_M_SPE[9] -(_M_SPE[3]*_M_SPE[60])
ENDIF
_DISTUEW=(ABS(_STARTPOS[_H_AXIND]-(_M_SPE[10]/_H2)))+((_M_SPE[3]*_M_SPE[60])/_H2)
IF _DISTUEW > (ABS(_MAXDIST[_H_AXIND]))
_M_SPE[10]=_STARTPOS[_H_AXIND]*_H2
ENDIF
ENDIF
_CALCPOS_AX="- "<<$MN_AXCONF_MACHAX_NAME_TAB[(_RETV _DEC4)-1]
ENDIF
ELSE
_M_ZUST[12]=0 _M_ZUST[13]=0 _CALCPOS_AX=""
ENDIF
ENDIF
_MT4A:
IF _M_ZUST[14] OR _M_ZUST[15]
RET
ENDIF
N099 STOPRE
N100 G0 G94 G90
IF _VB[1] GOTOF _MT5
N105 G1 F=_M_SPE[2]
IF (_INTERN[18])AND(_MAV==_ZZ) GOTOF _MT5
F=_M_SPE[1]
_MT5:IF _INTERN[40+2]==0 GOTOF _MT8
IF (_VB[15])OR(_VB[52]) GOTOF _MT10 IF (_M_SPE[5+_AXIND]==_M_SPE[10]) GOTOF _MT10
IF(_INTERN[68] == 0)
N110 MEAS=_M_N[0] AX[_MAV]=_M_SPE[10]*_M_SPE[29]
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MT10
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1] = 1
N111 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_MAV]=_M_SPE[10]*_M_SPE[29]
STOPRE
IF (SYG_RS[1] == 0) GOTOF _MT10
SYG_RS[1] = 0
ENDIF
_OVI[9]=61302
N611101 SETAL(_OVI[9])
RET
_MT8: IF (_VB[15])OR(_VB[52]) GOTOF _MT10 IF (_M_SPE[5+_AXIND]==_M_SPE[10]) GOTOF _MT10
N120 AX[_MAV]=_M_SPE[10]*_M_SPE[29]
_MT10:IF(_M_ZUST[4]==0)AND(_M_ZUST[8]==0) GOTOF _MT16 IF _VB[16]==0 GOTOF _MT16 IF (_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND (_OVI[2]==961) GOTOF _MT16
IF (_VB[3]==0) OR ((_INTERN[18])AND(_MAV==_ZZ)) GOTOF _MT11
IF (_M_ZUST[4]==1)AND(_INTERN[69]==0)
_M_SPE[8]=_M_SPE[8]+180 _M_SPE[8]=_M_SPE[8]-TRUNC(_M_SPE[8]/360)*360
_M_SPE[8]=((_M_SPE[8] MOD 360) + 360) MOD 360
IF _INTERN[40+18]
N106 CUST_MEACYC(3,_M_SPE[8],3)
ELSE
N107 SUPA SPOS=AC(_M_SPE[8])
ENDIF
ENDIF
_MT11:_H3=_M_N[29]
N130 G[14]=_H3 F=_M_SPE[2]
IF (_INTERN[40+2]==0)AND(_M_ZUST[13]==0)AND(_M_ZUST[12]==0) GOTOF _MT14
IF (_M_ZUST[13])OR(_M_ZUST[12])
SETAL(62314,_CALCPOS_AX<<",")
M0
ENDIF
IF _INTERN[40+2]==1
IF(_INTERN[68] == 0)
N135 MEAS=_M_N[0] AX[_ZZ]=_ID
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1] = 1
N136 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=_ID
STOPRE
ENDIF
ELSE
IF $P_GG[1]>1
F=_M_SPE[48+2]
N136 G1 AX[_ZZ]=_ID
F=_M_SPE[2]
ELSE
F=_M_SPE[48+2]
N137 G1 AX[_ZZ]=_ID
G0 F=_M_SPE[2]
ENDIF
ENDIF
IF(_INTERN[68] == 0)
IF ($AC_MEA[ABS(_M_N[0])]==0)OR(_M_N[18])OR(_M_SPE[60]==1) GOTOF _MT16
ELSE
IF ((SYG_RS[1] == 0) OR(_M_N[18]) OR (_M_SPE[60]==1)) GOTOF _MT16
SYG_RS[1] = 0
ENDIF
_OVI[9]=61302
IF _M_ZUST[13] OR _M_ZUST[12]
_OVI[9]=61402
ENDIF
IF ($SNS_MEA_ALARM_MASK B_AND 'B1')
N611102 SETAL(61099,"ERROR= "<<_OVI[9]<<"  STAT12= "<<_M_ZUST[12]<<"  STAT13= "<<_M_ZUST[13])
ELSE
N611102 SETAL(_OVI[9])
ENDIF
RET
N145 _MT14:AX[_ZZ]=_ID
_MT16: _M_N[5]=5 _M_N[6]=0
IF _INTERN[40+15]
_M_N[5]=1
ENDIF
_MT18:_M_ME[2]=0
N160 G1 G90 F=_M_SPE[0]
IF ($MNS_MEA_FUNCTION_MASK B_AND 'B1000000000000000')
G60
ELSE
G64
ENDIF
IF _INTERN[40+17] AND(_Z==0)AND(ABS(_M_SPE[3])>_DELTA)
F=_M_SPE[48+3]
ENDIF
_MD51740_6=0
IF ($MNS_MEA_FUNCTION_MASK B_AND 'B1000000')
_MD51740_6=1
ENDIF
IF _M_N[18]
IF (_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND(_OVI[2]==961)
N163 G111 AX[_XX]=$P_EP[_XX]*_M_SPE[29] AX[_YY]=$P_EP[_YY]*_M_SPE[29]
IF _MD51740_6
WHENEVER($AC_PLC_OVR<>0) DO $AC_OVR=10000/$AC_PLC_OVR
WHENEVER($AC_PLC_OVR==0) DO $AC_OVR=0
ENDIF
N164 RP=(_M_SPE[3]*_M_SPE[60]*_M_SPE[29]) AP=(((90*_M_SPE[40])+_M_SPE[41])-_KF[0,2]) MOD 360
ELSE
N165 G1 AX[_MAV]=_SIMPOS*_M_SPE[29]
ENDIF
ELSE
_SD55619=$SCS_MEA_SIM_MEASURE_DIFF _MD13230=$MN_MEAS_PROBE_SOURCE
IF _INTERN[7]
_MD13230 = 0
ENDIF
IF (_INTERN[68] == 1)
SYG_RS[0]=-999
ENDIF
IF (_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND (_OVI[2] == 961)
N166 G111 AX[_XX]=$P_EP[_XX]*_M_SPE[29] AX[_YY]=$P_EP[_YY]*_M_SPE[29]
IF (_MD13230>0)AND(_MD13230<9)
IF $MN_MEAS_PROBE_LOW_ACTIVE[_M_N[0]-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
IF _MD51740_6
WHENEVER($AC_PLC_OVR<>0) DO $AC_OVR=10000/$AC_PLC_OVR
WHENEVER($AC_PLC_OVR==0) DO $AC_OVR=0
ENDIF
IF (_INTERN[68] == 0)
IF ($ON_TECHNO_FUNCTION_MASK B_AND 'B100000000000000')
N167 MEASF=_M_N[0] RP=(_M_SPE[3]*_M_SPE[60]*_M_SPE[29]) AP=(((90*_M_SPE[40])+_M_SPE[41])-_KF[0,2]) MOD 360
ELSE
N168 MEAS=_M_N[0] RP=(_M_SPE[3]*_M_SPE[60]*_M_SPE[29]) AP=(((90*_M_SPE[40])+_M_SPE[41])-_KF[0,2]) MOD 360
ENDIF
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO SYG_RS[0]=$AC_DTEB-$SCS_MEA_SIMULTAN_LIMIT
WHEN ((SYG_RS[0] <> -999) AND ($AC_DTEB < SYG_RS[0])) DO DELDTG
N169 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=(_M_SPE[3]*_M_SPE[60]*_M_SPE[29]) AP=(((90*_M_SPE[40])+_M_SPE[41])-_KF[0,2]) MOD 360
STOPRE
ENDIF
ELSE
IF (_MD13230>0)AND(_MD13230<9)
IF $MN_MEAS_PROBE_LOW_ACTIVE[_M_N[0]-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
IF _MD51740_6
WHENEVER($AC_PLC_OVR<>0) DO $AC_OVR=10000/$AC_PLC_OVR
WHENEVER($AC_PLC_OVR==0) DO $AC_OVR=0
ENDIF
IF (_INTERN[68] == 0)
IF ($ON_TECHNO_FUNCTION_MASK B_AND 'B100000000000000')
N170 MEASF=_M_N[0] AX[_MAV]=_M_SPE[9]*_M_SPE[29]
ELSE
N171 MEAS=_M_N[0] AX[_MAV]=_M_SPE[9]*_M_SPE[29]
ENDIF
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO SYG_RS[0]=$AC_DTEB-$SCS_MEA_SIMULTAN_LIMIT
WHEN ((SYG_RS[0] <> -999) AND ($AC_DTEB < SYG_RS[0])) DO DELDTG
N172 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_MAV]=_M_SPE[9]*_M_SPE[29]
STOPRE
ENDIF
ENDIF
IF (_MD13230>0)AND(_MD13230<9)
DO $A_OUT[_MD13230]=0
G4 F0.1
ENDIF
ENDIF
IF _VB[1]
N178 G0
ELSE
IF _INTERN[40+16] AND _INTERN[40+2]
IF (_INTERN[18])AND(_MAV==_ZZ)
N179 F=$MA_MAX_AX_VELO[_ZZ]*_M_N[14]/100
ELSE
N180 F=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_YY]<$MA_MAX_AX_VELO[_XX]
N181 F=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
ENDIF
ELSE
IF (_INTERN[18])AND(_MAV==_ZZ)
N182 F=_M_SPE[2]
ELSE
N183 F=_M_SPE[1]
ENDIF
ENDIF
ENDIF
IF (_INTERN[68] == 0)
IF _M_N[18] OR(_INTERN[40+17]==0)OR($AC_MEA[ABS(_M_N[0])]==0)OR _Z OR(ABS(_M_SPE[3])<=_DELTA) GOTOF _MT22
ELSE
IF _M_N[18] OR(_INTERN[40+17]==0)OR(($AC_MEA[ABS(_M_N[0])]==0)AND($AC_MEA[ABS(_M_N[30])]==0))OR _Z OR(ABS(_M_SPE[3])<=_DELTA) GOTOF _MT22
ENDIF
_Z=1 _HR=$AA_MW[_MAV]-$AA_IW[_MAV]/_H _HR=_HR/ABS(_HR)*2*_DELTA
IF (_M_ZUST[4])OR((_M_ZUST[4]==0)AND(_M_ZUST[8]))
IF (_HR>0)AND($AA_MW[_MAV]+_HR>_M_SPE[10])OR(_HR<0)AND($AA_MW[_MAV]+_HR<_M_SPE[10])
_HR=_M_SPE[10]-$AA_MW[_MAV]
ENDIF
ENDIF
_HR=$AA_MW[_MAV]+_HR*_H2
N184 G60 AX[_MAV]=_HR*_M_SPE[29]
GOTOB _MT18
N185 _MT22:
IF _INTERN[40+17] AND _Z AND (_M_N[6]+1<_M_N[20])
N333 G09 AX[_MAV]=_HR*_M_SPE[29]
ELSE
IF (_VB[2] OR NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')) AND (_OVI[2] == 961)
N335 RP=0.001*_M_SPE[29] AP=(((90*_M_SPE[40])+_M_SPE[41])-_KF[0,2]) MOD 360
ELSE
IF $AC_MEA[ABS(_M_N[0])]
_HR=($AA_IW[_MAV]/_H) - $AA_MW[_MAV]
IF (ABS(_HR*2)) >= (ABS(($AA_IW[_MAV]/_H) - _M_SPE[10]))
_M_SPE[10]=_M_SPE[10]-_HR*2
ENDIF
ENDIF
N337 G09 AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
ENDIF
ENDIF
IF (_M_N[18])
IF _SIMAL==61301 GOTOF _MT25
_M_ME[1]=_SIMPOS
IF (_INTERN[68] == 1)
_M_ME[21]=_SIMPOS
ENDIF
ELSE
IF (_INTERN[68] == 0)
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MT25
IF (_MAV == _XX)
_M_ME[1]=$AA_MW[_MAV] _M_ME[2]=$AA_MW[_YY] _M_ME[3]=$AA_MW[_ZZ]
ELSE
IF (_MAV == _YY)
_M_ME[1]=$AA_MW[_MAV] _M_ME[2]=$AA_MW[_XX] _M_ME[3]=$AA_MW[_ZZ]
ELSE
_M_ME[1]=$AA_MW[_MAV] _M_ME[2]=$AA_MW[_XX] _M_ME[3]=$AA_MW[_YY]
ENDIF
ENDIF
ELSE
IF (($AC_MEA[ABS(_M_N[0])]==0) AND ($AC_MEA[ABS(_M_N[30])]==0)) GOTOF _MT25
IF _MAV==_XX
_M_ME[1] = $AA_MW1[_MAV] _M_ME[2] = $AA_MW1[_YY] _M_ME[3]=$AA_MW1[_ZZ]
_M_ME[21] = $AA_MW2[_MAV] _M_ME[22] = $AA_MW2[_YY] _M_ME[23]=$AA_MW2[_ZZ]
ELSE
IF (_MAV == _YY)
_M_ME[1]=$AA_MW1[_MAV] _M_ME[2]=$AA_MW1[_XX] _M_ME[3]=$AA_MW1[_ZZ]
_M_ME[21]=$AA_MW2[_MAV] _M_ME[22]=$AA_MW2[_XX] _M_ME[23]=$AA_MW2[_ZZ]
ELSE
_M_ME[1]=$AA_MW1[_MAV] _M_ME[2]=$AA_MW1[_XX] _M_ME[3]=$AA_MW1[_YY]
_M_ME[21]=$AA_MW2[_MAV] _M_ME[22]=$AA_MW2[_XX] _M_ME[23]=$AA_MW2[_YY]
ENDIF
ENDIF
ENDIF
ENDIF
_M_N[6]=_M_N[6]+1 _M_ME[8]=_M_ME[8]+_M_ME[1] _M_ME[9]=_M_ME[9]+_M_ME[2]
IF (_INTERN[68] == 1)
_M_ME[28]=_M_ME[28]+_M_ME[21] _M_ME[29]=_M_ME[29]+_M_ME[22]
ENDIF
IF _M_N[6]<_M_N[20] GOTOB _MT18
_M_ME[8]=_M_ME[8]/_M_N[6] _M_ME[9]=_M_ME[9]/_M_N[6]
IF (_INTERN[68] == 1)
_M_ME[28]=_M_ME[28]/_M_N[6] _M_ME[29]=_M_ME[29]/_M_N[6]
ENDIF
GOTOF _ENDE
_MT25:IF _M_N[5]==1 GOTOF _MT26
_M_N[5]=_M_N[5]-1
GOTOB _MT18
_MT26:_OVI[9]=61301
IF _M_ZUST[12]
_OVI[9]=61401
ENDIF
IF ($SNS_MEA_ALARM_MASK B_AND 'B1')
N611103 SETAL(61099,"ERROR= "<<_OVI[9]<<"  STAT12= "<<_M_ZUST[12]<<"  STAT13= "<<_M_ZUST[13])
ELSE
IF (_OVI[9] _DEC3)==4
N611104 SETAL(_OVI[9],", "<<_CALCPOS_AX)
ELSE
IF(_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF NOT(_INTERN[12] AND _INTERN[13])
N611105 SETAL(_OVI[9])
ENDIF
ENDIF
ENDIF
RET
_ERR4:
_OVI[9]=61166
N611104 SETAL(_OVI[9],"MD13230="<<_MD13230<<" MD10360=0 ?")
_ENDE:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE112_SPF
PROC CYCLE112(VAR AXIS _XX,VAR AXIS _YY,VAR AXIS _ZZ,VAR REAL _M_SPE[],VAR REAL _M_ME[],VAR REAL _WINKEL,VAR INT _M_N[],VAR INT _ALARM,VAR BOOL _M_ZUST[],VAR BOOL _VB[],VAR BOOL _INTERN[]) ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.001 ;DATE: 2023-06-20
DEF INT _HI,_HI_MN18,_SIMAL,_MESRI,_MD13230,_I_ZMIRROR=1,_MD51740_6,_Z=0
DEF REAL _HR,_HR1,_HR2,_HR3,_HH,_HH1,_HSIM,_SDIF,_SIMPOS,_H_SPE8,_SD55619,_R_ZMIRROR
DEF REAL _INC=1000,_DELTA=1
DEF INT _MODE_2MESS=1
IF _M_N[18]
_SDIF=$SCS_MEA_SIM_MEASURE_DIFF _MESRI=1 _SIMAL=0
IF (_M_SPE[9]<_M_ME[11])
_MESRI=-1
ENDIF
IF (ABS(_SDIF)>ABS(_M_SPE[3]))
_SIMAL=61301 _SIMPOS=_M_SPE[9]
ELSE
IF (((_OVI[2]==979)OR(_OVI[2]==997))AND(_M_ZUST[0]))
_SDIF=_SDIF*0.1
ENDIF
_SIMPOS=_M_ME[11]-_SDIF*_MESRI
IF ((_OVI[2]==979) AND (_M_ZUST[4]==0))
_SIMPOS=_M_ME[11]+_SDIF*_MESRI
ENDIF
ENDIF
ENDIF
IF _M_N[18] OR(_M_SPE[60]==1)OR(NOT(_INTERN[40+2]))
_HI_MN18=1
ENDIF
IF (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==3))OR(($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]<>4))
_INC=1000*$MN_SCALING_VALUE_INCH _DELTA=1/$MN_SCALING_VALUE_INCH
ENDIF
IF _INTERN[19] AND _VB[16] AND _VB[55]
_R_ZMIRROR=180 _I_ZMIRROR=-1
ENDIF
_HH=_WINKEL-TRUNC(_WINKEL/ 360)*360
IF (((_OVI[2]==997)AND(_MVAR _DEC4 ==2))OR((_OVI[2]==979)AND(_MVAR _DEC5 >0))) GOTOF _MM0
IF _INTERN[40+2]==0 GOTOF _MM1 IF _VB[27] GOTOF _MM1
_HI=1
IF _VB[2]==0 GOTOF _MM1
_MM0: _HI=2
_MM1: IF _VB[3]==0 GOTOF _MM14
_M_SPE[8]=((_M_SPE[8] MOD 360) + 360) MOD 360
IF _VB[2]==0 GOTOF _MM13 IF _M_ZUST[4]==0 GOTOF _MM11
_M_SPE[8]=_M_SPE[8]+180 _M_SPE[8]=_M_SPE[8]-TRUNC(_M_SPE[8]/ 360)*360
_MM11:IF _INTERN[20+8]==0 GOTOF _MM13
_M_SPE[8]=_M_SPE[8]+_M_SPE[38] _M_SPE[8]=_M_SPE[8]-TRUNC(_M_SPE[8]/ 360)*360
_MM13: IF(_M_ZUST[0]==0)AND((_VB[2]==0)OR((_HI==2)AND(_VB[20]==0))) GOTOF _MM14
IF _INTERN[40+18]
N90 CUST_MEACYC(3,((_M_SPE[8]+ _R_ZMIRROR) MOD 360),0)
ELSE
N95 SUPA SPOS=DC((_M_SPE[8]+_R_ZMIRROR) MOD 360)
ENDIF
_MM14: IF (_M_ZUST[0])AND(_VB[27]==0) GOTOF _MM6
IF _M_ZUST[6] GOTOF _MM4
G3 G90 G94 F=_RF
IF (_INCA>0)AND (_VB[27]==0) OR (_INCA<0)AND (_VB[27]) GOTOF _MM3
G2
_MM3:_VB[27]=0
CASE (_HI) OF 1 GOTOF _MM31 2 GOTOF _MM32
IF(_HI==0)AND _VB[55] GOTOF _MM32
N100 RP=_M_SPE[10]*_M_SPE[29] AP=_HH
GOTOF _MM6
N105 _MM31:
IF _HI_MN18
N105 RP=_M_SPE[10]*_M_SPE[29] AP=_HH
ELSE
IF(_INTERN[68] == 0)
N106 MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_HH
N110 STOPRE
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MM6
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N111 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=_M_SPE[10]*_M_SPE[29] AP=_HH
STOPRE
IF (SYG_RS[1] == 0) GOTOF _MM6
SYG_RS[1]=0
ENDIF
_OVI[9]=61302
N611201 SETAL(_OVI[9])
RET
ENDIF
_MM32: _HR=90 _HR1=_WINKEL-_INCA _HR2=ABS(_INCA/10) _HR3=_M_SPE[8]
IF _INCA>0 GOTOF _MM33
_HR=-90
_MM33:
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -(_HR1+_HR)
ELSE
_M_SPE[8]=_M_SPE[61] + _HR1+ _HR
ENDIF
IF _INTERN[20+8]
_M_SPE[8]=_M_SPE[8]+_M_SPE[38] _M_SPE[8]=_M_SPE[8]-TRUNC(_M_SPE[8]/ 360)*360
ENDIF
_M_SPE[8]=((_M_SPE[8] MOD 360) + 360) MOD 360
IF _M_N[13] GOTOF _MM35
IF _INTERN[40+18]
CUST_MEACYC(3,_M_SPE[8],0)
_HH1=_HR1+_INCA/_HR2 _HH1=_HH1-TRUNC(_HH1/ 360)*360
N157 G1 RP=_M_SPE[10]*_M_SPE[29] AP=_HH1
ELSE
N150 SUPA SPOS=DC(_M_SPE[8])
_HH1=_HR1+_INCA/_HR2 _HH1=_HH1-TRUNC(_HH1/ 360)*360
IF _HI_MN18
N157 RP=_M_SPE[10]*_M_SPE[29] AP=_HH1
ELSE
IF(_INTERN[68] == 0)
N159 MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_HH1
STOPRE
IF $AC_MEA[ABS(_M_N[0])]
_OVI[9]=61302
N611202 SETAL(_OVI[9])
RET
ENDIF
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N160 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=_M_SPE[10]*_M_SPE[29] AP=_HH1
STOPRE
IF (SYG_RS[1] == 1)
SYG_RS[1]=0
_OVI[9]=61302
N611202 SETAL(_OVI[9])
RET
ENDIF
ENDIF
ENDIF
ENDIF
_HR1=_HR1+_INCA/_HR2
IF _HR1<_WINKEL GOTOB _MM33
_MM34:_M_SPE[8]=_HR3 _M_SPE[8]=((_M_SPE[8] MOD 360) + 360) MOD 360
IF _INTERN[40+18]
N160 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N161 SUPA SPOS=DC(_M_SPE[8])
ENDIF
GOTOF _MM6
N160 _MM35:
IF _VB[55]==0
IF _INTERN[40+18]
N165 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N167 SUPA SPOS=DC(_M_SPE[8])
ENDIF
ENDIF
IF _VB[31]==0
_HR1=360- _M_SPE[61] -(_WINKEL+_HR)
ELSE
_HR1=_M_SPE[61] + _WINKEL+_HR
ENDIF
_HR1=((_HR1 MOD 360) + 360) MOD 360
IF _INTERN[20+8]
_HR1=_HR1+_M_SPE[38] _HR1=_HR1-TRUNC(_HR1/360)*360
ENDIF
_HR1=_HR1-_M_SPE[8]
IF ABS(_HR1)<>ABS(_INCA)
IF _HR1>0
_HR1=_HR1-360
ELSE
_HR1=_HR1+360
ENDIF
ENDIF
IF _HI_MN18
N164 RP=_M_SPE[10]*_M_SPE[29] AP=_HH AX[SPI(_M_N[13])]=IC(_I_ZMIRROR*_HR1)
ELSE
IF(_INTERN[68] == 0)
N165 MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_HH AX[SPI(_M_N[13])]=IC(_I_ZMIRROR*_HR1)
STOPRE
IF $AC_MEA[_M_N[0]]
_OVI[9]=61302
N611203 SETAL(_OVI[9])
RET
ENDIF
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N166 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=_M_SPE[10]*_M_SPE[29] AP=_HH AX[SPI(_M_N[13])]=IC(_I_ZMIRROR*_HR1)
STOPRE
IF (SYG_RS[1] == 1)
SYG_RS[1]=0
_OVI[9]=61302
N611203 SETAL(_OVI[9])
RET
ENDIF
ENDIF
ENDIF
IF (_OVI[2]==976)AND(_VB[55]==1) GOTOF _MM6
GOTOB _MM34
_MM4:_VB[27]=0
G0 G91
IF _VB[1] GOTOF _MM41
G1 F=_M_SPE[1]
_MM41:IF _M_ZUST[5]==0 GOTOF _MM45
F=_M_SPE[2]+1
CASE (_HI) OF 1 GOTOF _MM42 2 GOTOF _MM42
N115 AX[_ZZ]=_ID*_M_SPE[29]
GOTOF _MM45
N120 _MM42:
IF _HI_MN18
N122 G1 AX[_ZZ]=_ID
ELSE
IF(_INTERN[68] == 0)
N124 MEAS=_M_N[0] AX[_ZZ]=_ID
STOPRE
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MM45
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N125 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=_ID
STOPRE
IF (SYG_RS[1] == 0) GOTOF _MM45
SYG_RS[1]=0
ENDIF
ENDIF
_OVI[9]=61302
N611204 SETAL(_OVI[9])
RET
_MM45:G90 F=_M_SPE[1]+1
CASE (_HI) OF 1 GOTOF _MM47 2 GOTOF _MM47
N125 RP=_M_SPE[10]*_M_SPE[29] AP=_HH
GOTOF _MM5
N130 _MM47:
IF _HI_MN18
N132 RP=_M_SPE[10]*_M_SPE[29] AP=_HH
ELSE
IF(_INTERN[68] == 0)
N133 MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_HH
STOPRE
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MM5
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N134 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=_M_SPE[10]*_M_SPE[29] AP=_HH
STOPRE
IF (SYG_RS[1] == 0) GOTOF _MM5
SYG_RS[1]=0
ENDIF
ENDIF
_OVI[9]=61302
N611205 SETAL(_OVI[9])
RET
_MM5:IF _M_ZUST[5]==0 GOTOF _MM52
F=_M_SPE[2]+1
CASE (_HI) OF 1 GOTOF _MM51 2 GOTOF _MM51
N135 G91 AX[_ZZ]=-_ID*_M_SPE[29]
GOTOF _MM6
N140 _MM51:G91
IF _HI_MN18
N141 G1 AX[_ZZ]=-_ID
ELSE
IF(_INTERN[68] == 0)
N142 MEAS=_M_N[0] AX[_ZZ]=-_ID
STOPRE
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MM52
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N143 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=-_ID
STOPRE
IF (SYG_RS[1] == 0) GOTOF _MM52
SYG_RS[0] = 0
ENDIF
ENDIF
_OVI[9]=61302
N611206 SETAL(_OVI[9])
RET
_MM52: IF _VB[2]==0 GOTOF _MM6
IF _INTERN[40+18]
N145 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N1146 SUPA SPOS=DC(_M_SPE[8])
ENDIF
_MM6:_M_N[5]=5 _M_N[6]=0
_MM71: _M_ME[2]=0
N150 G1 G90 F=_M_SPE[0]
_MD51740_6=0
IF ($MNS_MEA_FUNCTION_MASK B_AND 'B1000000')
_MD51740_6=1
ENDIF
IF (_INTERN[40+17] AND(_Z==0))
F=_M_SPE[48+3]
ENDIF
IF _M_N[18]
N153 G1 RP=_SIMPOS*_M_SPE[29] AP=_HH
IF _SIMAL==61301 GOTOF _MM7A
_M_ME[1]=$AA_IW[_XX] _M_ME[2]=$AA_IW[_YY]
ELSE
_SD55619=$SCS_MEA_SIM_MEASURE_DIFF _MD13230=$MN_MEAS_PROBE_SOURCE
IF _INTERN[7]
IF (_INTERN[68] == 1)
SYG_RS[0]=-999
ENDIF
_MD13230 = 0
ENDIF
IF (_MD13230>0)AND(_MD13230<9)
IF $MN_MEAS_PROBE_LOW_ACTIVE[_M_N[0]-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
IF _MD51740_6
WHENEVER($AC_PLC_OVR<>0) DO $AC_OVR=10000/$AC_PLC_OVR
WHENEVER($AC_PLC_OVR==0) DO $AC_OVR=0
ENDIF
IF(_INTERN[68] == 0)
IF ($ON_TECHNO_FUNCTION_MASK B_AND 'B100000000000000')
N154 MEASF=_M_N[0] RP=_M_SPE[9]*_M_SPE[29] AP=_HH
ELSE
N155 MEAS=_M_N[0] RP=_M_SPE[9]*_M_SPE[29] AP=_HH
STOPRE
ENDIF
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO SYG_RS[0]=$AC_DTEB-$SCS_MEA_SIMULTAN_LIMIT
WHEN ((SYG_RS[0] <> -999) AND ($AC_DTEB < SYG_RS[0])) DO DELDTG
N156 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=_M_SPE[9]*_M_SPE[29] AP=_HH
STOPRE
ENDIF
IF (_MD13230>0)AND(_MD13230<9)
DO $A_OUT[_MD13230]=0
G4 F0.1
ENDIF
ENDIF
N157 _MM73: G0
IF _VB[1] GOTOF _MM74
N160 G1 F=_M_SPE[1]
IF ((_INTERN[40+17]==1) AND (_Z==0))
_HR=2*_DELTA
IF (_M_ZUST[4] == 1) OR (_OVI[2]==976)
_HR=SQRT(POT($AA_MW[_XX]-_CPA)+POT($AA_MW[_YY]-_CPO))+_HR
ELSE
_HR=SQRT(POT($AA_MW[_XX]-_CPA)+POT($AA_MW[_YY]-_CPO))-_HR
ENDIF
_Z=1
N165 RP=_HR*_M_SPE[29] AP=_HH
GOTOB _MM71
ENDIF
N167 _MM74: RP=_M_SPE[10]*_M_SPE[29] AP=_HH
STOPRE
IF (_M_N[18]==0)
IF(_INTERN[68] == 0)
IF $AC_MEA[ABS(_M_N[0])]==0 GOTOF _MM79
_M_ME[1]=$AA_MW[_XX] _M_ME[2]=$AA_MW[_YY]
ELSE
IF (($AC_MEA[ABS(_M_N[0])] == 0) AND ($AC_MEA[ABS(_M_N[30])] == 0)) GOTOF _MM79
_M_ME[1]=$AA_MW1[_XX] _M_ME[2]=$AA_MW1[_YY]
_M_ME[21]=$AA_MW2[_XX] _M_ME[22]=$AA_MW2[_YY]
ENDIF
ENDIF
_M_ME[8]=_M_ME[8]+_M_ME[1] _M_ME[9]=_M_ME[9]+_M_ME[2]
IF(_INTERN[68] == 1)
_M_ME[28]=_M_ME[28]+_M_ME[21] _M_ME[29]=_M_ME[29]+_M_ME[22]
ENDIF
_M_N[5]=5 _M_N[6]=_M_N[6]+1
IF _M_N[6]-_M_N[20] < 0 GOTOB _MM71
_M_ME[8]=_M_ME[8]/_M_N[6] _M_ME[9]=_M_ME[9]/_M_N[6]
IF(_INTERN[68] == 1)
_M_ME[28]=_M_ME[28]/_M_N[6] _M_ME[29]=_M_ME[29]/_M_N[6]
ENDIF
RET
_MM79:IF _M_N[5]==1 GOTOF _MM7A
_M_N[5]=_M_N[5]-1
GOTOB _MM71
_MM7A: _OVI[9]=61301
IF(_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF NOT(_INTERN[12] AND _INTERN[13])
N611207 SETAL(_OVI[9])
ENDIF
RET
_ERR4: _OVI[9]=61166
N611104 SETAL(_OVI[9],"MD13230="<<_MD13230<<" MD10360=0 ?")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE114_SPF
PROC CYCLE114(INT _SEL,VAR INT _ALARM,AXIS _MAV,BOOL _ADD,REAL _I_TMV,INT _I_K,BOOL _I_CH_4,VAR BOOL _I_CH_6,BOOL _I_CH_8,BOOL _I_CH_19,BOOL _I_NC_7,REAL _H_SPE52) ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-01-12
DEF INT _T_2,_T_3,_H_T_3,_T_4,_T_5,_T_6,_T_7,_RETW,_TDDL[3],_I_PROT,_SD42950,_SD42942
DEF INT _I_MA,_DFLACH,_CORCOMP,_CORMODE,_GEOAX,_TCOR,_TOUT,_TTYP,_H_TC,_HI_GG
DEF REAL _CORVAL[3],_HR_GG,_H_OVR20,_R_PROT[3], _DPROT=0
DEF STRING[2] _COMP
DEF STRING[32] _I_TENV
DEF STRING[128] _STR_PROT
DEF BOOL _Y_DREH=0
IF ($AN_NCK_VERSION<990000)
GOTOF _AL11
ENDIF
IF ($P_SEARCH OR $P_ISTEST OR $P_DRYRUN)
RET
ENDIF
CASE (_SEL) OF 2 GOTOF _MWBILD 3 GOTOF _WZKOR 4 GOTOF _PREPARE_PROT DEFAULT GOTOF _AL7
_MWBILD: _I_K=_I_K MOD 100
IF (ABS(_OVR[20])>_I_TMV) GOTOF _FINMW_2
IF (_I_K==0) GOTOF _AL1 IF (_OVI[6]==0)OR(_I_CH_4==0) GOTOF _PA2A
_OVR[20]=_MV[_OVI[6]-1]-_MV[_OVI[6]-1]/_I_K+_OVR[20]/_I_K
GOTOF _FINMW_1
_PA2A:_OVR[20]=_OVR[20]/_I_K
_FINMW_1: RET
_FINMW_2: _I_CH_6=1
RET
_PREPARE_PROT:
REPEAT _PROT_A _PROT_E
RET
_PROT_A:
_WZKOR: _OVI[11]=0 _H_OVR20=_OVR[20]*_H_SPE52 _HR_GG=$P_GG[6]
IF (_ALARM>0)AND(_ALARM<>61304)AND(_ALARM<>61305)
RET
ENDIF
IF (_OVI[6]<>0)
_MV[_OVI[6]-1]=0 $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=0
ENDIF
_I_MA=_MA
IF (_OVI[2]==974) OR (_OVI[2]==994)
_I_MA=(_I_MA MOD 10)
IF ($P_GG[6]==2) AND (_I_CH_19) AND (_I_MA==3)
_I_MA=2
ENDIF
ENDIF
IF (_KNUM==0)
RET
ENDIF
IF ($MN_MM_TYPE_OF_CUTTING_EDGE==1)OR($MN_MM_MAX_CUTTING_EDGE_NO>999)
_DFLACH=$MN_MM_TYPE_OF_CUTTING_EDGE
_T_2=_KNUM _DEC9 _T_3=_KNUM _DEC8 _T_4=_KNUM _DEC7 _T_6=_KNUM _DEC6 _T_7=_KNUM MOD 100000 _H_T_3=_T_3
ELSE
_T_2=_KNUM _DEC7 _T_3=_KNUM _DEC6 _T_4=_KNUM _DEC5 _T_6=_KNUM _DEC4 _T_7=_KNUM MOD 1000 _H_T_3=_T_3
ENDIF
_OVI[0]=_T_7
IF (_DFLACH)
_TCOR=1 _TOUT=_T_7 _TTYP=$TC_DP1[_T_7]
ELSE
_TCOR=_OVI[8] _TOUT=_TCOR _TTYP=$TC_DP1[_TCOR,_T_7]
ENDIF
IF ((_TTYP _DEC3 == 5) AND (_TTYP _DEC1 == 5))
_I_PROT = 1
_Y_DREH = 1
IF ((_T_2==0)AND(_T_6==2)AND((_OVI[2]==977)OR(_OVI[2]==979)))
IF ((_MVAR _DEC1)==1)OR((_MVAR _DEC1)==3)
GOTOF _AL29
ENDIF
ENDIF
IF ((_T_6==0) AND ((_OVI[2]==974)OR(_OVI[2]==994)))
IF (_OVI[3] _DEC1 == 0) OR (_OVI[3] _DEC1 == 2)
_T_3=1 _H_T_3=_T_3+1
ENDIF
IF (_OVI[3] _DEC1 == 1)
GOTOF _AL29
ENDIF
ENDIF
IF ((_TTYP == 525) OR (_TTYP == 535))
GOTOF _AL29
ENDIF
ENDIF
_SD42950=$SC_TOOL_LENGTH_TYPE
IF (($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1))
IF ((_SD42950==2)AND($SC_TOOL_LENGTH_CONST==-1018))
IF ((_T_2==0)AND(_T_3==0)AND(_T_6==2)AND(_OVI[2]==978))
IF ((_TTYP _DEC3)==5) GOTOF _AL28
ENDIF
IF ((_T_2==0)AND(_T_6==2)AND((_OVI[2]==977)OR(_OVI[2]==979)))
_T_6=0 _T_3=2 _H_T_3=_T_3+1
IF ((_MVAR _DEC1)==1)OR((_MVAR _DEC1)==3)
IF _T_4==0
_T_4=1
ELSE
_T_4=0
ENDIF
ENDIF
ENDIF
ENDIF
IF ((_SD42950==3)AND(_TTYP>=400)AND(_TTYP<=599))
_SD42942=$SC_TOOL_LENGTH_CONST_T
IF _SD42942
_I_PROT=1
IF ((_T_2==0)AND(_T_3>0)AND(_T_3<>4))
IF _SD42942==19
IF _T_3==3
_T_3=1 _H_T_3=3
ELSE
IF _T_3==1
_T_3=3 _H_T_3=1
ELSE
_T_3=2 _H_T_3=2
ENDIF
ENDIF
ENDIF
IF _SD42942== -19
IF _T_3==3
_T_3=1 _H_T_3=3
ELSE
IF _T_3==1
_T_3=2 _H_T_3=1
ELSE
_T_3=3 _H_T_3=2
ENDIF
ENDIF
ENDIF
IF _SD42942==-18
IF _T_3==3
_T_3=2 _H_T_3=3
ELSE
IF _T_3==1
_T_3=3 _H_T_3=1
ELSE
_T_3=1 _H_T_3=2
ENDIF
ENDIF
ENDIF
IF _SD42942==18
IF _T_3==3
_T_3=2 _H_T_3=3
ELSE
IF _T_3==1
_T_3=1 _H_T_3=1
ELSE
_T_3=3 _H_T_3=2
ENDIF
ENDIF
ENDIF
IF _SD42942==17
IF _T_3==3
_T_3=3 _H_T_3=3
ELSE
IF _T_3==1
_T_3=2 _H_T_3=1
ELSE
_T_3=1 _H_T_3=2
ENDIF
ENDIF
ENDIF
IF _SD42942==-17
IF _T_3==3
_T_3=3 _H_T_3=3
ELSE
IF _T_3==1
_T_3=1 _H_T_3=1
ELSE
_T_3=2 _H_T_3=2
ENDIF
ENDIF
ENDIF
ENDIF
IF (_T_2==0)AND(_T_3==0)AND((_T_6==1)OR(_T_6==2))AND(_OVI[2]==978)
IF ((_TTYP _DEC3)==5) GOTOF _AL28
ENDIF
IF (((_OVI[2]==977)OR(_OVI[2]==979))AND((_T_2==0)AND(_T_6==2)) AND NOT _Y_DREH)
IF _SD42942==19
_T_6=0 _T_3=1 _H_T_3=3
ELSE
_T_6=0 _T_3=1 _H_T_3=2
ENDIF
ENDIF
IF (((_MVAR _DEC1)==1)OR((_MVAR _DEC1)==3))
IF _T_4==0
_T_4=1
ELSE
_T_4=0
ENDIF
ENDIF
IF ((_T_2==0)AND(_T_6==2)AND((_OVI[2]==977)OR(_OVI[2]==979)) AND _Y_DREH)
_T_6=0 _T_3=2 _H_T_3=_T_3+1
ENDIF
ENDIF
ENDIF
ENDIF
IF ($MCS_TECHNOLOGY==1)AND($MCS_TECHNOLOGY_EXTENSION==2)AND(_SD42950==2)AND($SC_TOOL_LENGTH_CONST==18)
IF ((_T_2==0)AND(_T_3==0)AND(_T_6==2)AND(_OVI[2]==978))
IF ((_TTYP _DEC3)==5) GOTOF _AL28
ENDIF
ENDIF
IF (_T_2>1)
IF (_TENV=="")
GOTOF _AL21
ENDIF
_I_TENV=_TENV
IF (_DFLACH)
_TCOR=0
ENDIF
IF (_TCOR<0)
GOTOF _AL5
ENDIF
IF _TCOR==0
_RETW=GETTENV(_I_TENV,_TDDL)
_TOUT=_TDDL[0]
IF (_DFLACH) AND (_T_7==0)
_TOUT=_TDDL[1]
ENDIF
ENDIF
ELSE
IF (_TCOR<=0)
GOTOF _AL5
ENDIF
IF (_T_7==0)
GOTOF _AL8
ENDIF
_I_TENV=""
ENDIF
IF(_T_3==0)
IF _T_6<2
_CORCOMP=0 _GEOAX=_I_MA-1 _H_T_3=(3-_GEOAX)
_PROTVAL[25]=SET("","","","","") _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<","<<(_I_K _DEC3)<<",,"<<(_H_T_3)<<",,"
IF (_SD42950==2)OR(((_SD42950==0)OR(_SD42950==3))AND(_TTYP>=400)AND(_TTYP<=599))
IF NOT(_I_PROT)
IF _HR_GG ==2
_H_T_3=_I_MA
IF _I_MA == 1
_H_T_3=2
ELSE
IF _I_MA ==2
_H_T_3=1
ENDIF
ENDIF
ELSE
IF _HR_GG==1
_H_T_3=_I_MA
IF _I_MA == 2
_H_T_3=3
ELSE
IF _I_MA ==3
_H_T_3=2
ENDIF
ENDIF
ELSE
_H_T_3=_I_MA
IF _I_MA == 1
_H_T_3=3
ELSE
IF _I_MA ==3
_H_T_3=1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _I_MA ==3
IF _SD42942==19
_H_T_3=2 _GEOAX=1
ELSE
_H_T_3=2 _GEOAX=0
ENDIF
ENDIF
ENDIF
_PROTVAL[29]="T,"<<($P_GG[6]+16)<<","<<(_I_K _DEC3)<<",,"<<(_H_T_3)<<",,"
ENDIF
ELSE
IF (_T_6==2)
_CORCOMP=6
_PROTVAL[25]=SET("","","","","") _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<","<<(_I_K _DEC3)<<",,4,,"
ENDIF
_H_T_3=_I_MA
ENDIF
ELSE
IF(_T_3==4)
_CORCOMP=6
_PROTVAL[25]=SET("","","","","") _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<","<<(_I_K _DEC3)<<",,4,,"
ELSE
IF _T_2 < 2
IF (_SD42950==1)OR(((_SD42950==0)OR(_SD42950==3))AND((_TTYP<400)OR(_TTYP==710)))
IF _H_T_3<>1
IF _H_T_3==2
_H_T_3=1
ELSE
_H_T_3=0
ENDIF
ELSE
_H_T_3=2
ENDIF
_HI_GG=$SC_TOOL_LENGTH_CONST MOD 100
IF (_HI_GG < 0)
IF _H_T_3 == 0
_H_T_3=1
ELSE
IF _H_T_3 == 1
_H_T_3=0
ENDIF
ENDIF
ENDIF
_CORCOMP=0 _GEOAX=_H_T_3 _HI_GG=ABS(_HI_GG)
_PROTVAL[25]=SET("","","","","") _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<","<<(_I_K _DEC3)<<",,"<<(3- _GEOAX)<<",,"
_H_T_3=_T_3
ENDIF
IF (_SD42950==2)OR(((_SD42950==0)OR(_SD42950==3))AND(_TTYP>=400)AND(_TTYP<=599))
IF NOT(_I_PROT)
IF _H_T_3<>1
IF _H_T_3==2
_H_T_3=0
ELSE
_H_T_3=2
ENDIF
ENDIF
_HI_GG=$SC_TOOL_LENGTH_CONST MOD 100
IF (_HI_GG < 0)
IF _H_T_3 == 0
_H_T_3=1
ELSE
IF _H_T_3 == 1
_H_T_3=0
ENDIF
ENDIF
ENDIF
_GEOAX=_H_T_3
ELSE
_GEOAX=_T_3-1
ENDIF
_CORCOMP=0 _HI_GG=ABS(_HI_GG)
IF NOT(_I_PROT)
_H_T_3=_T_3
ENDIF
_PROTVAL[25]=SET("","","","","") _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<","<<(_I_K _DEC3)<<",,"<<(_H_T_3)<<",,"
ENDIF
ELSE
_GEOAX=0 _CORCOMP=_T_3+2
ENDIF
ENDIF
ENDIF
IF ((_T_2==0)OR(_T_2==2))
IF (_I_CH_6==0)
_COMP="W" _CORMODE=1 _I_PROT=9
ELSE
_COMP="GW" _CORMODE=3 _I_PROT=0
ENDIF
IF _DFLACH
IF _CORCOMP==0
_STR_PROT="_R_PROT[2]=$TC_DP"<<(5+_I_PROT)<<"[_T_7]"<<" "<<"_R_PROT[1]=$TC_DP"<<(4+_I_PROT)<<"[_T_7]"<<" "<<"_R_PROT[0]=$TC_DP"<<(3+_I_PROT)<<"[_T_7]"
EXECSTRING(_STR_PROT)
_PROTVAL[25]=SET(""<<_R_PROT[0],""<<_R_PROT[1],""<<_R_PROT[2],"")
IF _H_T_3==3
_PROTVAL[24+ _H_T_3]="$TC_DP"<<(5+_I_PROT)<<"["<<_T_7<<"],"<<_R_PROT[2]
ELSE
IF _H_T_3==2
_PROTVAL[24+ _H_T_3]="$TC_DP"<<(4+_I_PROT)<<"["<<_T_7<<"],"<<_R_PROT[1]
ELSE
_PROTVAL[24+ _H_T_3]="$TC_DP"<<(3+_I_PROT)<<"["<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ELSE
IF _CORCOMP==6
_STR_PROT="_R_PROT[0]=$TC_DP"<<(6+_I_PROT)<<"[_T_7]"
EXECSTRING(_STR_PROT)
_PROTVAL[28]="$TC_DP"<<(6+_I_PROT)<<"["<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ELSE
IF _CORCOMP==0
_STR_PROT="_R_PROT[2]=$TC_DP"<<(5+_I_PROT)<<"[_TCOR,_T_7]"<<" "<<"_R_PROT[1]=$TC_DP"<<(4+_I_PROT)<<"[_TCOR,_T_7]"<<" "<<"_R_PROT[0]=$TC_DP"<<(3+_I_PROT)<<"[_TCOR,_T_7]"
EXECSTRING(_STR_PROT)
_PROTVAL[25]=SET(""<<_R_PROT[0],""<<_R_PROT[1],""<<_R_PROT[2],"")
IF _H_T_3 ==3
_PROTVAL[24+ _H_T_3]="$TC_DP"<<(5+_I_PROT)<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[2]
ELSE
IF _H_T_3 ==2
_PROTVAL[24+ _H_T_3]="$TC_DP"<<(4+_I_PROT)<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[1]
ELSE
_PROTVAL[24+ _H_T_3]="$TC_DP"<<(3+_I_PROT)<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ELSE
IF _CORCOMP==6
_STR_PROT="_R_PROT[0]=$TC_DP"<<(6+_I_PROT)<<"[_TCOR,_T_7]"
EXECSTRING(_STR_PROT)
_PROTVAL[28]="$TC_DP"<<(6+_I_PROT)<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ENDIF
ELSE
IF (_DLNUM>$MN_MM_MAX_SUMCORR_PER_CUTTEDGE)
GOTOF _AL22
ENDIF
IF (_DLNUM<0)
GOTOF _AL22
ELSE
IF ((_DLNUM==0)AND(_T_2<2))
GOTOF _AL22
ENDIF
ENDIF
IF NOT($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B100000000')
GOTOF _AL24
ENDIF
_OVI[13]=_DLNUM
IF (_I_CH_8==1)
IF NOT($MN_MM_KIND_OF_SUMCORR B_AND 'B10000')
GOTOF _AL25
ENDIF
_COMP="E" _CORMODE=1
ELSE
IF (_I_CH_6==0)
_COMP="S" _CORMODE=1
ELSE
IF NOT($MN_MM_KIND_OF_SUMCORR B_AND 'B10000')
GOTOF _AL25
ENDIF
_COMP="ES" _CORMODE=3
ENDIF
ENDIF
IF _DFLACH
IF _CORCOMP==0
_STR_PROT="_R_PROT[2]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"5"<<"["<<_T_7<<"]"<<" "<<"_R_PROT[1]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"4"<<"["<<_T_7<<"]"<<" "<<"_R_PROT[0]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"3"<<"["<<_T_7<<"]"
EXECSTRING(_STR_PROT)
_PROTVAL[25]=SET(""<<_R_PROT[0],""<<_R_PROT[1],""<<_R_PROT[2],"")
IF _H_T_3==3
_PROTVAL[24+ _H_T_3]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"5"<<"["<<_T_7<<"],"<<_R_PROT[2]
ELSE
IF _H_T_3==2
_PROTVAL[24+ _H_T_3]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"4"<<"["<<_T_7<<"],"<<_R_PROT[1]
ELSE
_PROTVAL[24+ _H_T_3]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"3"<<"["<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ELSE
IF _CORCOMP==6
_STR_PROT="_R_PROT[0]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"6"<<"["<<_T_7<<"]"
EXECSTRING(_STR_PROT)
_PROTVAL[28]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"6"<<"["<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ELSE
IF _CORCOMP==0
_STR_PROT="_R_PROT[2]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"5"<<"["<<_TCOR<<","<<_T_7<<"]"<<" "<<"_R_PROT[1]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"4"<<"["<<_TCOR<<","<<_T_7<<"]"<<" "<<"_R_PROT[0]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"3"<<"["<<_TCOR<<","<<_T_7<<"]"
EXECSTRING(_STR_PROT)
_PROTVAL[25]=SET(""<<_R_PROT[0],""<<_R_PROT[1],""<<_R_PROT[2],"")
IF _H_T_3==3
_PROTVAL[24+ _H_T_3]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"5"<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[2]
ELSE
IF _H_T_3==2
_PROTVAL[24+ _H_T_3]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"4"<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[1]
ELSE
_PROTVAL[24+ _H_T_3]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"3"<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ELSE
IF _CORCOMP==6
_STR_PROT="_R_PROT[0]=$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"6"<<"["<<_TCOR<<","<<_T_7<<"]"
EXECSTRING(_STR_PROT)
_PROTVAL[28]="$TC_"<<SUBSTR(_COMP,0,1)<<"CP"<<_DLNUM<<"6"<<"["<<_TCOR<<","<<_T_7<<"],"<<_R_PROT[0]
ENDIF
ENDIF
ENDIF
ENDIF
_PROT_E:
_H_TC=$P_TC
IF _H_TC AND _I_NC_7 AND (_T_2<2)
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') GOTOF _AL27
_T_5=$P_GG[8] _T_5=_T_5+($P_GG[52]*1000) _T_5=_T_5+($P_GG[53]*100000)
TCARR=0
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B10000')
$P_WPFRAME=(INVFRAME($P_WPFRAME):$P_WPFRAME)
ENDIF
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100')
PAROTOF
ENDIF
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
ENDIF
IF (_HI_GG)AND(_T_2<2)
_HR_GG=$P_GG[6] _HI_GG=_HI_GG - 16
G[6]=_HI_GG
ENDIF
IF (_T_3 < 4)AND(_T_6 < 2)AND(_T_2==0)AND(_I_CH_6==1)AND((_OVI[2]==978)OR(_OVI[2]==974))
IF _T_4==1
_H_OVR20=_H_OVR20*(-1) _OVR[20]=_OVR[20]*(-1)
ENDIF
_CORVAL[0]=_H_OVR20
IF ISFILE("/_N_CST_DIR/_N_CYCLE197_SPF") OR ISFILE("/_N_CST_DIR/_N_CYCLE197_CPF")
CYCLE197(_CORVAL,_CORMODE,_COMP,_MAV,_T_3,_T_4,1)
ENDIF
ELSE
IF _T_4==1
_H_OVR20=_H_OVR20*(-1) _OVR[20]=_OVR[20]*(-1)
ENDIF
_CORVAL[0]=_H_OVR20
ENDIF
IF (($MCS_TECHNOLOGY == 2) AND ($MCS_TECHNOLOGY_EXTENSION == 1) AND ($TC_DPROT[_OVI[8],_OVI[0]]<>0) AND ($SC_TOOL_ORI_CONST_T == 18) AND ((_TTYP>=400) AND (_TTYP<=599)))
_DPROT=$TC_DPROT[_OVI[8],_OVI[0]]
$TC_DPROT[_OVI[8],_OVI[0]] = 0
ENDIF
IF ((_DLNUM==0)AND( _T_2==3))
_OVI[11]=-1 _OVI[12]=SETTCOR(_CORVAL,_COMP,_CORCOMP,_CORMODE,_GEOAX,_I_TENV,_TCOR,_OVI[0])
ELSE
_OVI[11]=-1 _OVI[12]=SETTCOR(_CORVAL,_COMP,_CORCOMP,_CORMODE,_GEOAX,_I_TENV,_TCOR,_OVI[0],_DLNUM)
ENDIF
IF (_DPROT<>0)
$TC_DPROT[_OVI[8],_OVI[0]] = _DPROT
ENDIF
IF (_T_3 < 4)AND(_T_6 < 2)AND(_T_2==0)AND(_I_CH_6==1)AND((_OVI[2]==978)OR(_OVI[2]==974))
IF ISFILE("/_N_CST_DIR/_N_CYCLE197_SPF") OR ISFILE("/_N_CST_DIR/_N_CYCLE197_CPF")
CYCLE197(_CORVAL,_CORMODE,_COMP,_MAV,_T_3,_T_4,2)
ENDIF
ENDIF
IF _HR_GG AND(_T_2<2)
G[6]=_HR_GG
ENDIF
IF _H_TC AND _I_NC_7 AND(_T_2<2)
$P_CYCFRAME=CTRANS()
_T_7=_T_5 MOD 1000
G[8]=_T_7
TCARR=_H_TC
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100')
_T_7=_T_5 DIV 1000 MOD 100
G[52]=_T_7
ENDIF
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1000')
_T_7=_T_5 DIV 100000 MOD 100
G[53]=_T_7
ENDIF
ENDIF
IF (_OVI[12]<>0)
_OVI[11]=0
CASE(_OVI[12]) OF -1 GOTOF _AL21 -2 GOTOF _AL21 -4 GOTOF _AL5 -5 GOTOF _AL8 -6 GOTOF _AL22 -7 GOTOF _AL26 -8 GOTOF _AL26 -14 GOTOF _AL25 DEFAULT GOTOF _AL20
ENDIF
_FIN: _OVI[11]=1
RET
N120 _AL1: _OVI[9]=61318
N611401 SETAL(_OVI[9])
N125 RET
N160 _AL5: _OVI[9]=61320
N611405 SETAL(_OVI[9])
N165 RET
N170 _AL7: _OVI[9]=61319
N611407 SETAL(_OVI[9])
N175 RET
N180 _AL8: _OVI[9]=61328
N611408 SETAL(_OVI[9])
N185 RET
N190 _AL11: _OVI[9]=61342
N611411 SETAL(_OVI[9])
N195 RET
N200 _AL12: _OVI[9]=61345
N611412 SETAL(_OVI[9])
N205 RET
N210 _AL20: _OVI[9]=61404
N611420 SETAL(_OVI[9])
N215 RET
N220 _AL21: _OVI[9]=61405
N611421 SETAL(_OVI[9])
N225 RET
N230 _AL22: _OVI[9]=61406
N611422 SETAL(_OVI[9])
N235 RET
N250 _AL24: _OVI[9]=61408
N611424 SETAL(_OVI[9])
N255 RET
N260 _AL25: _OVI[9]=61409
N611425 SETAL(_OVI[9])
N270 RET
N275 _AL26: _OVI[9]=61410
N611426 SETAL(_OVI[9])
N276 RET
_AL27: _ALARM=61016
N277 RET
N280 _AL28: _OVI[9]=61404
N611428 SETAL(_OVI[9])
N281 RET
N282 _AL29: _OVI[9]=61972
N611429 SETAL(_OVI[9])
N283 RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE115_SPF
PROC CYCLE115(VAR INT _ALARM,AXIS _MAV,BOOL _ADD,INT _SLINE) ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.20.00.00.005 ; DATE: 2022-01-07
DEF FRAME _TMPFR
DEF REAL _DELTKOR[3],_IWCOP[3]
DEF AXIS _XX,_YY,_ZZ,_PLAN
DEF INT _H,_A,_O=1,_AP=2,_AX_EX[3]
DEF INT _TEMP,_H1,_I_PLAN,_FM=1,_IM=1,_H_XX=1,_H_YY=1,_H_ZZ=1,_I_L,_I_LA,_I_LO,_I_LAP
DEF INT _M_BFNR,_KNDEC,_TEMP2,_TEMP3,_TEMP4,_STYPE,_GH,_GHA,_FRSEL,_FITRANS,_RJUMP
_OVI[11]=0
IF ($AN_NCK_VERSION<660000) GOTOF _AL10
IF $P_SEARCH OR $P_ISTEST OR $P_DRYRUN AND (_OVI[19]<> 130)
RET
ENDIF
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1
IF $P_GG[6]==1 GOTOF _P1
_A=2 _O=0 _AP=1
IF $P_GG[6]==2 GOTOF _P1
_A=1 _O=2 _AP=0
_P1: IF ISAXIS(_A+1) GOTOF _P3 IF NOT ISAXIS(_O+1) GOTOF _P2
_XX=$P_AXN2 _A=_O
GOTOF _P4
_P2:_XX=$P_AXN3 _A=_AP
GOTOF _P4
_P3:_XX=$P_AXN1 _AX_EX[0]=1
_P4:IF ISAXIS(_O+1) GOTOF _P5
_O=_A _YY=_XX
GOTOF _P6
_P5:_YY=$P_AXN2 _AX_EX[1]=1
_P6:IF ISAXIS(_AP+1) GOTOF _P7
_AP=_A _ZZ=_XX
GOTOF _P8
_P7:_ZZ=$P_AXN3 _AX_EX[2]=1
_P8:_PLAN=_XX _I_L=_SMI_R[9] _I_LA=_I_L MOD 10 _I_LO=_I_L DIV 10 MOD 10 _I_LAP=_I_L DIV 100 MOD 10
IF ($MC_DIAMETER_AX_DEF=="") GOTOF _MM1
IF (_AX_EX[0]==1)AND($MC_DIAMETER_AX_DEF==AXSTRING(_XX)) GOTOF _MM0
_H1=1 _PLAN=_YY
IF (_AX_EX[1]==1)AND($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) GOTOF _MM0
_H1=2 _PLAN=_ZZ
IF (_AX_EX[2]==1)AND($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) GOTOF _MM0
GOTOF _MM1
_MM0: _I_PLAN=1
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000')
_FM=2
IF _PLAN==_XX
_H_XX=2
ELSE
IF _PLAN==_YY
_H_YY=2
ELSE
_H_ZZ=2
ENDIF
ENDIF
ENDIF
IF (($P_GG[29]==1) OR ($P_GG[29]==4)) AND ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
_IM=2
ENDIF
_MM1:
IF(_KNUM<=0) GOTOF _AL6
IF (_KNUM<1000)
_TEMP3=$MN_MM_NUM_GLOBAL_USER_FRAMES
IF (_TEMP3==0)
_TEMP3=$MC_MM_NUM_USER_FRAMES
ENDIF
IF (_KNUM<_TEMP3)
_KNDEC=1
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ENDIF
IF (_KNUM==1000)
IF ($MC_MM_NUM_BASE_FRAMES>0)
_KNDEC=2
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ENDIF
IF ((_KNUM>1010)AND(_KNUM<=($MC_MM_NUM_BASE_FRAMES+1010)))
_KNDEC=3
GOTOF _KNOK
ENDIF
IF ((_KNUM>1050)AND(_KNUM<=($MN_MM_NUM_GLOBAL_BASE_FRAMES+1050)))
_KNDEC=4
GOTOF _KNOK
ENDIF
IF (_KNUM==2000)
IF ISVAR("$MC_MM_SYSTEM_DATAFRAME_MASK")
IF (($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')AND($MC_MM_SYSTEM_DATAFRAME_MASK B_AND 'B1'))
_KNDEC=5
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ELSE
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')
_KNDEC=5
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ENDIF
ENDIF
IF (_KNUM==9999)
_KNDEC=6
IF ($P_GG[8]==1)
IF (($P_CHBFRMASK==0)OR($MC_MM_NUM_BASE_FRAMES==0))
GOTOF _AL6
ENDIF
_KNDEC=7
ENDIF
GOTOF _KNOK
ENDIF
GOTOF _AL6
_KNOK:
_GHA=$P_GG[8] _GH=$P_GG[8]
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0 $AC_MEAS_TOOL_MASK=11
IF _AX_EX[0]
$AA_MEAS_POINT1[_XX]=$AA_IW[_XX]
ENDIF
IF _AX_EX[1]
$AA_MEAS_POINT1[_YY]=$AA_IW[_YY]
ENDIF
IF _AX_EX[2]
$AA_MEAS_POINT1[_ZZ]=$AA_IW[_ZZ]
ENDIF
IF (_OVI[2]==997)
$AC_MEAS_TYPE=21
_STYPE=3
$AA_MEAS_POINT1[_XX]=_OVR[5] $AA_MEAS_SETPOINT[_XX]=_OVR[1]
$AA_MEAS_POINT1[_YY]=_OVR[6] $AA_MEAS_SETPOINT[_YY]=_OVR[2]
$AA_MEAS_POINT1[_ZZ]=_OVR[7] $AA_MEAS_SETPOINT[_ZZ]=_OVR[3]
IF (_I_PLAN)
$AA_MEAS_POINT1[_PLAN]=$AA_MEAS_POINT1[_PLAN]*_IM
$AA_MEAS_SETPOINT[_PLAN]=$AA_MEAS_SETPOINT[_PLAN]*_IM
ENDIF
GOTOF _EINOK
ENDIF
IF(_OVI[2]==978)OR(_OVI[2]==974)OR(_OVI[2]==994)OR(_SLINE==2)
$AC_MEAS_TYPE=19
_STYPE=1
$AA_MEAS_POINT1[_MAV]=_OVR[4+_MA] $AA_MEAS_SETPOINT[_MAV]=_OVR[_MA]
ELSE
$AC_MEAS_TYPE=20
_STYPE=2
IF (_OVI[2]==977) AND ((_MVAR MOD 10==5) OR (_MVAR MOD 10==6))
_H=1
ENDIF
$AA_MEAS_POINT1[_XX]=_OVR[5+_H] $AA_MEAS_POINT1[_YY]=_OVR[6+_H] $AA_MEAS_SETPOINT[_XX]=_OVR[1+_H] $AA_MEAS_SETPOINT[_YY]=_OVR[2+_H]
ENDIF
IF (_I_PLAN)
IF (($AC_MEAS_TYPE==19)AND(_MAV==_PLAN))
$AA_MEAS_POINT1[_PLAN]=$AA_MEAS_POINT1[_PLAN]*_IM
$AA_MEAS_SETPOINT[_PLAN]=$AA_MEAS_SETPOINT[_PLAN]*_IM
ENDIF
IF (($AC_MEAS_TYPE==20)AND((_XX==_PLAN)OR(_YY==_PLAN)))
$AA_MEAS_POINT1[_PLAN]=$AA_MEAS_POINT1[_PLAN]*_IM
$AA_MEAS_SETPOINT[_PLAN]=$AA_MEAS_SETPOINT[_PLAN]*_IM
ENDIF
ENDIF
_EINOK:
CASE(_KNDEC) OF 1 GOTOF _DECFR1 2 GOTOF _DECFR2 3 GOTOF _DECFR3 4 GOTOF _DECFR4 5 GOTOF _DECFR5 6 GOTOF _DECFR6 7 GOTOF _DECFR7 DEFAULT GOTOF _AL6
_DECFR1: _TEMP2=_KNUM _GH=_KNUM+1
_DECFR1A:
_FRSEL=2100+_TEMP2
$AC_MEAS_FRAME_SELECT=_FRSEL
IF (_ADD==0)
$AC_MEAS_FINE_TRANS=0
STOPRE
_OVI[12]=MEASURE()
IF (_OVI[12]<>0) GOTOF _AL11
_OVI[11]=-1 $P_UIFR[_TEMP2]=$AC_MEAS_FRAME
ELSE
IF $MN_MM_FRAME_FINE_TRANS
_RJUMP=1 _FITRANS=1
GOTOF _FRADD
ELSE
IF $MNS_MEA_FUNCTION_MASK B_AND 'B100000'
$AC_MEAS_FINE_TRANS=0
STOPRE
_OVI[12]=MEASURE()
IF (_OVI[12]<>0) GOTOF _AL11
_OVI[11]=-1 $P_UIFR[_TEMP2]=$AC_MEAS_FRAME
ELSE
_RJUMP=11 _FITRANS=0
GOTOF _FRADD
ENDIF
ENDIF
ENDIF
_PROTVAL[25] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_TEMP2<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_TEMP2<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN111
_FRIN1:
IF _AX_EX[0]
$P_UIFR[_TEMP2,_XX,FI]=$P_UIFR[_TEMP2,_XX,FI]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_UIFR[_TEMP2,_YY,FI]=$P_UIFR[_TEMP2,_YY,FI]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_UIFR[_TEMP2,_ZZ,FI]=$P_UIFR[_TEMP2,_ZZ,FI]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_XX)<<",FI]" _PROTVAL[26] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_YY)<<",FI]" _PROTVAL[27] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_ZZ)<<",FI]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_TEMP2<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_TEMP2<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN111
_FRIN11:
IF _AX_EX[0]
$P_UIFR[_TEMP2,_XX,TR]=$P_UIFR[_TEMP2,_XX,TR]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_UIFR[_TEMP2,_YY,TR]=$P_UIFR[_TEMP2,_YY,TR]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_UIFR[_TEMP2,_ZZ,TR]=$P_UIFR[_TEMP2,_ZZ,TR]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_TEMP2<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_TEMP2<<","<<_STYPE<<",,,"
ENDIF
_FRIN111:
IF(_KNDEC==6)OR((_KNDEC==1)AND(_GHA==_GH))
G[8]=_GH
ENDIF
GOTOF _FIN
_DECFR2: _GH=1
_FRSEL=3010+_M_BFNR
_DECFR2A: $AC_MEAS_FRAME_SELECT=_FRSEL
IF (_ADD==0)
$AC_MEAS_FINE_TRANS=0
STOPRE
_OVI[12]=MEASURE()
IF (_OVI[12]<>0) GOTOF _AL11
_OVI[11]=-1 $P_CHBFR[_M_BFNR]=$AC_MEAS_FRAME
ELSE
IF $MN_MM_FRAME_FINE_TRANS
_RJUMP=2 _FITRANS=1
GOTOF _FRADD
ELSE
_RJUMP=21 _FITRANS=0
GOTOF _FRADD
ENDIF
ENDIF
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN211
_FRIN2:
IF _AX_EX[0]
$P_CHBFR[_M_BFNR,_XX,FI]=$P_CHBFR[_M_BFNR,_XX,FI]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_CHBFR[_M_BFNR,_YY,FI]=$P_CHBFR[_M_BFNR,_YY,FI]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_CHBFR[_M_BFNR,_ZZ,FI]=$P_CHBFR[_M_BFNR,_ZZ,FI]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",FI]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",FI]" _PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",FI]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN211
_FRIN21:
IF _AX_EX[0]
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
_FRIN211:
G[8]=_GHA
GOTOF _FIN
_DECFR3:
_M_BFNR=_KNUM-1011
_FRSEL=2010+_M_BFNR
GOTOB _DECFR2A
_DECFR4: _M_BFNR=_KNUM-1051
_FRSEL=2050+_M_BFNR
$AC_MEAS_FRAME_SELECT=_FRSEL
IF (_ADD==0)
$AC_MEAS_FINE_TRANS=0
STOPRE
_OVI[12]=MEASURE()
IF (_OVI[12]<>0) GOTOF _AL11
_OVI[11]=-1 $P_NCBFR[_M_BFNR]=$AC_MEAS_FRAME
ELSE
IF $MN_MM_FRAME_FINE_TRANS
_RJUMP=4 _FITRANS=1
GOTOF _FRADD
ELSE
_RJUMP=41 _FITRANS=0
GOTOF _FRADD
ENDIF
ENDIF
_PROTVAL[25] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN411
_FRIN4:
IF _AX_EX[0]
$P_NCBFR[_M_BFNR,_XX,FI]=$P_NCBFR[_M_BFNR,_XX,FI]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_NCBFR[_M_BFNR,_YY,FI]=$P_NCBFR[_M_BFNR,_YY,FI]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_NCBFR[_M_BFNR,_ZZ,FI]=$P_NCBFR[_M_BFNR,_ZZ,FI]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",FI]" _PROTVAL[26] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",FI]" _PROTVAL[27] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",FI]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN411
_FRIN41:
IF _AX_EX[0]
$P_NCBFR[_M_BFNR,_XX,TR]=$P_NCBFR[_M_BFNR,_XX,TR]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_NCBFR[_M_BFNR,_YY,TR]=$P_NCBFR[_M_BFNR,_YY,TR]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_NCBFR[_M_BFNR,_ZZ,TR]=$P_NCBFR[_M_BFNR,_ZZ,TR]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
_FRIN411:
G[8]=_GHA
GOTOF _FIN
_DECFR5: _FRSEL=2000 $AC_MEAS_FRAME_SELECT=_FRSEL
IF (_ADD==0)
$AC_MEAS_FINE_TRANS=0
STOPRE
_OVI[12]=MEASURE()
IF (_OVI[12]<>0) GOTOF _AL11
_OVI[11]=-1 $P_SETFR=$AC_MEAS_FRAME
ELSE
IF _SLINE
IF $MN_MM_FRAME_FINE_TRANS
_RJUMP=5 _FITRANS=1
GOTOF _FRADD
ELSE
_RJUMP=51 _FITRANS=0
GOTOF _FRADD
ENDIF
ELSE
_RJUMP=51 _FITRANS=0
GOTOF _FRADD
ENDIF
ENDIF
_PROTVAL[25] ="$P_SETFR["<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_SETFR["<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN511
_FRIN5:
IF _AX_EX[0]
$P_SETFR[_XX,FI]=$P_SETFR[_XX,FI]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_SETFR[_YY,FI]=$P_SETFR[_YY,FI]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_SETFR[_ZZ,FI]=$P_SETFR[_ZZ,FI]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_SETFR["<<AXSTRING(_XX)<<",FI]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",FI]" _PROTVAL[27] ="$P_SETFR["<<AXSTRING(_ZZ)<<",FI]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
GOTOF _FRIN511
_FRIN51:
IF _AX_EX[0]
$P_SETFR[_XX,TR]=$P_SETFR[_XX,TR]+_DELTKOR[0]
ENDIF
IF _AX_EX[1]
$P_SETFR[_YY,TR]=$P_SETFR[_YY,TR]+_DELTKOR[1]
ENDIF
IF _AX_EX[2]
$P_SETFR[_ZZ,TR]=$P_SETFR[_ZZ,TR]+_DELTKOR[2]
ENDIF
_PROTVAL[25] ="$P_SETFR["<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",TR]" _PROTVAL[27] ="$P_SETFR["<<AXSTRING(_ZZ)<<",TR]"
IF _STYPE == 1
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<","<<AXSTRING(_MAV)<<",,"
ELSE
_PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<","<<_STYPE<<",,,"
ENDIF
_FRIN511:
G[8]=_GHA
GOTOF _FIN
_DECFR6: _TEMP2=$P_UIFRNUM
GOTOB _DECFR1A
_DECFR7: _TEMP2=0 _TEMP3=1 _M_BFNR=$MC_MM_NUM_BASE_FRAMES
FOR _TEMP4=1 TO _M_BFNR
IF ($P_CHBFRMASK B_AND _TEMP3)
_TEMP2=_TEMP4-1
ENDIF
_TEMP3=_TEMP3*2
ENDFOR
_M_BFNR=_TEMP2
_FRSEL=2010+_M_BFNR
GOTOB _DECFR2A
_FRADD:
IF _AX_EX[0]
_IWCOP[0]=$AA_MEAS_POINT1[_XX]
ENDIF
IF _AX_EX[1]
_IWCOP[1]=$AA_MEAS_POINT1[_YY]
ENDIF
IF _AX_EX[2]
_IWCOP[2]=$AA_MEAS_POINT1[_ZZ]
ENDIF
$AC_MEAS_FRAME_SELECT=_FRSEL
$AC_MEAS_FINE_TRANS=_FITRANS
STOPRE
_OVI[12]=MEASURE()
IF (_OVI[12]<>0) GOTOF _AL11
_TMPFR=$AC_MEAS_FRAME
$AC_MEAS_VALID=0 $AC_MEAS_TOOL_MASK=11
IF (_STYPE==1)
$AC_MEAS_TYPE=19
$AA_MEAS_SETPOINT[_MAV]=_IWCOP[_MA-1]
GOTOF _LAUF2
ENDIF
IF (_STYPE==2)
$AC_MEAS_TYPE=20
$AA_MEAS_SETPOINT[_XX]=_IWCOP[0]
$AA_MEAS_SETPOINT[_YY]=_IWCOP[1]
GOTOF _LAUF2
ENDIF
IF (_STYPE==3)
$AC_MEAS_TYPE=21
$AA_MEAS_SETPOINT[_XX]=_IWCOP[0]
$AA_MEAS_SETPOINT[_YY]=_IWCOP[1]
$AA_MEAS_SETPOINT[_ZZ]=_IWCOP[2]
ENDIF
_LAUF2:
IF _AX_EX[0]
$AA_MEAS_POINT1[_XX]=_IWCOP[0]
ENDIF
IF _AX_EX[1]
$AA_MEAS_POINT1[_YY]=_IWCOP[1]
ENDIF
IF _AX_EX[2]
$AA_MEAS_POINT1[_ZZ]=_IWCOP[2]
ENDIF
$AC_MEAS_FRAME_SELECT=_FRSEL
$AC_MEAS_FINE_TRANS=_FITRANS
STOPRE
_OVI[12]=MEASURE()
if (_OVI[12]<>0) GOTOF _AL11
IF _FITRANS
IF _AX_EX[0]
_DELTKOR[0]=_TMPFR[_XX,FI]-$AC_MEAS_FRAME[_XX,FI]
ENDIF
IF _AX_EX[1]
_DELTKOR[1]=_TMPFR[_YY,FI]-$AC_MEAS_FRAME[_YY,FI]
ENDIF
IF _AX_EX[2]
_DELTKOR[2]=_TMPFR[_ZZ,FI]-$AC_MEAS_FRAME[_ZZ,FI]
ENDIF
ELSE
IF _AX_EX[0]
_DELTKOR[0]=_TMPFR[_XX,TR]-$AC_MEAS_FRAME[_XX,TR]
ENDIF
IF _AX_EX[1]
_DELTKOR[1]=_TMPFR[_YY,TR]-$AC_MEAS_FRAME[_YY,TR]
ENDIF
IF _AX_EX[2]
_DELTKOR[2]=_TMPFR[_ZZ,TR]-$AC_MEAS_FRAME[_ZZ,TR]
ENDIF
ENDIF
_OVI[11]=-1
CASE(_RJUMP) OF 1 GOTOB _FRIN1 2 GOTOB _FRIN2 4 GOTOB _FRIN4 5 GOTOB _FRIN5 11 GOTOB _FRIN11 21 GOTOB _FRIN21 41 GOTOB _FRIN41 51 GOTOB _FRIN51 DEFAULT GOTOF _AL6
_FIN:
IF (_ADD==0)AND(_STYPE<>3)AND(_SMI_R[10]<>0)AND(_SMI_R[10]<>11)
G[8]=_GH
IF _AX_EX[0]
_OVR[25]=$AA_IW[_XX]
ENDIF
IF _AX_EX[1]
_OVR[26]=$AA_IW[_YY]
ENDIF
IF _AX_EX[2]
_OVR[27]=$AA_IW[_ZZ]
ENDIF
IF _STYPE==2
_OVR[25]=$AA_MEAS_SETPOINT[_XX] _OVR[26]=$AA_MEAS_SETPOINT[_YY]
ELSE
_OVR[24+_MA]=$AA_MEAS_SETPOINT[_MAV]
ENDIF
G[8]=_GHA
ENDIF
N700 _OVI[11]=1
$AC_MEAS_SEMA=0
RET
N820 _AL6: _OVI[9]=61321 _OVI[11]=0
N825 $AC_MEAS_SEMA=0
N611506 SETAL(_OVI[9])
N829 RET
N830 _AL10: _OVI[9]=61342 _OVI[11]=0
N835 $AC_MEAS_SEMA=0
N611510 SETAL(_OVI[9])
N839 RET
N840 _AL11: _OVI[9]=61403 _OVI[11]=0
N845 $AC_MEAS_SEMA=0
N611511 SETAL(_OVI[9])
N849 RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE116_SPF
PROC CYCLE116 (VAR REAL _CAL[],VAR INT _ALARM) ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.06.01.00 ;DATE: 2012-07-30
N20 DEF REAL _F_E3[3,2],_F_E4[4,2],_F_A[3]
N30 DEF BOOL _ERR
N45 IF((_CAL[0]<>3) AND (_CAL[0]<>4)) GOTOF _AL2
N40 _F_E3[0,0]=_CAL[1] _F_E3[0,1]=_CAL[2] _F_E3[1,0]=_CAL[3] _F_E3[1,1]=_CAL[4] _F_E3[2,0]=_CAL[5] _F_E3[2,1]=_CAL[6] _ERR=0
N50 IF _CAL[0]==3 GOTOF _MA1
N60 _F_E4[0,0]=_CAL[1] _F_E4[0,1]=_CAL[2] _F_E4[1,0]=_CAL[3] _F_E4[1,1]=_CAL[4] _F_E4[2,0]=_CAL[5] _F_E4[2,1]=_CAL[6] _F_E4[3,0]=_CAL[7] _F_E4[3,1]=_CAL[8]
N62 _ERR=CALCDAT(_F_E4,_CAL[0],_F_A)
N64 GOTOF _MA3
N70 _MA1: _ERR=CALCDAT(_F_E3,_CAL[0],_F_A)
N80 _MA3: IF (_ERR==0) GOTOF _AL1
N90 _CAL[9]=_F_A[0] _CAL[10]=_F_A[1] _CAL[11]=_F_A[2]
N100 RET
N110 _AL1: _OVI[9]=61316
N115 _CAL[12]=1
N611601 SETAL(_OVI[9])
N120 RET
N130 _AL2: _OVI[9]=61317
N130 _CAL[12]=1
N611602 SETAL(_OVI[9])
N150 RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE117_SPF
PROC CYCLE117(VAR AXIS MAV,VAR AXIS _XX,VAR AXIS _YY,VAR AXIS _ZZ,VAR INT _AXIND,VAR INT _P_KB,VAR INT _M_N[],VAR INT _ALARM,VAR BOOL _VB[],VAR BOOL _M_ZUST[],VAR BOOL _INTERN[],VAR REAL _M_SPE[],REAL _H_HR)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.03.00.094; DATE: 2018-06-13
;Messtaster_auf_Referenzmasse_positionieren, Referenzkalibrierdaten_berechnen
N110 DEF INT _I_V1,_I_V2,_KAL,_I_R,_I_PLAN,_H_V1=1,_H_V2=1
N120 DEF REAL _P_V1,_P_V2,_P_APP,_H_KB[8]
N130 DEF AXIS _V1,_V2,_PLAN
IF _OVI[2]<>973 GOTOF _AL1
IF (_INTERN[0] AND _INTERN[2])OR(_INTERN[8] AND _INTERN[10])OR(_INTERN[16] AND _INTERN[18])
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000'
_I_PLAN=1
IF _INTERN[0] AND _INTERN[2]
_PLAN=_XX
ELSE
IF _INTERN[8] AND _INTERN[10]
_PLAN=_YY
ELSE
_PLAN=_ZZ
ENDIF
ENDIF
ENDIF
ENDIF
IF ($P_TC)AND(_P_KB _DEC3)
_P_KB=_P_KB MOD 10
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=_KB[_P_KB,2] $AA_MEAS_POINT1[_ZZ]=0 $AA_MEAS_POINT1[_YY]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[2]=$AA_MEAS_POINT2[_XX]
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=_KB[_P_KB,3] $AA_MEAS_POINT1[_ZZ]=0 $AA_MEAS_POINT1[_YY]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[3]=$AA_MEAS_POINT2[_XX]
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=_KB[_P_KB,4] $AA_MEAS_POINT1[_ZZ]=0 $AA_MEAS_POINT1[_YY]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[4]=$AA_MEAS_POINT2[_XX]
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=0 $AA_MEAS_POINT1[_YY]=_KB[_P_KB,0] $AA_MEAS_POINT1[_ZZ]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[0]=$AA_MEAS_POINT2[_YY]
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=0 $AA_MEAS_POINT1[_YY]=_KB[_P_KB,1] $AA_MEAS_POINT1[_ZZ]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[1]=$AA_MEAS_POINT2[_YY]
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=0 $AA_MEAS_POINT1[_YY]=_KB[_P_KB,5] $AA_MEAS_POINT1[_ZZ]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[5]=$AA_MEAS_POINT2[_YY]
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=0 $AA_MEAS_POINT1[_YY]=_KB[_P_KB,6] $AA_MEAS_POINT1[_ZZ]=0
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0 GOTOF _AL5
_H_KB[6]=$AA_MEAS_POINT2[_YY]
ELSE
_P_KB=_P_KB MOD 10
_H_KB[0]=_KB[_P_KB,0] _H_KB[1]=_KB[_P_KB,1] _H_KB[2]=_KB[_P_KB,2] _H_KB[3]=_KB[_P_KB,3]
_H_KB[4]=_KB[_P_KB,4] _H_KB[5]=_KB[_P_KB,5] _H_KB[6]=_KB[_P_KB,6]
ENDIF
_KAL=_MVAR MOD 10 _I_R=_M_ZUST[_AXIND*2+1]
CASE _KAL OF 3 GOTOF _M5 DEFAULT GOTOF _AL2
_M5:CASE $P_ADT[2] OF 8 GOTOF _M58 7 GOTOF _M57 DEFAULT GOTOF _AL3
_M58: _P_V1=((_H_KB[3]+_H_KB[4])/2)*_M_SPE[29] _P_V2=(_H_KB[6]+_M_SPE[3]+_H_HR)*_M_SPE[29] _V1=_XX _V2=_YY _I_V2=1
_M_SPE[16]=_H_KB[3+_I_R] _M_SPE[15]=_H_KB[4]
IF _MA==1 GOTOF _M6
_M_SPE[16]=_H_KB[6] _M_SPE[15]=_H_KB[6]
GOTOF _M6
_M57: _P_V1=((_H_KB[0]+_H_KB[1])/2)*_M_SPE[29] _P_V2=(_H_KB[2]+_M_SPE[3]+_H_HR)*_M_SPE[29] _V1=_YY _V2=_XX _I_V1=1
_M_SPE[16]=_H_KB[0+_I_R] _M_SPE[15]=_H_KB[1]
IF _MA==2 GOTOF _M6
_M_SPE[16]=_H_KB[2] _M_SPE[15]=_H_KB[2]
_M6:IF _I_PLAN==0 GOTOF _M61
IF _PLAN==_V1
_H_V1=2
ELSE
IF _PLAN==_V2
_H_V2=2
ENDIF
ENDIF
_M61:IF _INTERN[40+2]==0 GOTOF _M52
IF $AA_IW[_V1]/_H_V1==_P_V1 GOTOF _M51
N140 MEAS=_M_N[0] AX[_V1]=_P_V1
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _AL4
_M51:IF $AA_IW[_V2]/_H_V2==_P_V2 GOTOF _M52
N141 MEAS=_M_N[0] AX[_V2]=_P_V2
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _AL4
GOTOF _M53
N160 _M52:AX[_V1]=_P_V1
N170 AX[_V2]=_P_V2
_M53: _M_SPE[5+_I_V1]=_P_V1/_M_SPE[29] _M_SPE[5+_I_V2]=_P_V2/_M_SPE[29]
RET
_AL1: _ALARM=61332
RET
_AL2: _ALARM=61307
RET
_AL3: _ALARM=61333
RET
_AL4: _ALARM=61302
RET
_AL5: _ALARM=61403
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE119_SPF
PROC CYCLE119(VAR REAL _SETPOINT[3,3],VAR REAL _MEASPOINT[3,3],VAR INT _ALARM,VAR REAL _RES,VAR FRAME _REFRAME,INT _COR,REAL _RESLIM) ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.01.00 ;DATE: 2014-02-10
;CYCLE : Arithmetic cycle for determining position in space
N100 DEF INT _M_BFNR,_TEMP2,_TEMP3,_TEMP4,_KNDEC,_ITEMP,_GH
N101 DEF AXIS _I_XX,_I_YY,_I_ZZ
N102 DEF FRAME _TMPFRAME
N103 DEF STRING[8] _PRNA
IF ($AN_NCK_VERSION<720000) GOTOF _AL10
_ALARM=0
IF ((NOT ISAXIS(1))OR(NOT ISAXIS(2))OR(NOT ISAXIS(3))) GOTOF _AL3
_I_XX=$P_AXN1 _I_YY=$P_AXN2 _I_ZZ=$P_AXN3
IF ($P_ACTFRAME[_I_XX,SC]<>1)OR($P_ACTFRAME[_I_YY,SC]<>1)OR($P_ACTFRAME[_I_ZZ,SC]<>1) GOTOF _AL5
_REFRAME=MEAFRAME(_SETPOINT,_MEASPOINT,_RES)
IF (_RES<0) GOTOF _AL1
IF _COR==0 GOTOF _FIN
IF (_RES>=_RESLIM) GOTOF _AL4
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 _PRNA=SUBSTR($P_PROG[$P_STACK-1],3,8)
_GH=$P_GG[8]
IF(_COR<=0) GOTOF _AL6
IF (_COR<1000)
IF ($MN_MM_NUM_GLOBAL_USER_FRAMES>0)
GOTOF _AL6
ENDIF
IF (_COR<$MC_MM_NUM_USER_FRAMES)
_KNDEC=1
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ENDIF
IF (_COR==1000)
IF ($MC_MM_NUM_BASE_FRAMES>0)
_KNDEC=2
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ENDIF
IF ((_COR>1010)AND(_COR<=($MC_MM_NUM_BASE_FRAMES+1010)))
_KNDEC=3
GOTOF _KNOK
ENDIF
IF ((_COR>1050)AND(_COR<=($MN_MM_NUM_GLOBAL_BASE_FRAMES+1050)))
_KNDEC=4
GOTOF _KNOK
ENDIF
IF (_COR==2000)
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')
_KNDEC=5
GOTOF _KNOK
ELSE
GOTOF _AL6
ENDIF
ENDIF
IF (_COR==9999)
_KNDEC=6
IF ($P_GG[8]==1)
IF (($P_CHBFRMASK==0)OR($MC_MM_NUM_BASE_FRAMES==0))
GOTOF _AL6
ENDIF
_KNDEC=7
ENDIF
GOTOF _KNOK
ENDIF
GOTOF _AL6
_KNOK:
CASE(_KNDEC) OF 1 GOTOF _DECFR1 2 GOTOF _DECFR2 3 GOTOF _DECFR3 4 GOTOF _DECFR4 5 GOTOF _DECFR5 6 GOTOF _DECFR6 7 GOTOF _DECFR7 DEFAULT GOTOF _AL6
_DECFR1: _TEMP2=_COR
_DECFR1A:IF(_ITEMP<>0)GOTOF _AL6
_ITEMP=ADDFRAME(_REFRAME,"$P_IFRAME")
_TMPFRAME=$P_IFRAME
IF((_GH <>(_TEMP2+1))AND(_PRNA=="CYCLE997"))OR(_PRNA<>"CYCLE997")
G[8]=_GH
ENDIF
$P_UIFR[_TEMP2]=_TMPFRAME
_PROTVAL[25]="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_I_XX)<<",TR,RT]" _PROTVAL[26]="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_I_YY)<<",TR,RT]"
_PROTVAL[27]="$P_UIFR["<<_TEMP2<<","<<AXSTRING(_I_ZZ)<<",TR,RT]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<","<<_TEMP2
IF $MN_MM_FRAME_FINE_TRANS
$P_UIFR[_TEMP2,_I_XX,TR]=$P_UIFR[_TEMP2,_I_XX,TR]+$P_IFRAME[_I_XX,FI] $P_UIFR[_TEMP2,_I_XX,FI]=0 $P_UIFR[_TEMP2,_I_YY,TR]=$P_UIFR[_TEMP2,_I_YY,TR]+$P_IFRAME[_I_YY,FI] $P_UIFR[_TEMP2,_I_YY,FI]=0 $P_UIFR[_TEMP2,_I_ZZ,TR]=$P_UIFR[_TEMP2,_I_ZZ,TR]+$P_IFRAME[_I_ZZ,FI] $P_UIFR[_TEMP2,_I_ZZ,FI]=0
ENDIF
GOTOF _FIN
_DECFR2: _TEMP2=$MC_MM_NUM_BASE_FRAMES-1
_ITEMP=ADDFRAME(_REFRAME,"$P_IFRAME")
_TMPFRAME=$P_IFRAME
G[8]=_GH
IF (_ITEMP<>0) GOTOF _AL6
$P_CHBFR[_TEMP2]=$P_CHBFR[_TEMP2]:_TMPFRAME
IF (_ITEMP<>0) GOTOF _AL6
_DECFR2A:
_PROTVAL[25]="$P_CHBFR["<<_TEMP2<<","<<AXSTRING(_I_XX)<<",TR,RT]" _PROTVAL[26]="$P_CHBFR["<<_TEMP2<<","<<AXSTRING(_I_YY)<<",TR,RT]"
_PROTVAL[27]="$P_CHBFR["<<_TEMP2<<","<<AXSTRING(_I_ZZ)<<",TR,RT]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<","<<_TEMP2
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_TEMP2,_I_XX,TR]=$P_CHBFR[_TEMP2,_I_XX,TR]+$P_CHBFR[_TEMP2,_I_XX,FI] $P_CHBFR[_TEMP2,_I_XX,FI]=0 $P_CHBFR[_TEMP2,_I_YY,TR]=$P_CHBFR[_TEMP2,_I_YY,TR]+$P_CHBFR[_TEMP2,_I_YY,FI] $P_CHBFR[_TEMP2,_I_YY,FI]=0 $P_CHBFR[_TEMP2,_I_ZZ,TR]=$P_CHBFR[_TEMP2,_I_ZZ,TR]+$P_CHBFR[_TEMP2,_I_ZZ,FI] $P_CHBFR[_TEMP2,_I_ZZ,FI]=0
ENDIF
GOTOF _FIN
_DECFR3: IF(_ITEMP<>0)GOTOF _AL6
_TEMP2=_COR-1011
_ITEMP=ADDFRAME(_REFRAME,"$P_CHBFR[" <<_TEMP2 <<"]")
IF _PRNA=="CYCLE997"
G[8]=_GH
ENDIF
GOTOB _DECFR2A
_DECFR4: GOTOF _AL6
_DECFR5: IF(_ITEMP<>0)GOTOF _AL6
_ITEMP=ADDFRAME(_REFRAME,"$P_SETFR")
IF _PRNA=="CYCLE997"
G[8]=_GH
ENDIF
_PROTVAL[25]="$P_SETFR["<<AXSTRING(_I_XX)<<",TR,RT]" _PROTVAL[26]="$P_SETFR["<<AXSTRING(_I_YY)<<",TR,RT]"
_PROTVAL[27]="$P_SETFR["<<AXSTRING(_I_ZZ)<<",TR,RT]" _PROTVAL[29]="P,"<<($P_GG[6]+16)
GOTOF _FIN
_DECFR6: _TEMP2=$P_UIFRNUM
GOTOB _DECFR1A
_DECFR7:
_TEMP2=0 _TEMP3=1 _M_BFNR=$MC_MM_NUM_BASE_FRAMES
FOR _TEMP4=1 TO _M_BFNR
IF ($P_CHBFRMASK B_AND _TEMP3)
_TEMP2=_TEMP4-1
ENDIF
_TEMP3=_TEMP3*2
ENDFOR
_ITEMP=ADDFRAME(_REFRAME,"$P_CHBFR[" <<_TEMP2 <<"]")
IF (_ITEMP<>0) GOTOF _AL6
GOTOB _DECFR2A
_FIN:
N2000 RET
STOPRE
_AL1:_OVI[9]= 61411
N611901 SETAL(_OVI[9])
N5001 RET
STOPRE
_AL2:_OVI[9]= 61412
N611902 SETAL(_OVI[9])
N5002 RET
STOPRE
_Al3:_OVI[9]= 61336
N611903 SETAL(_OVI[9])
N5003 RET
STOPRE
_AL4:_OVI[9]= 61414
N611904 SETAL(_OVI[9])
N5004 RET
STOPRE
_AL5:_OVI[9]= 61310
N611905 SETAL(_OVI[9])
N5005 RET
STOPRE
_AL6:_OVI[9]= 61321
N611906 SETAL(_OVI[9])
N5006 RET
STOPRE
_AL10:_OVI[9]= 61342
N611910 SETAL(_OVI[9])
N5010 RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE122_SPF
PROC CYCLE122(INT S_MVAR,STRING[32] S_KINNAME,VAR REAL S_OFF_RA1[],VAR REAL S_OFF_RA2[],VAR REAL S_GST[],VAR REAL S_DIR_RA1[],VAR REAL S_DIR_RA2[],VAR REAL S_L[],REAL S_TOL_LIN,VAR REAL S_ACTFR_1[],INT S_DMODE,INT S_AMODE) SAVE SBLOF ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.006 ;DATE: 2024-04-16
;Correction kinematic
DEF INT _LOG_ON,_LOG,_MEA_RA[2],_MODE,_NAX,_G17_18_19,_KIN_MODE[2],_KINTYP,_KINNUM,_I,_II,_III,_CORR_INDEX,_CORR_STATUS,_CORR_MODE,_NO_ALARM,_CORR_M[3],_TRAFO_AKT,_NV_ACT,_TC_KIN,_SD55740_13,_KARD,_GST_X
DEF REAL _ERG[4,3], _CAL[44],_TOL_LIN,_CORR_VECT[3],_OLD_SECTION_T[4,3],_OLD_SECTION_P[4,3],_CARR_OLD[21],_REF_DIFF,_FAK1,_FAK2,_GST_CALC[6],_OFF_PARAL_LIN_AX[3]
DEF STRING[40] _SERR, _SN[4], _RA_NAME[2]
DEF AXIS _XX,_YY,_ZZ
DEF STRING[255] _LINE
IF (($MNS_MEA_ACCESS_EXEC==1) AND ($MN_ACCESS_EXEC_CST==7))
_SERR=<<"14 MD11160"
IF $P_ACCESSLEVEL>1 GOTOF _ERR20
ENDIF
_OVI[2]=996
CUST_MEACYC(1)
_SERR="S_KINNAME"
_SD55740_13=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H2000')
_SD55740_13=1
ENDIF
IF S_KINNAME=="" GOTOF _ERR1
_KINNUM=0
IF ((ISVAR("NAMETOINT"))AND(ISVAR("$NT_NAME"))AND(ISVAR("$NT_IDENT")))
_KINNUM=NAMETOINT("$NT_NAME",S_KINNAME,TRUE)
IF _KINNUM>0
_KINNUM=_KINNUM+1000
ELSE
GOTOF _SEARCH_TCARR
ENDIF
GOTOF _NEXT
ENDIF
_SEARCH_TCARR:
_KINNUM=1
WHILE ($TC_CARR34[_KINNUM]<>S_KINNAME)
_KINNUM=_KINNUM+1
IF (_KINNUM>$P_TCNUM) GOTOF _ERR2
ENDWHILE
_TC_KIN=($TC_CARR_KIN_CNTRL[_KINNUM] B_AND 'B1')
_NEXT:
IF $P_TRAFO_PARSET>0
_TRAFO_AKT=1
ENDIF
_G17_18_19=$P_GG[6]
_NV_ACT=$P_GG[8]
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($P_SEARCH OR $P_ISTEST) GOTOF _END
_FAK1=1 _FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF(($P_GG[13]==1) OR ($P_GG[13]==3))
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF(($P_GG[13]==2) OR ($P_GG[13]==4))
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
S_OFF_RA1[0]=SET(S_OFF_RA1[0]*_FAK1/_FAK2,S_OFF_RA1[1]*_FAK1/_FAK2,S_OFF_RA1[2]*_FAK1/_FAK2)
S_OFF_RA2[0]=SET(S_OFF_RA2[0]*_FAK1/_FAK2,S_OFF_RA2[1]*_FAK1/_FAK2,S_OFF_RA2[2]*_FAK1/_FAK2)
S_GST[0]=SET(S_GST[0]*_FAK1/_FAK2,S_GST[1]*_FAK1/_FAK2,S_GST[2]*_FAK1/_FAK2)
S_L[0]=SET(S_L[0],S_L[1],S_L[2])
_SN[0]="/_N_MPF_DIR/_N_LOG_CYCLE9960_"<<$P_CHANNO<<"_MPF"
;IF (($P_PROG_NAME[$P_STACK-1]<>"CYCLE9960") OR (($P_PROG_NAME[$P_STACK-1]=="CYCLE9960") AND (_OVR[999]==0)))
_LOG_ON=ISFILE(_SN[0])
IF ($P_PROG_NAME[$P_STACK-1]<>"CYCLE9960")
_OVR[999]=2
ENDIF
IF(_LOG_ON) AND (_OVR[999]<>0)
IF _OVR[999]==2
WRITE(_LOG,_SN[0],"; ! only for internal diagnostics ! ------------------")
WRITE(_LOG,_SN[0],";--CYCLE122----Correction Kinematic----"<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"--"<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_SN[0],";MVAR="<<S_MVAR<<" L1="<<S_L[0]<<" L2="<<S_L[1]<<" L3="<<S_L[2]<<";  G"<<_G17_18_19+16<<" SD55740="<<$SCS_MEA_FUNCTION_MASK)
IF _KINNUM>=1001
WRITE(_LOG,_SN[0],";NAME="<<S_KINNAME<<" ;TRAFO KC: NO="<<_KINNUM-1000)
ELSE
WRITE(_LOG,_SN[0],";NAME="<<S_KINNAME<<" ;TCARR: NO="<<_KINNUM)
ENDIF
ENDIF
WRITE(_LOG,_SN[0],"; OFF_RA1[0]=SET("<<S_OFF_RA1[0]<<", "<<S_OFF_RA1[1]<<", "<<S_OFF_RA1[2]<<")")
WRITE(_LOG,_SN[0],"; OFF_RA2[0]=SET("<<S_OFF_RA2[0]<<", "<<S_OFF_RA2[1]<<", "<<S_OFF_RA2[2]<<")")
WRITE(_LOG,_SN[0],";            DIR_RA1[0]=SET("<<(TRUNC(S_DIR_RA1[0]*100000)/100000)<<", "<<(TRUNC(S_DIR_RA1[1]*100000)/100000)<<", "<<(TRUNC(S_DIR_RA1[2]*100000)/100000)<<")")
WRITE(_LOG,_SN[0],";            DIR_RA2[0]=SET("<<(TRUNC(S_DIR_RA2[0]*100000)/100000)<<", "<<(TRUNC(S_DIR_RA2[1]*100000)/100000)<<", "<<(TRUNC(S_DIR_RA2[2]*100000)/100000)<<")")
WRITE(_LOG,_SN[0],"; GST[0]=SET("<<S_GST[0]<<", "<<S_GST[1]<<", "<<S_GST[2]<<") ACTFR[0]=SET("<<S_ACTFR_1[0]<<", "<<S_ACTFR_1[1]<<", "<<S_ACTFR_1[2]<<")"<<" L1="<<S_L[0]<<" L2="<<S_L[1]<<" L3="<<S_L[2])
_LINE="; $SCS_MEA_KIN_MODE[0]="<<( ($SCS_MEA_KIN_MODE[0]+0) _DEC1)<<" $SCS_MEA_KIN_VALUE[0]="<<$SCS_MEA_KIN_VALUE[0]
IF ((_KINNUM<1000) AND ((_KIN_MODE[0] _DEC2)==1) AND (_TC_KIN==0))
_LINE=<<_LINE<<"; close vector chain tool"
ENDIF
WRITE(_LOG,_SN[0],_LINE)
_LINE="; $SCS_MEA_KIN_MODE[1]="<<(($SCS_MEA_KIN_MODE[1]+0) _DEC1)<<" $SCS_MEA_KIN_VALUE[1]="<<$SCS_MEA_KIN_VALUE[1]
IF ((_KINNUM<1000) AND ((_KIN_MODE[1] _DEC2)==1) AND (_TC_KIN==0))
_LINE=<<_LINE<<"; close vector chain part"
ENDIF
WRITE(_LOG,_SN[0],_LINE)
ENDIF
IF NOT ((S_ACTFR_1[0]<>0 OR S_ACTFR_1[1]<>0 OR S_ACTFR_1[2]<>0))
_CAL[0]=SET($P_EP[_XX],$P_EP[_YY],$P_EP[_ZZ])
_CAL[3]=SET(0,0,0)
IF _KINNUM>1000
TRAFOOF
_CAL[3]=SET(_CAL[0]-$P_EP[_XX],_CAL[1]-$P_EP[_YY],_CAL[2]-$P_EP[_ZZ])
TRAFOON($NT_NAME[_KINNUM-1000])
ELSE
IF _TC_KIN==1
IF (($TC_CARR_KIN_CNTRL[_KINNUM] B_AND 'B10') AND ($TC_CARR_KIN_CNTRL[_KINNUM] B_AND 'B100'))
TCARR=0
_CAL[3]=SET(_CAL[0]-$P_EP[_XX],_CAL[1]-$P_EP[_YY],_CAL[2]-$P_EP[_ZZ])
TCARR=_KINNUM
ENDIF
ENDIF
ENDIF
IF (POT(_CAL[3])+POT(_CAL[4])+POT(_CAL[5]))>0.0001
_OFF_PARAL_LIN_AX[0]=SET(_CAL[3],_CAL[4],_CAL[5])
S_OFF_RA1[0]=SET(S_OFF_RA1[0]+_CAL[3],S_OFF_RA1[1]+_CAL[4],S_OFF_RA1[2]+_CAL[5])
S_OFF_RA2[0]=SET(S_OFF_RA2[0]+_CAL[3],S_OFF_RA2[1]+_CAL[4],S_OFF_RA2[2]+_CAL[5])
S_GST[0]=SET(S_GST[0]+_CAL[3],S_GST[1]+_CAL[4],S_GST[2]+_CAL[5])
ENDIF
ENDIF
CASE _G17_18_19 OF 2 GOTOF _G18 3 GOTOF _G19 DEFAULT GOTOF _G17
_G18:
_CAL[0]=SET(1,2,0)
GOTOF _NEXT
_G19:
_CAL[0]=SET(2,0,1)
_NEXT:
_ERG[0,0]=SET(S_GST[_CAL[0]],S_GST[_CAL[1]],S_GST[_CAL[2]])
_ERG[1,0]=SET(S_ACTFR_1[_CAL[0]],S_ACTFR_1[_CAL[1]],S_ACTFR_1[_CAL[2]])
_ERG[2,0]=SET(_OFF_PARAL_LIN_AX[_CAL[0]],_OFF_PARAL_LIN_AX[_CAL[1]],_OFF_PARAL_LIN_AX[_CAL[2]])
S_GST[0]=SET(_ERG[0,0],_ERG[0,1],_ERG[0,2])
S_ACTFR_1[0]=SET(_ERG[1,0],_ERG[1,1],_ERG[1,2])
_OFF_PARAL_LIN_AX[0]=SET(_ERG[2,0],_ERG[2,1],_ERG[2,2])
FOR _I=1 TO 2
EXECSTRING("_ERG[0,0]=SET(S_OFF_RA"<<_I<<"["<<_CAL[0]<<"],S_OFF_RA"<<_I<<"["<<_CAL[1]<<"],S_OFF_RA"<<_I<<"["<<_CAL[2]<<"])")
EXECSTRING("_ERG[1,0]=SET(S_DIR_RA"<<_I<<"["<<_CAL[0]<<"],S_DIR_RA"<<_I<<"["<<_CAL[1]<<"],S_DIR_RA"<<_I<<"["<<_CAL[2]<<"])")
EXECSTRING("S_OFF_RA"<<_I<<"[0]=SET(_ERG[0,0],_ERG[0,1],_ERG[0,2])")
EXECSTRING("S_DIR_RA"<<_I<<"[0]=SET(_ERG[1,0],_ERG[1,1],_ERG[1,2])")
ENDFOR
; S_ACTFR_1[0]=SET(_CAL[3+_CAL[0]],_CAL[3+_CAL[1]],_CAL[3+_CAL[2]])
_G17:
IF _KINNUM>1000
_KINTYP=$P_TRAFO
IF _KINTYP==24
_MEA_RA[0]=SET(1,2)
ELSE
_MEA_RA[0]=SET(2,1)
ENDIF
_RA_NAME[0]=<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[0])
_RA_NAME[1]=<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[1])
IF _KINTYP==24
_CARR_OLD[4]=SET(-$AC_TRAFO_SECTION_T[1,0],-$AC_TRAFO_SECTION_T[1,1],-$AC_TRAFO_SECTION_T[1,2])
_CARR_OLD[7]=SET($AC_TRAFO_ORIAX_DIR_T[0,0],$AC_TRAFO_ORIAX_DIR_T[0,1],$AC_TRAFO_ORIAX_DIR_T[0,2])
IF _RA_NAME[1]<>"NO_AXIS"
_CARR_OLD[15]=SET(-$AC_TRAFO_SECTION_T[2,0],-$AC_TRAFO_SECTION_T[2,1],-$AC_TRAFO_SECTION_T[2,2])
_CARR_OLD[10]=SET($AC_TRAFO_ORIAX_DIR_T[1,0],$AC_TRAFO_ORIAX_DIR_T[1,1],$AC_TRAFO_ORIAX_DIR_T[1,2])
ENDIF
ENDIF
IF _KINTYP==56
_CARR_OLD[4]=SET(-$AC_TRAFO_SECTION_T[1,0],-$AC_TRAFO_SECTION_T[1,1],-$AC_TRAFO_SECTION_T[1,2])
_CARR_OLD[7]=SET($AC_TRAFO_ORIAX_DIR_T[0,0],$AC_TRAFO_ORIAX_DIR_T[0,1],$AC_TRAFO_ORIAX_DIR_T[0,2])
IF _RA_NAME[1]<>"NO_AXIS"
_CARR_OLD[10]=SET($AC_TRAFO_ORIAX_DIR_P[0,0],$AC_TRAFO_ORIAX_DIR_P[0,1],$AC_TRAFO_ORIAX_DIR_P[0,2])
_CARR_OLD[15]=SET($AC_TRAFO_SECTION_P[0,0],$AC_TRAFO_SECTION_P[0,1],$AC_TRAFO_SECTION_P[0,2])
ENDIF
ENDIF
IF _KINTYP==40
_CARR_OLD[4]=SET($AC_TRAFO_SECTION_P[0,0],$AC_TRAFO_SECTION_P[0,1],$AC_TRAFO_SECTION_P[0,2])
IF (_RA_NAME[1]=="NO_AXIS")
_MEA_RA[0]=SET(1,0)
_CARR_OLD[7]=SET($AC_TRAFO_ORIAX_DIR_P[0,0],$AC_TRAFO_ORIAX_DIR_P[0,1],$AC_TRAFO_ORIAX_DIR_P[0,2])
ELSE
_CARR_OLD[15]=SET($AC_TRAFO_SECTION_P[1,0],$AC_TRAFO_SECTION_P[1,1],$AC_TRAFO_SECTION_P[1,2])
_CARR_OLD[7]=SET($AC_TRAFO_ORIAX_DIR_P[1,0],$AC_TRAFO_ORIAX_DIR_P[1,1],$AC_TRAFO_ORIAX_DIR_P[1,2])
_CARR_OLD[10]=SET($AC_TRAFO_ORIAX_DIR_P[0,0],$AC_TRAFO_ORIAX_DIR_P[0,1],$AC_TRAFO_ORIAX_DIR_P[0,2])
ENDIF
ENDIF
FOR _I=0 TO 17
_CARR_OLD[_I]=_CARR_OLD[_I]*_FAK1/_FAK2
ENDFOR
_GST_X=0
IF (_OVR[998]==1)
_GST_X=1
ENDIF
ELSE
_MEA_RA[0]=SET(1,2)
IF ($TC_CARR23[_KINNUM]=="T")
_KINTYP=24
ENDIF
IF ($TC_CARR23[_KINNUM]=="P")
_KINTYP=40
ENDIF
IF ($TC_CARR23[_KINNUM]=="M")
_KINTYP=56
ENDIF
_RA_NAME[0]=<<$TC_CARR35[_KINNUM]
_RA_NAME[1]=<<$TC_CARR36[_KINNUM]
IF _TC_KIN==0
FOR _I=1 TO 20
IF ((_I>12) AND (_I<15)) GOTOF _NEXT
EXECSTRING("_CARR_OLD["<<_I<<"]=$TC_CARR"<<_I<<"["<<_KINNUM<<"]*_FAK1/_FAK2")
_NEXT:
ENDFOR
ELSE
_CARR_OLD[4]=SET($PC_TCARR_OFFSET[2,0],$PC_TCARR_OFFSET[2,1],$PC_TCARR_OFFSET[2,2])
_CARR_OLD[15]=SET($PC_TCARR_OFFSET[3,0],$PC_TCARR_OFFSET[3,1],$PC_TCARR_OFFSET[3,2])
_CARR_OLD[7]=SET($PC_TCARR_AX_VECT[1,0],$PC_TCARR_AX_VECT[1,1],$PC_TCARR_AX_VECT[1,2])
_CARR_OLD[10]=SET($PC_TCARR_AX_VECT[2,0],$PC_TCARR_AX_VECT[2,1],$PC_TCARR_AX_VECT[2,2])
ENDIF
_GST_X=0
IF (($TC_CARR37[_KINNUM] _DEC6)==3)
_GST_X=1
ENDIF
ENDIF
IF ((_RA_NAME[1]=="")OR (_RA_NAME[1]=="NO_AXIS"))
_MEA_RA[1]=0
ENDIF
IF ((_TC_KIN==1) AND (_KINTYP<>24) AND (_MEA_RA[1]<>0))
_KIN_MODE[0]=SET($SCS_MEA_KIN_MODE[1],$SCS_MEA_KIN_MODE[0])
ELSE
_KIN_MODE[0]=SET($SCS_MEA_KIN_MODE[0],$SCS_MEA_KIN_MODE[1])
ENDIF
_OVR[0]=REP(0,20)
_OVR[27]=REP(0,5)
_OVR[41]=REP(0,9)
_OVR[53]=REP(0,7)
_OVR[78]=REP(0,25)
_OVR[114]=REP(0,5)
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H400000')
IF _KINTYP<>40
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],";  Offset Berechnung gemittelt, Kopfachse (SD55740 bit23)")
ENDIF
_GST_CALC[0]=SET(0,0,0,0,0,0)
_CAL[0]=SET(_CARR_OLD[7],_CARR_OLD[8],_CARR_OLD[9]) ;Orientierung der 1. Rundachse
_III=0
_CALC_GST_A:
_CAL[20]=ACOS(_CAL[2]/SQRT(POT(_CAL[0])+POT(_CAL[1])+POT(_CAL[2])));Drehung um y
IF ((_CAL[0]==0) AND (_CAL[1]==0))
_CAL[21]=0
ELSE
_CAL[21]=ATAN2(_CAL[1],_CAL[0]); Drehung um Z
ENDIF
IF (_CAL[20]+180 MOD 180)<1
_CAL[20]=SET(0,0)
ENDIF
_MODE=11
IF _MEA_RA[0]==1
_I=0
IF _III==1
_I=_OVR[120]
ENDIF
ELSE
_I=_OVR[120]
ENDIF
FOR _II=1 TO _OVR[119+_MEA_RA[_III]]
$P_PFRAME=CROT(_ZZ,_CAL[21]):CROT(_YY,_CAL[20])
$P_PFRAME=$P_PFRAME:CROT(_ZZ,_MEA_MKS[_I+_II,2+_MEA_RA[_III]])
EXECSTRING("_CAL[0]=SET(S_OFF_RA"<<_MEA_RA[_III]<<"[0]-(_MEA_MKS[_I+_II,0]+_OFF_PARAL_LIN_AX[0]),S_OFF_RA"<<_MEA_RA[_III]<<"[1]-(_MEA_MKS[_I+_II,1]+_OFF_PARAL_LIN_AX[1]),S_OFF_RA"<<_MEA_RA[_III]<<"[2]-(_MEA_MKS[_I+_II,2]+_OFF_PARAL_LIN_AX[2]),0)")
CYCLE216(_CAL,_MODE)
_GST_CALC[0+3*_III]=SET(_GST_CALC[0+3*_III]+_CAL[0],_GST_CALC[1+3*_III]+_CAL[1],_GST_CALC[2+3*_III]+_CAL[2])
ENDFOR
_CAL[0]=SET(_GST_CALC[0+3*_III]/_OVR[119+_MEA_RA[_III]],_GST_CALC[1+3*_III]/_OVR[119+_MEA_RA[_III]],_GST_CALC[2+3*_III]/_OVR[119+_MEA_RA[_III]],1)
$P_PFRAME=CROT(_ZZ,_CAL[21]):CROT(_YY,_CAL[20])
CYCLE216(_CAL,_MODE)
EXECSTRING("_GST_CALC["<<(0+3*_III)<<"]=SET(-_CAL[0]+S_OFF_RA"<<_MEA_RA[_III]<<"[0],-_CAL[1]+S_OFF_RA"<<_MEA_RA[_III]<<"[1],-_CAL[2]+S_OFF_RA"<<_MEA_RA[_III]<<"[2])")
_CALC_GST_E:
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],";  S_GST[0]=SET("<<S_GST[0]<<","<<S_GST[1]<<" "<<S_GST[2]<<") ==> "<<"SET("<<_GST_CALC[0]<<" "<<_GST_CALC[1]<<" "<<_GST_CALC[2]<<")")
ENDIF
IF _KINTYP==24
_CAL[0]=SET(_CARR_OLD[10],_CARR_OLD[11],_CARR_OLD[12]) ;Orientierung der 2. Rundachse
_III=1
REPEAT _CALC_GST_A _CALC_GST_E
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],";  S_GST[0]=SET("<<S_GST[0]<<","<<S_GST[1]<<" "<<S_GST[2]<<" ==> "<<"SET("<<_GST_CALC[3]<<" "<<_GST_CALC[4]<<" "<<_GST_CALC[5]<<")")
ENDIF
ENDIF
$P_PFRAME=CTRANS()
ENDIF
ELSE
_GST_CALC[0]=SET(S_GST[0],S_GST[1],S_GST[2],S_GST[0],S_GST[1],S_GST[2])
ENDIF
_CAL[0]=SET(S_ACTFR_1[2],S_ACTFR_1[1],S_ACTFR_1[0])
IF _GST_X==1
_CAL[3]=SET(S_L[0],S_L[1],S_L[2])
ELSE
_CAL[3]=SET(S_L[2],S_L[1],S_L[0])
ENDIF
_MODE=1
CYCLE216(_CAL,_MODE)
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],";swiveld L1: "<<_CAL[3]<<" "<<_CAL[4]<<" "<<_CAL[5]<<" vector:"<<_CAL[0]<<" "<<_CAL[1]<<" "<<_CAL[2])
ENDIF
IF _KINTYP==40
EXECSTRING("_ERG[0,0]=SET(S_OFF_RA"<<_MEA_RA[0]<<"[0]-_CAL[3], S_OFF_RA"<<_MEA_RA[0]<<"[1]-_CAL[4],S_OFF_RA"<<_MEA_RA[0]<<"[2]-_CAL[5])")
IF _MEA_RA[1]>0
EXECSTRING("_ERG[1,0]=SET(S_OFF_RA"<<_MEA_RA[1]<<"[0]-_CAL[3],S_OFF_RA"<<_MEA_RA[1]<<"[1]-_CAL[4],S_OFF_RA"<<_MEA_RA[1]<<"[2]-_CAL[5])")
ENDIF
ELSE
; EXECSTRING("_ERG[0,0]=SET(S_OFF_RA"<<_MEA_RA[0]<<"[0]-S_GST[0]+_CAL[3],S_OFF_RA"<<_MEA_RA[0]<<"[1]-S_GST[1]+_CAL[4],S_OFF_RA"<<_MEA_RA[0]<<"[2]-S_GST[2]+_CAL[5])")
EXECSTRING("_ERG[0,0]=SET(S_OFF_RA"<<_MEA_RA[0]<<"[0]-_GST_CALC[0]+_CAL[3],S_OFF_RA"<<_MEA_RA[0]<<"[1]-_GST_CALC[1]+_CAL[4],S_OFF_RA"<<_MEA_RA[0]<<"[2]-_GST_CALC[2]+_CAL[5])")
IF _MEA_RA[1]>0 ; 2. Rundachse
IF _KINTYP==24
EXECSTRING("_ERG[1,0]=SET(S_OFF_RA"<<_MEA_RA[1]<<"[0]+_CAL[3]-_GST_CALC[3],S_OFF_RA"<<_MEA_RA[1]<<"[1]+_CAL[4]-_GST_CALC[4],S_OFF_RA"<<_MEA_RA[1]<<"[2]+_CAL[5]-_GST_CALC[5])")
ELSE
EXECSTRING("_ERG[1,0]=SET(S_OFF_RA"<<_MEA_RA[1]<<"[0]-_CAL[3],S_OFF_RA"<<_MEA_RA[1]<<"[1]-_CAL[4],S_OFF_RA"<<_MEA_RA[1]<<"[2]-_CAL[5])")
IF (S_AMODE _DEC5)>0
_ERG[1,0]=SET((_ERG[1,0]+_ERG[0,0]),(_ERG[1,1]+_ERG[0,1]),(_ERG[1,2]+_ERG[0,2]))
ENDIF
ENDIF
ENDIF
IF ((S_ACTFR_1[0]<>0 OR S_ACTFR_1[1]<>0 OR S_ACTFR_1[2]<>0) AND ($MCS_TECHNOLOGY==1))
_CAL[0]=SET(-S_ACTFR_1[2],-S_ACTFR_1[1],-S_ACTFR_1[0])
_CAL[3]=SET(_ERG[0,0],_ERG[0,1],_ERG[0,2])
_MODE=1
CYCLE216(_CAL,_MODE)
_ERG[0,0]=SET(_CAL[3],_CAL[4],_CAL[5])
IF _MEA_RA[1]>0
_ERG[1,0]=SET((_ERG[1,0]-_ERG[0,0]),(_ERG[1,1]-_ERG[0,1]),(_ERG[1,2]-_ERG[0,2]))
ENDIF
ENDIF
ENDIF
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],"; _ERG[0,..](S_OFF_RA"<<_MEA_RA[0]<<")="<<(TRUNC(_ERG[0,0]*100000)/100000)<<" "<<(TRUNC(_ERG[0,1]*100000)/100000)<<" "<<(TRUNC(_ERG[0,2]*100000)/100000))
WRITE(_LOG,_SN[0],"; _ERG[1,..](S_OFF_RA"<<_MEA_RA[1]<<")="<<(TRUNC(_ERG[1,0]*100000)/100000)<<" "<<(TRUNC(_ERG[1,1]*100000)/100000)<<" "<<(TRUNC(_ERG[1,2]*100000)/100000))
ENDIF
IF _KINTYP==24
_KARD=0
IF ((_CARR_OLD[10]==0) AND (_CARR_OLD[11]<>0) AND (_CARR_OLD[12]<>0))
_KARD=1
ENDIF
IF ((_CARR_OLD[10]<>0) AND (_CARR_OLD[11]==0) AND (_CARR_OLD[12]<>0))
_KARD=2
ENDIF
IF ((_KARD>0) AND (_KARD <3))
_ERG[1,0]=SET(S_OFF_RA2[0]-_GST_CALC[3],S_OFF_RA2[1]-_GST_CALC[4],S_OFF_RA2[2]-_GST_CALC[5])
_CAL[3]=_ERG[1,2-_KARD]/_CARR_OLD[12-_KARD]
_CAL[5]=SET(_CARR_OLD[10]*_CAL[3],_CARR_OLD[11]*_CAL[3],_CARR_OLD[12]*_CAL[3])
_ERG[1,0]=SET(_ERG[1,0]-_CAL[5]+(S_L[0]*_CAL[2]),_ERG[1,1]-_CAL[6]+(S_L[0]*_CAL[1]),_ERG[1,2]-_CAL[7]+(S_L[0]*_CAL[0]))
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],";Kardanischer Kopf: _ERG[0,..](S_OFF_RA"<<_MEA_RA[0]<<")="<<(TRUNC(_ERG[0,0]*100000)/100000)<<" "<<(TRUNC(_ERG[0,1]*100000)/100000)<<" "<<(TRUNC(_ERG[0,2]*100000)/100000)<<" _ERG[1,..](S_OFF_RA"<<_MEA_RA[1]<<")="<<(TRUNC(_ERG[1,0]*100000)/100000)<<" "<<(TRUNC(_ERG[1,1]*100000)/100000)<<" "<<(TRUNC(_ERG[1,2]*100000)/100000))
ENDIF
ENDIF
_OVR[1]=SET(_ERG[0,0],_ERG[0,1],_ERG[0,2]) ; I1 (nur wenn Geschlossene Kette)
_OVR[15]=SET(-_ERG[1,0],-_ERG[1,1],-_ERG[1,2]) ; I3
_OVR[4]=SET(-_OVR[1]-_OVR[15],-_OVR[2]-_OVR[16],-_OVR[3]-_OVR[17]) ;I2
_OVR[18]=SET(0,0,0) ; I4
ENDIF
IF _KINTYP==56
_OVR[1]=SET(_ERG[0,0],_ERG[0,1],_ERG[0,2]) ; I1 (nur wenn Geschlossene Kette)
_OVR[4]=SET(-_ERG[0,0],-_ERG[0,1],-_ERG[0,2]) ; I2
IF (($MCS_TECHNOLOGY==1) AND ((S_MVAR _DEC5)==2))
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],"; only correct B-AXIS 1st technology turning")
ENDIF
_OVR[15]=SET(_CARR_OLD[15],_CARR_OLD[16],_CARR_OLD[17]) ; I3
ELSE
_OVR[15]=SET(_ERG[1,0],_ERG[1,1],_ERG[1,2]) ; I3
ENDIF
_OVR[18]=SET(-_OVR[15],-_OVR[16],-_OVR[17]); I4 nur wenn Geschlossene Kette
ENDIF
IF _KINTYP==40
_OVR[1]=SET(0,0,0) ; I1
_OVR[4]=SET(_ERG[0,0],_ERG[0,1],_ERG[0,2]) ; I2
IF (_MEA_RA[1]<>0)
_OVR[18]=SET(-_ERG[1,0],-_ERG[1,1],-_ERG[1,2]) ; I4 (nur wenn Geschlossene Kette)
_OVR[15]=SET((-_OVR[4]-_OVR[18]),(-_OVR[5]-_OVR[19]),(-_OVR[6]-_OVR[20])) ; I3
ELSE
_OVR[18]=SET(-_OVR[4],-_OVR[5],-_OVR[6]) ; I4 (nur wenn Geschlossene Kette)
_OVR[15]=SET(0,0,0) ; I3
ENDIF
ENDIF
IF(_LOG_ON==1) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],";Distances between the rotary axes")
WRITE(_LOG,_SN[0],"; OVR[1..]="<<(TRUNC(_OVR[1]*100000)/100000)<<" "<<(TRUNC(_OVR[2]*100000)/100000)<<" "<<(TRUNC(_OVR[3]*100000)/100000))
WRITE(_LOG,_SN[0],"; OVR[4..]="<<(TRUNC(_OVR[4]*100000)/100000)<<" "<<(TRUNC(_OVR[5]*100000)/100000)<<" "<<(TRUNC(_OVR[6]*100000)/100000))
WRITE(_LOG,_SN[0],"; OVR[15..]="<<(TRUNC(_OVR[15]*100000)/100000)<<" "<<(TRUNC(_OVR[16]*100000)/100000)<<" "<<(TRUNC(_OVR[17]*100000)/100000))
WRITE(_LOG,_SN[0],"; OVR[18..]="<<(TRUNC(_OVR[18]*100000)/100000)<<" "<<(TRUNC(_OVR[19]*100000)/100000)<<" "<<(TRUNC(_OVR[20]*100000)/100000))
ENDIF
_FWS_1A:
IF(_LOG_ON<>0) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],"; set fixed value")
ENDIF
IF (_KIN_MODE[0] _DEC1)>0
IF (_KIN_MODE[0] _DEC1)<4
IF ((_KINTYP==24) AND ((_KINNUM>1000)OR(_TC_KIN==1)))
_CAL[3]=-$SCS_MEA_KIN_VALUE[0]*_FAK1/_FAK2
ELSE
_CAL[3]=$SCS_MEA_KIN_VALUE[0]*_FAK1/_FAK2
IF _TC_KIN==1
_CAL[3]=$SCS_MEA_KIN_VALUE[1]*_FAK1/_FAK2
IF _KINTYP==56
_CAL[3]=-$SCS_MEA_KIN_VALUE[1]*_FAK1/_FAK2
ENDIF
ENDIF
ENDIF
ENDIF
_NAX=((_KIN_MODE[0] _DEC1 -1) MOD 3)+1
IF _KINNUM<1001
IF (_KIN_MODE[0] _DEC1)>3
_CAL[3]=_CARR_OLD[_KIN_MODE[0] _DEC1]
ENDIF
_CAL[0]=SET(_OVR[4],_OVR[5],_OVR[6])
_CAL[4]=SET(_CARR_OLD[7],_CARR_OLD[8],_CARR_OLD[9])
ELSE
IF (_KINTYP==56)
IF (_KIN_MODE[0] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[0] _DEC1)+11]
ENDIF
_CAL[0]=SET(_OVR[15],_OVR[16],_OVR[17])
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_P[0,0],$AC_TRAFO_ORIAX_DIR_P[0,1],$AC_TRAFO_ORIAX_DIR_P[0,2])
ELSE
IF (_KINTYP==24)
_CAL[0]=SET(_OVR[4],_OVR[5],_OVR[6])
IF (_KIN_MODE[0] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[0] _DEC1)]
ENDIF
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_T[0,0],$AC_TRAFO_ORIAX_DIR_T[0,1],$AC_TRAFO_ORIAX_DIR_T[0,2])
ELSE
_CAL[0]=SET(_OVR[15],_OVR[16],_OVR[17])
IF (_KIN_MODE[0] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[0] _DEC1)+11]
ENDIF
IF (_MEA_RA[1]==0)
_CAL[0]=SET(_OVR[4],_OVR[5],_OVR[6])
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_P[0,0],$AC_TRAFO_ORIAX_DIR_P[0,1],$AC_TRAFO_ORIAX_DIR_P[0,2])
IF (_KIN_MODE[0] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[0] _DEC1)]
ENDIF
ELSE
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_P[1,0],$AC_TRAFO_ORIAX_DIR_P[1,1],$AC_TRAFO_ORIAX_DIR_P[1,2])
ENDIF
ENDIF
ENDIF
ENDIF
IF(_LOG_ON<>0) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],"; set value RA("<<_RA_NAME[0]<<"):"<<(TRUNC(_CAL[0]*100000)/100000)<<" "<<(TRUNC(_CAL[1]*100000)/100000)<<" "<<(TRUNC(_CAL[2]*100000)/100000)<<" to ["<<(_NAX-1)<<"]= "<<_CAL[3])
ENDIF
REPEAT _VNA _VNE
IF ((_KINTYP<>24) AND (_KINNUM>1000) AND (_MEA_RA[1]>0))
_OVR[15]=SET(_CAL[7],_CAL[8],_CAL[9])
ELSE
_OVR[4]=SET(_CAL[7],_CAL[8],_CAL[9])
_OVR[1]=SET(-_OVR[4]-_OVR[15],-_OVR[5]-_OVR[16],-_OVR[6]-_OVR[17])
ENDIF
IF ((_KINTYP==40) AND (_KINNUM<1001) AND (_MEA_RA[1]>0))
_OVR[15]=SET(_OVR[15]-(_CAL[7]-_CAL[0]),_OVR[16]-(_CAL[8]-_CAL[1]),_OVR[17]-(_CAL[9]-_CAL[2]))
ENDIF
ENDIF
_FWS_1E:
IF (((_KIN_MODE[1] _DEC1)>0) AND (_MEA_RA[1]<>0))
IF (_KIN_MODE[1] _DEC1)<4
IF (((_KINTYP==24) AND ((_KINNUM>1000)OR(_TC_KIN==1))) OR ((_KINTYP==56) AND (_KINNUM>1000)))
_CAL[3]=-$SCS_MEA_KIN_VALUE[1]*_FAK1/_FAK2
ELSE
_CAL[3]=$SCS_MEA_KIN_VALUE[1]*_FAK1/_FAK2
IF _TC_KIN==1
_CAL[3]=$SCS_MEA_KIN_VALUE[0]*_FAK1/_FAK2
ENDIF
ENDIF
ENDIF
_NAX=((_KIN_MODE[1] _DEC1 -1) MOD 3)+1
IF _KINNUM<1001
IF (_KIN_MODE[1] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[1] _DEC1)+11]
; EXECSTRING("_CAL[3]=$TC_CARR"<<((_KIN_MODE[1] _DEC1)+11)<<"["<<_KINNUM<<"]")
ENDIF
_CAL[0]=SET(_OVR[15],_OVR[16],_OVR[17])
_CAL[4]=SET(_CARR_OLD[10],_CARR_OLD[11],_CARR_OLD[12])
; _CAL[4]=SET($TC_CARR10[_KINNUM],$TC_CARR11[_KINNUM],$TC_CARR12[_KINNUM])
ELSE
IF (_KINTYP==56)
IF (_KIN_MODE[1] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[1] _DEC1)]
ENDIF
_CAL[0]=SET(_OVR[4],_OVR[5],_OVR[6])
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_T[0,0],$AC_TRAFO_ORIAX_DIR_T[0,1],$AC_TRAFO_ORIAX_DIR_T[0,2])
ELSE
IF _KINTYP==24
IF (_KIN_MODE[1] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[1] _DEC1)+11]
ENDIF
_CAL[0]=SET(_OVR[15],_OVR[16],_OVR[17])
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_T[1,0],$AC_TRAFO_ORIAX_DIR_T[1,1],$AC_TRAFO_ORIAX_DIR_T[1,2])
ELSE
IF (_KIN_MODE[1] _DEC1)>3
_CAL[3]=_CARR_OLD[(_KIN_MODE[1] _DEC1)]
ENDIF
_CAL[0]=SET(_OVR[4],_OVR[5],_OVR[6])
_CAL[4]=SET($AC_TRAFO_ORIAX_DIR_P[0,0],$AC_TRAFO_ORIAX_DIR_P[0,1],$AC_TRAFO_ORIAX_DIR_P[0,2])
ENDIF
ENDIF
ENDIF
IF(_LOG_ON<>0) AND (_OVR[999]<>0)
WRITE(_LOG,_SN[0],"; set value RA("<<_RA_NAME[1]<<"):"<<(TRUNC(_CAL[0]*100000)/100000)<<" "<<(TRUNC(_CAL[1]*100000)/100000)<<" "<<(TRUNC(_CAL[2]*100000)/100000)<<" to ["<<(_NAX-1)<<"]= "<<_CAL[3])
ENDIF
REPEAT _VNA _VNE
IF ((_KINTYP<>24) AND (_KINNUM>1000) AND (_MEA_RA[1]>0))
_OVR[4]=SET(_CAL[7],_CAL[8],_CAL[9])
ELSE
_OVR[15]=SET(_CAL[7],_CAL[8],_CAL[9])
IF _KINTYP==24
_OVR[4]=SET(-_OVR[1]-_OVR[15],-_OVR[2]-_OVR[16],-_OVR[3]-_OVR[17])
REPEAT _FWS_1A _FWS_1E
ENDIF
ENDIF
IF ((_KINTYP==40) AND (_KINNUM>1000) AND (_MEA_RA[1]>0))
_OVR[15]=SET((_OVR[15]-(_CAL[7]-_CAL[0])),(_OVR[16]-(_CAL[8]-_CAL[1])),(_OVR[17]-(_CAL[9]-_CAL[2])))
REPEAT _FWS_1A _FWS_1E
ENDIF
ENDIF
_OVR[1]=SET(0,0,0)
_OVR[18]=SET(0,0,0)
IF ((_KIN_MODE[0] _DEC2 )== 0)
IF _KINTYP==24
_OVR[1]=SET(-_OVR[4]-_OVR[15],-_OVR[5]-_OVR[16],-_OVR[6]-_OVR[17])
ENDIF
IF _KINTYP==56
_OVR[1]=SET(-_OVR[4],-_OVR[5],-_OVR[6])
ENDIF
ENDIF
IF ((_KIN_MODE[1] _DEC2 )== 0)
IF _KINTYP==40
IF (_MEA_RA[1]>0)
_OVR[18]=SET(-_OVR[4]-_OVR[15],-_OVR[5]-_OVR[16],-_OVR[6]-_OVR[17])
IF ((_SD55740_13==1) AND ((_KIN_MODE[1] _DEC1)>0))
_CAL[0]=SET(_OVR[18],_OVR[19],_OVR[20])
REPEAT _VNA _VNE
_OVR[18]=SET(_CAL[7],_CAL[8],_CAL[9])
_OVR[15]=SET(-_OVR[4]-_OVR[18],-_OVR[5]-_OVR[19],-_OVR[6]-_OVR[20])
ENDIF
ELSE
_OVR[18]=SET(-_OVR[4],-_OVR[5],-_OVR[6])
ENDIF
ENDIF
IF _KINTYP==56
_OVR[18]=SET(-_OVR[15],-_OVR[16],-_OVR[17])
ENDIF
ENDIF
_OVR[7]=SET(S_DIR_RA1[0],S_DIR_RA1[1],S_DIR_RA1[2])
_OVR[10]=SET(S_DIR_RA2[0],S_DIR_RA2[1],S_DIR_RA2[2])
;ENDIF
_TOL_LIN=0
IF (S_AMODE _DEC1)==1 ;Toleranzberwachung
_TOL_LIN=ABS(S_TOL_LIN)
ENDIF
IF (_KINNUM<1001)
IF _TOL_LIN>0
FOR _I=0 TO 1
_CORR_VECT[0]=SET(_OVR[4+(9*_I)]-_CARR_OLD[4+(9*_I)],_OVR[5+(9*_I)]-_CARR_OLD[5+(9*_I)],_OVR[6+(9*_I)]-_CARR_OLD[6+(9*_I)])
IF _I==0
_REF_DIFF=_CORR_VECT[2]
ENDIF
FOR _II=0 TO 2
IF (ABS(_CORR_VECT[_II])>_TOL_LIN)
_OVR[_II+114+(_I*3)]=(TRUNC(_CORR_VECT[_II]*$MN_INT_INCR_PER_MM)/$MN_INT_INCR_PER_MM)
IF((_LOG_ON<>0) AND (_OVR[999]<>0))
WRITE(_LOG,_SN[0],"; ERROR: tolerance (_TOL_LIN="<<S_TOL_LIN<<") linear vector")
ENDIF
_OVI[9]=62317
GOTOF _ERR3
ENDIF
ENDFOR
ENDFOR
ENDIF
IF (S_MVAR _DEC4)>=4
REPEAT _ERR_REF_A _ERR_REF_E
IF ((_KIN_MODE[0] _DEC1)==4)
_OVR[4]=_OVR[4]-_OVR[110]/_FAK2
ENDIF
IF ((_KIN_MODE[0] _DEC1)==5)
_OVR[5]=_OVR[5]-_OVR[111]/_FAK2
ENDIF
IF ((_KIN_MODE[0] _DEC1)==6)
_OVR[6]=_OVR[6]-_OVR[112]/_FAK2
IF ((_MEA_RA[1]<>0)AND(_KINTYP==24))
_OVR[6]=_OVR[6]-_REF_DIFF+_OVR[113]
ENDIF
ENDIF
ENDIF
IF((_LOG_ON<>0) AND (_OVR[999]<>0)) AND ((S_MVAR _DEC4)>=4)
IF ISVAR("$AC_TRAFO_CORR_ELEM_T[2,2]")
WRITE(_LOG,_SN[0],";REF (new)="<<$AC_TRAFO_CORR_ELEM_T[2,2]<<" (old)="<<(_OVR[113]/_FAK2)<<" DIFF GS="<<(_OVR[112]/_FAK2))
ENDIF
; WRITE(_LOG,_SN[0],";("<<_RA_NAME[0]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2]<<" _CORR_INDEX= "<<_CORR_INDEX<<" _CORR_MODE= "<<_CORR_MODE<<" $AC_MEAS_RESULTS[9]="<<$AC_MEAS_RESULTS[9])
ENDIF
IF _TC_KIN==0
IF ((S_MVAR _DEC4) MOD 2)==1
_SERR=<<_KINNUM
SETAL(62315,_SERR)
M0
STOPRE
IF _TRAFO_AKT
TRAFOOF
ENDIF
$TC_CARR1[_KINNUM]=_OVR[1]*_FAK2/_FAK1 $TC_CARR2[_KINNUM]=_OVR[2]*_FAK2/_FAK1 $TC_CARR3[_KINNUM]=_OVR[3]*_FAK2/_FAK1
$TC_CARR4[_KINNUM]=_OVR[4]*_FAK2/_FAK1 $TC_CARR5[_KINNUM]=_OVR[5]*_FAK2/_FAK1 $TC_CARR6[_KINNUM]=_OVR[6]*_FAK2/_FAK1
$TC_CARR15[_KINNUM]=_OVR[15]*_FAK2/_FAK1 $TC_CARR16[_KINNUM]=_OVR[16]*_FAK2/_FAK1 $TC_CARR17[_KINNUM]=_OVR[17]*_FAK2/_FAK1
$TC_CARR18[_KINNUM]=_OVR[18]*_FAK2/_FAK1 $TC_CARR19[_KINNUM]=_OVR[19]*_FAK2/_FAK1 $TC_CARR20[_KINNUM]=_OVR[20]*_FAK2/_FAK1
IF ISVAR("$MC_TRAFO5_BASE_TOOL_1")
FOR _I=0 TO 2
IF _KINTYP==24
$MC_TRAFO5_PART_OFFSET_1[_I]=_OVR[_I+1]
$MC_TRAFO5_JOINT_OFFSET_1[_I]=_OVR[_I+4]
$MC_TRAFO5_BASE_TOOL_1[_I]=_OVR[_I+15]
$MC_TRAFO5_JOINT_OFFSET_PART_1[_I]=_OVR[_I+18]
ENDIF
IF (_KINTYP==40)
$MC_TRAFO5_JOINT_OFFSET_PART_1[_I]=_OVR[_I+1]
$MC_TRAFO5_BASE_TOOL_1[_I]=_OVR[_I+4]
$MC_TRAFO5_JOINT_OFFSET_1[_I]=_OVR[_I+15]
$MC_TRAFO5_PART_OFFSET_1[_I]=_OVR[_I+18]
ENDIF
IF (_KINTYP==56)
$MC_TRAFO5_JOINT_OFFSET_1[_I]=_OVR[_I+1]
$MC_TRAFO5_BASE_TOOL_1[_I]=_OVR[_I+4]
$MC_TRAFO5_JOINT_OFFSET_PART_1[_I]=_OVR[_I+15]
$MC_TRAFO5_PART_OFFSET_1[_I]=_OVR[_I+18]
ENDIF
STOPRE
NEWCONF
ENDFOR
ENDIF
NEWCONF
IF _TRAFO_AKT
TRAORI
ENDIF
ENDIF
IF ((_LOG_ON<>0) AND (_KINNUM<1001))
IF((_OVR[999]==1)OR(_OVR[999]==2))
WRITE(_LOG,_SN[0],";--------old-TCARR------------------------------------------")
WRITE(_LOG,_SN[0],"; $TC_CARR1.. ="<<_CARR_OLD[1]<<" "<<_CARR_OLD[2]<<" "<<_CARR_OLD[3])
WRITE(_LOG,_SN[0],"; $TC_CARR4.. ="<<_CARR_OLD[4]<<" "<<_CARR_OLD[5]<<" "<<_CARR_OLD[6])
WRITE(_LOG,_SN[0],"; $TC_CARR15..="<<_CARR_OLD[15]<<" "<<_CARR_OLD[16]<<" "<<_CARR_OLD[17])
WRITE(_LOG,_SN[0],"; $TC_CARR18..="<<_CARR_OLD[18]<<" "<<_CARR_OLD[19]<<" "<<_CARR_OLD[20])
ENDIF
IF((_OVR[999]==0)OR(_OVR[999]==2))
WRITE(_LOG,_SN[0],";--------new-calculated-TCARR-------------------------------")
WRITE(_LOG,_SN[0],"; $TC_CARR1.. ="<<$TC_CARR1[_KINNUM]<<" "<<$TC_CARR2[_KINNUM]<<" "<<$TC_CARR3[_KINNUM])
WRITE(_LOG,_SN[0],"; $TC_CARR4.. ="<<$TC_CARR4[_KINNUM]<<" "<<$TC_CARR5[_KINNUM]<<" "<<$TC_CARR6[_KINNUM])
WRITE(_LOG,_SN[0],"; $TC_CARR15..="<<$TC_CARR15[_KINNUM]<<" "<<$TC_CARR16[_KINNUM]<<" "<<$TC_CARR17[_KINNUM])
WRITE(_LOG,_SN[0],"; $TC_CARR18..="<<$TC_CARR18[_KINNUM]<<" "<<$TC_CARR19[_KINNUM]<<" "<<$TC_CARR20[_KINNUM])
ENDIF
ENDIF
ELSE
IF ((S_MVAR _DEC4) MOD 2)==1
_SERR=<<(_KINNUM)
SETAL(62315,_SERR)
M0
STOPRE
ENDIF
_CORR_TC_A:
_NO_ALARM=0
_CORR_MODE=1020
_CORR_INDEX=2
$SN_CORR_TOCARR_LIN_MAX=0
IF _MEA_RA[1]<>0
IF _KINTYP==24
_CORR_VECT[0]=SET(-_OVR[15],-_OVR[16],-_OVR[17])
ELSE ;GEMISCHT oder TISCH
_CORR_VECT[0]=SET(_OVR[15],_OVR[16],_OVR[17])
ENDIF
IF((_LOG_ON<>0) AND (_OVR[999]<>0))
WRITE(_LOG,_SN[0],"; ("<<_RA_NAME[1]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2]<<"      _CORR_INDEX= "<<_CORR_INDEX<<" _CORR_MODE= "<<_CORR_MODE<<" $AC_MEAS_RESULTS[9]="<<$AC_MEAS_RESULTS[9])
ENDIF
_CORR_STATUS = CORRTC(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
_CORR_INDEX=1
IF _KINTYP==40
_CORR_VECT[0]=SET(_OVR[4],_OVR[5],_OVR[6])
ELSE ;KOPF oder GEMISCHT
_CORR_VECT[0]=SET(-_OVR[4],-_OVR[5],-_OVR[6])
ENDIF
; WRITE(_LOG,_SN[0],";("<<_RA_NAME[0]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2]<<" _CORR_INDEX= "<<_CORR_INDEX<<" _CORR_MODE= "<<_CORR_MODE<<" OLD"<<$PC_TCARR_OFFSET[2,0]<<" "<<$PC_TCARR_OFFSET[2,1]<<" "<<$PC_TCARR_OFFSET[2,2]<<" ")
IF((_LOG_ON<>0) AND (_OVR[999]<>0))
WRITE(_LOG,_SN[0],"; ("<<_RA_NAME[0]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2]<<"      _CORR_INDEX= "<<_CORR_INDEX<<" _CORR_MODE= "<<_CORR_MODE<<" $AC_MEAS_RESULTS[9]="<<$AC_MEAS_RESULTS[9])
ENDIF
_CORR_STATUS = CORRTC(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
TCARR=0
NEWCONF
TCARR=_KINNUM
_CORR_TC_E:
REPEAT _CORR_RA_A _CORR_RA_E
IF (((S_MVAR _DEC4)MOD 2)==0)
_OVR[4]=SET(_CARR_OLD[4],_CARR_OLD[5],_CARR_OLD[6])
_OVR[15]=SET(_CARR_OLD[15],_CARR_OLD[16],_CARR_OLD[17])
REPEAT _CORR_TC_A _CORR_TC_E
ENDIF
IF (_LOG_ON<>0)
IF((_OVR[999]==0)OR(_OVR[999]==2))
WRITE(_LOG,_SN[0],";--------new-calculated-TCARR-------------------------------")
WRITE(_LOG,_SN[0]," OVR[1..]= "<<$PC_TCARR_OFFSET[1,0]<<","<<$PC_TCARR_OFFSET[1,1]<<","<<$PC_TCARR_OFFSET[1,2])
WRITE(_LOG,_SN[0]," OVR[4..]= "<<$PC_TCARR_OFFSET[2,0]<<","<<$PC_TCARR_OFFSET[2,1]<<","<<$PC_TCARR_OFFSET[2,2])
WRITE(_LOG,_SN[0]," OVR[15..]="<<$PC_TCARR_OFFSET[3,0]<<","<<$PC_TCARR_OFFSET[3,1]<<","<<$PC_TCARR_OFFSET[3,2])
WRITE(_LOG,_SN[0]," OVR[18..]="<<$PC_TCARR_OFFSET[4,0]<<","<<$PC_TCARR_OFFSET[4,1]<<","<<$PC_TCARR_OFFSET[4,2])
ENDIF
ENDIF
ENDIF
ELSE
IF ((S_MVAR _DEC4) MOD 2)==1
_SERR=<<(_KINNUM-1000)
SETAL(62315,_SERR)
M0
STOPRE
ENDIF
IF((_LOG_ON<>0) AND (_OVR[999]<>0))
WRITE(_LOG,_SN[0],";----old-TRAFO----------------------------------------------")
REPEAT _WRITE_TRAFO_A _WRITE_TRAFO_E
ENDIF
FOR _I=0 TO 3
FOR _II=0 TO 2
IF ISVAR("$AC_TRAFO_SECTION_P["<<_I<<","<<_II<<"]")
_OLD_SECTION_P[_I,_II]=$AC_TRAFO_SECTION_P[_I,_II]*_FAK1/_FAK2
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T["<<_I<<","<<_II<<"]")
_OLD_SECTION_T[_I,_II]=$AC_TRAFO_SECTION_T[_I,_II]*_FAK1/_FAK2
ENDIF
ENDFOR
ENDFOR
_NO_ALARM=1
_CORR_MODE=20
IF _TOL_LIN>0
$SN_CORR_TRAFO_LIN_MAX=_TOL_LIN
ELSE
_CORR_MODE=_CORR_MODE + 1000
ENDIF
IF _MEA_RA[1]<>0
_CORR_INDEX=$AC_TRAFO_ORIAX_LOC[AXNAME(_RA_NAME[1])]
_CORR_INDEX=_CORR_INDEX+(_CORR_INDEX _DEC2)
IF _KINTYP==24
_CORR_VECT[0]=-_OVR[15] _CORR_VECT[1]=-_OVR[16] _CORR_VECT[2]=-_OVR[17]
ENDIF
IF _KINTYP==56
_CORR_VECT[0]=-_OVR[4] _CORR_VECT[1]=-_OVR[5] _CORR_VECT[2]=-_OVR[6]
ENDIF
IF _KINTYP==40
_CORR_VECT[0]=_OVR[4] _CORR_VECT[1]=_OVR[5] _CORR_VECT[2]=_OVR[6]
ENDIF
IF((_LOG_ON<>0) AND (_OVR[999]<>0))
WRITE(_LOG,_SN[0],";("<<_RA_NAME[1]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<" "<<_CORR_VECT[2])
ENDIF
_CORR_M[1]=_CORR_INDEX _CORR_M[2]=_CORR_MODE
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
_CORR_M[0]=_CORR_STATUS
IF ((_CORR_STATUS>0)AND(_CORR_STATUS<>41))
_NO_ALARM=0
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF (_CORR_STATUS==41)
FOR _I=0 TO 2
_OVR[_I+117]=(TRUNC(_CORR_VECT[_I]*$MN_INT_INCR_PER_MM)/$MN_INT_INCR_PER_MM)
ENDFOR
_OVI[9]=62317
GOTOF _ERR3
ENDIF
TRAFOOF
NEWCONF
TRAFOON($NT_NAME[_KINNUM-1000])
STOPRE
ENDIF
_CORR_INDEX=$AC_TRAFO_ORIAX_LOC[AXNAME(_RA_NAME[0])]
_CORR_INDEX=_CORR_INDEX+(_CORR_INDEX _DEC2)
IF _KINTYP==24
_CORR_VECT[0]=-_OVR[4] _CORR_VECT[1]=-_OVR[5] _CORR_VECT[2]=-_OVR[6]
ENDIF
IF _KINTYP==56
_CORR_VECT[0]=_OVR[15] _CORR_VECT[1]=_OVR[16] _CORR_VECT[2]=_OVR[17]
ENDIF
IF _KINTYP==40
IF _MEA_RA[1]<>0
_CORR_VECT[0]=_OVR[15] _CORR_VECT[1]=_OVR[16] _CORR_VECT[2]=_OVR[17]
ELSE
_CORR_VECT[0]=_OVR[4] _CORR_VECT[1]=_OVR[5] _CORR_VECT[2]=_OVR[6]
ENDIF
ENDIF
IF((_LOG_ON<>0) AND (_OVR[999]<>0))
WRITE(_LOG,_SN[0],";("<<_RA_NAME[0]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2])
ENDIF
IF (S_MVAR _DEC4)>=4
REPEAT _ERR_REF_A _ERR_REF_E
IF ((_KIN_MODE[0] _DEC1)==4)
_CORR_VECT[0]=_CORR_VECT[0]-_OVR[110]/_FAK2
ENDIF
IF ((_KIN_MODE[0] _DEC1)==5)
_CORR_VECT[1]=_CORR_VECT[1]-_OVR[111]/_FAK2
ENDIF
IF ((_KIN_MODE[0] _DEC1)==6)
_CORR_VECT[2]=_CORR_VECT[2]-_OVR[112]/_FAK2
IF ((_MEA_RA[1]<>0)AND(_KINTYP==24))
_CORR_VECT[2]=_CORR_VECT[2]-$AC_TRAFO_CORR_ELEM_T[2,2]/_FAK2+_OVR[113]
ENDIF
ENDIF
ENDIF
IF((_LOG_ON<>0) AND (_OVR[999]<>0)) AND ((S_MVAR _DEC4)>=4)
IF ISVAR("$AC_TRAFO_CORR_ELEM_T[2,2]")
WRITE(_LOG,_SN[0],";REF $AC_TRAFO_CORR_ELEM_T(new)="<<$AC_TRAFO_CORR_ELEM_T[2,2]/_FAK2<<" (old)="<<_OVR[113]<<" DIFF GS="<<_OVR[112]/_FAK2)
ENDIF
WRITE(_LOG,_SN[0],";("<<_RA_NAME[0]<<")_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2])
ENDIF
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
IF ((_CORR_STATUS>0)AND(_CORR_STATUS<>41))
_NO_ALARM=0
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF ((_CORR_STATUS==0)AND(((S_MVAR _DEC4)MOD 2)==0))
TRAFOOF
NEWCONF
TRAFOON($NT_NAME[_KINNUM-1000])
STOPRE
REPEAT _CORR_RA_A _CORR_RA_E
_NO_ALARM=0
IF (_CORR_INDEX _DEC2)==1
_CORR_VECT[0]=SET(_OLD_SECTION_T[_CORR_INDEX _DEC1,0],_OLD_SECTION_T[_CORR_INDEX _DEC1,1],_OLD_SECTION_T[_CORR_INDEX _DEC1,2])
ELSE
_CORR_VECT[0]=SET(_OLD_SECTION_P[_CORR_INDEX _DEC1,0],_OLD_SECTION_P[_CORR_INDEX _DEC1,1],_OLD_SECTION_P[_CORR_INDEX _DEC1,2])
ENDIF
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF (_CORR_STATUS==41) OR ((_CORR_M[0]==0)AND(((S_MVAR _DEC4)MOD 2)==0))
IF((_LOG_ON<>0) AND (_OVR[999]<>1))
WRITE(_LOG,_SN[0],";only measure no trafo correction")
ENDIF
_OVR[114]=SET(0,0,0)
IF (_CORR_STATUS==41)
FOR _I=0 TO 2
_OVR[_I+114]=(TRUNC(_CORR_VECT[_I]*$MN_INT_INCR_PER_MM)/$MN_INT_INCR_PER_MM)
ENDFOR
ENDIF
IF (_MEA_RA[1]<>0)
_CORR_INDEX=_CORR_M[1] _CORR_MODE=_CORR_M[2] _NO_ALARM=0
IF (_CORR_INDEX _DEC2)==1
_CORR_VECT[0]=SET(_OLD_SECTION_T[_CORR_INDEX _DEC1,0],_OLD_SECTION_T[_CORR_INDEX _DEC1,1],_OLD_SECTION_T[_CORR_INDEX _DEC1,2])
ELSE
_CORR_VECT[0]=SET(_OLD_SECTION_P[_CORR_INDEX _DEC1,0],_OLD_SECTION_P[_CORR_INDEX _DEC1,1],_OLD_SECTION_P[_CORR_INDEX _DEC1,2])
ENDIF
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF (ABS(_OVR[114])+ABS(_OVR[115])+ABS(_OVR[116])>0)
_OVI[9]=62317
GOTOF _ERR3
ENDIF
ENDIF
TRAFOOF
NEWCONF
TRAFOON($NT_NAME[_KINNUM-1000])
STOPRE
IF (((S_MVAR _DEC4)MOD 2)==1)
REPEAT _CORR_RA_A _CORR_RA_E
ENDIF
FOR _I=21 TO 26
_OVR[_I]=(TRUNC(_OVR[_I]*$MN_INT_INCR_PER_MM)/$MN_INT_INCR_PER_MM)
ENDFOR
IF((_LOG_ON<>0) AND (_OVR[999]<>1));AND(_OVR[999]==0))
WRITE(_LOG,_SN[0],";----new-TRAFO-KC--------------------------------------------")
_WRITE_TRAFO_A:
FOR _I=0 TO 2
IF $NT_CORR_ELEM_T[_KINNUM-1000,_I]<>""
WRITE(_LOG,_SN[0],";"<<SUBSTR($NT_CORR_ELEM_T[_KINNUM-1000,_I],0,26)<<"  = "<<$AC_TRAFO_CORR_ELEM_T[_I,0]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_CORR_ELEM_T[_I,1]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_CORR_ELEM_T[_I,2]*_FAK1/_FAK2)
ENDIF
IF $NT_CORR_ELEM_P[_KINNUM-1000,_I]<>""
WRITE(_LOG,_SN[0],";"<<SUBSTR($NT_CORR_ELEM_P[_KINNUM-1000,_I],0,26)<<"  = "<<$AC_TRAFO_CORR_ELEM_P[_I,0]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_CORR_ELEM_P[_I,1]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_CORR_ELEM_P[_I,2]*_FAK1/_FAK2)
ENDIF
ENDFOR
FOR _I=0 TO 3
IF ISVAR("$AC_TRAFO_SECTION_T["<<_I<<",0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T["<<_I<<"]= "<<$AC_TRAFO_SECTION_T[_I,0]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_SECTION_T[_I,1]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_SECTION_T[_I,2]*_FAK1/_FAK2)
ENDIF
ENDFOR
FOR _I=0 TO 3
IF ISVAR("$AC_TRAFO_SECTION_P["<<_I<<",0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P["<<_I<<"]= "<<$AC_TRAFO_SECTION_P[_I,0]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_SECTION_P[_I,1]*_FAK1/_FAK2<<"|"<<$AC_TRAFO_SECTION_P[_I,2]*_FAK1/_FAK2)
ENDIF
ENDFOR
_WRITE_TRAFO_E:
ENDIF
ENDIF
_END:
_OVI[2]=996
CUST_MEACYC(2)
M17
_VNA:
IF _NAX>0
IF S_DMODE==3
_NAX=(_NAX MOD 3)+1
ENDIF
IF S_DMODE==2
_NAX=((_NAX +1) MOD 3)+1
ENDIF
ENDIF
_SERR=<<"E"
IF(_G17_18_19==1)
CASE (_NAX) OF 0 GOTOF CALCNO 1 GOTOF CALCPX 2 GOTOF CALCPY 3 GOTOF CALCPZ DEFAULT GOTOF _ERR9
ELSE
IF(_G17_18_19==2)
CASE (_NAX) OF 0 GOTOF CALCNO 1 GOTOF CALCPY 2 GOTOF CALCPZ 3 GOTOF CALCPX DEFAULT GOTOF _ERR9
ELSE
CASE (_NAX) OF 0 GOTOF CALCNO 1 GOTOF CALCPZ 2 GOTOF CALCPX 3 GOTOF CALCPY DEFAULT GOTOF _ERR9
ENDIF
ENDIF
CALCNO:
_CAL[7]=_CAL[0] _CAL[8]=_CAL[1] _CAL[9]=_CAL[2]
GOTOF _VNE
CALCPX:
_CAL[7]=_CAL[3]
IF (_CAL[4]==0)
IF (_LOG_ON)
WRITE(_LOG,_SN[0],";Lage der Drehachse lsst den gewhlten Schnittpunkt in der X-Orientierung nicht zu, originaler Stuetzpunkt beibehalten")
ENDIF
GOTOB CALCNO
ENDIF
_CAL[8]=_CAL[1]+((_CAL[7]-_CAL[0])/_CAL[4])*_CAL[5]
_CAL[9]=_CAL[2]+((_CAL[7]-_CAL[0])/_CAL[4])*_CAL[6]
GOTOF _VNE
CALCPY:
_CAL[8]=_CAL[3]
IF (_CAL[5]==0)
IF (_LOG_ON)
WRITE(_LOG,_SN[0],";Lage der Drehachse lsst den gewhlten Schnittpunkt in der Y-Orientierung nicht zu, originaler Stuetzpunkt beibehalten")
ENDIF
GOTOB CALCNO
ENDIF
_CAL[7]=_CAL[0]+((_CAL[8]-_CAL[1])/_CAL[5])*_CAL[4]
_CAL[9]=_CAL[2]+((_CAL[8]-_CAL[1])/_CAL[5])*_CAL[6]
GOTOF _VNE
CALCPZ:
_CAL[9]=_CAL[3]
IF (_CAL[6]==0)
IF (_LOG_ON)
WRITE(_LOG,_SN[0],";Lage der Drehachse lsst den gewhlten Schnittpunkt in der Z-Orientierung nicht zu, originaler Stuetzpunkt beibehalten")
ENDIF
GOTOB CALCNO
ENDIF
_CAL[7]=_CAL[0]+((_CAL[9]-_CAL[2])/_CAL[6])*_CAL[4]
_CAL[8]=_CAL[1]+((_CAL[9]-_CAL[2])/_CAL[6])*_CAL[5]
_VNE:
_CORR_RA_A:
IF _KINNUM>1000
IF (_KINTYP==24)
_OVR[21]=SET($AC_TRAFO_CORR_ELEM_T[1,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_T[1,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_T[1,2]*_FAK1/_FAK2)
ELSE
_OVR[24]=SET($AC_TRAFO_CORR_ELEM_P[0,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[0,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[0,2]*_FAK1/_FAK2)
ENDIF
IF (_MEA_RA[1]<>0)
IF (_KINTYP==24)
_OVR[24]=SET($AC_TRAFO_CORR_ELEM_T[2,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_T[2,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_T[2,2]*_FAK1/_FAK2)
ENDIF
IF (_KINTYP==56)
_OVR[21]=SET($AC_TRAFO_CORR_ELEM_P[0,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[0,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[0,2]*_FAK1/_FAK2)
_OVR[24]=SET($AC_TRAFO_CORR_ELEM_T[1,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_T[1,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_T[1,2]*_FAK1/_FAK2)
ENDIF
IF (_KINTYP==40)
_OVR[21]=SET($AC_TRAFO_CORR_ELEM_P[1,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[1,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[1,2]*_FAK1/_FAK2)
_OVR[24]=SET($AC_TRAFO_CORR_ELEM_P[0,0]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[0,1]*_FAK1/_FAK2,$AC_TRAFO_CORR_ELEM_P[0,2]*_FAK1/_FAK2)
ENDIF
ENDIF
ELSE
IF _TC_KIN==0 ;klassischer TCARR
_OVR[21]=SET($TC_CARR4[_KINNUM]*_FAK1/_FAK2,$TC_CARR5[_KINNUM]*_FAK1/_FAK2,$TC_CARR6[_KINNUM]*_FAK1/_FAK2)
_OVR[24]=SET($TC_CARR15[_KINNUM]*_FAK1/_FAK2,$TC_CARR16[_KINNUM]*_FAK1/_FAK2,$TC_CARR17[_KINNUM]*_FAK1/_FAK2)
ELSE ; TCARR Kette
_I=NAMETOINT("$NK_NAME",$TC_CARR_CORR_ELEM[_KINNUM,1],TRUE)
_OVR[21]=SET($NK_OFF_DIR[_I,0]/_FAK2*_FAK1,$NK_OFF_DIR[_I,1]/_FAK2*_FAK1,$NK_OFF_DIR[_I,2]/_FAK2*_FAK1)
_I=NAMETOINT("$NK_NAME",$TC_CARR_CORR_ELEM[_KINNUM,2],TRUE)
IF _I>0
_OVR[24]=SET($NK_OFF_DIR[_I,0]/_FAK2*_FAK1,$NK_OFF_DIR[_I,1]/_FAK2*_FAK1,$NK_OFF_DIR[_I,2]/_FAK2*_FAK1)
ENDIF
ENDIF
ENDIF
_CORR_RA_E:
_ERR_REF_A:
_SERR=<<"(D REF?)"
IF (_OVR[104]<=0) GOTOF _ERR20
_SERR=<<"(E REF Workoffset?)"
IF _NV_ACT==0 GOTOF _ERR20
_SERR=<<"(F REF Workoffset?)"
IF ((_OVR[104]+1)<>_NV_ACT)GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_XX)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_XX,TR]*1000)/1000) <> _OVR[107]) GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_YY)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_YY,TR]*1000)/1000) <> _OVR[108]) GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_ZZ)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_ZZ,TR]*1000)/1000) <> _OVR[109]) GOTOF _ERR20
IF $MN_MM_FRAME_FINE_TRANS
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_XX)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_XX,FI]*1000)/1000) <> 0) GOTOF _ERR20
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_YY)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_YY,FI]*1000)/1000) <> 0) GOTOF _ERR20
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_ZZ)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_ZZ,FI]*1000)/1000) <> 0) GOTOF _ERR20
ENDIF
_SERR=<<" I HEAD REF $SCS_MEA_KIN_MODE[0]=?"<<_KIN_MODE[0]
IF (_KIN_MODE[0]<4) GOTOF _ERR20
_ERR_REF_E:
_ERR1: _OVI[9]=61019
STOPRE
N612201 SETAL(61019,_SERR)
RET
_ERR2: STOPRE
_OVI[9]=61423
N612202 SETAL(61423,_SERR)
RET
N612203 _ERR3:
RET
_ERR9: STOPRE
_OVI[9]=61099
N612209 SETAL(_OVI[9])
RET
_ERR20: STOPRE
N699620 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE130_SPF
PROC CYCLE130(INT _MEASNUM, INT _MODE) DISPLOF ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.21.00.00.001 ;DATE: 2022-09-05
DEF BOOL _INTERN[70], _VB[56], _B_TRAFO=0
DEF INT _M_N[40], _ALARM
DEF REAL _M_SPE[80], _DAT[3,6],_KF[3,3], _R_MPX, _R_MPY, _R_MPZ, _R_TOOLR
DEF AXIS _XX, _YY , _ZZ
DEF STRING[30] _SERR
IF ((_MEASNUM < 1) OR (_MEASNUM > 4))
_SERR="_MEASNUM"
GOTOF _AL01
ENDIF
IF ((_MODE < 0) OR (_MODE > 2))
_SERR="_MODE"
GOTOF _AL01
ENDIF
_OVI[2] = 130
_KNUM = 0
_SMI_R[10] = 93101.901
_MIJ_I[3] = $P_GG[6] + 16
_MIJ_I[4] = 100
DIAMCYCOF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
G290
D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630201 SETAL(61311)
ENDIF
N109 CYCLE109(_INTERN,_M_SPE,_M_N)
_INTERN[36] = 0
_M_SPE[31] = 0.001
N110 CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
IF (($P_TRAFO>0) AND ($P_TRAFO<256))
_B_TRAFO=1
ENDIF
_R_TOOLR = $P_TOOLR
IF (_MODE == 0)
_R_MPX = $AA_IW[_XX]
_R_MPY = $AA_IW[_YY]
_R_MPZ = $AA_IW[_ZZ]
ENDIF
IF (_MODE == 1)
_R_MPX = $AA_IM[_XX]
_R_MPY = $AA_IM[_YY]
_R_MPZ = $AA_IM[_ZZ]
ENDIF
IF (_MODE == 2)
_R_MPX = $AA_IB[_XX]
_R_MPY = $AA_IB[_YY]
_R_MPZ = $AA_IB[_ZZ]
ENDIF
E_MESS[0] = _R_MPX
E_MESS[1] = _R_MPY
E_MESS[2] = _R_MPZ
E_MESS[12] = _R_TOOLR
E_MESS[13] = _MEASNUM
_OVI[19] = 130
RET
_AL01:
_OVI[9]=61019
SETAL(_OVI[9], _SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE131_SPF
PROC CYCLE131(INT _SPEZ, INT _HKNUM, STRING[5] _RANAME,REAL _SWA,REAL _SWO,REAL _SWAP, INT _AX_P1_2, INT _DIR1_2,INT _AX_P3_4,INT _DIR3_4, REAL _PU1A,REAL _PU1O,REAL _PU1AP,REAL _PU2A,REAL _PU2O,REAL _PU2AP,REAL _PU3A,REAL _PU3O,REAL _PU3AP,REAL _PU4A,REAL _PU4O,REAL _PU4AP, INT _WOPL) DISPLOF ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.014 ;DATE: 2024-07-04
DEF INT _ALARM,_HH,_A_NPV,_K_NPV,_K_NPVG,_FRSEL,_COR_STAT,_M_BFNR,_TCNR,_HI[8],_A,_O,_AP
DEF INT _CUTTINGPOS=0, _TOOLTYP=0
DEF AXIS _MAV,_XX,_YY,_ZZ,_VAV,_VRA,_RAX1,_RAX2
DEF REAL _MP[5,3],_WI1,_WI2,_COS1_R,_SIN2_R,_A1,_A2,_B1,_B2,_C1,_C2,_D,_KW1,_KW2
DEF REAL _CAL[13],_H_OVR[21],_HELPR
DEF BOOL _BTRAFO=0, _BGEKIPPT[3]=SET(0), _BANKRATZ=0, _BDREHKANTE=0, _BTCARR=0
DEF FRAME _REL_FRAME,_RET_FRAME1, _ORIG_FRAME, _AFTER_FRAME
DEF STRING[30] _ZIEL,_SERR
DIAMCYCOF
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
_HI[6] = $MNS_DISP_RES_MM
ELSE
N22 G70
_HI[6] = $MNS_DISP_RES_INCH
ENDIF
_HI[7]=1
FOR _HI[3]=1 TO _HI[6]
_HI[7]=_HI[7]*10
ENDFOR
IF NOT(($P_ADT[1]>=712) AND ($P_ADT[1]<=714) OR ($P_ADT[1]==710))
_BANKRATZ = 1
ENDIF
IF (_SPEZ == 34) OR (_SPEZ _DEC2 == 4)
CYCLE130(1)
ENDIF
IF (_SPEZ _DEC2 == 4)
_MIJ_I[3] = 18
ENDIF
IF ($P_TOOL AND $P_TOOLNO AND _BANKRATZ)
_CUTTINGPOS=$P_ADT[2]
_TOOLTYP=$P_ADT[1]
ENDIF
IF (($P_TRAFO>0) AND ($P_TRAFO<256))
_BTRAFO=1
ENDIF
_A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <> 100
N25 G500
ENDIF
ENDIF
IF ($MCS_TECHNOLOGY == 1)
_MIJ_I[3]=_WOPL
ENDIF
IF ((_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19))
IF _MIJ_I[3] == 17
N26 G17
ELSE
IF _MIJ_I[3] == 18
N27 G18
ELSE
N28 G19
ENDIF
ENDIF
ENDIF
IF (($P_GG[6] + 16) == 17)
_A=1 _O=2 _AP=3
ELSE
IF (($P_GG[6] + 16) == 18)
_A=3 _O=1 _AP=2
ELSE
_A=2 _O=3 _AP=1
ENDIF
ENDIF
IF(ISAXIS(_A))
_XX=$P_AXN1
ENDIF
IF(ISAXIS(_O))
_YY=$P_AXN2
ENDIF
IF(ISAXIS(_AP))
_ZZ=$P_AXN3
ENDIF
E_MESS_AM=0
IF _HKNUM==100
_HKNUM=0
ELSE
IF _HKNUM==0
_HKNUM=1000
ENDIF
ENDIF
IF (_HKNUM<0) OR ((_HKNUM>1065)AND(_HKNUM<2000)) GOTOF _ERR56
_OVI[16]=131 _OVI[17]=_SPEZ
IF (_SPEZ==10)OR(_SPEZ==20)
IF $MNS_DISP_RES_ROT_WO >0
IF (_SPEZ==20)OR((_SPEZ==10)AND(_RANAME == ""))
_HI[5]=$MNS_DISP_RES_ROT_WO
ELSE
IF (_SPEZ==10)AND(_RANAME <> "")
_HI[5]=$MNS_DISP_RES_ANGLE
ENDIF
ENDIF
ELSE
_HI[5]=$MNS_DISP_RES_ANGLE
ENDIF
_HI[1]=1 _HI[2]=1
FOR _HI[3]=0 TO _HI[5]
_HI[4]=_HI[1]*_HI[2] _HI[1]=10
IF _HI[3] >=1
_HI[2]=_HI[2]*10
ENDIF
ENDFOR
ENDIF
IF _HKNUM
_KNUM=_HKNUM _A_NPV=$P_GG[8] _OVI[14]=_SPEZ+100
IF (_HKNUM < 1000) OR (_HKNUM==1000)
_COR_STAT=1 _FRSEL=99 + _A_NPV
IF _HKNUM<1000
IF (($MN_MM_NUM_GLOBAL_USER_FRAMES>0)AND(_RANAME==""))
IF (_HKNUM>=$MN_MM_NUM_GLOBAL_USER_FRAMES) OR (NOT(((_SPEZ >= 0) AND (_SPEZ <= 4)) OR (_SPEZ >= 30)))
_ALARM=61321
ENDIF
ELSE
IF _HKNUM>=$MC_MM_NUM_USER_FRAMES
_ALARM=61321
ENDIF
ENDIF
_K_NPV=_HKNUM _K_NPVG=_K_NPV+1
IF _K_NPV <> _A_NPV-1
E_MESS_AM=10
ENDIF
ELSE
IF $MC_MM_NUM_BASE_FRAMES>0
_K_NPV=0 _M_BFNR=$MC_MM_NUM_BASE_FRAMES-1
IF _A_NPV >1
E_MESS_AM=10
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _HKNUM==2000
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')
_FRSEL=0
ELSE
_ALARM=61321
ENDIF
ELSE
IF _HKNUM>=1050
IF ((_HKNUM>1050)AND(_HKNUM<=($MN_MM_NUM_GLOBAL_BASE_FRAMES+1050)))
_M_BFNR=_HKNUM-1051 _FRSEL=_M_BFNR+50
ELSE
_ALARM=61321
ENDIF
IF (($MN_MM_NUM_GLOBAL_BASE_FRAMES>0)AND(_RANAME==""))
IF NOT(((_SPEZ >= 0) AND (_SPEZ <= 4)) OR (_SPEZ >= 30))
_ALARM=61321
ENDIF
ENDIF
ELSE
IF ((_HKNUM>1010)AND(_HKNUM<=($MC_MM_NUM_BASE_FRAMES+1010)))
_M_BFNR=_HKNUM-1011 _FRSEL=_M_BFNR+10
ELSE
_ALARM=61321
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM GOTOF _ERR50
CASE _SPEZ OF 30 GOTOF _M_AN_BOHRUNG 31 GOTOF _M_AN_KZAPFEN 32 GOTOF _M_AN_RTASCHE 33 GOTOF _M_AN_RZAPFEN 34 GOTOF _M_AN_KANTE 40 GOTOF _M_AN_DREH_KANTE 41 GOTOF _M_AN_DREH_OUT_DIAM 42 GOTOF _M_AN_DREH_IN_DIAM
CASE _SPEZ MOD 10 OF 3 GOTOF _M_KREIS 4 GOTOF _M_SP_4 5 GOTOF _M_ECKE 6 GOTOF _M_ECKE
CASE _SPEZ OF 0 GOTOF _M_Abstand 10 GOTOF _M_WINKEL 11 GOTOF _M_GD_P1 20 GOTOF _M_EBENE
_SERR=<<"_SPEZ"
GOTOF _ERR70
_M_ABSTAND:
_CAL[1]=_SWA
IF _AX_P1_2 == 1
_MAV=_XX _CAL[0]=_PU1A _CAL[2]=_PU2A _MA=1
ELSE
IF _AX_P1_2 == 2
_MAV= _YY _CAL[0]=_PU1O _CAL[2]=_PU2O _MA=2
ELSE
_MAV=_ZZ _CAL[0]=_PU1AP _CAL[2]=_PU2AP _MA=3
ENDIF
ENDIF
IF (_BANKRATZ)
_HI[0] = (_AX_P1_2 - 1) * 2 + _DIR1_2
_HI[1] = (_AX_P3_4 - 1) * 2 + _DIR3_4
$AC_MEAS_VALID = 0
$AA_MEAS_POINT1[_MAV] = _CAL[0]
$AA_MEAS_POINT2[_MAV] = _CAL[2]
$AA_MEAS_SETPOINT[_MAV] = _CAL[1]
IF (($P_GG[6] + 16) == 17)
$AC_MEAS_DIR_APPROACH = _HI[0]
$AC_MEAS_INPUT[0] = _HI[1]
ELSE
IF (($P_GG[6] + 16) == 18)
IF (_AX_P1_2 == 1)
$AC_MEAS_DIR_APPROACH = 4 + _DIR1_2
$AC_MEAS_INPUT[0] = 4 + _DIR3_4
ELSE
IF (_AX_P1_2 == 2)
$AC_MEAS_DIR_APPROACH = 0 + _DIR1_2
$AC_MEAS_INPUT[0] = 0 + _DIR3_4
ELSE
$AC_MEAS_DIR_APPROACH = 2 + _DIR1_2
$AC_MEAS_INPUT[0] = 2 + _DIR3_4
ENDIF
ENDIF
ELSE
IF (_AX_P1_2 == 1)
$AC_MEAS_DIR_APPROACH = 2 + _DIR1_2
$AC_MEAS_INPUT[0] = 2 + _DIR3_4
ELSE
IF (_AX_P1_2 == 2)
$AC_MEAS_DIR_APPROACH = 4 + _DIR1_2
$AC_MEAS_INPUT[0] = 4 + _DIR3_4
ELSE
$AC_MEAS_DIR_APPROACH = 0 + _DIR1_2
$AC_MEAS_INPUT[0] = 0 + _DIR3_4
ENDIF
ENDIF
ENDIF
ENDIF
IF((_DIR1_2 == 1) AND (_DIR3_4 == 0))
$AC_MEAS_TYPE = 12
ELSE
$AC_MEAS_TYPE = 13
ENDIF
_OVI[12] = MEASURE()
IF (_OVI[12] == 0)
_OVR[4+_AX_P1_2] = $AC_MEAS_RESULTS[0]
_OVR[4] = $AC_MEAS_RESULTS[1]
ELSE
IF (_OVI[12] == 9)
_ALARM=61364 _SERR = "P1 <--> P2"
GOTOF _ERR53
ELSE
GOTOF _ERR90
ENDIF
ENDIF
ELSE
_OVR[4+_AX_P1_2]=(_CAL[0] + E_MESS[_AX_P1_2 - 1])/2
_OVR[4]=ABS(_CAL[0] - E_MESS[_AX_P1_2 - 1])
ENDIF
IF _HKNUM == 0
GOTOF _M_ENDE
ELSE
_OVR[_AX_P1_2]=_CAL[1] _OVR[0]=_OVR[_AX_P1_2] _OVI[2]=978
GOTOF _M_CYCLE115A
ENDIF
_M_GD_P1: _MP[1,0]=SET(_PU1A,_PU1O,_PU1AP) _MP[2,0]=SET(E_MESS[0],E_MESS[1],E_MESS[2]) _OVR[0]=SET(_SWAP,_SWA,_SWO)
IF SQRT(POT(_MP[1,0]-_MP[2,0]) + POT(_MP[1,1]-_MP[2,1]))<1
_ALARM=61364 _SERR = "P1 <--> P2"
GOTOF _ERR61
ENDIF
_OVR[5]=SET(_PU1A,_PU1O)
_OVR[4]=ATAN2((_MP[2,1] - _MP[1,1]),(_MP[2,0] - _MP[1,0]))
_OVR[4]=ROUND(_OVR[4]*10000)/10000
IF _HKNUM == 0
GOTOF _M_ENDE
ELSE
E_MESS_AM=E_MESS_AM + 1
GOTOF _M_KORREKTUR_3_4
ENDIF
_M_ECKE:
_MP[1,0]=SET(_PU1A,_PU1O,_PU1AP,_PU2A,_PU2O,_PU2AP,_PU3A,_PU3O,_PU3AP,E_MESS[0],E_MESS[1],E_MESS[2]) _OVR[0]=SET(_SWAP,_SWA,_SWO)
IF _MP[1,0]>_MP[2,0]
_MP[0,0]=SET(_MP[1,0],_MP[1,1],_MP[1,2]) _MP[1,0]=SET(_MP[2,0],_MP[2,1],_MP[2,2]) _MP[2,0]=SET(_MP[0,0],_MP[0,1],_MP[0,2])
ENDIF
_A1=-(_MP[2,1]-_MP[1,1]) _B1=_MP[2,0]-_MP[1,0]
IF ((_B1==0) AND (_A1==0))
_ALARM = 61364 _SERR = "P1 <--> P2"
GOTOF _ERR61
ENDIF
IF (_BANKRATZ)
$AC_MEAS_VALID = 0
$AA_MEAS_POINT1[_XX] = _PU1A
$AA_MEAS_POINT1[_YY] = _PU1O
$AA_MEAS_POINT2[_XX] = _PU2A
$AA_MEAS_POINT2[_YY] = _PU2O
$AA_MEAS_POINT3[_XX] = _PU3A
$AA_MEAS_POINT3[_YY] = _PU3O
IF (_SPEZ MOD 10 == 6)
$AA_MEAS_POINT4[_XX] = _PU4A
$AA_MEAS_POINT4[_YY] = _PU4O
ELSE
$AC_MEAS_CORNER_SETANGLE = 90
ENDIF
$AA_MEAS_SETPOINT[_XX] = _SWA
$AA_MEAS_SETPOINT[_YY] = _SWO
IF ((_SPEZ == 5) OR (_SPEZ == 6))
$AC_MEAS_INPUT[0] = 0
ELSE
$AC_MEAS_INPUT[0] = 1
ENDIF
$AC_MEAS_TYPE = _SWAP + 3
_OVI[12]=MEASURE()
IF (_OVI[12] == 0)
_OVR[4] = $AC_MEAS_WP_ANGLE
_OVR[7] = $AC_MEAS_CORNER_ANGLE
_OVR[5] = $AC_MEAS_RESULTS[0]
_OVR[6] = $AC_MEAS_RESULTS[1]
ELSE
GOTOF _ERR90
ENDIF
ELSE
_WI1=ATAN2((_MP[2,1]-_MP[1,1]),(_MP[2,0]-_MP[1,0])) _OVR[4]=_WI1
IF _SPEZ MOD 10 == 6
_A2=-(_MP[4,1]-_MP[3,1]) _B2=_MP[4,0]-_MP[3,0] _C2=_MP[3,1]*_B2 + _MP[3,0]*_A2 _D=_A1*_B2-_A2*_B1
IF ((_B2==0)AND(_A2==0))
_ALARM=61364 _SERR=<<"P3 <--> P4"
GOTOF _ERR60
ELSE
IF _D==0
_OVI[9]=61368 _SERR=<<" P1<-->P2 II P3<-->P4"
GOTOF _ERR80
ENDIF
ENDIF
IF _MP[4,1]>_MP[3,1]
_MP[0,0]=SET(_MP[4,0],_MP[4,1],_MP[4,2]) _MP[4,0]=SET(_MP[3,0],_MP[3,1],_MP[3,2]) _MP[3,0]=SET(_MP[0,0],_MP[0,1],_MP[0,2])
ENDIF
_WI2=ATAN2((_MP[3,1]-_MP[4,1]),(_MP[3,0]-_MP[4,0]))
ELSE
_WI2=_WI1+90
_MP[3,0]=SET(_MP[4,0],_MP[4,1],_MP[4,2])
ENDIF
IF (_SWAP==2)OR(_SWAP==4)
_OVR[7]=ABS(180 -(_WI2-_WI1))
ELSE
_OVR[7]=ABS(_WI2-_WI1)
ENDIF
_COS1_R = 1/COS(_WI1)
_SIN2_R = 1/SIN(_WI2)
_KW1 = $SNS_MEA_WP_BALL_DIAM[(_MIJ_I[1] MOD 100)-1]/2 * (_COS1_R - 1)
_KW2 = $SNS_MEA_WP_BALL_DIAM[(_MIJ_I[1] MOD 100)-1]/2 * (_SIN2_R - 1)
IF _DIR1_2
_KW1=-_KW1
ENDIF
_MP[1,1] = _MP[1,1] + _KW1 _MP[2,1] = _MP[2,1] + _KW1
IF _DIR3_4
_KW2=-_KW2
ENDIF
_MP[3,0] = _MP[3,0] + _KW2 _MP[4,0] = _MP[4,0] + _KW2
_OVR[5]=((_MP[1,1]-TAN(_WI1)*_MP[1,0])-(_MP[3,1]-TAN(_WI2)*_MP[3,0]))/(TAN(_WI2)-TAN(_WI1))
_OVR[6]=(((_MP[1,1]-TAN(_WI1)*_MP[1,0])*TAN(_WI2))-((_MP[3,1]-TAN(_WI2)*_MP[3,0])*TAN(_WI1)))/(TAN(_WI2)-TAN(_WI1))
ENDIF
IF _HKNUM == 0
GOTOF _M_ENDE
ELSE
_SWAP=0 E_MESS_AM=E_MESS_AM + 1
GOTOF _M_KORREKTUR_3_4
ENDIF
_M_SP_4: _MP[1,0]=SET(_PU1A,_PU1O,_PU1AP,_PU3A,_PU3O,_PU3AP,_PU2A,_PU2O,_PU2AP,E_MESS[0],E_MESS[1],E_MESS[2]) _OVR[0]=SET(_SWAP,_SWA,_SWO)
_HI[0]=0
_TAUSCHEN:
IF _HI[0]==1
_MP[0,0]=_MP[2,0] _MP[0,1]=_MP[2,1]
_MP[2,0]=_MP[3,0] _MP[2,1]=_MP[3,1]
_MP[3,0]=_MP[0,0] _MP[3,1]=_MP[0,1]
ENDIF
IF _HI[0]==2
_MP[0,0]=_MP[2,0] _MP[0,1]=_MP[2,1]
_MP[2,0]=_MP[4,0] _MP[2,1]=_MP[4,1]
_MP[4,0]=_MP[0,0] _MP[4,1]=_MP[0,1]
ENDIF
_A1=-(_MP[2,1]-_MP[1,1]) _B1=_MP[2,0]-_MP[1,0]
IF (_B1==0)AND(_A1==0)
_ALARM=61364 _SERR=<<"P1 <--> P2"
GOTOF _ERR61
ENDIF
_C1=_MP[1,1]*_B1 + _MP[1,0]*_A1
_WI1=ATAN2((_MP[2,1]-_MP[1,1]),(_MP[2,0]-_MP[1,0]))
_A2=-(_MP[4,1]-_MP[3,1]) _B2=_MP[4,0]-_MP[3,0] _C2=_MP[3,1]*_B2 + _MP[3,0]*_A2 _D=_A1*_B2-_A2*_B1
IF ((_B2==0)AND(_A2==0))
_ALARM=61364 _SERR=<<"P2 <--> P4"
GOTOF _ERR62
ELSE
IF _D==0
IF (_HI[0]==2)
_ALARM=61368 _SERR=<<" P1<-->P3 || P2<-->P4"
GOTOF _ERR81
ELSE
GOTOF _NEXT
ENDIF
ENDIF
ENDIF
_WI2=ATAN2((_MP[3,1]-_MP[4,1]),(_MP[3,0]-_MP[4,0]))
_OVR[5]=((_MP[1,1]-TAN(_WI1)*_MP[1,0])-(_MP[3,1]-TAN(_WI2)*_MP[3,0]))/(TAN(_WI2)-TAN(_WI1))
_OVR[6]=(((_MP[1,1]-TAN(_WI1)*_MP[1,0])*TAN(_WI2))-((_MP[3,1]-TAN(_WI2)*_MP[3,0])*TAN(_WI1)))/(TAN(_WI2)-TAN(_WI1))
IF NOT( (_OVR[5]<MAXVAL(_MP[1,0],_MP[2,0])) AND (_OVR[5]>MINVAL(_MP[1,0],_MP[2,0])) )
GOTOF _NEXT
ENDIF
IF NOT ( (_OVR[6]<MAXVAL(_MP[1,1],_MP[2,1])) AND (_OVR[6]>MINVAL(_MP[1,1],_MP[2,1])) )
GOTOF _NEXT
ENDIF
IF NOT( (_OVR[5]<MAXVAL(_MP[3,0],_MP[4,0])) AND (_OVR[5]>MINVAL(_MP[3,0],_MP[4,0])) )
GOTOF _NEXT
ENDIF
IF NOT( (_OVR[6]<MAXVAL(_MP[3,1],_MP[4,1])) AND (_OVR[6]>MINVAL(_MP[3,1],_MP[4,1])) )
GOTOF _NEXT
ENDIF
IF 0<>0
_NEXT:
IF _HI[0]<2
_HI[0]=_HI[0]+1
GOTOB _TAUSCHEN
ELSE
_ALARM=61368 _SERR=<<" P1<-->P3, P2<-->P4"
GOTOF _ERR81
ENDIF
ENDIF
_MP[1,0]=SET(_PU1A,_PU1O,_PU1AP,_PU2A,_PU2O,_PU2AP)
_A1=-(_MP[2,1]-_MP[1,1]) _B1=_MP[2,0]-_MP[1,0]
IF ((_B1==0) AND (_A1==0))
_ALARM = 61364 _SERR = "P1 <--> P2"
GOTOF _ERR61
ENDIF
_WI1=ATAN2((_MP[2,1]-_MP[1,1]),(_MP[2,0]-_MP[1,0])) _OVR[4]=_WI1
_OVR[4]=ROUND(_OVR[4]*10000)/10000 _OVR[20]=_OVR[4]-_SWAP
IF _HKNUM == 0 GOTOF _M_ENDE IF _SPEZ == 4 GOTOF _M_CYCLE115
E_MESS_AM=E_MESS_AM + 1
GOTOF _M_KORREKTUR_3_4
_M_KREIS: _CAL[0]=SET(3,_PU1A,_PU1O,_PU2A,_PU2O,E_MESS[0],E_MESS[1]) _OVR[0]=SET(_SWAP,_SWA,_SWO)
CYCLE116(_CAL,_ALARM)
IF _ALARM GOTOF _ERR51
_OVR[5]=_CAL[9] _OVR[6]=_CAL[10] _OVR[7]=_CAL[11]*2
_WI1=ATAN2((_PU1O-_CAL[10]),(_PU1A-_CAL[9])) _OVR[4]=_WI1
_OVR[4]=ROUND(_OVR[4]*10000)/10000
IF _HKNUM == 0 GOTOF _M_ENDE IF _SPEZ == 3 GOTOF _M_CYCLE115
_MP[1,0]=SET(_OVR[5],_OVR[6]) _MP[2,0]=SET(_PU1A,_PU1O)
E_MESS_AM=E_MESS_AM + 1
GOTOF _M_KORREKTUR_3_4
_M_EBENE:
IF (_BANKRATZ)
E_MESS[0] = _PU3A
E_MESS[1] = _PU3O
E_MESS[2] = _PU3AP
ENDIF
_MP[1,0]=SET(_PU1A,_PU1O,_PU1AP,_PU2A,_PU2O,_PU2AP,E_MESS[0],E_MESS[1],E_MESS[2]) _OVR[0]=SET(0,0,0)
IF SQRT(POT(_MP[1,0]-_MP[2,0]) + POT(_MP[1,1]-_MP[2,1]))<1
_ALARM=61364 _SERR = "P1 <--> P2"
GOTOF _ERR61
ENDIF
IF SQRT(POT(_MP[1,0]-_MP[3,0]) + POT(_MP[1,1]-_MP[3,1]))<1
_ALARM=61364 _SERR=<<"P1 <--> P3"
GOTOF _ERR63
ENDIF
IF ((TRUNC(_MP[1,0]*_HI[7]) == TRUNC(_MP[2,0]*_HI[7])) AND (TRUNC(_MP[2,0]*_HI[7]) == TRUNC(_MP[3,0]*_HI[7]))) OR ((TRUNC(_MP[1,1]*_HI[7]) == TRUNC(_MP[2,1]*_HI[7])) AND (TRUNC(_MP[2,1]*_HI[7]) == TRUNC(_MP[3,1]*_HI[7])))
_ALARM = 61411
GOTOF _ERR52
ENDIF
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XX]=_MP[1,0] $AA_MEAS_POINT1[_YY]=_MP[1,1] $AA_MEAS_POINT1[_ZZ]=_MP[1,2]
$AA_MEAS_POINT2[_XX]=_MP[2,0] $AA_MEAS_POINT2[_YY]=_MP[2,1] $AA_MEAS_POINT2[_ZZ]=_MP[2,2]
$AA_MEAS_POINT3[_XX]=_MP[3,0] $AA_MEAS_POINT3[_YY]=_MP[3,1] $AA_MEAS_POINT3[_ZZ]=_MP[3,2]
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0 $AC_MEAS_TYPE=17
$AA_MEAS_SETANGLE[_XX]=_SWA $AA_MEAS_SETANGLE[_YY]=_SWO
$AC_MEAS_FINE_TRANS=0 $AC_MEAS_FRAME_SELECT=_FRSEL
_OVR[0]=(ROUND(_SWA *_HI[4]))/_HI[4] _OVR[1]=(ROUND(_SWO *_HI[4]))/_HI[4]
_OVI[12]=MEASURE()
IF _OVI[12]==0
_OVR[4]=(ROUND($AC_MEAS_RESULTS[0] *_HI[4]))/_HI[4] _OVR[5]=(ROUND($AC_MEAS_RESULTS[1] *_HI[4]))/_HI[4]
_OVR[20]=(ROUND($AC_MEAS_RESULTS[3] *_HI[4]))/_HI[4]
_OVR[21]=(ROUND($AC_MEAS_RESULTS[4] *_HI[4]))/_HI[4]
_OVR[21]=(ROUND($AC_MEAS_RESULTS[5] *_HI[4]))/_HI[4]
ELSE
_ALARM=61411
ENDIF
IF _ALARM GOTOF _ERR52
IF _HKNUM == 0 GOTOF _M_ENDE
E_MESS_AM=E_MESS_AM + 2
GOTOF _FINAL_COR
_M_WINKEL:
IF (_BANKRATZ)
E_MESS[0] = _PU2A
E_MESS[1] = _PU2O
E_MESS[2] = _PU2AP
ENDIF
_MP[1,0]=SET(_PU1A,_PU1O,_PU1AP) _MP[2,0]=SET(E_MESS[0],E_MESS[1],E_MESS[2])
_H_OVR[0]=SET(_SWAP,_SWA,_SWO) _OVR[0]=(ROUND(_H_OVR[0] *_HI[4]))/_HI[4]
_OVR[1]=(ROUND(_H_OVR[1] *_HI[4]))/_HI[4] _OVR[2]=(ROUND(_H_OVR[2] *_HI[4]))/_HI[4]
IF _AX_P1_2==0
IF _AX_P3_4==0
_AX_P3_4=1
ENDIF
IF _AX_P3_4==1
_AX_P1_2=2
ELSE
_AX_P1_2=1
ENDIF
IF SQRT(POT(_MP[1,0]-_MP[2,0]) + POT(_MP[1,1]-_MP[2,1]))<1
_ALARM=61364 _SERR=<<"P1 <--> P2"
ENDIF
ELSE
IF _MP[1,_AX_P3_4-1] == _MP[2,_AX_P3_4-1]
_ALARM=61364 _SERR=<<"P1 <--> P2"
ENDIF
ENDIF
_MA=_AX_P1_2 + 100*_AX_P3_4
IF _ALARM GOTOF _ERR61
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XX]=_MP[1,0] $AA_MEAS_POINT1[_YY]=_MP[1,1] $AA_MEAS_POINT1[_ZZ]=_MP[1,2]
$AA_MEAS_POINT2[_XX]=_MP[2,0] $AA_MEAS_POINT2[_YY]=_MP[2,1] $AA_MEAS_POINT2[_ZZ]=_MP[2,2]
IF $P_GG[6] == 1
IF ((_AX_P3_4==1)AND(_AX_P1_2==2))OR((_AX_P3_4==2)AND(_AX_P1_2==1))
IF _RANAME == ""
E_MESS_AM=E_MESS_AM + 1
ENDIF
_VAV=_ZZ $AC_MEAS_ACT_PLANE=0 $AC_MEAS_INPUT[0]=0
IF ((_AX_P3_4==2)AND(_AX_P1_2==1))
$AC_MEAS_INPUT[0]=1
ENDIF
ELSE
IF _RANAME == ""
E_MESS_AM=E_MESS_AM + 2
ENDIF
IF ((_AX_P3_4==3)AND(_AX_P1_2==1))OR((_AX_P3_4==1)AND(_AX_P1_2==3))
_VAV=_YY $AC_MEAS_ACT_PLANE=1 $AC_MEAS_INPUT[0]=1
IF ((_AX_P3_4==3)AND(_AX_P1_2==1))
$AC_MEAS_INPUT[0]=0
ENDIF
ELSE
_VAV=_XX $AC_MEAS_ACT_PLANE=2 $AC_MEAS_INPUT[0]=0
IF ((_AX_P3_4==3)AND(_AX_P1_2==2))
$AC_MEAS_INPUT[0]=1
ENDIF
ENDIF
ENDIF
ELSE
IF $P_GG[6] == 2
IF ((_AX_P3_4==1)AND(_AX_P1_2==2))OR((_AX_P3_4==2)AND(_AX_P1_2==1))
IF _RANAME == ""
E_MESS_AM=E_MESS_AM + 1
ENDIF
_VAV=_ZZ $AC_MEAS_ACT_PLANE=1 $AC_MEAS_INPUT[0]=0
IF ((_AX_P3_4==2)AND(_AX_P1_2==1))
$AC_MEAS_INPUT[0]=1
ENDIF
ELSE
IF _RANAME == ""
E_MESS_AM=E_MESS_AM + 2
ENDIF
IF ((_AX_P3_4==3)AND(_AX_P1_2==1))OR((_AX_P3_4==1)AND(_AX_P1_2==3))
_VAV=_YY $AC_MEAS_ACT_PLANE=2 $AC_MEAS_INPUT[0]=1
IF ((_AX_P3_4==3)AND(_AX_P1_2==1))
$AC_MEAS_INPUT[0]=0
ENDIF
ELSE
_VAV=_XX $AC_MEAS_ACT_PLANE=0 $AC_MEAS_INPUT[0]=0
IF ((_AX_P3_4==3)AND(_AX_P1_2==2))
$AC_MEAS_INPUT[0]=1
ENDIF
ENDIF
ENDIF
ELSE
IF ((_AX_P3_4==1)AND(_AX_P1_2==2))OR((_AX_P3_4==2)AND(_AX_P1_2==1))
IF _RANAME == ""
E_MESS_AM=E_MESS_AM + 1
ENDIF
_VAV=_ZZ $AC_MEAS_ACT_PLANE=2 $AC_MEAS_INPUT[0]=0
IF ((_AX_P3_4==2)AND(_AX_P1_2==1))
$AC_MEAS_INPUT[0]=1
ENDIF
ELSE
IF _RANAME == ""
E_MESS_AM=E_MESS_AM + 2
ENDIF
IF ((_AX_P3_4==3)AND(_AX_P1_2==1))OR((_AX_P3_4==1)AND(_AX_P1_2==3))
_VAV=_YY $AC_MEAS_ACT_PLANE=0 $AC_MEAS_INPUT[0]=1
IF ((_AX_P3_4==3)AND(_AX_P1_2==1))
$AC_MEAS_INPUT[0]=0
ENDIF
ELSE
_VAV=_XX $AC_MEAS_ACT_PLANE=1 $AC_MEAS_INPUT[0]=0
IF ((_AX_P3_4==3)AND(_AX_P1_2==2))
$AC_MEAS_INPUT[0]=1
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0 $AC_MEAS_TYPE=16 $AC_MEAS_WP_SETANGLE=0 $AC_MEAS_FINE_TRANS=0
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR90
_H_OVR[4]=$AC_MEAS_WP_ANGLE _OVR[4]=(ROUND(_H_OVR[4] *_HI[4]))/_HI[4]
_H_OVR[16]=_H_OVR[4]-_H_OVR[0] _H_OVR[20]=_H_OVR[16]
_OVR[16]=(ROUND(_H_OVR[16] *_HI[4]))/_HI[4] _OVR[20]=(ROUND(_H_OVR[20] *_HI[4]))/_HI[4]
IF (_HKNUM == 0)
GOTOF _M_ENDE
ELSE
IF (_RANAME <> "")
GOTOF _M_RUND_KOR
ELSE
GOTOF _M_DREH_KOR
ENDIF
ENDIF
_M_AN_BOHRUNG:
_M_AN_KZAPFEN:
_OVI[14] = 0
_CAL[0] = SET(4,_PU1A,_PU1O,_PU2A,_PU2O,_PU3A,_PU3O,_PU4A,_PU4O)
_OVR[0] = 0
CYCLE116(_CAL,_ALARM)
IF (_CAL[12] == 1)
GOTOF _ERR51
ELSE
_OVR[1] = _SWA
_OVR[2] = _SWO
IF (_SPEZ == 30)
_OVR[4] = (_CAL[11] + E_MESS[12]) * 2
_MVAR = 101
ELSE
_OVR[4] = (_CAL[11] - E_MESS[12]) * 2
_MVAR = 102
ENDIF
_OVR[5] = _CAL[9]
_OVR[6] = _CAL[10]
_OVR[17] = _OVR[5] - _OVR[1]
_OVR[18] = _OVR[6] - _OVR[2]
ENDIF
IF (_HKNUM == 0)
GOTOF _M_ENDE
ELSE
GOTOF _M_CYCLE115
ENDIF
_M_AN_RTASCHE:
_M_AN_RZAPFEN:
_OVI[14] = 0
$AC_MEAS_VALID = 0
$AA_MEAS_POINT1[_XX] = _PU1A
$AA_MEAS_POINT1[_YY] = _PU1O
$AA_MEAS_POINT1[_ZZ] = _PU1AP
$AA_MEAS_POINT2[_XX] = _PU2A
$AA_MEAS_POINT2[_YY] = _PU2O
$AA_MEAS_POINT2[_ZZ] = _PU2AP
$AA_MEAS_POINT3[_XX] = _PU3A
$AA_MEAS_POINT3[_YY] = _PU3O
$AA_MEAS_POINT3[_ZZ] = _PU3AP
$AA_MEAS_POINT4[_XX] = _PU4A
$AA_MEAS_POINT4[_YY] = _PU4O
$AA_MEAS_POINT4[_ZZ] = _PU4AP
$AA_MEAS_SETPOINT[_XX] = _SWA
$AA_MEAS_SETPOINT[_YY] = _SWO
$AA_MEAS_SETPOINT[_ZZ] = _SWAP
IF (_SPEZ == 32)
$AC_MEAS_INPUT[0] = 1
_MVAR = 105
ELSE
$AC_MEAS_INPUT[0] = 0
_MVAR = 106
ENDIF
$AC_MEAS_TYPE = 25
_OVI[12]=MEASURE()
IF (_OVI[12] == 0)
_OVR[2] = _SWA
_OVR[3] = _SWO
_OVR[4] = $AC_MEAS_RESULTS[3]
_OVR[5] = $AC_MEAS_RESULTS[4]
_OVR[6] = $AC_MEAS_RESULTS[0]
_OVR[7] = $AC_MEAS_RESULTS[1]
_OVR[18] = _OVR[5] - _OVR[1]
_OVR[19] = _OVR[6] - _OVR[2]
_OVI[2] = 977
ELSE
GOTOF _ERR90
ENDIF
IF (_HKNUM == 0)
GOTOF _M_ENDE
ELSE
GOTOF _M_CYCLE115A
ENDIF
_M_AN_DREH_KANTE:
_BDREHKANTE=1
_DIR1_2 = 1
IF (AXSTRING(_ZZ) == "NO_AXIS")
_ZZ=_XX
ENDIF
GOTOF _M_AN_KANTE
_M_AN_DREH_OUT_DIAM:
_BDREHKANTE=1
_DIR1_2 = 1
IF (AXSTRING(_ZZ) == "NO_AXIS")
_ZZ=_XX
ENDIF
GOTOF _M_AN_KANTE
_M_AN_DREH_IN_DIAM:
_BDREHKANTE=1
_DIR1_2 = 0
IF (AXSTRING(_ZZ) == "NO_AXIS")
_ZZ=_XX
ENDIF
_M_AN_KANTE:
IF ((_DIR1_2 < 0) OR (_DIR1_2 > 1))
_SERR="_DIR1_2"
GOTOF _ERR70
ENDIF
IF ((_AX_P1_2 < 1) OR (_AX_P1_2 > 3))
_SERR="_AX_P1_2"
GOTOF _ERR70
ENDIF
IF _AX_P1_2 == 1
_MAV=_XX _MA=1
ELSE
IF _AX_P1_2 == 2
_MAV=_YY _MA=2
ELSE
_MAV=_ZZ _MA=3
ENDIF
ENDIF
_OVI[14] = 0
_HI[0] = (_AX_P1_2 - 1) * 2 + _DIR1_2
_OVI[2]=978
$AC_MEAS_VALID = 0
$AA_MEAS_POINT1[_MAV] = E_MESS[_MA-1]
IF (($P_GG[6] + 16) == 17)
$AA_MEAS_SETPOINT[_XX] = _SWA
$AA_MEAS_SETPOINT[_YY] = _SWO
$AA_MEAS_SETPOINT[_ZZ] = _SWAP
$AC_MEAS_DIR_APPROACH = _HI[0]
$AC_MEAS_TYPE = _AX_P1_2
ELSE
IF (($P_GG[6] + 16) == 18)
$AA_MEAS_SETPOINT[_XX] = _SWAP
$AA_MEAS_SETPOINT[_YY] = _SWA
$AA_MEAS_SETPOINT[_ZZ] = _SWO
IF (_AX_P1_2 == 1)
$AC_MEAS_TYPE = 3
$AC_MEAS_DIR_APPROACH = 4 + _DIR1_2
ELSE
IF (_AX_P1_2 == 2)
$AC_MEAS_TYPE = 1
$AC_MEAS_DIR_APPROACH = 0 + _DIR1_2
ELSE
$AC_MEAS_TYPE = 2
$AC_MEAS_DIR_APPROACH = 2 + _DIR1_2
ENDIF
ENDIF
ELSE
$AA_MEAS_SETPOINT[_XX] = _SWO
$AA_MEAS_SETPOINT[_YY] = _SWAP
$AA_MEAS_SETPOINT[_ZZ] = _SWA
IF (_AX_P1_2 == 1)
$AC_MEAS_TYPE = 2
$AC_MEAS_DIR_APPROACH = 2 + _DIR1_2
ELSE
IF (_AX_P1_2 == 2)
$AC_MEAS_TYPE = 3
$AC_MEAS_DIR_APPROACH = 4 + _DIR1_2
ELSE
$AC_MEAS_TYPE = 1
$AC_MEAS_DIR_APPROACH = 0 + _DIR1_2
ENDIF
ENDIF
ENDIF
ENDIF
IF(_BDREHKANTE AND (((_TOOLTYP>=100) AND (_TOOLTYP<=299)) OR (_TOOLTYP _DEC3 == 7)) AND ((_CUTTINGPOS==5) OR (_CUTTINGPOS==7)))
$AC_MEAS_TOOL_MASK=1
ENDIF
_OVI[12]=MEASURE()
IF (_OVI[12] == 0)
_OVR[4] = $AC_MEAS_RESULTS[0]
IF (_AX_P1_2 == 1)
IF (($P_GG[6] + 16) == 17)
_OVR[0] = _SWA
ELSE
IF (($P_GG[6] + 16) == 18)
_OVR[0] = _SWAP
ELSE
_OVR[0] = _SWO
ENDIF
ENDIF
ELSE
IF (_AX_P1_2 == 2)
IF (($P_GG[6] + 16) == 17)
_OVR[0] = _SWO
ELSE
IF (($P_GG[6] + 16) == 18)
_OVR[0] = _SWA
ELSE
_OVR[0] = _SWAP
ENDIF
ENDIF
ELSE
IF (($P_GG[6] + 16) == 17)
_OVR[0] = _SWAP
ELSE
IF (($P_GG[6] + 16) == 18)
_OVR[0] = _SWO
ELSE
_OVR[0] = _SWA
ENDIF
ENDIF
ENDIF
ENDIF
IF (NOT($MC_DIAMETER_AX_DEF==AXSTRING(_MAV)) AND ($MA_BASE_FUNCTION_MASK[_MAV] B_AND 'B100'))
_OVR[4]=_OVR[4]*2
ENDIF
IF ((_SPEZ == 41) OR (_SPEZ == 42))
_OVR[4]=_OVR[4]*2
ENDIF
_OVR[0+_MA] = _OVR[0]
_OVR[4+_MA] = _OVR[4]
_OVR[16] = _OVR[4] - _OVR[0]
_OVR[16+_MA] = _OVR[16]
ELSE
GOTOF _ERR90
ENDIF
IF (_HKNUM == 0)
GOTOF _M_ENDE
ELSE
GOTOF _M_CYCLE115A
ENDIF
_M_DREH_KOR:
_REL_FRAME=CROT(_VAV,_H_OVR[20])
IF _COR_STAT
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_IFRAME")
IF _OVI[12] <> 0 GOTOF _ERR90
IF _K_NPV
$P_UIFR[_K_NPV]=$P_IFRAME
_PROTVAL[25] ="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_K_NPV
ELSE
$P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR
ENDIF
ELSE
IF _HKNUM==2000
_ZIEL="$P_SETFR"
ELSE
_ZIEL="$P_CHBFR["<<_M_BFNR<<"]"
ENDIF
_OVI[12]=ADDFRAME(_REL_FRAME,_ZIEL)
IF _OVI[12] <> 0 GOTOF _ERR90
IF _HKNUM==2000
IF $MN_MM_FRAME_FINE_TRANS
$P_SETFR[_XX,TR]=$P_SETFR[_XX,TR]+$P_SETFR[_XX,FI] $P_SETFR[_XX,FI]=0
$P_SETFR[_YY,TR]=$P_SETFR[_YY,TR]+$P_SETFR[_YY,FI] $P_SETFR[_YY,FI]=0
$P_SETFR[_ZZ,TR]=$P_SETFR[_ZZ,TR]+$P_SETFR[_ZZ,FI] $P_SETFR[_ZZ,FI]=0
ENDIF
_PROTVAL[25] ="$P_SETFR["<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_SETFR["<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)
ELSE
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR
ENDIF
ENDIF
GOTOF _M_ENDE_K
_M_RUND_KOR: E_MESS_AM=E_MESS_AM + 5
_VRA=AXNAME(_RANAME)
_TCNR=$P_TC
IF(_TCNR)
IF ((AXSTRING(_VRA) == $TC_CARR35[_TCNR]) OR (AXSTRING(_VRA) == $TC_CARR36[_TCNR])) AND ($TC_CARR37[_TCNR] _DEC9 <> 0)
_BTCARR=1
ENDIF
ENDIF
IF $MA_IS_ROT_AX[_VRA]==0
_ALARM=61329
ENDIF
_ORIG_FRAME=$P_ACTFRAME
IF _ALARM GOTOF _ERR54
IF (_BTCARR OR _BTRAFO)
_REL_FRAME[_VAV,RT]=_H_OVR[20]
ELSE
_REL_FRAME[_VAV,RT]=_H_OVR[20]- $P_ACTFRAME[_VAV,RT]
ENDIF
_HH=0 _CAL[0]=0.0000009
IF _COR_STAT
_H_OVR[7]=$P_ACTFRAME[_VRA,TR] - $P_IFRAME[_VRA,TR]
IF $MN_MM_FRAME_FINE_TRANS
_H_OVR[7]=_H_OVR[7]+$P_ACTFRAME[_VRA,FI]- $P_IFRAME[_VRA,FI]
ENDIF
IF _K_NPV
IF $MN_MM_FRAME_FINE_TRANS
$P_UIFR[_K_NPV,_VRA,TR]=$P_UIFR[_K_NPV,_VRA,TR]+$P_UIFR[_K_NPV,_VRA,FI] $P_UIFR[_K_NPV,_VRA,FI]=0
ENDIF
SBLOF
_RET_FRAME1=$P_UIFR[_K_NPV]
IF ($MN_MM_NUM_GLOBAL_USER_FRAMES>0)
_H_OVR[9]=_H_OVR[20]
GOTOF _KRH1
ENDIF
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_UIFR["<<_K_NPV<<"]")
_AFTER_FRAME=$P_UIFR[_K_NPV]
IF _OVI[12]<>0 GOTOF _ERR90
IF ((ABS($P_UIFR[_K_NPV,_XX,RT])> _CAL[0]) AND ((ABS($P_UIFR[_K_NPV,_XX,RT]) < 179.9999991) OR (ABS($P_UIFR[_K_NPV,_XX,RT]) > 180.0000009)))
_H_OVR[9]=$P_UIFR[_K_NPV,_XX,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_UIFR[_K_NPV,_YY,RT])> _CAL[0]) AND ((ABS($P_UIFR[_K_NPV,_YY,RT]) < 179.9999991) OR (ABS($P_UIFR[_K_NPV,_YY,RT]) > 180.0000009)))
_H_OVR[9]= $P_UIFR[_K_NPV,_YY,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_UIFR[_K_NPV,_ZZ,RT])> _CAL[0]) AND ((ABS($P_UIFR[_K_NPV,_ZZ,RT]) < 179.9999991) OR (ABS($P_UIFR[_K_NPV,_ZZ,RT]) > 180.0000009)))
_H_OVR[9]= $P_UIFR[_K_NPV,_ZZ,RT] _HH=_HH+1
ENDIF
IF _HH<=1 GOTOF _KRH1
$P_UIFR[_K_NPV]=_RET_FRAME1
GOTOF _ERR90
_KRH1: $P_UIFR[_K_NPV]=_RET_FRAME1
SBLON
REPEAT _KIPPA _KIPPE
IF (_BTCARR OR _BTRAFO)
_H_OVR[8]=$P_UIFR[_K_NPV,_VRA,TR] + _H_OVR[9]
ELSE
_H_OVR[8]=$AA_IM[_VRA]+_H_OVR[9]
ENDIF
$P_UIFR[_K_NPV,_VRA,TR]=_H_OVR[8] - _H_OVR[7]
_PROTVAL[25]="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_VRA)<<",TR]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<","<<_K_NPV<<",1,"<<AXSTRING(_VRA)
ELSE
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_VRA,TR]=$P_CHBFR[_M_BFNR,_VRA,TR]+$P_CHBFR[_M_BFNR,_VRA,FI] $P_CHBFR[_M_BFNR,_VRA,FI]=0
ENDIF
SBLOF
_RET_FRAME1=$P_CHBFR[_M_BFNR]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
_AFTER_FRAME=$P_CHBFR[_M_BFNR]
IF _OVI[12]<>0 GOTOF _ERR90
IF ((ABS($P_CHBFR[_M_BFNR,_XX,RT])> _CAL[0]) AND ((ABS($P_CHBFR[_M_BFNR,_XX,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_XX,RT]) > 180.0000009)))
_H_OVR[9]=$P_CHBFR[_M_BFNR,_XX,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_YY,RT])> _CAL[0]) AND ((ABS($P_CHBFR[_M_BFNR,_YY,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_YY,RT]) > 180.0000009)))
_H_OVR[9]= $P_CHBFR[_M_BFNR,_YY,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT])> _CAL[0]) AND ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) > 180.0000009)))
_H_OVR[9]= $P_CHBFR[_M_BFNR,_ZZ,RT] _HH=_HH+1
ENDIF
IF _HH<=1 GOTOF _KRH2
$P_CHBFR[_M_BFNR]=_RET_FRAME1
GOTOF _ERR90
_KRH2: $P_CHBFR[_M_BFNR]=_RET_FRAME1
SBLON
REPEAT _KIPPA _KIPPE
IF (_BTCARR OR _BTRAFO)
_H_OVR[8]=_H_OVR[9]
ELSE
_H_OVR[8]=$AA_IM[_VRA]+_H_OVR[9]
ENDIF
$P_CHBFR[_M_BFNR,_VRA,TR]=$P_CHBFR[_M_BFNR,_VRA,TR]+(_H_OVR[8] - _H_OVR[7])
_PROTVAL[25]="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_VRA)<<",TR]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",1,"<<AXSTRING(_VRA)
ENDIF
ELSE
IF _HKNUM == 2000
IF $MN_MM_FRAME_FINE_TRANS
$P_SETFR[_VRA,TR]=$P_SETFR[_VRA,TR]+$P_SETFR[_VRA,FI] $P_SETFR[_VRA,FI]=0
ENDIF
SBLOF
_RET_FRAME1=$P_SETFR
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_SETFR")
_AFTER_FRAME=$P_SETFR
IF _OVI[12]<>0 GOTOF _ERR90
IF ((ABS($P_SETFR[_XX,RT])> _CAL[0]) AND ((ABS($P_SETFR[_XX,RT]) < 179.9999991) OR (ABS($P_SETFR[_XX,RT]) > 180.0000009)))
_H_OVR[9]=$P_SETFR[_XX,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_SETFR[_YY,RT])> _CAL[0]) AND ((ABS($P_SETFR[_YY,RT]) < 179.9999991) OR (ABS($P_SETFR[_YY,RT]) > 180.0000009)))
_H_OVR[9]= $P_SETFR[_YY,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_SETFR[_ZZ,RT])> _CAL[0]) AND ((ABS($P_SETFR[_ZZ,RT]) < 179.9999991) OR (ABS($P_SETFR[_ZZ,RT]) > 180.0000009)))
_H_OVR[9]= $P_SETFR[_ZZ,RT] _HH=_HH+1
ENDIF
IF _HH<=1 GOTOF _KRH3
$P_SETFR=_RET_FRAME1
GOTOF _ERR90
_KRH3: $P_SETFR=_RET_FRAME1
SBLON
REPEAT _KIPPA _KIPPE
IF (_BTCARR OR _BTRAFO)
_H_OVR[8]=_H_OVR[9]
ELSE
_H_OVR[8]=$AA_IM[_VRA]+_H_OVR[9]
ENDIF
_H_OVR[7]=_H_OVR[8]-$P_ACTFRAME[_VRA,TR]
IF $MN_MM_FRAME_FINE_TRANS
_H_OVR[7]=_H_OVR[7]-$P_ACTFRAME[_VRA,FI]
ENDIF
$P_SETFR[_VRA,TR]=$P_SETFR[_VRA,TR]+_H_OVR[7]
_PROTVAL[25]="$P_SETFR["<<AXSTRING(_VRA)<<",TR]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<",,1,"<<AXSTRING(_VRA)
ELSE
IF _HKNUM >=1050
IF $MN_MM_FRAME_FINE_TRANS
$P_NCBFR[_M_BFNR,_VRA,TR]=$P_NCBFR[_M_BFNR,_VRA,TR]+$P_NCBFR[_M_BFNR,_VRA,FI] $P_NCBFR[_M_BFNR,_VRA,FI]=0
ENDIF
_H_OVR[9]=_H_OVR[20]
REPEAT _KIPPA _KIPPE
IF (_BTCARR OR _BTRAFO)
_H_OVR[8]=_H_OVR[9]
ELSE
_H_OVR[8]=$AA_IM[_VRA]+_H_OVR[9]
ENDIF
_H_OVR[7]=_H_OVR[8]-$P_ACTFRAME[_VRA,TR]
IF $MN_MM_FRAME_FINE_TRANS
_H_OVR[7]=_H_OVR[7]-$P_ACTFRAME[_VRA,FI]
ENDIF
$P_NCBFR[_M_BFNR,_VRA,TR]=$P_NCBFR[_M_BFNR,_VRA,TR]+_H_OVR[7]
_PROTVAL[25]="$P_NCBFR["<<_M_BFNR<<","<<AXSTRING(_VRA)<<",TR]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",1,"<<AXSTRING(_VRA)
ELSE
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_VRA,TR]=$P_CHBFR[_M_BFNR,_VRA,TR]+$P_CHBFR[_M_BFNR,_VRA,FI] $P_CHBFR[_M_BFNR,_VRA,FI]=0
ENDIF
SBLOF
_RET_FRAME1=$P_CHBFR[_M_BFNR]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
_AFTER_FRAME=$P_CHBFR[_M_BFNR]
IF _OVI[12]<>0 GOTOF _ERR90
IF ((ABS($P_CHBFR[_M_BFNR,_XX,RT])> _CAL[0]) AND ((ABS($P_CHBFR[_M_BFNR,_XX,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_XX,RT]) > 180.0000009)))
_H_OVR[9]=$P_CHBFR[_M_BFNR,_XX,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_YY,RT])> _CAL[0]) AND ((ABS($P_CHBFR[_M_BFNR,_YY,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_YY,RT]) > 180.0000009)))
_H_OVR[9]= $P_CHBFR[_M_BFNR,_YY,RT] _HH=_HH+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT])> _CAL[0]) AND ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) > 180.0000009)))
_H_OVR[9]= $P_CHBFR[_M_BFNR,_ZZ,RT] _HH=_HH+1
ENDIF
IF _HH<=1 GOTOF _KRH4
$P_CHBFR[_M_BFNR]=_RET_FRAME1
GOTOF _ERR90
_KRH4: $P_CHBFR[_M_BFNR]=_RET_FRAME1
SBLON
REPEAT _KIPPA _KIPPE
IF (_BTCARR OR _BTRAFO)
_H_OVR[8]=_H_OVR[9]
ELSE
_H_OVR[8]=$AA_IM[_VRA]+_H_OVR[9]
ENDIF
_H_OVR[7]=_H_OVR[8]-$P_ACTFRAME[_VRA,TR]
IF $MN_MM_FRAME_FINE_TRANS
_H_OVR[7]=_H_OVR[7]-$P_ACTFRAME[_VRA,FI]
ENDIF
$P_CHBFR[_M_BFNR,_VRA,TR]=$P_CHBFR[_M_BFNR,_VRA,TR]+_H_OVR[7]
_PROTVAL[25]="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_VRA)<<",TR]" _PROTVAL[29]="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",1,"<<AXSTRING(_VRA)
ENDIF
ENDIF
ENDIF
_OVR[7]=(ROUND(_H_OVR[7] *_HI[4]))/_HI[4] _OVR[8]=(ROUND(_H_OVR[8] *_HI[4]))/_HI[4] _OVR[9]=(ROUND(_H_OVR[9] *_HI[4]))/_HI[4]
GOTOF _M_ENDE_K
_M_KORREKTUR_3_4:
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0 $AC_MEAS_TOOL_MASK=11
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0
$AC_MEAS_TYPE=20
$AA_MEAS_POINT1[_XX]=_OVR[5] $AA_MEAS_POINT1[_YY]=_OVR[6] $AA_MEAS_POINT1[_ZZ]=$AA_IW[_ZZ]
$AA_MEAS_SETPOINT[_XX]=0 $AA_MEAS_SETPOINT[_YY]=0
$AC_MEAS_FINE_TRANS=0
$AC_MEAS_FRAME_SELECT=_FRSEL
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR90
IF _COR_STAT
$P_IFRAME=$AC_MEAS_FRAME
ELSE
IF _HKNUM==2000
$P_SETFRAME=$AC_MEAS_FRAME
ELSE
$P_CHBFRAME[_M_BFNR]=$AC_MEAS_FRAME
ENDIF
ENDIF
STOPRE
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XX]=_MP[1,0] $AA_MEAS_POINT1[_YY]=_MP[1,1]
$AA_MEAS_POINT2[_XX]=_MP[2,0] $AA_MEAS_POINT2[_YY]=_MP[2,1]
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0 $AC_MEAS_TYPE=16
$AC_MEAS_FRAME_SELECT=_FRSEL
$AC_MEAS_WP_SETANGLE=_SWAP
$AC_MEAS_FINE_TRANS=0
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0 _HELPR=$AC_MEAS_WP_ANGLE
_HELPR=ROUND(_HELPR*10000)/10000
IF _OVI[12]<>0 GOTOF _ERR90
IF ABS(_OVR[4]-_HELPR)==180
_REL_FRAME=CROT(_ZZ,180)
ENDIF
IF _COR_STAT
$P_IFRAME=$AC_MEAS_FRAME: _REL_FRAME
STOPRE
ELSE
IF _HKNUM==2000
$P_SETFRAME=$AC_MEAS_FRAME _ZIEL="$P_SETFRAME"
ELSE
$P_CHBFRAME[_M_BFNR]=$AC_MEAS_FRAME
_ZIEL="$P_CHBFRAME["<<_M_BFNR<<"]"
ENDIF
_OVI[12]=ADDFRAME(_REL_FRAME,_ZIEL)
ENDIF
STOPRE
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0 $AC_MEAS_TOOL_MASK=11
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0
$AC_MEAS_TYPE=20
$AA_MEAS_POINT1[_XX]=0 $AA_MEAS_POINT1[_YY]=0
$AA_MEAS_POINT1[_ZZ]=$AA_IW[_ZZ]
$AA_MEAS_SETPOINT[_XX]=_SWA $AA_MEAS_SETPOINT[_YY]=_SWO
$AC_MEAS_FINE_TRANS=0
$AC_MEAS_FRAME_SELECT=_FRSEL
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR90
_FINAL_COR:
IF _COR_STAT
$P_IFRAME=$AC_MEAS_FRAME
STOPRE
IF _SPEZ == 20
_PROTVAL[25]="$P_IFRAME["<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_IFRAME["<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27]="$P_IFRAME["<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","
ELSE
_PROTVAL[25]="$P_IFRAME["<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_IFRAME["<<AXSTRING(_YY)<<",TR]"
_PROTVAL[27]="$P_IFRAME["<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<",,2"
ENDIF
IF _K_NPV
$P_UIFR[_K_NPV]=$P_IFRAME
IF _SPEZ == 20
_PROTVAL[25]="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27]="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<< _K_NPV
ELSE
_PROTVAL[25]="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_YY)<<",TR]"
_PROTVAL[27]="$P_UIFR["<<_K_NPV<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<< _K_NPV<<",2"
ENDIF
ELSE
$P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF _SPEZ == 20
_PROTVAL[25]="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27]="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR
ELSE
_PROTVAL[25]="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",TR]"
_PROTVAL[27]="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR <<",2"
ENDIF
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ENDIF
ELSE
IF _HKNUM==2000
$P_SETFR=$AC_MEAS_FRAME $P_SETFRAME=$P_SETFR
IF _SPEZ == 20
_PROTVAL[25]="$P_SETFR["<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27]="$P_SETFR["<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","
ELSE
_PROTVAL[25]="$P_SETFR["<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",TR]"
_PROTVAL[27]="$P_SETFR["<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<",,2"
ENDIF
IF $MN_MM_FRAME_FINE_TRANS
$P_SETFR[_XX,TR]=$P_SETFR[_XX,TR]+$P_SETFR[_XX,FI] $P_SETFR[_XX,FI]=0
$P_SETFR[_YY,TR]=$P_SETFR[_YY,TR]+$P_SETFR[_YY,FI] $P_SETFR[_YY,FI]=0
$P_SETFR[_ZZ,TR]=$P_SETFR[_ZZ,TR]+$P_SETFR[_ZZ,FI] $P_SETFR[_ZZ,FI]=0
ENDIF
ELSE
$P_CHBFRAME[_M_BFNR]=$AC_MEAS_FRAME $P_CHBFR[_M_BFNR]=$P_CHBFRAME[_M_BFNR]
IF _SPEZ == 20
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR
ELSE
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",TR]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",TR]"
_PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR <<",2"
ENDIF
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ENDIF
ENDIF
STOPRE
GOTOF _M_ENDE_K
_M_CYCLE115:_OVI[2]=977
_OVR[1]=SET(_SWA,_SWO)
_M_CYCLE115A:
_OVR[20]=SET(_OVR[5],_OVR[6])
_HH=_KNUM _KNUM=_HKNUM
IF _COR_STAT
IF _K_NPV
_REL_FRAME=$P_IFRAME _REL_FRAME[_XX,TR]=$P_UIFR[_K_NPV,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_K_NPV,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_K_NPV,_ZZ,TR]
IF $MN_MM_FRAME_FINE_TRANS
_REL_FRAME[_XX,TR]=_REL_FRAME[_XX,TR]+$P_UIFR[_K_NPV,_XX,FI] _REL_FRAME[_XX,FI]=0
_REL_FRAME[_YY,TR]=_REL_FRAME[_YY,TR]+$P_UIFR[_K_NPV,_YY,FI] _REL_FRAME[_YY,FI]=0
_REL_FRAME[_ZZ,TR]=_REL_FRAME[_ZZ,TR]+$P_UIFR[_K_NPV,_ZZ,FI] _REL_FRAME[_ZZ,FI]=0
ENDIF
$P_UIFR[_K_NPV]=_REL_FRAME
ELSE
$P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ENDIF
ENDIF
CYCLE115(_ALARM,_MAV,0)
_OVR[5]=SET(_OVR[20],_OVR[21])
_KNUM=_HH
IF _ALARM GOTOF _ERR55
_M_ENDE_K:
_TCNR=$P_TC
G[8]=_A_NPV
IF E_MESS_AM MOD 10 == 2
IF _TCNR == 0
IF (_BTRAFO)
E_MESS_AM=E_MESS_AM+1
ELSE
E_MESS_AM=E_MESS_AM+2
ENDIF
ENDIF
ENDIF
IF((_TCNR) AND (E_MESS_AM == 5))
IF ($TC_CARR37[_TCNR] _DEC9 <> 0)
_RAX1=AXNAME($TC_CARR35[_TCNR])
E_MESS[10] = _ORIG_FRAME[_RAX1,TR]
E_MESS[11] = $P_ACTFRAME[_RAX1,TR]
IF $TC_CARR36[_TCNR]<>""
_RAX2=AXNAME($TC_CARR36[_TCNR])
E_MESS[12] = _ORIG_FRAME[_RAX2,TR]
E_MESS[13] = $P_ACTFRAME[_RAX2,TR]
ENDIF
ENDIF
ENDIF
IF _OVI[14]
CUST_MEACYC(2)
ENDIF
_M_ENDE:
RET
_ERR50: _OVI[9]=_ALARM
N613150 SETAL(_ALARM)
_ERR51: _OVI[9]=_ALARM
N613151 SETAL(_ALARM)
_ERR52: _OVI[9]=_ALARM
N613152 SETAL(_ALARM)
_ERR53: _OVI[9]=_ALARM
N613153 SETAL(_ALARM,_SERR)
_ERR54: _OVI[9]=_ALARM
N613154 SETAL(_ALARM)
_ERR55: _OVI[9]=_ALARM
N613155 SETAL(_ALARM)
_ERR56: _OVI[9]=61321
N613156 SETAL(_OVI[9])
RET
_ERR60: _OVI[9]=_ALARM
N613160 SETAL(_OVI[9],_SERR)
RET
_ERR61: _OVI[9]=_ALARM
N613161 SETAL(_OVI[9],_SERR)
RET
_ERR62: _OVI[9]=_ALARM
N613162 SETAL(_OVI[9],_SERR)
RET
_ERR63: _OVI[9]=_ALARM
N613163 SETAL(_OVI[9],_SERR)
RET
_ERR70: _OVI[9]=61019
N613170 SETAL(_OVI[9],_SERR)
RET
_ERR80: _OVI[9]=_ALARM
N613180 SETAL(_OVI[9],_SERR)
RET
_ERR81: _OVI[9]=_ALARM
N613181 SETAL(_OVI[9],_SERR)
RET
_ERR90: _OVI[9]=61403 _OVI[11]=0
IF ($SNS_MEA_ALARM_MASK B_AND 'B1')
N613190 SETAL(61099," 6,    MEASURE Error= "<<_OVI[12])
ELSE
N613190 SETAL(_OVI[9])
ENDIF
RET
_KIPPA:
IF ((ABS(_ORIG_FRAME[X,RT] - _AFTER_FRAME[X,RT]) == 180) AND (ABS(_ORIG_FRAME[Z,RT] - _AFTER_FRAME[Z,RT]) == 180))
_BGEKIPPT[1]=1
ENDIF
IF (ABS(_H_OVR[20] - _AFTER_FRAME[X,RT]) == 360)
_BGEKIPPT[0]=1
ENDIF
IF (ABS(_H_OVR[20] - _AFTER_FRAME[Z,RT]) == 360)
_BGEKIPPT[2]=1
ENDIF
IF (_BGEKIPPT[0] OR _BGEKIPPT[1] OR _BGEKIPPT[2])
_H_OVR[9] = _H_OVR[16]
ENDIF
_KIPPE:

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE132_SPF
PROC CYCLE132(INT _STEUERPAR1, INT _STEUERPAR2, STRING[5] _RA_NAME,INT _HKNUM, REAL _FR_D_RA_F,INT S_ST)
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.010 ;DATE: 2024-05-29
DEF INT _GH,_TCNR,_OVR_J,_ST0,_ST1,_ST10_11,_DIR,_STATUS
DEF REAL _OFFSET=0, _ACTVALUE=0
DEF STRING[32] _TC
IF _HKNUM==100
_HKNUM=0
ELSE
IF _HKNUM==0
_HKNUM=1000
ENDIF
ENDIF
IF _HKNUM
IF _HKNUM < 1000
_GH=_HKNUM+1
ELSE
IF _HKNUM==9999
_GH=$P_GG[8]-1
ELSE
_GH=1
ENDIF
ENDIF
ENDIF
IF ((_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19))
IF _MIJ_I[3] == 17
N26 G17
ELSE
IF _MIJ_I[3] == 18
N27 G18
ELSE
N28 G19
ENDIF
ENDIF
ENDIF
IF((_STEUERPAR1 == 10) OR (_STEUERPAR1 == 11)) AND ($P_TC > 0)
IF ($TC_CARR37[$P_TC] _DEC9 == 0)
IF (_STEUERPAR1 == 10)
GOTOF _MM20
ENDIF
IF (_STEUERPAR1 == 11)
GOTOF _MM21
ENDIF
ENDIF
ENDIF
CASE _STEUERPAR1 OF 0 GOTOF _MM0 1 GOTOF _MM1 10 GOTOF _MM10 11 GOTOF _MM11 20 GOTOF _MM20 21 GOTOF _MM21
RET
_MM0:
RET
_MM1:
G[8]=_GH
IF (_MIJ_I[4]<>100) OR ((_MIJ_I[4]==100) AND ($MC_GCODE_RESET_MODE[7]==0))
_MIJ_I[4]=_GH-1
ENDIF
RET
_MM11:
G[8]=_GH
IF (_MIJ_I[4]<>100) OR ((_MIJ_I[4]==100) AND ($MC_GCODE_RESET_MODE[7]==0))
_MIJ_I[4]=_GH-1
ENDIF
_MM10:
_TCNR=$P_TC
IF _TCNR
_TC=<<$TC_CARR34[_TCNR]
IF (S_ST > 0)
IF ($TC_CARR36[$P_TC]<>"")
_OFFSET = $TC_CARR25[_TCNR]
_ACTVALUE = $AA_IM[AXNAME($TC_CARR36[_TCNR])]
ENDIF
IF (($TC_CARR24[_TCNR] == $AA_IM[AXNAME($TC_CARR35[_TCNR])]) AND (_OFFSET == _ACTVALUE))
_ST0 = 1-(S_ST B_AND 'B000000000001')
ELSE
_ST0 = S_ST B_AND 'B000000000001'
ENDIF
_ST1 = (S_ST B_AND 'B000000000010')/2
_ST10_11 = ABS(((S_ST B_AND 'B110000000000')/1024)-3)
IF (_ST10_11 == 2)
_DIR = 1
ELSE
IF (_ST10_11 == 1)
_DIR = -1
ELSE
_DIR = 3
ENDIF
ENDIF
_STATUS = _ST0 + (_ST1*10) + (_ST10_11*100000)
ENDIF
CYCLE800(_STEUERPAR2,_TC,_STATUS,57,0,0,0,0,0,0,0,0,0,_DIR,_FR_D_RA_F)
ELSE
_TCNR=$P_TRAFO _OVR_J =20
IF ((_TCNR>0) AND (_TCNR<256))
G0 G90 G40 G60 ORIWKS
DO $AC_OVR=_OVR_J
IF ($P_GG[6]==1)
A3=0 B3=0 C3=1
ELSE
IF ($P_GG[6]==2)
A3=0 B3=1 C3=0
ELSE
A3=1 B3=0 C3=0
ENDIF
ENDIF
ELSE
ENDIF
ENDIF
RET
_MM21:
G[8]=_GH
IF (_MIJ_I[4]<>100) OR ((_MIJ_I[4]==100) AND ($MC_GCODE_RESET_MODE[7]==0))
_MIJ_I[4]=_GH-1
ENDIF
_MM20:
_GH=$P_GG[15]
G94
IF _STEUERPAR2
G1 F=_FR_D_RA_F AX[AXNAME(_RA_NAME)]=0
ELSE
_OVR_J=($MA_JOG_VELO_RAPID[AXNAME(_RA_NAME)]/$MA_MAX_AX_VELO[AXNAME(_RA_NAME)])*100
IF _OVR_J >100
_OVR_J=100
ENDIF
IF _OVR_J >0
DO $AC_OVR=_OVR_J
ENDIF
G0 AX[AXNAME(_RA_NAME)]=0
ENDIF
G[15]=_GH
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE133_SPF
PROC CYCLE133(INT _MODE, INT S_AX, REAL S_XYZM) SAVE SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.21.00.00.010 ;DATE: 2023-01-13
;tool measurement
DEF INT S_ERR=0,S_H_MODE[4],S_ALARM,S_CORCOMP,S_CORMODE,S_GEOAX,S_DIR=1,_LOG,_LOG_ON=0,_A=1,_O=2,_AP=3
DEF REAL S_IW_MA,S_GC_LEN[11],S_WZL_MA,S_KOR_WERT[3],S_DPROT=0
DEF STRING[2] S_COMP=""
DEF STRING[100] S_SERR="",_LOG_FILE
DEF AXIS _XX,_YY,_ZZ
DIAMCYCOF
_MODE=ABS(_MODE)
S_H_MODE[0]=(_MODE _DEC1) S_H_MODE[1]=(_MODE _DEC2) S_H_MODE[2]=(_MODE _DEC3) S_H_MODE[3]=(_MODE _DEC4)
IF ( (S_H_MODE[0]<1)OR(S_H_MODE[0]>6) )
S_SERR=<<"(_MODE: dec1)"
GOTOF _FEHL0
ENDIF
IF (S_H_MODE[0]==6) GOTOF _MARK6
IF ( ((S_H_MODE[0]==1)OR(S_H_MODE[0]==4))AND((S_H_MODE[1]<0)OR(S_H_MODE[1]>4)) )
S_SERR=<<"(_MODE: dec2)"
GOTOF _FEHL0
ENDIF
IF ( (S_H_MODE[2]<0)OR(S_H_MODE[2]>1) )
S_SERR=<<"(_MODE: dec3)"
GOTOF _FEHL0
ENDIF
IF ( (S_H_MODE[3]<0)OR(S_H_MODE[3]>1) )
S_SERR=<<"(_MODE: dec4)"
GOTOF _FEHL0
ENDIF
IF ( (S_H_MODE[0]<5)AND((S_AX<1)OR(S_AX>3)) )
S_SERR=<<"(S_AX)"
GOTOF _FEHL0
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE133_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF(_LOG_ON)
DELETE(_LOG,_LOG_FILE)
WRITE(_LOG,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
S_SERR="GETTCOR"
S_ERR=GETTCOR(S_GC_LEN,"-TCK:W",,,)
IF (S_ERR<0) GOTOF _FEHL1
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Ebene: "<<$P_GG[6])
WRITE(_LOG,_LOG_FILE,"MC_TOOL_PARAMETER_DEF_MASK[24]: "<<$MC_TOOL_PARAMETER_DEF_MASK B_AND 'H1000000')
WRITE(_LOG,_LOG_FILE,"GETTCOR - WZL:")
WRITE(_LOG,_LOG_FILE,"ABS: "<<S_GC_LEN[2]<<" ORD: "<<S_GC_LEN[3]<<" APP: "<<S_GC_LEN[4])
ENDIF
IF ( (S_H_MODE[0]==4)AND(S_AX==2) )
S_XYZM=S_XYZM/2
ENDIF
IF (S_H_MODE[0]==5)
S_AX=1 S_H_MODE[2]=0
ENDIF
CASE (S_AX) OF 1 GOTOF _ABS_A 2 GOTOF _ORD_A 3 GOTOF _APP_A
_ABS_A:
_XX=$P_AXN1 S_WZL_MA=S_GC_LEN[2]
IF (S_H_MODE[2]==1)
S_IW_MA=E_MESS[0]
ELSE
S_IW_MA=$P_EP[_XX]
ENDIF
GOTOF _END_AX
_ORD_A:
_YY=$P_AXN2 S_WZL_MA=S_GC_LEN[3]
IF (S_H_MODE[2]==1)
S_IW_MA=E_MESS[1]
ELSE
S_IW_MA=$P_EP[_YY]
ENDIF
_ORD_E:
GOTOF _END_AX
_APP_A:
_ZZ=$P_AXN3 S_WZL_MA=S_GC_LEN[4]
IF (S_H_MODE[2]==1)
S_IW_MA=E_MESS[2]
ELSE
S_IW_MA=$P_EP[_ZZ]
ENDIF
_END_AX:
S_COMP="GW" S_CORMODE=2 S_GEOAX=S_AX-1
CASE (S_H_MODE[0]) OF 1 GOTOF _MARK1 2 GOTOF _MARK2 3 GOTOF _MARK3 4 GOTOF _MARK4 5 GOTOF _MARK5 6 GOTOF _MARK6
_MARK1:
S_CORCOMP=0
IF (S_H_MODE[1]==1)
S_KOR_WERT[0]=S_IW_MA+S_WZL_MA-S_XYZM
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lnge setzen Technologie Frsen - Bezugspunkt Werkstck")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_IW_MA<<" + "<<S_WZL_MA<<" - "<<S_XYZM)
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
ELSE
S_KOR_WERT[0]=S_IW_MA+S_WZL_MA-$MCS_J_MEA_FIXPOINT-S_XYZM
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lnge setzen Technologie Frsen - Bezugspunkt Festpunkt")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_IW_MA<<" + "<<S_WZL_MA<<" - "<<$MCS_J_MEA_FIXPOINT<<" - "<<S_XYZM)
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
ENDIF
REPEAT _KORR_WZ_A _KORR_WZ_E
GOTOF _END
_MARK2:
S_CORCOMP=6
S_KOR_WERT[0]=ABS(S_IW_MA-S_XYZM)
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Durchmesser setzen Technologie Frsen - Bezugspunkt Werkstck")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]=ABS("<<S_IW_MA<<" - "<<S_XYZM<<")")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
REPEAT _KORR_WZ_A _KORR_WZ_E
GOTOF _END
_MARK3:
$MCS_J_MEA_FIXPOINT=S_IW_MA-S_XYZM
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Abgleich Festpunkt Technologie Frsen")
WRITE(_LOG,_LOG_FILE,"$MCS_J_MEA_FIXPOINT="<<S_IW_MA<<" - "<<S_XYZM)
WRITE(_LOG,_LOG_FILE,"$MCS_J_MEA_FIXPOINT="<<$MCS_J_MEA_FIXPOINT)
ENDIF
GOTOF _END
_MARK4:
S_CORCOMP=0
IF ( (S_H_MODE[3]==1)AND(S_AX==2)AND($MCS_REV_2_BORDER_TOOL_LENGTH<>0)AND($P_ACTFRAME[_YY,MI]==0) )
S_DIR=-1
ENDIF
IF ( (S_H_MODE[1]==0)OR(S_H_MODE[1]==1) )
S_KOR_WERT[0]=S_IW_MA+S_WZL_MA-((S_DIR)*(S_XYZM))
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lnge setzen Technologie Drehen - Bezugspunkt Werkstck")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_IW_MA<<" + "<<S_WZL_MA<<" - (("<<S_DIR<<")"<<" * "<<S_XYZM<<")")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
ELSE
IF (S_H_MODE[1]==3)
S_KOR_WERT[0]=S_IW_MA+S_WZL_MA-$MAS_SPINDLE_PARAMETER[0,_F_S_AX[5]]
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lnge setzen Technologie Drehen - Bezugspunkt Hauptspindelfutter")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_IW_MA<<" + "<<S_WZL_MA<<" - "<<$MAS_SPINDLE_PARAMETER[0,_F_S_AX[5]])
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
ELSE
S_KOR_WERT[0]=$MAS_SPINDLE_PARAMETER[0,_F_S_AX[6]]-S_IW_MA-S_WZL_MA
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lnge setzen Technologie Drehen - Bezugspunkt Gegenspindelfutter")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<$MAS_SPINDLE_PARAMETER[0,_F_S_AX[6]]<<" - "<<S_IW_MA<<" - "<<S_WZL_MA)
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
ENDIF
ENDIF
REPEAT _KORR_WZ_A _KORR_WZ_E
IF ( (S_AX==2)AND($MCS_REV_2_BORDER_TOOL_LENGTH<>0) )
D=$P_TOOL DL=$P_DLNO
F_T_REV2
ENDIF
GOTOF _END
_MARK5:
S_CORCOMP=0
S_KOR_WERT[0]=S_IW_MA+S_WZL_MA-$MCS_J_MEA_MAGN_GLAS_POS[1]
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lupe Technologie Drehen - Abszisse")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_IW_MA<<" + "<<S_WZL_MA<<" - "<<$MCS_J_MEA_MAGN_GLAS_POS[1])
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
REPEAT _KORR_WZ_A _KORR_WZ_E
REPEAT _ORD_A _ORD_E
S_GEOAX=1
S_KOR_WERT[0]=S_IW_MA+S_WZL_MA-$MCS_J_MEA_MAGN_GLAS_POS[0]
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Lupe Technologie Drehen - Ordinate")
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_IW_MA<<" + "<<S_WZL_MA<<" - "<<$MCS_J_MEA_MAGN_GLAS_POS[0])
WRITE(_LOG,_LOG_FILE,"S_KOR_WERT[0]="<<S_KOR_WERT[0])
ENDIF
REPEAT _KORR_WZ_A _KORR_WZ_E
GOTOF _END
_MARK6:
_A=1 _O=2 _AP=3
IF ($P_GG[6]==1) GOTOF _MERK_POS
_A=3 _O=1 _AP=2
IF ($P_GG[6]==2) GOTOF _MERK_POS
_A=2 _O=3 _AP=1
_MERK_POS:
IF ISAXIS(_A)
_XX=$P_AXN1
E_MESS[0]=$P_EP[_XX]
ENDIF
IF ISAXIS(_O)
_YY=$P_AXN2
E_MESS[1]=$P_EP[_YY]
ENDIF
IF ISAXIS(_AP)
_ZZ=$P_AXN3
E_MESS[2]=$P_EP[_ZZ]
ENDIF
_END: RET
_KORR_WZ_A:
S_SERR="SETTCOR"
S_ERR=SETTCOR(S_KOR_WERT,S_COMP,S_CORCOMP,S_CORMODE,S_GEOAX)
IF (S_ERR<0) GOTOF _FEHL1
D=$P_TOOL DL=$P_DLNO
_KORR_WZ_E:
_FEHL0: STOPRE
N613300 SETAL(61019,S_SERR)
RET
_FEHL1: STOPRE
N613301 SETAL(61099,S_SERR)
RET
_FEHL2: STOPRE
N613302 SETAL(61336)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE134_SPF
PROC CYCLE134 SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.95.00.00.021 ;DATE: 2021-07-06
;MA JOG caller
DEF INT _PROGEND
CALL "/_N_WKS_DIR/_N_TEMP_WPD/_N_MA_JOG_STEP"<<$P_CHANNO<<"_MPF"
If ($MN_M_NO_FCT_EOP >= 0)
_PROGEND=$MN_M_NO_FCT_EOP
ELSE
GOTOF _END
ENDIF
M=_PROGEND
_END:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE140_SPF
PROC CYCLE140(INT __NR,INT _AX,INT _DIR,INT _WOPL,INT _MEASFR,REAL _H_VMS) SAVE SBLOF ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.02.00.082 ;DATE: 2017-08-10
;Cycle : ShopTurn, calibration toolsetter
DEF INT _P29,_MT,_TSNR=0,_NR,_H_INT[3]=(1,1,1)
DEF REAL _NPV
DEF AXIS _AABS,_AORD,_AAPP
IF ($AN_NCK_VERSION<660000)
N614001 SETAL(61342)
RET
ENDIF
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4]+1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
G290
D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0 GOTOF _FEHL2
OFFN=0
_SMI_R[10]=93101.901 _NR=__NR-1
IF (_NR<0) OR (__NR>$MNS_MEA_CAL_TP_NUM) GOTOF _FEHL1
_P29=$P_GG[29]
N10 DIAMOF
IF (ISAXIS(1))AND(ISAXIS(2))AND(ISAXIS(3))
_AABS=$P_AXN1 _AORD=$P_AXN2 _AAPP=$P_AXN3
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')AND($P_GG[29]==1)
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AABS)
_H_INT[0]=2
ELSE
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AORD)
_H_INT[1]=2
ELSE
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AAPP)
_H_INT[2]=2
ENDIF
ENDIF
ENDIF
ENDIF
GETD(_AABS,_AORD,_AAPP)
G1 G94 G90 F10
IF ($VA_POSCTRL_MODE[_AABS]<>3)
AX[_AABS]=$AA_IW[_AABS]/_H_INT[0]
ENDIF
IF ($VA_POSCTRL_MODE[_AORD]<>3)
AX[_AORD]=$AA_IW[_AORD]/_H_INT[1]
ENDIF
IF ($VA_POSCTRL_MODE[_AAPP]<>3)
AX[_AAPP]=$AA_IW[_AAPP]/_H_INT[2]
ENDIF
ELSE
IF ($P_GG[6]==1) AND ISAXIS(1) AND ISAXIS(2)
GOTOF _GEO_NKPL
ELSE
IF ($P_GG[6]==2) AND ISAXIS(1) AND ISAXIS(3)
GOTOF _GEO_NKPL
ELSE
IF ($P_GG[6]==3) AND ISAXIS(2) AND ISAXIS(3)
GOTOF _GEO_NKPL
ENDIF
ENDIF
ENDIF
ENDIF
GOTOF _GEO_END
_GEO_NKPL: _AABS=$P_AXN1 _AORD=$P_AXN2
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')AND($P_GG[29]==1)
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AABS)
_H_INT[0]=2
ELSE
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AORD)
_H_INT[1]=2
ENDIF
ENDIF
ENDIF
GETD(_AABS,_AORD)
G1 G94 F10 G90
IF ($VA_POSCTRL_MODE[_AABS]<>3)
AX[_AABS]=$AA_IW[_AABS]/_H_INT[0]
ENDIF
IF ($VA_POSCTRL_MODE[_AORD]<>3)
AX[_AORD]=$AA_IW[_AORD]/_H_INT[1]
ENDIF
_GEO_END:
F_SP_TRA(2040)
_MIJ_I[7]=_TSNR _MIJ_I[2]=__NR _MVAR=100000 _OVI[2]=982 _NMSP=1 _MA=_AX+1 _MD=_DIR _OVI[14]=1
IF _H_VMS == 0
_H_VMS=$SCS_MEA_TP_FEED_MEASURE
ENDIF
_SMI_R[0]=SET(_H_VMS,$MNS_J_MEA_T_PROBE_MEASURE_DIST,$MNS_J_MEA_T_PROBE_MEASURE_DIST,0)
_MEA_CORR_ANGLE[0]=SET(0,0,0)
IF ((ISFILE("/_N_CST_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CUS_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CUST_MEACYC_SPF")))
CUST_MEACYC(1)
ENDIF
N100 CYCLE982
IF ((ISFILE("/_N_CST_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CUS_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CUST_MEACYC_SPF")))
CUST_MEACYC(2)
ENDIF
G[29]=_P29
_OVI[14]=0
RET
_FEHL1: STOPRE
N614002 SETAL(61313)
RET
_FEHL2: STOPRE
N614003 SETAL(61311)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE141_SPF
PROC CYCLE141(INT __NR,INT _DD,INT _AX,INT _WOPL,INT _MEASFR) SAVE SBLOF ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.95.00.00.009 ;DATE: 2021-03-03
;Cycle : ShopTurn, measure-tool-length
DEF BOOL _U_D_SL=0
DEF BOOL _MESSEN_AUTO=0
DEF INT _TYP,_MESSVAR,_SL,_DIR_X,_DIR_Z,_P29,_SN,_MT,_TSNR=0,_NR,_H_INT[3]=(1,1,1)
DEF INT _DIR_T[2,10]=SET(0,1,-1,-1,1,1,-1,-1,-1,0,0,1,1,-1,-1,-1,1,-1,-1,0),_AD2_TABLE[10]=SET(0,2,1,4,3,7,6,5,8,9)
DEF REAL _NPV
DEF AXIS _AABS,_AORD,_AAPP
_U_D_SL=$MCS_MEA_FUNCTION_MASK B_AND 'B100000000000000000'
IF ($AN_NCK_VERSION<660000)
N614101 SETAL(61342)
RET
ENDIF
IF ($MCS_J_MEA_T_PROBE_APPR_MODE==2)
_MESSEN_AUTO=1
ENDIF
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4]+1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
D=_DD
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
OFFN=0
_SMI_R[10]=93101.901 _NR=__NR-1
IF (_NR<0)OR(__NR>$MNS_MEA_CAL_TP_NUM) GOTOF _FEHL2
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
G290
D=_DD DL=$P_DLNO
ENDIF
_SL=$P_ADT[2] _SN=$P_ADT[11] _TYP=$P_ADT[1] _P29=$P_GG[29]
N10 DIAMOF
IF (ISAXIS(1))AND(ISAXIS(2))AND(ISAXIS(3))
_AABS=$P_AXN1 _AORD=$P_AXN2 _AAPP=$P_AXN3
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')AND($P_GG[29]==1)
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AABS)
_H_INT[0]=2
ELSE
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AORD)
_H_INT[1]=2
ELSE
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AAPP)
_H_INT[2]=2
ENDIF
ENDIF
ENDIF
ENDIF
GETD(_AABS,_AORD,_AAPP)
G1 G94 G90 F10
IF ($VA_POSCTRL_MODE[_AABS]<>3)
AX[_AABS]=$AA_IW[_AABS]/_H_INT[0]
ENDIF
IF ($VA_POSCTRL_MODE[_AORD]<>3)
AX[_AORD]=$AA_IW[_AORD]/_H_INT[1]
ENDIF
IF ($VA_POSCTRL_MODE[_AAPP]<>3)
AX[_AAPP]=$AA_IW[_AAPP]/_H_INT[2]
ENDIF
ELSE
IF ($P_GG[6]==1) AND ISAXIS(1) AND ISAXIS(2)
GOTOF _GEO_NKPL
ELSE
IF ($P_GG[6]==2) AND ISAXIS(1) AND ISAXIS(3)
GOTOF _GEO_NKPL
ELSE
IF ($P_GG[6]==3) AND ISAXIS(2) AND ISAXIS(3)
GOTOF _GEO_NKPL
ENDIF
ENDIF
ENDIF
ENDIF
GOTOF _GEO_END
_GEO_NKPL: _AABS=$P_AXN1 _AORD=$P_AXN2
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')AND($P_GG[29]==1)
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AABS)
_H_INT[0]=2
ELSE
IF $MC_DIAMETER_AX_DEF==AXSTRING(_AORD)
_H_INT[1]=2
ENDIF
ENDIF
ENDIF
GETD(_AABS,_AORD)
G1 G94 F10 G90
IF ($VA_POSCTRL_MODE[_AABS]<>3)
AX[_AABS]=$AA_IW[_AABS]/_H_INT[0]
ENDIF
IF ($VA_POSCTRL_MODE[_AORD]<>3)
AX[_AORD]=$AA_IW[_AORD]/_H_INT[1]
ENDIF
_GEO_END:
F_SP_TRA(2040)
IF $P_TOOL<=0 GOTOF _FEHL3
_MIJ_I[7]=_TSNR _MIJ_I[2]=__NR _OVI[2]=982 _OVI[14]=1 _NMSP=1 _EVNUM=0 _MA=_AX+1 _MD=0 _MIJ_I[6]=0
_SMI_R[0]=SET($SNS_MEA_TP_FEED[_NR],$MNS_J_MEA_T_PROBE_MEASURE_DIST,$MNS_J_MEA_T_PROBE_MEASURE_DIST,0,$MNS_J_MEA_T_PROBE_MEASURE_DIST)
IF(_TYP>=500)AND(_TYP<599)
_MESSVAR=1
IF (_U_D_SL)
_SL=_AD2_TABLE[_SL]
ENDIF
ELSE
IF(_TYP>=100)AND(_TYP<299)
_MESSVAR=0
ELSE
IF ( (_TYP==700)OR(_TYP==730)OR(_TYP==731)OR(_TYP==750) )
_MESSVAR=0
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
ENDIF
IF ( (_TYP==700)OR(_TYP==730)OR(_TYP==731)OR(_TYP==750) )
IF (_SL==9)
_SL=7
ENDIF
ENDIF
IF(_MESSVAR==1)
IF (_MESSEN_AUTO)
_MVAR=1
ELSE
_MVAR=100001
ENDIF
_DIR_Z=_DIR_T[0,_SL]
_DIR_X=_DIR_T[1,_SL]
IF(_TYP==540)
IF(_SN==1)
_DIR_X=-1
ENDIF
IF(_SN==2)
_DIR_X=1
ENDIF
IF(_SN==3)
IF (_U_D_SL)
_DIR_Z=1
ELSE
_DIR_Z=-1
ENDIF
ENDIF
IF(_SN==4)
IF (_U_D_SL)
_DIR_Z=-1
ELSE
_DIR_Z=1
ENDIF
ENDIF
ENDIF
IF((_AX==1)AND(_DIR_X==0))OR((_AX==0)AND(_DIR_Z==0)) GOTOF _FEHL5
IF((_AX==1)AND(_DIR_X<0))OR((_AX==0)AND(_DIR_Z<0))
_MD=1
ENDIF
ELSE
IF(_SL==5)OR(_SL==7)
IF (_MESSEN_AUTO)
_MVAR=1
ELSE
_MVAR=100001
ENDIF
ELSE
IF(_SL==6)OR(_SL==8)
IF (_MESSEN_AUTO)
_MVAR=10001
ELSE
_MVAR=110001
ENDIF
ELSE
GOTOF _FEHL5
ENDIF
ENDIF
IF(_AX==0)
IF $SNS_MEA_INPUT_TOOL_PROBE_SUB[_NR] < 10
IF((_SL==6)OR(_SL==8)OR(_SL==7))
_MD=1
ENDIF
ELSE
IF(NOT((_SL==6)OR(_SL==8)OR(_SL==5)))
_MD=1
ENDIF
ENDIF
ELSE
IF((_SL==5)OR(_SL==7)OR(_SL==8))
_MD=1
ENDIF
ENDIF
ENDIF
_MEA_CORR_ANGLE[0]=SET(0,0,0)
IF ((ISFILE("/_N_CST_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CUS_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CUST_MEACYC_SPF")))
CUST_MEACYC(1)
ENDIF
N100 CYCLE982
IF ((ISFILE("/_N_CST_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CUS_DIR/_N_CUST_MEACYC_SPF"))OR(ISFILE("/_N_CMA_DIR/_N_CUST_MEACYC_SPF")))
CUST_MEACYC(2)
ENDIF
G[29]=_P29
_OVI[14]=0
RET
_FEHL2:STOPRE
N614102 SETAL(61313)
RET
_FEHL3: STOPRE
N614103 SETAL(61311)
RET
_FEHL4:STOPRE
N614104 SETAL(61212)
RET
_FEHL5: STOPRE
N614105 SETAL(61608)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE150_SPF
PROC CYCLE150(INT S_PICT,INT S_PROT,STRING[160] S_PATH) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.001 ;DATE: 2023-09-06
;Cycle support HMIsl
;Report measuring results - Control cycle
DEF INT _SPDEC1,_SPDEC2,_SPDEC3,_SPDEC4,_SPDEC5,_STRL,_PFADIDX,_PROGIDX,_TYPIDX,_SP3DEC1,_SP3DEC2
DEF INT _ERROR,_S_PROT2,_IDX,_IDX1,_IDX2,_MAX,_I,_LOGSIZE
DEF STRING[3] _EXTOPEN_OPT, _TYPE_1,_S_TYPE,_S_DOM
DEF STRING[20] _PATH_1, _PATH_2
DEF STRING[40] _SERR
DEF STRING[160] _PATH,_S_PATH,_STR1,_STR3,_STRX,_S_PNAME
_SPDEC1=S_PROT _DEC1
_SPDEC2=S_PROT _DEC2
_SPDEC3=S_PROT _DEC3
_SPDEC4=S_PROT _DEC4
_SPDEC5=S_PROT _DEC5
_SP3DEC1=S_PICT _DEC1
_SP3DEC2=S_PICT _DEC2
IF ((_SPDEC1<0) OR (_SPDEC1>2)) GOTOF _FEHL1
IF ((_SPDEC2<0) OR (_SPDEC2>1)) GOTOF _FEHL2
IF ((_SPDEC3<0) OR (_SPDEC3>2)) GOTOF _FEHL3
IF ((_SPDEC4<0) OR (_SPDEC4>1)) GOTOF _FEHL4
IF ((_SPDEC5<0) OR (_SPDEC5>1)) GOTOF _FEHL10
IF ((_SP3DEC1<0) OR (_SP3DEC1>1)) GOTOF _FEHL6
IF ((_SP3DEC2<1) OR (_SP3DEC2>4)) GOTOF _FEHL7
IF _SP3DEC1==0
S_PROTMEA_RESULT_DISPLAY=0
ELSE
S_PROTMEA_RESULT_DISPLAY=_SP3DEC2
ENDIF
IF (_SPDEC1==1)
S_PROTSTAT[0]=1
_PROTFORM[3]=1
ELSE
IF (_SPDEC1==0)
S_PROTSTAT[0]=0
_PROTFORM[3]=0
_PROTNAME[0]="" _PROTNAME[2]=""
ELSE
_PROTFORM[3]=2
S_PROTSTAT[0]=1
ENDIF
ENDIF
IF (($MN_SIM_ENVIRONMENT B_AND 'B100') == 4)
S_PROTSTAT[0]=0
ENDIF
IF (S_PROTSTAT[0]==0) GOTOF _END
IF STRLEN(S_PATH)>160 GOTOF _FEHL8
IF STRLEN(S_PATH)==0 GOTOF _FEHL8
_PROTNAME[0]=S_PATH
_PFADIDX=INDEX(_PROTNAME[0],"/")
_PROGIDX=RINDEX(_PROTNAME[0],"/")
IF (_PROGIDX==-1) AND (_PFADIDX==-1)
_S_PATH="" _SPDEC5=0
ELSE
_SPDEC5=1
ENDIF
IF (_PROGIDX>-1) AND (_PFADIDX>-1) AND (_PROGIDX==_PFADIDX)
GOTOF _FEHL11
ENDIF
IF ((_SPDEC5==0) AND (_S_PATH==""))
IF STRLEN($P_PATH[$P_STACK-1])<=160
_S_PATH=$P_PATH[$P_STACK-1]
_S_PNAME=_PROTNAME[0]
IF ((STRLEN(_S_PATH)+STRLEN(_S_PNAME))>160) GOTOF _FEHL11
_PROTNAME[0]=_S_PATH<<_S_PNAME
_PFADIDX=INDEX(_PROTNAME[0],"/")
_PROGIDX=RINDEX(_PROTNAME[0],"/")
ELSE
GOTOF _FEHL8
ENDIF
ELSE
IF (SUBSTR(_PROTNAME[0],0,5)=="//NC/")
_S_PATH="//NC:"<<SUBSTR(_PROTNAME[0],4)
_PROTNAME[0]=_S_PATH
ENDIF
_S_PATH=SUBSTR(_PROTNAME[0],0,_PROGIDX+1)
ENDIF
_STRL=STRLEN(_PROTNAME[0])
IF (SUBSTR(_PROTNAME[0],_STRL-4,1)=="_")
_TYPIDX=RINDEX(_PROTNAME[0],"_")
ELSE
IF (SUBSTR(_PROTNAME[0],_STRL-4,1)==".")
_TYPIDX=RINDEX(_PROTNAME[0],".")
ELSE
IF (_SPDEC5==1) GOTOF _FEHL14
_TYPIDX=_STRL
ENDIF
ENDIF
IF (STRLEN(SUBSTR(_PROTNAME[0],_TYPIDX+1))==3) OR (STRLEN(SUBSTR(_PROTNAME[0],_TYPIDX+1))==0)
_S_TYPE=SUBSTR(_PROTNAME[0],_TYPIDX+1)
IF (_S_TYPE=="WPD")OR(_S_TYPE=="DIR") GOTOF _FEHL14
ELSE
GOTOF _FEHL14
ENDIF
IF _S_TYPE==""
IF ((SUBSTR(_PROTNAME[0],0,5)<>"//NC/") AND (SUBSTR(_PROTNAME[0],0,3)<>"NC/") AND (SUBSTR(_PROTNAME[0],0,4)<>"/_N_") AND (SUBSTR(_PROTNAME[0],0,6)<>"//NC:/")) GOTOF _FEHL14
ENDIF
IF SUBSTR(_PROTNAME[0],_PROGIDX+1,3)=="_N_"
_S_DOM="_N_" _IDX=4
ELSE
_S_DOM="" _IDX=1
ENDIF
_S_PNAME=SUBSTR(_PROTNAME[0],_PROGIDX+_IDX,_TYPIDX-_IDX-_PROGIDX)
IF (STRLEN(_S_PNAME) > 24)
GOTOF _FEHL15
ENDIF
IF (_SPDEC5==0)
_IDX=MATCH (_S_PATH,"/TCU")
IF (_IDX<>-1)
_IDX=MATCH (_S_PATH,"/DEV1-0/")
IF (_IDX==-1)
_IDX=MATCH (_S_PATH,"/DEV0-0/")
IF (_IDX==-1)
_IDX=MATCH (_S_PATH,"/DEV0-1/")
ENDIF
ENDIF
IF (_IDX<>-1)
_S_PATH=SUBSTR(_S_PATH,_IDX+11,_STRL-_PROGIDX+1)
_S_PATH="/dev/ext/4/"<<_S_PATH
_PROTNAME[0]=_S_PATH<<_S_PNAME<<"."<<_S_TYPE
ELSE
GOTOF _FEHL11
ENDIF
ENDIF
_IDX=MATCH(_S_PATH,"/USER/SINUMERIK/MNT/")
IF _IDX<>-1
_S_PATH="//"<<SUBSTR(_S_PATH,_IDX+20,(STRLEN(_S_PATH)-20-1))<<":/"
ENDIF
ENDIF
IF (SUBSTR(_S_PATH,0,5)=="//NC:")
_S_PROT2=5
GOTOF _NEXT
ENDIF
IF (SUBSTR(_S_PATH,0,2)=="//")
_IDX=MATCH (_S_PATH,":")
IF (_IDX>-1)
IF (STRLEN(_S_PATH))==_IDX+1
_S_PROT2=5
GOTOF _NEXT
ELSE
IF SUBSTR(_S_PATH,_IDX+1,1)=="/"
_S_PROT2=5
GOTOF _NEXT
ELSE
GOTOF _FEHL11
ENDIF
ENDIF
ENDIF
ENDIF
IF (SUBSTR(_PROTNAME[0],0,9)=="/dev/ext/") OR (SUBSTR(_PROTNAME[0],0,9)=="/DEV/EXT/")
IF _STRL>10
IF (SUBSTR(_PROTNAME[0],10,1)<>"/") GOTOF _FEHL11
ENDIF
_TYPE_1=SUBSTR(_PROTNAME[0],9,1)
IF STRLEN(_TYPE_1)>0
IF (_TYPE_1=="1")OR(_TYPE_1=="2")OR(_TYPE_1=="3")OR(_TYPE_1=="4")OR(_TYPE_1=="5")OR(_TYPE_1=="6")OR(_TYPE_1=="7")OR(_TYPE_1=="8")OR(_TYPE_1=="9")
_S_PROT2=NUMBER(SUBSTR(_PROTNAME[0],9,1))
ELSE
GOTOF _FEHL5
ENDIF
ELSE
GOTOF _FEHL5
ENDIF
_PROGIDX=RINDEX(_PROTNAME[0],"/")
_TYPIDX=RINDEX(_PROTNAME[0],".")
IF ((_PROGIDX==-1) OR (_TYPIDX==-1)) GOTOF _FEHL5
_S_PNAME=SUBSTR(_PROTNAME[0],_PROGIDX+1,_TYPIDX-_PROGIDX-1)
_S_TYPE=SUBSTR(_PROTNAME[0],_TYPIDX+1)
IF (STRLEN(_S_TYPE)>3) OR (STRLEN(_S_PNAME)>24) GOTOF _FEHL5
_TYPE_1=""
IF ((_PROGIDX>10) AND (_S_PROT2>1))
_S_PATH=SUBSTR(_PROTNAME[0],10,_STRL-_PROGIDX+1)
ELSE
_S_PATH=""
ENDIF
GOTOF _NEXT
ENDIF
IF (SUBSTR(_PROTNAME[0],0,4)=="/_N_")
_S_PROT2=10
GOTOF _NEXT
ENDIF
IF ((SUBSTR(_S_PATH,0,15))=="//LOCAL_DRIVE:/")
_S_PATH=SUBSTR(_S_PATH,16)
_S_PROT2=0
ENDIF
IF ( (SUBSTR(_PROTNAME[0],0,5)=="//NC/")OR(SUBSTR(_PROTNAME[0],0,3)=="NC/")OR(SUBSTR(_PROTNAME[0],0,4)=="/NC/") )
_S_PROT2=10
IF (SUBSTR(_PROTNAME[0],0,5)=="//NC/")
_S_PATH=SUBSTR(_S_PATH,4)
ENDIF
IF (SUBSTR(_PROTNAME[0],0,3)=="NC/")
_S_PATH=SUBSTR(_S_PATH,2)
ENDIF
IF (SUBSTR(_PROTNAME[0],0,4)=="/NC/")
_S_PATH=SUBSTR(_S_PATH,3)
ENDIF
_STR1="" _STR3="" _STRX=_S_PATH
_STRL=STRLEN(_STRX)
WHILE _STRL>0
_IDX=MATCH(_STRX,"/")
IF (_IDX>=0)
_STR1=SUBSTR(_STRX,0,_IDX+1)
IF _IDX<(_STRL-1)
_STRX=SUBSTR(_STRX,_IDX+1)
IF _STRX<>_S_PNAME<<"."<<_S_TYPE
IF SUBSTR(_STRX,0,3)<>"_N_"
_STR1=_STR1<<"_N_"
ENDIF
ENDIF
ENDIF
IF _IDX==(_STRL-1)
_STRX=""
ENDIF
ENDIF
_STRL=STRLEN(_STRX)
_IDX1=MATCH(_STR1,".")
IF _IDX1>=0
_STR1=SUBSTR(_STR1,0,_IDX1)<<"_"<<SUBSTR(_STR1,_IDX1+1)
ENDIF
_STR3=_STR3<<_STR1
ENDWHILE
_S_PATH=_STR3
ENDIF
_NEXT:
IF _SPDEC3==1
_PROTFORM[0]=2
ELSE
_PROTFORM[0]=1
ENDIF
IF _SPDEC2==1
_PROTFORM[2]=3
IF _SPDEC3==1
ENDIF
ENDIF
IF _SPDEC2==0
IF _SPDEC3==1
_PROTFORM[2]=4
ELSE
_PROTFORM[2]=1
ENDIF
ENDIF
S_TXT[0]="1"
IF (SUBSTR($P_PROG[$P_STACK-1],3,9)<>"E_PRT_JOG")
S_TXT[2]="0"
ELSE
IF S_TXT[1]<>S_TXT[110]
S_TXT[2]="0"
ENDIF
ENDIF
IF _SPDEC4==0
_EXTOPEN_OPT="OVR"
ELSE
_EXTOPEN_OPT="APP"
ENDIF
IF ($MN_EES_MODE_INFO==0)
_IDX1=MATCH(_S_PATH,"//")
_IDX2=MATCH(_S_PATH,":/")
IF (_IDX1>-1) AND (_IDX2>-1)
IF ((SUBSTR(_S_PATH,0,_IDX2+2))<>"//NC:/")
IF ((SUBSTR(_S_PATH,0,_IDX2))=="//LOCAL_DRIVE:/")
_S_PATH="LOCAL_DRIVE"<<(SUBSTR(_S_PATH,_IDX2+2))
ELSE
_SERR="EES"
SETAL(61058,_SERR)
ENDIF
ENDIF
ELSE
IF ((SUBSTR(_S_PATH,0,4)<>"/_N_") AND (SUBSTR(_S_PATH,0,3)<>"_N_") AND (SUBSTR(_S_PATH,0,12)<>"LOCAL_DRIVE/"))
IF ((_S_PATH)=="")
_S_PROT2=10
ELSE
GOTOF _FEHL11
ENDIF
ENDIF
ENDIF
ENDIF
CASE _S_PROT2 OF 0 GOTOF _ZIEL0 1 GOTOF _ZIEL1 2 GOTOF _ZIEL2 4 GOTOF _ZIEL4 5 GOTOF _ZIEL5 10 GOTOF _ZIEL10 DEFAULT GOTOF _ZIEL2
_ZIEL0:
IF (STRLEN(_S_PATH)==0)
_S_PATH=""
ENDIF
_PROTNAME[0]=_S_PATH<<_S_PNAME<<"."<<_S_TYPE
S_TXT[6]="'H0A'"
EXTOPEN(_ERROR, _PROTNAME[0],"ASYN","SHARED",_EXTOPEN_OPT)
IF _ERROR<>0
GOTOF _FEHLX
ENDIF
GOTOF _NEXT1
_ZIEL1:
EXTOPEN(_ERROR, "/dev/ext/1","ASYN","SHARED",_EXTOPEN_OPT)
IF _ERROR<>0
GOTOF _FEHLX
ENDIF
_PROTNAME[0]="/dev/ext/1"
S_TXT[6]="'H0A'"
GOTOF _NEXT1
_ZIEL2:
_PROTNAME[0]="/dev/ext/"<<_S_PROT2<<_S_PATH<<"/"<<_S_PNAME<<"."<<_S_TYPE
EXTOPEN(_ERROR, _PROTNAME[0],"ASYN","SHARED",_EXTOPEN_OPT)
IF _ERROR<>0
GOTOF _FEHLX
ENDIF
S_TXT[6]="'H0A'"
GOTOF _NEXT1
_ZIEL4:
_PROTNAME[0]="/dev/ext/4/"<<_S_PATH<<_S_PNAME<<"."<<_S_TYPE
EXTOPEN(_ERROR, _PROTNAME[0],"ASYN","SHARED",_EXTOPEN_OPT)
IF _ERROR<>0
GOTOF _FEHLX
ENDIF
S_TXT[6]="'H0A'"
GOTOF _NEXT1
_ZIEL5:
IF (SUBSTR(_S_PATH,0,5)=="//NC:")
IF ( ((MATCH (_S_PATH,"WKS"))==(-1))AND((MATCH (_S_PATH,"MPF"))==(-1))AND((MATCH (_S_PATH,"SPF"))==(-1)) )
_ERROR=1
GOTOF _FEHLX
ENDIF
ENDIF
S_TXT[6]=""
IF (_SPDEC4==0)
DELETE(_ERROR,(_PROTNAME[0]))
ENDIF
GOTOF _NEXT1
_ZIEL10:
IF ( ((MATCH (_S_PATH,"WKS"))==(-1))AND((MATCH (_S_PATH,"MPF"))==(-1))AND((MATCH (_S_PATH,"SPF"))==(-1)) )
_ERROR=1
GOTOF _FEHLX
ENDIF
IF ((_S_TYPE<>"MPF")AND(_S_TYPE<>"SPF")AND(_S_TYPE<>"")) GOTOF _NEXT2
_STRL=STRLEN(_S_PATH)
_TYPE_1=""
IF (_STRL==12)
_PATH_1=SUBSTR(_S_PATH,0,12)
IF (_PATH_1=="/_N_MPF_DIR/")
_TYPE_1="MPF"
ENDIF
IF (_PATH_1=="/_N_SPF_DIR/")
_TYPE_1="SPF"
ENDIF
ELSE
IF (_STRL>20)
_PATH_1=SUBSTR(_S_PATH,0,15)
IF (_PATH_1=="/_N_WKS_DIR/_N_")
_PATH_2=SUBSTR(_S_PATH,_STRL-5,_STRL)
IF (_PATH_2=="_WPD/")
IF (_S_TYPE)
IF ((_S_TYPE=="MPF") OR (_S_TYPE=="SPF"))
_TYPE_1=_S_TYPE
ELSE
_TYPE_1="MPF"
ENDIF
ELSE
_TYPE_1="MPF"
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF _TYPE_1
_PATH=_S_PATH
ELSE
_PATH=$P_PATH[$P_STACK-1]
IF (SUBSTR(_PATH,0,12)=="/_N_MPF_DIR/")
_TYPE_1="MPF"
ENDIF
IF (SUBSTR(_PATH,0,12)=="/_N_SPF_DIR/")
_TYPE_1="SPF"
ENDIF
IF (SUBSTR(_PATH,0,12)=="/_N_WKS_DIR/")
IF ((_S_TYPE=="MPF") OR (_S_TYPE=="SPF"))
_TYPE_1=_S_TYPE
ELSE
_TYPE_1="MPF"
ENDIF
ENDIF
ENDIF
IF (_S_TYPE)
IF _TYPE_1<>_S_TYPE
_S_PNAME=_S_PNAME<<"_"<<_S_TYPE
ENDIF
ENDIF
_PROTNAME[0]=_PATH<<_S_PNAME<<"_"<<_TYPE_1
IF 0<>0
_NEXT2:
_S_PNAME=_S_PNAME<<"."<<_S_TYPE
_PROTNAME[0]=_S_PATH<<"_N_"<<_S_PNAME
ENDIF
S_TXT[6]=""
IF ((_SPDEC4==0) AND (ISFILE(_PROTNAME[0])))
DELETE(_ERROR,_PROTNAME[0])
IF _ERROR<>0
GOTOF _FEHLX
ENDIF
ENDIF
_NEXT1:
IF ((SUBSTR(_PROTNAME[0],0,4)=="/_N_") OR (SUBSTR(_PROTNAME[0],0,6)=="//NC:/") OR (_S_PATH==""))
IF ($MN_LEN_PROTOCOL_FILE < 20)
GOTOF _FEHL23
ENDIF
ENDIF
IF (_PROTFORM[0]<>2) OR (_PROTFORM[2]<>4)
WRITE(_ERROR,_PROTNAME[0],"")
IF _ERROR<>0
GOTOF _FEHLX
ENDIF
ENDIF
_END:
IF (_SPDEC1==2) AND ($P_PROG[$P_STACK-1]<>"_N_E_PRT_JOG_SPF")
IF _SPDEC2==0
cycle151
ELSE
cycle160
ENDIF
S_PROTSTAT[0]=0
ENDIF
RET
_FEHL1: STOPRE
N615001 SETAL(61019,"(S_PROT: dec1)")
RET
_FEHL2: STOPRE
N615002 SETAL(61019,"(S_PROT: dec2)")
RET
_FEHL3: STOPRE
N615003 SETAL(61019,"(S_PROT: dec3)")
RET
_FEHL4: STOPRE
N615004 SETAL(61019,"(S_PROT: dec4)")
RET
_FEHL5: STOPRE
N615005 SETAL(61019,"(S_PROT2: dec1)")
RET
_FEHL6: STOPRE
N615006 SETAL(61019,"(S_PICT: dec1)")
RET
_FEHL7: STOPRE
N615007 SETAL(61019,"(S_PICT: dec2)")
RET
_FEHL8: STOPRE
N615008 SETAL(61019,"(S_Path: STRLEN)")
RET
_FEHL10: STOPRE
N615010 SETAL(61019,"(S_PROT: dec5)")
RET
_FEHLX:
CASE _ERROR OF 1 GOTOF _FEHL11 2 GOTOF _FEHL12 3 GOTOF _FEHL13 4 GOTOF _FEHL14 11 GOTOF _FEHL21 12 GOTOF _FEHL22 DEFAULT GOTOF _FEHL20
RET
_FEHL11: STOPRE
N615011 SETAL(61352)
RET
_FEHL12: STOPRE
N615012 SETAL(61353)
RET
_FEHL13: STOPRE
N615013 SETAL(61354)
RET
_FEHL14: STOPRE
N615014 SETAL(61355)
RET
_FEHL15: STOPRE
N615015 SETAL(61029,"("<<_S_PNAME<<")")
RET
_FEHL20:
_SERR=":"<<_ERROR
IF _ERROR==10
FILESIZE(_ERROR,_PROTNAME[0],_LOGSIZE)
IF _LOGSIZE > ($MN_LEN_PROTOCOL_FILE-1)
_SERR=":10 FILESIZE>"<<$MN_LEN_PROTOCOL_FILE
ENDIF
ENDIF
STOPRE
N615020 SETAL(61358,_SERR)
RET
_FEHL21: STOPRE
N615021 SETAL(61356)
RET
_FEHL22: STOPRE
N615022 SETAL(61357)
RET
_FEHL23: STOPRE
N615023 SETAL(61418)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE151_SPF
PROC CYCLE151 SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.003 ;DATE: 2023-09-07
;Cycle support HMIsl
;Report measuring results - Splitting cycle
DEF INT _MODE, _I,_I1,_I2,_I3,_I4,_I5,_II,_J,_MESSAX_NO,_VAR,_MVAR1,_MVAR2,_MVAR3,_MVAR4,_MVAR5,_MVAR6,_MVAR7,_MVAR8,S_MVAR,S_MVAR1,S_MVAR2,S_TOOLTYPE
DEF REAL S_TCARR,S_SETVAL,_VMS_RD,_RES1
DEF STRING[2] S_MD
DEF STRING[4] _MM,S_SP
DEF STRING[10] _LEER10="          "
DEF STRING[14] _LEER14="              "
DEF STRING[17] _LEER17="                 "
DEF STRING[12] _GEOAX1,_GEOAX2,_GEOAX3,_MESSAX
DEF STRING[30] _STR1,_STR2,_BLKSP1,_TAB[10]=REP(""),_TXTCOR,_M_TXT57
DEF STRING[200] _STRX,_BLKSP
DEF STRING[40] _TYPE
DEF STRING[160] _NAME
IF ((S_PROTSTAT[0]==0) OR (_PROTFORM[2]==3))
RET
ENDIF
IF (NOT(((_OVI[2]==996)OR(_OVI[2]==9960)) AND (SUBSTR(_PROTVAL[29],0,1)=="V"))) OR (_PROTFORM[3]==2)
IF ($P_PROG[$P_STACK-1]<>"_N_E_PRT_JOG_SPF")
CYCLE154
IF _PROTFORM[0]==2
cust_meaprot(1)
ELSE
cust_meaprot(2)
ENDIF
ENDIF
_MODE=_PROTFORM[2]
IF (_OVI[2]<>9960)
CYCLE155
ENDIF
ENDIF
_MVAR1=_MVAR _DEC1
_MVAR2=_MVAR _DEC2
_MVAR3=_MVAR _DEC3
_MVAR4=_MVAR _DEC4
_MVAR5=_MVAR _DEC5
_MVAR6=_MVAR _DEC6
_MVAR7=_MVAR _DEC7
_MVAR8=_MVAR _DEC8
IF ($P_PROG[$P_STACK-1]=="_N_E_PRT_JOG_SPF")
_HEADLINE[8]=""
_HEADLINE[10]=_HEADLINE[10]
_HEADLINE[9]=_HEADLINE[9]
_HEADLINE[11]="Probe no.      : "<<_OVI[5]
ELSE
_HEADLINE[8]=" /CYCLE"<<_OVI[2]
_HEADLINE[9]=_HEADLINE[9]
IF (_OVI[2]==977) OR (_OVI[2]==978) OR (_OVI[2]==998) OR (_OVI[2]==979) OR (_OVI[2]==997)
IF (_MVAR5==1)
_HEADLINE[9]=_HEADLINE[9]<<" Spindle reversal"
ENDIF
IF (_MVAR5==2)
_HEADLINE[9]=_HEADLINE[9]<<" Align 3D probe"
ENDIF
ENDIF
_HEADLINE[10]="Measuring plane: G"<<(NUMBER(S_TXT[25])+16)
_HEADLINE[11]="Probe no.      : "<<_OVI[5]
ENDIF
CASE _OVI[2] OF 961 GOTOF _LABEL961 971 GOTOF _LABEL971 976 GOTOF _LABEL976 977 GOTOF _LABEL977 978 GOTOF _LABEL978 979 GOTOF _LABEL979 995 GOTOF _LABEL995 996 GOTOF _LABEL996 997 GOTOF _LABEL997 998 GOTOF _LABEL998 9960 GOTOF _LABEL9960
CASE _OVI[2] OF 973 GOTOF _LABEL973 974 GOTOF _LABEL974 982 GOTOF _LABEL982 994 GOTOF _LABEL994
RET
_LABEL961:
IF (_MVAR1<7)
S_MVAR=1
ELSE
S_MVAR=2
ENDIF
CASE S_MVAR OF 1 GOTOF _MA1 2 GOTOF _MA2
_MA1:
_HEADLINE[8]="Results measure: Rectangular corner"<<_HEADLINE[8]
GOTOF _MA_END
_MA2:
_HEADLINE[8]="Results measure: Any corner"<<_HEADLINE[8]
_MA_END:
_TAB[0]=_HEADLINE[19]
_TAB[1]=_LEER14
_TAB[2]="Measured WCS"
_TAB[3]="Measured MCS"
REPEAT _LAB1 _ENDLAB1
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[11],,_OVR[5],_OVR[21],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],,_OVR[6],_OVR[22],"<<S_TXT[3]
_PROTVAL[7]="Angle to<<S_TXT[11],,_OVR[4],_OVR[20],deg"
cycle152
cycle157(_PROTFORM[2])
RET
_LAB1:
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I=1
WHILE _I<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I])>0
_TAB[_I]=SUBSTR(_TAB[_I],0,_PROTFORM[5])
ENDIF
_TAB[_I]=SPRINT(S_TXT[10],_TAB[_I])
S_TXT[50+_I]=_TAB[_I]
_I=_I+1
ENDWHILE
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I=1
WHILE _I<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I]<<S_TXT[4]
_I=_I+1
ENDWHILE
_ENDLAB1:
_LABEL961_END:
_LABEL971:
IF (_MVAR1==0) AND (_MVAR6==0)
_MESSAX_NO=_MA _DEC1
IF ((_MESSAX_NO==1) OR (_MESSAX_NO==2) OR (_MESSAX_NO==3))
_I=(_MESSAX_NO-1)
_J=0 _I=(_I*4)+_J
IF _OVR[9+_I]<>0
S_MD="- "
ELSE
_J=2 _I=_I+_J
IF _OVR[9+_I]<>0
S_MD="+ "
ENDIF
ENDIF
ENDIF
ENDIF
CASE _MVAR1 OF 1 GOTOF _MB2 2 GOTOF _MB2
_HEADLINE[8]="Calibration    : Tool probe"<<_HEADLINE[8]
IF _MVAR7==1
_HEADLINE[9]=_HEADLINE[9]<<"Spindle reversal"
ELSE
_HEADLINE[9]=_HEADLINE[9]<<"No spindle reversal"
ENDIF
GOTOF _MB_END
_MB2:
_HEADLINE[8]="Results measure: Tool offset"<<_HEADLINE[8]
IF _MVAR3==0
IF _MVAR1==2
_HEADLINE[9]=_HEADLINE[9]<<"Spindle rotation"
ELSE
_HEADLINE[9]=_HEADLINE[9]<<"Spindle stop"
ENDIF
ENDIF
IF _MVAR3==1
_HEADLINE[9]=_HEADLINE[9]<<"Checking teeth"
ENDIF
_MB_END:
_HEADLINE[11]="Probe no.:       "<<_OVI[5]
WHILE _I1<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I1=_I1+1
ENDWHILE
IF (_PROTNAME[1]=="_N_E_PRT_JOG_SPF") GOTOF _NEXT
_TAB[0]=_HEADLINE[19]
_TAB[1]="Setpoint"
IF (_MVAR1==0)
_TAB[2]="Calibrated"
ELSE
_TAB[2]="Measured"
ENDIF
_TAB[3]="Difference"
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I1=1
WHILE _I1<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I1])>0
_TAB[_I1]=SUBSTR(_TAB[_I1],0,_PROTFORM[5])
ENDIF
_TAB[_I1]=SPRINT(S_TXT[10],_TAB[_I1])
S_TXT[50+_I1]=_TAB[_I1]
_I1=_I1+1
ENDWHILE
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I1=1
WHILE _I1<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I1]<<S_TXT[4]
_I1=_I1+1
ENDWHILE
_I1=0
_NEXT:
_TAB[0]=",_OVR[11]," _TAB[1]=",_OVR[9]," _TAB[2]=",_OVR[15]," _TAB[3]=",_OVR[13]," _TAB[4]=",_OVR[19]," _TAB[5]=",_OVR[17],"
IF ((_MVAR1==0) AND (_MVAR5==1))
IF (_MA==3) GOTOF _MC1
_TAB[0]=",," _TAB[1]=",," _TAB[2]=",," _TAB[3]=",," _TAB[4]=",," _TAB[5]=",,"
GOTOF _MC2
ENDIF
IF ((_MVAR1==0) AND (_MVAR6==0)) GOTOF _MC1
IF ((_MVAR1==0) AND (_MVAR6==1)) GOTOF _MC2
IF ((_MVAR1>0) AND (_MVAR3==0)) GOTOF _MC3
IF ((_MVAR1<>0) AND (_MVAR3==1)) GOTOF _MC4
_MC1:
_PROTFORM[4]=1
IF (S_MD=="+ ")
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[5]="Trigger + <<S_TXT[14],,_OVR[10],_OVR[11],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[5]="Trigger + <<S_TXT[14],,_OVR[14],_OVR[15],"<<S_TXT[3]
ENDIF
IF (S_TXT[14]==S_TXT[13])
_PROTVAL[5]="Trigger + <<S_TXT[14],,_OVR[18],_OVR[19],"<<S_TXT[3]
ENDIF
ENDIF
ELSE
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[5]="Trigger - <<S_TXT[14],,_OVR[8],_OVR[9],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[5]="Trigger - <<S_TXT[14],,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
IF (S_TXT[14]==S_TXT[13])
_PROTVAL[5]="Trigger - <<S_TXT[14],,_OVR[16],_OVR[17],"<<S_TXT[3]
ENDIF
ENDIF
ENDIF
cycle152
GOTOF _MC_END
_MC2:
_PROTFORM[4]=6
IF (_OVR[10]<>0)
_PROTVAL[5]="Trigger + <<S_TXT[11],,_OVR[10]"<<_TAB[0]<<S_TXT[3]
ENDIF
IF (_OVR[8]<>0)
_PROTVAL[6]="Trigger - <<S_TXT[11],,_OVR[8]"<<_TAB[1]<<S_TXT[3]
ENDIF
IF (_OVR[14]<>0)
_PROTVAL[7]="Trigger + <<S_TXT[12],,_OVR[14]"<<_TAB[2]<<S_TXT[3]
ENDIF
IF (_OVR[12]<>0)
_PROTVAL[8]="Trigger - <<S_TXT[12],,_OVR[12]"<<_TAB[3]<<S_TXT[3]
ENDIF
IF ((_OVR[18]<>0) AND (_MVAR5==0))
_PROTVAL[9]="Trigger + <<S_TXT[13],,_OVR[18]"<<_TAB[4]<<S_TXT[3]
ENDIF
IF (_OVR[16]<>0)
_PROTVAL[10]="Trigger - <<S_TXT[13],,_OVR[16]"<<_TAB[5]<<S_TXT[3]
ENDIF
cycle152
GOTOF _MC_END
_MC3:
_PROTFORM[4]=2
IF ( (_PROTVAL[28]=="$P_ADT[6]")OR(_PROTVAL[28]=="$P_ADT[15]") )
_PROTVAL[6]="Geo radius,,_OVR[10],_OVR[11],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
cycle152
GOTOF _MC_END
_MC4:
_PROTFORM[4]=2
IF ( (_PROTVAL[28]=="$P_ADT[6]")OR(_PROTVAL[28]=="$P_ADT[15]") )
_PROTVAL[5]="Max-radius,,_OVR[10],_OVR[11],"<<S_TXT[3]
_PROTVAL[6]="Min-radius,,_OVR[14],_OVR[15],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Max-length,,_OVR[8],_OVR[9],"<<S_TXT[3]
_PROTVAL[6]="Min-length,,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
cycle152
_PROTFORM[4]=$P_ADT[35]
_PROTVAL[9]=_BLKSP1
IF ( (_PROTVAL[28]=="$P_ADT[6]")OR(_PROTVAL[28]=="$P_ADT[15]") )
_PROTVAL[7]="SPRINT('"'%.'"'<<S_TXT[9]<<'"'S'"'<<S_TXT[4]<<S_TXT[10]<<S_TXT[4]<<S_TXT[7]<<S_TXT[4]<<S_TXT[7]<<S_TXT[4],'"'radius N'"'<<_I+1<<_PROTVAL[9],'"' '"',_OVR[100+_I],_OVR[200+(_I)])"
ELSE
_PROTVAL[7]="SPRINT('"'%.'"'<<S_TXT[9]<<'"'S'"'<<S_TXT[4]<<S_TXT[10]<<S_TXT[4]<<S_TXT[7]<<S_TXT[4]<<S_TXT[7]<<S_TXT[4],'"'length N'"'<<_I+1<<_PROTVAL[9],'"' '"',_OVR[300+_I],_OVR[400+(_I)])"
ENDIF
_MC_END:
cycle157(_PROTFORM[2])
RET
_LABEL971_END:
_LABEL976:
IF ((_MVAR7==1) AND (_MVAR1==0)) OR (_MVAR==10000) OR (_MVAR==1000)
S_MVAR=10
ELSE
IF ((_MVAR1==1) OR (_MVAR1==8))
IF (_MVAR4==0)
S_MVAR=20
ENDIF
IF ((_MVAR6==1) AND (_MVAR4<>0))
IF (_MVAR4==1)
S_MVAR=21
ELSE
S_MVAR=22
ENDIF
ENDIF
IF ((_MVAR6==0) AND (_MVAR4==2))
S_MVAR=32
ENDIF
IF ((_MVAR6==0) AND (_MVAR4==1))
S_MVAR=31
ENDIF
ENDIF
IF (_MVAR==0) OR ((_MVAR1==0) AND (_MVAR<>10000))
S_MVAR=31
ENDIF
IF ( (_MVAR1==3)AND(_MVAR4==0) )
IF (_MVAR7==0)
S_MVAR=40
ENDIF
IF ( (_MVAR7==1)OR(_MVAR7==2) )
S_MVAR=41
ENDIF
ENDIF
ENDIF
IF (_MVAR1==5)
S_MVAR=50
ENDIF
IF (S_MVAR==0) GOTOF _MCC_END
_MESSAX=S_TXT[14]
_MESSAX_NO=_MA _DEC1
IF ((_MVAR4==1) OR (_MVAR7==1) OR (_MVAR5==1))
IF _MD==0
S_MD="+ " _J=2
ENDIF
IF _MD==1
S_MD="- " _J=0
ENDIF
ENDIF
_HEADLINE[11]="Probe/Block no.: "<<_OVI[5]<<" / "<<_CALNUM
IF (_PROTNAME[1]=="_N_E_PRT_JOG_SPF")
_HEADLINE[8]="Calibration    : workpiece probe"
GOTOF _MD_END
ENDIF
CASE (S_MVAR _DEC2) OF 1 GOTOF _MD1 2 GOTOF _MD2 3 GOTOF _MD3 4 GOTOF _MD4 5 GOTOF _MD5
_MD1:
_HEADLINE[8]="Calibration    : workpiece probe, length on edge"<<_HEADLINE[8]
GOTOF _MD_END
_MD2:
_HEADLINE[8]="Calibration    : workpiece probe, radius in ring"<<_HEADLINE[8]
GOTOF _MD_END
_MD3:
_HEADLINE[8]="Calibration    : workpiece probe, radius on edge"<<_HEADLINE[8]
GOTOF _MD_END
_MD4:
_HEADLINE[8]="Calibration    : workpiece probe on sphere"<<_HEADLINE[8]
GOTOF _MD_END
_MD5:
_HEADLINE[8]="Calibration    : workpiece probe, radius between 2 edges"<<_HEADLINE[8]
_MD_END:
WHILE _I<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I=_I+1
ENDWHILE
IF (_PROTNAME[1]=="_N_E_PRT_JOG_SPF") GOTOF _NEXT2
_TAB[0]=_HEADLINE[19]
_TAB[1]="Setpoint"
_TAB[2]="Calibrated"
_TAB[3]="Difference"
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I=1
WHILE _I<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I])>0
_TAB[_I]=SUBSTR(_TAB[_I],0,_PROTFORM[5])
ENDIF
_TAB[_I]=SPRINT(S_TXT[10],_TAB[_I])
S_TXT[50+_I]=_TAB[_I]
_I=_I+1
ENDWHILE
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I=1
WHILE _I<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I]<<S_TXT[4]
_I=_I+1
ENDWHILE
_I=0
_NEXT2:
CASE S_MVAR OF 10 GOTOF _MC10 20 GOTOF _MC20 21 GOTOF _MC21 22 GOTOF _MC20 31 GOTOF _MC31 32 GOTOF _MC32 40 GOTOF _MC41 41 GOTOF _MC41 50 GOTOF _MC50
_MC10:
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[14],_SETVAL,,,"<<S_TXT[3]
IF (_MD==0)
_PROTVAL[6]="Trigger + <<S_TXT[14],,_OVR[18],_OVR[19],"<<S_TXT[3]
ELSE
_PROTVAL[6]="Trigger - <<S_TXT[14],,_OVR[16],_OVR[17],"<<S_TXT[3]
ENDIF
_PROTVAL[7]="Probe Length,,_OVR[22],_OVR[23],"<<S_TXT[3]
cycle152
GOTOF _MCC_END
_MC20:
_PROTFORM[4]=11
_MC20A:
_PROTVAL[5]="Diameter,_SETVAL,,,"<<S_TXT[3]
_MC20A1:
IF ((_MVAR1==1) AND (_MVAR6==1))
_PROTVAL[6]="Angle,_OVR[24],,,deg"
ENDIF
IF ((S_MVAR==20) OR (_MESSAX_NO==1))
_PROTVAL[7]="Trigger + <<S_TXT[11],,_OVR[10],_OVR[11],"<<S_TXT[3]
_PROTVAL[8]="Trigger - <<S_TXT[11],,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
IF ((S_MVAR==20) OR (_MESSAX_NO==2))
_PROTVAL[9]="Trigger + <<S_TXT[12],,_OVR[14],_OVR[15],"<<S_TXT[3]
_PROTVAL[10]="Trigger - <<S_TXT[12],,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
_PROTVAL[11]="Probe ball diameter,_OVR[4],_OVR[5],"<<S_TXT[3]
IF (_MVAR4<>1)
IF _MVAR5==1
IF ((S_MVAR==20) OR (_MESSAX_NO==1))
_PROTVAL[12]="Position deviation <<S_TXT[11],_OVR[20],,"<<S_TXT[3]
ENDIF
IF ((S_MVAR==20) OR (_MESSAX_NO==2))
_PROTVAL[13]="Position deviation <<S_TXT[12],_OVR[21],,"<<S_TXT[3]
ENDIF
ENDIF
ENDIF
IF (_MVAR1==8)
_PROTVAL[14]="Center <<S_TXT[11],_OVR[6],,"<<S_TXT[3]
_PROTVAL[15]="Center <<S_TXT[12],_OVR[7],,"<<S_TXT[3]
ENDIF
cycle152
_MC20E:
GOTOF _MCC_END
_MC21:
_PROTFORM[4]=4
_MC21A:
_I=(_MESSAX_NO-1)
_PROTVAL[5]="Diameter,_SETVAL,,,"<<S_TXT[3]
_MC21A1:
IF ((_MVAR1==1) AND(_MVAR6==1))
_PROTVAL[6]="Angle,_OVR[24],,,deg"
ENDIF
IF _MD==1
IF (_MESSAX_NO==1)
_PROTVAL[7]="Trigger - <<S_TXT[14],,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
IF (_MESSAX_NO==2)
_PROTVAL[7]="Trigger - <<S_TXT[14],,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
IF (_MESSAX_NO==3)
_PROTVAL[7]="Trigger - <<S_TXT[14],,_OVR[16],_OVR[17],"<<S_TXT[3]
ENDIF
ELSE
IF (_MESSAX_NO==1)
_PROTVAL[7]="Trigger + <<S_TXT[14],,_OVR[10],_OVR[11],"<<S_TXT[3]
ENDIF
IF (_MESSAX_NO==2)
_PROTVAL[7]="Trigger + <<S_TXT[14],,_OVR[14],_OVR[15],"<<S_TXT[3]
ENDIF
IF (_MESSAX_NO==3)
_PROTVAL[7]="Trigger + <<S_TXT[14],,_OVR[18],_OVR[19],"<<S_TXT[3]
ENDIF
ENDIF
_PROTVAL[8]="Probe ball diameter,_OVR[4],_OVR[5],"<<S_TXT[3]
cycle152
_MC21E:
GOTOF _MCC_END
_MC31:
_PROTFORM[4]=5
_PROTVAL[5]="<<S_TXT[14],_SETVAL,,,"<<S_TXT[3]
_I=(_MESSAX_NO-1)
REPEAT _MC21A1 _MC21E
GOTOF _MCC_END
_MC32:
_PROTFORM[4]=9
_PROTVAL[5]="Distance,_SETVAL,,,"<<S_TXT[3]
REPEAT _MC20A1 _MC20E
GOTOF _MCC_END
_MC50:
_PROTFORM[4]=9
_PROTVAL[5]="Distance,_SETVAL,,,"<<S_TXT[3]
REPEAT _MC20A1 _MC20E
GOTOF _MCC_END
_MC41:
_PROTFORM[4]=16
_PROTVAL[5]="Diameter,_SETVAL,,,"<<S_TXT[3]
IF S_MVAR==41
_PROTVAL[6]="Top edge,_OVR[2]+(_OVR[0]/2),,,"<<S_TXT[3]
ENDIF
_PROTVAL[7]="Angle,_OVR[24],,,deg"
_PROTVAL[8]="Trigger + <<S_TXT[11],,_OVR[10],_OVR[11],"<<S_TXT[3]
_PROTVAL[9]="Trigger - <<S_TXT[11],,_OVR[8],_OVR[9],"<<S_TXT[3]
_PROTVAL[10]="Trigger + <<S_TXT[12],,_OVR[14],_OVR[15],"<<S_TXT[3]
_PROTVAL[11]="Trigger - <<S_TXT[12],,_OVR[12],_OVR[13],"<<S_TXT[3]
IF NOT (_OVR[18]==0)
_PROTVAL[12]="Trigger + <<S_TXT[13],,_OVR[18],_OVR[19],"<<S_TXT[3]
ENDIF
IF NOT (_OVR[16]==0)
_PROTVAL[13]="Trigger - <<S_TXT[13],,_OVR[16],_OVR[17],"<<S_TXT[3]
ENDIF
_PROTVAL[14]="Probe ball diameter,_OVR[4],_OVR[5],"<<S_TXT[3]
IF (_MVAR7==1)
_PROTVAL[15]="Probe length,,_OVR[22],_OVR[23],"<<S_TXT[3]
ENDIF
IF _MVAR5==1
_PROTVAL[16]="Position deviation <<S_TXT[11],_OVR[20],,"<<S_TXT[3]
_PROTVAL[17]="Position deviation <<S_TXT[12],_OVR[21],,"<<S_TXT[3]
ENDIF
_PROTVAL[18]="Center <<S_TXT[11],,_OVR[6],,"<<S_TXT[3]
_PROTVAL[19]="Center <<S_TXT[12],,_OVR[7],,"<<S_TXT[3]
_PROTVAL[20]="Center <<S_TXT[13],,_OVR[2],,"<<S_TXT[3]
cycle152
_MC41E:
_MCC_END:
cycle157(_PROTFORM[2])
RET
_LABEL976_END:
_LABEL977:
_GEOAX1=S_TXT[11] _GEOAX2=S_TXT[12] _GEOAX3=S_TXT[13] _MESSAX=S_TXT[14]
CASE _MVAR1 OF 1 GOTOF _ME1 2 GOTOF _ME2 3 GOTOF _ME3 4 GOTOF _ME4 5 GOTOF _ME5 6 GOTOF _ME6
_ME1:
_HEADLINE[8]="Results measure: 1 Hole"<<_HEADLINE[8]
GOTOF _ME_END
_ME2:
_HEADLINE[8]="Results measure: 1 circular spigot"<<_HEADLINE[8]
GOTOF _ME_END
_ME3:
_HEADLINE[8]="Results measure: Slot"<<_HEADLINE[8]
GOTOF _ME_END
_ME4:
_HEADLINE[8]="Results measure: Web"<<_HEADLINE[8]
GOTOF _ME_END
_ME5:
_HEADLINE[8]="Results measure: Rectangel pocket"<<_HEADLINE[8]
GOTOF _ME_END
_ME6:
_HEADLINE[8]="Results measure: Rectangel spigot"<<_HEADLINE[8]
_ME_END:
CASE _MVAR1 OF 1 GOTOF _MF1 2 GOTOF _MF2 3 GOTOF _MF3 4 GOTOF _MF4 5 GOTOF _MF5 6 GOTOF _MF5
_MF1:
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[11],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[27]
GOTOF _MF_END
_MF2:
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[11],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[27]
GOTOF _MF_END
_MF3:
_PROTFORM[4]=2
IF _MESSAX==_GEOAX1
_PROTVAL[5]="Center<<S_TXT[11],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
ELSE
IF _MESSAX==_GEOAX2
_PROTVAL[5]="Center<<S_TXT[12],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Center<<S_TXT[13],_OVR[3],_OVR[7],_OVR[19],"<<S_TXT[3]
ENDIF
ENDIF
_PROTVAL[6]="Wide,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[6]= _PROTVAL[6]<<S_TXT[27]
GOTOF _MF_END
_MF4:
_PROTFORM[4]=2
IF _MESSAX==_GEOAX1
_PROTVAL[5]="Center<<S_TXT[11],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
ELSE
IF _MESSAX==_GEOAX2
_PROTVAL[5]="Center<<S_TXT[12],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Center<<S_TXT[13],_OVR[3],_OVR[7],_OVR[19],"<<S_TXT[3]
ENDIF
ENDIF
_PROTVAL[6]="Width,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[6]= _PROTVAL[6]<<S_TXT[27]
GOTOF _MF_END
_MF5:
_PROTFORM[4]=4
_PROTVAL[5]="<<S_TXT[11],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],_OVR[3],_OVR[7],_OVR[19],"<<S_TXT[3]
IF _OVR[0]>=_OVR[1]
_PROTVAL[7]="Length<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
_PROTVAL[8]="Width<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
ELSE
_PROTVAL[7]="Length<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[8]="Width<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ENDIF
cycle152
IF _OVR[0]>=_OVR[1]
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[27]
_PROTVAL[8]= _PROTVAL[8]<<S_TXT[28]
ELSE
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[28]
_PROTVAL[8]= _PROTVAL[8]<<S_TXT[27]
ENDIF
_MF_END:
cycle157(_PROTFORM[2])
RET
_LABEL977_END:
_LABEL978:
_HEADLINE[8]="Results measure: Set edge"<<_HEADLINE[8]
_PROTFORM[4]=1
_PROTVAL[5]="<<S_TXT[14],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[5]= _PROTVAL[5]<<S_TXT[27]
cycle157(_PROTFORM[2])
RET
_LABEL978_END:
_LABEL979:
CASE _MVAR1 OF 1 GOTOF _MG1 2 GOTOF _MG2
_MG1:
_HEADLINE[8]="Results measure: Inside circle segment"<<_HEADLINE[8]
GOTOF _MG_END
_MG2:
_HEADLINE[8]="Results measure: Outside circle segment"<<_HEADLINE[8]
_MG_END:
CASE _MVAR1 OF 1 GOTOF _MH1 2 GOTOF _MH2
_MH1:
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[11],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[27]
GOTOF _MH_END
_MH2:
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[11],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
cycle152
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[27]
_MH_END:
cycle157(_PROTFORM[2])
RET
_LABEL979_END:
_LABEL995:
S_TXT[66] ="/"
S_TXT[7]="%"<<_PROTFORM[5]<<".6F"
_HEADLINE[8]="Results measure: Angular displacement spindle"<<_HEADLINE[8]
_I=1
WHILE _I<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I=_I+1
ENDWHILE
_TAB[0]=_HEADLINE[19]
_TAB[1]="Setpoint"
_TAB[2]="Measured"
_TAB[3]="Tol. exceeded"
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I=1
WHILE _I<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I])>0
_TAB[_I]=SUBSTR(_TAB[_I],0,_PROTFORM[5])
ENDIF
_TAB[_I]=SPRINT(S_TXT[10],_TAB[_I])
S_TXT[50+_I]=_TAB[_I]
_I=_I+1
ENDWHILE
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I=1
WHILE _I<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I]<<S_TXT[4]
_I=_I+1
ENDWHILE
_I=0
IF _MVAR7==0
_PROTVAL[5]="Diameter,_OVR[10],,,"<<S_TXT[3]
ELSE
_PROTVAL[5]="Diameter,_OVR[10],_OVR[14],,"<<S_TXT[3]
ENDIF
_PROTVAL[6]="Distance<<S_TXT[13],_OVR[4],,,"<<S_TXT[3]
IF _MVAR8==0
_PROTFORM[4]=6
_PROTVAL[7]="Angle<<S_TXT[11]<<S_TXT[66]<<S_TXT[13],_OVR[0],_OVR[2],,deg"
_PROTVAL[8]="Angle<<S_TXT[12]<<S_TXT[66]<<S_TXT[13],_OVR[1],_OVR[3],,deg"
ENDIF
IF _MVAR8>0
_PROTFORM[4]=8
_PROTVAL[7]="Angle<<S_TXT[11]<<S_TXT[66]<<S_TXT[13],_OVR[0],_OVR[2],_OVR[5],deg"
_PROTVAL[8]="Angle<<S_TXT[12]<<S_TXT[66]<<S_TXT[13],_OVR[1],_OVR[3],_OVR[6],deg"
_TLL=_OVR[9]*(-1)
_TUL=_OVR[9]
IF _OVR[5]>0
S_TXT[27]=S_TXT[30]
ELSE
S_TXT[27]=S_TXT[29]
ENDIF
IF _OVR[6]>0
S_TXT[28]=S_TXT[30]
ELSE
S_TXT[28]=S_TXT[29]
ENDIF
_PROTVAL[11]="Tolerance,_TUL,,,deg"
_PROTVAL[12]=" ,_TLL,,,deg"
ENDIF
_PROTVAL[9]="Gradient<<S_TXT[11],_OVR[0],_OVR[7],,"<<S_TXT[3]
_PROTVAL[10]="Gradient<<S_TXT[12],_OVR[1],_OVR[8],,"<<S_TXT[3]
cycle152
_PROTVAL[7]= _PROTVAL[7]<<S_TXT[27]
_PROTVAL[8]= _PROTVAL[8]<<S_TXT[28]
cycle157(_PROTFORM[2])
RET
_LABEL995_END:
_LABEL996:
S_TXT[11]=$MC_AXCONF_GEOAX_NAME_TAB[0]
S_TXT[12]=$MC_AXCONF_GEOAX_NAME_TAB[1]
S_TXT[13]=$MC_AXCONF_GEOAX_NAME_TAB[2]
_I=1 _J=_OVI[8]
S_TXT[7]="%"<<_PROTFORM[5]<<".6F"
_NAME=$TC_CARR34[_OVI[8]]
IF $TC_CARR23[_OVI[8]]=="P"
_TYPE="Swivel table"
_VAR=1
ELSE
IF $TC_CARR23[_OVI[8]]=="T"
_TYPE="Inclined head"
_VAR=2
ELSE
_TYPE="Inclined head + swivel table"
_VAR=3
ENDIF
ENDIF
IF (SUBSTR(_PROTVAL[29],0,1))=="V"
_TXTCOR="Old values"
ENDIF
IF (_PROTFORM[3]==2)
_TXTCOR=""
ENDIF
WHILE _I<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I=_I+1
ENDWHILE
_I=0
_I1=NUMBER(S_TXT[9])
_I1=_I1+STRLEN(S_TXT[4])-17
IF (_I1>0)
WHILE _I<_I1
_BLKSP=_BLKSP<<" "
_I=_I+1
ENDWHILE
ENDIF
_I=0 _I1=0
IF NOT(SUBSTR(_PROTVAL[29],0,1)=="V")
_HEADLINE[14]="Measure only   :"
ELSE
_HEADLINE[14]="Correction into: "<<_BLKSP<<_NAME
ENDIF
_STR1="Time: "<<S_TXT[41]
_STR2=S_TXT[42]<<_LEER10<<": "
_I1=_PROTFORM[1]-(STRLEN(_HEADLINE[7]))-(STRLEN(_STR1))-(STRLEN(_STR2))-2
_I=1
WHILE _I<=_I1
_BLKSP=_BLKSP<<" "
_I=_I+1
ENDWHILE
_I=0 _I1=0
_HEADLINE[8]="Results measure: Kinematic"<<_HEADLINE[8]
_HEADLINE[10]=_LEER17<<"Measured rotary axes of the swivel data record"
_HEADLINE[11]="Rot.-axes 1 / 2: "<<$TC_CARR35[_OVI[8]]<<" / "<<$TC_CARR36[_OVI[8]]
_HEADLINE[12]="Kinematic type : "<<_TYPE
_HEADLINE[13]="Name / number  : "<<_NAME<<" / "<<_OVI[8]
IF _OVI[9]>0
_HEADLINE[13]="Name / number  : "<<_NAME<<" / "<<_OVI[8]<<"    Alarm "<<_OVI[9]
_HEADLINE[14]="Measure only   :"
ENDIF
_TAB[0]=_HEADLINE[19]
_TAB[1]=S_TXT[11]
_TAB[2]=S_TXT[12]
_TAB[3]=S_TXT[13]
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I=1
WHILE _I<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I])>0
_TAB[_I]=SUBSTR(_TAB[_I],0,_PROTFORM[5])
ENDIF
_TAB[_I]=SPRINT(S_TXT[10],_TAB[_I])
S_TXT[50+_I]=_TAB[_I]
_I=_I+1
ENDWHILE
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I=1
WHILE _I<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I]<<S_TXT[4]
_I=_I+1
ENDWHILE
_I=1
IF _TXTCOR=="Old values"
_PROTVAL[0]=_TXTCOR
WHILE _I<=(NUMBER(S_TXT[9])-STRLEN(_TXTCOR))
_PROTVAL[0]=_PROTVAL[0]<<" "
_I=_I+1
ENDWHILE
_I=1
_PROTVAL[0]=_PROTVAL[0]<<S_TXT[4]
WHILE _I<=NUMBER(S_TXT[8])
_PROTVAL[0]=_PROTVAL[0]<<_TAB[_I]<<S_TXT[4]
_I=_I+1
ENDWHILE
ENDIF
CASE _VAR OF 1 GOTOF _MI1 2 GOTOF _MI2 3 GOTOF _MI3
_MI1:
S_TXT[11]="I2" S_TXT[12]="V1" S_TXT[13]="I3" S_TXT[14]="V2" S_TXT[15]="I4"
_PROTFORM[4]=5
IF _TXTCOR=="Old values"
_PROTFORM[4]=_PROTFORM[4]*2
_PROTVAL[10]="Offset vector<<S_TXT[11],$TC_CARR4[_OVI[8]],$TC_CARR5[_OVI[8]],$TC_CARR6[_OVI[8]],"<<S_TXT[3]
_PROTVAL[11]="Rotary axis vector<<S_TXT[12],$TC_CARR7[_OVI[8]],$TC_CARR8[_OVI[8]],$TC_CARR9[_OVI[8]],"
_PROTVAL[12]="Offset vector<<S_TXT[13],$TC_CARR15[_OVI[8]],$TC_CARR16[_OVI[8]],$TC_CARR17[_OVI[8]],"<<S_TXT[3]
_PROTVAL[13]="Rotary axis vector<<S_TXT[14],$TC_CARR10[_OVI[8]],$TC_CARR11[_OVI[8]],$TC_CARR12[_OVI[8]],"
_PROTVAL[14]="Offset vector<<S_TXT[15],$TC_CARR18[_OVI[8]],$TC_CARR19[_OVI[8]],$TC_CARR20[_OVI[8]],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Offset vector<<S_TXT[11],_OVR[4],_OVR[5],_OVR[6],"<<S_TXT[3]
_PROTVAL[6]="Rotary axis vector<<S_TXT[12],_OVR[7],_OVR[8],_OVR[9],"
_PROTVAL[7]="Offset vector<<S_TXT[13],_OVR[15],_OVR[16],_OVR[17],"<<S_TXT[3]
_PROTVAL[8]="Rotary axis vector<<S_TXT[14],_OVR[10],_OVR[11],_OVR[12],"
_PROTVAL[9]="Offset vector<<S_TXT[15],_OVR[18],_OVR[19],_OVR[20],"<<S_TXT[3]
ENDIF
GOTOF _MI_END
_MI2:
S_TXT[11]="I1" S_TXT[12]="V1" S_TXT[13]="I2" S_TXT[14]="V2" S_TXT[15]="I3"
_PROTFORM[4]=5
IF _TXTCOR=="Old values"
_PROTFORM[4]=_PROTFORM[4]*2
_PROTVAL[10]="Offset vector<<S_TXT[11],$TC_CARR1[_OVI[8]],$TC_CARR2[_OVI[8]],$TC_CARR3[_OVI[8]],"<<S_TXT[3]
_PROTVAL[11]="Rotary axis vector<<S_TXT[12],$TC_CARR7[_OVI[8]],$TC_CARR8[_OVI[8]],$TC_CARR9[_OVI[8]],"
_PROTVAL[12]="Offset vector<<S_TXT[13],$TC_CARR4[_OVI[8]],$TC_CARR5[_OVI[8]],$TC_CARR6[_OVI[8]],"<<S_TXT[3]
_PROTVAL[13]="Rotary axis vector<<S_TXT[14],$TC_CARR10[_OVI[8]],$TC_CARR11[_OVI[8]],$TC_CARR12[_OVI[8]],"
_PROTVAL[14]="Offset vector<<S_TXT[15],$TC_CARR15[_OVI[8]],$TC_CARR16[_OVI[8]],$TC_CARR17[_OVI[8]],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Offset vector<<S_TXT[11],_OVR[1],_OVR[2],_OVR[3],"<<S_TXT[3]
_PROTVAL[6]="Rotary axis vector<<S_TXT[12],_OVR[7],_OVR[8],_OVR[9],"
_PROTVAL[7]="Offset vector<<S_TXT[13],_OVR[4],_OVR[5],_OVR[6],"<<S_TXT[3]
_PROTVAL[8]="Rotary axis vector<<S_TXT[14],_OVR[10],_OVR[11],_OVR[12],"
_PROTVAL[9]="Offset vector<<S_TXT[15],_OVR[15],_OVR[16],_OVR[17],"<<S_TXT[3]
ENDIF
GOTOF _MI_END
_MI3:
S_TXT[11]="I1" S_TXT[12]="V1" S_TXT[13]="I2" S_TXT[14]="I3" S_TXT[15]="V2" S_TXT[16]="I4"
_PROTFORM[4]=6
IF _TXTCOR=="Old values"
_PROTFORM[4]=_PROTFORM[4]*2
_PROTVAL[11]="Offset vector<<S_TXT[11],$TC_CARR1[_OVI[8]],$TC_CARR2[_OVI[8]],$TC_CARR3[_OVI[8]],"<<S_TXT[3]
_PROTVAL[12]="Rotary axis vector<<S_TXT[12],$TC_CARR7[_OVI[8]],$TC_CARR8[_OVI[8]],$TC_CARR9[_OVI[8]],"
_PROTVAL[13]="Offset vector<<S_TXT[13],$TC_CARR4[_OVI[8]],$TC_CARR5[_OVI[8]],$TC_CARR6[_OVI[8]],"<<S_TXT[3]
_PROTVAL[14]="Offset vector<<S_TXT[14],$TC_CARR15[_OVI[8]],$TC_CARR16[_OVI[8]],$TC_CARR17[_OVI[8]],"<<S_TXT[3]
_PROTVAL[15]="Rotary axis vector<<S_TXT[15],$TC_CARR10[_OVI[8]],$TC_CARR11[_OVI[8]],$TC_CARR12[_OVI[8]],"
_PROTVAL[16]="Offset vector<<S_TXT[16],$TC_CARR18[_OVI[8]],$TC_CARR19[_OVI[8]],$TC_CARR20[_OVI[8]],"<<S_TXT[3]
ELSE
_PROTVAL[5]="Offset vector<<S_TXT[11],_OVR[1],_OVR[2],_OVR[3],"<<S_TXT[3]
_PROTVAL[6]="Rotary axis vector<<S_TXT[12],_OVR[7],_OVR[8],_OVR[9],"
_PROTVAL[7]="Offset vector<<S_TXT[13],_OVR[4],_OVR[5],_OVR[6],"<<S_TXT[3]
_PROTVAL[8]="Offset vector<<S_TXT[14],_OVR[15],_OVR[16],_OVR[17],"<<S_TXT[3]
_PROTVAL[9]="Rotary axis vector<<S_TXT[15],_OVR[10],_OVR[11],_OVR[12],"
_PROTVAL[10]="Offset vector<<S_TXT[16],_OVR[18],_OVR[19],_OVR[20],"<<S_TXT[3]
ENDIF
_MI_END:
cycle152
cycle157(_PROTFORM[2])
RET
_LABEL996_END:
_LABEL9960:
IF (SUBSTR(_PROTVAL[29],0,1))=="V"
IF (STRLEN(_PROTVAL[29])==4) AND (STRLEN(_PROTVAL[28])>0)
_PROTVAL[7]=""
_PROTVAL[10]=<<_PROTVAL[28]
GOTOF _MJ_END
ENDIF
ENDIF
S_TXT[8]="5"
_PROTVAL[1]="max Value"
_PROTVAL[2]="min Value"
_STRX=<<_PROTVAL[27]
WHILE _I1<=NUMBER(S_TXT[8])
_I=MATCH(_STRX,",")
IF _I>=0
S_TXT[80+_I1]=(SUBSTR(_STRX,0,_I))
_STRX=(SUBSTR(_STRX,_I+1))
ELSE
S_TXT[80+_I1]=(SUBSTR(_STRX,_I+1))
GOTOF _NEXT3
ENDIF
_I1=_I1+1
ENDWHILE
_NEXT3:
_I1=STRLEN(S_TXT[4])
_I=(_PROTFORM[1]-(((NUMBER(S_TXT[8]))-1)*_I1)) MOD(NUMBER(S_TXT[8]))
_PROTFORM[5]=(_PROTFORM[1]-_I-(((NUMBER(S_TXT[8]))-1)*_I1))/NUMBER(S_TXT[8])
_PROTFORM[1]=_PROTFORM[1]-_I
S_TXT[7]=<<$MN_INT_INCR_PER_MM
S_TXT[37]=<<$MN_INT_INCR_PER_DEG
_I=STRLEN(S_TXT[7])
_RES1=_I-1
S_TXT[7]="%"<<_PROTFORM[5]<<"."<<_RES1<<"F"
_I=STRLEN(S_TXT[37])
_RES1=_I-1
S_TXT[37]="%"<<_PROTFORM[5]<<"."<<_RES1<<"F"
_I=INDEX(_PROTVAL[25],",")
_I1=RINDEX(_PROTVAL[25],",")
IF _I>=0
IF _I1>0
_HEADLINE[7]=SUBSTR(_PROTVAL[25],0,_I1-3)
S_TXT[14]=SUBSTR(_PROTVAL[25],_I+1,_I1-_I-1)
S_TXT[15]=SUBSTR(_PROTVAL[25],_I1+1)
ELSE
S_TXT[14]=SUBSTR(_PROTVAL[25],_I+1)
ENDIF
ENDIF
S_TXT[77]=S_TXT[4]
IF (_PROTFORM[0]==2)
S_TXT[77]=";"
S_TXT[75]=" ;"
S_SP=";"
ELSE
S_TXT[75]=""
S_SP=" "
ENDIF
_HEADLINE[8]="Results measure: Kinematic measure complete"<<_HEADLINE[8]
_HEADLINE[11]="Name / number  : "<<_HEADLINE[7]
_HEADLINE[7]=""
_HEADLINE[12]=SPRINT("Rotary axis "<<"%3S"<<": "<<S_SP<<"    start:"<<S_SP<<"%8.3F"<<S_SP<<" final:"<<S_SP<<"%8.3F"<<S_SP<<" no.:"<<S_SP<<"%2D",S_TXT[14],_OVR[125],_OVR[126],_OVR[120])
IF (S_TXT[15]<>"") AND (S_TXT[15]<>"--")
_HEADLINE[13]=SPRINT("Position of rotary axis "<<"%3S"<<":"<<S_SP<<"%8.3F",S_TXT[15],_OVR[127])
_HEADLINE[14]=SPRINT("Rotary axis "<<"%3S"<<": "<<S_SP<<"    start:"<<S_SP<<"%8.3F"<<S_SP<<" final:"<<S_SP<<"%8.3F"<<S_SP<<" no.:"<<S_SP<<"%2D",S_TXT[15],_OVR[122],_OVR[123],_OVR[121])
_HEADLINE[15]=SPRINT("Position of rotary axis "<<"%3S"<<":"<<S_SP<<"%8.3F",S_TXT[14],_OVR[124])
ENDIF
_HEADLINE[16]=_PROTVAL[26]
_TAB[0]=S_TXT[14]<<" [deg]"
_TAB[1]=S_TXT[15]<<" [deg]"
_TAB[2]=S_TXT[11]<<" ["<<S_TXT[3]<<"]"
_TAB[3]=S_TXT[12]<<" ["<<S_TXT[3]<<"]"
_TAB[4]=S_TXT[13]<<" ["<<S_TXT[3]<<"]"
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I1=0
WHILE _I1<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I1])>0
_TAB[_I1]=SUBSTR(_TAB[_I1],0,_PROTFORM[5])
ENDIF
_TAB[_I1]=SPRINT(S_TXT[10],_TAB[_I1])
S_TXT[50+_I1]=_TAB[_I1]
_I1=_I1+1
ENDWHILE
IF $P_GG[6]==1
S_TXT[57]=_TAB[2] S_TXT[58]=_TAB[3] S_TXT[59]=_TAB[4]
ELSE
IF $P_GG[6]==2
S_TXT[57]=_TAB[3] S_TXT[58]=_TAB[4] S_TXT[59]=_TAB[2]
ELSE
S_TXT[57]=_TAB[4] S_TXT[58]=_TAB[2] S_TXT[59]=_TAB[3]
ENDIF
ENDIF
_M_TXT57=S_TXT[57]
_I1=STRLEN(S_TXT[4])
_I2=_PROTFORM[5]*((NUMBER(S_TXT[8]))-3)+2*_I1
_PROTVAL[0]="Difference of measure:"
_I3=_I2-STRLEN(_PROTVAL[0])-STRLEN(S_SP)
_I=1
WHILE _I<=_I3
_PROTVAL[0]=_PROTVAL[0]<<" "
_I=_I+1
ENDWHILE
_PROTVAL[0]=_PROTVAL[0]<<S_SP<<S_TXT[52]<<S_TXT[77]<<S_TXT[53]<<S_TXT[77]<<S_TXT[54]
_J=1
WHILE _J<=2
_I=1
_I3=_I2-STRLEN(_PROTVAL[_J])-STRLEN(S_SP)
WHILE _I<=_I3
_PROTVAL[_J]=_PROTVAL[_J]<<" "
_I=_I+1
ENDWHILE
_J=_J+1
ENDWHILE
_I=0 _J=0
_PROTVAL[1]=SPRINT(_PROTVAL[1]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],NUMBER(S_TXT[80]),NUMBER(S_TXT[81]),NUMBER(S_TXT[82]))
_PROTVAL[2]=SPRINT(_PROTVAL[2]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],NUMBER(S_TXT[83]),NUMBER(S_TXT[84]),NUMBER(S_TXT[85]))
_PROTVAL[4]=_TAB[0]<<S_TXT[77]
_I1=1
WHILE _I1<=(NUMBER(S_TXT[8])-1)
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I1]
IF _I1<(NUMBER(S_TXT[8])-1)
_PROTVAL[4]=_PROTVAL[4]<<S_TXT[77]
ENDIF
_I1=_I1+1
ENDWHILE
_PROTVAL[4]=S_TXT[75]<<_PROTVAL[4]
_I1=0
_I1=_OVR[128]
_PROTFORM[4]=_I1
_PROTVAL[5]="SPRINT(S_TXT[75]<<S_TXT[37]<<S_TXT[77]<<S_TXT[37]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[138+(5*_I)],_OVR[139+(5*_I)],_OVR[135+(5*_I)],_OVR[136+(5*_I)],_OVR[137+(5*_I)])"
IF 0<>0
_MAE1:
_STRX=_PROTVAL[29]
_I=MATCH(_STRX,",")
_II=0
IF _I>=0
IF SUBSTR(_STRX,_I+3,1)==","
_STRX=(SUBSTR(_STRX,_I+4))
WHILE _II<=1
_I=MATCH(_STRX,",")
IF _I>=0
_PROTVAL[8+_II]=SUBSTR(_STRX,0,_I)
_STRX=SUBSTR(_STRX,_I+1)
ELSE
_PROTVAL[8+_II]=SUBSTR(_STRX,0)
ENDIF
_II=_II+1
ENDWHILE
_II=0
WHILE _II<=1
_I=MATCH(_STRX,",")
IF (_I>=0)
_PROTVAL[19+_II]=SUBSTR(_STRX,0,_I)
_STRX=SUBSTR(_STRX,_I+1)
ELSE
_PROTVAL[19+_II]=SUBSTR(_STRX,0)
ENDIF
_II=_II+1
ENDWHILE
IF (_PROTVAL[8]<>"") OR (_PROTVAL[9]<>"")
_PROTVAL[7]="Tolerance of linear vector:"
ENDIF
IF (_PROTVAL[19]<>"") OR (_PROTVAL[20]<>"")
_PROTVAL[18]="Tolerance of direction vector:"
_J=19 _I1=20
S_TXT[57]=SPRINT(S_TXT[10],"[deg]")
REPEAT _LAB3 _ENDLAB3
IF _PROTVAL[18]
_PROTVAL[18]=SPRINT(_PROTVAL[14]<<S_SP<<S_TXT[57])
ENDIF
IF _PROTVAL[19]
_PROTVAL[19]=SPRINT(_PROTVAL[15]<<S_SP<<S_TXT[7],_OVR[111])
ENDIF
IF _PROTVAL[20]
_PROTVAL[20]=SPRINT(_PROTVAL[16]<<S_SP<<S_TXT[7],_OVR[112])
ENDIF
S_TXT[57]=_M_TXT57
ENDIF
ENDIF
ENDIF
_MAE2:
ENDIF
IF STRLEN(_PROTVAL[29])>3
_I5=0
_I=INDEX(_PROTVAL[29],",")
_I1=RINDEX(_PROTVAL[29],",")
IF _I>=0
IF (SUBSTR(_PROTVAL[29],0,1))=="E"
_HEADLINE[17]="Error Tolerance:"<<S_SP
REPEAT _MAE1 _MAE2
_I4=0 _I5=93
ENDIF
IF (SUBSTR(_PROTVAL[29],0,1))=="V"
_I4=0
_HEADLINE[17]=_HEADLINE[19]
IF STRLEN(_PROTVAL[29])>4
IF (((SUBSTR(_PROTVAL[29],5,3))=="I2,") OR ((SUBSTR(_PROTVAL[29],5,3))=="I1,"))
_PROTVAL[7]="TCARR offset"
ELSE
_PROTVAL[7]="Difference of vector:"
ENDIF
ELSE
_PROTVAL[7]=""
ENDIF
ENDIF
IF (SUBSTR(_PROTVAL[29],0,1))==" "
_I4=6
IF (STRLEN(_PROTVAL[29])>5)
IF (((SUBSTR(_PROTVAL[29],5,3))=="I2,") OR ((SUBSTR(_PROTVAL[29],5,3))=="I1,"))
_PROTVAL[7]="TCARR offset before"
ELSE
_PROTVAL[7]="Difference of vector before:"
ENDIF
ENDIF
ENDIF
IF (SUBSTR(_PROTVAL[29],0,1))<>"E"
_PROTVAL[8]=SUBSTR(_PROTVAL[29],_I+4)
_II=0
WHILE INDEX(_PROTVAL[8],",")>-1
_I1=RINDEX(_PROTVAL[8],",")
FOR _J=1 TO _II
_PROTVAL[10+_II-_J]=_PROTVAL[9+_II-_J]
ENDFOR
_PROTVAL[9]=SUBSTR(_PROTVAL[8],_I1+1)
_PROTVAL[8]=SUBSTR(_PROTVAL[29],_I+4,_I1)
_II=_II+1
ENDWHILE
ENDIF
ENDIF
_J=7 _I1=11
REPEAT _LAB3 _ENDLAB3
IF SUBSTR(_PROTVAL[7],0,5)=="TCARR"
IF SUBSTR(_PROTVAL[8],0,2)=="I1"
_PROTVAL[8+_I4]=SPRINT(_PROTVAL[8]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[1],_OVR[2],_OVR[3])
_PROTVAL[9+_I4]=SPRINT(_PROTVAL[9]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[4],_OVR[5],_OVR[6])
IF SUBSTR(_PROTVAL[10],0,2)=="I3"
_PROTVAL[10+_I4]=SPRINT(_PROTVAL[10]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[15],_OVR[16],_OVR[17])
IF SUBSTR(_PROTVAL[11],0,2)=="I4"
_PROTVAL[11+_I4]=SPRINT(_PROTVAL[11]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[18],_OVR[19],_OVR[20])
ENDIF
ENDIF
ENDIF
IF SUBSTR(_PROTVAL[8],0,2)=="I2"
_PROTVAL[8+_I4]=SPRINT(_PROTVAL[8]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[4],_OVR[5],_OVR[6])
IF SUBSTR(_PROTVAL[9],0,2)=="I3"
_PROTVAL[9+_I4]=SPRINT(_PROTVAL[9]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[15],_OVR[16],_OVR[17])
_PROTVAL[10+_I4]=SPRINT(_PROTVAL[10]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[18],_OVR[19],_OVR[20])
ELSE
IF SUBSTR(_PROTVAL[9],0,2)=="I4"
_PROTVAL[9+_I4]=SPRINT(_PROTVAL[9]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[18],_OVR[19],_OVR[20])
ENDIF
ENDIF
ENDIF
ELSE
IF _PROTVAL[8]
_PROTVAL[8+_I4]=SPRINT(_PROTVAL[8]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[_I5+21],_OVR[_I5+22],_OVR[_I5+23])
ENDIF
IF _PROTVAL[9]
_PROTVAL[9+_I4]=SPRINT(_PROTVAL[9]<<S_SP<<S_TXT[7]<<S_TXT[77]<<S_TXT[7]<<S_TXT[77]<<S_TXT[7],_OVR[_I5+24],_OVR[_I5+25],_OVR[_I5+26])
ENDIF
ENDIF
IF _PROTVAL[7]
_PROTVAL[7+_I4]=_PROTVAL[7]<<S_SP<<S_TXT[57]<<S_TXT[77]<<S_TXT[58]<<S_TXT[77]<<S_TXT[59]
ENDIF
_PROTVAL[12]=<<_PROTVAL[28]
ENDIF
_MJ_END:
IF (_PROTFORM[0]==2)
_I=MATCH(_PROTVAL[12],":")
IF _I>-1
_PROTVAL[12]=SUBSTR(_PROTVAL[12],0,_I+1)<<S_SP<<SUBSTR(_PROTVAL[12],_I+1)
ENDIF
ENDIF
cycle157(_PROTFORM[2])
RET
_LAB3:
WHILE _J<=_I1
_I=1
_I3=_I2-STRLEN(_PROTVAL[_J])
IF _I3<>_I2
IF _I3<0
IF (_PROTFORM[0])
S_TXT[57]=SUBSTR(S_TXT[57],ABS(_I3)+STRLEN(S_SP))
ENDIF
ENDIF
WHILE _I<=_I3-(STRLEN(S_SP))
_PROTVAL[_J]=_PROTVAL[_J]<<" "
_I=_I+1
ENDWHILE
ENDIF
_J=_J+1
ENDWHILE
_I=0 _J=0
_ENDLAB3:
_LABEL9960_END:
_LABEL997:
CASE _MVAR5 OF 0 GOTOF _MK1 1 GOTOF _MK2
_MK1:
_HEADLINE[8]="Results measure: Ball"<<_HEADLINE[8]
GOTOF _MK_END
_MK2:
_HEADLINE[8]="Results measure: 3 Balls"<<_HEADLINE[8]
_MK_END:
CASE _MVAR5 OF 0 GOTOF _ML1 1 GOTOF _ML2
_ML1:
_PROTFORM[4]=4
_PROTVAL[5]="<<S_TXT[11],_OVR[1],_OVR[5],_OVR[9],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12],_OVR[2],_OVR[6],_OVR[10],"<<S_TXT[3]
_PROTVAL[7]="<<S_TXT[13],_OVR[3],_OVR[7],_OVR[11],"<<S_TXT[3]
_PROTVAL[8]="Diameter,_OVR[0],_OVR[4],_OVR[8],"<<S_TXT[3]
GOTOF _ML_END
_ML2:
_PROTFORM[4]=12
_PROTVAL[5]="1.Ball<<S_TXT[11],_SETV[0],_OVR[5],_OVR[9],"<<S_TXT[3]
_PROTVAL[6]="      <<S_TXT[12],_SETV[1],_OVR[6],_OVR[10],"<<S_TXT[3]
_PROTVAL[7]="      <<S_TXT[13],_SETV[2],_OVR[7],_OVR[11],"<<S_TXT[3]
_PROTVAL[8]="    Diameter,_SETVAL,_OVR[4],_OVR[8],"<<S_TXT[3]
_PROTVAL[9]="2.Ball<<S_TXT[11],_SETV[3],_OVR[13],_OVR[17],"<<S_TXT[3]
_PROTVAL[10]="      <<S_TXT[12],_SETV[4],_OVR[14],_OVR[18],"<<S_TXT[3]
_PROTVAL[11]="      <<S_TXT[13],_SETV[5],_OVR[15],_OVR[19],"<<S_TXT[3]
_PROTVAL[12]="    Diameter,_SETVAL,_OVR[12],_OVR[16],"<<S_TXT[3]
_PROTVAL[13]="3.Ball<<S_TXT[11],_SETV[6],_OVR[21],_OVR[25],"<<S_TXT[3]
_PROTVAL[14]="      <<S_TXT[12],_SETV[7],_OVR[22],_OVR[26],"<<S_TXT[3]
_PROTVAL[15]="      <<S_TXT[13],_SETV[8],_OVR[23],_OVR[27],"<<S_TXT[3]
_PROTVAL[16]="    Diameter,_SETVAL,_OVR[20],_OVR[24],"<<S_TXT[3]
_ML_END:
cycle152
cycle157(_PROTFORM[2])
RET
_LABEL997_END:
_LABEL998:
CASE _MVAR1 OF 5 GOTOF _MM1 6 GOTOF _MM2
_MM1:
_HEADLINE[8]="Results measure: Align edge"<<_HEADLINE[8]
GOTOF _MM_END
_MM2:
_HEADLINE[8]="Results measure: Align plane"<<_HEADLINE[8]
_MM_END:
CASE _MVAR1 OF 5 GOTOF _MN1 6 GOTOF _MN2
_MN1:
_PROTFORM[4]=1
_PROTVAL[5]="Angle to<<S_TXT[15],_OVR[0],_OVR[4],_OVR[16],deg"
GOTOF _MN_END
_MN2:
_PROTFORM[4]=2
_PROTVAL[5]="Angle to<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],deg"
_PROTVAL[6]="Angle to<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],deg"
_MN_END:
cycle152
cycle157(_PROTFORM[2])
RET
_LABEL998_END:
_LABEL973:
S_SETVAL=_SETVAL
S_TXT[62]=<<S_SETVAL
IF ((_MVAR==0)OR(_MVAR==1000000))
IF _MVAR7==1
S_MVAR=11
ELSE
S_MVAR=12
ENDIF
ENDIF
IF ((_MVAR1==3)AND(_MVAR2==1)AND(_MVAR4==1)AND(_MVAR7==1))
S_MVAR=21
ENDIF
IF ((_MVAR1==3)AND(_MVAR2==1)AND(_MVAR4==1)AND(_MVAR7==0))
S_MVAR=22
ENDIF
IF ((_MVAR1==3)AND(_MVAR2==1)AND(_MVAR4==2)AND(_MVAR7==0))
S_MVAR=23
ENDIF
IF (S_MVAR==0) GOTOF _MC_END
_MESSAX_NO=_MA _DEC1
IF ((S_MVAR==21) OR (S_MVAR==22) OR (_MVAR==0) OR (_MVAR==1000000))
IF _MD==0
S_MD="+ " _J=2
ENDIF
IF _MD==1
S_MD="- " _J=0
ENDIF
ENDIF
IF (S_MVAR>20)
REPEAT _LAB2 _ENDLAB2
ENDIF
CASE (S_MVAR) OF 11 GOTOF _MO1 12 GOTOF _MO2 21 GOTOF _MO3 22 GOTOF _MO4 23 GOTOF _MO4
_MO1:
_HEADLINE[8]="Calibration    : workpiece probe, length on face"<<_HEADLINE[8]
GOTOF _MO_END
_MO2:
_HEADLINE[8]="Calibration    : workpiece probe, radius on face"<<_HEADLINE[8]
GOTOF _MO_END
_MO3:
_HEADLINE[8]="Calibration    : workpiece probe, length in slot"<<_HEADLINE[8]
GOTOF _MO_END
_MO4:
_HEADLINE[8]="Calibration    : workpiece probe, radius in slot"<<_HEADLINE[8]
_MO_END:
_HEADLINE[11]="Probe/Block no.: "<<_OVI[5]<<" / "<<_CALNUM
WHILE _I1<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I1=_I1+1
ENDWHILE
_I1=0
_TAB[0]=_HEADLINE[19]
_TAB[1]="Setpoint"
_TAB[2]="Calibrated"
_TAB[3]="Difference"
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I1=1
WHILE _I1<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I1])>0
_TAB[_I1]=SUBSTR(_TAB[_I1],0,_PROTFORM[5])
ENDIF
_TAB[_I1]=SPRINT(S_TXT[10],_TAB[_I1])
S_TXT[50+_I1]=_TAB[_I1]
_I1=_I1+1
ENDWHILE
_I1=0
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I1=1
WHILE _I1<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I1]<<S_TXT[4]
_I1=_I1+1
ENDWHILE
_I1=0
CASE S_MVAR OF 11 GOTOF _MP11 12 GOTOF _MP12 21 GOTOF _MP11 22 GOTOF _MP12 23 GOTOF _MP23
_MP11:
_PROTFORM[4]=3
_PROTVAL[5]="<<S_TXT[14],S_SETVAL,,,"<<S_TXT[3]
_PROTVAL[7]="Probe Length,,_OVR[22],_OVR[23],"<<S_TXT[3]
_LAB3_A:
IF (S_MD=="+ ")
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[6]="Trigger + <<S_TXT[14],,_OVR[10],_OVR[11],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[6]="Trigger + <<S_TXT[14],,_OVR[14],_OVR[15],"<<S_TXT[3]
ENDIF
ENDIF
ELSE
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[6]="Trigger - <<S_TXT[14],,_OVR[8],_OVR[9],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[6]="Trigger - <<S_TXT[14],,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
ENDIF
ENDIF
_LAB3_E:
cycle152
GOTOF _MP_END
_MP12:
_PROTFORM[4]=2
_PROTVAL[5]="<<S_TXT[14],S_SETVAL,,,"<<S_TXT[3]
REPEAT _LAB3_A _LAB3_E
cycle152
GOTOF _MP_END
_MP23:
_PROTFORM[4]=5
_PROTVAL[5]="Width("<<_CALNUM<<") "<<"<<S_TXT[14],S_SETVAL,,,"<<S_TXT[3]
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[6]="Trigger + <<S_TXT[14],,_OVR[10],_OVR[11],"<<S_TXT[3]
_PROTVAL[7]="Trigger - <<S_TXT[14],,_OVR[8],_OVR[9],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[6]="Trigger + <<S_TXT[14],,_OVR[14],_OVR[15],"<<S_TXT[3]
_PROTVAL[7]="Trigger - <<S_TXT[14],,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
ENDIF
_PROTVAL[8]="Probe ball diameter,_OVR[4],_OVR[5],"<<S_TXT[3]
IF ((_MVAR5==1) AND (S_TXT[14]==S_TXT[11]))
_PROTVAL[9]="Position deviation <<S_TXT[11],_OVR[20],,"<<S_TXT[3]
ENDIF
IF ((_MVAR5==1) AND (S_TXT[14]==S_TXT[12]))
_PROTVAL[9]="Position deviation <<S_TXT[12],_OVR[21],,"<<S_TXT[3]
ENDIF
cycle152
_MP_END:
cycle157(_PROTFORM[2])
RET
_LAB2:
IF ((S_MVAR==11) OR (S_MVAR==21))
IF ((_MESSAX_NO==1) AND ($P_ADT[2]==7))
S_SETVAL=$SNS_MEA_CAL_EDGE_BASE_AX1[0+_CALNUM-1]
ENDIF
IF ((_MESSAX_NO==2) AND ($P_ADT[2]==8))
S_SETVAL=$SNS_MEA_CAL_EDGE_BASE_AX2[0+_CALNUM-1]
ENDIF
ELSE
IF (S_MVAR<>22)
IF ((_MESSAX_NO==1) AND ($P_ADT[2]==8))
S_SETVAL=$SNS_MEA_CAL_EDGE_PLUS_DIR_AX1[0+_CALNUM-1]-$SNS_MEA_CAL_EDGE_MINUS_DIR_AX1[0+_CALNUM-1]
ENDIF
IF ((_MESSAX_NO==2) AND ($P_ADT[2]==7))
S_SETVAL=$SNS_MEA_CAL_EDGE_PLUS_DIR_AX2[0+_CALNUM-1]-$SNS_MEA_CAL_EDGE_MINUS_DIR_AX2[0+_CALNUM-1]
ENDIF
ELSE
IF ((_MESSAX_NO==1) AND ($P_ADT[2]==8))
IF (_MD==0)
S_SETVAL=$SNS_MEA_CAL_EDGE_PLUS_DIR_AX1[0+_CALNUM-1]
ELSE
S_SETVAL=$SNS_MEA_CAL_EDGE_MINUS_DIR_AX1[0+_CALNUM-1]
ENDIF
ENDIF
IF ((_MESSAX_NO==2) AND ($P_ADT[2]==7))
IF (_MD==0)
S_SETVAL=$SNS_MEA_CAL_EDGE_PLUS_DIR_AX2[0+_CALNUM-1]
ELSE
S_SETVAL=$SNS_MEA_CAL_EDGE_MINUS_DIR_AX2[0+_CALNUM-1]
ENDIF
ENDIF
ENDIF
ENDIF
S_TXT[62]=<<S_SETVAL
_ENDLAB2:
_LABEL973_END:
_LABEL974:
IF (_MA==1)
S_MVAR=1
ENDIF
IF ((_MA==2) OR (_MA==3))
IF (_MD==0)
S_MVAR=2
ENDIF
IF (_MD==1)
S_MVAR=3
ENDIF
ENDIF
IF _MVAR4==1
_HEADLINE[9]=_HEADLINE[9]<<"With reversal"
ELSE
_HEADLINE[9]=_HEADLINE[9]<<"Without reversal"
ENDIF
CASE S_MVAR OF 1 GOTOF _MQ1 2 GOTOF _MQ2 3 GOTOF _MQ3
_MQ1:
_HEADLINE[8]="Results measure: Set front edge"<<_HEADLINE[8]
GOTOF _MQ_END
_MQ2:
_HEADLINE[8]="Results measure: Inside diameter"<<_HEADLINE[8]
GOTOF _MQ_END
_MQ3:
_HEADLINE[8]="Results measure: Outside diameter"<<_HEADLINE[8]
_MQ_END:
CASE S_MVAR OF 1 GOTOF _MR1 2 GOTOF _MR2 3 GOTOF _MR2
_MR1:
_PROTFORM[4]=1
_PROTVAL[5]="<<S_TXT[14],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
GOTOF _MR_END
_MR2:
_PROTFORM[4]=1
_PROTVAL[5]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
_MR_END:
cycle152
_PROTVAL[5]= _PROTVAL[5]<<S_TXT[27]
cycle157(_PROTFORM[2])
RET
_LABEL974_END:
_LABEL982:
IF (_MVAR1==0) OR (_MVAR1==1)
_MESSAX_NO=_MA _DEC1
IF ((_MESSAX_NO==1) OR (_MESSAX_NO==2))
_I=(_MESSAX_NO-1)
_J=0 _I=(_I*4)+_J
IF _OVR[9+_I]<>0
S_MD="- "
ELSE
_J=2 _I=_I+_J
IF _OVR[9+_I]<>0
S_MD="+ "
ENDIF
ENDIF
ENDIF
ENDIF
_I2=$P_TOOLNO _I3=$P_TOOL
IF ($MN_MM_TYPE_OF_CUTTING_EDGE==0)
S_TOOLTYPE=$TC_DP1[_I2,_I3]
ELSE
S_TOOLTYPE=$TC_DP1[_I3]
ENDIF
IF ((_MVAR1==1) OR (_MVAR1==2))
IF ((S_TOOLTYPE>499) AND (S_TOOLTYPE<600))
IF (_MVAR1==1)
S_MVAR=3
ELSE
S_MVAR=4
ENDIF
ENDIF
IF ((S_TOOLTYPE>199) AND (S_TOOLTYPE<300))
IF (_MVAR1==1)
S_MVAR=5
ELSE
S_MVAR=6
ENDIF
ENDIF
IF ((S_TOOLTYPE>99) AND (S_TOOLTYPE<200))
IF (_MVAR1==1)
S_MVAR=7
ELSE
S_MVAR=8
ENDIF
ENDIF
ENDIF
CASE _MVAR OF 0 GOTOF _MS1 10 GOTOF _MS1 10000000 GOTOF _MS1 10000010 GOTOF _MS1
IF ((_MVAR6==1) AND (_MVAR1==0)) GOTOF _MS2
CASE S_MVAR OF 3 GOTOF _MS3 4 GOTOF _MS3 5 GOTOF _MS5 6 GOTOF _MS5 7 GOTOF _MS4 8 GOTOF _MS4
_MS1:
_HEADLINE[8]="Calibration    : Tool probe (turning)"<<_HEADLINE[8]
GOTOF _MS_END
_MS2:
_HEADLINE[8]="Calibration    : Tool probe (turning), inc."<<_HEADLINE[8]
GOTOF _MS_END
_MS3:
_HEADLINE[8]="Results measure: Tool offset turning tool (turning)"<<_HEADLINE[8]
GOTOF _MS_END
_MS4:
_HEADLINE[8]="Results measure: Tool offset milling tool (turning)"<<_HEADLINE[8]
IF _MVAR3==1
_HEADLINE[9]=_HEADLINE[9]<<"Spindle reversal"
ENDIF
GOTOF _MS_END
_MS5:
_HEADLINE[8]="Results measure: Tool offset boring tool (turning)"<<_HEADLINE[8]
_MS_END:
_HEADLINE[11]="Probe no.      : "<<_OVI[5]
WHILE _I1<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I1=_I1+1
ENDWHILE
IF (_PROTNAME[1]=="_N_E_PRT_JOG_SPF") GOTOF _NEXT4
_TAB[0]=_HEADLINE[19]
_TAB[1]="Setpoint"
IF (_MVAR1==0)
_TAB[2]="Calibrated"
ELSE
_TAB[2]="Measured"
ENDIF
_TAB[3]="Difference"
S_TXT[10]="%"<<_PROTFORM[5]<<"S"
_I1=1
WHILE _I1<=NUMBER(S_TXT[8])
IF STRLEN(_TAB[_I1])>0
_TAB[_I1]=SUBSTR(_TAB[_I1],0,_PROTFORM[5])
ENDIF
_TAB[_I1]=SPRINT(S_TXT[10],_TAB[_I1])
S_TXT[50+_I1]=_TAB[_I1]
_I1=_I1+1
ENDWHILE
_PROTVAL[4]=_TAB[0]<<S_TXT[4]
_I1=1
WHILE _I1<=NUMBER(S_TXT[8])
_PROTVAL[4]=_PROTVAL[4]<<_TAB[_I1]<<S_TXT[4]
_I1=_I1+1
ENDWHILE
_I1=0
_NEXT4:
CASE _MVAR OF 0 GOTOF _MT1 10 GOTOF _MT1 10000000 GOTOF _MT1 10000010 GOTOF _MT1
IF ((_MVAR6==1) AND (_MVAR1==0)) GOTOF _MT1
CASE S_MVAR OF 3 GOTOF _MT3 4 GOTOF _MT4 5 GOTOF _MT3 6 GOTOF _MT4 7 GOTOF _MT7 8 GOTOF _MT8
_MT1:
_PROTFORM[4]=1
IF (S_MD=="+ ")
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[5]="Trigger + <<S_TXT[14],,_OVR[10],_OVR[11],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[5]="Trigger + <<S_TXT[14],,_OVR[14],_OVR[15],"<<S_TXT[3]
ENDIF
IF (S_TXT[14]==S_TXT[13])
_PROTVAL[5]="Trigger + <<S_TXT[14],,_OVR[18],_OVR[19],"<<S_TXT[3]
ENDIF
ENDIF
ELSE
IF (S_TXT[14]==S_TXT[11])
_PROTVAL[5]="Trigger - <<S_TXT[14],,_OVR[8],_OVR[9],"<<S_TXT[3]
ELSE
IF (S_TXT[14]==S_TXT[12])
_PROTVAL[5]="Trigger - <<S_TXT[14],,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
IF (S_TXT[14]==S_TXT[13])
_PROTVAL[5]="Trigger - <<S_TXT[14],,_OVR[16],_OVR[17],"<<S_TXT[3]
ENDIF
ENDIF
ENDIF
cycle152
GOTOF _MT_END
_MT2:
_PROTFORM[4]=4
_PROTVAL[5]="Trigger + <<S_TXT[11],,_OVR[10],_OVR[11],"<<S_TXT[3]
_PROTVAL[6]="Trigger - <<S_TXT[11],,_OVR[8],_OVR[9],"<<S_TXT[3]
_PROTVAL[7]="Trigger + <<S_TXT[12],,_OVR[14],_OVR[15],"<<S_TXT[3]
_PROTVAL[8]="Trigger - <<S_TXT[12],,_OVR[12],_OVR[13],"<<S_TXT[3]
cycle152
GOTOF _MT_END
_MT3:
_PROTFORM[4]=1
IF _OVR[10]<>0
_PROTVAL[5]="Geo Length 2,,_OVR[10],_OVR[11],"<<S_TXT[3]
ENDIF
IF _OVR[8]<>0
_PROTVAL[5]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
IF _OVR[12]<>0
_PROTVAL[5]="Geo Length 3,,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
cycle152
GOTOF _MT_END
_MT4:
_PROTFORM[4]=0
IF _OVR[8]<>0
_PROTFORM[4]=_PROTFORM[4]+1
_PROTVAL[4+_PROTFORM[4]]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
IF (_OVR[10]<>0)
_PROTFORM[4]=_PROTFORM[4]+1
_PROTVAL[4+_PROTFORM[4]]="Geo Length 2,,_OVR[10],_OVR[11],"<<S_TXT[3]
ENDIF
IF (_OVR[12]<>0)
_PROTFORM[4]=_PROTFORM[4]+1
_PROTVAL[4+_PROTFORM[4]]="Geo Length 3,,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
cycle152
GOTOF _MT_END
_MT5:
_PROTFORM[4]=1
IF ((S_TXT[25]=="1") OR (S_TXT[25]=="3"))
IF _MESSAX_NO==3
_PROTVAL[5]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
ENDIF
cycle152
GOTOF _MT_END
_MT6:
_PROTFORM[4]=1
IF ((S_TXT[25]=="1") OR (S_TXT[25]=="3"))
IF _MESSAX_NO==3
_PROTVAL[5]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
ENDIF
cycle152
GOTOF _MT_END
_MT7:
IF (_MVAR4==0)
GOTOB _MT3
ENDIF
IF (_MVAR4==1)
_PROTFORM[4]=1
_PROTVAL[5]="Geo radius,,_OVR[12],_OVR[13],"<<S_TXT[3]
cycle152
ENDIF
IF (_MVAR4==2)
_PROTFORM[4]=2
IF _OVR[10]<>0
_PROTVAL[5]="Geo Length 2,,_OVR[10],_OVR[11],"<<S_TXT[3]
ENDIF
IF _OVR[8]<>0
_PROTVAL[5]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
_PROTVAL[6]="Geo radius,,_OVR[12],_OVR[13],"<<S_TXT[3]
cycle152
ENDIF
_MT8:
_PROTFORM[4]=0
IF _OVR[8]<>0
_PROTFORM[4]=_PROTFORM[4]+1
_PROTVAL[4+_PROTFORM[4]]="Geo Length 1,,_OVR[8],_OVR[9],"<<S_TXT[3]
ENDIF
IF _OVR[10]<>0
_PROTFORM[4]=_PROTFORM[4]+1
_PROTVAL[4+_PROTFORM[4]]="Geo Length 2,,_OVR[10],_OVR[11],"<<S_TXT[3]
ENDIF
IF _OVR[12]<>0
_PROTFORM[4]=_PROTFORM[4]+1
_PROTVAL[4+_PROTFORM[4]]="Geo radius,,_OVR[12],_OVR[13],"<<S_TXT[3]
ENDIF
cycle152
_MT_END:
cycle157(_PROTFORM[2])
RET
_LABEL982_END:
_LABEL994:
IF (_MD==0)
S_MVAR1=1
ELSE
S_MVAR1=2
ENDIF
IF (($P_GG[29]==2) AND ($MC_DIAMETER_AX_DEF==S_TXT[14]))
S_MVAR2=1
ENDIF
S_MVAR=10*S_MVAR2+S_MVAR1
_HEADLINE[9]=_HEADLINE[9]<<"Drive under center"
CASE S_MVAR1 OF 1 GOTOF _MU1 2 GOTOF _MU2
_MU1:
_HEADLINE[8]="Results measure: Inside diameter"<<_HEADLINE[8]
GOTOF _MU_END
_MU2:
_HEADLINE[8]="Results measure: Outside diameter"<<_HEADLINE[8]
_MU_END:
CASE S_MVAR2 OF 1 GOTOF _MV1 0 GOTOF _MV2
_MV1:
_PROTFORM[4]=1
_PROTVAL[5]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
GOTOF _MV_END
_MV2:
_PROTFORM[4]=1
_PROTVAL[5]="Radius,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
_MV_END:
cycle152
_PROTVAL[5]= _PROTVAL[5]<<S_TXT[27]
cycle157(_PROTFORM[2])
RET
_LABEL994_END:
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE152_SPF
PROC CYCLE152 SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.94.00.00.005 ;DATE: 2020-05-07
;Cycle support HMIsl
;Report measuring results - utility cycle: Formatting measured value lines
DEF INT _I,_I1,_I2,_I3,_J,_MAX,_MAX1,_STRL,_IDX,_IDX1,_LSP,_ANZSP=0
DEF REAL S_SETVAL
DEF STRING[66] _NAME1,_NAME2,_NAME,_STR1,_NAME3
DEF STRING[4] _MM,_SX,_MM_ANG
DEF STRING[14] _SP[10]=REP(""),_LEERSP
DEF STRING[66] _STR[10]
DEF STRING[200] _STRX
_I1=0 _J=0 _I=0
IF _OVI[2]==973
IF ISNUMBER(S_TXT[62])
S_SETVAL=NUMBER(S_TXT[62])
ELSE
GOTOF _FEHL2
ENDIF
ENDIF
_I=1
WHILE _I<=_PROTFORM[5]
_LEERSP=_LEERSP<<" "
_I=_I+1
ENDWHILE
_I1=1 _I3=0 _MAX1=_PROTFORM[4] _J=0 _I=0 _MAX=NUMBER(S_TXT[9]) _ANZSP=0
IF (_OVI[2]==996) AND (SUBSTR(_PROTVAL[29],0,1)=="V") AND (_PROTFORM[3]<>2)
_MAX1=(_PROTFORM[4])/2 _I3=_MAX1
ENDIF
WHILE _I1<=_MAX1
IF STRLEN(_PROTVAL[4+_I3+_I1])>0
_SP[0]=REP("") _STR[0]=REP("") _ANZSP=0
_STRX=_PROTVAL[4+_I3+_I1]
_IDX=RINDEX(_STRX,",")
IF SUBSTR(_STRX,_IDX+1)=="deg"
_MM_ANG="deg"
ELSE
_MM_ANG=""
ENDIF
REPEAT _LAB1 _LAB1E
_STRL=STRLEN(_STR[1])
_IDX=MATCH(_STR[1],"<")
IF _IDX>=0
_NAME1=(SUBSTR(_STR[1],0,_IDX))
IF STRLEN(_NAME1)==0
_NAME1=""
ENDIF
_NAME2=(SUBSTR(_STR[1],_IDX+2))
EXECSTRING("_NAME2="<<_NAME2)
ELSE
_NAME1=_STR[1]
_NAME2=""
ENDIF
_I=STRLEN(_NAME1) _J=STRLEN(_NAME2)
IF ((_I+_J)>_MAX-1)
IF (_J>0)
IF _J>3
_NAME2=SUBSTR(_NAME2,0,3)
ELSE
_NAME1=SUBSTR(_NAME1,0,(_MAX-1-_J))
ENDIF
_NAME=_NAME1<<" "<<_NAME2
WHILE STRLEN(_NAME)<_MAX
_NAME=_NAME<<" "
ENDWHILE
ELSE
_NAME=SUBSTR(_NAME1,0,_MAX)
ENDIF
ENDIF
IF ((_I+_J)==_MAX-1)
_NAME=_NAME1<<" "<<_NAME2
ENDIF
IF ((_I+_J)<_MAX-1)
IF STRLEN(_NAME1)
_NAME=_NAME1<<" "<<_NAME2
ELSE
_NAME=_NAME2
ENDIF
WHILE STRLEN(_NAME)<_MAX
_NAME=_NAME<<" "
ENDWHILE
ENDIF
_I=0 _J=0
_NAME3=_NAME
_I2=2
_PROTVAL[4+_I3+_I1]="_PROTVAL[4+_I3+_I1]=SPRINT(_NAME"
WHILE _I2<_ANZSP
_PROTVAL[4+_I3+_I1]=_PROTVAL[4+_I3+_I1]<<"<<S_TXT[4]<<_SP["<<_I2<<"]"
_I2=_I2+1
ENDWHILE
_PROTVAL[4+_I3+_I1]=_PROTVAL[4+_I3+_I1]<<"<<S_TXT[4]<<_MM"<<_STR1<<")"
EXECSTRING(_PROTVAL[4+_I3+_I1])
ENDIF
_I1=_I1+1 _LSP=0
ENDWHILE
_END:
RET
_LAB1:
_ANZSP=1
WHILE _ANZSP<=(NUMBER(S_TXT[8])+2)
_STRL=STRLEN(_STRX)
_IDX=MATCH(_STRX,",")
IF _IDX>=0
_STR[_ANZSP]=(SUBSTR(_STRX,0,_IDX))
_STRX=(SUBSTR(_STRX,_IDX+1))
ELSE
_STR[_ANZSP]=(SUBSTR(_STRX,_IDX+1))
GOTOF _NEXT
ENDIF
IF (STRLEN(_STR[_ANZSP])==0)
_SP[_ANZSP]=_LEERSP
ELSE
IF _ANZSP>1
_STR[_ANZSP]=","<<_STR[_ANZSP]
IF (_MM_ANG=="deg")
_SP[_ANZSP]=<<S_TXT[79]
ELSE
_SP[_ANZSP]=<<S_TXT[7]
ENDIF
ENDIF
ENDIF
IF (STRLEN(_STR[_ANZSP])==0) AND (_ANZSP==2)
_LSP=2
ENDIF
_ANZSP=_ANZSP+1
ENDWHILE
_NEXT:
IF (_ANZSP>(NUMBER(S_TXT[8])+2)) GOTOF _FEHL1
IF (_ANZSP<(NUMBER(S_TXT[8])+2))
_MAX=NUMBER(S_TXT[9])+_PROTFORM[5]+(STRLEN(S_TXT[4]))
_I=2
ELSE
_MAX=NUMBER(S_TXT[9])
IF (STRLEN(_STR[2])>0)
_I=2
ELSE
_I=3
ENDIF
ENDIF
_STR1=""
WHILE _I<=_ANZSP-1
_STR1=_STR1<<_STR[_I]
_I=_I+1
ENDWHILE
_MM=_STR[_ANZSP]
_I=0
_LAB1E:
RET
_FEHL1:
N615201 SETAL(61019,"(S_TXT[8],_PROTVAL)")
RET
_FEHL2:
N615202 SETAL(61019,"(S_TXT[62])")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE153_SPF
PROC CYCLE153 SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.64.00 ;DATE: 2016-01-19
;Cycle support HMIsl
;Report measuring results - Formatting text
DEF INT _I1,_ZE,_ANZ_LEZ
DEF STRING[80] _BEZ,_LEER
_ZE=NUMBER(S_TXT[34])
EXECSTRING("_BEZ="<<S_TXT[32]<<S_TXT[33])
_ANZ_LEZ=_ZE-(STRLEN(_BEZ))
IF (_ANZ_LEZ>=0)
IF (_ANZ_LEZ==0)
_LEER=""
ELSE
_I1=1 _LEER=""
WHILE (_ANZ_LEZ>=_I1)
_LEER=_LEER<<" "
_I1=_I1+1
ENDWHILE
ENDIF
_BEZ=_BEZ<<_LEER
ELSE
_BEZ=SUBSTR(_BEZ,0,NUMBER(S_TXT[34]))
ENDIF
EXECSTRING(S_TXT[32]<<S_TXT[33]<<"="<<"_BEZ")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE154_SPF
PROC CYCLE154 SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.64.00 ;DATE: 2016-01-19
;Cycle support HMIsl
;Report measuring results - Basic settings
DEF INT _MESSAX_NO,_OFFSETAX_NO,_IDX
DEF STRING[16] _GEOAX1,_GEOAX2,_GEOAX3,_MESSAX,_OFFSETAX
DEF STRING[12] _LEER12
DEF STRING[4] _LEER4
_LEER12="            "
_LEER4="    "
_HEADLINE[0]=""
_HEADLINE[8]=REP("")
_PROTVAL[0]=REP("",25)
S_TXT[3]=REP("",3)
S_TXT[7]=REP("",103)
_PROTNAME[1]=$P_PATH[0]<<$P_PROG[0]
IF _OVI[3]<0
S_TXT[68]="_MVAR"
ELSE
S_TXT[68]="S_MVAR"
ENDIF
_MESSAX_NO=_MA _DEC1
_OFFSETAX_NO=_MA _DEC3
IF (_PROTFORM[3]==2) AND (S_PROTSTAT[0]==1)
IF STRLEN(_PROTVAL[29])<4 GOTOF _FEHL1
_IDX=NUMBER(SUBSTR(_PROTVAL[29],2,2))
IF (_IDX==17) OR (_IDX==18) OR (_IDX==19)
_IDX=_IDX-16
G[6]=_IDX
ELSE
GOTOF _FEHL1
ENDIF
ENDIF
_IDX=0
IF $P_GG[6]==1
_GEOAX1=AXSTRING($P_AXN1) _GEOAX3=AXSTRING($P_AXN3)
IF ISAXIS(2)
_GEOAX2=AXSTRING($P_AXN2)
ENDIF
ELSE
IF $P_GG[6]==2
_GEOAX1=AXSTRING($P_AXN1) _GEOAX2=AXSTRING($P_AXN2)
IF ISAXIS(2)
_GEOAX3=AXSTRING($P_AXN3)
ENDIF
ELSE
_GEOAX2=AXSTRING($P_AXN2) _GEOAX3=AXSTRING($P_AXN3)
IF ISAXIS(2)
_GEOAX1=AXSTRING($P_AXN1)
ENDIF
ENDIF
ENDIF
IF (_MESSAX_NO==1)
_MESSAX=AXSTRING($P_AXN1)
ENDIF
IF (_MESSAX_NO==2)
_MESSAX=AXSTRING($P_AXN2)
ENDIF
IF (_MESSAX_NO==3)
_MESSAX=AXSTRING($P_AXN3)
ENDIF
IF (_OFFSETAX_NO==1)
_OFFSETAX=AXSTRING($P_AXN1)
ENDIF
IF (_OFFSETAX_NO==2)
_OFFSETAX=AXSTRING($P_AXN2)
ENDIF
IF (_OFFSETAX_NO==3)
_OFFSETAX=AXSTRING($P_AXN3)
ENDIF
_GEOAX1=SUBSTR(_GEOAX1,0,12)
_GEOAX2=SUBSTR(_GEOAX2,0,12)
_GEOAX3=SUBSTR(_GEOAX3,0,12)
_MESSAX=SUBSTR(_MESSAX,0,12)
_OFFSETAX=SUBSTR(_OFFSETAX,0,12)
S_TXT[11]=SET(_GEOAX1,_GEOAX2,_GEOAX3,_MESSAX,_OFFSETAX)
S_TXT[25]=<<$P_GG[6]
RET
_FEHL1: STOPRE
N615090 SETAL(61019,"(_PROTVAL[29]="<<_PROTVAL[29]<<")")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE155_SPF
PROC CYCLE155 SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.010 ;DATE: 2024-05-29
;Report measuring results - Read correction values
DEF STRING[100] _STRINGVAR[5],_STR_WEAR,_STR_GEO,_STR_TT
DEF STRING[49] _GGWO
DEF STRING[30] _BEZ1,_LEER17,_LEER,_D_BEZ,_TXTCOR,_STR1,_BLKSP1,_BLKSP,_GEO_RAD_DIA,_WEAR_RAD_DIA
DEF STRING[40] _T_BEZ
DEF STRING[12] _STR2,_STR3,_STR5,_LEER12,_TYPE_BEZ,_GEO1,_GEO2,_GEO3,_GEOAX1,_GEOAX2,_GEOAX3,_STR6,_STR7,_ST_BEZ
DEF STRING[14]_BEZ2,_BEZ3,_BEZ4,_NOSE_BEZ
DEF STRING[5] _MM,_MMM,_LEER4,_S1,_S2,_S3,_S11,_SB[3]
DEF STRING[14] _LEER14
DEF INT _STRL,_I,_I1,_I2,_I3,_TOOLTYPE,_I_MAX,_MVAR1,_MVAR2,_MVAR3,_MVAR4,_MVAR5,_MVAR6,_MVAR7,_MVAR8,_J,_RADDIAM=0
DEF REAL _CROT,_CTRANS,_CFINE,_TOOLGEO,_TOOLWEAR,_NUM_STR3
DEF REAL _NUM_GEO,_NUM_WEAR
DEF INT _IDX,_IDX1,_IDX2,_IDX3,_IDX4,_IDX6,_NOSE,_DL_NUM1,_DL_NUM2,_GG08
DEF STRING[30] _INFO[7],_STR4,_STR41
DEF STRING[60] _LEN[4]
DEF STRING[18] _LEN1[4],_LEN2[4]
DEF INT _RES,_MIJRA
DEF REAL _MATRIX[3,3],_SS[3],_AX,_AY,_AZ,_KW1,_KW2,_FAK1=1
_STRINGVAR[0]=REP("")
_STRINGVAR[0]=_PROTVAL[25]
_STRINGVAR[1]=_PROTVAL[26]
_STRINGVAR[2]=_PROTVAL[27]
_STRINGVAR[3]=_PROTVAL[28]
_STRINGVAR[4]=_PROTVAL[29]
_MVAR1=_MVAR _DEC1
_MVAR2=_MVAR _DEC2
_MVAR3=_MVAR _DEC3
_MVAR4=_MVAR _DEC4
_MVAR5=_MVAR _DEC5
_MVAR6=_MVAR _DEC6
_MVAR7=_MVAR _DEC7
_MVAR8=_MVAR _DEC8
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000')
_GEO_RAD_DIA="Diameter"
ELSE
_GEO_RAD_DIA="Radius"
ENDIF
IF ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000000000')
_WEAR_RAD_DIA="Diameter"
ELSE
_WEAR_RAD_DIA="Radius"
ENDIF
IF (($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000') AND NOT($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000000000'))
_RADDIAM=1
ENDIF
IF (NOT($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000') AND ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000000000'))
_RADDIAM=2
ENDIF
WHILE _I<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
_I=_I+1
ENDWHILE
_I=0
_I1=NUMBER(S_TXT[9])
_I1=_I1+STRLEN(S_TXT[4])-17
IF (_I1>0)
WHILE _I<_I1
_BLKSP=_BLKSP<<" "
_I=_I+1
ENDWHILE
ENDIF
_S1=S_TXT[4] _S2=S_TXT[4] _S3=S_TXT[4]
_I=1
WHILE _I<STRLEN(_S1)
_S11=_S11<<" "
_I=_I+1
ENDWHILE
_SB[0]=_S11<<"<"
_SB[1]=_SB[0] _SB[2]=_SB[0]
_I=0
_LEER4="    "
_LEER12="            "
_LEER14=SPRINT(S_TXT[10],_LEER14)
_LEER17="                 "
S_TXT[22]="" S_TXT[23]="" S_TXT[24]=""
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
_BEZ4=SPRINT(S_TXT[10],_BEZ4)
S_TXT[70]=S_TXT[7]
_RES=NUMBER(S_TXT[64]) _MM=S_TXT[3]
IF S_TXT[71]==""
_FAK1=1
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
_RES=$MNS_DISP_RES_MM
_MM="mm"
ELSE
_RES=$MNS_DISP_RES_INCH
_MM="in"
ENDIF
ELSE
IF($P_GG[13]==3)
_RES=$MNS_DISP_RES_INCH
_MM="in"
ELSE
_RES=$MNS_DISP_RES_MM
_MM="mm"
ENDIF
ENDIF
IF S_TXT[71]=="1"
IF($P_GG[13]<3)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
_RES=$MNS_DISP_RES_INCH
_MM="in"
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
_RES=$MNS_DISP_RES_MM
_MM="mm"
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
ENDIF
IF S_TXT[71]=="2"
IF($P_GG[13]>2)
_FAK1=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK1=$MN_SCALING_VALUE_INCH
_RES=$MNS_DISP_RES_MM
_MM="mm"
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK1=1/$MN_SCALING_VALUE_INCH
_RES=$MNS_DISP_RES_INCH
_MM="in"
ENDIF
ENDIF
ELSE
_FAK1=1
ENDIF
ENDIF
S_TXT[7]="%"<<_PROTFORM[5]<<"."<<_RES<<"F"
_J=0 _I=0
_INFO[0]=_STRINGVAR[4]
WHILE _J<=5
_STRL=STRLEN(_INFO[0])
_IDX=MATCH(_INFO[0],",")
IF _IDX>=0
_INFO[_J+1]=(SUBSTR(_INFO[0],0,_IDX))
_INFO[0]=(SUBSTR(_INFO[0],_IDX+1))
ELSE
_INFO[_J+1]=(SUBSTR(_INFO[0],_IDX+1))
GOTOF _NEXT
ENDIF
_J=_J+1
ENDWHILE
_NEXT:
IF ((_STRINGVAR[0]=="")AND(_STRINGVAR[1]=="")AND(_STRINGVAR[2]=="")AND(_STRINGVAR[3]==""))
IF (_OVI[2]<>971) AND (_OVI[2]<>982) AND (_OVI[2]<>973) AND (_OVI[2]<>976)
IF (_KNUM==0) GOTOF _MA5
IF ((_INFO[1]=="P") OR (_INFO[1]=="T"))
REPEAT _LAB9 _LAB9_E
GOTOF _MA5
ENDIF
ENDIF
ENDIF
IF (_OVI[2]==977) OR (_OVI[2]==978)
IF (_INFO[1]=="P") AND (_INFO[5]=="") AND (S_TXT[14]<>"")
_INFO[4]="1" _INFO[5]=S_TXT[14]
ENDIF
ENDIF
_GEO1=$MC_AXCONF_GEOAX_NAME_TAB[0]
_GEO2=$MC_AXCONF_GEOAX_NAME_TAB[1]
_GEO3=$MC_AXCONF_GEOAX_NAME_TAB[2]
IF _INFO[2]=="17"
_GEOAX1=_GEO1 _GEOAX2=_GEO2 _GEOAX3=_GEO3
ENDIF
IF _INFO[2]=="18"
_GEOAX1=_GEO3 _GEOAX2=_GEO1 _GEOAX3=_GEO2
ENDIF
IF _INFO[2]=="19"
_GEOAX1=_GEO2 _GEOAX2=_GEO3 _GEOAX3=_GEO1
ENDIF
IF ($P_PROG[$P_STACK-2]=="_N_E_PRT_JOG_SPF")
IF _INFO[1]=="P"
IF (_INFO[4]=="1") AND (_INFO[5]<>_GEOAX1) AND (_INFO[5]<>_GEOAX2) AND (_INFO[5]<>_GEOAX3)
_MIJRA=1 _MM="deg" _SB[0]=_S1 _SB[1]=_S1 _SB[2]=_S1
ENDIF
ENDIF
ENDIF
_LAB9:
IF (_INFO[1]=="T") AND (_OVR[8]>_OVR[12])
S_TXT[38]=SPRINT(S_TXT[37],_OVR[8])
IF _OVR[8]>=0
_I=RINDEX(S_TXT[38]," ")
_STR6=SUBSTR(S_TXT[38],0,_I)
_STR7=SUBSTR(S_TXT[38],_I+1)
S_TXT[38]=<<_STR6<<"+"<<_STR7
ENDIF
IF (_OVI[2]==977) OR (_OVI[2]==978) OR (_OVI[2]==979) OR (_OVI[2]==974) OR (_OVI[2]==994)
_BEZ1="Tolerance"
REPEAT _LAB1 _ENDLAB1
_PROTVAL[9]=SPRINT(_BEZ1<<S_TXT[4]<<"  "<<S_TXT[38]<<S_TXT[4]<<_LEER14<<S_TXT[4]<<_LEER14<<S_TXT[4]<<S_TXT[3])
_PROTVAL[10]=SPRINT(_BLKSP1<<S_TXT[4]<<S_TXT[70]<<S_TXT[4]<<_LEER14<<S_TXT[4]<<_LEER14<<S_TXT[4]<<S_TXT[3],_OVR[12])
IF ((_OVR[16]>_OVR[8]) OR (_OVR[16]<_OVR[12]))
S_TXT[27]=S_TXT[30]
ELSE
S_TXT[27]=S_TXT[29]
ENDIF
IF (_OVI[2]==977) AND ((_MVAR1==5) OR (_MVAR1==6)) AND (_MVAR3==0)
IF ((_OVR[17]>_OVR[8]) OR (_OVR[17]<_OVR[12]))
S_TXT[28]=S_TXT[30]
ELSE
S_TXT[28]=S_TXT[29]
ENDIF
ENDIF
ENDIF
ELSE
S_TXT[26]="Not used"
ENDIF
_LAB9_E:
IF (_MIJRA>0) GOTOF _MA5
IF ((_KNUM) AND (_INFO[1]=="P") AND (_OVI[2]<>961) AND (_OVI[2]<>998) AND (_OVI[2]<>997))
_I=0 _J=0 _IDX=0
WHILE (_I<3) AND (_J<3)
IF _J==0
_IDX=MATCH(_PROTVAL[25+_I],_GEO1)
ELSE
IF _J==1
_IDX=MATCH(_PROTVAL[25+_I],_GEO2)
ELSE
_IDX=MATCH(_PROTVAL[25+_I],_GEO3)
ENDIF
ENDIF
IF _IDX>=0
_STRINGVAR[_J]=_PROTVAL[25+_I]
_I=-1 _J=_J+1
ENDIF
_I=_I+1
ENDWHILE
_I=0 _J=0 _IDX=0
_STRL=STRLEN(_STRINGVAR[0])
IF ((SUBSTR(_STRINGVAR[0],_STRL-3,2))<>("RT")) AND ((SUBSTR(_STRINGVAR[0],0,8))<>("$P_CHBFR"))
_STR1=SUBSTR(_STRINGVAR[0],0,_STRL-3)<<"RT]"
_STR1="_AX="<<_STR1
EXECSTRING(_STR1)
_STR1=SUBSTR(_STRINGVAR[1],0,_STRL-3)<<"RT]"
_STR1="_AY="<<_STR1
EXECSTRING(_STR1)
_STR1=SUBSTR(_STRINGVAR[2],0,_STRL-3)<<"RT]"
_STR1="_AZ="<<_STR1
EXECSTRING(_STR1)
ENDIF
IF ((SUBSTR(_STRINGVAR[0],0,8))==("$P_CHBFR"))
_AX=$P_ACTFRAME[AXNAME(_GEO1),RT]
_AY=$P_ACTFRAME[AXNAME(_GEO2),RT]
_AZ=$P_ACTFRAME[AXNAME(_GEO3),RT]
ENDIF
_AX=-_AX _AY=-_AY _AZ=-_AZ
_MATRIX[0,0]=COS(_AY)*COS(_AZ)
_MATRIX[0,1]=-COS(_AY)*SIN(_AZ)
_MATRIX[0,2]=SIN(_AY)
_MATRIX[1,0]=(COS(_AX)*SIN(_AZ))+(SIN(_AX)*SIN(_AY)*COS(_AZ))
_MATRIX[1,1]=(COS(_AX)*COS(_AZ))-(SIN(_AX)*SIN(_AY)*SIN(_AZ))
_MATRIX[1,2]=-SIN(_AX)*COS(_AY)
_MATRIX[2,0]=(SIN(_Ax)*SIN(_AZ))-(COS(_AX)*SIN(_AY)*COS(_AZ))
_MATRIX[2,1]=(SIN(_AX)*COS(_AZ))+(COS(_AX)*SIN(_AY)*SIN(_AZ))
_MATRIX[2,2]=COS(_AX)*COS(_AY)
IF (_INFO[4]=="1")
_KW1=_OVR[16]
_I=0
_SS[0]=0 _SS[1]=0 _SS[2]=0
WHILE _I<=2
_IDX=MATCH(_STRINGVAR[_I],_INFO[5])
IF _IDX>0
_SS[_I]=1*_KW1
ENDIF
_I=_I+1
ENDWHILE
ENDIF
IF _INFO[4]
IF (_INFO[4]=="2")
IF _OVI[2]==977
IF _MVAR1<3
_KW1=_OVR[17] _KW2=_OVR[18]
ENDIF
IF _MVAR1>4
_KW1=_OVR[18] _KW2=_OVR[19]
ENDIF
ENDIF
IF _OVI[2]==979
_KW1=_OVR[17] _KW2=_OVR[18]
ENDIF
IF _INFO[2]=="17"
_SS[0]=1*_KW1 _SS[1]=1*_KW2 _SS[2]=0
ENDIF
IF _INFO[2]=="18"
_SS[0]=1*_KW2 _SS[1]=0 _SS[2]=1*_KW1
ENDIF
IF _INFO[2]=="19"
_SS[0]=0 _SS[1]=1*_KW1 _SS[2]=1*_KW2
ENDIF
ENDIF
ENDIF
_MATRIX[0,0]=_MATRIX[0,0]*_SS[0]
_MATRIX[0,1]=_MATRIX[0,1]*_SS[0]
_MATRIX[0,2]=_MATRIX[0,2]*_SS[0]
_MATRIX[1,0]=_MATRIX[1,0]*_SS[1]
_MATRIX[1,1]=_MATRIX[1,1]*_SS[1]
_MATRIX[1,2]=_MATRIX[1,2]*_SS[1]
_MATRIX[2,0]=_MATRIX[2,0]*_SS[2]
_MATRIX[2,1]=_MATRIX[2,1]*_SS[2]
_MATRIX[2,2]=_MATRIX[2,2]*_SS[2]
_I=0 _J=0
WHILE (_I<3) AND (_J<3)
IF ABS(_MATRIX[_I,_J]<>1)
_MATRIX[_I,_J]=(ROUND(_MATRIX[_I,_J]*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
ENDIF
_J=_J+1
IF (_J==3)
_J=0 _I=_I+1
ENDIF
ENDWHILE
_I=0 _J=0
WHILE (_I<=2)
_SS[_I]=_MATRIX[0,_I]+_MATRIX[1,_I]+_MATRIX[2,_I]
IF ABS(_SS[_I]<>1)
_SS[_I]=(ROUND(_SS[_I]*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
ENDIF
IF ($P_PROG[$P_STACK-1]=="_N_CYCLE151_SPF")
IF ((_INFO[1]=="P") AND (_OVI[2]<>961) AND (_OVI[2]<>998) AND (_OVI[2]<>997))
_SB[_I]=_S11<<"<"
IF (_SS[_I]==0)
_SB[_I]=_S1
ENDIF
ENDIF
ELSE
_SB[_I]=_S1
ENDIF
_I=_I+1
ENDWHILE
_I=0 _STRL=0 _STR1="" _STR2="" _STR3=""
ENDIF
IF ((_INFO[1]=="P") AND (_OVI[2]==961))
IF SUBSTR(_STRINGVAR[0],0,8)=="$P_SETFR"
_STR1=SUBSTR(_STRINGVAR[0],0,9)
_STRINGVAR[0]=_STR1<<","<<SUBSTR(_STRINGVAR[0],9)
ENDIF
_IDX=MATCH(_STRINGVAR[0],",,")
_STRL=STRLEN(_STRINGVAR[0])
_STR1=(SUBSTR(_STRINGVAR[0],0,_IDX))
_STR2=(SUBSTR(_STRINGVAR[0],_IDX+2))
_STRINGVAR[0]=_STR1<<","<<_GEOAX1<<","<<_STR2
IF _INFO[4]=="2"
_STRINGVAR[1]=_STR1<<","<<_GEOAX2<<","<<_STR2
ENDIF
_STRINGVAR[2]=_STR1<<","<<_GEOAX3<<",RT]"
_STRINGVAR[3]=""
_INFO[4]="3"
ENDIF
IF (_INFO[1]=="P") AND (_OVI[2]==998) AND (_MVAR1==5)
_STRL=STRLEN(_STRINGVAR[0])
_IDX=MATCH(_STRINGVAR[0],",")
IF ((_INFO[4]=="1") AND (SUBSTR(_STRINGVAR[0],_STRL-3,2)=="RT"))
_SB[0]=S_TXT[4] _SB[1]=S_TXT[4] _SB[2]=_SB[2]
_STR1=(SUBSTR(_STRINGVAR[0],0,_IDX))
_I=RINDEX(_STRINGVAR[0],",")
_STR2=(SUBSTR(_STRINGVAR[0],_I+1))
_STRINGVAR[0]=_STR1<<","<<_GEOAX1<<","<<_STR2
_STRINGVAR[1]=_STR1<<","<<_GEOAX2<<","<<_STR2
IF _INFO[5]==_GEOAX3
_STRINGVAR[2]=_STR1<<","<<_GEOAX3<<","<<_STR2
ENDIF
ENDIF
_I=0
ENDIF
IF ((_OVI[2]==997)AND (_KNUM<>0))
IF (_MVAR==10109) OR (_MVAR==11109)
_HEADLINE[14]="Correction into: "<<_BLKSP<<"Work offset, output not supported"
GOTOF _MA1
ENDIF
ENDIF
IF (_INFO[1]=="T") AND (_OVI[2]<>971)
_I=0
WHILE _I<=3
IF _STRINGVAR[_I]
_STRL=STRLEN(_STRINGVAR[_I])
_IDX1=MATCH(_STRINGVAR[_I],"],")
IF (_IDX1==-1)
IF (SUBSTR(_STRINGVAR[_I],0,1)<>"$")
_LEN[_I]=_STRINGVAR[_I]
ENDIF
ELSE
_LEN[_I]=(SUBSTR(_STRINGVAR[_I],_IDX1+2,_STRL))
ENDIF
ENDIF
_I=_I+1
ENDWHILE
_I=0
WHILE _I<=3
IF _LEN[_I]
_STRL=STRLEN(_LEN[_I])
_IDX1=MATCH(_LEN[_I],",")
IF (_IDX1==-1)
_LEN1[_I]=SUBSTR(_LEN[_I],0,_STRL)
ELSE
IF (_IDX1<=14)
_LEN1[_I]=(SUBSTR(_LEN[_I],0,_IDX1))
ELSE
_LEN1[_I]=(SUBSTR(_LEN[_I],0,_STRL))
ENDIF
_LEN2[_I]=(SUBSTR(_LEN[_I],_IDX1+1,_STRL))
ENDIF
ENDIF
IF _LEN1[_I]
_LEN1[_I]=<<(ROUND((NUMBER(_LEN1[_I]))*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
ENDIF
IF _LEN2[_I]
_LEN2[_I]=<<(ROUND((NUMBER(_LEN2[_I]))*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
ENDIF
_I=_I+1
ENDWHILE
ENDIF
IF ((_INFO[1]=="P") AND (_OVI[2]==998) AND (_RA>0))
_MM="deg"
ENDIF
_MA5:
IF (_OVI[2]==976) OR (_OVI[2]==973) GOTOF _MA4
IF ((_OVI[2]==971) OR (_OVI[2]==982)) GOTOF _MA4
IF (_KNUM==0)
IF ((_STRINGVAR[0]=="")AND(_STRINGVAR[1]=="")AND(_STRINGVAR[2]=="")AND(_STRINGVAR[3]==""))
_HEADLINE[14]="Measure only   :"
GOTOF _MA1
ENDIF
ENDIF
_MA4:
_I2=_OVI[8] _I3=_OVI[0]
IF (_OVI[8]>0) AND (_OVI[0]>0)
_T_BEZ="T="<<$TC_TP2[_OVI[8]]
_D_BEZ="D"<<_OVI[0]
IF ((_STRINGVAR[0]=="")AND(_STRINGVAR[1]=="")AND(_STRINGVAR[2]=="")AND(_STRINGVAR[3]==""))
IF ($MN_MM_TYPE_OF_CUTTING_EDGE==0)
_TOOLTYPE=$TC_DP1[_I2,_I3]
_NOSE=$TC_DP2[_I2,_I3]
ELSE
_TOOLTYPE=$TC_DP1[_I3]
_NOSE=$TC_DP2[_I3]
ENDIF
_TYPE_BEZ=", TYPE "<<_TOOLTYPE
_NOSE_BEZ=", Nose pos."<<_NOSE
ENDIF
ENDIF
IF (NOT((_OVI[2]==982) AND (_MVAR1==0))) AND (NOT((_OVI[2]==971) AND (_MVAR1==0)))
IF ((_STRINGVAR[0]=="")AND(_STRINGVAR[1]=="")AND(_STRINGVAR[2]=="")AND(_STRINGVAR[3]==""))
IF (_INFO[1]=="P")
_HEADLINE[14]="Correction into: "<<_BLKSP<<"Work offset, not corrected"
ELSE
IF (_INFO[1]=="T")
_HEADLINE[14]="Correction into: "<<_BLKSP<<"Tool offset, not corrected"
_HEADLINE[15]=<<_LEER17<<_BLKSP<<_T_BEZ<<", D"<<_I3<<_TYPE_BEZ<<_NOSE_BEZ
ENDIF
ENDIF
IF _OVI[9]>0
_HEADLINE[14]=_HEADLINE[14]<<", Alarm "<<_OVI[9]
ENDIF
IF ((_OVI[2]==976) OR (_OVI[2]==973))
_TOOLTYPE=$P_ADT[1]
_TYPE_BEZ=", TYPE "<<_TOOLTYPE
_NOSE=$P_ADT[2]
_NOSE_BEZ=", Nose pos."<<_NOSE
_I2=$P_TOOLNO
_I3=$P_TOOL
_T_BEZ="T="<<$TC_TP2[_I2]
_HEADLINE[15]="L"
GOTOF _MA1
ENDIF
GOTOF _END
ENDIF
ENDIF
_I_MAX=3 _I=0 _J=0
WHILE _I<=_I_MAX
IF (SUBSTR(_STRINGVAR[_I],0,1)=="$")
_J=_J+1
_STRL=STRLEN(_STRINGVAR[_I])
_IDX1=MATCH(_STRINGVAR[_I],"_")
_IDX2=MATCH(_STRINGVAR[_I],"[")
_STR1=(SUBSTR(_STRINGVAR[_I],0,_IDX1))
_STR2=(SUBSTR(_STRINGVAR[_I],_IDX1,_IDX2-_IDX1))
IF (_STR1=="$P") AND (_STR2<>"_ADT")
_IDX3=MATCH(_STRINGVAR[_I],",")
_IDX4=RINDEX(_STRINGVAR[_I],",")
_STR3=(SUBSTR(_STRINGVAR[_I],_IDX2+1,_IDX3-_IDX2-1))
IF (_IDX3<_IDX4)
_STR4=(SUBSTR(_STRINGVAR[_I],_IDX3+1,_STRL-4-_IDX3-1))
ELSE
_STR4=_STR3
_STR3=""
ENDIF
ENDIF
IF (_STR2=="_UIFR")OR(_STR2=="_CHBFR")OR(_STR2=="_SETFR")OR(_STR2=="_NCBFR")
_STR5=(SUBSTR(_STRINGVAR[_I],_IDX4+1,(_STRL-1)-_IDX4-1))
IF _OVI[2]==997
_IDX6=RINDEX(_STR4,",")
IF _IDX6>0
_STR6=_STR5
_STR5=SUBSTR(_STR4,_IDX6+1,2)
_STR4=SUBSTR(_STR4,0,_IDX6)
IF (_STR5=="TR") OR (_STR5=="FI")
_STR6=(SUBSTR(_STRINGVAR[_I],_IDX4+1,(_STRL-1)-_IDX4-1))
ENDIF
ENDIF
ELSE
_STR5=(SUBSTR(_STRINGVAR[_I],_IDX4+1,(_STRL-1)-_IDX4-1))
_STR6=""
ENDIF
IF STRLEN(_STR3)>0
_GG08=NUMBER(_STR3)
ENDIF
IF ((_KNUM==9999) OR (_KNUM<=99))
IF (_STR2=="_UIFR")
IF (_GG08>0) AND (_GG08<5)
_GGWO="G"<<(53+_GG08)
ELSE
_GGWO="G"<<500+_GG08
ENDIF
ENDIF
IF (_STR2=="_CHBFR")
_GGWO="G500, "<<(_GG08+1)<<".Channel basic WO (CHBFR["<<_GG08<<"])"
ENDIF
ENDIF
IF (_KNUM==9999)
_GGWO="active "<<_GGWO
ENDIF
IF ((_STR2=="_UIFR") AND (_KNUM<=99))
_GGWO=<<_GGWO
ENDIF
IF _STR2=="_SETFR"
_GGWO="Basic reference (SETFR)"
ENDIF
IF _STR2=="_NCBFR"
_GGWO=<<(_GG08+1)<<".Global basic WO (NCBFR["<<(_GG08)<<"])"
ENDIF
IF _STR2=="_CHBFR"
_GGWO=<<(_GG08+1)<<".Channel basic WO (CHBFR["<<(_GG08)<<"])"
ENDIF
IF STRLEN(_STR3)>0
_STR_TT=<<_STR1<<_STR2<<"["<<_STR3<<","<<_STR4
ELSE
_STR_TT=<<_STR1<<_STR2<<"["<<_STR4
ENDIF
_BEZ1=_STR4
REPEAT _LAB1 _ENDLAB1
REPEAT _LAB4 _ENDLAB4
GOTOF _MA2
ENDIF
IF (_STR1=="$P") AND (_STR2=="_ADT")
_IDX3=MATCH(_STRINGVAR[_I],"]")
_STR3=(SUBSTR(_STRINGVAR[_I],_IDX2,_IDX3-_IDX2+1))
_NUM_STR3=NUMBER(SUBSTR(_STRINGVAR[_I],_IDX2+1,_IDX3-_IDX2-1))
_STR4=""
REPEAT _LAB5 _ENDLAB5
ENDIF
IF (_STR1=="$TC")
_IDX3=_IDX2
_IDX2=MATCH(_STRINGVAR[_I],"P")
_IDX4=MATCH(_STRINGVAR[_I],"]")
_STR2=(SUBSTR(_STRINGVAR[_I],_IDX1,(_IDX2-_IDX1)+1))
_STR3=(SUBSTR(_STRINGVAR[_I],(_IDX2)+1,(_IDX3-_IDX2)-1))
_STR4=(SUBSTR(_STRINGVAR[_I],_IDX3,_IDX4+1-_IDX3))
_NUM_STR3=NUMBER(_STR3)
IF (_STR2=="_DP")
REPEAT _LAB6 _ENDLAB6
ENDIF
IF ((_STR2=="_ECP") OR (_STR2=="_SCP"))
_DL_NUM1=_NUM_STR3 _DEC1
_DL_NUM2=_NUM_STR3 _DEC2
S_TXT[21]=", DL="<<_DL_NUM2
IF (_STR2=="_ECP")
S_TXT[43]="Setup offset"
ENDIF
IF (_STR2=="_SCP")
S_TXT[43]="Total offset"
ENDIF
IF (_DL_NUM1==6)
_J=0 _I=3
ELSE
S_TXT[20]=", Length "<<_DL_NUM1-2
_J=0 _I=0
ENDIF
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
_MA3:
IF ((_I<=3) AND (_J<=2))
_NUM_GEO=10*_DL_NUM2+3+_I _NUM_WEAR=10*_DL_NUM2+3+_I
_STR_GEO=<<_STR1<<"_ECP"<<_NUM_GEO<<_STR4
_STR_WEAR=<<_STR1<<"_SCP"<<_NUM_WEAR<<_STR4
IF (_STR2=="_SCP")
_BEZ2="Setup offset"
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
IF ($MN_MM_KIND_OF_SUMCORR B_AND 'B10000')
_BEZ3="Total offset"
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
EXECSTRING("_TOOLGEO="<<_STR_GEO)
ENDIF
EXECSTRING("_TOOLWEAR="<<_STR_WEAR)
IF ISNUMBER(_LEN[_I])
IF ((ROUND(_TOOLWEAR*1000000)/1000000) <> ROUND(NUMBER(_LEN[_I])*1000000)/1000000)
REPEAT _LAB8 _ENDLAB8
ENDIF
ENDIF
ENDIF
IF (_STR2=="_ECP")
_BEZ2="Setup offset"
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3="Total offset"
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
EXECSTRING("_TOOLGEO="<<_STR_GEO)
EXECSTRING("_TOOLWEAR="<<_STR_WEAR)
IF ISNUMBER(_LEN[_I])
IF ((ROUND(_TOOLGEO*1000000)/1000000) <> ROUND(NUMBER(_LEN[_I])*1000000)/1000000)
REPEAT _LAB8 _ENDLAB8
ENDIF
ENDIF
ENDIF
IF ((_NUM_GEO _DEC1)<6)
_I=_I+1
GOTOB _MA3
ENDIF
ENDIF
ENDIF
ENDIF
_MA2:
ENDIF
_I=_I+1
ENDWHILE
IF _J>0
_PROTVAL[0]=_BLKSP1<<S_TXT[4] <<_BEZ2<<S_TXT[4]<<_BEZ3<<S_TXT[4]<<_BEZ4<<S_TXT[4]<<_LEER4
ENDIF
IF (_STR2=="_ADT")
_TOOLTYPE=$P_ADT[1]
_TYPE_BEZ=", Type "<<_TOOLTYPE
_NOSE=$P_ADT[2]
_NOSE_BEZ=", Nose pos. "<<_NOSE
_I2=$P_TOOLNO
_I3=$P_TOOL
_T_BEZ="T="<<$TC_TP2[_I2]
ENDIF
IF ((_STR1=="$TC") AND (_INFO[1]=="T"))
_STR41=SUBSTR(_STR4,1,(STRLEN(_STR4)-2))
_IDX=MATCH(_STR41,",")
IF _IDX>0
_I2=NUMBER(SUBSTR(_STR41,0,_IDX))
_I3=NUMBER(SUBSTR(_STR41,_IDX+1))
ELSE
_I2=NUMBER(_STR41)
_I3=_I2
ENDIF
EXECSTRING("_TOOLTYPE=$TC_DP1"<<_STR4)
EXECSTRING("_NOSE=$TC_DP2"<<_STR4)
_TYPE_BEZ=", Type "<<_TOOLTYPE
_NOSE_BEZ=", Nose pos. "<<_NOSE
_T_BEZ="T="<<$TC_TP2[_I2]
_D_BEZ=" D"<<_I3
_ST_BEZ=", ST"<<_OVI[10]
ENDIF
_MA1:
IF (_OVI[2]==971) OR (_OVI[2]==982)
REPEAT _LAB2 _ENDLAB2
IF (_MVAR2==0)
_HEADLINE[13]="Coordinates    : Machine (MCS)"<<", "<<_GGWO
ELSE
_HEADLINE[13]="Coordinates    : Workpiece (WCS)"<<", "<<_GGWO
ENDIF
IF _MVAR1==0
_HEADLINE[14]=""
_HEADLINE[15]=<<_LEER17<<_BLKSP<<_T_BEZ<<", D"<<_I3<<_TYPE_BEZ<<_NOSE_BEZ
_PROTVAL[0]=_BLKSP1<<S_TXT[4]<<"      Tool geo"<<S_TXT[4]<<"     Tool wear"<<S_TXT[4]<<_LEER14<<S_TXT[4]<<_LEER4
_TOOLGEO=$P_ADT[3] _TOOLWEAR=$P_ADT[12]
_BEZ1="Length 1" _I=1
REPEAT _LAB1 _ENDLAB1
REPEAT _LAB3 _ENDLAB3
IF (_OVI[2]==982)
_TOOLGEO=$P_ADT[4] _TOOLWEAR=$P_ADT[13]
_BEZ1="Length 2" _I=_I+1
REPEAT _LAB1 _ENDLAB1
REPEAT _LAB3 _ENDLAB3
ENDIF
_TOOLGEO=$P_ADT[6] _TOOLWEAR=$P_ADT[15]
_BEZ1=_GEO_RAD_DIA _I=_I+1
IF (_RADDIAM > 0)
REPEAT _LAB10 _ENDLAB10
ENDIF
REPEAT _LAB1 _ENDLAB1
REPEAT _LAB3 _ENDLAB3
GOTOF _END
ENDIF
ENDIF
IF (_OVI[2]==976) OR (_OVI[2]==973)
IF (_HEADLINE[15]<>"L")
_HEADLINE[14]="Correction into: "<<_BLKSP<<"Tool offset, "<<S_TXT[43]<<S_TXT[20]<<_TXTCOR
ENDIF
_HEADLINE[15]=<<_LEER17<<_BLKSP<<_T_BEZ<<", D"<<_I3<<_TYPE_BEZ<<_NOSE_BEZ
IF (_OVI[2]==976)
REPEAT _LAB2 _ENDLAB2
IF _GG08==1
_HEADLINE[13]="Coordinates    : Machine (MCS)"<<", "<<_GGWO
ELSE
_HEADLINE[13]="Coordinates    : Workpiece (WCS)"<<", "<<_GGWO
ENDIF
ENDIF
IF (_OVI[2]==973)
REPEAT _LAB2 _ENDLAB2
IF (_MVAR2==1)
_HEADLINE[13]="Coordinates    : Machine (MCS)"<<", "<<_GGWO
ELSE
_HEADLINE[13]="Coordinates    : Workpiece (WCS)"<<", "<<_GGWO
ENDIF
ENDIF
GOTOF _END
ENDIF
IF (_INFO[1]=="P") AND (_KNUM>0)
_HEADLINE[14]="Correction into: "<<_BLKSP<<"Work offset"<<S_TXT[22]<<S_TXT[23]<<S_TXT[24]
_HEADLINE[15]=<<_LEER17<<_BLKSP<<_GGWO
GOTOF _END
ENDIF
IF (((_STR1=="$TC") AND (_OVI[8]>0)) OR (_STR2=="_ADT"))
_HEADLINE[14]="Correction into: "<<_BLKSP<<"Tool offset, "<<S_TXT[43]<<S_TXT[20]<<S_TXT[21]
IF (_OVI[10] == 0)
_HEADLINE[15]=<<_LEER17<<_BLKSP<<_T_BEZ<<", D"<<_I3<<_TYPE_BEZ<<_NOSE_BEZ
ELSE
_HEADLINE[15]=<<_LEER17<<_BLKSP<<_T_BEZ<<", D"<<_I3<<_ST_BEZ<<_TYPE_BEZ<<_NOSE_BEZ
ENDIF
ENDIF
_END:
S_TXT[7]=S_TXT[70]
RET
_LAB1:
WHILE STRLEN(_BEZ1)<NUMBER(S_TXT[9])
_BEZ1=_BEZ1<<" "
ENDWHILE
_ENDLAB1:
_LAB2:
IF _INFO[6]<>""
IF (ISNUMBER(_INFO[6]))
IF (NUMBER(_INFO[6])>100) GOTOF _FEHL1
_GG08=NUMBER(_INFO[6])
ENDIF
ELSE
_GG08=$P_GG[8]
ENDIF
IF (_GG08==1)
_GGWO="G500"
ENDIF
IF (_GG08>1) AND (_GG08<6)
_GGWO="G"<<(52+_GG08)
ELSE
_GGWO="G"<<499+_GG08
ENDIF
_ENDLAB2:
_LAB3:
_PROTVAL[_I]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[7]<<_S1<<S_TXT[7]<<_S2<<_LEER14<<S_TXT[4]<<_MM,_TOOLGEO,_TOOLWEAR)
_ENDLAB3:
_LAB4:
IF _STR5=="TR"
S_TXT[22]=", Coarse"
_BEZ2="Coarse"
_BEZ3="Fine"
_S2=S_TXT[4] _S3=S_TXT[4]
_S1=_SB[_I]
_BEZ2=_BEZ2<<" ["<<_MM<<"]"
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=_BEZ3<<" ["<<_MM<<"]"
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
ENDIF
IF _STR5=="FI"
S_TXT[23]=", Fine"
IF ($MN_MM_FRAME_FINE_TRANS==1)
_BEZ3="Fine"
_BEZ2="Coarse"
_S1=S_TXT[4] _S3=S_TXT[4]
IF ((_INFO[5]<>"") AND (_INFO[4]=="1"))
IF (_STR4==_INFO[5])
_S2=_SB[_I]
ELSE
_S2=S_TXT[4]
ENDIF
ELSE
IF ((_STR4==S_TXT[11]) OR (_STR4==S_TXT[12]) OR (_STR4==S_TXT[13]))
_S2=_SB[_I]
ELSE
_S2=S_TXT[4]
ENDIF
ENDIF
_BEZ2=_BEZ2<<" ["<<_MM<<"]"
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=_BEZ3<<" ["<<_MM<<"]"
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
ENDIF
ENDIF
IF (_STR5=="RT")
S_TXT[24]=", Rotation"
_S1=S_TXT[4] _S2=S_TXT[4] _S3=_SB[_I]
_BEZ2="Coarse"
_BEZ3="Fine"
_BEZ2=_BEZ2<<" ["<<_MM<<"]"
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=_BEZ3<<" ["<<_MM<<"]"
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
ENDIF
IF (_OVI[2]==997) AND (_STR6=="RT")
S_TXT[24]=", Rotation"
_S3=_SB[_I]
_BEZ2="Coarse"
_BEZ3="Fine"
_BEZ2=_BEZ2<<" ["<<_MM<<"]"
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=_BEZ3<<" ["<<_MM<<"]"
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
ENDIF
IF (_STR4==_GEOAX1) OR (_STR4==_GEOAX2) OR (_STR4==_GEOAX3)
_BEZ4="Rot [deg]"
_BEZ4=SPRINT(S_TXT[10],_BEZ4)
ENDIF
_MMM="   "
IF (_STR4==_GEOAX1) OR (_STR4==_GEOAX2) OR (_STR4==_GEOAX3)
EXECSTRING("_CTRANS="<<_STR_TT<<",TR]")
EXECSTRING("_CROT="<<_STR_TT<<",RT]")
IF ($MN_MM_FRAME_FINE_TRANS==1)
EXECSTRING("_CFINE="<<_STR_TT<<",FI]")
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[7]<<_S1<<S_TXT[7]<<_S2<<S_TXT[78]<<_S3<<_MMM,_CTRANS,_CFINE,_CROT)
ELSE
IF ABS(_CTRANS<>0)
_CTRANS=(ROUND(_CTRANS*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
ENDIF
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[7]<<_S1<<_LEER14<<_S2<<S_TXT[78]<<_S3<<_MMM,_CTRANS,_CROT)
ENDIF
ELSE
EXECSTRING("_CTRANS="<<_STR_TT<<",TR]")
IF ($MN_MM_FRAME_FINE_TRANS==1)
EXECSTRING("_CFINE="<<_STR_TT<<",FI]")
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[79]<<_S1<<S_TXT[79]<<_S2<<<<_LEER14<<S_TXT[4]<<_MMM,_CTRANS,_CFINE)
ELSE
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[79]<<_S1<<_LEER14<<_S2<<_LEER14<<S_TXT[4]<<_MM,_CTRANS)
ENDIF
ENDIF
_ENDLAB4:
_LAB5:
IF (_NUM_STR3>11)
S_TXT[43]="Wear"
_STR_GEO=<<_STR1<<_STR2<<"["<<_NUM_STR3-9<<"]"<<_STR4
_STR_WEAR=<<_STR1<<_STR2<<_STR3<<_STR4
IF (_NUM_STR3==15)
_BEZ1=_WEAR_RAD_DIA
_RADDIAM=_RADDIAM+10
ELSE
_BEZ1="Length "<<_NUM_STR3-11
ENDIF
ELSE
S_TXT[43]="Geometry"
_STR_GEO=<<_STR1<<_STR2<<_STR3<<_STR4
_STR_WEAR=<<_STR1<<_STR2<<"["<<_NUM_STR3+9<<"]"<<_STR4
IF (_NUM_STR3==6)
_BEZ1=_GEO_RAD_DIA
ELSE
_BEZ1="Length "<<_NUM_STR3-2
ENDIF
ENDIF
EXECSTRING("_TOOLGEO="<<_STR_GEO)
EXECSTRING("_TOOLWEAR="<<_STR_WEAR)
IF ((_RADDIAM > 0) AND ((_NUM_STR3==15)OR(_NUM_STR3==6)))
REPEAT _LAB10 _ENDLAB10
ENDIF
REPEAT _LAB1 _ENDLAB1
_BEZ2="Tool geo" _BEZ3="Tool wear" _BEZ4=""
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
_BEZ4=SPRINT(S_TXT[10],_BEZ4)
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[7]<<_S1<<S_TXT[7]<<_S2<<_LEER14<<S_TXT[4]<<_MM,_TOOLGEO,_TOOLWEAR)
_ENDLAB5:
_LAB6:
IF (_NUM_STR3>11)
S_TXT[43]="Wear"
IF (_NUM_STR3==15)
S_TXT[20]=", "<<_WEAR_RAD_DIA
_RADDIAM=_RADDIAM+10
_J=0 _I=3
ELSE
S_TXT[20]=", Length"<<_NUM_STR3-11
_NUM_STR3=12 _J=0 _I=0
ENDIF
_NUM_GEO=_NUM_STR3-9
_NUM_WEAR=_NUM_STR3
ELSE
S_TXT[43]="Geometry"
IF (_NUM_STR3==6)
S_TXT[20]=", "<<_GEO_RAD_DIA
_J=0 _I=3
ELSE
S_TXT[20]=", Length"<<_NUM_STR3-2
_NUM_STR3=3 _J=0 _I=0
ENDIF
_NUM_GEO=_NUM_STR3
_NUM_WEAR=_NUM_STR3+9
ENDIF
_BEZ2="Tool geo" _BEZ3="Tool wear" _BEZ4=""
_BEZ2=SPRINT(S_TXT[10],_BEZ2)
_BEZ3=SPRINT(S_TXT[10],_BEZ3)
_BEZ4=SPRINT(S_TXT[10],_BEZ4)
_LAB7:
IF ((_I<=3) AND (_J<=2))
_STR_GEO=<<_STR1<<_STR2<<_NUM_GEO<<_STR4
_STR_WEAR=<<_STR1<<_STR2<<_NUM_WEAR<<_STR4
EXECSTRING("_TOOLGEO="<<_STR_GEO)
EXECSTRING("_TOOLWEAR="<<_STR_WEAR)
_TOOLWEAR=(ROUND(_TOOLWEAR*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
_TOOLGEO=(ROUND(_TOOLGEO*_FAK1*EXP(_RES*LN(10)))/EXP(_RES*LN(10)))
IF ((_RADDIAM > 0) AND ((_NUM_STR3==6) OR (_NUM_STR3==15)))
REPEAT _LAB10 _ENDLAB10
ENDIF
IF _LEN1[_I]
IF _NUM_STR3>11
IF (_TOOLWEAR<>NUMBER(_LEN1[_I])) OR (NUMBER(_INFO[5]) == _NUM_WEAR-11)
REPEAT _LAB8 _ENDLAB8
ENDIF
ELSE
IF (_TOOLGEO<>NUMBER(_LEN1[_I])) OR (NUMBER(_INFO[5]) == _NUM_GEO-2)
REPEAT _LAB8 _ENDLAB8
ENDIF
ENDIF
IF (_NUM_GEO<6)
_I=_I+1
_NUM_GEO=_NUM_GEO+1 _NUM_WEAR=_NUM_WEAR+1
GOTOB _LAB7
ENDIF
ENDIF
ENDIF
IF (_I>=3) AND (_J==0)
_TXTCOR=", not corrected"
ENDIF
_ENDLAB6:
_LAB8:
IF (_I==3)
_BEZ1=_GEO_RAD_DIA
ELSE
_BEZ1="Length "<<_I+1
ENDIF
REPEAT _LAB1 _ENDLAB1
_J=_J+1
IF ((_STR2=="_ECP") OR (_STR2=="_SCP"))
IF ($MN_MM_KIND_OF_SUMCORR B_AND 'B10000')
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[7]<<_S1<<S_TXT[7]<<_S2<<_LEER14<<S_TXT[4]<<_MM,_TOOLGEO,_TOOLWEAR)
ELSE
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<_LEER14<<_S1<<S_TXT[7]<<_S2<<_LEER14<<S_TXT[4]<<_MM,_TOOLWEAR)
ENDIF
ELSE
_PROTVAL[_J]=SPRINT(_BEZ1<<S_TXT[4]<<S_TXT[7]<<_S1<<S_TXT[7]<<_S2<<_LEER14<<S_TXT[4]<<_MM,_TOOLGEO,_TOOLWEAR)
ENDIF
_ENDLAB8:
_LAB10:
IF(_RADDIAM==1)
_TOOLWEAR=_TOOLWEAR*2
ENDIF
IF(_RADDIAM==2)
_TOOLWEAR=_TOOLWEAR/2
ENDIF
IF(_RADDIAM==11)
_TOOLWEAR=_TOOLWEAR*2
ENDIF
IF(_RADDIAM==12)
_TOOLWEAR=_TOOLWEAR/2
ENDIF
_ENDLAB10:
_FEHL1: STOPRE
N615501 SETAL(61019,"(_PROTVAL[29]="<<_PROTVAL[29]<<")")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE156_SPF
PROC CYCLE156(INT _MODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.23.00.00.003 ;DATE: 2023-09-08
;Cycle support HMIsl
;Report measuring results - utility cycle: write header
DEF INT _ERROR,_I,_I1,_LOGSIZE
DEF STRING[20] _STR1
DEF STRING[40] _SERR
DEF STRING[200] _ULMW,_BLKSP,_STR2,_STRX
_HEADLINE[0]=SPRINT("%S-%S-%S",""<<2000+$A_YEAR,SUBSTR(""<<100+$A_MONTH,1),SUBSTR(""<<100+$A_DAY,1))
_HEADLINE[0]="Date    : "<<_HEADLINE[0]
_STR1="Time: "<<S_TXT[41]
_I1=_PROTFORM[1]-(STRLEN(_HEADLINE[0]))-(STRLEN(_STR1))-2
_I=1
WHILE _I<=_I1
_BLKSP=_BLKSP<<" "
_I=_I+1
ENDWHILE
IF _PROTFORM[1]<=80
_HEADLINE[0]=_HEADLINE[0]<<_BLKSP<<_STR1
ELSE
_STR2=_HEADLINE[0]<<_BLKSP<<_STR1
ENDIF
_HEADLINE[1]="Protocol: "
_HEADLINE[2]="Program : "
IF (_OVI[2]==995)OR(_OVI[2]==996)OR(_OVI[2]==9960)
_HEADLINE[3]="Machine : "
ELSE
_HEADLINE[3]="Workpiece No: "<<S_TXT[1]
ENDIF
_I=4
WHILE _I<=6
IF STRLEN(_HEADLINE[_I])>_PROTFORM[1]
_HEADLINE[_I]=SUBSTR(_HEADLINE[_I],0,_PROTFORM[1])
ENDIF
_I=_I+1
ENDWHILE
IF S_TXT[0]=="1"
REPEAT _LAB1 _ENDLAB1
IF _HEADLINE[0]
IF _STR2
WRITE(_ERROR, _PROTNAME[0],_STR2<<S_TXT[6])
ELSE
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[0]<<S_TXT[6])
ENDIF
IF _ERROR GOTOF _FEHL1
ENDIF
IF ($P_PROG[$P_STACK-1]=="_N_CYCLE160_SPF") GOTOF _NEXT
IF ($P_PROG[$P_STACK-2]<>"_N_E_PRT_JOG_SPF") AND ($P_PROG[$P_STACK-3]<>"_N_E_PRT_JOG_SPF")
_NEXT:
_I=1
WHILE _I<=2
REPEAT _LAB2 _ENDLAB2
_I=_I+1
ENDWHILE
ENDIF
_I=3
WHILE _I<=6
IF _HEADLINE[_I]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
ENDIF
IF S_TXT[0]=="1"
REPEAT _LAB1 _ENDLAB1
S_TXT[0]="0"
ENDIF
RET
_LAB1:
_ULMW=""
WHILE (STRLEN(_ULMW)<_PROTFORM[1])
_ULMW=_ULMW<<"*"
ENDWHILE
WRITE(_ERROR, _PROTNAME[0],_ULMW<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
_ENDLAB1:
_LAB2:
_STR2=SUBSTR(_PROTNAME[_I-1],0,_PROTFORM[1]-10)
_STRX=SUBSTR(_PROTNAME[_I-1],_PROTFORM[1]-10)
IF _HEADLINE[_I]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[_I]<<_STR2<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
WHILE STRLEN(_STRX)>0
_STR2=SUBSTR(_STRX,0,_PROTFORM[1]-10)
IF STRLEN(_STR2)<STRLEN(_STRX)
_STRX=SUBSTR(_STRX,_PROTFORM[1]-10)
ELSE
_STRX=""
ENDIF
_STR2="          "<<_STR2
WRITE(_ERROR, _PROTNAME[0],_STR2<<S_TXT[6])
ENDWHILE
ENDIF
_ENDLAB2:
_FEHL1:
CASE _ERROR OF 1 GOTOF _FEHL11 2 GOTOF _FEHL12 3 GOTOF _FEHL13 4 GOTOF _FEHL14 11 GOTOF _FEHL21 12 GOTOF _FEHL22 DEFAULT GOTOF _FEHL20
_FEHL2: STOPRE
N615602 SETAL(61019,"S_PROTTXT")
RET
_FEHL11: STOPRE
N615611 SETAL(61352)
RET
_FEHL12: STOPRE
N615612 SETAL(61353)
RET
_FEHL13: STOPRE
N615613 SETAL(61354)
RET
_FEHL14: STOPRE
N615614 SETAL(61355)
RET
_FEHL20:
_SERR=":"<<_ERROR
IF _ERROR==10
FILESIZE(_ERROR,_PROTNAME[0],_LOGSIZE)
IF _LOGSIZE > ($MN_LEN_PROTOCOL_FILE-1)
_SERR=":10 FILESIZE>"<<$MN_LEN_PROTOCOL_FILE
ENDIF
ENDIF
STOPRE
N615620 SETAL(61358,_SERR)
RET
_FEHL21: STOPRE
N615621 SETAL(61356)
RET
_FEHL22: STOPRE
N615622 SETAL(61357)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE157_SPF
PROC CYCLE157(INT _MODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.08.06.00.001 ;DATE: 2019-08-19
;Cycle support HMIsl
;Report measuring results - utility cycle: Write into protocol file
DEF INT _ERROR,_S1,_I,_I1,_I2,_I3,_IDX,_IDX1,_IDX2,_MAX,_LOGSIZE
DEF STRING[10] _LEER10,_LEER6,_ZW
DEF STRING[17] _LEER17
DEF STRING[30] _BLKSP1
DEF STRING[40] _SERR
DEF STRING[200] _ULMW,_BLKSP,_STR_A,_STR_B,_STR2,_STR1
DEF STRING[255] _STR3,_STRX
DEF STRING[255] _RESULT[1]
S_TXT[72]="Unit"
_LEER10="          "
_LEER6="      "
_LEER17="                 "
IF ((_OVI[2]==9960) AND (_PROTFORM[0]==2))
GOTOF _MARK1
ENDIF
IF NOT((_OVI[2]==995) OR (_OVI[2]==996) OR (_OVI[2]==9960))
IF (($P_PROG[$P_STACK-1]<>"_N_CYCLE996_SPF") AND ($P_PROG[$P_STACK-2]<>"_N_CYCLE996_SPF"))
IF ($P_PROG[$P_STACK-1]<>"_N_CYCLE151_SPF")
cycle155
ENDIF
ENDIF
ENDIF
IF ((_PROTFORM[0]==2) AND (_MODE<>4))
cycle156(_PROTFORM[2])
_STR1="Time: "<<S_TXT[41]
_STR2=S_TXT[42]<<_LEER10<<": "
_I1=_PROTFORM[1]-(STRLEN(_HEADLINE[7]))-(STRLEN(_STR1))-(STRLEN(_STR2))-2
_I=1
WHILE _I<=_I1
_BLKSP=_BLKSP<<" "
_I=_I+1
ENDWHILE
_I=7 _I1=0
WHILE _I<=18
IF _HEADLINE[_I]
IF _I==7
_STRX=_STR2<<_HEADLINE[7]<<_BLKSP<<_STR1
ELSE
_STRX=_HEADLINE[_I]
ENDIF
REPEAT _LAB3 ENDLABEL
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
_I=_I+1
ENDWHILE
_I=0
IF _PROTVAL[0]
_STRX= _PROTVAL[0]
REPEAT _LAB3 ENDLABEL
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
IF (_OVI[2]==996)
IF _PROTFORM[4]>6
_I=_PROTFORM[4] _MAX=16
ENDIF
ELSE
_I=1 _MAX=24
ENDIF
_SCHLEIFE_A:
WHILE _I<=_MAX
IF _PROTVAL[_I]
_STRX=_PROTVAL[_I]
REPEAT _LAB3 ENDLABEL
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
_I=_I+1
ENDWHILE
_SCHLEIFE_E:
IF (_OVI[2]==996)
IF _PROTFORM[4]>6
_I=4 _MAX=(_PROTFORM[4]/2)+4
ELSE
_I=4 _MAX=(_PROTFORM[4])+4
ENDIF
REPEAT _SCHLEIFE_A _SCHLEIFE_E
ENDIF
GOTOF _MC_END
ENDIF
IF (_PROTFORM[0]==2) AND (_MODE==4)
IF (_PROTFORM[3]<=2)
S_TXT[0]="0"
cycle156(_PROTFORM[2])
IF ((_OVI[2]==971) OR (_OVI[2]==973) OR (_OVI[2]==976) OR (_OVI[2]==982) OR (_OVI[2]==997))
ENDIF
IF (S_TXT[4]<>"; ")
GOTOF _FEHL2
ENDIF
_I=0
GOTOF _MARK4
ELSE
ENDIF
ENDIF
_I=0
CASE (_MODE) OF 1 GOTOF _MARK1 2 GOTOF _MARK2 0 GOTOF _MARK1
_MARK2:
N10 GOTOF _MARK1
RET
_MARK1:
_MA0:
cycle156(_PROTFORM[2])
IF (_PROTFORM[3]<>2)
IF ((_OVI[2]==996) AND (SUBSTR(_PROTVAL[29],0,1)=="V")) GOTOF _MB0
IF ((_OVI[2]==9960) AND ((SUBSTR(_PROTVAL[29],0,1)=="V") OR (SUBSTR(_PROTVAL[29],0,1)=="E"))) GOTOF _MC9960
ENDIF
_MA1:
_MA2:
_STR1="Time: "<<S_TXT[41]
_STR2=S_TXT[42]<<_LEER10<<": "
_I1=_PROTFORM[1]-(STRLEN(_HEADLINE[7]))-(STRLEN(_STR1))-(STRLEN(_STR2))-2
_I=1
WHILE _I<=_I1
_BLKSP=_BLKSP<<" "
_I=_I+1
ENDWHILE
REPEAT _LAB1 ENDLABEL
IF ($P_PROG[$P_STACK-1]<>"_N_E_PRT_JOG_SPF") AND ($P_PROG[$P_STACK-2]<>"_N_E_PRT_JOG_SPF")
WRITE(_ERROR, _PROTNAME[0],_STR2<<_HEADLINE[7]<<_BLKSP<<_STR1<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=0 _I1=0
IF ((S_TXT[31]=="2") OR (S_TXT[31]=="3")) GOTOF _MA4
_MA3:
IF _OVI[2]==9960
_I=8
WHILE _I<=16
IF _HEADLINE[_I]
IF (_PROTFORM[1]<80)
_HEADLINE[_I]=SUBSTR(_HEADLINE[_I],0,_PROTFORM[1])
ENDIF
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
REPEAT _LAB1 ENDLABEL
GOTOF _MC9960
ENDIF
_I=8
WHILE _I<=10
IF _HEADLINE[_I]
IF (_PROTFORM[1]<80)
_HEADLINE[_I]=SUBSTR(_HEADLINE[_I],0,_PROTFORM[1])
ENDIF
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
_MA4:
IF _HEADLINE[11]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[11]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
IF _HEADLINE[12]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[12]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
IF _HEADLINE[13]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[13]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_MA_END:
REPEAT _LAB1 ENDLABEL
IF ((_OVI[2]==971) OR (_OVI[2]==973) OR (_OVI[2]==976) OR (_OVI[2]==982)) GOTOF _MB0
IF ((S_TXT[31]=="1") OR (S_TXT[31]=="3")) GOTOF _MB_END
_MB0:
IF _HEADLINE[14]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[14]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
IF _HEADLINE[15]
IF STRLEN(_HEADLINE[15])<=_PROTFORM[1]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[15]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ELSE
_IDX2=RINDEX(_HEADLINE[15],",")
WRITE(_ERROR, _PROTNAME[0],SUBSTR(_HEADLINE[15],0,_IDX2+1)<<S_TXT[6])
WRITE(_ERROR, _PROTNAME[0],_LEER17<<SUBSTR(_HEADLINE[15],_IDX2+2)<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
IF _PROTVAL[0]
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[0]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
REPEAT _LAB2 ENDLABEL
ENDIF
_I=1
WHILE _I<=3
IF _PROTVAL[_I]
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
IF ((_OVI[2]==996) AND (_PROTFORM[4]>6))
_I=(_PROTFORM[4]/2)+5
WHILE _I<=16
IF _PROTVAL[_I]
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
ENDIF
REPEAT _LAB2 ENDLABEL
_MB_END:
_MC0:
_MC9960:
IF (SUBSTR(_PROTVAL[29],0,1))=="V"
IF (STRLEN(_PROTVAL[29])==4) AND (STRLEN(_PROTVAL[28])>0) AND (_PROTFORM[3]<>2)
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[10]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
RET
ENDIF
ENDIF
IF _OVI[2]==9960
IF (SUBSTR(_PROTVAL[29],0,1)==" ") OR ((SUBSTR(_PROTVAL[29],0,1)<>" ") AND (_PROTFORM[3]==2))
_I=0
WHILE _I<= 4
IF _PROTVAL[_I]
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
_I=0
WHILE _I<=(_PROTFORM[4]-1)
IF _PROTVAL[5]
EXECSTRING("_PROTVAL[6]="<<_PROTVAL[5])
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[6]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
_I=0
WHILE _I<5
IF _PROTVAL[7+_I]
WRITE(_ERROR, _PROTNAME[0],<<_PROTVAL[13+_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
_I=0
ENDIF
IF (SUBSTR(_PROTVAL[29],0,1)=="V") OR (SUBSTR(_PROTVAL[29],0,1)=="E")
IF _HEADLINE[17]
WRITE(_ERROR, _PROTNAME[0],_HEADLINE[17]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=0
WHILE _I<=4
IF _PROTVAL[7+_I]
WRITE(_ERROR, _PROTNAME[0],<<_PROTVAL[7+_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
_I=0
WHILE _I<=2
IF _PROTVAL[18+_I]
WRITE(_ERROR, _PROTNAME[0],<<_PROTVAL[18+_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
_I=0
IF _PROTVAL[12]
WRITE(_ERROR, _PROTNAME[0],<<_PROTVAL[12]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
RET
ENDIF
IF NOT((_OVI[2]==996) AND (SUBSTR(_PROTVAL[29],0,1)=="V"))
IF _PROTVAL[4]
WRITE(_ERROR, _PROTNAME[0],<<_PROTVAL[4]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
REPEAT _LAB2 ENDLABEL
ENDIF
ENDIF
_I=5
IF _OVI[2]==996
IF _PROTFORM[4]>6
_I=(_PROTFORM[4]/2)+5
_MAX=(_PROTFORM[4]/2)+4
ELSE
_MAX=10
ENDIF
ELSE
_MAX=24
ENDIF
IF ((_OVI[2]==971) AND (_MVAR _DEC1<>0) AND (_MVAR _DEC3==1))
_I=5 _MAX=6
ENDIF
WHILE _I<=_MAX
IF _PROTVAL[_I]
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[_I]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
IF ((_OVI[2]==971) AND (_MVAR _DEC1<>0) AND (_MVAR _DEC3==1))
_I=0
WHILE _I<=(_PROTFORM[4]-1)
IF _PROTVAL[7]
EXECSTRING("_PROTVAL[8]="<<_PROTVAL[7])
_PROTVAL[8]=_PROTVAL[8]<<S_TXT[3]
WRITE(_ERROR, _PROTNAME[0],_PROTVAL[8]<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
ENDIF
REPEAT _LAB1 ENDLABEL
WRITE(_ERROR, _PROTNAME[0],S_TXT[6])
_MC_END:
RET
_MARK3:
cust_meaprot
_STR_A=_PROTVAL[32]
_STR_B=_PROTVAL[33]
_I=5 _I1=0
WHILE _I<=24
IF _PROTVAL[_I]
_I1=_I1+1
ENDIF
_I=_I+1
ENDWHILE
IF _I1>4 GOTOF _MARK31
_I=1 _I1=4
WHILE _I<=_I1
IF _PROTVAL[4]
IF _I>1
_STRX=_STRX<<";"
ENDIF
_STRX=_STRX<<_PROTVAL[4]<<S_TXT[72]
_I=_I+1
ENDIF
ENDWHILE
REPEAT _LAB3 ENDLABEL
_STR3=_STR_A<<";"<<_STR3
IF _STR3
IF (_PROTVAL[34]<>_PROTNAME[0])
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
_PROTVAL[34]=_PROTNAME[0]
ENDIF
ENDIF
_I=5 _STRX=""
WHILE _I<(5+_I1)
IF _PROTVAL[_I]
IF _I>5
_STRX=_STRX<<";"
ENDIF
_STRX=_STRX<<_PROTVAL[_I]
ENDIF
_I=_I+1
ENDWHILE
REPEAT _LAB3 ENDLABEL
_STR3=_STR_B<<";"<<_STR3
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
RET
_MARK31:
_I=1
WHILE _I<=_I1
IF _I==1
WRITE(_ERROR, _PROTNAME[0],S_TXT[6])
IF _ERROR GOTOF _FEHL1
_STR_B=_STR_B<<";"
WRITE(_ERROR, _PROTNAME[0],_STR_B)
IF _ERROR GOTOF _FEHL1
ENDIF
_STRX=_PROTVAL[_I+4]
IF _I<_I1
_STRX=_STRX<<S_TXT[4]
ENDIF
REPEAT _LAB3 ENDLABEL
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3)
IF _ERROR GOTOF _FEHL1
ENDIF
_I=_I+1
ENDWHILE
RET
_MARK4:
cust_meaprot
_STR_A=_PROTVAL[32]
_STR_B=_PROTVAL[33]
IF ((_OVI[2]==971) AND (_MVAR _DEC1<>0) AND (_MVAR _DEC3==1))
_I=5 _I1=0
WHILE _I<=6
IF _PROTVAL[_I]
_I1=_I-4
ENDIF
_I=_I+1
ENDWHILE
ELSE
_I=5 _I1=0
WHILE _I<=24
IF _PROTVAL[_I]
_I1=_I-4
ENDIF
_I=_I+1
ENDWHILE
ENDIF
_STRX=_PROTVAL[4]<<S_TXT[72]
REPEAT _LAB3 ENDLABEL
_STR3=_STR_A<<";"<<_STR3
IF _STR3
IF ISFILE(_PROTNAME[0])
FILESIZE(_ERROR,_PROTNAME[0],_I2)
IF _ERROR==0
IF _I2>0
READ(_ERROR,_PROTNAME[0],1,1,_RESULT)
IF _STR3==_RESULT[0]
GOTOF _NEXT
ENDIF
ENDIF
ENDIF
ENDIF
_PROTVAL[34]=_PROTNAME[0]
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
_NEXT:
_I=1
WHILE _I<=_I1
_STRX=_PROTVAL[_I+4]
IF _STRX
REPEAT _LAB3 ENDLABEL
_STR3=_STR_B<<";"<<_STR3
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
_I=_I+1
ENDWHILE
IF ((_OVI[2]==971) AND (_MVAR _DEC1<>0) AND (_MVAR _DEC3==1))
_I=0
WHILE _I<=(_PROTFORM[4]-1)
IF _PROTVAL[7]
EXECSTRING("_PROTVAL[8]="<<_PROTVAL[7])
_PROTVAL[8]=_PROTVAL[8]<<S_TXT[3]
_STRX=_PROTVAL[8]
REPEAT _LAB3 ENDLABEL
_STR3=_STR_B<<";"<<_STR3
IF _STR3
WRITE(_ERROR, _PROTNAME[0],_STR3<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDIF
ENDIF
_I=_I+1
ENDWHILE
ENDIF
RET
_LAB1:
IF ((_PROTFORM[0]==2) AND(_OVI[2]<>9960)) GOTOF ENDLABEL
_ULMW=""
WHILE (STRLEN(_ULMW)<_PROTFORM[1])
_ULMW=_ULMW<<"-"
ENDWHILE
WRITE(_ERROR, _PROTNAME[0],_ULMW<<S_TXT[6])
ENDLABEL:
_LAB2:
IF ((_PROTFORM[0]==2)AND(_OVI[2]<>9960)) GOTOF ENDLABEL
_BLKSP1="" _ZW="" _ULMW=""
WHILE STRLEN(_BLKSP1)<NUMBER(S_TXT[9])
_BLKSP1=_BLKSP1<<" "
ENDWHILE
WHILE STRLEN(_ZW)<STRLEN(S_TXT[4])
_ZW=_ZW<<" "
ENDWHILE
_S1=_PROTFORM[1]-Number(S_TXT[9])-STRLEN(S_TXT[4])
WHILE (STRLEN(_ULMW)<_S1)
_ULMW=_ULMW<<"-"
ENDWHILE
_ULMW=_BLKSP1<<_ZW<<_ULMW
WRITE(_ERROR, _PROTNAME[0],_ULMW<<S_TXT[6])
ENDLABEL:
_LAB3:
_IDX=1 _STR1="" _STR3="" _I3=0
WHILE _IDX>=0
IF (S_TXT[4]<>"; ")
GOTOF _FEHL2
ENDIF
_IDX=MATCH(_STRX," <")
IF _IDX>=0
_STRX=SUBSTR(_STRX,0,_IDX)<<"; "<<SUBSTR(_STRX,_IDX+2)
ENDIF
_IDX=MATCH(_STRX,S_TXT[4])
IF _IDX>=0
_I3=_I3+1
IF (_IDX==28) AND (_I3==1)
_STR1=(SUBSTR(_STRX,0,_IDX-3))<<"; ;"
ELSE
_STR1=(SUBSTR(_STRX,0,_IDX+1))
ENDIF
_IDX1=MATCH(_STR1,".")
IF _IDX1>=0
_STR1=SUBSTR(_STR1,0,_IDX1)<<","<<SUBSTR(_STR1,_IDX1+1)
ENDIF
_STRX=SUBSTR(_STRX,_IDX+2)
ELSE
_STR1=_STRX
_IDX1=MATCH(_STR1,".")
IF _IDX1>=0
_STRX=SUBSTR(_STR1,0,_IDX1)<<","<<SUBSTR(_STR1,_IDX1+1)
ENDIF
GOTOF _NEXT1
ENDIF
_STR3=_STR3<<_STR1
ENDWHILE
_NEXT1:
_STR3=_STR3<<_STR1
ENDLABEL:
RET
_FEHL1:
CASE _ERROR OF 1 GOTOF _FEHL11 2 GOTOF _FEHL12 3 GOTOF _FEHL13 4 GOTOF _FEHL14 11 GOTOF _FEHL21 12 GOTOF _FEHL22 DEFAULT GOTOF _FEHL20
RET
_FEHL2: STOPRE
N615702 SETAL(61359,"S_TXT[4]<>; ")
RET
_FEHL3: STOPRE
N615703 SETAL(61359,"cycle"<<_OVI[2]<<" not supported")
RET
_FEHL11: STOPRE
N615711 SETAL(61352)
RET
_FEHL12: STOPRE
N615712 SETAL(61353)
RET
_FEHL13: STOPRE
N615713 SETAL(61354)
RET
_FEHL14: STOPRE
N615714 SETAL(61355)
RET
_FEHL20:
_SERR=":"<<_ERROR
IF _ERROR==10
FILESIZE(_ERROR,_PROTNAME[0],_LOGSIZE)
IF _LOGSIZE > ($MN_LEN_PROTOCOL_FILE-1)
_SERR=":10 FILESIZE>"<<$MN_LEN_PROTOCOL_FILE
ENDIF
ENDIF
STOPRE
N615720 SETAL(61358,_SERR)
RET
_FEHL21: STOPRE
N615721 SETAL(61356)
RET
_FEHL22: STOPRE
N615722 SETAL(61357)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE160_SPF
PROC CYCLE160(INT _MODE) SBLOF DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.07.66.05 ;DATE: 2016-06-14
;Cycle support HMIsl
;Report user defined data - utility cycle: Logging data set
DEF INT _ERROR,_I,_IDX,_LOGSIZE,_M_PROTSTAT_0,_M_PROTFORM[6]
DEF STRING[40] _SERR,_M_TXT_0
DEF STRING[255] _STRX,_M_PROTNAME_0
cust_meaprot(2)
IF ((S_PROTMEA_RESULT_DISPLAY>0) AND (S_PROTMEA_RESULT_DISPLAY<4))
IF $SCS_MEA_RESULT_MRD
_M_PROTSTAT_0=S_PROTSTAT[0]
_M_TXT_0=S_TXT[0]
_M_PROTNAME_0=_PROTNAME[0]
FOR _I=0 TO 5
_M_PROTFORM[_I]=_PROTFORM[_I]
ENDFOR
_I=0
IF (S_PROTSTAT[0]==0)
S_PROTSTAT[0]=1
_PROTFORM[3]=1
_PROTFORM[2]=3
_PROTFORM[0]=1
ENDIF
IF (_PROTFORM[2]<3)
S_TXT[0]="0"
ENDIF
_PROTNAME[0]="//NC:/WKS.DIR/TEMP.WPD/RESULT_DISPLAY_USER.TXT"
DELETE(_ERROR,_PROTNAME[0])
REPEAT _LAB3_1 _LAB3_0
IF (S_PROTMEA_RESULT_DISPLAY==3)
STOPRE
MMC("MCYCLES,LM,MZBILD06.com,CYC160","A")
MSG("$83005")
M0
MSG("")
STOPRE
MMC("MCYCLES,PICTURE_OFF","A")
STOPRE
ELSE
STOPRE
MMC("MCYCLES,LM,MZBILD06.com,CYC160","A")
STOPRE
G4 F8
MMC("MCYCLES,PICTURE_OFF","A")
STOPRE
ENDIF
FOR _I=0 TO 5
_PROTFORM[_I]=_M_PROTFORM[_I]
ENDFOR
_I=0
_PROTNAME[0]=_M_PROTNAME_0
S_TXT[0]=_M_TXT_0
S_PROTSTAT[0]=_M_PROTSTAT_0
ENDIF
IF S_PROTSTAT[0]==0
RET
ENDIF
ENDIF
_LAB3_1:
_I=0
IF (_PROTFORM[2]==3)
IF (ISVAR("S_USERTXT"))
WHILE STRLEN(S_USERTXT[_I])==0
_I=_I+1
IF NOT(ISVAR("S_USERTXT"<<"["<<_I<<"]"))
_SERR="S_USERTXT[0]"
GOTOF _FEHL3
ENDIF
ENDWHILE
WHILE STRLEN(S_USERTXT[_I])>0
_STRX=S_USERTXT[_I]
REPEAT _LAB2 ENDLABEL
_I=_I+1
IF NOT(ISVAR("S_USERTXT"<<"["<<_I<<"]")) GOTOF _LAB3_0
ENDWHILE
GOTOF _LAB3_0
ELSE
WHILE STRLEN(S_PROTTXT[_I])==0
_I=_I+1
IF NOT(ISVAR("S_PROTTXT"<<"["<<_I<<"]"))
_SERR="S_PROTTXT[0]"
GOTOF _FEHL3
ENDIF
ENDWHILE
WHILE STRLEN(S_PROTTXT[_I])>0
_STRX=S_PROTTXT[_I]
REPEAT _LAB2 ENDLABEL
_I=_I+1
IF NOT(ISVAR("S_PROTTXT"<<"["<<_I<<"]")) GOTOF _LAB3_0
ENDWHILE
GOTOF _LAB3_0
ENDIF
ENDIF
IF (_PROTFORM[2]<>3)
IF _PROTFORM[0]==1
IF (S_TXT[0]=="1")
cycle156
ENDIF
ENDIF
WHILE STRLEN(S_PROTTXT[_I])==0
_I=_I+1
IF NOT(ISVAR("S_PROTTXT"<<"["<<_I<<"]"))
_SERR="S_PROTTXT[0]"
GOTOF _FEHL3
ENDIF
ENDWHILE
IF STRLEN(S_PROTTXT[_I])>0
REPEAT _LAB1 ENDLABEL
WHILE STRLEN(S_PROTTXT[_I])>0
_STRX=S_PROTTXT[_I]
REPEAT _LAB2 ENDLABEL
_I=_I+1
IF NOT(ISVAR("S_PROTTXT"<<"["<<_I<<"]")) GOTOF _NEXT
ENDWHILE
_NEXT:
REPEAT _LAB1 ENDLABEL
ENDIF
ENDIF
_LAB3_0:
RET
_LAB1:
WRITE(_ERROR, _PROTNAME[0],S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDLABEL:
_LAB2:
_IDX=MATCH(_STRX,"SPRINT(")
IF (_IDX==0)
_STRX="_STRX="<<SUBSTR(_STRX,_IDX)
EXECSTRING(_STRX)
ENDIF
WRITE(_ERROR, _PROTNAME[0],_STRX<<S_TXT[6])
IF _ERROR GOTOF _FEHL1
ENDLABEL:
_FEHL1:
CASE _ERROR OF 1 GOTOF _FEHL11 2 GOTOF _FEHL12 3 GOTOF _FEHL13 4 GOTOF _FEHL14 11 GOTOF _FEHL21 12 GOTOF _FEHL22 DEFAULT GOTOF _FEHL20
RET
_FEHL2: STOPRE
N616002 SETAL(61019,"S_PROTTXT")
RET
_FEHL3: STOPRE
N616003 SETAL(61019,_SERR)
RET
_FEHL11: STOPRE
N616011 SETAL(61352)
RET
_FEHL12: STOPRE
N616012 SETAL(61353)
RET
_FEHL13: STOPRE
N616013 SETAL(61354)
RET
_FEHL14: STOPRE
N616014 SETAL(61355)
RET
_FEHL20:
_SERR=":"<<_ERROR
IF _ERROR==10
FILESIZE(_ERROR,_PROTNAME[0],_LOGSIZE)
IF _LOGSIZE > ($MN_LEN_PROTOCOL_FILE-1)
_SERR=":10 FILESIZE>"<<$MN_LEN_PROTOCOL_FILE
ENDIF
ENDIF
STOPRE
N616020 SETAL(61358,_SERR)
RET
_FEHL21: STOPRE
N616021 SETAL(61356)
RET
_FEHL22: STOPRE
N616022 SETAL(61357)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE961_SPF
PROC CYCLE961(INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_SETV6,REAL S_SETV7,REAL S_SETV8,REAL S_SETV9,REAL S_STA1,REAL S_INCA,REAL S_ID,REAL S_FA,REAL S_TSA,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.001 ;DATE: 2024-02-06
;Cycle : Measure and Setup inside or outside corner
N110 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56]
N120 DEF REAL _M_SPE[80],_M_ME[40],_SIC=0,_SIC1,_SIC2
N130 DEF INT _M_N[40],_ALARM,_MAKA1,_MAKA2,_ANZ,_MP
N140 DEF AXIS _MAV,_VAV,_VAV1,_RAX,_XX,_YY,_ZZ
N150 DEF REAL _TRIGG,_WIH,_KA1,_KA2,_FA1=20,_FA2=20,_P_ABS,_P_ORD,_P_APP,_WI11,_WI22,_WI1,_WI2,_MP_A[5],_MP_O[5],_HKA,_HRP,_HF,_COS_2,_SIN_2
N175 DEF REAL _A1,_A2,_B1,_B2,_C1,_C2,_S_A,_S_O,_D,_HD,_HDO,_DAT[3,6],_KF[3,3],_H_I[4]
N176 DEF INT _AXIND,_HM=1,_H_XX=1,_H_YY=1,_H_ZZ=1,_AX_P1_2,_DIR1_2,_AX_P3_4,_DIR3_4,_E_B,_PT1_2,_PT3_4
N178 DEF REAL _SWA,_SWO,_HR,_H_SPE61
N179 DEF INT _A_NPV,_K_NPV,_M_BFNR,_FRSEL,_HI[10],_COR_STAT,_H_SIM
N180 DEF REAL _POS_A[3],_POS_K[3],_UF[3],_H_STA1,_SETV_0,_SETV_1,_MP_S[22]
N181 DEF FRAME _RET_FR
N183 DEF STRING[2] _HSTR_PROT
N184 DEF REAL _MP_A_2[5],_MP_O_2[5]
N185 DEF REAL _WI11_2,_WI22_2,_WI1_2,_WI2_2,_COS_2_2,_SIN_2_2,_TRIGG_2
N186 DEF REAL _P_ABS_2,_P_ORD_2
N187 DEF INT _MODE_2MESS=1
N1040 DEF INT _H_DMODE, _H_KNUM,_CHBIT_S21
N1042 DEF BOOL _NEW_PAR=0
N1044 DEF STRING[40] _SERR,_S_XX,_S_YY,_S_ZZ
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE961_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE961_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE961("<<S_MVAR<<","<<S_KNUM<<","<<S_PRNUM<<","<<S_SETV0<<","<<S_SETV1<<","<<S_SETV2<<","<<S_SETV3<<","<<S_SETV4<<","<<S_SETV5<<","<<S_SETV6<<","<<S_SETV7<<","<<S_SETV8<<","<<S_SETV9<<","<<S_STA1<<","<<S_INCA<<","<<S_ID<<","<<S_FA<<","<<S_TSA<<","<<S_NMSP<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _H_KNUM = (S_MVAR _DEC3)
_CHBIT_S21=_CHBIT[21] _NEW_PAR=1 _M_SPE[3]=1
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) < 5) OR ((S_MVAR _DEC1)> 8) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 1 GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4) > 1) GOTOF _M_ERR
IF ((S_MVAR _DEC4)==1)
_ID=ABS(S_ID)
S_MVAR=S_MVAR - 1000
ELSE
_ID=0
ENDIF
S_KNUM=ABS(S_KNUM)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - (S_KNUM _DEC3)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 2) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
_HA1:
_PRNUM=ABS(S_PRNUM) _FA=ABS(S_FA) _TSA=ABS(S_TSA)
_STA1=S_STA1 MOD 360 _INCA=S_INCA MOD 360
IF ((S_MVAR _DEC2)==0)
IF ((S_MVAR _DEC1)==5) OR ((S_MVAR _DEC1)==6)
_INCA=90
_SERR=<<"S_STA1 >90 or <-90"
IF ABS(_STA1)>90 GOTOF _ERR12
ELSE
_SERR=<<"S_STA1 >45 or <-45"
IF ABS(_STA1)>45 GOTOF _ERR12
_SERR=<<"S_INCA =0"
IF (_INCA==0) GOTOF _ERR12
_SERR=<<"S_INCA >=180 or =<-180"
IF (ABS(_INCA)>=180) GOTOF _ERR12
ENDIF
ELSE
_STA1=0 _INCA=0
ENDIF
IF ((S_MVAR _DEC2)==0)
IF ((S_MVAR _DEC1)<7)
S_SETV0=ABS(S_SETV0) S_SETV1=ABS(S_SETV1) S_SETV2=ABS(S_SETV2)
IF ((S_MVAR _DEC5)==2)
S_SETV0=-S_SETV0 S_SETV1=-S_SETV1
ENDIF
IF ((S_MVAR _DEC5)==3)
S_SETV0=-S_SETV0 S_SETV1=-S_SETV1 S_SETV2=-S_SETV2
ENDIF
IF ((S_MVAR _DEC5)==4)
S_SETV2=-S_SETV2
ENDIF
ELSE
S_SETV0=ABS(S_SETV0) S_SETV1=ABS(S_SETV1) S_SETV2=ABS(S_SETV2) S_SETV3=ABS(S_SETV3)
IF ((S_MVAR _DEC5)==2)
S_SETV0=-S_SETV0 S_SETV1=-S_SETV1
ENDIF
IF ((S_MVAR _DEC5)==3)
S_SETV0=-S_SETV0 S_SETV1=-S_SETV1 S_SETV2=-S_SETV2 S_SETV3=-S_SETV3
ENDIF
IF ((S_MVAR _DEC5)==4)
S_SETV2=-S_SETV2 S_SETV3=-S_SETV3
ENDIF
ENDIF
ENDIF
IF ((S_MVAR _DEC2)==1)
_SETV[0]=S_SETV2 _SETV[1]=S_SETV3 _SETV[2]=S_SETV0 _SETV[3]=S_SETV1
_SETV[4]=S_SETV4 _SETV[5]=S_SETV5 _SETV[6]=S_SETV6 _SETV[7]=S_SETV7
ELSE
_SETV[0]=S_SETV0 _SETV[1]=S_SETV3
_SETV[4]=0
IF S_SETV1==0
_SETV_0=S_SETV0/2
ELSE
_SETV_0=S_SETV1
ENDIF
IF S_SETV2==0
_SETV_1=S_SETV2/2
ELSE
_SETV_1=S_SETV2
ENDIF
IF ((S_MVAR _DEC1)==5) OR ((S_MVAR _DEC1)==6)
_SETV_1=S_SETV2 _SETV[1]=_SETV_1 * 2
ENDIF
IF ((ABS(_SETV[0]))-(ABS(_SETV_0))<=0) OR ((ABS(_SETV[1]))-(ABS(_SETV_1))<=0) GOTOF _ERR2
ENDIF
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5)>4) GOTOF _M_ERR
IF ((S_MVAR _DEC3)==0)
S_MVAR=S_MVAR + 100 _KNUM=0
ENDIF
_MVAR=S_MVAR-((S_MVAR _DEC5)*10000)
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
S_MCBIT = ABS(S_MCBIT)
_SERR=<<"(_DMODE: DEC1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
_SERR=<<"(_DMODE: DEC4)"
_H_DMODE=ABS(_DMODE _DEC4)
IF(_H_DMODE>1) GOTOF _M_ERR
IF _H_DMODE
_H_DMODE=-1
ELSE
_H_DMODE=1
ENDIF
_S_XX=AXSTRING($P_AXN1) _S_YY=AXSTRING($P_AXN2) _S_ZZ=AXSTRING($P_AXN3)
ELSE
IF ((_MVAR _DEC2)==0)
_SETV_0=_SETV[0]/2
_SETV_1=_SETV[1]/2
ENDIF
_OVI[3]=-_MVAR
ENDIF
_ALARM=0
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
IF _PRNUM _DEC3==1
_PRNUM = _PRNUM - 100
ENDIF
ENDIF
ENDIF
ENDIF
IF NOT(_NEW_PAR)
IF ((((_MVAR _DEC1) == 5)OR((_MVAR _DEC1) == 7))AND((_MVAR _DEC2) == 0))
_ID=0
ENDIF
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _ERR5
_ALARM=0
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1 _FA1=20 _FA2=20
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18]= 301
ELSE
_INTERN[7] =1
ENDIF
ELSE
IF _H_SIM _DEC3 ==1
_FA1=_FA _FA2=_FA
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF NOT(_NEW_PAR)
_FA=20
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_H_I[3]=$P_ADT[6]/2
ELSE
_H_I[3]=$P_ADT[6]
ENDIF
_OVI[2]=961 _VB[0]=1
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N200 CYCLE109(_INTERN,_M_SPE,_M_N)
IF ((_MVAR<105)AND(_MVAR>108))AND((_MVAR<117)AND(_MVAR>118))GOTOF _ERR6 IF _MVAR>108 GOTOF _MA1 IF _INCA==0 GOTOF _ERR3
IF NOT(_NEW_PAR)
IF (_SETV[0]<=0)OR(_SETV[1]<=0) GOTOF _ERR2
ENDIF
N210 _MA1:G0 G90 G94 DIAMCYCOF
N220 CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
IF (_INTERN[2]==0)OR(_INTERN[10]==0)OR(_INTERN[18]==0) GOTOF _ERR7 IF _VB[2] AND((_MVAR==117)OR(_MVAR==118))GOTOF _ERR10
_HI[0]=_M_SPE[54] MOD 100
IF (_INTERN[20+16])AND((_HI[0] B_AND 'B0001'<>1)OR(_HI[0] B_AND 'B0010'<>2)) GOTOF _ERR4
IF (_INTERN[68] == 1)
_HI[5]=_M_SPE[74] MOD 100
IF (_INTERN[20+16]==1)AND((_HI[5] B_AND 'B0001'<>1)OR(_HI[5] B_AND 'B0010'<>2)) GOTOF _ERR4
ENDIF
IF (_INTERN[0] OR _INTERN[8] OR _INTERN[16] OR _INTERN[1] OR _INTERN[9] OR _INTERN[17])
IF (($P_GG[29]==1) OR ($P_GG[29]==4)) AND ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (_INTERN[0] OR _INTERN[1])
_H_XX=2
ENDIF
IF (_INTERN[8] OR _INTERN[9])
_H_YY=2
ENDIF
IF (_INTERN[16] OR _INTERN[17])
_H_ZZ=2
ENDIF
ENDIF
ENDIF
IF (_VB[1] == 0)
N230 G1 F=_M_SPE[1]
ENDIF
_OVR[1]=S_SETV8 _OVR[2]=S_SETV9
IF _MVAR>108
_A1=-(_SETV[3]-_SETV[1])
_B1= _SETV[2]-_SETV[0]
_C1= _SETV[1]*_B1 + _SETV[0]*_A1
_A2=-(_SETV[7]-_SETV[5])
_B2= _SETV[6]-_SETV[4]
_C2=_SETV[5]*_B2 + _SETV[4]*_A2
_D=_A1*_B2-_A2*_B1
IF ((_B1==0)AND(_A1==0))OR((_B2==0)AND(_A2==0))
_ALARM=61367
IF (_NEW_PAR)
_SERR=<<_S_XX[0]<<"1"<<_S_YY[0]<<"1="<<_S_XX[0]<<"2"<<_S_YY[0]<<"2 OR "<<_S_XX[0]<<"3"<<_S_YY[0]<<"3="<<_S_XX[0]<<"4"<<_S_YY[0]<<"4"
ELSE
_SERR=<<"_SETV[0...3], _SETV[4...7]"
ENDIF
ELSE
IF _D==0
_ALARM=61368
IF (_NEW_PAR)
_SERR=<<_S_XX[0]<<"1"<<_S_YY[0]<<"1_"<<_S_XX[0]<<"2"<<_S_YY[0]<<"2 "<<_S_XX[0]<<"3"<<_S_YY[0]<<"3_"<<_S_XX[0]<<"4"<<_S_YY[0]<<"4"
ELSE
_SERR=<<"_SETV[0...3], _SETV[4...7]"
ENDIF
ELSE
_S_A=(_C1*_B2-_C2*_B1)/_D _S_O=(_A1*_C2-_A2*_C1)/_D
IF (_SETV[1]-_S_O==0)AND(_SETV[0]-_S_A==0)OR(_SETV[5]-_S_O==0)AND(_SETV[4]-_S_A==0)OR(_SETV[3]-_S_O==0)AND(_SETV[2]-_S_A==0)OR(_SETV[7]-_S_O==0)AND(_SETV[6]-_S_A==0)
_ALARM=61369
IF (_NEW_PAR)
_SERR=<<_S_XX[0]<<"1"<<_S_YY[0]<<"1 <> "<<_S_XX[0]<<"3"<<_S_YY[0]<<"3 OR "<<_S_XX[0]<<"2"<<_S_YY[0]<<"2 <> "<<_S_XX[0]<<"4"<<_S_YY[0]<<"4.."
ELSE
_SERR=<<"_SETV[0...7]"
ENDIF
ELSE
_KA1=ATAN2(_SETV[1]-_S_O,_SETV[0]-_S_A) _KA2=ATAN2(_SETV[5]-_S_O,_SETV[4]-_S_A) _A1=ATAN2(_SETV[3]-_S_O,_SETV[2]-_S_A) _A2=ATAN2(_SETV[7]-_S_O,_SETV[6]-_S_A)
IF (ABS(_KA1-_A1)>1)OR(ABS(_KA2-_A2)>1)
_ALARM=61369
IF (_NEW_PAR)
_SERR=<<_S_XX[0]<<"1 "<<_S_YY[0]<<"1 "<<_S_XX[0]<<"2 "<<_S_YY[0]<<"2 "<<_S_XX[0]<<"3 "<<_S_YY[0]<<"3 "<<_S_XX[0]<<"4 "<<_S_YY[0]<<"4 "
ELSE
_SERR=<<"_SETV[0...7]"
ENDIF
ENDIF
ENDIF
ENDIF
_KA1=(_KA1 + 360) MOD 360
_KA2=(_KA2 + 360) MOD 360
_D=_KA2-_KA1
IF (_D<0)AND(_D<-180)
_D=_D+360
ENDIF
IF (_D>0)AND(_D>180)
_D=_D-360
ENDIF
ENDIF
ELSE
IF _H_DMODE <0
_H_STA1=(_M_SPE[61] + _STA1) MOD 360 _M_SPE[43]=_H_STA1
ELSE
_H_STA1=_STA1 MOD 360 _M_SPE[43]=_H_STA1
ENDIF
IF _H_STA1<-270
_H_STA1=360+_H_STA1 _M_SPE[43]=_H_STA1
ENDIF
IF _H_STA1>270
_H_STA1=_H_STA1-360 _M_SPE[43]=_H_STA1
ENDIF
_KA1= -_M_SPE[61] + _H_STA1
IF _SETV[0]<0
_KA1=_KA1+180
ENDIF
_KA1=(_KA1+360) MOD 360
IF ((_SETV[0]>0) AND (_SETV[1]>0))
_MP_S[0] = SET (0,0,-90,-90,90-_INCA,0,-90,-270,1)
_KA2=_KA1+_INCA _SETV[4]=1
ENDIF
IF ((_SETV[0]<0) AND (_SETV[1]>0))
_MP_S[0] = SET (0,-180,90,90,-90+_INCA,0,270,90,2)
_KA2=_KA1-_INCA _SETV[4]=2
ENDIF
IF ((_SETV[0]<0) AND (_SETV[1]<0))
_MP_S[0] = SET (0,-180,90,90,-90-_INCA,90,-90,-270,3)
_KA2=_KA1+_INCA _SETV[4]=3
ENDIF
IF ((_SETV[0]>0) AND (_SETV[1]<0))
_MP_S[0] = SET (0,0,-90,-90,-270+_INCA,90,-90,90,4)
_KA2=_KA1-_INCA _SETV[4]=4
ENDIF
_KA2=(_KA2 +360) MOD 360
ENDIF
IF _ALARM GOTOF _ERR5
_ALARM=0
_FA1=_M_SPE[3] _FA2=_FA1
IF (((_KA1>=0)AND(_KA1<=45))OR((_KA1>315)AND(_KA1<=360)))
_MAKA1=2
ENDIF
IF ((_KA1>45)AND(_KA1<=135))
_MAKA1=1 _FA1=-_FA1
ENDIF
IF (_KA1>135)AND(_KA1<=225)
_MAKA1=2 _FA1=-_FA1
ENDIF
IF (_KA1>225)AND(_KA1<=315)
_MAKA1=1
ENDIF
IF ((_KA2>=0)AND(_KA2<=45))OR((_KA2>315)AND(_KA2<=360))
_MAKA2=2 _FA2=-_FA2
ENDIF
IF ((_KA2>45)AND(_KA2<=135))
_MAKA2=1
ENDIF
IF (_KA2>135)AND(_KA2<=225)
_MAKA2=2
ENDIF
IF (_KA2>225)AND(_KA2<=315)
_MAKA2=1 _FA2=-_FA2
ENDIF
IF ((_MVAR _DEC2)==0)
IF ((_SETV[0]<0) AND (_SETV[1]>0))
_FA1=-_FA1 _FA2=-_FA2
ENDIF
IF ((_SETV[0]>0) AND (_SETV[1]<0))
_FA1=-_FA1 _FA2=-_FA2
ENDIF
ENDIF
IF NOT(_NEW_PAR)
_SIC=10
ELSE
_SIC=($SCS_MEA_EDGE_SAVE_ANG + 360) MOD 360
ENDIF
IF _SIC>10
_SIC=10
ENDIF
_SIC1=_SIC _SIC2=_SIC
IF (_MVAR==105)OR(_MVAR==107)OR(_MVAR==117)
IF (_MP_S[8]==1)
_SIC2=-_SIC
ENDIF
IF (_MP_S[8]==2)
_SIC1=-_SIC
ENDIF
IF (_MP_S[8]==3)
_SIC2=-_SIC
ENDIF
IF (_MP_S[8]==4)
_SIC1=-_SIC
ENDIF
_FA1=-_FA1 _FA2=-_FA2 _MP_S[8]=_MP_S[8]+10
ELSE
IF (_MP_S[8]==1)
_SIC1=-_SIC
ENDIF
IF (_MP_S[8]==2)
_SIC2=-_SIC
ENDIF
IF (_MP_S[8]==3)
_SIC1=-_SIC
ENDIF
IF (_MP_S[8]==4)
_SIC2=-_SIC
ENDIF
ENDIF
IF ((_MVAR<=108)AND(_INCA<0))OR((_MVAR>108)AND(_D<0))
_FA1=-_FA1 _FA2=-_FA2 _SIC1=-_SIC1 _SIC2=-_SIC2
ENDIF
IF _MVAR>108 GOTOF _MA11
IF (_MP_S[8]==0) OR ((_MP_S[8] _DEC1)==1) OR ((_MP_S[8] _DEC1)==3)
_WIH=_KA1+_INCA/2
ENDIF
IF ((_MP_S[8] _DEC1)==2) OR ((_MP_S[8] _DEC1)==4)
_WIH=_KA1+_INCA/2+270
ENDIF
IF (_MVAR==106)OR(_MVAR==108)
_E_B=0 _M_SPE[42]=1 _M_SPE[47]=0
IF _WIH>180
_WIH=_WIH-180
ELSE
_WIH=_WIH+180
ENDIF
ELSE
IF (_MVAR==105)OR(_MVAR==107)
_E_B=1 _M_SPE[42]=-1 _M_SPE[47]=-180
ENDIF
ENDIF
IF _VB[2]==0
_KA1=_KA1+_SIC1 _KA2=_KA2+_SIC2
ENDIF
_KA1=(_KA1 + 360) MOD 360
_KA2=(_KA2 + 360) MOD 360
_WIH=(_WIH + 360) MOD 360
_MA11:
IF _MVAR<117
IF _SIC<>0
_FA1=_FA1+ABS(SIN(_SIC)*_SETV[0]/_M_SPE[29])*(_FA1/ABS(_FA1))
_FA2=_FA2+ABS(SIN(_SIC)*_SETV[1]/_M_SPE[29])*(_FA2/ABS(_FA2))
ENDIF
ENDIF
IF ABS(_M_SPE[3])>ABS(_FA1)
_FA1=ABS(_M_SPE[3])*_FA1/ABS(_FA1)
ENDIF
IF ABS(_M_SPE[3])>ABS(_FA2)
_FA2=ABS(_M_SPE[3])*_FA2/ABS(_FA2)
ENDIF
IF _MVAR<=108 GOTOF _MA2
_MAV=_XX _AXIND=0 _HM=_H_XX _HD=_SETV[2]/_M_SPE[29]-_M_SPE[5] _HDO=_SETV[3]/_M_SPE[29]-_M_SPE[6] _M_SPE[5]=SET(_SETV[2]/_M_SPE[29],_SETV[3]/_M_SPE[29]) _MP=2 _HF=_FA1*_M_SPE[60]
IF _MAKA1==2
_MAV=_YY _AXIND=1 _HM=_H_YY
ENDIF
_MA21:_M_SPE[17]=_M_SPE[17]+_HD*_DAT[0,1]+_HDO*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_HD*_DAT[0,2]+_HDO*_DAT[1,2] _M_SPE[19]=_M_SPE[19]+_HD*_DAT[0,3]+_HDO*_DAT[1,3] _H_I[0]=SET(_M_SPE[17],_M_SPE[18],_M_SPE[19])
IF _INTERN[40+2]==0 GOTOF _MA3
IF (_INTERN[68] == 0)
IF ((_NEW_PAR) AND (_ID==0) AND (_MP==3))
N241 G90 MEAS=_M_N[0] AX[_XX]=_S_A*_M_SPE[29] AX[_YY]=_S_O*_M_SPE[29] F=_M_SPE[1]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ENDIF
N240 G90 MEAS=_M_N[0] AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29] F=_M_SPE[1]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
N241 G90 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
IF (_NEW_PAR)
N250 G91 MEAS=_M_N[0] AX[_ZZ]=-_ID F=_M_SPE[2]
ELSE
N250 G91 MEAS=_M_N[0] AX[_ZZ]=_ID F=_M_SPE[2]
ENDIF
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
IF ((_NEW_PAR) AND (_ID==0) AND (_MP==3))
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG
N242 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_XX]=_S_A*_M_SPE[29] AX[_YY]=_S_O*_M_SPE[29] F=_M_SPE[1]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG
N243 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29] F=_M_SPE[1]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
N244 G90 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
IF (_NEW_PAR)
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG
N245 G91 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=-_ID F=_M_SPE[2]
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG
N245 G91 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=_ID F=_M_SPE[2]
ENDIF
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
GOTOF _MA4
_MA3:
IF ((_NEW_PAR) AND (_ID==0) AND (_MP==3))
IF (_INTERN[68] == 0)
N261 G90 MEAS=_M_N[0] AX[_XX]=_S_A*_M_SPE[29] AX[_YY]=_S_O*_M_SPE[29] F=_M_SPE[1]
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG
N262 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_XX]=_S_A*_M_SPE[29] AX[_YY]=_S_O*_M_SPE[29] F=_M_SPE[1]
STOPRE
ENDIF
ENDIF
N260 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29] F=_M_SPE[1]
N261 G90 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
IF (_NEW_PAR)
N270 G91 AX[_ZZ]=-_ID F=_M_SPE[2]
ELSE
N270 G91 AX[_ZZ]=_ID F=_M_SPE[2]
ENDIF
_VB[15]=1
_MA4:_M_SPE[10]=_M_SPE[5+_AXIND] _M_SPE[9]=_M_SPE[10]+_HF _M_SPE[17]=_M_SPE[17]+_ID/_M_SPE[29]*_DAT[2,1] _M_SPE[18]=_M_SPE[18]+_ID/_M_SPE[29]*_DAT[2,2] _M_SPE[19]=_M_SPE[19]+_ID/_M_SPE[29]*_DAT[2,3]
N280 _M_ME[11]=_M_SPE[10]+(_HF/2)
N290 CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _MAV==_XX
_MP_A[_MP]=_M_ME[8]-_M_SPE[27] _MP_O[_MP]=_M_SPE[6]-_M_SPE[28]
ELSE
_MP_A[_MP]=_M_SPE[5]-_M_SPE[27] _MP_O[_MP]=_M_ME[8]-_M_SPE[28]
ENDIF
_M_ME[8]=0 _M_ME[0]=SET(0,0) _ANZ=_ANZ+1 _M_SPE[17]=SET(_H_I[0],_H_I[1],_H_I[2])
IF (_INTERN[68] == 1)
IF _MAV==_XX
_MP_A_2[_MP]=_M_ME[28]-_M_SPE[71] _MP_O_2[_MP]=_M_SPE[6]-_M_SPE[72]
ELSE
_MP_A_2[_MP]=_M_SPE[5]-_M_SPE[71] _MP_O_2[_MP]=_M_ME[28]-_M_SPE[72]
ENDIF
_M_ME[28]=0 _M_ME[20]=SET(0,0)
ENDIF
IF (_NEW_PAR)
N300 G91 AX[_ZZ]=_ID F=_M_SPE[2]
ELSE
N300 G91 AX[_ZZ]=-_ID F=_M_SPE[2]
ENDIF
IF _VB[1]
G0
ELSE
G1 F=_M_SPE[1]
ENDIF
CASE _ANZ OF 2 GOTOF _MAP3 3 GOTOF _MAP4 4 GOTOF _MAP5
_MP=1 _HD=_SETV[0]/_M_SPE[29]-_M_SPE[5] _HDO=_SETV[1]/_M_SPE[29]-_M_SPE[6] _M_SPE[5]=SET(_SETV[0]/_M_SPE[29],_SETV[1]/_M_SPE[29])
GOTOB _MA21
_MAP3:_MAV=_XX _AXIND=0 _HM=_H_XX
IF _MAKA2==2
_MAV=_YY _AXIND=1 _HM=_H_YY
ENDIF
_MP=3 _HF=_FA2*_M_SPE[60] _HD=_SETV[4]-_M_SPE[5] _HDO=_SETV[5]-_M_SPE[6] _M_SPE[5]=SET(_SETV[4],_SETV[5])
GOTOB _MA21
_MAP4:_MP=4 _HD=_SETV[6]/_M_SPE[29]-_M_SPE[5] _HDO=_SETV[7]/_M_SPE[29]-_M_SPE[6] _M_SPE[5]=SET(_SETV[6]/_M_SPE[29],_SETV[7]/_M_SPE[29])
GOTOB _MA21
_MAP5:
GOTOF _M12A
GOTOF _MMEBER1
N1040 _MA2:
IF _VB[2]
_KF[0,0]=_M_SPE[61] _KF[0,2]=_KF[0,0] _KF[1,2]=_M_SPE[8]
_M_SPE[8]=_KF[0,0]-_H_STA1-_KF[0,0]
IF _INTERN[20+8]
_M_SPE[8]=_M_SPE[8]+_M_SPE[38]
ENDIF
_M_SPE[8]=((_M_SPE[8] MOD 360)+360) MOD 360
_MP_S[0]=_M_SPE[8]+ _MP_S[1] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF (_MP_S[8]==3) OR (_MP_S[8]==4)
_M_SPE[47]=180
ENDIF
IF (_MP_S[8]==13) OR (_MP_S[8]==14)
_M_SPE[47]=0
ENDIF
_MP_S[9]=$AA_IM[SPI($AC_MSNUM)]
IF _INTERN[40+18]
N1042 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1043 SUPA SPOS=DC(_MP_S[0])
ENDIF
_M_ZUST[2]=1 _H_STA1=(-(_H_STA1))+_KF[0,0]
ELSE
IF NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')
_KF[0,0]=_M_SPE[61] _KF[0,2]=_KF[0,0] _KF[1,2]=_M_SPE[8]
IF (_MP_S[8]==3) OR (_MP_S[8]==4)
_M_SPE[47]=180
ENDIF
IF (_MP_S[8]==13) OR (_MP_S[8]==14)
_M_SPE[47]=0
ENDIF
_MP_S[9]=$AA_IM[SPI($AC_MSNUM)]
ENDIF
ENDIF
N1045 G111 AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29]
IF _INTERN[40+2]==0 GOTOF _MM4
IF (_INTERN[68] == 0)
N1150 MEAS=_M_N[0] AP=_WIH RP=_H_I[3]*_M_SPE[29]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N1151 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AP=_WIH RP=_H_I[3]*_M_SPE[29]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
N1190 _MM4: G90 AP=_WIH RP=_H_I[3]*_M_SPE[29]
IF NOT(_NEW_PAR)
_M_SPE[5]=SET($AA_IW[_XX]/_H_XX,$AA_IW[_YY]/_H_YY)
ELSE
_M_SPE[5]=SET(S_SETV4/_H_XX,S_SETV5/_H_YY)
_M_SPE[5]=_M_SPE[5]/_M_SPE[29] _M_SPE[6]=_M_SPE[6]/_M_SPE[29]
ENDIF
_VB[15]=1 _H_I[0]=SET(_M_SPE[5],_M_SPE[6]) _M_SPE[45]=SET(_M_SPE[5],_M_SPE[6])
_MAV=_XX _HM=_H_XX
IF _MAKA1==2
_MAV=_YY _HM=_H_YY
ENDIF
_MP=2 _HKA=_KA1 _HRP=ABS(_SETV[0]) _HF=_FA1*_M_SPE[60] _M_SPE[40]=1
_M_SPE[41]=_M_SPE[43]+_M_SPE[47]
N1270 _MM6: G111 AX[_XX]=_M_SPE[45]*_M_SPE[29] AX[_YY]=_M_SPE[46]*_M_SPE[29]
IF _MP<>3
IF _INTERN[40+2]
IF (_INTERN[68] == 0)
N1272 G90 MEAS=_M_N[0] AP=_HKA RP=ABS(_HRP)
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N1273 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AP=_HKA RP=ABS(_HRP)
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
ELSE
N1274 G90 AP=_HKA RP=ABS(_HRP)
ENDIF
IF (_MP==2)
N1276 G90 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
ENDIF
IF (_NEW_PAR)
IF _INTERN[40+2]
IF (_INTERN[68] == 0)
G91 MEAS=_M_N[0] AX[_ZZ]=-_ID F=_M_SPE[2]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
G91 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=-_ID F=_M_SPE[2]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
ELSE
G91 AX[_ZZ]=-_ID F=_M_SPE[2]
ENDIF
ENDIF
IF _VB[2] AND(_MP==4)
_M_ZUST[2]=0 _H_STA1=(360-(_KA2+_KF[0,0]))+_KF[0,0]
ENDIF
ELSE
IF _INTERN[40+2]==0 GOTOF _MM8
IF (_INTERN[68] == 0)
N1490 G90 MEAS=_M_N[0] AP=_KA2 RP=ABS(_SETV_1) F=_M_SPE[1]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
IF (_ID==0) GOTOF _MM9
N1495 G91 MEAS=_M_N[0] AX[_ZZ]=-_ID F=_M_SPE[2]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N1491 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AP=_KA2 RP=ABS(_SETV_1) F=_M_SPE[1]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
IF (_ID==0) GOTOF _MM9
N1496 G91 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=-_ID F=_M_SPE[2]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
GOTOF _MM9
N1530 _MM8:G90 AP=_KA2 RP=ABS(_SETV_1) F=_M_SPE[1]
IF (_ID==0) GOTOF _MM9
N1560 G91 AX[_ZZ]=-_ID F=_M_SPE[2]
_MM9:_MAV=_XX _HM=_H_XX
IF _MAKA2==2
_MAV=_YY _HM=_H_YY
ENDIF
_HKA=_KA2 _HRP=ABS(_SETV_1) _HF=_FA2*_M_SPE[60]
IF _VB[2]
_M_ZUST[2]=0 _H_STA1=(360-(_KA2+_KF[0,0]))+_KF[0,0] _KF[0,2]=0
ELSE
IF NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')
_KF[0,2]=0
ENDIF
ENDIF
ENDIF
_M_SPE[10]=$AA_IW[_MAV]/_HM _M_SPE[9]=_M_SPE[10]+_HF _M_SPE[17]=SET($AA_IM[_XX],$AA_IM[_YY],$AA_IM[_ZZ]) _M_SPE[5]=SET($AA_IW[_XX]/_H_XX,$AA_IW[_YY]/_H_YY,$AA_IW[_ZZ]/_H_ZZ)
N1271 _M_ME[11]=_M_SPE[10]+(_HF/2)
CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF,_H_STA1)
IF _ALARM GOTOF _ERR5
IF (_NEW_PAR)
IF _INTERN[40+2]
IF (_INTERN[68] == 0)
N251 G91 MEAS=_M_N[0] AX[_ZZ]=_ID F=_M_SPE[2]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N252 G91 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=_ID F=_M_SPE[2]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
ELSE
N251 G91 AX[_ZZ]=_ID F=_M_SPE[2]
ENDIF
ENDIF
IF _VB[2]
IF _MAV==_XX
_MP_A[_MP]=_M_ME[8] _MP_O[_MP]=_M_ME[9]
ELSE
_MP_A[_MP]= _M_ME[9] _MP_O[_MP]=_M_ME[8]
ENDIF
ELSE
IF _MAV==_XX
_MP_A[_MP]=_M_ME[8]-_M_SPE[27] _MP_O[_MP]=$AA_IW[_YY]/_H_YY -_M_SPE[28]
ELSE
_MP_A[_MP]=$AA_IW[_XX]/_H_XX -_M_SPE[27] _MP_O[_MP]=_M_ME[8]-_M_SPE[28]
ENDIF
ENDIF
IF (_INTERN[68] == 1)
IF _VB[2]
IF _MAV==_XX
_MP_A_2[_MP]=_M_ME[28] _MP_O_2[_MP]=_M_ME[29]
ELSE
_MP_A_2[_MP]= _M_ME[29] _MP_O_2[_MP]=_M_ME[28]
ENDIF
ELSE
IF _MAV==_XX
_MP_A_2[_MP]=_M_ME[28]-_M_SPE[71] _MP_O_2[_MP]=$AA_IW[_YY]/_H_YY -_M_SPE[72]
ELSE
_MP_A_2[_MP]=$AA_IW[_XX]/_H_XX -_M_SPE[71] _MP_O_2[_MP]=_M_ME[28]-_M_SPE[72]
ENDIF
ENDIF
_M_ME[28]= SET(0,0) _M_ME[20]=SET(0,0)
ENDIF
_M_ME[8]= SET(0,0) _M_ME[0]=SET(0,0) _ANZ=_ANZ+1
IF _VB[1]
G0
ELSE
G1 F=_M_SPE[1]
ENDIF
CASE _ANZ OF 2 GOTOF _MMP3 3 GOTOF _MMP4 4 GOTOF _M12
_MP=1 _HRP=ABS(_SETV_0) _M_SPE[40]=-1 _M_SPE[41]=(180+_M_SPE[43])+_M_SPE[47]
IF _VB[2]
_MP_S[0]=_M_SPE[8]+ _MP_S[2] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF _INTERN[40+18]
N1042 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1043 SUPA SPOS=DC(_MP_S[0])
ENDIF
ENDIF
GOTOB _MM6
_MMP3: IF (_MVAR==105)OR(_MVAR==107)OR(_ID==0)OR(_NEW_PAR) GOTOF _MMP31
IF _INTERN[40+2]==0 GOTOF _MMP30
IF (_INTERN[68] == 0)
N1430 G91 MEAS=_M_N[0] AX[_ZZ]=_ID F=_M_SPE[2]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N1431 G91 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_ZZ]=_ID F=_M_SPE[2]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
GOTOF _MMP32
N1435 _MMP30: G91 AX[_ZZ]=_ID F=_M_SPE[2]
GOTOF _MMP32
N1460 _MMP31:_M_SPE[5]=SET(_H_I[0],_H_I[1])
IF _VB[2]
_MP_S[0]=_M_SPE[8]+_MP_S[3] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF _INTERN[40+18]
N1045 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1046 SUPA SPOS=DC(_MP_S[0])
ENDIF
ENDIF
IF _ID==0
IF _INTERN[40+2]
IF (_INTERN[68] == 0)
N1442 G90 MEAS=_M_N[0] AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N1442 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
ELSE
N1442 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
ENDIF
IF _VB[2]
_MP_S[0]=_M_SPE[8]+_MP_S[4] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF (_MP_S[8]==2)
_M_SPE[47]=180
ENDIF
IF (_MP_S[8]==3) OR (_MP_S[8]==12)
_M_SPE[47]=0
ENDIF
IF (_MP_S[8]==13)
_M_SPE[47]=180
ENDIF
IF _INTERN[40+18]
N1047 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1048 SUPA SPOS=DC(_MP_S[0])
ENDIF
ELSE
IF NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')
IF (_MP_S[8]==2)
_M_SPE[47]=180
ENDIF
IF (_MP_S[8]==3) OR (_MP_S[8]==12)
_M_SPE[47]=0
ENDIF
IF (_MP_S[8]==13)
_M_SPE[47]=180
ENDIF
ENDIF
ENDIF
GOTOF _MMP33
_MMP32:
IF _VB[2]
_KF[1,0]=SQRT(POT(_SETV_1)+POT(_SETV_0)-(2*(_SETV_1)*(_SETV_0)*(COS(_INCA))))
_KF[1,1]=ASIN(((_SETV_1)*(SIN(_INCA)))/_KF[1,0])
_MP_S[0]=_M_SPE[8]+_MP_S[5]-_KF[1,1] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF (_MP_S[8]==2)
_M_SPE[47]=180
ENDIF
IF (_MP_S[8]==3)
_M_SPE[47]=0
ENDIF
IF _INTERN[40+18]
N1049 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1050 SUPA SPOS=DC(_MP_S[0])
ENDIF
ELSE
IF NOT($SNS_MEA_FUNCTION_MASK B_AND 'B1000000')
_KF[1,0]=SQRT(POT(_SETV_1)+POT(_SETV_0)-(2*(_SETV_1)*(_SETV_0)*(COS(_INCA))))
_KF[1,1]=ASIN(((_SETV_1)*(SIN(_INCA)))/_KF[1,0])
IF (_MP_S[8]==2)
_M_SPE[47]=180
ENDIF
IF (_MP_S[8]==3)
_M_SPE[47]=0
ENDIF
ENDIF
ENDIF
_MMP33: _MP=3 _M_SPE[40]=1 _M_SPE[41]=(_KA2-180)+_M_SPE[47]
GOTOB _MM6
_MMP4: IF (_MVAR==105)OR(_MVAR==106) GOTOF _M12
_MP=4 _HRP=ABS(_SETV[1])
IF _VB[2]
_MP_S[0]=_M_SPE[8]+_MP_S[6] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF _INTERN[40+18]
N1051 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1052 SUPA SPOS=DC(_MP_S[0])
ENDIF
ENDIF
GOTOB _MM6
N1830 _M12:
IF _VB[2]
_MP_S[0]=_M_SPE[8]+_MP_S[7] _MP_S[0]=((_MP_S[0] MOD 360)+360) MOD 360
IF _INTERN[40+18]
N1047 CUST_MEACYC(3,_MP_S[0],0)
ELSE
N1048 SUPA SPOS=DC(_MP_S[0])
ENDIF
ENDIF
IF _INTERN[40+2]
IF (_INTERN[68] == 0)
N1442 G90 MEAS=_M_N[0] AX[_XX]=_H_I[0]*_M_SPE[29] AX[_YY]=_H_I[1]*_M_SPE[29]
IF $AC_MEA[ABS(_M_N[0])] GOTOF _ERR1
ELSE
N1443 G90 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) AX[_XX]=_H_I[0]*_M_SPE[29] AX[_YY]=_H_I[1]*_M_SPE[29]
IF ($AC_MEA[ABS(_M_N[0])] OR $AC_MEA[ABS(_M_N[30])]) GOTOF _ERR1
ENDIF
ELSE
G90 AX[_XX]=_H_I[0]*_M_SPE[29] AX[_YY]=_H_I[1]*_M_SPE[29]
ENDIF
IF _VB[2]
_MP_S[0]=$AA_IM[SPI($AC_MSNUM)]
_MP_S[10]=ABS(_MP_S[9] MOD 360)
IF _MP_S[9] > _MP_S[0]
IF _INTERN[40+18]
N2010 CUST_MEACYC(3,_MP_S[0],1)
ELSE
N2011 SUPA SPOS=ACP(_MP_S[10])
ENDIF
ELSE
IF _INTERN[40+18]
N2010 CUST_MEACYC(3,_MP_S[0],2)
ELSE
N2011 SUPA SPOS=ACN(_MP_S[10])
ENDIF
ENDIF
ENDIF
_M12A:
IF _M_N[18] ==1
_WI1=_STA1 _OVR[4]=_WI1
IF (_MVAR==107)OR(_MVAR==108)OR(_MVAR>108)
_WI2=_WI1+_INCA
ELSE
_WI2=_WI1+90
ENDIF
ELSE
IF NOT(_NEW_PAR)
_WI1=ATAN2((_MP_O[2]-_MP_O[1]),(_MP_A[2]-_MP_A[1])) _OVR[4]=_WI1
ELSE
IF (_MP_A[2] > _MP_A[1])
_WI1=ATAN2((_MP_O[2]-_MP_O[1]),(_MP_A[2]-_MP_A[1])) _OVR[4]=_WI1
ELSE
_WI1=ATAN2((_MP_O[1]-_MP_O[2]),(_MP_A[1]-_MP_A[2])) _OVR[4]=_WI1
ENDIF
ENDIF
IF (_MVAR==107)OR(_MVAR==108)OR(_MVAR>108)
IF NOT(_NEW_PAR)
_WI2=ATAN2((_MP_O[4]-_MP_O[3]),(_MP_A[4]-_MP_A[3]))
ELSE
IF (_MP_O[4] > _MP_O[3])
_WI2=ATAN2((_MP_O[4]-_MP_O[3]),(_MP_A[4]-_MP_A[3]))
ELSE
_WI2=ATAN2((_MP_O[3]-_MP_O[4]),(_MP_A[3]-_MP_A[4]))
ENDIF
ENDIF
ELSE
_WI2=_WI1+90
ENDIF
ENDIF
_WI11=_WI1 _WI22=_WI2
IF (_INTERN[68] == 1)
IF NOT(_NEW_PAR)
_WI1_2=ATAN2((_MP_O_2[2]-_MP_O_2[1]),(_MP_A_2[2]-_MP_A_2[1])) _OVR[104]=_WI1_2
ELSE
IF (_MP_A_2[2] > _MP_A_2[1])
_WI1_2=ATAN2((_MP_O_2[2]-_MP_O_2[1]),(_MP_A_2[2]-_MP_A_2[1])) _OVR[104]=_WI1_2
ELSE
_WI1_2=ATAN2((_MP_O_2[1]-_MP_O_2[2]),(_MP_A_2[1]-_MP_A_2[2])) _OVR[104]=_WI1_2
ENDIF
ENDIF
IF (_MVAR==107)OR(_MVAR==108)OR(_MVAR>108)
IF NOT(_NEW_PAR)
_WI2_2=ATAN2((_MP_O_2[4]-_MP_O_2[3]),(_MP_A_2[4]-_MP_A_2[3]))
ELSE
IF (_MP_O_2[4] > _MP_O_2[3])
_WI2_2=ATAN2((_MP_O_2[4]-_MP_O_2[3]),(_MP_A_2[4]-_MP_A_2[3]))
ELSE
_WI2_2=ATAN2((_MP_O_2[3]-_MP_O_2[4]),(_MP_A_2[3]-_MP_A_2[4]))
ENDIF
ENDIF
ELSE
_WI2_2=_WI1_2+90
ENDIF
_WI11_2=_WI1_2 _WI22_2=_WI2_2
ENDIF
_MMEBER1:
IF _WI1 >=0
IF _WI1 >=180
_WI11=_WI1-180
ENDIF
IF _WI11 >90
_WI11=_WI11-180
ENDIF
ELSE
IF _WI1 <=-90
_WI11=_WI1+180
ENDIF
IF _WI11 <=-90
_WI11=_WI11+180
ENDIF
ENDIF
_COS_2=POT(COS(_WI11)) _SIN_2=POT(SIN(_WI11))
IF (_WI11<=0)AND(_FA1>0)
_TRIGG=_M_SPE[24]*_COS_2+_M_SPE[22]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI11) _MP_O[0]=-_TRIGG*COS(_WI11)
ELSE
IF (_WI11<=0)AND(_FA1<0)
_TRIGG=_M_SPE[23]*_COS_2+_M_SPE[21]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI11) _MP_O[0]=-_TRIGG*COS(_WI11)
ELSE
IF (_WI11>0)AND(((_FA1>0)AND(_MAKA1==2))OR((_FA1<0)AND(_MAKA1==1)))
_TRIGG=_M_SPE[24]*_COS_2-_M_SPE[21]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI11) _MP_O[0]=-_TRIGG*COS(_WI11)
ELSE
_TRIGG=_M_SPE[23]*_COS_2-_M_SPE[22]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI11) _MP_O[0]=-_TRIGG*COS(_WI11)
ENDIF
ENDIF
ENDIF
_MP_A[1]=_MP_A[1]+_MP_A[0] _MP_A[2]=_MP_A[2]+_MP_A[0] _MP_O[1]=_MP_O[1]+_MP_O[0] _MP_O[2]=_MP_O[2]+_MP_O[0]
IF _WI2 >=0
IF _WI2 >=180
_WI22=_WI22-180
ENDIF
IF _WI22 >90
_WI22=_WI22-180
ENDIF
ELSE
IF _WI2 <=-90
_WI22=_WI22+180
ENDIF
IF _WI22 <=-90
_WI22=_WI22+180
ENDIF
ENDIF
_COS_2=POT(COS(_WI22)) _SIN_2=POT(SIN(_WI22))
IF (_WI22<=0)AND(_FA2>0)
_TRIGG=_M_SPE[24]*_COS_2+_M_SPE[22]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI22) _MP_O[0]=-_TRIGG*COS(_WI22)
ELSE
IF (_WI22<=0)AND(_FA2<0)
_TRIGG=_M_SPE[23]*_COS_2+_M_SPE[21]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI22) _MP_O[0]=-_TRIGG*COS(_WI22)
ELSE
IF (_WI22>0)AND(((_FA2>0)AND(_MAKA2==2))OR((_FA2<0)AND(_MAKA2==1)))
_TRIGG=_M_SPE[24]*_COS_2-_M_SPE[21]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI22) _MP_O[0]=-_TRIGG*COS(_WI22)
ELSE
_TRIGG=_M_SPE[23]*_COS_2-_M_SPE[22]*_SIN_2 _MP_A[0]=_TRIGG*SIN(_WI22) _MP_O[0]=-_TRIGG*COS(_WI22)
ENDIF
ENDIF
ENDIF
_MP_A[3]=_MP_A[3]+_MP_A[0] _MP_O[3]=_MP_O[3]+_MP_O[0]
_OVR[5]= ((_MP_O[1]-TAN(_WI1)*_MP_A[1])-(_MP_O[3]-TAN(_WI2)*_MP_A[3]))/(TAN(_WI2)-TAN(_WI1))
_OVR[6]=(((_MP_O[1]-TAN(_WI1)*_MP_A[1])*TAN(_WI2))-((_MP_O[3]-TAN(_WI2)*_MP_A[3])*TAN(_WI1)))/(TAN(_WI2)-TAN(_WI1))
IF (_INTERN[68] == 1)
IF (_WI1_2 >= 0)
IF (_WI1_2 >= 180)
_WI11_2 = _WI1_2 - 180
ENDIF
IF (_WI11_2 > 90)
_WI11_2 = _WI11_2 - 180
ENDIF
ELSE
IF (_WI1_2 <= -90)
_WI11_2 = _WI1_2 + 180
ENDIF
IF (_WI11_2 <= -90)
_WI11_2 = _WI11_2 + 180
ENDIF
ENDIF
_COS_2_2 = POT(COS(_WI11_2)) _SIN_2_2 = POT(SIN(_WI11_2))
IF (_WI11_2<=0) AND (_FA1>0)
_TRIGG_2=_M_SPE[68]*_COS_2_2+_M_SPE[66]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI11_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI11_2)
ELSE
IF (_WI11_2<=0) AND (_FA1<0)
_TRIGG_2=_M_SPE[67]*_COS_2_2+_M_SPE[65]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI11_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI11_2)
ELSE
IF (_WI11_2>0) AND (((_FA1>0) AND (_MAKA1==2)) OR ((_FA1<0) AND (_MAKA1==1)))
_TRIGG_2=_M_SPE[68]*_COS_2_2-_M_SPE[65]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI11_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI11_2)
ELSE
_TRIGG_2=_M_SPE[67]*_COS_2_2-_M_SPE[66]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI11_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI11_2)
ENDIF
ENDIF
ENDIF
_MP_A_2[1]=_MP_A_2[1]+_MP_A_2[0] _MP_A_2[2]=_MP_A_2[2]+_MP_A_2[0] _MP_O_2[1]=_MP_O_2[1]+_MP_O_2[0] _MP_O_2[2]=_MP_O_2[2]+_MP_O_2[0]
IF (_WI2_2 >= 0)
IF (_WI2_2 >= 180)
_WI22_2 = _WI22_2 - 180
ENDIF
IF (_WI22_2 > 90)
_WI22_2 = _WI22_2 - 180
ENDIF
ELSE
IF (_WI2_2 <= -90)
_WI22_2 = _WI22_2 + 180
ENDIF
IF (_WI22_2 <= -90)
_WI22_2 = _WI22_2 + 180
ENDIF
ENDIF
_COS_2_2=POT(COS(_WI22_2)) _SIN_2_2=POT(SIN(_WI22_2))
IF (_WI22_2<=0) AND (_FA2>0)
_TRIGG_2=_M_SPE[68]*_COS_2_2+_M_SPE[66]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI22_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI22_2)
ELSE
IF (_WI22_2<=0) AND (_FA2<0)
_TRIGG_2=_M_SPE[67]*_COS_2_2+_M_SPE[65]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI22_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI22_2)
ELSE
IF (_WI22_2>0) AND (((_FA2>0) AND (_MAKA2==2)) OR ((_FA2<0) AND (_MAKA2==1)))
_TRIGG_2=_M_SPE[68]*_COS_2_2-_M_SPE[65]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI22_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI22_2)
ELSE
_TRIGG_2=_M_SPE[67]*_COS_2_2-_M_SPE[66]*_SIN_2_2 _MP_A_2[0]=_TRIGG_2*SIN(_WI22_2) _MP_O_2[0]=-_TRIGG_2*COS(_WI22_2)
ENDIF
ENDIF
ENDIF
_MP_A_2[3]=_MP_A_2[3]+_MP_A_2[0] _MP_O_2[3]=_MP_O_2[3]+_MP_O_2[0]
_OVR[105]=((_MP_O_2[1]-TAN(_WI1_2)*_MP_A_2[1])-(_MP_O_2[3]-TAN(_WI2_2)*_MP_A_2[3]))/(TAN(_WI2_2)-TAN(_WI1_2))
_OVR[106]=(((_MP_O_2[1]-TAN(_WI1_2)*_MP_A_2[1])*TAN(_WI2_2))-((_MP_O_2[3]-TAN(_WI2_2)*_MP_A_2[3])*TAN(_WI1_2)))/(TAN(_WI2_2)-TAN(_WI1_2))
_MP_S[17]=_OVR[105] _MP_S[18]=_OVR[106]
ENDIF
GOTOF ECKE_MANI
_MEASCORR: $AC_MEAS_SEMA=1 $AC_MEAS_VALID=0 $AC_MEAS_TOOL_MASK=11
$AA_MEAS_POINT1[_XX]= _MP_A[1] $AA_MEAS_POINT1[_YY]= _MP_O[1] $AA_MEAS_POINT1[_ZZ]=_M_SPE[7]
$AA_MEAS_POINT2[_XX]= _MP_A[2] $AA_MEAS_POINT2[_YY]= _MP_O[2] $AA_MEAS_POINT2[_ZZ]=_M_SPE[7]
$AA_MEAS_POINT3[_XX]= _MP_A[3] $AA_MEAS_POINT3[_YY]= _MP_O[3] $AA_MEAS_POINT3[_ZZ]=_M_SPE[7]
$AA_MEAS_POINT4[_XX]= _MP_A[4] $AA_MEAS_POINT4[_YY]= _MP_O[4] $AA_MEAS_POINT4[_ZZ]=_M_SPE[7]
IF (_MVAR==105)OR(_MVAR==106)
$AC_MEAS_CORNER_SETANGLE=90
ENDIF
$AC_MEAS_TYPE=4 $AC_MEAS_INPUT[0]=_E_B
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR9
_OVR[7]=$AC_MEAS_CORNER_ANGLE _WI11=$AC_MEAS_RESULTS[0] _WI22=$AC_MEAS_RESULTS[1]
_OVR[5]=_WI11 -((_M_SPE[22]/SIN(_OVR[7]/2))*(COS(_WI1 +(_OVR[7]/2))))*_M_SPE[42]
_OVR[6]=_WI22 -((_M_SPE[22]/SIN(_OVR[7]/2))*(SIN(_WI1 +(_OVR[7]/2))))*_M_SPE[42]
_MP_S[15]=_OVR[5] _MP_S[16]=_OVR[6]
IF (_INTERN[68] == 1)
$AA_MEAS_POINT1[_XX]= _MP_A_2[1] $AA_MEAS_POINT1[_YY]= _MP_O_2[1] $AA_MEAS_POINT1[_ZZ]=_M_SPE[7]
$AA_MEAS_POINT2[_XX]= _MP_A_2[2] $AA_MEAS_POINT2[_YY]= _MP_O_2[2] $AA_MEAS_POINT2[_ZZ]=_M_SPE[7]
$AA_MEAS_POINT3[_XX]= _MP_A_2[3] $AA_MEAS_POINT3[_YY]= _MP_O_2[3] $AA_MEAS_POINT3[_ZZ]=_M_SPE[7]
$AA_MEAS_POINT4[_XX]= _MP_A_2[4] $AA_MEAS_POINT4[_YY]= _MP_O_2[4] $AA_MEAS_POINT4[_ZZ]=_M_SPE[7]
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR9
_OVR[107]=$AC_MEAS_CORNER_ANGLE _WI11_2=$AC_MEAS_RESULTS[0] _WI22_2=$AC_MEAS_RESULTS[1]
_OVR[105]=_WI11_2 -((_M_SPE[66]/SIN(_OVR[107]/2))*(COS(_WI1_1 +(_OVR[107]/2))))*_M_SPE[42]
_OVR[106]=_WI22_2 -((_M_SPE[66]/SIN(_OVR[107]/2))*(SIN(_WI1_1 +(_OVR[107]/2))))*_M_SPE[42]
_MP_S[17]=_OVR[105] _MP_S[18]=_OVR[106]
ENDIF
ECKE_MANI:
IF NOT(_NEW_PAR)
_MP_S[15]=_OVR[5] _MP_S[16]=_OVR[6]
IF (_MVAR==105)OR(_MVAR==106)
_SETV[4]=TRUNC(_SETV[4])
IF (_SETV[4]>1)AND(_SETV[4]<=4)
IF _SETV[4]==2
_OVR[5]=_OVR[5]+_SETV[2]*COS(_WI1)/_M_SPE[29] _OVR[6]=_OVR[6]+_SETV[2]*SIN(_WI1)/_M_SPE[29]
ENDIF
IF _SETV[4]==4
_OVR[5]=_OVR[5]+_SETV[3]*COS(_WI2)/_M_SPE[29] _OVR[6]=_OVR[6]+_SETV[3]*SIN(_WI2)/_M_SPE[29]
ENDIF
IF _SETV[4]==3
_OVR[5]=_OVR[5]+(_SETV[2]*COS(_WI1)+_SETV[3]*COS(_WI2))/_M_SPE[29] _OVR[6]=_OVR[6]+(_SETV[2]*SIN(_WI1)+_SETV[3]*SIN(_WI2))/_M_SPE[29]
ENDIF
_MP_S[15]=_OVR[5] _MP_S[16]=_OVR[6]
ENDIF
ENDIF
ELSE
_OVR[8]=_WI2 - _WI1
IF (S_KNUM >0)
_SETV[2]=-S_SETV8 _SETV[3]=-S_SETV9
_WI2=_WI1+90
_MP_S[15]=_OVR[5]+(_SETV[2]*COS(_WI1)+_SETV[3]*COS(_WI2))/_M_SPE[29] _MP_S[16]=_OVR[6]+(_SETV[2]*SIN(_WI1)+_SETV[3]*SIN(_WI2))/_M_SPE[29]
ENDIF
ENDIF
_WI1=_M_SPE[61]+_OVR[4]
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XX]=_OVR[5]
$AA_MEAS_POINT1[_YY]=_OVR[6]
$AA_MEAS_POINT1[_ZZ]=$AA_IW[_ZZ]
$AC_MEAS_P1_COORD=0
IF (_M_N[19] _DEC4)
$AC_MEAS_P2_COORD=1
ELSE
$AC_MEAS_P2_COORD=2
ENDIF
$AC_MEAS_TYPE=24
_OVI[12]=MEASURE()
$AC_MEAS_SEMA=0
IF _OVI[12] GOTOF _ERR9
_P_ABS=$AA_MEAS_POINT2[_XX] _P_ORD=$AA_MEAS_POINT2[_YY]
_OVR[20]=SET(_WI1,_P_ABS,_P_ORD)
IF _H_DMODE <0
_ALARM=62303 _OVI[9]=_ALARM
_OVR[17]=_OVR[5]-_OVR[1] _OVR[18]=_OVR[6]-_OVR[2]
IF (ABS(_OVR[17]) > _M_SPE[32]) GOTOF _ERR999
IF (ABS(_OVR[18]) > _M_SPE[32]) GOTOF _ERR999
_ALARM=0 _OVI[9]=0
ENDIF
IF (_INTERN[68] == 1)
IF NOT(_NEW_PAR)
IF (_MVAR==105) OR (_MVAR==106)
IF (_SETV[4]>1) AND (_SETV[4]<=4)
IF _SETV[4]==2
_OVR[105]=_OVR[105]+_SETV[2]*COS(_WI1_2)/_M_SPE[29] _OVR[106]=_OVR[106]+_SETV[2]*SIN(_WI1_2)/_M_SPE[29]
ENDIF
IF _SETV[4]==4
_OVR[105]=_OVR[105]+_SETV[3]*COS(_WI2_2)/_M_SPE[29] _OVR[106]=_OVR[106]+_SETV[3]*SIN(_WI2_2)/_M_SPE[29]
ENDIF
IF _SETV[4]==3
_OVR[105]=_OVR[105]+(_SETV[2]*COS(_WI1_2)+_SETV[3]*COS(_WI2_2))/_M_SPE[29] _OVR[106]=_OVR[106]+(_SETV[2]*SIN(_WI1_2)+_SETV[3]*SIN(_WI2_2))/_M_SPE[29]
ENDIF
_MP_S[17]=_OVR[105] _MP_S[18]=_OVR[106]
ENDIF
ENDIF
ELSE
_OVR[108]=_WI2_2 - _WI1_2
IF (S_KNUM >0)
_WI2_2=_WI1_2+90
_OVR[105]=_OVR[105]+(_SETV[2]*COS(_WI1_2)+_SETV[3]*COS(_WI2_2))/_M_SPE[29] _OVR[106]=_OVR[106]+(_SETV[2]*SIN(_WI1_2)+_SETV[3]*SIN(_WI2_2))/_M_SPE[29]
ENDIF
ENDIF
_WI1_2=_M_SPE[61]+_OVR[104]
$AA_MEAS_POINT1[_XX]=_OVR[105]
$AA_MEAS_POINT1[_YY]=_OVR[106]
_OVI[12]=MEASURE()
$AC_MEAS_SEMA=0
IF _OVI[12] GOTOF _ERR9
_P_ABS_2=$AA_MEAS_POINT2[_XX] _P_ORD_2=$AA_MEAS_POINT2[_YY]
_OVR[120]=SET(_WI1_2,_P_ABS_2,_P_ORD_2)
ENDIF
IF (_KNUM<0) OR ((_KNUM>1049)AND(_KNUM<2000)) GOTOF _ERR8
IF _KNUM
_A_NPV=$P_GG[8] _POS_A[0]=SET($AA_IW[_XX],$AA_IW[_YY],$AA_IW[_ZZ])
IF (_KNUM < 1000) OR (_KNUM==1000) OR (_KNUM==9999)
_COR_STAT=1 _FRSEL=99 + _A_NPV
IF _KNUM<1000
IF ($MN_MM_NUM_GLOBAL_USER_FRAMES>0)
GOTOF _ERR8
ENDIF
IF _KNUM>=$MC_MM_NUM_USER_FRAMES
GOTOF _ERR8
ELSE
_K_NPV=_KNUM
ENDIF
ELSE
IF (_KNUM==1000)
IF $MC_MM_NUM_BASE_FRAMES>0
_K_NPV=0 _M_BFNR=$MC_MM_NUM_BASE_FRAMES-1
ELSE
GOTOF _ERR8
ENDIF
ELSE
_K_NPV=_A_NPV-1
IF _A_NPV==1
IF ($P_CHBFRMASK==0)OR($MC_MM_NUM_BASE_FRAMES==0)
_ALARM=61321
ELSE
_HI[2]=0 _HI[3]=1 _M_BFNR=$MC_MM_NUM_BASE_FRAMES
FOR _HI[4]=1 TO _M_BFNR
IF ($P_CHBFRMASK B_AND _HI[3])
_HI[2]=_HI[4]-1
ENDIF
_HI[3]=_HI[3]*2
ENDFOR
_M_BFNR=_HI[2] _FRSEL=_M_BFNR+10 _COR_STAT=0
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _KNUM==2000
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')
_FRSEL=0
ELSE
GOTOF _ERR8
ENDIF
ELSE
IF ((_KNUM>1010)AND(_KNUM<=($MC_MM_NUM_BASE_FRAMES+1010)))
_M_BFNR=_KNUM-1011 _FRSEL=_M_BFNR+10
ELSE
GOTOF _ERR8
ENDIF
ENDIF
ENDIF
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0 $AC_MEAS_TOOL_MASK=11
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0
$AC_MEAS_TYPE=20
$AA_MEAS_POINT1[_XX]=_MP_S[15] $AA_MEAS_POINT1[_YY]=_MP_S[16] $AA_MEAS_POINT1[_ZZ]=$AA_IW[_ZZ]
$AA_MEAS_SETPOINT[_XX]=0 $AA_MEAS_SETPOINT[_YY]=0
$AC_MEAS_FRAME_SELECT=_FRSEL
$AC_MEAS_FINE_TRANS=0
IF ((_NEW_PAR) AND (_INTERN[40+21]==0) AND $MN_MM_FRAME_FINE_TRANS)
$AC_MEAS_FINE_TRANS=1
ENDIF
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR9
IF _COR_STAT
_RET_FR=$P_IFRAME
$P_IFRAME=$AC_MEAS_FRAME
ELSE
IF _KNUM==2000
_RET_FR=$P_SETFRAME
$P_SETFRAME=$AC_MEAS_FRAME
ELSE
_RET_FR=$P_CHBFRAME[_M_BFNR]
$P_CHBFRAME[_M_BFNR]=$AC_MEAS_FRAME
ENDIF
ENDIF
STOPRE
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XX]=_MP_A[1] $AA_MEAS_POINT1[_YY]=_MP_O[1]
$AA_MEAS_POINT2[_XX]=_MP_A[2] $AA_MEAS_POINT2[_YY]=_MP_O[2]
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0 $AC_MEAS_TYPE=16
$AC_MEAS_FRAME_SELECT=_FRSEL
$AC_MEAS_FINE_TRANS=0
_OVI[12]=MEASURE()
STOPRE
$AC_MEAS_SEMA=0
IF _OVI[12]<>0 GOTOF _ERR9
IF _COR_STAT
IF ((_NEW_PAR) AND (_INTERN[40+21]==0) AND ($MN_MM_FRAME_FINE_TRANS))
IF $AC_MEAS_FRAME[_XX,FI]<>0
$P_IFRAME[_XX,TR]=_RET_FR[_XX,TR]
$P_IFRAME[_XX,FI]=$AC_MEAS_FRAME[_XX,FI]-_RET_FR[_XX,TR]
ENDIF
IF $AC_MEAS_FRAME[_YY,FI]<>0
$P_IFRAME[_YY,TR]=_RET_FR[_YY,TR]
$P_IFRAME[_YY,FI]=$AC_MEAS_FRAME[_YY,FI]-_RET_FR[_YY,TR]
ENDIF
$P_IFRAME[_ZZ,RT]=$AC_MEAS_FRAME[_ZZ,RT]
$P_IFRAME[_YY,RT]=$AC_MEAS_FRAME[_YY,RT]
$P_IFRAME[_XX,RT]=$AC_MEAS_FRAME[_XX,RT] _HSTR_PROT="FI"
ELSE
$P_IFRAME=$AC_MEAS_FRAME _HSTR_PROT="TR"
ENDIF
STOPRE
IF _K_NPV==0
$P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
_PROTVAL[25] =SET("$P_CHBFR["<<_M_BFNR<<",,TR]","","","") _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",2,,,F"<<_M_SPE[0]
ELSE
$P_UIFR[_K_NPV]=$P_IFRAME
_PROTVAL[25] =SET("$P_UIFR["<<_K_NPV<<",,"<<SUBSTR(_HSTR_PROT,0,2)<<"]","","","","") _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_K_NPV<<",2,,,F"<<_M_SPE[0]
ENDIF
ELSE
IF _KNUM==2000
$P_SETFRAME=$AC_MEAS_FRAME _HSTR_PROT="TR"
IF ((_NEW_PAR) AND (_INTERN[40+21]==0) AND ($MN_MM_FRAME_FINE_TRANS))
_HSTR_PROT="FI"
IF $AC_MEAS_FRAME[_XX,FI]<>0
$P_SETFRAME[_XX,FI]=$P_SETFRAME[_XX,FI]+$P_SETFRAME[_XX,TR]-_RET_FR[_XX,TR]
$P_SETFRAME[_XX,TR]=_RET_FR[_XX,TR]
ENDIF
IF $AC_MEAS_FRAME[_YY,FI]<>0
$P_SETFRAME[_YY,FI]=$P_SETFRAME[_YY,FI]+$P_SETFRAME[_YY,TR]-_RET_FR[_YY,TR]
$P_SETFRAME[_YY,TR]=_RET_FR[_YY,TR]
ENDIF
ENDIF
$P_SETFR=$P_SETFRAME
_PROTVAL[25]=SET("$P_SETFR[,"<<_HSTR_PROT<<"]","","","","") _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<",,2,,,F"<<_M_SPE[0]
ELSE
$P_CHBFRAME[_M_BFNR]=$AC_MEAS_FRAME _HSTR_PROT="TR"
IF ((_NEW_PAR) AND (_INTERN[40+21]==0) AND ($MN_MM_FRAME_FINE_TRANS))
_HSTR_PROT="FI"
IF $AC_MEAS_FRAME[_XX,FI]<>0
$P_CHBFRAME[_M_BFNR,_XX,FI]=$P_CHBFRAME[_M_BFNR,_XX,FI]+$P_CHBFRAME[_M_BFNR,_XX,TR]-_RET_FR[_XX,TR]
$P_CHBFRAME[_M_BFNR,_XX,TR]=_RET_FR[_XX,TR]
ENDIF
IF $AC_MEAS_FRAME[_YY,FI]<>0
$P_CHBFRAME[_M_BFNR,_YY,FI]=$P_CHBFRAME[_M_BFNR,_YY,FI]+$P_CHBFRAME[_M_BFNR,_YY,TR]-_RET_FR[_YY,TR]
$P_CHBFRAME[_M_BFNR,_YY,TR]=_RET_FR[_YY,TR]
ENDIF
ENDIF
$P_CHBFR[_M_BFNR]=$P_CHBFRAME[_M_BFNR]
_PROTVAL[25]=SET("$P_CHBFR["<<_M_BFNR<<",,"<<_HSTR_PROT<<"]","","","","") _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",2,,,F"<<_M_SPE[0]
ENDIF
ENDIF
G[8]=_A_NPV
ENDIF
IF _ALARM GOTOF _ERR5
_ERR999:
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR(_M_N[28]>=4))AND(NOT(_INTERN[20+9])) GOTOF _M122A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR(_M_N[28]>=4))AND(_INTERN[20+9]) GOTOF _M122
IF (_ALARM==62303)
SETAL(_ALARM)
ENDIF
IF _M_SPE[29]<>1
_OVR[5]=_OVR[5]*_M_SPE[29] _OVR[6]=_OVR[6]*_M_SPE[29] _OVR[21]=_OVR[21]*_M_SPE[29] _OVR[22]=_OVR[22]*_M_SPE[29]
IF (_INTERN[68] == 1)
_OVR[105]=_OVR[105]*_M_SPE[29] _OVR[106]=_OVR[106]*_M_SPE[29] _OVR[121]=_OVR[121]*_M_SPE[29] _OVR[122]=_OVR[122]*_M_SPE[29]
ENDIF
ENDIF
N510 CYCLE102(1,_M_N[28])
STOPRE
IF (_M_N[28] == 1)
G4 F8
ENDIF
CYCLE102(0)
N521 _M122:
IF _INTERN[20+9]
CYCLE151
ENDIF
IF _M_SPE[29]<>1
_OVR[5]=_OVR[5]*(1/_M_SPE[29]) _OVR[6]=_OVR[6]*(1/_M_SPE[29]) _OVR[21]=_OVR[21]*(1/_M_SPE[29]) _OVR[22]=_OVR[22]*(1/_M_SPE[29])
IF (_INTERN[68] == 1)
_OVR[105]=_OVR[105]*(1/_M_SPE[29]) _OVR[106]=_OVR[106]*(1/_M_SPE[29]) _OVR[121]=_OVR[121]*(1/_M_SPE[29]) _OVR[122]=_OVR[122]*(1/_M_SPE[29])
ENDIF
ENDIF
N522 _M122A:
IF _ALARM==62303 GOTOF _ERR13
IF _E_B
RET
ENDIF
IF _NEW_PAR
_CHBIT[21]=_CHBIT_S21
ENDIF
IF (_INTERN[68] == 1)
FOR _HI[8]=0 TO 29
_OVR[900+_HI[8]]=(_OVR[+_HI[8]]+_OVR[100+_HI[8]])/2
ENDFOR
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
_OVR[5]=_OVR[5]*_M_SPE[52] _OVR[6]=_OVR[6]*_M_SPE[52] _OVR[21]=_OVR[21]*_M_SPE[52] _OVR[22]=_OVR[22]*_M_SPE[52]
IF (_INTERN[68] == 1)
_OVR[105]=_OVR[105]*_M_SPE[52] _OVR[106]=_OVR[106]*_M_SPE[52] _OVR[121]=_OVR[121]*_M_SPE[52] _OVR[122]=_OVR[122]*_M_SPE[52]
ENDIF
ENDIF
M17
N696112 _ENDE: SETAL(62301)
M0
_GENDE: M17
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
N697701 SETAL(_ALARM,_SERR)
RET
_ERR1: _ALARM=61302 _OVI[9]=_ALARM
N696101 SETAL(_ALARM)
RET
_ERR2: _ALARM=61346 _OVI[9]=_ALARM
N696102 SETAL(_ALARM)
RET
_ERR3: _ALARM=61347 _OVI[9]=_ALARM
N696103 SETAL(_ALARM)
RET
_ERR4: _ALARM=61341 _OVI[9]=_ALARM
N696104 SETAL(_ALARM)
RET
_ERR5: _OVI[9]=_ALARM
N696105 SETAL(_ALARM,_SERR)
RET
_ERR6: _ALARM=61307 _OVI[9]=_ALARM
N696106 SETAL(_ALARM)
RET
_ERR7: _ALARM=61336 _OVI[9]=_ALARM
N696107 SETAL(_ALARM)
RET
_ERR8: _ALARM=61321 _OVI[9]=_ALARM
N696108 SETAL(_ALARM)
RET
_ERR9: _ALARM=61403 _OVI[9]=_ALARM _OVI[11]=0
N696109 SETAL(_ALARM)
RET
_ERR10: _ALARM=61309 _OVI[9]=_ALARM
N696110 SETAL(_ALARM)
RET
_ERR11:_OVI[9]=_ALARM
N696111 SETAL(_ALARM)
RET
_ERR12: _ALARM=61019 _OVI[9]=_ALARM
N696112 SETAL(_ALARM,_SERR)
RET
_ERR13: _ALARM=61303 _OVI[9]=_ALARM
IF (_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF NOT(_INTERN[12] AND _INTERN[13])
N696113 SETAL(_ALARM)
ENDIF
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE971_SPF
PROC CYCLE971(INT S_MVAR,INT S_KNUM,INT S_PRNUM,INT S_MA,INT S_MD,REAL S_ID,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_TZL,REAL S_TDIF,INT S_NMSP,REAL S_F1,REAL S_S1,REAL S_F2,REAL S_S2,REAL S_F3,REAL S_S3,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE) SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 04.95.02.00.001 ;DATE: 2022-01-05
;Cycle : tool measurement and calibrate tool probe
DEF BOOL _INTERN[70]=REP(0),_M_ZUST[19]=REP(0),_VB[56]=REP(0),_NEW_PAR=0,_UMSCHLAG=0,_FRAES_DREH=0
DEF INT _M_N[30]=REP(0),_ALARM,_P_PROB,_P_PT,_MESSR,_AXIND,_INAX,_CORCOMP,_CORMODE,_GEOAX,_H_STMV[8],_I=0,_II=0,_S_ANZ=0
DEF INT _HI[5],_AGV[10],_P_XX,_P_YY,_P_ZZ,_AF[2],_ZMR[6],_P_PV,_P_PV1,_V,_V1,_MVWKS,_ZAHN=1,_L_SI,_K_SI,_LOG,_LOG_ON,_H_SIM
DEF INT _H1,_HM=1,_H_XX=1,_H_YY=1,_H_ZZ=1,_WZT,_WZR,_AUTKAL,_MPCOUNT=1,_GUD_SD,_K_STAT_PL,_K_STAT_ABS,_K_STAT_ORD,_K_STAT_APP,_K_STAT_CYC,_K_STAT_KOORD
DEF INT _H_DMODE,_TEMP,_TEMP_ON,_H_AMODE[5],_VERSATZR=0,S_DIR_ABS=0,S_DIR_ORD=0,S_Z=0,_MD13230,_MD51740_6
DEF REAL _M_SPE[64]=REP(0),_M_ME[120]=REP(0),_P_POS,_TRIGLAG,_LAGE,_MERET,_KOR[6,5],_KOR_TOOLL[3],_L_S,_K_S,_M_SPE5,_SD55619
DEF REAL _HR[6],_P_POSV,_P_POSV1,_DAT[3,6],_KF[3,3],_LTP[10],_P_ZPOS,_P_ZPOS_UE_MT,_MPOS[2],_KL[12,5],_KR[12,5],S_SET_TRIGLAG_ZZ=0
DEF STRING[10] _M_SPE20,_COMP
DEF STRING[40] _LOG_FILE,_S_XX,_S_YY,_S_ZZ
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE971_MPF"
DEF STRING[100] _SERR=""
DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_VAV1,_P_AX,_SP
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE971_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19") ; aktive Ebene
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...") ; Inch/Metrisch
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...") ; DIAMON/DIAMOF/DIAM90
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...") ; aktive Einstellbare Nullpunktverschiebung
WRITE(_TEMP,_TEMP_FILE,";CYCLE971("<<S_MVAR<<","<<S_KNUM<<","<<S_PRNUM<<","<<S_MA<<","<<S_MD<<","<<S_ID<<","<<S_FA<<","<<S_TSA<<","<<S_VMS<<","<<S_TZL<<","<<S_TDIF<<","<<S_NMSP<<","<<S_F1<<","<<S_S1<<","<<S_F2<<","<<S_S2<<","<<S_F3<<","<<S_S3<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
_KL[0,0]=SET(0,7,14,45,90,10,0,0,0,0,30,0.005,0,0,0,40,0.005,0.005,0,0,80,0.005,0.005,0.005,0.005)
_KR[0,0]=SET(0,7,14,45,90,10,0.005,0,0,0,30,0.03,0.025,0.02,0.015,40,0.04,0.035,0.035,0.025,80,0.045,0.045,0.035,0.035)
_KL[6,0]=SET(0,7,14,45,90,10,0,0,0,0,30,0.005,0.005,0.005,0,40,0.005,0.005,0.005,0,80,0.01,0.01,0.005,0)
_KR[6,0]=SET(0,7,14,45,90,10,0,0,0,0,30,0.015,0.015,0.015,0.005,40,0.02,0.02,0.02,0.015,80,0.03,0.025,0.025,0.02)
_OVR[0]=REP(0)
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _MVAR=S_MVAR _OVI[3]=S_MVAR
_PRNUM=ABS(S_PRNUM) _MA=S_MA _ID=S_ID _FA=ABS(S_FA) _TSA=ABS(S_TSA) _TDIF=ABS(S_TDIF) _NMSP=S_NMSP
IF S_VMS <> 0
_VMS = ABS(S_VMS)
ELSE
_VMS=$SCS_MEA_TP_FEED_MEASURE
ENDIF
IF ( (S_NMSP<>0)AND((_MVAR _DEC3)==0) )
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_CHBIT[3]=0
IF (S_KNUM _DEC1) == 1
_CHBIT[3]=1
ENDIF
IF ((S_MVAR _DEC1)>0)
_TZL=ABS(S_TZL)
ELSE
_TZL=0
ENDIF
_AMODE = ABS(_AMODE)
_H_AMODE[0]=(_AMODE _DEC1) _H_AMODE[1]=(_AMODE _DEC2) _H_AMODE[2]=(_AMODE _DEC3) _H_AMODE[3]=(_AMODE _DEC4)
IF ( ((S_MVAR _DEC1)>0)OR(((S_MVAR _DEC1)==0)AND((S_MVAR _DEC6)==0)AND((_MA _DEC1)==3)) )
IF ( (_MA _DEC1)==3 )
_SERR=<<"(_AMODE: dec3)"
IF ( (_H_AMODE[2]>2)OR(_H_AMODE[2]<0) ) GOTOF _M_ERR
_SERR=<<"(_AMODE: dec4)"
IF ( (_H_AMODE[3]>2)OR(_H_AMODE[3]<0) ) GOTOF _M_ERR
ELSE
_SERR=<<"(_AMODE: dec1)"
IF ( (_H_AMODE[0]>2)OR(_H_AMODE[0]<0) ) GOTOF _M_ERR
_SERR=<<"(_AMODE: dec2)"
IF ( (_H_AMODE[1]>2)OR(_H_AMODE[1]<0) ) GOTOF _M_ERR
IF ( (_H_AMODE[0]==2)AND(_H_AMODE[1]==0) ) GOTOF _M_ERR
ENDIF
ENDIF
IF ( ($P_SUBPAR[13])AND((_MVAR _DEC3)==0) )
_CBIT[12]=1
_MFS[0]=S_S1 _MFS[1]=S_F1 _MFS[2]=S_S2 _MFS[3]=S_F2 _MFS[4]=S_S3 _MFS[5]=S_F3
ELSE
_CBIT[12]=0
ENDIF
IF S_EVNUM<>0
_CHBIT[4]=0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
_NEW_PAR=1 _M_SPE[3]=1
ELSE
IF _SMI_R[10] > 99
_M_SPE[3]=1
IF ( ((_MVAR _DEC1)>0)OR(((_MVAR _DEC1)==0)AND((_MVAR _DEC6)==0)AND((_MA _DEC1)==3)) )
IF ( (_MA _DEC1)==3 )
_H_AMODE[2]=(_MIJ_I[0] _DEC1) _H_AMODE[3]=0
ELSE
_H_AMODE[0]=_MIJ_I[0] _H_AMODE[1]=_MIJ_I[8]
ENDIF
ENDIF
ELSE
_H_STMV[1]=ABS(_MVAR _DEC1)
IF ( (_VMS==0)AND(_H_STMV[1]==0) )
_VMS=$SCS_MEA_TP_FEED_MEASURE
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N697101 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0 _SERR=""
_PROTVAL[25]="" _PROTVAL[26]="" _PROTVAL[27]="" _PROTVAL[28]=""
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M120
_ALARM=0 _SERR=""
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] = 301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF ( (_MVAR _DEC2) == 0 )
_ALARM=61016
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') GOTOF _M120
$P_CYCFRAME=CTRANS()
_ALARM=0
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
ENDIF
_OVI[2]=971 _VB[50]=1 _HI[3]=$AC_MSNUM
IF (_HI[3]==0)
_ALARM=61290 _OVI[9]=_ALARM
N697101 SETAL(_ALARM)
RET
ENDIF
IF ((ABS($SC_TOOL_LENGTH_CONST)<>($P_GG[6]+16))AND($SC_TOOL_LENGTH_CONST<>0))
_ALARM=61024 _OVI[9]=_ALARM _SERR="SD42940"
N697101 SETAL(_ALARM,_SERR)
RET
ENDIF
IF ( ($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1) )
_FRAES_DREH=1
IF (_SMI_R[10]==0)
CYCLE210(1)
IF (_F_S_NR[1]==0)
_ALARM=61290 _OVI[9]=_ALARM
N697101 SETAL(_ALARM)
RET
ENDIF
IF (_F_S_NR[1]<>_HI[3])
_ALARM=61378 _OVI[9]=_ALARM
N697101 SETAL(_ALARM)
RET
ENDIF
ENDIF
ENDIF
IF ( (_SMI_R[10]==93101.901)AND(_MA==3)AND(_MVAR==10101) )
_M_ZUST[16]=1
ENDIF
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE971_MPF"
_LOG_ON=ISFILE(_LOG_FILE)
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
REPEAT
_HI[4]=1
IF (ISVAR("$MC_AXCONF_MACHAX_USED["<<_HI[0]<<"]"))
_HI[1]=$MC_AXCONF_MACHAX_USED[_HI[0]] _HI[0]=_HI[0]+1 _HI[4]=0
IF _HI[1]
_HI[1]=$MA_SPIND_ASSIGN_TO_MACHAX[AXNAME("AX"<<_HI[1])]
ENDIF
IF _HI[1]==_HI[3]
_SP=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_HI[0]-1])
_HI[2]=1 _HI[4]=1
ENDIF
ENDIF
UNTIL _HI[4]==1
IF (_HI[2]==0)
_ALARM=61290 _OVI[9]=_ALARM
N697101 SETAL(_ALARM)
RET
ENDIF
IF ( (_SMI_R[10]==93101.901)AND((_MVAR _DEC1)==0)AND(_MA==3)AND($P_TOOL==0) )
_MIJ_I[7]=1
ELSE
_MIJ_I[7]=0
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
_P_PROB=_M_N[21]-1
IF ((_M_N[25]>0) AND (_M_N[25]<3) AND (_MVAR==2))
IF ((_M_N[26]==1)OR (_M_N[26]==2))
IF _M_N[26]==2
_WZT=6
ENDIF
IF ( (_MA _DEC1)==3 )
_KOR[0,0]=SET(_KL[_WZT+0,0],_KL[_WZT+0,1],_KL[_WZT+0,2],_KL[_WZT+0,3],_KL[_WZT+0,4],_KL[_WZT+1,0],_KL[_WZT+1,1],_KL[_WZT+1,2],_KL[_WZT+1,3],_KL[_WZT+1,4],_KL[_WZT+2,0],_KL[_WZT+2,1],_KL[_WZT+2,2],_KL[_WZT+2,3],_KL[_WZT+2,4])
_KOR[3,0]=SET(_KL[_WZT+3,0],_KL[_WZT+3,1],_KL[_WZT+3,2],_KL[_WZT+3,3],_KL[_WZT+3,4],_KL[_WZT+4,0],_KL[_WZT+4,1],_KL[_WZT+4,2],_KL[_WZT+4,3],_KL[_WZT+4,4],_KL[_WZT+5,0],_KL[_WZT+5,1],_KL[_WZT+5,2],_KL[_WZT+5,3],_KL[_WZT+5,4])
ELSE
_KOR[0,0]=SET(_KR[_WZT+0,0],_KR[_WZT+0,1],_KR[_WZT+0,2],_KR[_WZT+0,3],_KR[_WZT+0,4],_KR[_WZT+1,0],_KR[_WZT+1,1],_KR[_WZT+1,2],_KR[_WZT+1,3],_KR[_WZT+1,4],_KR[_WZT+2,0],_KR[_WZT+2,1],_KR[_WZT+2,2],_KR[_WZT+2,3],_KR[_WZT+2,4])
_KOR[3,0]=SET(_KR[_WZT+3,0],_KR[_WZT+3,1],_KR[_WZT+3,2],_KR[_WZT+3,3],_KR[_WZT+3,4],_KR[_WZT+4,0],_KR[_WZT+4,1],_KR[_WZT+4,2],_KR[_WZT+4,3],_KR[_WZT+4,4],_KR[_WZT+5,0],_KR[_WZT+5,1],_KR[_WZT+5,2],_KR[_WZT+5,3],_KR[_WZT+5,4])
ENDIF
ELSE
IF ( (_MA _DEC1)==3 )
_KOR[0,0]=SET(_MT_EC_L[0,0],_MT_EC_L[0,1],_MT_EC_L[0,2],_MT_EC_L[0,3],_MT_EC_L[0,4],_MT_EC_L[1,0],_MT_EC_L[1,1],_MT_EC_L[1,2],_MT_EC_L[1,3],_MT_EC_L[1,4],_MT_EC_L[2,0],_MT_EC_L[2,1],_MT_EC_L[2,2],_MT_EC_L[2,3],_MT_EC_L[2,4])
_KOR[3,0]=SET(_MT_EC_L[3,0],_MT_EC_L[3,1],_MT_EC_L[3,2],_MT_EC_L[3,3],_MT_EC_L[3,4],_MT_EC_L[4,0],_MT_EC_L[4,1],_MT_EC_L[4,2],_MT_EC_L[4,3],_MT_EC_L[4,4],_MT_EC_L[5,0],_MT_EC_L[5,1],_MT_EC_L[5,2],_MT_EC_L[5,3],_MT_EC_L[5,4])
ELSE
_KOR[0,0]=SET(_MT_EC_R[0,0],_MT_EC_R[0,1],_MT_EC_R[0,2],_MT_EC_R[0,3],_MT_EC_R[0,4],_MT_EC_R[1,0],_MT_EC_R[1,1],_MT_EC_R[1,2],_MT_EC_R[1,3],_MT_EC_R[1,4],_MT_EC_R[2,0],_MT_EC_R[2,1],_MT_EC_R[2,2],_MT_EC_R[2,3],_MT_EC_R[2,4])
_KOR[3,0]=SET(_MT_EC_R[3,0],_MT_EC_R[3,1],_MT_EC_R[3,2],_MT_EC_R[3,3],_MT_EC_R[3,4],_MT_EC_R[4,0],_MT_EC_R[4,1],_MT_EC_R[4,2],_MT_EC_R[4,3],_MT_EC_R[4,4],_MT_EC_R[5,0],_MT_EC_R[5,1],_MT_EC_R[5,2],_MT_EC_R[5,3],_MT_EC_R[5,4])
ENDIF
ENDIF
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
_ALARM=61935
IF ($MN_SCALING_SYSTEM_IS_METRIC)
IF ( ($P_GG[13]==1)OR($P_GG[13]==3) )
GOTOF _M120
ENDIF
ELSE
IF ( ($P_GG[13]==2)OR($P_GG[13]==4) )
GOTOF _M120
ENDIF
ENDIF
_ALARM=0 _SERR=""
ENDIF
IF ($MN_SCALING_SYSTEM_IS_METRIC)
N1056 G71
ELSE
N1057 G70
ENDIF
N1045 DIAMOF G0 G94 G90
_ALARM=61307
_H_STMV[0]=(_MVAR _DEC1)
_H_STMV[1]=(_MVAR _DEC2) _MVWKS=_H_STMV[1]
_H_STMV[2]=(_MVAR _DEC3)
_H_STMV[3]=(_MVAR _DEC4)
_H_STMV[4]=(_MVAR _DEC5)
_H_STMV[5]=(_MVAR _DEC6)
_H_STMV[6]=(_MVAR _DEC7)
IF ((_H_STMV[0]<0)OR(_H_STMV[0]>2))OR((_H_STMV[1]<0)OR(_H_STMV[1]>1))OR((_H_STMV[2]<0)OR(_H_STMV[2]>1))OR((_H_STMV[4]<0)OR(_H_STMV[4]>1))OR((_H_STMV[5]<0)OR(_H_STMV[5]>1))OR((_H_STMV[6]<0)OR(_H_STMV[6]>1))
GOTOF _M120
ENDIF
IF ( (_H_STMV[0]==0)AND(_H_STMV[6]==1)AND($P_SDIR[$AC_MSNUM]<>5) )
M5
ENDIF
IF (_H_STMV[2])
_H_STMV[0]=2
_ALARM=61376
IF ($TC_DPNT[$P_TOOLNO,$P_TOOL]==0) GOTOF _M120
IF ($TC_DPNT[$P_TOOLNO,$P_TOOL]>100)
_ALARM=61379
GOTOF _M120
ENDIF
IF ( (_MA _DEC1)==3 )
_VB[54]=1
_ALARM=61325
IF ( ((_MA _DEC3)==0)AND(_MVAR<>10101) ) GOTOF _M120
ELSE
_VB[53]=1
IF ( (360/$TC_DPNT[$P_TOOLNO,$P_TOOL])<=(($SNS_MEA_T_CIRCULAR_ARC_DIST*180)/($PI*$P_TOOLR)) )
_ALARM=61024
_SERR="$SNS_MEA_T_CIRCULAR_ARC_DIST"
GOTOF _M120
ENDIF
ENDIF
_M_N[27]=$TC_DPNT[$P_TOOLNO,$P_TOOL]
ELSE
_VB[53]=0 _VB[54]=0
ENDIF
IF (_H_STMV[5]==1)
_AUTKAL=1 _MPCOUNT=6
ENDIF
IF (_H_STMV[4]==1)
_VB[15]=1
ENDIF
IF (_H_STMV[0]==0)
_VB[29]=1
ELSE
IF (_H_STMV[0]==2)
_VB[30]=1 _ALARM=61366
IF ( ($AA_S[$AC_MSNUM]==0)OR($P_SDIR[$AC_MSNUM]<>5) )
IF (_M_SPE[40+5]<>3)AND(_M_SPE[40+5]<>4) GOTOF _M120
_ALARM=61350
IF (_INTERN[20+12]) AND (_MFS[0]==0) GOTOF _M120
ENDIF
ENDIF
ENDIF
_M_SPE20=<<_M_SPE[20]
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
IF (_M_SPE20=="-777")
_GUD_SD=2
ELSE
_AGV[9]=INDEX(_M_SPE20,"9") _AGV[8]=INDEX(_M_SPE20,"8")
_AGV[7]=INDEX(_M_SPE20,"7") _AGV[6]=INDEX(_M_SPE20,"6") _AGV[5]=INDEX(_M_SPE20,"5") _AGV[4]=INDEX(_M_SPE20,"4")
_AGV[3]=INDEX(_M_SPE20,"3") _AGV[2]=INDEX(_M_SPE20,"2") _AGV[1]=INDEX(_M_SPE20,"1") _AGV[0]=INDEX(_M_SPE20,"0")
IF ( (_AGV[8]==(-1))AND(_AGV[5]==(-1))AND(_AGV[4]==(-1))AND(_AGV[3]==(-1))AND(_AGV[2]==(-1))AND(_AGV[1]==(-1))AND(_AGV[0]==(-1)) )
_GUD_SD=2
IF (_MVWKS==1)
_TPW[_P_PROB,0]=SET($SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB],$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB])
_TPW[_P_PROB,4]=SET($SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB])
_TPW[_P_PROB,8]=SET($SNS_MEA_TPW_TYPE[_P_PROB])
ELSE
_TP[_P_PROB,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB])
_TP[_P_PROB,4]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB])
_TP[_P_PROB,8]=SET($SNS_MEA_TP_TYPE[_P_PROB])
ENDIF
IF ((_MVAR==100000)OR(_MVAR==100000))AND(_AGV[7]<>(-1))
_ALARM=61375
GOTOF _M120
ENDIF
ELSE
IF ( (_AGV[8]<>(-1))AND(_AGV[5]<>(-1))AND(_AGV[4]<>(-1))AND(_AGV[3]<>(-1))AND(_AGV[2]<>(-1))AND(_AGV[1]<>(-1))AND(_AGV[0]<>(-1)) )
_GUD_SD=1
IF ((_MVAR==100000)OR(_MVAR==100000))AND(_AGV[7]==(-1))
_ALARM=61375
GOTOF _M120
ENDIF
ELSE
_ALARM=61375
GOTOF _M120
ENDIF
ENDIF
IF (_AGV[6]==(-1))
IF (_MVWKS==1)
_TPW[_P_PROB,6]=$SNS_MEA_TPW_EDGE_DISK_SIZE[_P_PROB]
ELSE
_TP[_P_PROB,6]=$SNS_MEA_TP_EDGE_DISK_SIZE[_P_PROB]
ENDIF
ENDIF
IF (_AGV[7]==(-1))
IF (_MVWKS==1)
_TPW[_P_PROB,7]=$SNS_MEA_TPW_AX_DIR_AUTO_CAL[_P_PROB]
ELSE
_TP[_P_PROB,7]=$SNS_MEA_TP_AX_DIR_AUTO_CAL[_P_PROB]
ENDIF
ENDIF
IF (_AGV[9]==(-1))
IF (_MVWKS==1)
_TPW[_P_PROB,9]=$SNS_MEA_TPW_CAL_MEASURE_DEPTH[_P_PROB]
ELSE
_TP[_P_PROB,9]=$SNS_MEA_TP_CAL_MEASURE_DEPTH[_P_PROB]
ENDIF
ENDIF
ENDIF
ENDIF
_ALARM=0 _SERR=""
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
IF _ALARM>0 GOTOF _M120
IF (_H_STMV[4]==1)
_INTERN[40+3]=0
_M_SPE[33]=0
ENDIF
_M_N[15]=ABS(_M_N[15]) _M_N[16]=ABS(_M_N[16]) _M_N[17]=ABS(_M_N[17])
_ALARM=61372
IF ( ((_H_STMV[2])OR((_H_STMV[0]==0)AND(_H_STMV[6]==1)))AND(_VB[12]==0) ) GOTOF _M120
IF (_H_STMV[2])
_OVI[10]=$TC_DPNT[$P_TOOLNO,$P_TOOL]
ENDIF
IF (_MVWKS==0)
_K_STAT_PL=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC1
_K_STAT_KOORD=((10*($SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC7))+($SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC6))
IF (_H_STMV[0]==0)
IF ( (_K_STAT_PL<>0)AND((_K_STAT_PL<>$P_GG[6])OR(_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM)OR($SNS_MEA_TP_FEED[_P_PROB]<(_M_SPE[0]-1))OR($SNS_MEA_TP_FEED[_P_PROB]>(_M_SPE[0]+1))) )
$SNS_MEA_TP_STATUS_GEN[_P_PROB]=0 _K_STAT_PL=0 $SNS_MEA_TP_FEED[_P_PROB]=0
$SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]) $SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB])
$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]) $SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB])
$SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB]) $SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB])
ENDIF
ELSE
_ALARM=61385
IF (_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM) GOTOF _M120
_ALARM=61341
IF (_K_STAT_PL<>$P_GG[6]) GOTOF _M120
IF (_H_STMV[0]==1)
_ALARM=61444
IF ( (_M_SPE[0])<>($SNS_MEA_TP_FEED[_P_PROB]) ) GOTOF _M120
ENDIF
ENDIF
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC3
_K_STAT_APP=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC4
_K_STAT_CYC=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC5
ELSE
_K_STAT_PL=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC1
_K_STAT_KOORD=((10*($SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC7))+($SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC6))
IF (_H_STMV[0]==0)
IF ( (_K_STAT_PL<>0)AND((_K_STAT_PL<>$P_GG[6])OR(_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM)OR($SNS_MEA_TPW_FEED[_P_PROB]<(_M_SPE[0]-1))OR($SNS_MEA_TPW_FEED[_P_PROB]>(_M_SPE[0]+1))) )
$SNS_MEA_TPW_STATUS_GEN[_P_PROB]=0 _K_STAT_PL=0 $SNS_MEA_TPW_FEED[_P_PROB]=0
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]) $SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB])
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]) $SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB])
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB]) $SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB])
ENDIF
ELSE
_ALARM=61385
IF (_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM) GOTOF _M120
_ALARM=61341
IF (_K_STAT_PL<>$P_GG[6]) GOTOF _M120
IF (_H_STMV[0]==1)
_ALARM=61444
IF ( (_M_SPE[0])<>($SNS_MEA_TPW_FEED[_P_PROB]) ) GOTOF _M120
ENDIF
ENDIF
_K_STAT_ABS=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC3
_K_STAT_APP=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC4
_K_STAT_CYC=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC5
ENDIF
_ALARM=61351
IF ( (_H_STMV[0]==2)AND($P_TOOLR==0) ) GOTOF _M120
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
IF ( ((_H_STMV[0]==0)AND($P_TOOLR==0))OR(_M_SPE[13]==0) ) GOTOF _M120
IF (_H_STMV[0]==1)
_AF[1]=(_MA _DEC1)
IF ( ($P_AD[1]>=200)AND($P_AD[1]<300) )
IF (_AF[1]==3)
IF ( ($P_TOOLR==0)AND(($P_AD[24]==0)OR($P_AD[24]==180)) ) GOTOF _M120
ELSE
IF ($P_TOOLR==0) GOTOF _M120
ENDIF
ELSE
IF ($P_TOOLR==0) GOTOF _M120
ENDIF
ENDIF
ENDIF
_ALARM=61336
IF ( (_YY==_ZZ)OR(_XX==_YY) ) GOTOF _M120
IF ( (_INTERN[2]==0)OR(_INTERN[10]==0)OR(_INTERN[18]==0) ) GOTOF _M120
IF ((_INTERN[0])OR(_INTERN[8])OR(_INTERN[16]))
IF ($P_GG[29]==1)AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
_HM=2
IF _INTERN[0]
_H_XX=2
ELSE
IF _INTERN[8]
_H1=1 _H_YY=2
ELSE
IF _INTERN[16]
_H1=2 _H_ZZ=2
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF (_MVWKS==0)
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
FOR _I=0 TO 1
$AA_MEAS_POINT1[_XX]=_TP[_P_PROB,_I] $AA_MEAS_POINT1[_YY]=_TP[_P_PROB,_I+2] $AA_MEAS_POINT1[_ZZ]=_TP[_P_PROB,_I+4]
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _M120
ENDIF
_LTP[_I]=$AA_MEAS_POINT2[_XX] _LTP[_I+2]=$AA_MEAS_POINT2[_YY] _LTP[_I+4]=$AA_MEAS_POINT2[_ZZ]
ENDFOR
_LTP[6]=SET(_TP[_P_PROB,6],_TP[_P_PROB,7],_TP[_P_PROB,8],_TP[_P_PROB,9])
ELSE
_LTP[0]=SET(_TPW[_P_PROB,0],_TPW[_P_PROB,1],_TPW[_P_PROB,2],_TPW[_P_PROB,3],_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,6],_TPW[_P_PROB,7],_TPW[_P_PROB,8],_TPW[_P_PROB,9])
ENDIF
_OVR[0]=0 _OVI[0]=$P_TOOL _OVI[8]=$P_TOOLNO _OVR[27]=_M_SPE[33] _OVR[29]=_M_SPE[34] _VB[0]=1 _VB[6]=1
IF (_LTP[6]<=0)
IF (_SMI_R[10]==93101.901)
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]<=0)
N630911 SETAL(61230)
RET
ELSE
_LTP[6]=$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
ELSE
_LTP[6]=(ABS(_LTP[0]-_LTP[1])+ABS(_LTP[2]-_LTP[3]))/2
ENDIF
ENDIF
IF ( ((_MVAR _DEC1)>0)AND((_MVAR _DEC2)==0) )
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC3
IF ( ((_K_STAT_ABS==1)OR(_K_STAT_ABS==2)OR(_K_STAT_ORD==1)OR(_K_STAT_ORD==2))AND($MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]<=0) )
N630911 SETAL(61230)
RET
ENDIF
IF (_K_STAT_ABS==1)
_LTP[1]=_LTP[0]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_ABS==2)
_LTP[0]=_LTP[1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_ORD==1)
_LTP[3]=_LTP[2]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_ORD==2)
_LTP[2]=_LTP[3]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
ENDIF
_ALARM=61309
IF ((_LTP[8]<>0)AND(_LTP[8]<>2)AND(_LTP[8]<>101)AND(_LTP[8]<>201)AND(_LTP[8]<>301)AND(_LTP[8]<>3)) GOTOF _M120
IF ((_FRAES_DREH)AND((_LTP[8]<>0)AND(_LTP[8]<>3))) GOTOF _M120
_ALARM=61415
IF ( (_LTP[8] _DEC1)==1 )
IF (TRUNC(_LTP[8]/100))<>($P_GG[6]) GOTOF _M120
ENDIF
_HR[2]=$P_TOOLR _HR[1]=_HR[2] _P_XX=0 _P_YY=2 _P_ZZ=4
_ZMR[2]=_LTP[7]/100 _ZMR[1]=_LTP[7]/10-TRUNC(_LTP[7]/100)*10 _ZMR[0]=_LTP[7]-TRUNC(_LTP[7]/10)*10
IF (_GUD_SD==1)
IF _VB[32] GOTOF _MM1
_P_XX=4 _P_YY=0 _P_ZZ=2
IF (_AGV[7]<>(-1))
_HI[0]=_ZMR[2] _ZMR[2]=_ZMR[1] _ZMR[1]=_ZMR[0] _ZMR[0]=_HI[0]
ENDIF
IF _VB[33] GOTOF _MM1
_P_XX=2 _P_YY=4 _P_ZZ=0
IF (_AGV[7]<>(-1))
_HI[0]=_ZMR[2] _ZMR[2]=_ZMR[1] _ZMR[1]=_ZMR[0] _ZMR[0]=_HI[0]
ENDIF
ENDIF
_MM1: IF (_AUTKAL==0) GOTOF _MMM1
IF (_FA<=0)
_ALARM=61308
GOTOF _M120
ENDIF
IF ((_ZMR[2]<>1) OR (_ZMR[1]>3) OR (_ZMR[0]>3))
_ALARM=61309
GOTOF _M120
ENDIF
_P_AX=_XX _INAX=0 _M_SPE5=_M_SPE[5]
_MM1AK:
_HR[2]=$P_TOOLR _AXIND=0 _VB[39]=0 _M_N[7]=0
_P_ZPOS=_LTP[_P_ZZ]+_M_SPE[3]
_MPOS[0]=(_LTP[_P_XX]+_LTP[_P_XX+1])/2
_MPOS[1]=(_LTP[_P_YY]+_LTP[_P_YY+1])/2
IF (_H_STMV[1]==0)
S_DIR_ABS=($SNS_MEA_TP_AX_DIR_AUTO_CAL[_P_PROB] _DEC1) S_DIR_ORD=($SNS_MEA_TP_AX_DIR_AUTO_CAL[_P_PROB] _DEC2)
ELSE
S_DIR_ABS=($SNS_MEA_TPW_AX_DIR_AUTO_CAL[_P_PROB] _DEC1) S_DIR_ORD=($SNS_MEA_TPW_AX_DIR_AUTO_CAL[_P_PROB] _DEC2)
ENDIF
IF ( ((_LTP[6])<(2*_HR[2]))AND(_MPCOUNT==6) )
IF ( (S_DIR_ABS==3)OR(S_DIR_ABS==2) )
_MPOS[0]=_MPOS[0]-_HR[2]
ELSE
IF (S_DIR_ABS==1)
_MPOS[0]=_MPOS[0]+_HR[2]
ELSE
IF ( (S_DIR_ORD==3)OR(S_DIR_ORD==2) )
_MPOS[1]=_MPOS[1]-_HR[2]
ELSE
IF (S_DIR_ORD==1)
_MPOS[1]=_MPOS[1]+_HR[2]
ELSE
IF ( (_M_SPE5)>(_MPOS[0]) )
_MPOS[0]=_MPOS[0]+_HR[2]
ELSE
_MPOS[0]=_MPOS[0]-_HR[2]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
G0 G90
IF (_VB[1]==0)
N21044 G1 F=_M_SPE[2]
ENDIF
_ALARM=61302
IF (_INTERN[40+2])
N21045 MEAS=_M_N[0] AX[_ZZ]=_P_ZPOS
STOPRE
IF ($AC_MEA[ABS(_M_N[0])]) GOTOF _M120
ELSE
AX[_ZZ]=_P_ZPOS
ENDIF
_M_SPE[7]=_P_ZPOS
IF _VB[1]==0
N21060 G1 F=_M_SPE[1]
ENDIF
IF (_INTERN[40+2])
N21070 MEAS=_M_N[0] AX[_P_AX]=_MPOS[_INAX]
STOPRE
IF ($AC_MEA[ABS(_M_N[0])]) GOTOF _M120
ELSE
N21080 AX[_P_AX]=_MPOS[_INAX]
ENDIF
_M_SPE[5+_INAX]=_MPOS[_INAX] _ALARM=0 _SERR=""
CASE(_MPCOUNT) OF 6 GOTOF _AUTK6 5 GOTOF _AUTK5 4 GOTOF _AUTK4 3 GOTOF _AUTK3 2 GOTOF _AUTK2 1 GOTOF _AUTK1 DEFAULT GOTOF _ALAUS
_AUTK6:
_AF[0]=0 _AF[1]=3
_P_POS=_MPOS[1] _P_AX=_YY _INAX=1
IF ( (S_DIR_ABS==0)AND(S_DIR_ORD<>0) )
_P_POS=_MPOS[0] _P_AX=_XX _INAX=0
ENDIF
GOTOF _MAK4
_AUTK5:
IF (_ZMR[0]==0)
_MPCOUNT=_MPCOUNT-2
GOTOB _MM1AK
ENDIF
IF (_ZMR[0]==1)
_MPCOUNT=_MPCOUNT-1
GOTOB _MM1AK
ENDIF
_P_POS=_LTP[_P_XX+1]-_M_SPE[3]-_HR[2] _P_AX=_XX _INAX=0
_AF[0]=2 _AF[1]=1
IF (_ZMR[1]==3) AND (_ZMR[0]>1) GOTOF _MAK4
_AF[0]=0 _AF[1]=1
GOTOF _MAK4
_AUTK4:
IF (_ZMR[0]==2)
_MPCOUNT=_MPCOUNT-1
GOTOB _MM1AK
ENDIF
_P_POS=_LTP[_P_XX]+_M_SPE[3]+_HR[2] _P_AX=_XX _INAX=0
_AF[0]=2 _AF[1]=1
IF (_ZMR[1]==3) AND (_ZMR[0]==1) GOTOF _MAK4
_AF[0]=0 _AF[1]=1
GOTOF _MAK4
_AUTK3:
IF (_ZMR[1]==0)
_MPCOUNT=_MPCOUNT-2
GOTOB _MM1AK
ENDIF
IF (_ZMR[1]==1)
_MPCOUNT=_MPCOUNT-1
GOTOB _MM1AK
ENDIF
_P_POS=_LTP[_P_YY+1]-_M_SPE[3]-_HR[2] _P_AX=_YY _INAX=1
_AF[0]=0 _AF[1]=2
GOTOF _MAK4
_AUTK2:
IF (_ZMR[1]==2)
_MPCOUNT=_MPCOUNT-1
GOTOB _MM1AK
ENDIF
_P_POS=_LTP[_P_YY]+_M_SPE[3]+_HR[2] _P_AX=_YY _INAX=1
_AF[0]=0 _AF[1]=2
GOTOF _MAK4
_AUTK1:
IF (_ZMR[0]==0) AND (_ZMR[1]==0)
_MPCOUNT=_MPCOUNT-1 _ALARM=0 _SERR=""
GOTOF _M120
ENDIF
_AF[0]=0 _AF[1]=3
GOTOF _MAK6
_ALAUS: _ALARM=61325
GOTOF _M120
_MAK4: _ALARM=61302
IF (_INTERN[40+2])
N21070 MEAS=_M_N[0] AX[_P_AX]=_P_POS
STOPRE
IF ($AC_MEA[ABS(_M_N[0])]) GOTOF _M120
ELSE
N21080 AX[_P_AX]=_P_POS
ENDIF
_M_SPE[5+_INAX]=_P_POS
_MAK6: _ALARM=0 _SERR=""
G0
GOTOF _M1B
_MMM1: _AF[0]=_MA/100 _AF[1]=_MA-_AF[0]*100 _ALARM=61325
IF ( (_AF[0]<0)OR(_AF[0]>2)OR(_AF[1]<1)OR(_AF[1]>3) ) GOTOF _M120 IF (_AF[0]==_AF[1]) GOTOF _M120 IF ( (_H_STMV[0]>2)AND(_AF[0]==0)AND(_AF[1]==3) ) GOTOF _M120
_ALARM=0 _SERR=""
_M1: IF (_VB[37]==0) GOTOF _M1B
_MAV=_ZZ _P_PT=_P_ZZ _AXIND=3 _VB[40]=1
IF (_AF[1]==3)
_HR[2]=0
ENDIF
_VAV=_XX _P_PV=_P_XX _VAV1=_YY _P_PV1=_P_YY _P_POSV=_M_SPE[5] _P_POSV1=_M_SPE[6]
IF ((_AF[1]==0) AND (_AF[0]==0)) GOTOF _M2
_VAV=_YY _P_PV=_P_YY _VAV1=_XX _P_PV1=_P_XX _P_POSV=_M_SPE[6] _P_POSV1=_M_SPE[5]
GOTOF _M2
_M1B:
IF ( (_H_STMV[0])OR(_AF[1]==3) ) GOTOF _M1C
IF (_AF[0]<>0)
_VB[39]=1
ENDIF
_M1C: _HR[2]=0 _MAV=_XX _P_PT=_P_XX _VAV=_YY _HI[0]=0 _V=1 _V1=2 _P_PV=_P_YY _VAV1= _ZZ _P_PV1=_P_ZZ _VB[40]=0
IF ( (_AF[1]==1)OR((_VB[54])AND(_AF[0]==1)AND(_M_ZUST[16]==0)) ) GOTOF _M2
_MAV=_YY _P_PT=_P_YY _AXIND=1 _VAV=_XX _HI[0]=2 _V=0 _P_PV=_P_XX
IF ( (_AF[1]==2)OR(_VB[54]AND(_M_ZUST[16]==0)) ) GOTOF _M2
_HR[2]=0 _MAV=_ZZ _P_PT=_P_ZZ _AXIND=2 _HI[0]=4 _VAV=_XX _V1=1 _P_PV=_P_XX _VAV1=_YY _P_PV1=_P_YY _VB[40]=1
IF ( (_AUTKAL)AND(S_DIR_ABS==0)AND(S_DIR_ORD<>0) )
_VAV=_YY _V1=0 _P_PV=_P_YY _VAV1=_XX _P_PV1=_P_XX
ENDIF
IF ( (($P_AD[1]>=200)AND($P_AD[1]<300)AND(($P_AD[24]<>0)AND($P_AD[24]<>180)))OR($P_AD[1]==110)OR($P_AD[1]==111)OR($P_AD[1]==157) ) GOTOF _M1CC
IF ( (((_LTP[6])<(2*_HR[1]))AND(_H_AMODE[2]==0))OR((_VB[54])AND(_M_ZUST[16]))OR((_H_AMODE[2]==2)AND(_H_AMODE[3]==0)) )
_HR[2]=_HR[1] _VERSATZR=1
ENDIF
IF ( ((_H_AMODE[2]==0)AND(_VERSATZR==1))OR((_H_AMODE[2]==2)AND(_H_AMODE[3]==0)) )
_HR[2]=_HR[2]-_ID
ELSE
IF ( (_H_AMODE[2]==2)AND(_H_AMODE[3]<>0) )
REPEAT _WZ_VERSATZ_A _WZ_VERSATZ_E
ENDIF
ENDIF
_M1CC: IF (_AF[0]==1)OR(_AF[0]==0) GOTOF _M2
_P_PV=_P_YY _P_PV1=_P_XX _VAV=_YY _VAV1=_XX _V1=0 _V=1
IF ( (_H_AMODE[2]==2)AND(_H_AMODE[3]<>0) )
REPEAT _WZ_VERSATZ_A _WZ_VERSATZ_E
ENDIF
IF _AF[0]==2 GOTOF _M2
_M2:
IF ( (_VB[54])AND(_M_ZUST[16]) )
_P_POS=_P_ZPOS_UE_MT
ELSE
_P_POS=_M_SPE[5+_AXIND]
ENDIF
IF (_VB[1]==0)
N1044 G1 F=_M_SPE[1]
IF (_VAV==_ZZ)
F=_M_SPE[2]
ENDIF
ENDIF
_ALARM=61332 _MESSR=-1
IF (_VB[15]==0)
IF (_MAV==_ZZ)
_HR[5]=0
ELSE
_HR[5]=$P_TOOLR
ENDIF
IF ( ((_P_POS)-(_HR[5])) > (_LTP[_P_PT]) ) GOTOF _M6
IF ( ((_P_POS)+(_HR[5])) > (_LTP[_P_PT+1]) ) GOTOF _M120
_P_PT=_P_PT+1
GOTOF _M7
ENDIF
_P_PT=_P_PT+1
IF _M_SPE[31]>0 GOTOF _M7
_P_PT=_P_PT-1
_M6:_MESSR=1 _HI[0]=_HI[0]+1
_M7: _M_ZUST[_HI[0]]=1
IF ( (_NEW_PAR)AND(S_MD<>0)AND((S_MVAR _DEC6)<>1) )
IF ( ((_MESSR==1)AND(S_MD<>2))OR((_MESSR==(-1))AND(S_MD<>1)) )
_ALARM=61326 _OVI[9]=_ALARM
N697101 SETAL(_ALARM)
RET
ENDIF
ENDIF
REPEAT _K_STAT_A _K_STAT_E
_M8:
IF (_VB[15]==0)
IF ( (_AUTKAL)AND(_MPCOUNT==4)AND(_ZMR[1]==3)AND(_ZMR[0]==3) ) GOTOF _M8B
_HR[4]=(_LTP[_P_PV]+_LTP[_P_PV+1])/2 _ALARM=61302
IF (_SMI_R[10]==93101.901)
IF ($MNS_J_MEA_T_PROBE_APPR_AX_DIR[_P_PROB]<0)
_HR[4]=_HR[4]+_HR[2]
ELSE
_HR[4]=_HR[4]-_HR[2]
ENDIF
ELSE
IF (_AUTKAL==0)
IF _M_SPE[5+_V]>_HR[4]
_HR[4]=_HR[4]+_HR[2]
ELSE
_HR[4]=_HR[4]-_HR[2]
ENDIF
ELSE
IF ( (S_DIR_ABS==3)OR(S_DIR_ABS==2) )
_HR[4]=_HR[4]-_HR[2]
ELSE
IF (S_DIR_ABS==1)
_HR[4]=_HR[4]+_HR[2]
ELSE
IF ( (S_DIR_ORD==3)OR(S_DIR_ORD==2) )
_HR[4]=_HR[4]-_HR[2]
ELSE
IF (S_DIR_ORD==1)
_HR[4]=_HR[4]+_HR[2]
ELSE
IF _M_SPE5>_HR[4]
_HR[4]=_HR[4]+_HR[2]
ELSE
_HR[4]=_HR[4]-_HR[2]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF (_INTERN[40+2])
N1045 MEAS=_M_N[0] AX[_VAV]=_HR[4]
STOPRE
IF ($AC_MEA[ABS(_M_N[0])])
G0 AX[_VAV]=_M_SPE[5+_V]
GOTOF _M120
ENDIF
ELSE
N1050 AX[_VAV]=_HR[4]
ENDIF
_M8B:
IF _VAV1==_ZZ
_HR[3]=_LTP[9]
F=_M_SPE[2]
IF (_H_STMV[0])AND (_ID)
IF (_H_AMODE[0]==2)
IF (_H_AMODE[1]==2)
_HR[3]=_LTP[9]+ABS(_ID)
ELSE
_HR[3]=_LTP[9]-ABS(_ID)
_ALARM=61019 _SERR=<<"S_ID"
IF (_HR[3]<=0) GOTOF _M120
ENDIF
ELSE
IF (_H_AMODE[0]==0)
_HR[3]=_LTP[9]+ABS(_ID)
ENDIF
ENDIF
ENDIF
_ALARM=61332
IF _M_SPE[5+_V1] > _LTP[_P_PV1] GOTOF _M81B
IF _M_SPE[5+_V1] >= _LTP[_P_PV1+1] GOTOF _M120
_P_PV1=_P_PV1+1 _HR[3]=-_HR[3]
N1055 _M81B:_ALARM=61302 _HR[4]=_LTP[_P_PV1]-_HR[3]
ELSE
_HR[4]=(_LTP[_P_PV1]+_LTP[_P_PV1+1])/2
ENDIF
IF (_INTERN[40+2])
N1060 MEAS=_M_N[0] AX[_VAV1]=_HR[4]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
ELSE
N1065 AX[_VAV1]=_HR[4]
ENDIF
ENDIF
_ALARM=0 _SERR=""
IF (_VB[40])
_M_SPE[16]=_M_SPE[13]-$P_AD[_M_N[17]+20]
ELSE
_M_SPE[16]=$P_TOOLR
ENDIF
N1070 _M9:
IF (_MAV==_ZZ)
_HR[2]=0
ELSE
_HR[2]=_HR[1]
ENDIF
IF (_VB[15])
_M_SPE[9]=_M_SPE[5+_AXIND]+_M_SPE[60]*_M_SPE[3] _M_SPE[10]=_M_SPE[5+_AXIND]
_M_ME[11]=_M_SPE[5+_AXIND]+_M_SPE[3] ;Anfahrposition fuer Simulation
ELSE
_M_SPE[10]=_LTP[_P_PT]+(_M_SPE[3]+_HR[2])*_MESSR
_M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR ;Anfahrposition fuer Simulation
IF ((_MESSR==-1)AND(_M_SPE[10]<_P_POS))OR((_MESSR==1)AND(_M_SPE[10]>_P_POS))
_M_SPE[10]=_P_POS
ENDIF
_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR
ENDIF
_M91:
IF _VB[39]
IF _INTERN[40+2]
_ALARM=61302
N1095 MEAS=_M_N[0] AX[_MAV]=_M_SPE[10]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
N1105 MEAS=_M_N[0] AX[_VAV]=_LTP[_P_PV]+_M_SPE[3]+_HR[2]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
IF _AXIND
MEAS=_M_N[0] AX[_MAV]=(_LTP[_P_YY]+_LTP[_P_YY+1])/2
ELSE
MEAS=_M_N[0] AX[_MAV]=(_LTP[_P_XX]+_LTP[_P_XX+1])/2
ENDIF
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
N1120 G91 G1 MEAS=_M_N[0] AX[_VAV]=-_M_SPE[60]*_M_SPE[3] F=_M_SPE[0]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _MK1
_ALARM=61301
GOTOF _M120
_MK1:_M_ME[1]=$AA_MW[_VAV]
N1125 G0 G90 AX[_VAV]=_LTP[_P_PV]+_M_SPE[3]+_HR[2]
N1130 AX[_MAV]=_M_SPE[10]
N1135 AX[_VAV]=(_LTP[_P_PV]+_LTP[_P_PV+1])/2
N1136 G0 G90
IF _VB[1]==0
N1137 G1 F=_M_SPE[1]
ENDIF
N1140 MEAS=_M_N[0] AX[_VAV]=_LTP[_P_PV+1]-_M_SPE[3]-_HR[2]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
IF _AXIND
MEAS=_M_N[0] AX[_MAV]=(_LTP[_P_YY]+_LTP[_P_YY+1])/2
ELSE
MEAS=_M_N[0] AX[_MAV]=(_LTP[_P_XX]+_LTP[_P_XX+1])/2
ENDIF
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
N1160 G91 G1 MEAS=_M_N[0] AX[_VAV]=_M_SPE[60]*_M_SPE[3] F=_M_SPE[0]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _MK2
_ALARM=61301
GOTOF _M120
_MK2:_M_ME[2]=$AA_MW[_VAV]
N1165 G0 G90 AX[_VAV]=_LTP[_P_PV+1]-_M_SPE[3]-_HR[2]
N1170 AX[_MAV]=_M_SPE[10]
N1175 AX[_VAV]=(_M_ME[1]+_M_ME[2])/2
ELSE
_MD51740_6=0 _MD13230=$MN_MEAS_PROBE_SOURCE _SD55619=$SCS_MEA_SIM_MEASURE_DIFF
IF ($MNS_MEA_FUNCTION_MASK B_AND 'B1000000')
_MD51740_6=1
ENDIF
IF $SCS_MEA_SIM_ENABLE==9
_MD13230 = 0
ENDIF
N1115 AX[_MAV]=_M_SPE[10]
N1120 AX[_VAV]=_LTP[_P_PV]+_M_SPE[3]+_HR[2]
IF _AXIND
N1125 AX[_MAV]=(_LTP[_P_YY]+_LTP[_P_YY+1])/2
ELSE
N1126 AX[_MAV]=(_LTP[_P_XX]+_LTP[_P_XX+1])/2
ENDIF
IF _M_N[18]
N1128 G91 G1 AX[_VAV]=-_M_SPE[3] F=_M_SPE[0]
ELSE
IF _MD13230>0
IF $MN_MEAS_PROBE_LOW_ACTIVE[_M_N[0]-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
IF _MD51740_6
WHENEVER($AC_PLC_OVR<>0) DO $AC_OVR=10000/$AC_PLC_OVR
WHENEVER($AC_PLC_OVR==0) DO $AC_OVR=0
ENDIF
N1130 G91 G1 MEAS=_M_N[0] AX[_VAV]=-_M_SPE[60]*_M_SPE[3] F=_M_SPE[0]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _MK3
_ALARM=61301
GOTOF _M120
ENDIF
_MK3:
IF _M_N[18]
_MERET=_M_ME[11]
_M_ME[11]=_LTP[_P_PV]+_HR[2]
N1134 _M_ME[1]=_M_ME[11]
ELSE
_M_ME[1]=$AA_MW[_VAV]
ENDIF
N1135 G0 G90 AX[_VAV]=_LTP[_P_PV]+_M_SPE[3]+_HR[2]
N1140 AX[_MAV]=_M_SPE[10]
N1141 G0
IF _VB[1]==0
N1142 G1 F=_M_SPE[1]
ENDIF
N1145 AX[_VAV]=_LTP[_P_PV+1]-_M_SPE[3]-_HR[2]
IF _AXIND
N1150 AX[_MAV]=(_LTP[_P_YY]+_LTP[_P_YY+1])/2
ELSE
N1155 AX[_MAV]=(_LTP[_P_XX]+_LTP[_P_XX+1])/2
ENDIF
IF _M_N[18]
N1160 G91 G1 AX[_VAV]=_M_SPE[3] F=_M_SPE[0]
_M_ME[11]=_LTP[_P_PV+1]-_HR[2]
ELSE
IF _MD13230>0
IF $MN_MEAS_PROBE_LOW_ACTIVE[_M_N[0]-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _ERR4
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
IF _MD51740_6
WHENEVER($AC_PLC_OVR<>0) DO $AC_OVR=10000/$AC_PLC_OVR
WHENEVER($AC_PLC_OVR==0) DO $AC_OVR=0
ENDIF
N1170 G91 G1 MEAS=_M_N[0] AX[_VAV]=_M_SPE[60]*_M_SPE[3] F=_M_SPE[0]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _MK4
_ALARM=61301
GOTOF _M120
ENDIF
_MK4:
IF _M_N[18]
N1172 _M_ME[2]=_M_ME[11]
_M_ME[11]=_MERET
ELSE
_M_ME[2]=$AA_MW[_VAV]
ENDIF
N1175 G0 G90 AX[_VAV]=_LTP[_P_PV+1]-_M_SPE[3]-_HR[2]
N1180 AX[_MAV]=_M_SPE[10]
N1185 AX[_VAV]=(_M_ME[1]+_M_ME[2])/2
IF _MD13230>0
DO $A_OUT[_MD13230]=0
G4 F0.1
ENDIF
ENDIF
ENDIF
_M91A:
_ALARM=0 _SERR=""
N1075 CYCLE121(_MAV,_XX,_YY,_ZZ,_SP,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN)
_VMS=_M_SPE[0]
IF (_ALARM == 61301) GOTOF _GENDE
IF _ALARM GOTOF _M120
IF ( (_H_STMV[0]==0)AND(_H_STMV[6]==1)AND(_HI[0]<4) )
IF (_UMSCHLAG==0)
_M_ME[6]=_M_ME[8] _M_ME[8]=0 _UMSCHLAG=1
SPOS=IC(180)
GOTOB _M91A
ELSE
_M_ME[8]=(_M_ME[8]+_M_ME[6])/2 _M_ME[6]=0 _UMSCHLAG=0
ENDIF
ENDIF
IF ( ((_VB[53])OR(_VB[54]))AND(_M_ZUST[16]==0)AND(_M_ZUST[17]==0) )
;------------------------------------------------------------------------
_M_ZUST[16]=1
;------------------------------------------------------------------------
IF (_VB[53]) GOTOB _M91
IF (_VB[54])
IF (_P_PV1==4)
_P_ZPOS_UE_MT=_LTP[_P_PV1]+ABS(_M_SPE[3])
ELSE
_P_ZPOS_UE_MT=_LTP[_P_PV1]-ABS(_M_SPE[3])
ENDIF
_ALARM=61302
IF (_INTERN[40+2])
N1060 MEAS=_M_N[0] AX[_VAV1]=_P_ZPOS_UE_MT
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
ELSE
N1065 AX[_VAV1]=_P_ZPOS_UE_MT
ENDIF
GOTOB _M1B
ENDIF
ELSE
IF ( ((_VB[53])OR(_VB[54]))AND(_M_ZUST[16]==1)AND(_M_ZUST[17]==0) )
;------------------------------------------------------------------------
_M_ZUST[17]=1
;------------------------------------------------------------------------
ENDIF
ENDIF
_M_ZUST[7]=1
IF _H_STMV[0] GOTOF _M92
IF (_MVWKS==0)
$AC_MEAS_VALID=0 $AC_MEAS_P1_COORD=0 $AC_MEAS_P2_COORD=1 $AC_MEAS_TYPE=24
FOR _I=0 TO 1
$AA_MEAS_POINT1[_XX]=_LTP[_I] $AA_MEAS_POINT1[_YY]=_LTP[_I+2] $AA_MEAS_POINT1[_ZZ]=_LTP[_I+4]
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _M120
ENDIF
_LTP[_I]=$AA_MEAS_POINT2[_XX] _LTP[_I+2]=$AA_MEAS_POINT2[_YY] _LTP[_I+4]=$AA_MEAS_POINT2[_ZZ]
_OVR[8+2*_I]=_LTP[_I] _OVR[12+2*_I]=_LTP[_I+2] _OVR[16+2*_I]=_LTP[_I+4]
ENDFOR
IF ((_HI[0]==0)OR(_HI[0]==1))
$AA_MEAS_POINT1[_XX]=_M_ME[8]
ELSE
IF ((_HI[0]==2)OR(_HI[0]==3))
$AA_MEAS_POINT1[_YY]=_M_ME[8]
ELSE
$AA_MEAS_POINT1[_ZZ]=_M_ME[8]
ENDIF
ENDIF
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _M120
ENDIF
IF ((_HI[0]==0)OR(_HI[0]==1))
_M_ME[8]=$AA_MEAS_POINT2[_XX]
ELSE
IF ((_HI[0]==2)OR(_HI[0]==3))
_M_ME[8]=$AA_MEAS_POINT2[_YY]
ELSE
_M_ME[8]=$AA_MEAS_POINT2[_ZZ]
ENDIF
ENDIF
ELSE
_OVR[8]=_LTP[0] _OVR[10]=_LTP[1] _OVR[12]=_LTP[2] _OVR[14]=_LTP[3] _OVR[16]=_LTP[4] _OVR[18]=_LTP[5]
ENDIF
_HI[3]=_P_PT*2 _M_ME[0]=_M_ME[8]-_HR[2]*_MESSR
IF ( (_AUTKAL)AND(_MAV==_ZZ) )
IF (S_Z==0)
_TRIGLAG=_LTP[_P_PT] S_SET_TRIGLAG_ZZ=_LTP[_P_PT] S_Z=1
ELSE
_TRIGLAG=S_SET_TRIGLAG_ZZ
ENDIF
ELSE
_TRIGLAG=_LTP[_P_PT]
ENDIF
GOTOF _M93
_M92:
IF _VB[40]
_TRIGLAG=_M_SPE[13] _M_ME[8]=_M_ME[8]+_TRIGLAG _HI[3]=0 _HI[1]=_M_N[17]
IF ( (_VB[54])AND(_M_ZUST[17]) )
FOR _ZAHN=1 TO _M_N[27]
_M_ME[14+_ZAHN]=_M_ME[14+_ZAHN]+_TRIGLAG
ENDFOR
ENDIF
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Sollwert-Lnge : "<<_TRIGLAG)
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
ELSE
_TRIGLAG=$P_TOOLR _HI[3]=2 _HI[1]=4
IF ( (_LOG_ON)AND(_M_ZUST[17]) )
WRITE(_LOG,_LOG_FILE,"Sollwert-Radius : "<<_TRIGLAG)
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
ENDIF
IF (_MESSR==-1)
_M_ME[0]=_LTP[_P_PT]-_M_ME[8]
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
FOR _ZAHN=1 TO _M_N[27]
_M_ME[14+_ZAHN]=_LTP[_P_PT]-_M_ME[14+_ZAHN]
IF(_LOG_ON)
IF (_VB[53])
WRITE(_LOG,_LOG_FILE,"Radius-Istwert "<<_ZAHN<<" : "<<_M_ME[14+_ZAHN])
ELSE
WRITE(_LOG,_LOG_FILE,"Lnge-Istwert "<<_ZAHN<<" : "<<_M_ME[14+_ZAHN])
ENDIF
ENDIF
ENDFOR
ENDIF
ELSE
_M_ME[0]=_M_ME[8]-_LTP[_P_PT]
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
FOR _ZAHN=1 TO _M_N[27]
_M_ME[14+_ZAHN]=_M_ME[14+_ZAHN]-_LTP[_P_PT]
IF(_LOG_ON)
IF (_VB[53])
WRITE(_LOG,_LOG_FILE,"Radius-Istwert "<<_ZAHN<<" : "<<_M_ME[14+_ZAHN])
ELSE
WRITE(_LOG,_LOG_FILE,"Lnge-Istwert "<<_ZAHN<<" : "<<_M_ME[14+_ZAHN])
ENDIF
ENDIF
ENDFOR
ENDIF
ENDIF
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
_L_S=0
FOR _ZAHN=1 TO _M_N[27]
IF (_M_ME[14+_ZAHN]>_L_S)
_L_S=_M_ME[14+_ZAHN] _L_SI=_ZAHN _M_ME[0]=_L_S
ENDIF
ENDFOR
_M_ME[0]=_L_S
IF(_LOG_ON)
IF (_VB[53])
WRITE(_LOG,_LOG_FILE,"========================================")
WRITE(_LOG,_LOG_FILE,"grter Radius "<<_L_SI<<" : "<<_L_S)
WRITE(_LOG,_LOG_FILE,"========================================")
ELSE
WRITE(_LOG,_LOG_FILE,"========================================")
WRITE(_LOG,_LOG_FILE,"grte Lnge "<<_L_SI<<" : "<<_L_S)
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
ENDIF
ENDIF
_M93: _OVR[8+_HI[3]]=_M_ME[0]
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
_II=100 _I=0
IF (_VB[54])
_II=300
ENDIF
FOR _ZAHN=_L_SI TO _M_N[27]
_OVR[_II+_I]=_M_ME[14+_ZAHN]
_I=_I+1
ENDFOR
IF (_L_SI<>1)
FOR _ZAHN=1 TO _L_SI-1
_OVR[_II+_I]=_M_ME[14+_ZAHN]
_I=_I+1
ENDFOR
ENDIF
IF (_LOG_ON)
WRITE(_LOG,_LOG_FILE,"Istwerte geordnet nach der lngsten Schneide")
FOR _I=1 TO _M_N[27]
IF (_VB[53])
WRITE(_LOG,_LOG_FILE,"Radius-Istwert "<<_I<<" : "<<_OVR[_II+_I-1])
ELSE
WRITE(_LOG,_LOG_FILE,"Lngen-Istwert "<<_I<<" : "<<_OVR[_II+_I-1])
ENDIF
ENDFOR
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
ENDIF
IF _H_STMV[0]==0 GOTOF _M97
IF ( (_VB[30])AND(_M_N[25])AND(_H_STMV[2]==0) )
_WZR=0 _WZT=0
IF $MN_SCALING_SYSTEM_IS_METRIC
_LAGE =_M_SPE[22]*$PI*2*$P_TOOLR/1000
ELSE
_LAGE =_M_SPE[22]*$PI*2*$P_TOOLR/12
ENDIF
IF _LAGE>=_KOR[1,0]
_WZT=1
IF (_LAGE>=_KOR[2,0])AND(_KOR[2,0]>0)
_WZT=2
IF (_LAGE>=_KOR[3,0])AND(_KOR[3,0]>0)
_WZT=3
IF (_LAGE>=_KOR[4,0])AND(_KOR[4,0]>0)
_WZT=4
IF (_LAGE>=_KOR[5,0])AND(_KOR[5,0]>0)
_WZT=5
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF _WZT
IF $P_TOOLR >=_KOR[0,1]
_WZR=1
IF $P_TOOLR >=_KOR[0,2]
_WZR=2
IF $P_TOOLR >=_KOR[0,3]
_WZR=3
IF $P_TOOLR >=_KOR[0,4]
_WZR=4
ENDIF
ENDIF
ENDIF
ENDIF
IF _WZR
_OVR[8+_HI[3]]=_OVR[8+_HI[3]]-_KOR[_WZT,_WZR]
ENDIF
ENDIF
ENDIF
IF (_H_STMV[4]==1) GOTOF _M97
_M_N[8]=_M_N[22] MOD 10000
_OVI[7]=_M_N[8]
IF (_OVI[7]>0)
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF (_INTERN[40+5])
_HR[0]=-_HR[0]
ENDIF
_OVR[8+_HI[3]]=_OVR[8+_HI[3]]-_HR[0]
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
_II=99
IF (_VB[54])
_II=299
ENDIF
FOR _ZAHN=1 TO _M_N[27]
_OVR[_II+_ZAHN]=_OVR[_II+_ZAHN]-_HR[0]
ENDFOR
ENDIF
ENDIF
_M97:_OVR[9+_HI[3]]=_OVR[8+_HI[3]]-_TRIGLAG _M_ME[4]=SET(0,0,0,0,0,0)
IF ( (_SMI_R[10]==93101.901)AND((_MVAR _DEC1)==0) )
E_MESS[9+_HI[3]]=_OVR[9+_HI[3]]
ENDIF
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
_II=99
IF (_VB[54])
_II=299
ENDIF
FOR _ZAHN=1 TO _M_N[27]
_OVR[_II+100+_ZAHN]=_OVR[_II+_ZAHN]-_TRIGLAG
IF(_LOG_ON)
IF (_VB[53])
WRITE(_LOG,_LOG_FILE,"Radius-Differenz "<<_ZAHN<<" : "<<_OVR[_II+100+_ZAHN])
ELSE
WRITE(_LOG,_LOG_FILE,"Lngen-Differenz "<<_ZAHN<<" : "<<_OVR[_II+100+_ZAHN])
ENDIF
ENDIF
ENDFOR
_K_S=_M_ME[0]
FOR _ZAHN=1 TO _M_N[27]
IF (_OVR[_II+_ZAHN]<_K_S)
_K_S=_OVR[_II+_ZAHN] _K_SI=_ZAHN
ENDIF
ENDFOR
IF (_VB[53])
_OVR[14]=_K_S _OVR[15]=_K_S-_TRIGLAG
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"========================================")
WRITE(_LOG,_LOG_FILE,"kleinster Radius "<<_K_SI<<" : "<<_K_S)
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
ELSE
_OVR[12]=_K_S _OVR[13]=_K_S-_TRIGLAG
IF(_LOG_ON)
WRITE(_LOG,_LOG_FILE,"========================================")
WRITE(_LOG,_LOG_FILE,"kleinste Lnge "<<_K_SI<<" : "<<_K_S)
WRITE(_LOG,_LOG_FILE,"========================================")
ENDIF
ENDIF
ENDIF
IF (_VB[15] AND (_H_STMV[0]==0)) GOTOF _M113
_M111:
IF (_H_STMV[4]==1) GOTOF _M113
IF ABS(_OVR[9+_HI[3]])<_M_SPE[32] GOTOF _M112
_ALARM=61303
_M112:IF (_ALARM)OR(_H_STMV[0]==0) GOTOF _M113
IF ( ((_M_ZUST[17])AND((_VB[53])OR(_VB[54]))) )
_II=199
IF (_VB[54])
_II=399
ENDIF
FOR _ZAHN=1 TO _M_N[27]
IF (ABS(_OVR[_II+_ZAHN])>_M_SPE[34])
_S_ANZ=_S_ANZ+1
ENDIF
ENDFOR
ENDIF
IF (ABS(_OVR[9+_HI[3]])<_M_SPE[34]) GOTOF _M113
_ALARM=61306
_M113:
IF ( (_ALARM==61303)OR(_ALARM==61306) )
IF ( (_INTERN[20+0])AND(_M_N[7]<4) )
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]
N1180 SETAL(_ALARM+1000)
N1190 M0
STOPRE
ENDIF
_M_ZUST[7]=0 _ALARM=0 _SERR=""
MSG()
ENDIF
ENDIF
IF _M_ZUST[7]==0 GOTOB _M91
_PROTVAL[29]="T,"<<$P_GG[6]+16<<",,,,,F"<<_M_SPE[0]
IF (_H_STMV[0]<>0)
IF (_INTERN[40+3]==0)
IF (_HI[1]==1)
_PROTVAL[25]="$P_ADT[3]"
ELSE
_PROTVAL[28]="$P_ADT[6]"
ENDIF
ELSE
IF (_HI[1]==1)
_PROTVAL[25]="$P_ADT[12]"
ELSE
_PROTVAL[28] ="$P_ADT[15]"
ENDIF
ENDIF
ENDIF
IF _ALARM GOTOF _M120
IF (ABS(_OVR[9+_HI[3]])<_M_SPE[33]) GOTOF _M120 IF (_H_STMV[0]==0) GOTOF _M117
IF ((_M_N[18]==2)OR(_M_N[18]==4)) GOTOF _M120
IF (_INTERN[40+3]==0)
_KOR_TOOLL[0]=_OVR[8+_HI[3]] _COMP="GW:T" _CORMODE=2
IF (_HI[1]==1)
_CORCOMP=0 _GEOAX=2
ELSE
_CORCOMP=6
ENDIF
ELSE
_KOR_TOOLL[0]=_OVR[9+_HI[3]] _COMP="W:T" _CORMODE=1
IF (_HI[1]==1)
_CORCOMP=0 _GEOAX=2
ELSE
_CORCOMP=6
ENDIF
ENDIF
_OVI[12]=SETTCOR(_KOR_TOOLL,_COMP,_CORCOMP,_CORMODE,_GEOAX)
IF _OVI[12]<>0
_ALARM=61404
ENDIF
GOTOF _M120
_M117:
IF (_M_N[18]==2) OR (_M_N[18]==4) GOTOF _M120
IF (_MVWKS==0)
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC2 _K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC3 _K_STAT_APP=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC4
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
$SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]=_LTP[_P_XX] $SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB]=_LTP[_P_XX+1]
$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]=_LTP[_P_YY] $SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB]=_LTP[_P_YY+1]
$SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB]=_LTP[_P_ZZ] $SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB]=_LTP[_P_ZZ+1]
$SNS_MEA_TP_EDGE_DISK_SIZE[_P_PROB]=_LTP[6] $SNS_MEA_TP_AX_DIR_AUTO_CAL[_P_PROB]=_ZMR[0]+10*_ZMR[1]+100*_ZMR[2]
$SNS_MEA_TP_TYPE[_P_PROB]=_LTP[8] $SNS_MEA_TP_CAL_MEASURE_DEPTH[_P_PROB]=_LTP[9]
ENDIF
CASE (_HI[0]) OF 0 GOTOF _MKS_P_ABS 1 GOTOF _MKS_M_ABS 2 GOTOF _MKS_P_ORD 3 GOTOF _MKS_M_ORD 4 GOTOF _MKS_P_APP 5 GOTOF _MKS_M_APP
_MKS_P_ABS:
$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]] _TP[_P_PROB,1]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==1) )
_K_STAT_ABS=_K_STAT_ABS+2
ENDIF
GOTOF _MKS_ENDE
_MKS_M_ABS:
$SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]] _TP[_P_PROB,0]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==2) )
_K_STAT_ABS=_K_STAT_ABS+1
ENDIF
GOTOF _MKS_ENDE
_MKS_P_ORD:
$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]] _TP[_P_PROB,3]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==1) )
_K_STAT_ORD=_K_STAT_ORD+2
ENDIF
GOTOF _MKS_ENDE
_MKS_M_ORD:
$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]] _TP[_P_PROB,2]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==2) )
_K_STAT_ORD=_K_STAT_ORD+1
ENDIF
GOTOF _MKS_ENDE
_MKS_P_APP:
$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB]=_OVR[8+_HI[3]] _TP[_P_PROB,5]=_OVR[8+_HI[3]]
IF ( (_K_STAT_APP==0)OR(_K_STAT_APP==1) )
_K_STAT_APP=_K_STAT_APP+2
ENDIF
GOTOF _MKS_ENDE
_MKS_M_APP:
$SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB]=_OVR[8+_HI[3]] _TP[_P_PROB,4]=_OVR[8+_HI[3]]
IF ( (_K_STAT_APP==0)OR(_K_STAT_APP==2) )
_K_STAT_APP=_K_STAT_APP+1
ENDIF
_MKS_ENDE:
$SNS_MEA_TP_FEED[_P_PROB]=_M_SPE[0] _K_STAT_CYC=1 _K_STAT_KOORD=$MCS_DISP_COORDINATE_SYSTEM
$SNS_MEA_TP_STATUS_GEN[_P_PROB]=$P_GG[6]+(10*_K_STAT_ABS)+(100*_K_STAT_ORD)+(1000*_K_STAT_APP)+(10000*_K_STAT_CYC)+(100000*_K_STAT_KOORD)
IF _SMI_R[10]==0
_TP[0,0]=REP(-9999)
ENDIF
ELSE
_K_STAT_ABS=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC2 _K_STAT_ORD=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC3 _K_STAT_APP=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC4
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]=_LTP[_P_XX] $SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB]=_LTP[_P_XX+1]
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]=_LTP[_P_YY] $SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB]=_LTP[_P_YY+1]
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB]=_LTP[_P_ZZ] $SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB]=_LTP[_P_ZZ+1]
$SNS_MEA_TPW_EDGE_DISK_SIZE[_P_PROB]=_LTP[6] $SNS_MEA_TPW_AX_DIR_AUTO_CAL[_P_PROB]=_ZMR[0]+10*_ZMR[1]+100*_ZMR[2]
$SNS_MEA_TPW_TYPE[_P_PROB]=_LTP[8] $SNS_MEA_TPW_CAL_MEASURE_DEPTH[_P_PROB]=_LTP[9]
ENDIF
CASE (_HI[0]) OF 0 GOTOF _WKS_P_ABS 1 GOTOF _WKS_M_ABS 2 GOTOF _WKS_P_ORD 3 GOTOF _WKS_M_ORD 4 GOTOF _WKS_P_APP 5 GOTOF _WKS_M_APP
_WKS_P_ABS:
$SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==1) )
_K_STAT_ABS=_K_STAT_ABS+2
ENDIF
GOTOF _WKS_ENDE
_WKS_M_ABS:
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==2) )
_K_STAT_ABS=_K_STAT_ABS+1
ENDIF
GOTOF _WKS_ENDE
_WKS_P_ORD:
$SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==1) )
_K_STAT_ORD=_K_STAT_ORD+2
ENDIF
GOTOF _WKS_ENDE
_WKS_M_ORD:
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]]
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==2) )
_K_STAT_ORD=_K_STAT_ORD+1
ENDIF
GOTOF _WKS_ENDE
_WKS_P_APP:
$SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB]=_OVR[8+_HI[3]]
IF ( (_K_STAT_APP==0)OR(_K_STAT_APP==1) )
_K_STAT_APP=_K_STAT_APP+2
ENDIF
GOTOF _WKS_ENDE
_WKS_M_APP:
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB]=_OVR[8+_HI[3]]
IF ( (_K_STAT_APP==0)OR(_K_STAT_APP==2) )
_K_STAT_APP=_K_STAT_APP+1
ENDIF
_WKS_ENDE:
$SNS_MEA_TPW_FEED[_P_PROB]=_M_SPE[0] _K_STAT_CYC=1 _K_STAT_KOORD=$MCS_DISP_COORDINATE_SYSTEM
$SNS_MEA_TPW_STATUS_GEN[_P_PROB]=$P_GG[6]+(10*_K_STAT_ABS)+(100*_K_STAT_ORD)+(1000*_K_STAT_APP)+(10000*_K_STAT_CYC)+(100000*_K_STAT_KOORD)
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
_TPW[0,0]=REP(-9999)
ENDIF
ENDIF
IF (_AUTKAL)
_LTP[_P_PT]=_OVR[8+_HI[3]]
IF (_MVWKS==0)
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
FOR _I=0 TO 1
$AA_MEAS_POINT1[_XX]=_LTP[_I] $AA_MEAS_POINT1[_YY]=_LTP[_I+2] $AA_MEAS_POINT1[_ZZ]=_LTP[_I+4]
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _M120
ENDIF
_LTP[_I]=$AA_MEAS_POINT2[_XX] _LTP[_I+2]=$AA_MEAS_POINT2[_YY] _LTP[_I+4]=$AA_MEAS_POINT2[_ZZ]
ENDFOR
ENDIF
ENDIF
_M120:
IF (_S_ANZ<>0)
_ALARM=62320 _SERR=<<_S_ANZ
ENDIF
_OVI[9]=_ALARM
IF (_AUTKAL==0) GOTOF _M120A
IF _ALARM OR (_MPCOUNT==0) GOTOF _M120A
_MPCOUNT=_MPCOUNT-1
IF _MPCOUNT GOTOB _MM1AK
_M120A:
IF ((_ALARM>=61303)AND(_ALARM<=61306))OR(_ALARM==62320)
IF (_INTERN[4]==1)
CUST_MEACYC(4)
ENDIF
GOTOF _M121
ENDIF
IF (_ALARM == 0) GOTOF _M121
STOPRE
IF ($AA_S[$AC_MSNUM]<>0)
M5
STOPRE
ENDIF
N1200 SETAL(_ALARM,_SERR)
_M120B: M0
STOPRE
SETAL(61327)
GOTOB _M120B
_M121:
IF (((_SMI_R[10]==0)OR(_SMI_R[10]==11))AND(_M_SPE20=="-777"))
IF (_MVWKS==0)
_TP[0,0]=REP(-9999)
ELSE
_TPW[0,0]=REP(-9999)
ENDIF
ENDIF
D=$P_TOOL DL=$P_DLNO
IF ((_ALARM>=61303)AND(_ALARM<=61306))
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND(((_ALARM<61303)OR(_ALARM>61306))OR(_ALARM<>62320))))AND(_INTERN[20+9]==0) GOTOF _M123
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND(((_ALARM<61303)OR(_ALARM>61306))OR(_ALARM<>62320))))AND(_INTERN[20+9]==1) GOTOF _M122
IF ( ((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(((_ALARM>=61303)AND(_ALARM<=61306))OR(_ALARM==62320)) )
STOPRE
IF NOT((_INTERN[4]==1) AND (_INTERN[5]==1))
IF ((_ALARM>=61303)AND(_ALARM<=61306))
N1153 SETAL(_ALARM+1000)
ELSE
IF (_ALARM==62320)
SETAL(_ALARM,_SERR)
ENDIF
ENDIF
ENDIF
ENDIF
IF (_H_STMV[2])
IF ($P_GG[13]==1)OR($P_GG[13]==3)
_I=$MNS_DISP_RES_INCH
ELSE
_I=$MNS_DISP_RES_MM
ENDIF
_AGV[0]=1
FOR _II=1 TO _I
_AGV[0]=_AGV[0]*10
ENDFOR
FOR _II=100 TO 499
_OVR[_II]=(ROUND(_OVR[_II]*_AGV[0]))/_AGV[0]
ENDFOR
ENDIF
IF (_M_SPE[29]<>1)
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M121A IF _M_N[28]==2 GOTOF _M122
G4 F8
N1160 _M121A: CYCLE102(0)
N1200 _M122:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF (_M_SPE[29]<>1)
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
_M123:
IF NOT((_INTERN[4]==1) AND (_INTERN[5]==1))
IF ((_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
IF (_ALARM>61303)
IF _INTERN[20+2]
N1230 SETAL(_ALARM+1000)
N1240 M0
ELSE
_OVI[9]=_OVI[9]-1000
N1230 SETAL(_ALARM)
ENDIF
ELSE
IF ($AA_S[$AC_MSNUM]<>0)
M5
STOPRE
ENDIF
_OVI[9]=_ALARM
N1240 SETAL(_ALARM)
ENDIF
STOPRE
N1195 MSG()
ELSE
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR(_M_N[28]==4))AND(_ALARM<>0)
IF ($AA_S[$AC_MSNUM]<>0)
M5
STOPRE
ENDIF
_OVI[9]=_ALARM
N1240 SETAL(_ALARM,_SERR)
STOPRE
N1195 MSG()
ENDIF
ENDIF
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
IF (_MVWKS==0)
$P_CYCFRAME=CTRANS()
ENDIF
RET
N697102 _ENDE: SETAL(62301)
M0
_GENDE: RET
_K_STAT_A:
IF (_H_STMV[0]<>0)
_ALARM=61374
_S_XX=AXSTRING(_XX) _S_YY=AXSTRING(_YY) _S_ZZ=AXSTRING(_ZZ)
IF (_M_ZUST[0])
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==1) )
_SERR=<<"+"<<_S_XX
GOTOB _M120
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF (_M_ZUST[1])
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==2) )
_SERR=<<"-"<<_S_XX
GOTOB _M120
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF (_M_ZUST[2])
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==1) )
_SERR=<<"+"<<_S_YY
GOTOB _M120
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF (_M_ZUST[3])
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==2) )
_SERR=<<"-"<<_S_YY
GOTOB _M120
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF (_M_ZUST[4])
IF ( (_K_STAT_APP==0)OR(_K_STAT_APP==1) )
_SERR=<<"+"<<_S_ZZ
GOTOB _M120
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF (_M_ZUST[5])
IF ( (_K_STAT_APP==0)OR(_K_STAT_APP==2) )
_SERR=<<"-"<<_S_ZZ
GOTOB _M120
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
_K_STAT_ENDE:
_ALARM=0 _SERR=""
ENDIF
_K_STAT_E:
_WZ_VERSATZ_A:
_HR[4]=(_LTP[_P_PV]+_LTP[_P_PV+1])/2
IF (_SMI_R[10]==93101.901)
IF ($MNS_J_MEA_T_PROBE_APPR_AX_DIR[_P_PROB]<0)
IF (_H_AMODE[3]==1)
_HR[2]=_HR[1]+_ID
ELSE
_HR[2]=_HR[1]-_ID
ENDIF
ELSE
IF (_H_AMODE[3]==1)
_HR[2]=_HR[1]-_ID
ELSE
_HR[2]=_HR[1]+_ID
ENDIF
ENDIF
ELSE
IF (_AUTKAL==0)
IF _M_SPE[5+_V]>_HR[4]
IF (_H_AMODE[3]==1)
_HR[2]=_HR[1]+_ID
ELSE
_HR[2]=_HR[1]-_ID
ENDIF
ELSE
IF (_H_AMODE[3]==1)
_HR[2]=_HR[1]-_ID
ELSE
_HR[2]=_HR[1]+_ID
ENDIF
ENDIF
ELSE
IF _M_SPE5>_HR[4]
IF (_H_AMODE[3]==1)
_HR[2]=_HR[1]+_ID
ELSE
_HR[2]=_HR[1]-_ID
ENDIF
ELSE
IF (_H_AMODE[3]==1)
_HR[2]=_HR[1]-_ID
ELSE
_HR[2]=_HR[1]+_ID
ENDIF
ENDIF
ENDIF
ENDIF
_WZ_VERSATZ_E:
_ERR4: _OVI[9]=61166
N611104 SETAL(_OVI[9],"MD13230="<<_MD13230<<" MD10360=0 ?")
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE973_SPF
PROC CYCLE973(INT S_MVAR,INT S_PRNUM,INT S_CALNUM,REAL S_SETV,INT S_MA,INT S_MD,REAL S_FA,REAL S_TSA,REAL S_VMS,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.005 ;DATE: 2024-04-08
;Cycle : calibrate workpiece probe turning
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56]
N1020 DEF REAL _M_SPE[64],_M_ME[16],_LAGE,_KOR_TOOLL[3]
N1040 DEF INT _M_N[30],_ALARM,_P_KB,_AXIND,_H_WP10,_NEW_PAR,_H_SIM,_DIR,_DIR2
N1060 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV
N1070 DEF INT _I1,_MPZ,_HI[12],_MESSR,_HM=1,_H_XX=1,_H_YY=1,_H_ZZ=1,_H_A
N1080 DEF REAL _HR[8],_L[3],_DAT[3,6],_KF[3,3],_H_TR_AP[2],_H_HR
N1040 DEF INT _H_DMODE
N1042 DEF STRING[40] _SERR
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE973_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE973_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE973("<<S_MVAR<<","<<S_PRNUM<<","<<S_CALNUM<<","<<S_SETV<<","<<S_MA<<","<<S_MD<<","<<S_FA<<","<<S_TSA<<","<<S_VMS<<","<<S_NMSP<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) > 3) GOTOF _FL12
_SERR=<<"(S_MVAR: dec2)"
IF ((S_MVAR _DEC2) > 1) GOTOF _FL12
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 1) GOTOF _FL12
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4) > 2) GOTOF _FL12
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 1) GOTOF _FL12
_SERR=<<"(S_MVAR: dec7)"
IF ((S_MVAR _DEC7) > 1) GOTOF _FL12
IF (((S_MVAR _DEC7)==1) AND ((S_MVAR _DEC1)==1))
S_MVAR = S_MVAR - 1000000
ENDIF
S_CALNUM=ABS(S_CALNUM)
_SERR=<<"(S_CALNUM= "<<S_CALNUM<<")"
IF ( ((S_CALNUM == 0) OR (S_CALNUM > 3)) AND ((S_MVAR _DEC1) > 1) ) GOTOF _FL12
_CALNUM=ABS(S_CALNUM)
IF ((S_MVAR _DEC1) < 2)
_MVAR=0 _MVAR=_MVAR+((S_MVAR _DEC7)*1000000)
ELSE
IF (((S_MVAR _DEC1) == 3) AND ((S_MVAR _DEC7) == 1))
S_MVAR = S_MVAR - 1000000
ENDIF
IF ((S_MVAR _DEC1) == 2)
S_MVAR = S_MVAR + 1
IF ((S_MVAR _DEC4) == 0)
S_MVAR = S_MVAR + 1000
ENDIF
S_MD=1
ENDIF
IF ((S_MVAR _DEC1) == 1)
IF ((S_MVAR _DEC4) == 0)
S_MVAR = S_MVAR + 1000
ENDIF
S_MVAR =S_MVAR-1
ENDIF
IF S_MVAR <> 0
S_MVAR = S_MVAR - ((S_MVAR _DEC2)*10)+10 S_MVAR = S_MVAR - ((S_MVAR _DEC3)*100)+100
IF ((S_MVAR _DEC4) == 2)
IF ((S_MVAR _DEC5) == 0)
S_MVAR = S_MVAR + 10000
ELSE
S_MVAR = S_MVAR - 10000
ENDIF
ENDIF
ENDIF
_MVAR=ABS(S_MVAR)
ENDIF
IF S_VMS <> 0
_VMS = ABS(S_VMS)
ELSE
_VMS=$SCS_MEA_FEED_MEASURE
ENDIF
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _MA=ABS(S_MA) _MD=S_MD _FA=ABS(S_FA) _TSA=ABS(S_TSA)
_NEW_PAR=1 _TZL=0 _M_SPE[3]=1
_SERR=<<"(_DMODE: dec1)"
_H_DMODE = ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _FL12
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
_M_SPE[3]=1
ELSE
IF _VMS == 0
_VMS=$SCS_MEA_FEED_MEASURE
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
_M_END:
IF ($AN_NCK_VERSION<660000) GOTOF _FL11
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] = 301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_H_HR=$P_ADT[6]/2 _HI[10]=2
ELSE
_H_HR=$P_ADT[6] _HI[10]=1
ENDIF
_OVI[2]=973
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1121 G0 G90 G94
_HI[2]=_MVAR _DEC1 _HI[3]=_MVAR _DEC3 _HI[4]=_MVAR _DEC4 _HI[5]=_MVAR _DEC5 _HI[9]=_MVAR _DEC7 _HI[6]=SET(1,1,1)
IF _HI[2] == 3
N1124 DIAMCYCOF
ELSE
IF _NEW_PAR==1
DIAMON
ELSE
IF $P_GG[29]==3
N1126 DIAMON
ENDIF
ENDIF
ENDIF
N1120 CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_HR[2]=$P_ADT[2]
IF (_INTERN[2]==0)OR(_INTERN[10]==0) GOTOF _FL9
IF ((_MA==3)AND(_INTERN[18]==0)) GOTOF _Fl9
IF ((_HI[2]<>3)AND(_HI[2]<>0))OR(_HI[5]>1)OR(_HI[4]>2)OR(_HI[3]>1) GOTOF _FL1
IF _HI[9] AND (_HI[2]==3)AND((_HR[2]==7)OR(_HR[2]==8))AND(_HI[4]==2) GOTOF _FL2
IF _HI[9] AND (_HI[2]==3)AND(_HR[2]==7)AND(_HI[4]==1)AND((_MA==2)OR(_MA==3)) GOTOF _FL2
IF _HI[9] AND (_HI[2]==3)AND(_HR[2]==8)AND(_HI[4]==1)AND((_MA==1)OR(_MA==3)) GOTOF _FL2
IF _HI[9] AND(_HI[2]==0)AND(_HR[2]==7)AND((_MA==2)OR(_MA==3)) GOTOF _FL2
IF _HI[9] AND (_HI[2]==0)AND(_HR[2]==8)AND((_MA==1)OR(_MA==3)) GOTOF _FL2
IF (_INTERN[0] OR _INTERN[8] OR _INTERN[16] OR _INTERN[1] OR _INTERN[9] OR _INTERN[17])
IF (($P_GG[29]==1) OR ($P_GG[29]==4)) AND ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
_HM=2
IF (_INTERN[0] OR _INTERN[1])
_H_XX=2
ENDIF
IF (_INTERN[8] OR _INTERN[9])
_H_YY=2
ENDIF
IF (_INTERN[16] OR _INTERN[17])
_H_ZZ=2
ENDIF
ENDIF
ENDIF
IF _HI[2]==0 GOTOF _M0
IF (_MA<1)OR(_MA>2) GOTOF _FL2
_VB[20]=1 _P_KB=_CALNUM-1 _VB[6]=1
_HI[11]=1
IF ($SNS_MEA_ALARM_MASK B_AND 'B1')AND(NOT(ISVAR("_KB["<<_P_KB <<", ]")))
SETAL(61099," 4 ")
ENDIF
IF (_CALNUM > $MNS_MEA_CAL_EDGE_NUM) GOTOF _FL10
IF (_HR[2]<>7)AND(_HR[2]<>8) GOTOF _FL4
_MFRAME:
_ALARM=61016
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') GOTOF _FL8
$P_CYCFRAME=CTRANS()
_ALARM=0
IF ($P_TC)AND(_NEW_PAR)
_P_KB=_P_KB + 100
IF (_HM==2)
IF (_INTERN[0] OR _INTERN[1])
_M_SPE[5]=_M_SPE[5]/_HM
ENDIF
IF (_INTERN[8] OR _INTERN[9])
_M_SPE[6]=_M_SPE[6]/_HM
ENDIF
IF (_INTERN[16] OR _INTERN[17])
_M_SPE[7]=_M_SPE[7]/_HM
ENDIF
ENDIF
ELSE
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
_M_SPE[5]=SET($AA_IW[_XX],$AA_IW[_YY],$AA_IW[_ZZ])
IF (_HM==2)
IF (_INTERN[0] OR _INTERN[1])
_M_SPE[5]=_M_SPE[5]/_HM
ENDIF
IF (_INTERN[8] OR _INTERN[9])
_M_SPE[6]=_M_SPE[6]/_HM
ENDIF
IF (_INTERN[16] OR _INTERN[17])
_M_SPE[7]=_M_SPE[7]/_HM
ENDIF
ENDIF
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,-(_M_SPE[17]-_M_SPE[11]-_M_SPE[5])*_H_XX)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_YY,-(_M_SPE[18]-_M_SPE[12]-_M_SPE[6])*_H_YY)
IF _INTERN[18]
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_ZZ,-(_M_SPE[19]-_M_SPE[13]-_M_SPE[7])*_H_ZZ)
ENDIF
_M_SPE[5]=SET(_M_SPE[17]-_M_SPE[11],_M_SPE[18]-_M_SPE[12],_M_SPE[19]-_M_SPE[13])
ENDIF
GOTOF _M1
_M0:_VB[21]=1
IF (_MA==3) AND (_VB[33]) AND (_INTERN[40+19])
IF (_INTERN[8] AND ($P_GG[29]>1) AND ($P_GG[29]<4) AND (_HI[11]==0))
_M_SPE[16]=_M_SPE[16]/2
ENDIF
ENDIF
IF _HI[2]==3 GOTOF _M1 IF (_MD<0)OR(_MD>1) GOTOF _FL3
_HI[3]=SET(0,0,0)
_M1:IF (_MA<1)OR(_MA>3) GOTOF _FL2
IF _MA==1
_MAV=_XX _VAV=_YY _AXIND=0
ELSE
IF _MA==2
_MAV=_YY _VAV=_XX _AXIND=1 _H_A=2
ELSE
_MAV=_ZZ _VAV=_XX _AXIND=2 _H_A=0 _H_TR_AP[0]=SET(_M_SPE[25],_M_SPE[26])
ENDIF
ENDIF
_VB[10]=_HI[5] _VB[13]=_HI[4] DIV 2 _VB[11]=_HI[3]
IF _VB[13]
_M_ZUST[_H_A]=1
IF _VB[10]==0
IF _MA==1
_M_SPE[27]=0
ELSE
_M_SPE[28]=0
ENDIF
ENDIF
ELSE
_VB[10]=0 _VB[11]=0 _M_ZUST[_H_A+_MD]=1
IF _MA==1
_M_SPE[27]=0
ELSE
_M_SPE[28]=0
ENDIF
ENDIF
_M4:IF _VB[24] GOTOF _FL0
_H_WP10= _M_SPE[54] MOD 100000 _KF[0,0]= _M_SPE[54] MOD 1000000 DIV 100000 _M_SPE[54]=0 _KF[0,1]=1
IF _KF[0,0]== 1
_KF[0,1]= 0.03937
ENDIF
IF((_H_WP10 DIV 100)MOD 10<>$P_GG[6])OR((_H_WP10 DIV 1000)MOD 10 == 1)OR((_H_WP10 DIV 10000)MOD 10<>_VB[2])OR($SNS_MEA_WP_FEED[_M_N[1]] <(_M_SPE[0]-(_KF[0,1]/_M_SPE[52])))OR($SNS_MEA_WP_FEED[_M_N[1]] >(_M_SPE[0]+(_KF[0,1]/_M_SPE[52])))
_M_SPE[20]=SET(_H_HR*2,0,0,0,0,0,0,0,0) _M_SPE[53]=0 _H_WP10=$P_GG[6]*100
IF _VB[2]
_H_WP10=_H_WP10+10000
ENDIF
$SNS_MEA_WP_FEED[_M_N[1]]=_M_SPE[0] $SNS_MEA_WP_BALL_DIAM[_M_N[1]]=_M_SPE[20]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX1[_M_N[1]]=_M_SPE[21] $SNS_MEA_WP_TRIG_PLUS_DIR_AX1[_M_N[1]]=_M_SPE[22]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX2[_M_N[1]]=_M_SPE[23] $SNS_MEA_WP_TRIG_PLUS_DIR_AX2[_M_N[1]]=_M_SPE[24]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX3[_M_N[1]]=_M_SPE[25] $SNS_MEA_WP_TRIG_PLUS_DIR_AX3[_M_N[1]]=_M_SPE[26]
$SNS_MEA_WP_POS_DEV_AX1[_M_N[1]]=_M_SPE[27] $SNS_MEA_WP_POS_DEV_AX2[_M_N[1]]=_M_SPE[28]
$SNS_MEA_WP_STATUS_RT[_M_N[1]]=0 $SNS_MEA_WP_STATUS_GEN[_M_N[1]]=0
ENDIF
_NOWR1: _OVR[4]=_M_SPE[20] _M_ME[4]=SET(_M_SPE[21],_M_SPE[22],_M_SPE[23],_M_SPE[24]) _OVR[20]=SET(_M_SPE[27],_M_SPE[28]) _OVR[27]=_M_SPE[33]
IF(_INTERN[3])AND(_HI[2]==0)
_HI[6]=-1
ENDIF
IF(_INTERN[11])AND(_HI[2]==0)
_HI[7]=-1
ENDIF
IF(_INTERN[19])AND(_HI[2]==0)
_HI[8]=-1
ENDIF
IF _VB[1] GOTOF _M5
N1066 G1 F=_M_SPE[1]
_M5:
IF _VB[6]==0 GOTOF _M7
N1140 CYCLE117(_MAV,_XX,_YY,_ZZ,_AXIND,_P_KB,_M_N,_ALARM,_VB,_M_ZUST,_INTERN,_M_SPE,_H_HR)
IF _ALARM GOTOF _FL8
_M7:
_HI[0]=1 _HI[1]=1
IF ((_INTERN[0] OR _INTERN[1]) AND ($P_GG[29]>1) AND ($P_GG[29]<4) AND (_HI[11]==0))
_HI[0]=2
ENDIF
IF ((_INTERN[8] OR _INTERN[9]) AND ($P_GG[29]>1) AND ($P_GG[29]<4) AND (_HI[11]==0))
_HI[1]=2
ENDIF
N1150 AX[_XX]=(_M_SPE[5]+(_M_SPE[27]*_HI[0]))*_M_SPE[29]
N1160 AX[_YY]=(_M_SPE[6]+(_M_SPE[28]*_HI[1]))*_M_SPE[29]
_HI[1]=1
IF ((_INTERN[_AXIND*8] OR _INTERN[_AXIND*8+1]) AND ($P_GG[29]>1) AND ($P_GG[29]<4) AND (_HI[11]==0))
_HI[1]=2
ENDIF
N1160 _M9: _ALARM=0
IF _M_ZUST[_H_A] GOTOF _M91
_MESSR=1 _I1=0
GOTOF _M92
_M91:_MESSR=-1 _I1=1
_M92: _HR[0]=(_H_HR+_M_SPE[3])*_MESSR _ALARM=0 _HR[1]=_H_HR*_MESSR*_HI[1]
IF _MA==3 GOTOF _M93
_LAGE=_M_SPE[27+_AXIND]
_M93:_M_SPE[10]=_M_SPE[16]+(_HR[0]+_LAGE)*_HI[1]
N1075 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR*_HI[1]
IF ((_MESSR==-1)AND(_M_SPE[10]>_M_SPE[5+_AXIND]))OR((_MESSR==1)AND(_M_SPE[10]<_M_SPE[5+_AXIND])) GOTOF _M94
_M_SPE[10]=_M_SPE[5+_AXIND]
_M94:_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR*_HI[1]
N1080 _M95:CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_M_ME[0]=_M_ME[8] _M_ME[8]=0
IF _VB[10]==0 GOTOF _M102 IF _M_ZUST[_H_A+1] GOTOF _M101
_M_ME[4]=_M_ME[0]-_M_SPE[16] _M_ZUST[_H_A]=0 _M_ZUST[_H_A+1]=1 _HR[4]=_M_SPE[16] _M_SPE[16]=_M_SPE[15] _M_SPE[15]=_HR[4]
GOTOB _M9
_M101:_OVR[20+_AXIND]=(_M_ME[4]+_M_ME[0]-_M_SPE[16])/2 _VB[10]=0 _M_ZUST[_H_A]=1 _M_ZUST[_H_A+1]=0 _M_SPE[15]=_M_SPE[16] _M_SPE[16]=_HR[4] _M_ME[4]=_M_SPE[21] _ALARM=61303
IF ABS(_M_SPE[27+_AXIND]-_OVR[20+_AXIND])>_M_SPE[32] GOTOF _M109
_ALARM=0
IF ABS(_M_SPE[27+_AXIND]-_OVR[20+_AXIND])<_M_SPE[33] GOTOB _M9
_M_SPE[27+_AXIND]=_OVR[20+_AXIND]
GOTOB _M9
_M102:_ALARM=0
IF _HI[6+_AXIND]==-1
IF _I1==0
_I1=_I1+1
ELSE
_I1=_I1-1
ENDIF
ENDIF
IF _HI[9] GOTOF _M103
IF _MA==3
_H_TR_AP[_I1]=((_M_ME[0]-_M_SPE[16])/_HI[1])*_HI[6+_AXIND]
ELSE
_M_ME[4+_AXIND*2+_I1]=(((_M_ME[0]-_M_SPE[16])/_HI[1])-_M_SPE[27+_AXIND])*_HI[6+_AXIND]
ENDIF
IF (_VB[13]==0) OR (_MPZ) GOTOF _M103
_MPZ=_MPZ+1 _M_ZUST[_H_A]=0 _M_ZUST[_H_A+1]=1 _HR[4]=_M_SPE[16] _M_SPE[16]=_M_SPE[15] _M_SPE[15]=_HR[4]
GOTOB _M9
_M103: _MPZ=0
IF _HI[9]
IF _MD==0
_HI[3]= 1
ELSE
_HI[3]=-1
ENDIF
IF FALSE
_M_SPE[16]=_M_SPE[16]
ELSE
_M_SPE[16]=_M_SPE[16] - _HR[1]*_HI[3]
ENDIF
_KOR_TOOLL[0]=(((_M_ME[0]-_M_SPE[16])/_HI[1])-_M_SPE[27+_AXIND])*_HI[6+_AXIND] _HR[6]=$P_TOOLL[1] _HR[5]=$P_TOOLL[2] _HR[7]=$P_TOOLL[3]
_VB[11]=0 _OVR[23]=_KOR_TOOLL[0]
IF (ABS(_KOR_TOOLL[0])) > _M_SPE[32]
_ALARM=61303
GOTOF _M109
ENDIF
IF (ABS(_KOR_TOOLL[0])) < _M_SPE[33] GOTOF _M103A
_KOR_TOOLL[0]=_KOR_TOOLL[0]*_M_SPE[52]
_OVI[12]=SETTCOR(_KOR_TOOLL,"GW",0,3,_AXIND)
IF _OVI[12] GOTOF _FL13
N1085 D=$P_TOOL DL=$P_DLNO
IF _HR[6] <> $P_TOOLL[1]
_OVR[22]=$P_TOOLL[1]
ELSE
IF _HR[5] <> $P_TOOLL[2]
_OVR[22]=$P_TOOLL[2]
ELSE
IF _HR[7] <> $P_TOOLL[3]
GOTOF _FL2
ELSE
_OVR[22]=_HR[_MA+4]
ENDIF
ENDIF
ENDIF
IF FALSE
_M_ME[4+_AXIND*2+_I1]=0
ELSE
_M_ME[4+_AXIND*2+_I1]=_H_HR*_HI[6+_AXIND]
ENDIF
_M103A:
ENDIF
IF _PROTFORM[3]
_PROTVAL[25]=SET(""<<_M_SPE[12],""<<_M_SPE[11],""<<_M_SPE[13],"")
IF _MA==1
_PROTVAL[26]="$TC_DP4["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_M_SPE[11]<<","<<_OVR[22] _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<",,,"<<_M_N[15]<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ELSE
IF _MA==2
_PROTVAL[25]="$TC_DP3["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_M_SPE[12]<<","<<_OVR[22] _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<",,,"<<_M_N[16]<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ELSE
_PROTVAL[27]="$TC_DP5["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_M_SPE[13]<<","<<_OVR[22] _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<",,,"<<_M_N[17]<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ENDIF
ENDIF
ENDIF
_I1=8
_M104:_OVR[_I1+1]=_M_ME[4+_MPZ]-_M_SPE[21+_MPZ] _OVR[_I1]=_M_ME[4+_MPZ]
IF (ABS(_OVR[_I1+1])<_M_SPE[33])OR(ABS(_OVR[_I1+1])>_M_SPE[32]) GOTOF _M105
_M_SPE[21+_MPZ]=_OVR[_I1]
_M105:IF ABS(_OVR[_I1+1])<_M_SPE[32] GOTOF _M106
_ALARM=61303
_M106:_MPZ=_MPZ+1 _I1=_I1+2
IF _MPZ<4 GOTOB _M104 IF _VB[11]==0 GOTOF _M109
_OVR[4]=_M_ME[4+2*_AXIND]-_M_ME[5+2*_AXIND] _OVR[5]=_OVR[4]-_M_SPE[20]
IF (ABS(_OVR[5])<_M_SPE[33])OR(ABS(_OVR[5])>_M_SPE[32]) GOTOF _M107
_M_SPE[20]=_OVR[4]
IF _INTERN[20+15]
IF _PROTFORM[3]
_PROTVAL[25]=SET("","","","") _PROTVAL[29] ="T,"<<($P_GG[6]+16)<<",,,4,"<<_M_N[10]<<",F"<<_M_SPE[0]
_PROTVAL[28]="$TC_DP6["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_H_HR<<","<<(_OVR[4]/2)
ENDIF
$P_ADT[6]=(_OVR[4]/2)*_HI[10] $P_ADT[15]=0
ENDIF
_M107:IF ABS(_OVR[5])<_M_SPE[32] GOTOF _M109
_ALARM=61303
_M109:_MPZ=0
IF _MA==3
_OVR[17]=_H_TR_AP[0]-_M_SPE[25] _OVR[16]=_H_TR_AP[0]
IF (ABS(_OVR[17])>_M_SPE[33])AND(ABS(_OVR[17])<_M_SPE[32])
_M_SPE[25] =_OVR[16]
ENDIF
_NOWR2:
IF ABS(_OVR[17])>=_M_SPE[32]
_ALARM=61303
ENDIF
_OVR[19]=_H_TR_AP[1]-_M_SPE[26] _OVR[18]=_H_TR_AP[1]
IF (ABS(_OVR[19])>_M_SPE[33])AND(ABS(_OVR[19])<_M_SPE[32])
_M_SPE[26]=_OVR[18]
ENDIF
_NOWR3:
IF ABS(_OVR[19])>=_M_SPE[32]
_ALARM=61303
ENDIF
ENDIF
_OVR[28]=_OVR[28]/_M_SPE[29]
IF _ALARM
IF _ALARM==61303
_OVI[9]=_ALARM+1000
ELSE
_OVI[9]=_ALARM
ENDIF
ENDIF
IF _ALARM<>61303
IF _MA<>3
_H_WP10=(_H_WP10 DIV 100*100)+(_H_WP10 MOD 10 B_OR _MA)
ELSE
_H_WP10=(_H_WP10 DIV 100*100)+(_H_WP10 MOD 10 B_OR 4)
ENDIF
_DIR2 = _M_SPE[54] _DEC9
IF $MN_SCALING_SYSTEM_IS_METRIC==0
IF $P_GG[13]==4
_M_SPE[54] =_H_WP10+100000
ELSE
_M_SPE[54] =_H_WP10+100000
ENDIF
ELSE
IF $P_GG[13]==3
_M_SPE[54] =_H_WP10
ELSE
_M_SPE[54] =_H_WP10
ENDIF
ENDIF
IF (_HI[2] == 3) AND (S_MVAR _DEC4 == 2)
_M_SPE[54] =_M_SPE[54] + 5000000
ENDIF
_DIR = _MD + 1
IF (S_MVAR _DEC4 == 2)
_DIR = 3
ENDIF
_DIR= _DIR2 B_OR _DIR
_M_SPE[54] = _M_SPE[54] + (_DIR * 100000000)
$SNS_MEA_WP_BALL_DIAM[_M_N[1]]=_M_SPE[20] $SNS_MEA_WP_TRIG_MINUS_DIR_AX1[_M_N[1]]=_M_SPE[21] $SNS_MEA_WP_TRIG_PLUS_DIR_AX1[_M_N[1]]=_M_SPE[22] $SNS_MEA_WP_FEED[_M_N[1]]=_M_SPE[0]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX2[_M_N[1]]=_M_SPE[23] $SNS_MEA_WP_TRIG_PLUS_DIR_AX2[_M_N[1]]=_M_SPE[24] $SNS_MEA_WP_TRIG_MINUS_DIR_AX3[_M_N[1]]=_M_SPE[25]
$SNS_MEA_WP_TRIG_PLUS_DIR_AX3[_M_N[1]]=_M_SPE[26] $SNS_MEA_WP_POS_DEV_AX1[_M_N[1]]=_M_SPE[27] $SNS_MEA_WP_POS_DEV_AX2[_M_N[1]]=_M_SPE[28] $SNS_MEA_WP_STATUS_RT[_M_N[1]]=_M_SPE[53] $SNS_MEA_WP_STATUS_GEN[_M_N[1]]=_M_SPE[54]
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M111A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M111
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N1153 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M121A IF _M_N[28]==2 GOTOF _M111
G4 F8
_M121A: CYCLE102(0)
_M111:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
_M111A:
IF _ALARM
STOPRE
N1235 _OVI[9]=_ALARM
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
N697315 SETAL(_ALARM)
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
IF _HI[2]==3
$P_CYCFRAME=CTRANS()
ENDIF
M17
N697301 _ENDE: SETAL(62301)
M0
_GENDE: M17
_FL0:_ALARM=61330 _OVI[9]=_ALARM
STOPRE
N697302 SETAL(_ALARM)
M30
_FL1:_ALARM=61307 _OVI[9]=_ALARM
STOPRE
N697303 SETAL(_ALARM)
M30
_FL2:_ALARM=61325 _OVI[9]=_ALARM
STOPRE
N697304 SETAL(_ALARM)
M30
_FL3:_ALARM=61326 _OVI[9]=_ALARM
STOPRE
N697305 SETAL(_ALARM)
M30
_FL4:_ALARM=61315 _OVI[9]=_ALARM
STOPRE
N697306 SETAL(_ALARM)
M30
_FL5:_ALARM=61313 _OVI[9]=_ALARM
STOPRE
N697307 SETAL(_ALARM)
M30
_FL6:_ALARM=61302 _OVI[9]=_ALARM
STOPRE
N697308 SETAL(_ALARM)
M30
_FL7:_ALARM=61303 _OVI[9]=_ALARM
STOPRE
N697309 SETAL(_ALARM)
M30
_FL8:_OVI[9]=_ALARM
N697314 SETAL(_ALARM)
M17
_FL9:_ALARM=61336 _OVI[9]=_ALARM
STOPRE
N697310 SETAL(_ALARM)
M30
_FL10:_ALARM=61333 _OVI[9]=_ALARM
STOPRE
N697311 SETAL(_ALARM)
M30
_FL11:_ALARM=61342 _OVI[9]=_ALARM
STOPRE
N697312 SETAL(_ALARM)
M30
_FL12:_ALARM=61019 _OVI[9]=_ALARM
STOPRE
N697313 SETAL(_ALARM,_SERR)
M30
_FL13:_ALARM=61404 _OVI[9]=_ALARM
STOPRE
N697314 SETAL(_OVI[9])
M30

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE974_SPF
PROC CYCLE974(INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,INT S_MA,REAL S_FA,REAL S_TSA,REAL S_STA1,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,INT _DP) SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.015 ;DATE: 2024-07-15
;Cycle : workpiece measurement, turn machine
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_ADD,_H_BOOL=0
N1010 DEF REAL _M_SPE[64],_M_ME[16],_P_POS,_TRIGLAG,_LAGE,_LAGE3
N1020 DEF INT _M_N[30],_ALARM,_P_PROB,_P_PL,_P_PT,_MESSR,_AXIND,_H_VAV1[2],_H_SIM,_HI[6]=SET(0,0,0,0,0,1)
N1021 DEF INT _HMD
N1030 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_VAV1,_HMAV
N1040 DEF REAL _HR[6],_DAT[3,6],_KF[3,3],_HSETVAL
N1040 DEF INT _H_DMODE, _H_KNUM,_CHBIT_S[32]
N1042 DEF BOOL _NEW_PAR=0
N1044 DEF STRING[40] _SERR
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE974_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE974_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19") ; aktive Ebene
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...") ; Inch/Metrisch
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...") ; DIAMON/DIAMOF/DIAM90
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/..."); aktive Einstellbare Nullpunktverschiebung
WRITE(_TEMP,_TEMP_FILE,";CYCLE974("<<S_MVAR<<","<<S_KNUM<<","<<S_KNUM1<<","<<S_PRNUM<<","<<S_SETV<<","<<S_MA<<","<<S_FA<<","<<S_TSA<<","<<S_STA1<<","<<S_NMSP<<","<<S_NMSP<<","<<S_TNAME<<","<<S_DLNUM<<","<<S_TZL<<","<<S_TDIF<<","<<S_TUL<<","<<S_TLL<<","<<S_TMV<<","<<S_K<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _NEW_PAR=1 _M_SPE[3]=1 _HI[2]=S_MVAR
_CHBIT_S[4]=_CHBIT[4] _CHBIT_S[6]=_CHBIT[6] _CHBIT_S[8]=_CHBIT[8] _CHBIT_S[21]=_CHBIT[21]
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 2 GOTOF _M_ERR
S_KNUM=ABS(S_KNUM) S_KNUM1=ABS(S_KNUM1)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 3
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM - 2000 + 50
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
GOTOF _HA2
_HA1:_M_N[14]=0
IF ((_H_KNUM _DEC1)== 2)
S_MVAR = S_MVAR - 200
_SERR=<<"(S_KNUM1: dec6)"
IF ((S_KNUM1 _DEC6) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1: dec7)"
IF ((S_KNUM1 _DEC7) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec8)"
IF ((S_KNUM1 _DEC8) > 1) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec9)"
IF ((S_KNUM1 _DEC9) > 1) GOTOF _M_ERR
_SERR=<<"(ST)"
IF (S_KNUM1 _DEC9)AND(_DP <=0) GOTOF _M_ERR
IF (((S_KNUM1 _DEC7) > 0) AND ((S_KNUM1 _DEC7) < 4))
_DLNUM = S_DLNUM
ELSE
_DLNUM = 0
ENDIF
_CHBIT[6]=0 _CHBIT[8]=0
IF (S_KNUM1 _DEC7) == 4
S_KNUM1 = S_KNUM1 - 4000000 _CHBIT[6]=1
ENDIF
_SERR=<<"(S_KNUM1 DNo > MD18105)"
IF (((S_KNUM1 _DEC5)*10000)+((S_KNUM1 _DEC4)*1000)+((S_KNUM1 _DEC3)*100)+((S_KNUM1 _DEC2)*10)+((S_KNUM1 _DEC1))>$MN_MM_MAX_CUTTING_EDGE_NO) GOTOF _M_ERA
IF ($MN_MM_MAX_CUTTING_EDGE_NO >= 1000)
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 - 10000000 _H_KNUM=_H_KNUM+10
ENDIF
IF (S_KNUM1 _DEC6) == 0
ELSE
S_KNUM1=S_KNUM1+((S_KNUM1 _DEC6)*10000000)-((S_KNUM1 _DEC6)*100000)
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC6)*100000)
ENDIF
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 2000000 + 100000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 3000000 + 100000000 _CHBIT[8]=1
ENDIF
IF ((_H_KNUM _DEC2)==1)
S_KNUM1 = S_KNUM1 + 1000000
ENDIF
ELSE
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC4)*1000)
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 1000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 2000000 _CHBIT[8]=1
ENDIF
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 + 10000 - 10000000
ENDIF
IF (S_KNUM1 _DEC9)
S_KNUM1=S_KNUM1 - 100000000
_M_N[14]=_DP
ENDIF
ENDIF
_KNUM = S_KNUM1
ENDIF
_HA2:
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) > 2) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 2) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 1) GOTOF _M_ERR
S_MVAR = S_MVAR - ((S_MVAR _DEC2)*10)
S_MVAR = S_MVAR - ((S_MVAR _DEC4)*1000)
IF ((S_MVAR _DEC1)==1) OR ((S_MVAR _DEC1)==2)
S_MVAR = S_MVAR - ((S_MVAR _DEC1)*1)
IF ((S_MVAR _DEC5)==1)
S_MVAR = S_MVAR - 10000 + 1000
ENDIF
ENDIF
S_MVAR = S_MVAR - ((S_MVAR _DEC5)*10000)
IF (_H_KNUM==0)
_KNUM=0
IF ((S_MVAR _DEC4) == 0)
S_MVAR=S_MVAR + 100
ENDIF
IF ((_AMODE _DEC1) == 1)
_AMODE = _AMODE -1
ENDIF
ENDIF
_MVAR=ABS(S_MVAR) _PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _MA=S_MA _FA=ABS(S_FA) _TSA=ABS(S_TSA) _STA1=S_STA1
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(_AMODE: dec1)"
_AMODE = ABS(_AMODE)
IF ((_AMODE _DEC1) > 1) GOTOF _M_ERR
IF ((_AMODE _DEC1) == 1)
_TZL=ABS(S_TZL) _TDIF=ABS(S_TDIF) _TUL=S_TUL _TLL=S_TLL _M_N[23]=_M_N[23]+100
ELSE
_TZL=0 _TUL=1.01*(ABS(S_TSA)) _TLL=-_TUL _TDIF=_TUL
ENDIF
_CHBIT[4]=0
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 20 GOTOF _M_ERR
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 0
_CHBIT[4]=1
_K = ABS(S_K)
_TMV=ABS(S_TMV)
ELSE
_TMV=ABS((_TUL - _TLL) / 3)
_K=1
ENDIF
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC2)*10) + (S_EVNUM _DEC1)) > 20 GOTOF _M_ERR
IF S_EVNUM<>0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(S_TNAME)"
IF _H_KNUM==2
IF (((_H_KNUM _DEC1)==2) AND (S_TNAME == "")) GOTOF _M_ERR
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B1') OR ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10')
_TNAME =<< S_TNAME _TNUM = 0
ELSE
_TNAME=<<"" _TNUM = NUMBER(S_TNAME)
ENDIF
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
_VB[15]=1 _M_SPE[3]=1 _NEW_PAR=1
ELSE
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N697401 SETAL(_ALARM,_SERR)
RET
_M_ERA: _ALARM=61021 _OVI[9]=_ALARM
STOPRE
N697402 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M120
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] = 301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HI[5]=2
ENDIF
_OVI[2]=974
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
IF _NEW_PAR==1
DIAMON
ELSE
IF $P_GG[29]==3
N1056 DIAMON
ENDIF
ENDIF
_ALARM=61307
IF (_MVAR<>0) AND (_MVAR<>100) AND (_MVAR<>1000) GOTOF _M120
IF (_MVAR == 100) OR (_VB[15] == 1)
_VB[0]=1
ENDIF
N1060 _ALARM=0
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_ALARM=61336
IF (_INTERN[2]==0)OR(_INTERN[10]==0) GOTOF _M120
IF ((_MA==3)AND(_INTERN[18]==0)) GOTOF _M120
_ALARM=61325
IF (_MA<1)OR(_MA>3) GOTOF _M120
_OVR[0]=_M_SPE[16] _P_PROB=_M_N[21]-1
IF _VB[0]==0
IF _M_N[12]==0
IF _MA==1
_M_N[12]=_M_N[15]
ELSE
IF _MA==2
_M_N[12]=_M_N[16]
ELSE
IF _VB[33] AND _INTERN[40+19]
_M_N[12]=_M_N[16]
ELSE
_M_N[12]=_M_N[17]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_M3:IF _MVAR<1000 GOTOF _M5
_VB[3]=1 _M_SPE[8]=_STA1 _ALARM=61372
IF _VB[12]==0 GOTOF _M120
_M5:_ALARM=61330
IF _VB[24] GOTOF _M120
_MAV=_XX _HMAV=_MAV _P_POS=_M_SPE[5] _P_PL=7 _P_PT=1 _VAV=_YY _HI[0]=1 _HSETVAL=_SETVAL/_M_SPE[29]
IF _MA==1 GOTOF _M7
_MAV=_YY _HMAV=_MAV _P_POS=_M_SPE[6] _P_PL=8 _P_PT=3 _AXIND=1 _VAV=_XX _HI[0]=0
IF _MA==2 GOTOF _M7
_MAV=_ZZ _HMAV=_MAV _P_POS=_M_SPE[7] _P_PL=8 _P_PT=5 _AXIND=2 _VAV=_XX _HI[0]=0 _VAV1=_YY _H_VAV1[0]=1
_H_VAV1[1]=_INTERN[_H_VAV1[0]*8+1] _H_VAV1[1]=_H_VAV1[1]+1
IF _VB[33] AND _INTERN[40+19]
_HMAV=_YY
IF _INTERN[8] AND _INTERN[9]
_HSETVAL=_HSETVAL/2 _M_SPE[16]=_M_SPE[16]/2
ENDIF
ENDIF
_M7:_HI[1]=_INTERN[_HI[0]*8+1] _HI[1]=_HI[1]+1 _HI[4]=_M_SPE[54] MOD 100
_HMD=_MD
IF _HSETVAL < _P_POS GOTOF _M72 IF _MAV<>_YY GOTOF _M71
_M_ZUST[2]=1 _MD=0
GOTOF _M8
_M71:_M_ZUST[0]=1 _MD=0
GOTOF _M8
_M72:IF _MAV<>_YY GOTOF _M73
_M_ZUST[3]=1 _MD=1
GOTOF _M8
_M73:_M_ZUST[1]=1 _MD=1
_M8:
IF (_VB[15] == 1)
_M_ZUST[0] = SET(0,0,0,0)
_MD = _HMD
IF (_MAV == _YY)
IF (_MD == 0)
_M_ZUST[2] = 1
ELSE
_M_ZUST[3] = 1
ENDIF
ELSE
IF (_MD == 0)
_M_ZUST[0] = 1
ELSE
_M_ZUST[1] = 1
ENDIF
ENDIF
ENDIF
_ALARM=61326 _HR[2]=$P_ADT[6]/_HI[5] _HR[5]=_M_SPE[27+_HI[0]]
IF _HSETVAL >=0
IF (_HI[2] _DEC1 ==1)AND(_MA==2)AND(_M_ZUST[2]==0) GOTOF _M120 IF (_HI[2] _DEC1 ==1)AND(_MA==3)AND(_M_ZUST[0]==0) GOTOF _M120
IF (_HI[2] _DEC1 ==2)AND(_MA==2)AND(_M_ZUST[3]==0) GOTOF _M120 IF (_HI[2] _DEC1 ==2)AND(_MA==3)AND(_M_ZUST[1]==0) GOTOF _M120
ELSE
IF (_HI[2] _DEC1 ==1)AND(_MA==2)AND(_M_ZUST[3]==0) GOTOF _M120 IF (_HI[2] _DEC1 ==1)AND(_MA==3)AND(_M_ZUST[1]==0) GOTOF _M120
IF (_HI[2] _DEC1 ==2)AND(_MA==2)AND(_M_ZUST[2]==0) GOTOF _M120 IF (_HI[2] _DEC1 ==2)AND(_MA==3)AND(_M_ZUST[0]==0) GOTOF _M120
ENDIF
IF(($SNS_MEA_FUNCTION_MASK B_AND 'B10000')OR(($MCS_TECHNOLOGY==1)AND($MCS_TECHNOLOGY_EXTENSION==2)AND(_VB[33]==1)))AND(_OVI[1]==710)AND(_NEW_PAR)
_ALARM=61341
IF _M_N[24]==8
_M_SPE[21]=SET(-_M_SPE[24],-_M_SPE[23],_M_SPE[21],_M_SPE[22],_M_SPE[25],_M_SPE[26],-_M_SPE[28],_M_SPE[27])
IF(_M_SPE[54] _DEC3)==1
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _M_N[24]==6
_M_SPE[21]=SET(_M_SPE[23],_M_SPE[24],-_M_SPE[22],-_M_SPE[21],_M_SPE[25],_M_SPE[26],_M_SPE[28],-_M_SPE[27])
IF(_M_SPE[54] _DEC3)==1
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _M_N[24]==5
_M_SPE[21]=SET(-_M_SPE[22],-_M_SPE[21],-_M_SPE[24],-_M_SPE[23],_M_SPE[25],_M_SPE[26],-_M_SPE[27],_M_SPE[28])
IF(_M_SPE[54] _DEC3)==1
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==1
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF _MA==1
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0100'<>4)AND(_HI[4] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF _MA==2
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[4] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_HI[3]=_INTERN[20+14] _LAGE3=(_M_SPE[25]-ABS(_M_SPE[26]))/2 _HR[5]=_M_SPE[27+_HI[0]]
IF _INTERN[3] AND(NOT(_INTERN[11]))AND(NOT($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B100000'))AND(_M_N[24]==8)
_LAGE3=-_LAGE3
ENDIF
IF _MA ==1
IF((_M_N[24]==7)OR(_M_N[24]==5))
IF _HI[3]
_HR[3]=_HR[2]
ENDIF
ELSE
_HR[4]=_HR[2] _HR[5]=0 _HI[0]=SET(0,1) _VAV=_XX
ENDIF
ELSE
IF _MA ==2
IF ((_M_N[24]==6)OR(_M_N[24]==8))
IF _HI[3]
_HR[3]=_HR[2]
ENDIF
ELSE
_HR[4]=_HR[2]
ENDIF
ELSE
_HR[4]=_HR[2]
ENDIF
ENDIF
ENDIF
N1061 G0 G90 G94
IF _VB[1] GOTOF _M9
N1062 G1 F=_M_SPE[1]
N1063 _M9: AX[_VAV]=(_M_SPE[5+_HI[0]]+(_HR[5]*_HI[1]))*_M_SPE[29]
IF _MA==3
_LAGE=_LAGE3
IF _HI[3]
IF(_M_N[24]==8)OR(_M_N[24]==6)
N1063 AX[_VAV1]=(_M_SPE[5+_H_VAV1[0]]-(_HR[2]*_H_VAV1[1]))*_M_SPE[29]
ELSE
N1065 AX[_VAV1]=(_M_SPE[5+_H_VAV1[0]]+(_M_SPE[27+_H_VAV1[0]]*_H_VAV1[1]))*_M_SPE[29]
N1067 AX[_VAV]=(_M_SPE[5]-_HR[4])*_M_SPE[29]
ENDIF
ELSE
N1069 AX[_VAV1]=(_M_SPE[5+_H_VAV1[0]]+(_M_SPE[27+_H_VAV1[0]]*_H_VAV1[1]))*_M_SPE[29]
ENDIF
ELSE
IF _NEW_PAR
IF _INTERN[18]
N1071 AX[_ZZ]=(_M_SPE[7]+_LAGE3)*_M_SPE[29]
ENDIF
IF _HI[3] AND _HR[4]
IF((_M_N[24]==7)OR(_M_N[24]==5))
N1073 AX[_VAV]=(_M_SPE[5]-_HR[4])*_M_SPE[29]
ELSE
N1075 AX[_VAV1]=(_M_SPE[6]-_HR[4])*_M_SPE[29]
ENDIF
ENDIF
ENDIF
_LAGE=_M_SPE[20+_P_PL]
ENDIF
_HI[1]=_INTERN[_AXIND*8+1] _HI[1]=_HI[1]+1 _ALARM=0
IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _M91
_MESSR=1
GOTOF _M92
_M91:_MESSR=-1 _P_PT=_P_PT+1
_M92:_HR[1]=(_HR[2]+_M_SPE[3]-_HR[3])*_MESSR _M_SPE[10]=_M_SPE[16]+(_HR[1]+_LAGE)*_HI[1]
N1075 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR*_HI[1]
IF ((_MESSR==-1)AND(_M_SPE[10]>_P_POS))OR((_MESSR==1)AND(_M_SPE[10]<_P_POS)) GOTOF _M94
_M_SPE[10]=_P_POS
_M94: _M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR*_HI[1]
IF (_VB[15] == 1)
_M_SPE[10]=_M_SPE[4+_MA]
IF (_MD == 1)
_M_SPE[9]=_M_SPE[4+_MA]-_M_SPE[3]*_M_SPE[60]
ELSE
_M_SPE[9]=_M_SPE[4+_MA]+_M_SPE[3]*_M_SPE[60]
ENDIF
_M_SPE[16]=_M_SPE[9] _OVR[4]=_M_SPE[9]
ENDIF
N1080 _M95:
CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _ALARM GOTOF _M120
IF _VB[24]==0 GOTOF _M100
_M100:_M_ME[0]=_M_ME[8] _TRIGLAG=_M_SPE[20+_P_PT] _M_ME[8]=0
IF _VB[48]
_TRIGLAG=_M_SPE[20]*_MESSR/2
ENDIF
IF _M_N[18]
_TRIGLAG=_HR[2]*_MESSR
ENDIF
IF _MA==3 GOTOF _M102
_TRIGLAG=_TRIGLAG+_M_SPE[20+_P_PL]
_M102:_M_ME[0]=_M_ME[0]-_TRIGLAG*_HI[1]
IF _MVAR<>1000 GOTOF _M105
IF _M_ME[6] GOTOF _M104
_M_ME[6]=_M_ME[0] _M_SPE[8]=_M_SPE[8]+180
GOTOB _M95
_M104:
_M_ME[0]=(_M_ME[0]+_M_ME[6])/2 _M_SPE[8]=_STA1
_M105:_OVR[4]=_M_ME[0] _M_ZUST[7]=1
IF (_MA == 2) OR (_MA == 3)
_OVR[4] = ABS(_OVR[4])
ENDIF
IF ((_MA==3) AND _VB[33] AND (_INTERN[40+19]))
IF _INTERN[8] AND _INTERN[9]
_OVR[4]=_OVR[4]*2
ENDIF
ENDIF
_M_N[8]=_M_N[22] MOD 10000 _M_N[9]=_M_N[22] DIV 10000 _OVI[7]=_M_N[8] _M_ME[4]=SET(0,0,0)
IF _VB[0] GOTOF _M107
IF _M_N[22]>9999
_OVI[6]=_M_N[9]
ELSE
_OVI[6]=_OVI[7]
ENDIF
_M107:IF _OVI[7]==0 GOTOF _M109
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF _INTERN[40+5]==0 GOTOF _M108
_HR[0]=-_HR[0]
_M108:_OVR[4]=_OVR[4]-_HR[0] _OVR[1+_AXIND]=_OVR[0] _OVR[5+_AXIND]=_OVR[4]
_M109:
_OVR[16]=_OVR[4]-_OVR[0] _OVR[17+_AXIND]=_OVR[16]
IF (_VB[15] == 0) AND (ABS(_OVR[16]) > _M_SPE[32])
_ALARM=61303
ENDIF
IF (_ALARM)OR(_VB[0]) GOTOF _M113 IF ABS(_OVR[16])<_M_SPE[34] GOTOF _M113
_ALARM=61306
_M113:IF (_ALARM<>61303)AND(_ALARM<>61306) GOTOF _M115
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==0 GOTOF _M114A
N697403 SETAL(_ALARM+1000)
N1110 M0
STOPRE
_M114A:_M_ZUST[7]=0 _ALARM=0
ENDIF
_M115:IF _M_ZUST[7]==0 GOTOB _M95
IF (_MA==3) AND (_VB[33]) AND (_INTERN[40+19])
_HI[1]=_H_VAV1[1] _AXIND=_H_VAV1[0]
ENDIF
_OVR[28]=_OVR[28]/_M_SPE[29]
IF (_ALARM AND _VB[0]) GOTOF _M120
IF (_VB[0] == 0)
_OVR[20]=_OVR[16] _OVI[4]=_M_N[23] MOD 100 _OVR[8]=_M_SPE[15] _OVR[12]=-_M_SPE[15] _OVI[0]=_M_N[11]
_OVR[29]=_M_SPE[34] _OVR[27]=_M_SPE[33]
IF _ALARM GOTOF _M120
IF ABS(_OVR[20])>_M_SPE[15]
IF ((_MESSR==-1)AND(_OVR[4]<_OVR[0]))OR ((_MESSR==1)AND(_OVR[4]>_OVR[0]))
_ALARM=61304
ELSE
_ALARM=61305
ENDIF
ENDIF
CYCLE114(2,_ALARM,_HMAV,0,_M_SPE[37],_M_N[23],_INTERN[40+4],_H_BOOL)
IF _H_BOOL==0
IF ABS(_OVR[20]) <= _M_SPE[33]
CYCLE114(4,_ALARM,_HMAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
GOTOF _M118
ENDIF
ENDIF
_OVR[20]=-_OVR[20]/_HI[1]
IF ((_INTERN[20+2]==0) OR ((_INTERN[20+2]==1) AND (_ALARM<>61304) AND (_ALARM<>61305)))
CYCLE114(3,_ALARM,_HMAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
GOTOF _M120
_M118:
IF (_OVI[6] <> 0)
IF _INTERN[40+4]==1
_MV[_OVI[6]-1]=_OVR[20] _OVR[31]=_OVR[20] $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=_OVR[20]
ELSE
_MV[_OVI[6]-1]=0 _OVR[31]=0 $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=0
ENDIF
ENDIF
_OVR[20]=0
GOTOF _M120
ENDIF
_OVR[17+_AXIND]=_OVR[16]/_HI[1] _OVR[1+_AXIND]=_OVR[0] _OVR[5+_AXIND]=_OVR[4]
IF _KNUM==0 GOTOF _M120
_OVI[0]=_KNUM
IF (_INTERN[40+21]==0)
_ADD=1
ELSE
_ADD=0
ENDIF
IF (_MA==3)AND(_VB[33])AND(_INTERN[40+19])
_MA=2
ENDIF
CYCLE115(_ALARM,_HMAV,_ADD,_NEW_PAR)
_M120:_OVI[9]=_ALARM
IF ((_ALARM>=61303)AND(_ALARM<=61306))OR(_ALARM==0) GOTOF _M121
STOPRE
N697404 SETAL(_ALARM)
_M120A: M0
STOPRE
N697405 SETAL(61327)
GOTOB _M120A
_M121: _PROTVAL[29] = _PROTVAL[29] <<"F"<<_M_SPE[0]
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M122A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M122
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N697406 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M121A IF _M_N[28]==2 GOTOF _M122
G4 F8
N1160 _M121A: CYCLE102(0)
N1200 _M122:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
N1201 _M122A:
IF _ALARM
STOPRE
_OVI[9]=_ALARM
IF (_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF (_ALARM>61303)
IF _INTERN[20+2]
N697407 SETAL(_ALARM+1000)
N1240 M0
STOPRE
IF ((_ALARM==61304) OR (_ALARM==61305))
CYCLE114(3,_ALARM,_HMAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697409 SETAL(_ALARM)
ENDIF
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697410 SETAL(_ALARM)
ENDIF
ENDIF
ENDIF
IF (_INTERN[2]) AND (_MA<>1)
N1240 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF (_INTERN[10]) AND (_MA<>2)
N1245 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
IF (_INTERN[18]) AND (_MA<>3)
N1245 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
ENDIF
IF _NEW_PAR
_CHBIT[4]=_CHBIT_S[4] _CHBIT[6]=_CHBIT_S[6] _CHBIT[8]=_CHBIT_S[8] _CHBIT[21]=_CHBIT_S[21]
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
M17
N697411 _ENDE: SETAL(62301)
M0
_GENDE: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE976_SPF
PROC CYCLE976(INT S_MVAR,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,INT S_MA,INT S_MD,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,INT S_NMSP,INT S_SETV1,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.007 ;DATE: 2024-04-24
;Cycle : calibrate workpiece probe
;+ Aufruf aus JOG
N1001 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_ADD,_NEW_PAR
N1003 DEF REAL _M_SPE[80],_M_ME[40],_P_POS,_KOR_TOOLL[3],_H_OVR[19],_TEMP,_TEMP1,_LAGE,_RMT,_LMT,_DH
N1005 DEF INT _M_N[40],_ALARM,_MESSR,_AXIND,_HI_MIGEO[6],_H_MSNUM,_P_PROB,_H_SIM
N1007 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_VAV1, _ACHS[2]
N1009 DEF INT _HI[18]=SET(0,0,0,0,0,1,1,0,0,1,0,0,0)
N1011 DEF REAL _H_CD_IN[4,2],_CAL[13],_DAT[3,6],_KF[3,3],_HD,_HDO,_IW_C[2],_IM_C[3]
N1013 DEF REAL _HR[15],_Winkel,_MEX,_KUGDM,_KUGR_X,_CD_IN[12,2],_CD_OUT[3]
N1015 DEF REAL _Z_PPOS,_Z_TPOS,_X_MPOS,_Y_MPOS,_Z_ZENIT,_X_MP,_Y_MP,_Z_MP
N1017 DEF REAL _SETPOINT[3,3],_MEASPOINT[3,3],_MC_MTL[3]=SET(33.3,33.3,33.4)
N1019 DEF INT _KUGWDH=0,_SIMULTAN=0, _M_N_TMP, _STRAIGHT_D
N1021 DEF FRAME _TMP_SAVEFRAME
N1040 DEF INT _H_DMODE
N1042 DEF STRING[18] _SERR
N1052 DEF INT _TEMP2
N1053 DEF BOOL _TEMP_ON, _LOG_ON
N1054 DEF STRING[38] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE976_MPF"
N1055 DEF STRING[40] _LOG_FILE
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE976_MPF")
IF _TEMP_ON
DELETE(_TEMP2,_TEMP_FILE)
WRITE(_TEMP2,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP2,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP2,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP2,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP2,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP2,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP2,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP2,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP2,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP2,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP2,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP2,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP2,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP2,_TEMP_FILE,";CYCLE976("<<S_MVAR<<","<<S_PRNUM<<","<<S_SETV<<","<<S_SETV0<<","<<S_MA<<","<<S_MD<<","<<S_FA<<","<<S_TSA<<","<<S_VMS<<","<<S_STA1<<","<<S_NMSP<<","<<S_SETV1<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP2,_TEMP_FILE,";M30")
ENDIF
_LOG_FILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE976_"<<$P_CHANNO<<"_MPF"
_LOG_ON=(ISFILE(_LOG_FILE))AND($P_PROG[$P_STACK-1]<>"_N_LOG_CYCLE976_"<<$P_CHANNO<<"_MPF")
IF (_LOG_ON)
DELETE(_TEMP2,_LOG_FILE)
WRITE(_TEMP2,_LOG_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_TEMP2,_LOG_FILE,"; ")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) > 5) GOTOF _FL13
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4) > 2) GOTOF _FL13
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 1) GOTOF _FL13
_SERR=<<"(S_MVAR: dec6)"
IF ((S_MVAR _DEC6) > 1) GOTOF _FL13
_SERR=<<"(S_MVAR: dec7)"
IF ((S_MVAR _DEC7) > 2) GOTOF _FL13
IF (S_MVAR _DEC1 > 0)AND(S_MVAR _DEC1 < 4)
_SETVAL=ABS(S_SETV)
ELSE
_SETVAL=S_SETV
ENDIF
S_MVAR = S_MVAR - ((S_MVAR _DEC3)*100)
IF ((S_MVAR _DEC1) <> 0)
S_MVAR = S_MVAR + 100
IF ((S_MVAR _DEC5) == 0)
S_MVAR = S_MVAR + 10000
ELSE
S_MVAR = S_MVAR - 10000
ENDIF
IF ((S_MVAR _DEC1) == 2) OR ((S_MVAR _DEC1) == 3)
S_MVAR = S_MVAR - ((S_MVAR _DEC4)*1000)
ENDIF
IF ((S_MVAR _DEC1) == 2)
S_MVAR = S_MVAR + 6
ENDIF
IF ((S_MVAR _DEC1) == 4)
IF (S_MVAR _DEC4) == 2
S_MVAR = S_MVAR - 3
ELSE
IF (S_MVAR _DEC4) < 2
S_MVAR = 0
ENDIF
ENDIF
ENDIF
IF ((S_MVAR _DEC1)==5)AND((S_MVAR _DEC4)<>2)
S_MVAR=((S_MVAR DIV 10000)*10000)+((S_MVAR MOD 1000)+2000)
ENDIF
ENDIF
_MVAR=ABS(S_MVAR)
IF S_VMS <> 0
_VMS = ABS(S_VMS)
ELSE
_VMS=$SCS_MEA_FEED_MEASURE
ENDIF
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_PRNUM=ABS(S_PRNUM) _SETV[0]=S_SETV0 _MA=ABS(S_MA) _MD=ABS(S_MD) _FA=ABS(S_FA) _TSA=ABS(S_TSA) _STA1=S_STA1 _HR[13]=$P_F
_RF=$SCS_MEA_FEED_CIRCLE
_SERR=<<"(_DMODE: dec2)" _H_DMODE=ABS(_DMODE _DEC1) _TZL=0 _NEW_PAR=1 _M_SPE[3]=1
IF(_H_DMODE>4) GOTOF _FL13
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
_M_SPE[3]=1
IF(_MVAR _DEC1 ==3)OR(_MVAR==1000)
_NEW_PAR=1
ENDIF
S_SETV1 = _SETV[0]
ELSE
IF _VMS == 0
_VMS=$SCS_MEA_FEED_MEASURE
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
_M_END:
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
ENDIF
ENDIF
ENDIF
IF ($AN_NCK_VERSION<660000) GOTOF _FL11
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] = 301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HI[17]=2
ELSE
_HI[17]=1
ENDIF
_OVI[2]=976 _HR[11]=_STA1
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1009 DIAMCYCOF G0 G90 G94 G60
_HR[6]=$P_ADT[6]/_HI[17]
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000') GOTOF _FL10
IF (_SMI_R[10]==0)OR(_SMI_R[10]==93101.901)
$P_CYCFRAME=CTRANS()
ELSE
_TMP_SAVEFRAME=$P_CYCFRAME
ENDIF
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_IW_C[0]=SET(_M_SPE[5],_M_SPE[6]) _IM_C[0]=SET(_M_SPE[17],_M_SPE[18],_M_SPE[19]) _HI[10]=_MA
IF _VB[1] ==0
N1010 G1 F=_M_SPE[1]
ENDIF
IF _intern[3] AND ($SC_MIRROR_TOOL_LENGTH==0)
_HI_MIGEO[0]=1 _HI_MIGEO[3]=-1
IF _INTERN[20+7] AND ($P_GG[6]==2)
_HI_MIGEO[1]=1 _HI_MIGEO[4]=-1
ENDIF
ELSE
_HI_MIGEO[0]=0 _HI_MIGEO[3]=1
ENDIF
IF _intern[11] AND ($SC_MIRROR_TOOL_LENGTH==0)
_HI_MIGEO[1]=1 _HI_MIGEO[4]=-1
ELSE
_HI_MIGEO[1]=0 _HI_MIGEO[4]=1
ENDIF
IF _intern[19] AND ($SC_MIRROR_TOOL_LENGTH==0)
_HI_MIGEO[2]=1 _HI_MIGEO[5]=-1
IF (_INTERN[20+7])AND(($P_GG[6]==1)OR($P_GG[6]==3))AND(_intern[11]==0)
_HI_MIGEO[1]=1 _HI_MIGEO[4]=-1
ENDIF
ELSE
_HI_MIGEO[2]=0 _HI_MIGEO[5]=1
ENDIF
_ALARM=61309
IF (_OVI[1]==713)AND(_MVAR==11101)AND(_MA==1)
_MVAR=1001000
ENDIF
IF (_OVI[1]==713)AND(_MVAR _DEC1<>0) GOTOF _FL14 IF (_OVI[1]==714)AND((_MVAR _DEC1<>0)AND(_MVAR _DEC1<>1)AND(_MVAR _DEC1<>8)) GOTOF _FL14
_ALARM=0
IF _MVAR _DEC2 <> 0 GOTOF _FL1
CASE (_MVAR _DEC1) OF 0 GOTOF _M03 1 GOTOF _M02 8 GOTOF _M01 3 GOTOF _M00 5 GOTOF _M03 DEFAULT GOTOF _FL1
_M00:_VB[22]=1
IF (_VB[22]==1)AND(_NEW_PAR==0) GOTOF _FL1
_M01:_M_ZUST[11]=1
IF _VB[22]==1 GOTOF _M03
_M02:_VB[23]=1
_M03:CASE(_MVAR _DEC3) OF 1 GOTOF _M04 0 GOTOF _M05 DEFAULT GOTOF _FL1
_M04:_VB[11]=1
_M05:
CASE (_MVAR _DEC4) OF 0 GOTOF _M06 1 GOTOF _M08 2 GOTOF _M071 DEFAULT GOTOF _FL1
_M06: _VB[14]=1
IF (_VB[22]==0)AND((_M_ZUST[11]==1)OR(_VB[23]==1))AND(_VB[14]==1)
IF (_HR[6]*2+(0.05*_M_SPE[16]))>= _M_SPE[16]
_ALARM=61006
GOTOF _FL16
ENDIF
ENDIF
_M071: _VB[13]=1
_M08:
CASE (_MVAR _DEC5) OF 0 GOTOF _M101 1 GOTOF _M09 DEFAULT GOTOF _FL1
_M09: _VB[10]=1
_M101:
CASE (_MVAR _DEC6) OF 0 GOTOF _M12 1 GOTOF _M11 DEFAULT GOTOF _FL1
_M11:_M_ZUST[10]=1
_M12: CASE (_MVAR _DEC7) OF 0 GOTOF _M15 1 GOTOF _M13 2 GOTOF _M14 DEFAULT GOTOF _FL1
_M13: _VB[40]=1
GOTOF _M15
_M14: _VB[17]=1
_M15:
IF _M_ZUST[10]==1
IF _VB[22]==0
_HR[8]=_M_SPE[53] MOD 1000 _TEMP1=(_M_SPE[4] MOD 1000)+_HR[11]
ELSE
_HR[8]=_M_SPE[53] MOD 1000 _TEMP1=_M_SPE[4] MOD 1000
ENDIF
ELSE
_HR[8]=_M_SPE[53] MOD 1000 _TEMP1=(_M_SPE[4] MOD 1000)
ENDIF
_TEMP1=((_TEMP1 MOD 360) + 360) MOD 360 _M_SPE[4]=((TRUNC(_M_SPE[4]/1000))*1000) + ROUND(_TEMP1)
IF _HR[8] <> _TEMP1
_TEMP=1
ENDIF
IF _VB[10]==1 GOTOF _MY2A
IF ((_VB[23]==1)AND(_VB[14]==1))OR(_VB[22]==1)
_M_SPE[27]=SET(0,0)
ELSE
IF (_VB[23]==1)AND(_MVAR _DEC4 <>0)
IF _MA==1
_M_SPE[27]=0
ELSE
IF _MA==2
_M_SPE[28]=0
ENDIF
ENDIF
ENDIF
ENDIF
IF (_MVAR==0)AND(_MA==3) GOTOF _MY2A
IF ((_MVAR==0)OR(_MVAR==1100))AND(_MA==1)
IF _MD == 0
_M_SPE[21]=_M_SPE[27] + _M_SPE[21]
ELSE
_M_SPE[22]=_M_SPE[27] + _M_SPE[22]
ENDIF
_M_SPE[27]=0
ENDIF
IF ((_MVAR==0)OR(_MVAR==1100))AND(_MA==2)
IF _MD == 0
_M_SPE[23]=_M_SPE[28] + _M_SPE[23]
ELSE
_M_SPE[24]=_M_SPE[28] + _M_SPE[24]
ENDIF
_M_SPE[28]=0
ENDIF
_MY2A: _HR[12]=_M_SPE[54] MOD 10000000000 _HI[12]=_M_SPE[54] _DEC6 _M_SPE[54]=0 _TEMP1=1
IF _HI[12]==1
_TEMP1=0.03937 _HI[12]=0
ENDIF
IF _M_N[18]==1 GOTOF _MY2B
IF _VB[51]
IF(_HR[12] _DEC3 <>$P_GG[6])OR($SNS_MEA_WP_FEED[_M_N[1]] <(_M_SPE[0]-(_TEMP1/_M_SPE[52])))OR($SNS_MEA_WP_FEED[_M_N[1]] >(_M_SPE[0]+(_TEMP1/_M_SPE[52])))OR(_HR[12] _DEC8 <>3)OR(_TEMP)
_M_SPE[20]=SET(_HR[6]*2,0,0,0,0,0,0,0,0) _M_SPE[53]=0 _HR[12]=11000+$P_GG[6]*100 _M_SPE[54]=_HR[12] _HI[12]=3
ENDIF
ELSE
IF (_HR[12] _DEC3 <>$P_GG[6])OR(_HR[12] _DEC4 <>_INTERN[20+14])OR(_HR[12] _DEC5 <>_VB[2])OR($SNS_MEA_WP_FEED[_M_N[1]] <(_M_SPE[0]-(_TEMP1/_M_SPE[52])))OR($SNS_MEA_WP_FEED[_M_N[1]] > (_M_SPE[0]+(_TEMP1/_M_SPE[52])))OR(_HR[12] _DEC8 ==3)OR(_HR[12] _DEC8 <> _OVI[1] _DEC1)OR(_TEMP)
IF _INTERN[20+14]
_M_SPE[20]=SET(_HR[6]*2,0,0,0,0,0,0,0,0) _M_SPE[53]=0 _HR[12]=($P_GG[6]*100)+1000
IF _VB[2]
_HR[12]=_HR[12]+10000
ENDIF
ELSE
_M_SPE[20]=SET(_HR[6]*2,0,0,0,0,0,0,0,0) _M_SPE[53]=0 _HR[12]=$P_GG[6]*100
IF _VB[2]
_HR[12]=_HR[12]+10000
ENDIF
ENDIF
_HI[12]=3
ENDIF
ENDIF
IF _HI[12]==3
IF (($SNS_MEA_ALARM_MASK B_AND 'B1000') AND (_SMI_R[10] == 93101.901) AND (_HI[12] <> 0))
_SERR=<<(_M_N[1]+1)
SETAL(62378, _SERR)
M0
STOPRE
ENDIF
REPEAT _LOG_DEL_A _LOG_DEL_E
$SNS_MEA_WP_BALL_DIAM[_M_N[1]]=_M_SPE[20] $SNS_MEA_WP_TRIG_MINUS_DIR_AX1[_M_N[1]]=0 $SNS_MEA_WP_TRIG_PLUS_DIR_AX1[_M_N[1]]=0 $SNS_MEA_WP_FEED[_M_N[1]]=_M_SPE[0]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX2[_M_N[1]]=0 $SNS_MEA_WP_TRIG_PLUS_DIR_AX2[_M_N[1]]=0 $SNS_MEA_WP_TRIG_MINUS_DIR_AX3[_M_N[1]]=0
$SNS_MEA_WP_TRIG_PLUS_DIR_AX3[_M_N[1]]=0 $SNS_MEA_WP_POS_DEV_AX1[_M_N[1]]=0 $SNS_MEA_WP_POS_DEV_AX2[_M_N[1]]=0 $SNS_MEA_WP_STATUS_RT[_M_N[1]]=0 $SNS_MEA_WP_STATUS_GEN[_M_N[1]]=0
ENDIF
_MY2B: IF (_MVAR MOD 10 ==0) GOTOF _MV3 IF _VB[22] GOTOF _KK
_OVR[6]=SET(_M_SPE[5],_M_SPE[6])
IF _VB[23] AND _M_ZUST[11]==0
IF _VB[14]
IF (_INTERN[2]==0)OR(_INTERN[10]==0) GOTOF _FL9
ELSE
IF (_HI[10]<1)OR(_HI[10]>2)
_ALARM=61325
ELSE
IF (_INTERN[2+8*(_HI[10]-1)]==0)
_ALARM=61336
ENDIF
ENDIF
ENDIF
ELSE
IF _VB[23] AND _M_ZUST[11]==1
IF (_INTERN[2]==0)OR(_INTERN[10]==0) GOTOF _FL9
ENDIF
ENDIF
IF _ALARM GOTOF _FL8
IF _VB[13] AND _VB[14]
IF _INTERN[2]==0
_VB[13]=1 _VB[14]=0 _HI[10]=2
ENDIF
IF _INTERN[10]==0
_VB[13]=1 _VB[14]=0 _HI[10]=1
ENDIF
ENDIF
IF _VB[14] AND _VB[13] GOTOF _M07 IF _HI[10]==3 GOTOF _FL2
_M07:IF(_MVAR _DEC1 == 5)AND _NEW_PAR GOTOF _KZ2K IF _M_ZUST[11]==0 GOTOF _M07A
_VB[3]=1 _M_SPE[16]=_SETVAL/2/_M_SPE[29] _M_SPE[8]=_M_SPE[8]-179.9
IF _M_ZUST[10]
IF _INTERN[18]
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,(_M_SPE[5]),_YY,(_M_SPE[6])):CROT(_ZZ,_HR[11])
ELSE
ATRANS AX[_XX]=_M_SPE[5] AX[_YY]=_M_SPE[6]
AROT RPL=_HR[11]
ENDIF
_OVR[6]=SET(_M_SPE[5],_M_SPE[6]) _M_SPE[5]=SET(0,0) _M_ME[10]=_HR[11] _OVR[24]=_HR[11]
N1230 G90 AX[_XX]=0
N1231 AX[_YY]=0
ENDIF
IF _INTERN[2]
_AXIND=0 _MAV=_XX _HI[7]=0 _HI[8]=0
ELSE
_AXIND=1 _MAV=_YY _HI[7]=2 _HI[8]=2
ENDIF
_MBP:_M_ZUST[_HI[7]]=1 _M_SPE[9]=_M_SPE[5+_AXIND]+(_M_SPE[16]-_HR[6]+_M_SPE[3])*_HI[9]
IF _M_SPE[60]==1
_M_SPE[9]=_M_SPE[5+_AXIND]+(_M_SPE[16]-_HR[6])*_HI[9]
ENDIF
_M_SPE[10]=_M_SPE[9]-_M_SPE[60]*_M_SPE[3]*_HI[9] _M_ME[8]=SET(0,0)
IF _M_N[18] AND(_M_SPE[16]<(_HR[6]+_M_SPE[3]))
_M_SPE[9]=_M_SPE[5+_AXIND]+(_HR[6]+_M_SPE[3])*_HI[9] _M_SPE[10]=_M_SPE[9]-_M_SPE[60]*_M_SPE[3]*_HI[9] _M_ME[11]=_HR[6]*_HI[9] _M_SPE[16]=_HR[6]+_M_SPE[3]
ELSE
_M_ME[11]=_M_SPE[10]+_M_SPE[3]*_HI[9]
ENDIF
IF((_HI[9]==1) AND (_M_SPE[10]<_M_SPE[5+_AXIND]))OR((_HI[9]==-1)AND(_M_SPE[10]>_M_SPE[5+_AXIND]))
_M_SPE[10]=_M_SPE[5+_AXIND]
ENDIF
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
IF(_M_N[30] == 1)
_M_N[0] = 2
ENDIF
ENDIF
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
IF(_M_N[30] == 1)
_M_N[0] = 1
ENDIF
ENDIF
ENDIF
N1110 CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _HI[14]==0
IF _VB[2]==0
_M_SPE[53]=ROUND($AA_IM[SPI($AC_MSNUM)] + 179.9)
ELSE
_M_SPE[53]=ROUND($AA_IM[SPI($AC_MSNUM)])
ENDIF
_M_SPE[53]=((_M_SPE[53] MOD 360)+360) MOD 360
_M_SPE[53]=(_M_SPE[4] MOD 1000000000)+(_M_SPE[53]*1000000000)+((_M_SPE[4] DIV 1000000000000)*1000000000000)
_HI[14]=_HI[14]+1
ENDIF
_HI[8]=_HI[8]+1 _M_ZUST[_HI[7]]=0 _HI[7]=_HI[7]+1 _HI[9]=-(_HI[9])
CASE _HI[8] OF 1 GOTOF _MBP1 2 GOTOF _MBP2 3 GOTOF _MBP1 4 GOTOF _MBP4 5 GOTOF _MBP1 6 GOTOF _MBP2 7 GOTOF _MBP1 8 GOTOF _MBP8
_MBP1:_CAL[_HI[7]-1]=_M_ME[8]
N1100 AX[_MAV]=_M_SPE[5+_AXIND]*_M_SPE[29]
GOTOB _MBP
_MBP2:_CAL[_HI[7]-1]=_M_ME[8] _HD=(_CAL[0]+_CAL[1])/2-_M_SPE[5] _M_SPE[5]=_M_SPE[5]+_HD _AXIND=1 _MAV=_YY _M_SPE[17]=_M_SPE[17]+_HD*_DAT[0,1]
_M_SPE[18]=_M_SPE[18]+_HD*_DAT[0,2] _M_SPE[19]=_M_SPE[19]+_HD*_DAT[0,3]
N1110 AX[_XX]=_M_SPE[5]*_M_SPE[29]
IF _INTERN[10] GOTOB _MBP IF _HI[8]==6 GOTOF _MBP8A
IF _HI[8]==2
_HI[7]=0 _M_SPE[8]=_M_SPE[8]+179.9 _HI[8]=4 _CAL[4]=SET(_M_SPE[5],_M_SPE[6])
ENDIF
GOTOB _MBP
_MBP4:_CAL[_HI[7]-1]=_M_ME[8] _HD=(_CAL[2]+_CAL[3])/2-_M_SPE[6] _M_SPE[6]=_M_SPE[6]+_HD _M_SPE[17]=_M_SPE[17]+_HD*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_HD*_DAT[1,2]
_M_SPE[19]=_M_SPE[19]+_HD*_DAT[1,3]
N1120 AX[_MAV]=_M_SPE[6]*_M_SPE[29]
_AXIND=0 _MAV=_XX _CAL[4]=SET(_M_SPE[5],_M_SPE[6]) _HI[7]=0 _M_SPE[8]=_M_SPE[8]+179.9
IF _INTERN[2] GOTOB _MBP
_AXIND=1 _MAV=_YY _HI[8]=6 _HI[7]=2
GOTOB _MBP
_MBP8:_CAL[_HI[7]-1]=_M_ME[8]
IF _INTERN[10]
_HD=(_CAL[2]+_CAL[3])/2-_M_SPE[6] _M_SPE[6]=_M_SPE[6]+_HD _M_SPE[17]=_M_SPE[17]+_HD*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_HD*_DAT[1,2] _M_SPE[19]=_M_SPE[19]+_HD*_DAT[1,3]
N1130 AX[_MAV]=_M_SPE[6]*_M_SPE[29]
ENDIF
_MBP8A:_AXIND=0 _MAV=_XX _M_ME[8]=SET(0,0) _HI[5]=2 _M_ZUST[0]=1
IF _VB[2]==0
IF _XX<>_YY
_HD=(_M_SPE[5]+_CAL[4])/2-_M_SPE[5] _M_SPE[5]=_M_SPE[5]+_HD _HDO=(_M_SPE[6]+_CAL[5])/2-_M_SPE[6] _M_SPE[6]=_M_SPE[6]+_HDO _OVR[20]=SET(_M_SPE[5]-_CAL[4],_M_SPE[6]-_CAL[5])
ELSE
IF _INTERN[2]
_HD=(_M_SPE[5]+_CAL[4])/2-_M_SPE[5] _M_SPE[5]=_M_SPE[5]+_HD _OVR[20]=SET(_M_SPE[5]-_CAL[4],_M_SPE[28])
ELSE
_HDO=(_M_SPE[6]+_CAL[5])/2-_M_SPE[6] _M_SPE[6]=_M_SPE[6]+_HDO _OVR[20]=SET(_M_SPE[27],_M_SPE[6]-_CAL[5])
ENDIF
ENDIF
_M_SPE[17]=_M_SPE[17]+_HD*_DAT[0,1]+_HDO*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_HD*_DAT[0,2]+_HDO*_DAT[1,2] _M_SPE[19]=_M_SPE[19]+_HD*_DAT[0,3]+_HDO*_DAT[1,3]
IF _VB[10]
IF ((_M_SPE[60]==1) AND ($SCS_MEA_SIM_ENABLE<>9)) GOTOF _NOWR
_M_SPE[27]=SET(_OVR[20]*_HI_MIGEO[3],_OVR[21]*_HI_MIGEO[4])
_NOWR: _M_SPE[27]=SET(_OVR[20],_OVR[21]) _VB[10]=0
ENDIF
IF _INTERN[40+13]==0
_VB[3]=0
ENDIF
ELSE
_OVR[20]=SET(0,0) _M_SPE[27]=SET(0,0) _VB[10]=0
ENDIF
IF _INTERN[2]
N1001 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF _INTERN[10]
N1002 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
_IW_C[0]=SET(_M_SPE[5],_M_SPE[6]) _IM_C[0]=SET(_M_SPE[17],_M_SPE[18],_M_SPE[19])
IF _M_ZUST[10]
_M_ME[0]=_OVR[6] _OVR[6]=(_M_ME[0]+_M_SPE[5]*COS(_M_ME[10])-_M_SPE[6]*SIN(_M_ME[10])) _M_ME[1]=_OVR[7] _OVR[7]=(_M_ME[1]+_M_SPE[5]*SIN(_M_ME[10])+_M_SPE[6]*COS(_M_ME[10]))
ELSE
IF _XX<>_YY
_OVR[6]=SET(_M_SPE[5],_M_SPE[6])
ELSE
IF _INTERN[2]
_OVR[6]=SET(_M_SPE[5],0)
ELSE
_OVR[6]=SET(0,_M_SPE[6])
ENDIF
ENDIF
ENDIF
IF _XX<>_YY
_CAL[4]=SQRT(POT(_M_SPE[16]-_HR[6])-POT(_OVR[21]*2))+_HR[6]
ELSE
_CAL[4]=_M_SPE[16]
ENDIF
IF _INTERN[2]
_M_ME[5]=(_CAL[0]-(_M_SPE[5]+_CAL[4])-_M_SPE[27]) _M_ME[4]=(_CAL[1]-(_M_SPE[5]-_CAL[4])-_M_SPE[27])
ENDIF
IF _INTERN[10]
_M_ME[7]=(_CAL[2]-(_M_SPE[6]+_M_SPE[16])-_M_SPE[28]) _M_ME[6]=(_CAL[3]-(_M_SPE[6]-_M_SPE[16])-_M_SPE[28])
ENDIF
_HI[11]=_HR[12] MOD 100000 _HI[11]=((_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR 1 B_OR 2))+8000000
IF _INTERN[2] GOTOF _Y85
_AXIND=1
GOTOF _Y85
_MV3: _VB[21]=1 _VB[13]=0 _VB[14]=0
IF(_HI[10]<1)OR(_HI[10]>3) GOTOF _FL2 IF(_MD<0)OR(_MD>1) GOTOF _FL3
IF _INTERN[2+8*(_HI[10]-1)]==0 GOTOF _FL9 IF(_MVAR==0)OR((_MVAR==1000)AND(_NEW_PAR))OR((_MVAR==1100)AND(_NEW_PAR))GOTOF _MY4
IF _MD
_HI[6]=-1 _M_ZUST[0]=0 _M_ZUST[1]=1
ELSE
_HI[6]=1 _M_ZUST[0]=1 _M_ZUST[1]=0
ENDIF
IF _VB[51]==0
IF (_MVAR<>10000)AND(_MVAR<>1000000)AND(_MVAR<>1001000) GOTOF _FL1
_ALARM=61309
IF _OVI[1]==714 GOTOF _FL14 IF((_OVI[1]==710)OR(_OVI[1]==712))AND(_HI[10]<>3) GOTOF _FL2
_AXIND=2 _HI[1]=0 _VB[11]=0
IF (_MVAR==10000)AND _SMI_R[10]
_ALARM=61447
ELSE
_ALARM=61326
ENDIF
IF (_M_SPE[16] < _M_SPE[7])AND NOT(_MD) GOTOF _FL8 IF (_M_SPE[16] > _M_SPE[7])AND _MD GOTOF _FL8
IF (NOT($P_ADT[3]))OR(NOT(_NEW_PAR))
_M_SPE[10]=_M_SPE[7]
ELSE
_M_SPE[10]=_M_SPE[16]-(ABS(_M_SPE[3])*_HI[6])
IF _M_SPE[10] >= _M_SPE[7]
_M_SPE[10]=_M_SPE[7]
ENDIF
ENDIF
_M_SPE[9]=_M_SPE[10]+((ABS(_M_SPE[3]*_M_SPE[60]))*_HI[6]) _MAV=_ZZ _ALARM=0
ELSE
IF _MVAR<>1001000 GOTOF _FL1
_AXIND=_HI[10]-1 _M_SPE[10]=_M_SPE[5 + _AXIND] _M_SPE[9]=_M_SPE[10]+ABS(_M_SPE[3]*_M_SPE[60])*_HI[6]
_MAV=_XX _M_ZUST[0]=SET(1,0,0,0)
IF (_AXIND==0)AND(_HI[6]==1) GOTOF _MV4
_M_ZUST[0]=SET(0,1,0,0)
IF (_AXIND==0)AND(_HI[6]==-1) GOTOF _MV4
_MAV=_YY _M_ZUST[0]=SET(0,0,1,0)
IF (_AXIND==1)AND(_HI[6]==1) GOTOF _MV4
_M_ZUST[0]=SET(0,0,0,1)
IF (_AXIND==1)AND(_HI[6]==-1) GOTOF _MV4
_MAV=_ZZ _M_ZUST[0]=SET(0,0,0,0)
IF (_AXIND==2)AND(_HI[6]==1) GOTOF _MV4
_M_ZUST[0]=SET(0,0,0,0)
IF (_AXIND==2)AND(_HI[6]==-1) GOTOF _MV4
_MV4:_INTERN[20+14]=1
ENDIF
N1014 _M_ME[11]=_M_SPE[10]+ABS(_M_SPE[3])*_HI[6]
IF _INTERN[20+14]
_M_SPE[16]=_SETVAL/_M_SPE[29]
ELSE
_M_SPE[16]=_SETVAL/_M_SPE[29]-_HR[6]*_HI[6]
ENDIF
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
N1015 CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_KOR_TOOLL[0]=(_M_ME[8]-_M_SPE[16])*_M_SPE[52] _M_ME[8]=SET(0,0)
IF (ABS(_KOR_TOOLL[0])) < _M_SPE[32] GOTOF _M384
_OVR[22]=$P_ADT[3+(_M_N[15+_AXIND]-1)] _OVR[23]=_KOR_TOOLL[0]/_M_SPE[52] _ALARM=61303
IF (_MVAR==10000)AND _SMI_R[10]
_ALARM=61447
GOTOF _FL8
ENDIF
GOTOF _Q99A
_M384:IF (ABS(_KOR_TOOLL[0])) < _M_SPE[33] GOTOF _M385
IF _INTERN[20+14]
IF _VB[51]
IF _HI[10]==3
_VB[11]=0 _INTERN[20+15]=0
ELSE
_M_ME[5-_MD+2*_AXIND]=_KOR_TOOLL[0] _VB[11]=1 _INTERN[20+15]=1
ENDIF
ELSE
_M_ME[4]=SET(0,0)
ENDIF
ELSE
IF _MD
_M_ME[4]=_HR[6]*_HI_MIGEO[5]
ELSE
_M_ME[5]=-(_HR[6])*_HI_MIGEO[5]
ENDIF
ENDIF
IF _HI[10]<3
_HI[11]=_HR[12] MOD 10000000 _HI[11]=(_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR _MA)
ELSE
_HI[11]=_HR[12] MOD 10000000 _HI[11]=(_HI[11] DIV 100*100)+((_HI[11] MOD 100) B_AND 'B0011' B_OR 'B0100')
_HI[15]=1
ENDIF
IF($MNS_MEA_FUNCTION_MASK B_AND 'B10000')
_M_SPE[53]=0
ELSE
_M_SPE[53]=ROUND($AA_IM[SPI(_M_N[13])]) _M_SPE[53]=((_M_SPE[53] MOD 360)+360) MOD 360
ENDIF
_M_SPE[53]=(_M_SPE[4] MOD 1000000000)+(_M_SPE[53]*1000000000)+((_M_SPE[4] DIV 1000000000000)*1000000000000)
_M385: GOTOF _Y85
_M07A: IF _M_ZUST[10]==0 GOTOF _MY4
N1010 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
N1011 AX[_YY]=_M_SPE[6]*_M_SPE[29]
IF _INTERN[18]
N1012 $P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,(_M_SPE[5]*_M_SPE[29]),_YY,(_M_SPE[6]*_M_SPE[29])):CROT(_ZZ,_HR[11])
ELSE
IF _XX<>_YY
N1012 ATRANS AX[_XX]=_M_SPE[5]*_M_SPE[29] AX[_YY]=_M_SPE[6]*_M_SPE[29]
ELSE
N1012 ATRANS AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
N1013 AROT RPL=_HR[11]
ENDIF
_M_SPE[5]=SET(0,0) _OVR[24]=_HR[11] _IW_C[0]=SET(0,0)
_MY4: IF (_HI[10]>=1)AND(_HI[10]<=3) GOTOF _Y07
IF (_VB[13] AND _VB[14]) GOTOF _Y07
GOTOF _FL2
_Y07:IF (_MD<0)OR(_MD>1)AND(_VB[13]==0)AND(_VB[14]==0) GOTOF _FL3 IF (_MD==0)OR(_VB[13] AND _VB[14]) GOTOF _Y01
_HI[6]=-1
_Y01:IF _VB[13] OR _VB[14] GOTOF _M10
_VB[10]=0 _VB[11]=0
IF _NEW_PAR AND(_HI[10]< 3)
_VB[11]=1
ENDIF
GOTOF _M30
_M10:_HI[6]=1
IF _VB[21]==0 GOTOF _M30
_M_ZUST[4]=1
_M30:_AXIND=_HI[10]-1 _HI[5]=_VB[14] _HI[3]=_VB[13] _HI[5]=_HI[5]*2+_HI[3]+1 _HI[3]=0
IF _VB[14] GOTOF _M20 IF _HI[10]<>1 GOTOF _M50
_MAV=_XX _VAV=_YY
GOTOF _M52
_M50:IF _HI[10]<>2 GOTOF _M51
_MAV=_YY _VAV=_XX
GOTOF _M52
_M51:_MAV=_ZZ
_M52: IF _VB[13]==1 GOTOF _M24
_HI[1]=_AXIND*2
IF _HI[10]<>3 GOTOF _M25
_HI[1]=0
_M25:_M_ZUST[_MD+_HI[1]]=1
GOTOF _M40
_M24:IF (_INTERN[10]) AND (_MAV==_YY) GOTOF _M26
_M_ZUST[0]=1
GOTOF _M40
_M26:_M_ZUST[2]=1
GOTOF _M40
_M20:_MAV=_XX _M_ZUST[0]=1 _AXIND=0 _HI[5]=4
_M40: _M_SPE[5]=_IW_C[0]+(_M_SPE[27]*_HI_MIGEO[3]) _M_SPE[6]=_IW_C[1]+(_M_SPE[28]*_HI_MIGEO[4])
_M_SPE[17]=_IM_C[0]+_M_SPE[27]*_DAT[0,1]+_M_SPE[28]*_DAT[1,1] _M_SPE[18]=_IM_C[1]+_M_SPE[27]*_DAT[0,2]+_M_SPE[28]*_DAT[1,2]
_M_SPE[19]=_IM_C[2]+_M_SPE[27]*_DAT[0,3]+_M_SPE[28]*_DAT[1,3]
IF _INTERN[2]
N1015 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF _INTERN[10]
N1016 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
_M_SPE[14]=1 _INTERN[1]=0 _INTERN[9]=0
IF _VB[21]==0 GOTOF _M45
_M_SPE[16]=_SETVAL/_M_SPE[29]
GOTOF _Q010
_M45:_M_SPE[16]=_SETVAL/2/_M_SPE[29]*_HI[6]
IF _M_ZUST[1] XOR _M_ZUST[3]==0 GOTOF _Q01 IF _M_ZUST[4]==0 GOTOF _Q01
_M_SPE[16]=-_M_SPE[16]
_Q01:_M_SPE[16]=_M_SPE[16]+_M_SPE[5+_AXIND]
_Q010:IF _AXIND==2 GOTOF _Q89
_Q89: _HI[1]=-1
IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _Q02
_HI[1]=1
_Q02:
IF (_INTERN[20+14]) AND (_MAV==_ZZ)
_M_SPE[10]=_M_SPE[16]+_HI[1]*_M_SPE[3]
ELSE
_M_SPE[10]=_M_SPE[16]+_HI[1]*(_HR[6]+_M_SPE[3])
ENDIF
_HR[14]=_M_SPE[5+_AXIND]
IF ((_M_ZUST[0] OR _M_ZUST[2])AND(_M_SPE[16]<_HR[14]))OR((_M_ZUST[1] OR _M_ZUST[3])AND(_M_SPE[16]>_HR[14])) GOTOF _FL3
IF ((_M_ZUST[0] OR _M_ZUST[2])AND(_M_SPE[10]<_HR[14]))OR((_M_ZUST[1] OR _M_ZUST[3])AND(_M_SPE[10]>_HR[14]))
_M_SPE[10]=_HR[14]
ENDIF
IF _M_ZUST[4]==0 GOTOF _Q05 IF (_INTERN[18]) AND (_MAV==_ZZ) GOTOF _Q05
_HR[14]=_M_SPE[5+_AXIND]
_Q03:IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _Q04 IF _M_SPE[10]<=_HR[14] GOTOF _Q05
GOTOF _Q06
_Q04:IF _M_SPE[10]>=_HR[14] GOTOF _Q05
_Q06:_M_SPE[10]=_HR[14]
_Q05:_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_HI[1]
N1234 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_HI[1]
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _HI[14]==0
IF($MNS_MEA_FUNCTION_MASK B_AND 'B10000')
_M_SPE[53]=0
ELSE
_M_SPE[53]=ROUND($AA_IM[SPI(_M_N[13])]) _M_SPE[53]=((_M_SPE[53] MOD 360)+360) MOD 360
ENDIF
_HI[14]=_HI[14]+1 _M_SPE[53]=(_M_SPE[4] MOD 1000000000)+(_M_SPE[53]*1000000000)+((_M_SPE[4] DIV 1000000000000)*1000000000000)
ENDIF
_HI[1]=2
IF (_M_ZUST[0] XOR _M_ZUST[2])==0 GOTOF _Q50 IF _M_ZUST[2] GOTOF _Q20
_HI[1]=0
_Q20:_M_ME[5+_HI[1]]=_M_ME[8] _M_ME[8]=0
IF _VB[10] GOTOF _Q11
_M_ME[5+_HI[1]]=_M_ME[5+_HI[1]]-_M_SPE[16]
_Q11:IF _VB[13] OR _VB[14] GOTOF _Q12
_M_ZUST[7]=1
GOTOF _Q66
_Q12:_M_ZUST[_HI[1]]=0 _M_ZUST[1+_HI[1]]=1 _HI[6]=-1
GOTOF _Q66
_Q50:IF _M_ZUST[3] GOTOF _Q40
_HI[1]=0
_Q40: _M_ME[4+_HI[1]]=_M_ME[8] _M_ME[8]=0
IF _VB[10] GOTOF _Q21
_M_ME[4+_HI[1]]=_M_ME[4+_HI[1]]-_M_SPE[16]
_Q21:IF(_VB[13]OR(_VB[14])==0)GOTOF _Q31 IF _VB[10]==0 GOTOF _Q31
_M_SPE[27+_AXIND]=_M_SPE[27+_AXIND]*_HI_MIGEO[3+_AXIND]
_OVR[20+_AXIND]=((_M_ME[5+_HI[1]]+_M_ME[4+_HI[1]])/2-_IW_C[_AXIND])*_HI_MIGEO[3+_AXIND]
IF ABS(_M_SPE[27+_AXIND]-_OVR[20+_AXIND])>_M_SPE[32]
_ALARM=61303
ENDIF
IF _Alarm GOTOF _Q99A
IF (_TEMP==0) AND (ABS(_M_SPE[27+_AXIND]-_OVR[20+_AXIND])<_M_SPE[33]) GOTOF _Q31
_HD=_OVR[20+_AXIND]-_M_SPE[27+_AXIND] _M_SPE[27+_AXIND]=_OVR[20+_AXIND]
IF ((_M_SPE[60]==1) AND ($SCS_MEA_SIM_ENABLE<>9)) GOTOF _NOWR5
_M_SPE[27+_AXIND]=_OVR[20+_AXIND]
_NOWR5: _M_SPE[5+_AXIND]=_IW_C[_AXIND]+_M_SPE[27+_AXIND] _M_SPE[17]=_M_SPE[17]+_HD*_DAT[0,1] _M_SPE[18]=_M_SPE[18]+_HD*_DAT[0,2] _M_SPE[19]=_M_SPE[19]+_HD*_DAT[0,3]
_Q31:IF _VB[14] GOTOF _Q39 IF _VB[10]==0 GOTOF _Q38
_VB[10]=0 _M_ZUST[_AXIND*2+1]=0 _HI[6]=-_HI[6]
GOTOB _M30
_Q38:_M_ZUST[7]=1
GOTOF _Q66
_Q39:_HI[6]=-_HI[6]
_Q66:IF _VB[23]==0 GOTOF _Q69
N1340 G90 AX[_MAV]=_M_SPE[5+_AXIND]*_M_SPE[29]
_Q69:IF _VB[14]==0 GOTOF _Q70 IF _HI[3]<>1 GOTOF _Q70
_M_ZUST[1]=0 _M_ZUST[2]=1 _MAV=_YY _AXIND=1
_Q70: _HI[3]=_HI[3]+1
IF(_VB[14] AND _VB[10])AND((_HI[5]-_HI[3])==0) GOTOF _Y80 IF((_HI[5]-_HI[3])AND(_M_ZUST[7]==0)) GOTOB _M40
_HI[11]=_HR[12] MOD 100000
IF _MVAR MOD 10 <> 0
IF _MVAR _DEC4 == 0
_HI[11]=(_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR 1 B_OR 2)+1000000
ELSE
_HI[11]=((_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR _HI[10]))
ENDIF
ELSE
IF _HI[10]==3
_OVR[22]=$P_ADT[3+(_M_N[15+_AXIND]-1)]
_HI[11]=_HR[12] MOD 10000000 _HI[11]=(_HI[11] DIV 100*100)+((_HI[11] MOD 100) B_AND 'B0011' B_OR 'B1000')
ELSE
_HI[11]=((_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR _HI[10]))
ENDIF
ENDIF
GOTOF _Y85
_Y80:_VB[10]=0 _M_ZUST[_AXIND*2+1]=0
GOTOB _M30
_KZ2K:_ALARM=61309 _HI[2]=1
IF _OVI[1]<>710 GOTOF _FL14 IF _MVAR _DEC4 <>2 GOTOF _FL1
IF(_HI[10]<>1)AND(_HI[10]<>2)GOTOF _FL2 IF(_VB[13]<>1)AND(_VB[14]<>0)GOTOF _FL1
_HR[0]= S_SETV1/_M_SPE[29] _M_SPE[16]=_SETVAL/_M_SPE[29] _ALARM=61364
IF ABS(_M_SPE[16])<(2*_HR[6]+1)GOTOF _FL14
_AXIND=_HI[10]-1 _HI[3]=0 _ALARM=0
IF _HI[10]<>1 GOTOF _M21
_MAV=_XX _VAV=_YY _M_ZUST[0]=1
GOTOF _M22
_M21:IF _HI[10]<>2 GOTOF _M22
_MAV=_YY _VAV=_XX _M_ZUST[2]=1
_M22: _HI[6]=0 _M_ZUST[4]=0
_M_SPE[5]=_IW_C[0]+(_M_SPE[27]*_HI_MIGEO[3]) _M_SPE[6]=_IW_C[1]+(_M_SPE[28]*_HI_MIGEO[4])
_M_SPE[17]=_IM_C[0]+_M_SPE[27]*_DAT[0,1]+_M_SPE[28]*_DAT[1,1] _M_SPE[18]=_IM_C[1]+_M_SPE[27]*_DAT[0,2]+_M_SPE[28]*_DAT[1,2]
_M_SPE[19]=_IM_C[2]+_M_SPE[27]*_DAT[0,3]+_M_SPE[28]*_DAT[1,3]
IF _INTERN[2]
N1015 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF _INTERN[10]
N1016 G90 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
_HR[1]=_HR[0]+_M_SPE[16] _HR[7]=_M_SPE[5+_AXIND]
IF _HR[0] < _HR[1]
_M_SPE[10]=_HR[1]-(_HR[6]+_M_SPE[3]) _HI[5]=0
IF _HR[1] < _HR[7] GOTOF _FL3
ELSE
_M_SPE[10]=_HR[0]-(_HR[6]+_M_SPE[3]) _HI[5]=1
IF _HR[0] < _HR[7] GOTOF _FL3
ENDIF
IF ((_M_ZUST[0] OR _M_ZUST[2])AND(_M_SPE[10]<_HR[7]))OR((_M_ZUST[1] OR _M_ZUST[3])AND(_M_SPE[10]>_HR[7]))
_M_SPE[10]=_HR[7]
ENDIF
_M55:_M_SPE[9]=_M_SPE[10]+(_HI[2]*(_M_SPE[60]*_M_SPE[3])) _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_HI[1]
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _HI[14]==0
IF($MNS_MEA_FUNCTION_MASK B_AND 'B10000')
_M_SPE[53]=0
ELSE
_M_SPE[53]=ROUND($AA_IM[SPI(_M_N[13])]) _M_SPE[53]=((_M_SPE[53] MOD 360)+360) MOD 360
ENDIF
_HI[14]=_HI[14]+1 _M_SPE[53]=(_M_SPE[4] MOD 1000000000)+(_M_SPE[53]*1000000000)+((_M_SPE[4] DIV 1000000000000)*1000000000000)
ENDIF
_M_ME[0]=_M_ME[8] _M_ME[8]=SET(0,0) _HI[3]=_HI[3]+1
IF _M_ZUST[_AXIND*1+_AXIND] AND(_HI[3]==1)GOTOF _MPKT1 IF _M_ZUST[_AXIND*1+_HI[10]] AND(_HI[3]==2)GOTOF _MPKT2
IF _M_ZUST[_AXIND*1+_AXIND] AND(_HI[3]==3)GOTOF _MPKT3 IF _M_ZUST[_AXIND*1+_HI[10]] AND(_HI[3]==4)GOTOF _MPKT4
_MPKT1:_M_ZUST[_AXIND*1+_AXIND]=0 _M_ZUST[_AXIND*1+_HI[10]]=1
_M_SPE[10]=_HR[_HI[5]]+(_HR[6]+_M_SPE[3]) _HI[2]=-1
IF _HI[5]
_HR[10]=_M_ME[0] - _HR[0]
ELSE
_HR[10]=_M_ME[0] - _HR[1]
ENDIF
GOTOB _M55
_MPKT2:_M_ZUST[_AXIND*1+_AXIND]=1 _M_ZUST[_AXIND*1+_HI[10]]=0 _HI[2]=1
IF _HI[5]
_M_SPE[10]=_HR[0]-(_HR[6]+_M_SPE[3])
_OVR[20+_AXIND]=(_HR[10]+_M_ME[0]-_HR[1])/2
ELSE
_M_SPE[10]=_HR[1]-(_HR[6]+_M_SPE[3])
_OVR[20+_AXIND]=(_HR[10]+_M_ME[0]-_HR[0])/2
ENDIF
IF _VB[10]==0
_OVR[20+_AXIND]=0
ENDIF
IF ABS(_M_SPE[27+_AXIND]-_OVR[20+_AXIND])>_M_SPE[32]
_ALARM=61303
GOTOF _FL14
ENDIF
IF ((_M_SPE[60]==2)OR($SCS_MEA_SIM_ENABLE==9))
IF ABS(_M_SPE[27+_AXIND]-_OVR[20+_AXIND]) > _M_SPE[33]
_M_SPE[27+_AXIND]=_OVR[20+_AXIND]
ENDIF
ENDIF
GOTOB _M55
_MPKT3: _M_ZUST[_AXIND*1+_AXIND]=0 _M_ZUST[_AXIND*1+_HI[10]]=1 _HI[2]=-1 _HR[8]=_M_ME[0]
_M_SPE[10]=_HR[_HI[5]]+(_HR[6]+_M_SPE[3])
IF _HI[5]
_M_ME[5+_AXIND*2]=_M_ME[0]- _HR[0]- _OVR[20+_AXIND]
ELSE
_M_ME[5+_AXIND*2]=_M_ME[0]- _HR[1]- _OVR[20+_AXIND]
ENDIF
GOTOB _M55
_MPKT4:_HR[9]=_M_ME[0]
IF _HI[5]
_M_ME[4+_AXIND*2]=_M_ME[0]- _HR[1]- _OVR[20+_AXIND]
ELSE
_M_ME[4+_AXIND*2]=_M_ME[0]- _HR[0]- _OVR[20+_AXIND]
ENDIF
_OVR[5+_AXIND]=(_HR[8]+_HR[9])/2 _HR[4]=_OVR[5]+_M_SPE[27]-_M_SPE[5]
_M_SPE[17]=_M_SPE[17]+_HR[4]*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_HR[4]*_DAT[1,2] _M_SPE[19]=_M_SPE[19]+_HR[4]*_DAT[1,3]
_HI[11]=_HR[12] MOD 100000
_HI[11]=((_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR _HI[10]))+5000000
GOTOF _Y85
_KK:_ALARM=61309
IF(_OVI[1]==713)OR(_OVI[1]==714) GOTOF _FL14
_ALARM=61413
IF _SETVAL <=0 GOTOF _FL14 IF _MVAR _DEC4 <>0 GOTOF _FL1
_ALARM= 61365
IF _M_ZUST[10] AND(_RF<=0) GOTOF _FL14
_ALARM=61336 _HR[10]=90 _INCA=90 _VB[0]=1 _HI[1]=_INTERN[20+8] _INTERN[20+8]=0
IF((_INTERN[2]==0)OR(_INTERN[10]==0)OR(_INTERN[18]==0)) OR ((_XX==_YY)OR(_XX==_ZZ)OR(_YY==_ZZ)) GOTOF _FL14
_ALARM=0 _HR[11]=(_HR[11] MOD 360) _OVR[24]=_HR[11]
IF ((_MVAR _DEC4)<>0)
_ALARM=61443
IF (_HR[10]==0) OR (((_MVAR _DEC6)==1) AND (_HR[10]>90)) GOTOF _FL14
_ALARM=0
ENDIF
_M_ZUST[0]=SET(0,1,0,0,0,0,0,0,0) _VB[27]=0 _M_N[7]=0 _M_SPE[27]=0 _M_SPE[28]=0
_KUGDM=_SETVAL/_M_SPE[29] _OVR[0]=_KUGDM _OVR[3]=_KUGDM _MAV=_ZZ _HR[2]=_HR[6] _HI[6]=-_HI[6]
_M_SPE[16]=_M_SPE[7]-_M_SPE[3] _M_SPE[10]=_M_SPE[7]
_M_SPE[9]=_M_SPE[10]- _M_SPE[60]*_M_SPE[3] _M_ME[11]=_M_SPE[16]+_M_SPE[25]
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
N5080 CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_M_SPE[53]=ROUND($AA_IM[SPI($AC_MSNUM)]) _M_SPE[53]=((_M_SPE[53] MOD 360)+360) MOD 360
_M_SPE[53]=(_M_SPE[4] MOD 1000000000)+(_M_SPE[53]*1000000000)+((_M_SPE[4] DIV 1000000000000)*1000000000000)
_M_ME[12]=_M_ME[8] _X_MP=_M_SPE[5] _Y_MP=_M_SPE[6] _OVR[28]=_M_SPE[32] _M_N[7]=0 _M_ME[8]=SET(0,0)
_Z_MP=_M_ME[12]-_KUGDM/2 _Z_PPOS=_Z_MP+_KUGDM/2+_M_SPE[3] _Z_TPOS=_Z_MP-_HR[2]
IF _VB[2] AND _VB[3]
_INTERN[20+8]=_HI[1] _HI[13]=1 _M_ZUST[4]=1
ELSE
_INTERN[20+8]=0 _VB[55]=1
ENDIF
_VB[16]=1 _VB[2]=1 _VB[3]=1 _VB[0]=1 _VB[15]=0
IF _M_ZUST[10] == 0 GOTOF _MAXPAR
_M4UW:
_M_ZUST[6]=0 _VB[27]=0 _M_ZUST[0]=1
_CPA=_X_MP _CPO=_Y_MP
IF _HI[13]==1
_M_SPE[8]=0 _INTERN[20+8]=_HI[1]
ENDIF
N1080 G111 AX[_XX]=(_X_MP+_M_SPE[27])*_M_SPE[29] AX[_YY]=(_Y_MP+_M_SPE[28])*_M_SPE[29]
_M_SPE[16]=_KUGDM _HR[5]=_M_SPE[3] _M_SPE[10]=_M_SPE[16]/2+_HR[2]+_M_SPE[3]
IF _M_SPE[60] ==2
IF _M_SPE[3] >= (_M_SPE[16]/2)
_HR[5]=_M_SPE[16]/2 - 0.1
ENDIF
_M_SPE[9]=_M_SPE[10] - (_HR[5] + _M_SPE[3])
ELSE
_M_SPE[9]=_M_SPE[10] - _M_SPE[3]
ENDIF
_M_ME[11]=(_M_SPE[16]+(_HR[2]*2))/2
_HR[3]=_X_MP+_M_SPE[10]*COS(_HR[11]) _HR[4]=_Y_MP+_M_SPE[10]*SIN(_HR[11])
IF (ABS(_HR[3]-_M_SPE[5])<0.001) AND (ABS(_HR[4]-_M_SPE[6])<0.001) GOTOF _M86
N1100 G0 G90
IF _VB[1] GOTOF _M81
N1105 G1 F=_M_SPE[1]
_M81: IF _INTERN[40+2] GOTOF _M85
N1110 RP=_M_SPE[10]*_M_SPE[29] AP=_HR[11]
GOTOF _M86
N1115 _M85: MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_HR[11]
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _M86
_ALARM=61302
GOTOF _FL15
N2100 _M86: G0 G90
IF _VB[1] GOTOF _M87
N2105 G1 F=_M_SPE[2]
_M87:IF _INTERN[40+2] GOTOF _M88
N2110 AX[_ZZ]=_Z_TPOS*_M_SPE[29]
GOTOF _M89E
N2115 _M88: MEAS=_M_N[0] AX[_ZZ]=_Z_TPOS*_M_SPE[29]
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _M89E
_ALARM=61302
GOTOF _FL15
_M89E: _WINKEL=_HR[11] _M_N[7]=0
IF (_VB[55] AND _VB[2] AND _VB[3])OR(_HI[13])
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_WINKEL
ELSE
_M_SPE[8]=_M_SPE[61] +_WINKEL
ENDIF
_M_SPE[8]=((_M_SPE[8] MOD 360)+360) MOD 360
IF _HI[13]==0
IF _INTERN[40+18]
N2120 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N2125 SUPA SPOS=DC(_M_SPE[8])
ENDIF
ENDIF
ENDIF
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
N2130 _M9: _M_ME[8]=0 _M_ME[9]=0
CYCLE112(_XX,_YY,_ZZ,_M_SPE,_M_ME,_WINKEL,_M_N,_ALARM,_M_ZUST,_VB,_INTERN)
IF _M_ZUST[0] GOTOF _MPKT11 IF _M_ZUST[1] GOTOF _MPKT12 IF _M_ZUST[2] GOTOF _MPKT13 IF _M_ZUST[3] GOTOF _MPKT14
_MPKT11: _CD_IN[0+4*_KUGWDH,0]=_M_ME[8] _CD_IN[0+4*_KUGWDH,1]=_M_ME[9] _M_ZUST[0]=0 _M_ZUST[1]=1 _WINKEL=_HR[11]+_HR[10]
IF _HI[13] GOTOF _MONO
GOTOB _M9
_MPKT12: _CD_IN[1+4*_KUGWDH,0]=_M_ME[8] _CD_IN[1+4*_KUGWDH,1]=_M_ME[9] _M_ZUST[1]=0 _M_ZUST[2]=1 _WINKEL=_HR[11]+2*_HR[10]
IF _HI[13] GOTOF _MONO
GOTOB _M9
_MPKT13: _CD_IN[2+4*_KUGWDH,0]=_M_ME[8] _CD_IN[2+4*_KUGWDH,1]=_M_ME[9] _M_ZUST[2]=0 _M_ZUST[3]=1 _WINKEL=_HR[11]+3*_HR[10]
IF _HI[13] GOTOF _MONO
GOTOB _M9
_MPKT14:_CD_IN[3+4*_KUGWDH,0]=_M_ME[8] _CD_IN[3+4*_KUGWDH,1]=_M_ME[9] _M_ZUST[7]=1 _M_ME[8]=SET(0,0)
GOTOF _M102
_MONO:
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_WINKEL
ELSE
_M_SPE[8]=_M_SPE[61] +_WINKEL
ENDIF
GOTOB _M9
N1130 _M102:IF _KUGWDH==1 GOTOF _M112 IF _KUGWDH==2 GOTOF _M113
_HI[0]=0 _VB[55]=0
REPEAT
_H_CD_IN[_HI[0],0]=_CD_IN[_HI[0],0] _H_CD_IN[_HI[0],1]=_CD_IN[_HI[0],1]
_HI[0]=_HI[0]+1
UNTIL _HI[0]>3
_ALARM=CALCDAT(_H_CD_IN,4,_CD_OUT)
IF (_ALARM==0)
_ALARM=61316
GOTOF _FL15
ELSE
_ALARM=0
ENDIF
IF _M_N[18]
_OVR[25]=_KUGDM _OVR[26]=_HR[6] _OVR[6]=SET(0,0) _OVR[2]=_Z_MP
ELSE
_OVR[25]=(_CD_OUT[2]*2)-(_HR[6]*2) _OVR[26]=_HR[6]
IF (_OVR[25]<(_KUGDM-(_SETVAL*0.05)))OR(_OVR[25]>(_KUGDM+(_SETVAL*0.05)))
_ALARM=61424 _OVR[3]=_OVR[25] _OVR[4]=_OVR[26]*2
GOTOF _M115ERR
ENDIF
_OVR[6]=SET(_CD_OUT[0],_CD_OUT[1]) _OVR[2]=_Z_MP _OVR[25]=_OVR[25]
ENDIF
_KF[0,1]=_OVR[6]-_X_MP _KF[0,2]=_OVR[7]-_Y_MP _ALARM=61303
IF((ABS(_KF[0,1]))>_M_SPE[32])OR((ABS(_KF[0,2]))>_M_SPE[32]) GOTOF _M115ERR
_X_MP=_OVR[6] _Y_MP=_OVR[7]
_M_ZUST[0]=SET(1,0,0,0) _ALARM=0
GOTOF _M115ANF
_M112:_M_ZUST[0]=SET(1,0,0,0)
IF _HI[13]==0
IF _VB[10]==1
_M_SPE[27]=((SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_CD_IN[0+4*_KUGWDH,0])+POT(_CD_IN[2+4*_KUGWDH,1]-_CD_IN[0+4*_KUGWDH,1]))/2)-(SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[2+4*_KUGWDH,1]-_Y_MP))))*(-1)
_TEMP=((SQRT(POT(_CD_IN[0+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[0+4*_KUGWDH,1]-_Y_MP)))-(SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_CD_IN[0+4*_KUGWDH,0])+POT(_CD_IN[2+4*_KUGWDH,1]-_CD_IN[0+4*_KUGWDH,1]))/2))*(-1)
_M_SPE[27]=(_M_SPE[27]+_TEMP)/2
_M_SPE[28]=((SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_CD_IN[1+4*_KUGWDH,0])+POT(_CD_IN[3+4*_KUGWDH,1]-_CD_IN[1+4*_KUGWDH,1]))/2)-(SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[3+4*_KUGWDH,1]-_Y_MP))))*(-1)
_TEMP=((SQRT(POT(_CD_IN[1+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[1+4*_KUGWDH,1]-_Y_MP)))-(SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_CD_IN[1+4*_KUGWDH,0])+POT(_CD_IN[3+4*_KUGWDH,1]-_CD_IN[1+4*_KUGWDH,1]))/2))*(-1)
_M_SPE[28]=(_M_SPE[28]+_TEMP)/2
ENDIF
ELSE
_M_SPE[28]=0 _M_SPE[27]=0; <--- fuer Monotaster
ENDIF
IF (_M_N[18]==1)
_HR[2]=_HR[6] _M_SPE[27]=0 _M_SPE[28]=0
ELSE
_HR[2]=((SQRT(POT(_CD_IN[2+4*_KUGWDH,0] - _CD_IN[0+4*_KUGWDH,0])+ POT(_CD_IN[2+4*_KUGWDH,1] - _CD_IN[0+4*_KUGWDH,1])))+(SQRT(POT(_CD_IN[3+4*_KUGWDH,0] - _CD_IN[1+4*_KUGWDH,0])+ POT(_CD_IN[3+4*_KUGWDH,1] - _CD_IN[1+4*_KUGWDH,1])))-(_M_SPE[16]*2))/4
ENDIF
GOTOF _M115ANF
_M113:_M_ZUST[0]=SET(1,0,0,0)
IF _VB[10]==1
_M_SPE[27]=(SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_CD_IN[0+4*_KUGWDH,0])+POT(_CD_IN[2+4*_KUGWDH,1]-_CD_IN[0+4*_KUGWDH,1]))/2)-(SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[2+4*_KUGWDH,1]-_Y_MP)))
_TEMP=(SQRT(POT(_CD_IN[0+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[0+4*_KUGWDH,1]-_Y_MP)))-(SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_CD_IN[0+4*_KUGWDH,0])+POT(_CD_IN[2+4*_KUGWDH,1]-_CD_IN[0+4*_KUGWDH,1]))/2)
_M_SPE[27]=(_M_SPE[27]+_TEMP)/2
_M_SPE[28]=(SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_CD_IN[1+4*_KUGWDH,0])+POT(_CD_IN[3+4*_KUGWDH,1]-_CD_IN[1+4*_KUGWDH,1]))/2)-(SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[3+4*_KUGWDH,1]-_Y_MP)))
_TEMP=(SQRT(POT(_CD_IN[1+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[1+4*_KUGWDH,1]-_Y_MP)))-(SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_CD_IN[1+4*_KUGWDH,0])+POT(_CD_IN[3+4*_KUGWDH,1]-_CD_IN[1+4*_KUGWDH,1]))/2)
_M_SPE[28]=(_M_SPE[28]+_TEMP)/2
ENDIF
_KF[0,1]=_OVR[20]-_M_SPE[27] _KF[0,2]=_OVR[21]-_M_SPE[28] _ALARM=61303
IF((ABS(_KF[0,1]))>_M_SPE[32])OR((ABS(_KF[0,2]))>_M_SPE[32]) GOTOF _M115ERR
IF _M_N[18]
_OVR[20]=SET(0,0) _M_SPE[27]=SET(0,0)
_M_ME[4]=_HR[6]+$SCS_MEA_SIM_MEASURE_DIFF/2 _M_ME[5]=(-_HR[6]) - $SCS_MEA_SIM_MEASURE_DIFF/2
_M_ME[6]=_HR[6]+$SCS_MEA_SIM_MEASURE_DIFF/2 _M_ME[7]=(-_HR[6])-$SCS_MEA_SIM_MEASURE_DIFF/2
ELSE
_M_ME[4]=(SQRT(POT(_CD_IN[0+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[0+4*_KUGWDH,1]-_Y_MP))) - (_M_SPE[16]/2) - _M_SPE[27]
_M_ME[5]=(_M_SPE[16]/2)-(SQRT(POT(_CD_IN[2+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[2+4*_KUGWDH,1]-_Y_MP))) - _M_SPE[27]
_M_ME[6]=(SQRT(POT(_CD_IN[1+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[1+4*_KUGWDH,1]-_Y_MP))) - (_M_SPE[16]/2) - _M_SPE[28]
_M_ME[7]=(_M_SPE[16]/2)-(SQRT(POT(_CD_IN[3+4*_KUGWDH,0]-_X_MP)+POT(_CD_IN[3+4*_KUGWDH,1]-_Y_MP))) - _M_SPE[28]
ENDIF
_HI[0]=0
REPEAT
_H_CD_IN[_HI[0],0]=_CD_IN[0+(4*_KUGWDH+_HI[0]),0] _H_CD_IN[_HI[0],1]=_CD_IN[0+(4*_KUGWDH+_HI[0]),1]
_HI[0]=_HI[0]+1
UNTIL _HI[0]>3
_ALARM=CALCDAT(_H_CD_IN,4,_CD_OUT)
IF (_ALARM==0)
_ALARM=61316
GOTOF _FL15
ELSE
_ALARM=0
ENDIF
_X_MP=_CD_OUT[0] _Y_MP=_CD_OUT[1] _IW_C[0]=SET(_X_MP,_Y_MP)
IF _M_N[18]
_HR[2]=_HR[6]
ELSE
_HR[2]=((SQRT(POT(_CD_IN[2+4*_KUGWDH,0] - _CD_IN[0+4*_KUGWDH,0])+ POT(_CD_IN[2+4*_KUGWDH,1] - _CD_IN[0+4*_KUGWDH,1])))+(SQRT(POT(_CD_IN[3+4*_KUGWDH,0] - _CD_IN[1+4*_KUGWDH,0])+ POT(_CD_IN[3+4*_KUGWDH,1] - _CD_IN[1+4*_KUGWDH,1])))-(_M_SPE[16]*2))/4
ENDIF
_OVR[3]=_CD_OUT[2]*2 _OVR[3]=_OVR[3]-_HR[2]*2
_M115ANF: _X_MPOS=_X_MP+_M_SPE[27] _Y_MPOS=_Y_MP+_M_SPE[28]
N4100 _M115ERR: G0 G90
IF _VB[1] GOTOF _M287
N4103 G1 F=_M_SPE[2]
_M287: IF _INTERN[40+2] GOTOF _M288
N4105 AX[_ZZ]=_Z_PPOS*_M_SPE[29]
IF _ALARM==61424 GOTOF _FL14 IF _ALARM GOTOF _Q99A
N4107 AX[_XX]=_X_MPOS*_M_SPE[29] AX[_YY]=_Y_MPOS*_M_SPE[29] F=_M_SPE[1]
GOTOF _M290
N4110 _M288: MEAS=_M_N[0] AX[_ZZ]=_Z_PPOS*_M_SPE[29]
IF _ALARM GOTOF _Q99A
_ALARM=61302
STOPRE
IF $AC_MEA[_M_N[0]]<>0 GOTOF _FL16
N4116 MEAS=_M_N[0] AX[_XX]=_X_MPOS*_M_SPE[29] AX[_YY]=_Y_MPOS*_M_SPE[29] F=_M_SPE[1]
STOPRE
IF $AC_MEA[_M_N[0]]<>0 GOTOF _FL16
_ALARM=0
_M290:_M_SPE[5]=SET(_X_MPOS,_Y_MPOS)
IF _HI[13]==1
_INTERN[20+8]=0
stopre
ENDIF
GOTOF _M115A
_MAXPAR: _HR[11]=0
_MAXP2:_M_ZUST[0]=SET(1,0,0,0,0,0,0,0,0) _M_N[7]=0
IF _HI[13]==1
_INTERN[20+8]=_HI[1]
ENDIF
_MAV=_XX _AXIND=0 _M_ME[1]=0 _M_ME[2]=0 _M_ME[8]=0 _M_ME[9]=0 _ALARM=0 _ACHS[0]=_XX _ACHS[1]=_YY
N6100 _MAP9: _MAV=_ACHS[_AXIND] _MESSR=-1
IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _MAP92
_MESSR=1
_MAP92:_M_SPE[16]=_KUGDM _HR[5]=(_M_SPE[16]/2+_HR[2]+_M_SPE[3])*_MESSR _M_SPE[10]=_M_SPE[5+_AXIND]+_HR[5]
_M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR _M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR
G0 G90
IF _VB[1] GOTOF _MAP81
N6100 G1 F=_M_SPE[1]
_MAP81: IF _INTERN[40+2] GOTOF _MAP83
N6110 AX[_MAV]=_M_SPE[10]*_M_SPE[29]
GOTOF _MAP86
N6115 _MAP83: MEAS=_M_N[0] AX[_MAV]=_M_SPE[10]*_M_SPE[29]
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _MAP86
_ALARM=61302
GOTOF _FL16
_MAP86:G0 G90
IF _VB[1] GOTOF _MAP87
N7100 G1 F=_M_SPE[2]
_MAP87:IF _INTERN[40+2] GOTOF _MAP88
N7110 AX[_ZZ]=_Z_TPOS*_M_SPE[29]
GOTOF _MAP90
N7115 _MAP88: MEAS=_M_N[0] AX[_ZZ]=_Z_TPOS*_M_SPE[29]
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _MAP90
_ALARM=61302
GOTOF _FL16
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
N7110 _MAP90: CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _M_ZUST[0] GOTOF _PAP1 IF _M_ZUST[1] GOTOF _PAP2 IF _M_ZUST[2] GOTOF _PAP3 IF _M_ZUST[3] GOTOF _PAP4
_PAP1: _M_ZUST[0]=0 _M_ZUST[1]=1
_CD_IN[2+4*_KUGWDH,0]=_M_ME[8] _CD_IN[2+4*_KUGWDH,1]=_M_ME[9] _M_ME[8]=SET(0,0)
IF _M_N[18]
_CD_IN[2+4*_KUGWDH,0]=_M_ME[11]-_HR[2]*_MESSR
ENDIF
G0 G90
IF _VB[1] GOTOF _MAP287
N7100 G1 F=_M_SPE[2]
N7110 _MAP287: AX[_ZZ]=_Z_PPOS
G0
IF _VB[1] GOTOF _MAP288
G1 F=_M_SPE[1]
N7111 _MAP288: AX[_XX]=_X_MP+_M_SPE[27]
GOTOB _MAP9
_PAP2: _M_ZUST[1]=0 _M_ZUST[2]=1 _M_ZUST[7]=0 _AXIND=1
_CD_IN[0+4*_KUGWDH,0]=_M_ME[8] _CD_IN[0+4*_KUGWDH,1]=_M_ME[9] _M_ME[8]=SET(0,0)
IF _M_N[18]
_CD_IN[0+4*_KUGWDH,0]=_M_ME[1]-_HR[2]*_MESSR
ENDIF
G0 G90
IF _VB[1] GOTOF _MAP387
N7100 G1 F=_M_SPE[2]
N7110 _MAP387: AX[_ZZ]=_Z_PPOS
G0
IF _VB[1] GOTOF _MAP388
G1 F=_M_SPE[1]
N7111 _MAP388: AX[_XX]=_X_MP+_M_SPE[27]
GOTOB _MAP9
_PAP3: _M_ZUST[2]=0 _M_ZUST[3]=1
_CD_IN[3+4*_KUGWDH,0]=_M_ME[9] _CD_IN[3+4*_KUGWDH,1]=_M_ME[8] _M_ME[8]=SET(0,0)
IF _M_N[18]
_CD_IN[3+4*_KUGWDH,1]=_M_ME[1]-_HR[2]*_MESSR
ENDIF
G0 G90
IF _VB[1] GOTOF _MAP487
N7100 G1 F=_M_SPE[2]
N7110 _MAP487: AX[_ZZ]=_Z_PPOS
G0
IF _VB[1] GOTOF _MAP488
G1 F=_M_SPE[1]
N7130 _MAP488: AX[_YY]=_Y_MP+_M_SPE[28]
GOTOB _MAP9
_PAP4: _M_ZUST[7]=1
_CD_IN[1+4*_KUGWDH,0]=_M_ME[9] _CD_IN[1+4*_KUGWDH,1]=_M_ME[8] _M_ME[8]=SET(0,0)
IF _M_N[18]
_CD_IN[1+4*_KUGWDH,1]=_M_ME[11]-_HR[2]*_MESSR
ENDIF
IF _KUGWDH==0 GOTOB _M102 IF _KUGWDH==1 GOTOB _M112 IF _KUGWDH==2 GOTOB _M113
_M115A: _M_N[7]=0
IF _ALARM
STOPRE
GOTOF _FL14
ENDIF
IF(_HI[13]==0)AND(_KUGWDH>=1)
IF _M_ZUST[10]
IF _KUGWDH==1
IF _INTERN[40+18]
N700 CUST_MEACYC(3,(180 + _HR[11]),4)
ELSE
N703 SUPA SPOS=IC(180 + _HR[11])
ENDIF
ELSE
IF _KUGWDH==2
IF _INTERN[40+18]
N705 CUST_MEACYC(3,_HR[11],4)
ELSE
N707 SUPA SPOS=IC(_HR[11])
ENDIF
ENDIF
ENDIF
ELSE
IF _KUGWDH==1
_M_SPE[8]=(((_M_SPE[8]-179.9) MOD 360)+360) MOD 360
ENDIF
ENDIF
ENDIF
IF (_KUGWDH==2)AND(_VB[17]==0)AND(_VB[40]==0) GOTOF _M386
_M_ZUST[0]=SET(0,1,0,0,0,0,0,0,0) _VB[27]=0 _M_N[7]=0
_MAV=_ZZ _AXIND=2 _M_ME[1]=0 _M_ME[2]=0 _M_ME[8]=0 _M_ME[9]=0
_M_SPE[16]=_Z_MP+_KUGDM/2 _M_SPE[10]=_M_SPE[16]+_M_SPE[3]
N5070 _ALARM=0
_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3] _M_ME[11]=_M_SPE[16]+_M_SPE[25]
IF(_INTERN[68] == 1)
_INTERN[68] = 0
_STRAIGHT_D = $P_TOOL MOD 2
_SIMULTAN = 1
_M_N_TMP = _M_N[0]
IF(_STRAIGHT_D == 1)
IF(_M_N[30] == 2)
_M_N[0] = 1
ENDIF
ELSE
IF(_STRAIGHT_D == 0)
IF(_M_N[30] == 2)
_M_N[0] = 2
ENDIF
ENDIF
ENDIF
ENDIF
N5080 CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_M_ME[13+_KUGWDH]=_M_ME[8] _M_ME[8]=SET(0,0) _M_ZUST[7]=1
IF (_KUGWDH==2)AND((_VB[17])OR(_VB[40])) GOTOF _M1115A
_KF[1,0]=(_M_ME[13+_KUGWDH]-_KUGDM/2)-_Z_MP _KF[0,0]=_OVR[3]-_KUGDM
IF((ABS(_KF[1,0]))>_M_SPE[32])OR((ABS(_KF[0,0]))>_M_SPE[32])
_ALARM=61303
GOTOF _Q99A
ENDIF
IF _M_ZUST[7]
_Z_MP=(_M_ME[13+_KUGWDH]-_KUGDM/2)
IF _INTERN[20+14]
_OVR[2]=_Z_MP
ELSE
_OVR[2]=_Z_MP-_HR[2]
ENDIF
GOTOF _M1115A
ENDIF
_M1115A:_Z_TPOS=_Z_MP-_HR[2] _Z_PPOS=_Z_MP+_KUGDM/2+_M_SPE[3]
IF _KUGWDH<2
_KUGWDH=_KUGWDH+1
IF _M_ZUST[10]
IF _HI[13]==0
IF _KUGWDH==1
IF _INTERN[40+18]
N800 CUST_MEACYC(3,(180 - _HR[11]),4)
ELSE
N803 SUPA SPOS=IC(180 - _HR[11])
ENDIF
ELSE
IF _KUGWDH==2
IF _INTERN[40+18]
N805 CUST_MEACYC(3,-(_HR[11]),4)
ELSE
N807 SUPA SPOS=IC(-(_HR[11]))
ENDIF
ENDIF
ENDIF
_VB[2]=0 _VB[3]=0
ELSE
_M_ZUST[4]=1
ENDIF
GOTOB _M4UW
ELSE
IF _HI[13]==0
_VB[2]=0
IF _KUGWDH==1
_M_SPE[8]=(((_M_SPE[8]+179.9) MOD 360)+360) MOD 360
ENDIF
ENDIF
GOTOB _MAXP2
ENDIF
ENDIF
IF _INTERN[20+14]
_M_SPE[16]=_SETV[0]/_M_SPE[29]
ELSE
_M_SPE[16]=(_SETV[0]/_M_SPE[29])-_HR[2]*_HI[6]
ENDIF
_KOR_TOOLL[0]=(_M_ME[13+_KUGWDH]-_M_SPE[16])*_M_SPE[52]
IF (ABS(_KOR_TOOLL[0])) < _M_SPE[32] GOTOF _M388
_OVR[22]=$P_ADT[3+(_M_N[17]-1)] _OVR[23]=_KOR_TOOLL[0]/_M_SPE[52] _OVR[1]=_OVR[22] _ALARM=61303
IF _SMI_R[10]
_ALARM=61447
GOTOF _FL8
ENDIF
GOTOF _Q99A
_M388:IF (ABS(_KOR_TOOLL[0])) < _M_SPE[33] GOTOF _M386
_OVR[22]=$P_ADT[3+(_M_N[17]-1)]
IF _VB[40]
_HR[9]=0 _HI[16]=1
ELSE
IF _VB[17]
_HR[9]=_KOR_TOOLL[0]
ENDIF
ENDIF
IF _INTERN[20+14]
_M_ME[8]=_HR[9] _M_N[28]=_M_N[28]+10 _OVR[2]=_M_SPE[16]-_KUGDM/2
ELSE
_M_ME[8]=(_HR[2]+_HR[9])*_HI_MIGEO[5] _OVR[2]=_M_SPE[16]-_KUGDM/2-(_HR[2]+_HR[9])
ENDIF
_M386: G0 G90
IF _VB[1] GOTOF _M387
N5100 G1 F=_M_SPE[2]
_M387:
IF _Z_PPOS < _M_SPE[7]
N5110 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
ENDIF
D=$P_TOOL DL=$P_DLNO
_HI[11]=_HR[12] MOD 100000
IF (_VB[17]==0)AND(_VB[40]==0)
_HI[11]=(_HI[11] DIV 100*100)+(_HI[11] MOD 100 B_OR 1 B_OR 2)+3000000
ELSE
IF _VB[40]
_HI[11]=(_HI[11] DIV 100*100)+3000007
ELSE
IF _VB[17]
_HI[11]=(_HI[11] DIV 100*100)+3000011
ENDIF
ENDIF
ENDIF
_Y85: _OVR[27]=_M_SPE[33] _OVR[28]=_OVR[28]/_M_SPE[29]
_OVR[20]=_M_SPE[27]*_HI_MIGEO[3] _OVR[21]=_M_SPE[28]*_HI_MIGEO[4] _OVR[4]=_M_SPE[20] _OVR[5]=0 _HI[1]=8 _HI[2]=1
_Q71: _OVR[_HI[1]]=_M_SPE[20+_HI[2]] _H_OVR[_HI[1]]=_M_SPE[20+_HI[2]] _OVR[_HI[1]+1]=0 _HI[1]=_HI[1]+2 _HI[2]=_HI[2]+1
IF _HI[1]<20 GOTOB _Q71
_HI[1]=8 _HI[2]=4
IF _VB[14]==0 GOTOF _Q73
IF _VB[22] AND((_VB[17])OR(_VB[40]))
_HI[3]=10
ELSE
_HI[3]=8
ENDIF
GOTOF _Q80
_Q73:
IF _VB[51]
_HI[1]=10+(2*_MD)+4*_AXIND _HI[2]=9+_MD-2*_AXIND
ELSE
_HI[1]=8+4*_AXIND _HI[2]=4+2*_AXIND
ENDIF
IF _VB[51] GOTOF _Q78 IF(_HI[10]<>3)AND(_VB[51]==0) GOTOF _Q76
_HI[1]=16 _HI[2]=4
_Q76: IF _VB[13] GOTOF _Q79
IF (_M_ZUST[1] XOR _M_ZUST[3]) GOTOF _Q78
_HI[1]=_HI[1]+2 _HI[2]=_HI[2]+1
_Q78: _HI[3]=1+_HI[2]
GOTOF _Q80
_Q79:_HI[3]=2+_HI[2]
_Q80:_HI[0]=_HI[1] _OVR[_HI[1]]=_M_ME[_HI[2]] _HI[1]=_HI[1]+2 _HI[2]=_HI[2]+1
IF _HI[2]<_HI[3] GOTOB _Q80
IF ((_VB[23]==1)AND(_HI_MIGEO[0]==1))OR((_MVAR==0)AND((_HI_MIGEO[0]==1)AND(_HI[10]==1)))
If (_VB[14]==0)AND(_HI[10]<>1) GOTOF _Q81
_TEMP=_OVR[8] _TEMP1=_OVR[10]
_OVR[8]=ABS(_TEMP1) _OVR[10]=ABS(_TEMP)
IF (_TEMP<0)
_OVR[8]=_OVR[8]*(-1)
ENDIF
IF (_TEMP1<=0)
_OVR[10]=_OVR[10]*(-1)
ENDIF
_Q81:
ENDIF
IF ((_VB[23]==1)AND(_HI_MIGEO[1]==1))OR((_MVAR==0)AND((_HI_MIGEO[1]==1)AND(_HI[10]==2)))
If (_VB[14]==0)AND(_HI[10]<>2) GOTOF _Q82
_TEMP=_OVR[12] _TEMP1=_OVR[14]
_OVR[12]=ABS(_TEMP1) _OVR[14]=ABS(_TEMP)
IF (_TEMP<0)
_OVR[12]=_OVR[12]*(-1)
ENDIF
IF (_TEMP1<=0)
_OVR[14]=_OVR[14]*(-1)
ENDIF
_Q82:
ENDIF
IF ((_MVAR==10000)AND(_HI_MIGEO[2]==1))OR((_MVAR==0)AND((_HI_MIGEO[2]==1)AND(_HI[10]==3)))
_TEMP=_OVR[16] _TEMP1=_OVR[18]
_OVR[16]=ABS(_TEMP1) _OVR[18]=ABS(_TEMP)
IF (_TEMP<0)
_OVR[16]=_OVR[16]*(-1)
ENDIF
IF (_TEMP1<=0)
_OVR[18]=_OVR[18]*(-1)
ENDIF
ENDIF
IF((_MVAR==10000)AND((_HI_MIGEO[2]==1)AND(_HI[10]==3)))OR(((_MVAR==0)OR((_VB[23]==1)AND(_VB[13]==0)AND(_VB[14]==0)))AND(((_HI_MIGEO[0]==1)AND(_HI[10]==1))OR((_HI_MIGEO[1]==1)AND(_HI[10]==2))OR((_HI_MIGEO[2]==1)AND(_HI[10]==3))))
_OVR[_HI[0]]=_H_OVR[_HI[0]]
ENDIF
_HI[1]=8 _HI[2]=9 _HI[3]=1 _HI[4]=_HI[3]
IF _VB[23] OR ((_VB[22])AND(_VB[17]==0)AND(_VB[40]==0))
_HI[4]=3
ELSE
IF _VB[22] AND((_VB[17])OR(_VB[40]))
_HI[4]=1
ENDIF
ENDIF
_Q85: _OVR[_HI[2]]=_OVR[_HI[1]]-_H_OVR[_HI[1]]
IF ABS(_OVR[_HI[2]])>_M_SPE[32]
_ALARM=61303
ENDIF
IF _ALARM GOTOF _Q99A IF _OVR[_HI[2]]==0 GOTOF _Q87A IF ABS(_OVR[_HI[2]])<_M_SPE[33] GOTOF _Q87A
IF (_M_N[18]==2) OR (_M_N[18]==4) GOTOF _Q87A
_M_SPE[20+_HI[3]]=_OVR[_HI[1]]
_Q87A: _HI[1]=_HI[1]+2 _HI[2]=_HI[2]+2 _HI[3]=_HI[3]+1 _HI[4]=_HI[4]+1
IF _HI[4]<7 GOTOB _Q85
IF _HI[15] OR _HI[16]
IF _HI[15]
_OVI[12]=SETTCOR(_KOR_TOOLL,"GW",0,3,_AXIND)
ELSE
_OVI[12]=SETTCOR(_KOR_TOOLL,"GW",0,3,2)
ENDIF
IF _OVI[12]<>0 GOTOF _FL12
_OVR[23]=_KOR_TOOLL[0]/_M_SPE[52] _OVR[22]=$P_ADT[3+(_M_N[15+_AXIND]-1)]
IF _HI[16]
_OVR[22]=$P_ADT[3+(_M_N[17]-1)] _OVR[1]=_OVR[22]
ENDIF
IF _PROTFORM[3]
_HI[7]=3+(_M_N[15+_AXIND]-1) _PROTVAL[25]=SET(""<<_M_SPE[13],""<<_M_SPE[12],""<<_M_SPE[11],"")
IF _HI[16]
_PROTVAL[29]="T,"<<($P_GG[6]+16)<<",,,"<<(3+(_M_N[17]-1))<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ENDIF
IF _HI[7]==3
_PROTVAL[25]="$TC_DP3["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_M_SPE[13]<<","<<_OVR[22] _PROTVAL[29]="T,"<<($P_GG[6]+16)<<",,,"<<"1"<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ELSE
IF _HI[7]==4
_PROTVAL[26]="$TC_DP4["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_M_SPE[12]<<","<<_OVR[22] _PROTVAL[29]="T,"<<($P_GG[6]+16)<<",,,"<<"2"<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ELSE
_PROTVAL[27]="$TC_DP5["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_M_SPE[11]<<","<<_OVR[22] _PROTVAL[29]="T,"<<($P_GG[6]+16)<<",,,"<<"3"<<","<<_M_N[10]<<",F"<<_M_SPE[0]
ENDIF
ENDIF
ENDIF
ENDIF
IF (_M_N[18]==2)OR(_M_N[18]==4) GOTOF _Q87
IF $MN_SCALING_SYSTEM_IS_METRIC==0
IF $P_GG[13]==4
_M_SPE[54]=_HI[11]+100000 +((_OVI[1] _DEC1)*10000000)
ELSE
_M_SPE[54]=_HI[11]+100000 +((_OVI[1] _DEC1)*10000000)
ENDIF
ELSE
IF $P_GG[13]==3
_M_SPE[54]=_HI[11] +((_OVI[1] _DEC1)*10000000)
ELSE
_M_SPE[54]=_HI[11] +((_OVI[1] _DEC1)*10000000)
ENDIF
ENDIF
_Q87:
IF(_SIMULTAN == 1)
_INTERN[68] = 1
_M_N[0] = _M_N_TMP
ENDIF
IF _VB[11]==1
IF _M_SPE[60] > 1
IF _VB[14]
_OVR[4]=(_OVR[8]-_OVR[10]+_OVR[12]-_OVR[14])/2
ELSE
IF _VB[13]
_OVR[4]=_OVR[8+4*_AXIND] - _OVR[10+4*_AXIND]
ELSE
_INTERN[20+15]=0
ENDIF
ENDIF
ELSE
IF _VB[14]
_OVR[4]=(ABS(_OVR[8])+ABS(_OVR[10])+ABS(_OVR[12])+ABS(_OVR[14]))/2
ELSE
IF _VB[13]
_OVR[4]=ABS(_OVR[8+4*_AXIND]) + ABS(_OVR[10+4*_AXIND])
ELSE
_INTERN[20+15]=0
ENDIF
ENDIF
ENDIF
IF _VB[51]==0
_OVR[5]=_OVR[4]-_M_SPE[20]
IF ABS(_OVR[5])<_M_SPE[33]
GOTOF _Q99A
ENDIF
IF (_M_N[18]<>2)AND(_M_N[18]<>4)
_M_SPE[20]=_OVR[4]
ENDIF
ELSE
_OVR[5]=_OVR[4]/2 - _HR[2] _M_SPE[20]=0
IF ABS(_OVR[5])<_M_SPE[33]
GOTOF _Q99A
ENDIF
ENDIF
IF _INTERN[20+15]
IF _PROTFORM[3]
_PROTVAL[25]=SET("","","","") _PROTVAL[29]="T,"<<($P_GG[6]+16)<<",,,4,"<<_M_N[10]<<",F"<<_M_SPE[0]
_PROTVAL[28]="$TC_DP6["<<$P_TOOLNO<<","<<$P_TOOL<<"],"<<_HR[2]<<","<<(_OVR[4]/2)
ENDIF
$P_ADT[6]=(_OVR[4]/2)*_HI[17] $P_ADT[15]=0
ENDIF
ENDIF
IF (_M_N[18]==2) OR (_M_N[18]==4) GOTOF _Q99A
$SNS_MEA_WP_BALL_DIAM[_M_N[1]]=_M_SPE[20] $SNS_MEA_WP_FEED[_M_N[1]]=_M_SPE[0]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX1[_M_N[1]]=_M_SPE[21] $SNS_MEA_WP_TRIG_PLUS_DIR_AX1[_M_N[1]]=_M_SPE[22]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX2[_M_N[1]]=_M_SPE[23] $SNS_MEA_WP_TRIG_PLUS_DIR_AX2[_M_N[1]]=_M_SPE[24]
$SNS_MEA_WP_TRIG_MINUS_DIR_AX3[_M_N[1]]=_M_SPE[25] $SNS_MEA_WP_TRIG_PLUS_DIR_AX3[_M_N[1]]=_M_SPE[26]
$SNS_MEA_WP_POS_DEV_AX1[_M_N[1]]=_M_SPE[27]*_HI_MIGEO[3] $SNS_MEA_WP_POS_DEV_AX2[_M_N[1]]=_M_SPE[28]*_HI_MIGEO[4]
$SNS_MEA_WP_STATUS_RT[_M_N[1]]=_M_SPE[53] $SNS_MEA_WP_STATUS_GEN[_M_N[1]]=_M_SPE[54]
N1350 D=$P_TOOL DL=$P_DLNO
_Q99A:
IF _ALARM
_OVI[9]=_ALARM+1000
ENDIF
IF _INTERN[2]
N1351 G90 AX[_XX]=_IW_C[0]*_M_SPE[29]
ENDIF
IF _INTERN[10]
N1352 AX[_YY]=_IW_C[1]*_M_SPE[29]
ENDIF
IF ((_M_N[28] MOD 10 ==0)OR(_M_N[28] MOD 10 ==2)OR((_M_N[28] MOD 10 ==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M122A
IF ((_M_N[28] MOD 10 ==0)OR(_M_N[28] MOD 10 ==2)OR((_M_N[28] MOD 10 ==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M122
IF ((_M_N[28] MOD 10 ==1)OR(_M_N[28] MOD 10 ==3)OR(_M_N[28] MOD 10 ==4))AND((_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N1153 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[5]=0 TO 29
_OVR[_HI[5]]=_OVR[_HI[5]]*_M_SPE[29]
ENDFOR
_OVR[24]=_OVR[24]/_M_SPE[29]
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28] MOD 10 ==1)OR(_M_N[28] MOD 10 ==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28] MOD 10 ==3) GOTOF _M121A IF _M_N[28] MOD 10 ==2 GOTOF _M122
G4 F8
N1160 _M121A: CYCLE102(0)
N1200 _M122:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[5]=0 TO 29
_OVR[_HI[5]]=_OVR[_HI[5]]*(1/_M_SPE[29])
ENDFOR
_OVR[24]=_OVR[24]*_M_SPE[29]
ENDIF
N1202 _M122A:
IF _ALARM
_OVI[9]=_ALARM
STOPRE
N697601 SETAL(_ALARM)
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==93101.901)
$P_CYCFRAME=CTRANS()
ELSE
$P_CYCFRAME=_TMP_SAVEFRAME
ENDIF
IF _HR[13]>0
F=_HR[13]
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[5]=0 TO 29
_OVR[_HI[5]]=_OVR[_HI[5]]*_M_SPE[52]
ENDFOR
ENDIF
M17
N697612 _ENDE: SETAL(62301)
M0
_GENDE: M17
_LOG_DEL_A:
IF _LOG_ON
WRITE(_TEMP2,_LOG_FILE,"; Calibration status deleted!")
WRITE(_TEMP2,_LOG_FILE,"; The following condition has changed since the last calibration:")
IF (_HR[12] _DEC3 <>$P_GG[6])
WRITE(_TEMP2,_LOG_FILE,"; Working plane")
ENDIF
IF (_HR[12] _DEC4 <>_INTERN[20+14])
WRITE(_TEMP2,_LOG_FILE,"; Length reference of probe")
ENDIF
IF (_HR[12] _DEC5 <>_VB[2])
WRITE(_TEMP2,_LOG_FILE,"; Probe type")
ENDIF
IF (($SNS_MEA_WP_FEED[_M_N[1]] < (_M_SPE[0]-(_TEMP1/_M_SPE[52]))) OR ($SNS_MEA_WP_FEED[_M_N[1]] > (_M_SPE[0]+(_TEMP1/_M_SPE[52]))))
WRITE(_TEMP2,_LOG_FILE,"; Measuring feed")
ENDIF
IF (_HR[12] _DEC8 == 3)
WRITE(_TEMP2,_LOG_FILE,"; L-Probe")
ENDIF
IF (_HR[12] _DEC8 <> _OVI[1] _DEC1)
WRITE(_TEMP2,_LOG_FILE,"; Probe type")
ENDIF
IF (_TEMP)
WRITE(_TEMP2,_LOG_FILE,"; Rotation or spindle position")
ENDIF
ENDIF
_LOG_DEL_E:
_FL1: STOPRE
_OVI[9]=61307
N697602 SETAL(_OVI[9])
M17
_FL2: STOPRE
_OVI[9]=61325
N697603 SETAL(_OVI[9])
M17
_FL3: STOPRE
_OVI[9]=61326
N697604 SETAL(_OVI[9])
M17
_FL7: STOPRE
_OVI[9]=61303
N697606 SETAL(_OVI[9])
M17
_FL9: STOPRE
_OVI[9]=61336
N697607 SETAL(_OVI[9])
M17
_FL10: STOPRE
_OVI[9]=61016
N697608 SETAL(_OVI[9])
M17
_FL11: STOPRE
_OVI[9]=61342
N697609 SETAL(_OVI[9])
M17
_FL12: STOPRE
_OVI[9]=61404
N697610 SETAL(_OVI[9])
M17
_FL13: STOPRE
_OVI[9]=61019
N697612 SETAL(_OVI[9],_SERR)
M17
_FL8: STOPRE
_OVI[9]=_ALARM
N697611 SETAL(_OVI[9])
M17
_FL14: STOPRE
_OVI[9]=_ALARM
N697614 SETAL(_OVI[9])
M17
_FL15: STOPRE
_OVI[9]=_ALARM
N697615 SETAL(_OVI[9])
M17
_FL16: STOPRE
_OVI[9]=_ALARM
N697615 SETAL(_OVI[9])
M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE977_SPF
PROC CYCLE977(INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_SETV0,REAL S_SETV1,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_ID,REAL S_SZA,REAL S_SZO,INT S_MA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_XM,REAL S_YM,INT _DP) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.001 ;DATE: 2024-01-12
;Cycle : workpiece, measure hole/shaft/groove/web/rectangle
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_ADD,_H_BOOL=0
N1010 DEF REAL _M_SPE[80],_M_ME[40],_HR[13],_IW_C[2],_DAT[3,6],_KF[3,3],_MEA_DIF[11],_H_SPE5,_H_SPE6,_H_SPE27,_H_SPE28,_H_SPE71,_H_SPE72,_H_SPE3_1,_H_SPE3_2,_H_ME[10],_CAL[12]
N1020 DEF INT _M_N[40],_ALARM,_MESSR,_AXIND,_HI[10],_HMA,_HMVAR,_H_SIM,_MODE
N1030 DEF AXIS _XX,_YY,_ZZ,_MAV,_ACHS[2]
N1033 DEF FRAME _TMP_SAVEFRAME
N1040 DEF INT _H_DMODE, _H_KNUM, _NEW_PAR=0, _CHBIT_S[32]
N1044 DEF STRING[40] _SERR
N1052 DEF INT _TEMP
N1053 DEF BOOL _TEMP_ON
N1054 DEF STRING[38] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE977_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE977_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE977("<<S_MVAR<<","<<S_KNUM<<","<<S_KNUM1<<","<<S_PRNUM<<","<<S_SETV<<","<<S_SETV0<<","<<S_SETV1<<","<<S_FA<<","<<S_TSA<<","<<S_STA1<<","<<S_ID<<","<<S_SZA<<","<<S_SZO<<","<<S_MA<<","<<S_NMSP<<","<<S_TNAME<<","<<S_DLNUM<<","<<S_TZL<<","<<S_TDIF<<","<<S_TUL<<","<<S_TLL<<","<<S_TMV<<","<<S_K<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _NEW_PAR=1 _M_SPE[3]=1
_CHBIT_S[4]=_CHBIT[4] _CHBIT_S[6]=_CHBIT[6] _CHBIT_S[8]=_CHBIT[8] _CHBIT_S[21]=_CHBIT[21]
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1)== 0) OR ((S_MVAR _DEC1)> 6) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 2) GOTOF _M_ERR
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 2 GOTOF _M_ERR
S_KNUM=ABS(S_KNUM) S_KNUM1=ABS(S_KNUM1)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 3
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM - 2000 + 50
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
GOTOF _HA2
_HA1:_M_N[14]=0
IF ((_H_KNUM _DEC1)== 2)
S_MVAR = S_MVAR - 200
_SERR=<<"(S_KNUM1: dec6)"
IF ((S_KNUM1 _DEC6) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1: dec7)"
IF ((S_KNUM1 _DEC7) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec8)"
IF ((S_KNUM1 _DEC8) > 1) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec9)"
IF ((S_KNUM1 _DEC9) > 1) GOTOF _M_ERR
_SERR=<<"(ST)"
IF (S_KNUM1 _DEC9)AND(_DP <=0) GOTOF _M_ERR
IF (((S_KNUM1 _DEC7) > 0) AND ((S_KNUM1 _DEC7) < 4))
_DLNUM = S_DLNUM
ELSE
_DLNUM = 0
ENDIF
_CHBIT[6]=0 _CHBIT[8]=0
IF (S_KNUM1 _DEC7) == 4
S_KNUM1 = S_KNUM1 - 4000000 _CHBIT[6]=1
ENDIF
_SERR=<<"(S_KNUM1 DNo > MD18105)"
IF (((S_KNUM1 _DEC5)*10000)+((S_KNUM1 _DEC4)*1000)+((S_KNUM1 _DEC3)*100)+((S_KNUM1 _DEC2)*10)+((S_KNUM1 _DEC1))>$MN_MM_MAX_CUTTING_EDGE_NO) GOTOF _M_ERA
IF ($MN_MM_MAX_CUTTING_EDGE_NO >= 1000)
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 - 10000000 _H_KNUM=_H_KNUM+10
ENDIF
IF (S_KNUM1 _DEC6) == 0
S_KNUM1 = S_KNUM1 + 200000
ELSE
S_KNUM1=S_KNUM1+((S_KNUM1 _DEC6)*10000000)-((S_KNUM1 _DEC6)*100000)
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC6)*100000)
ENDIF
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 2000000 + 100000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 3000000 + 100000000 _CHBIT[8]=1
ENDIF
IF ((_H_KNUM _DEC2)==1)
S_KNUM1 = S_KNUM1 + 1000000
ENDIF
ELSE
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC4)*1000)
ENDIF
IF (S_KNUM1 _DEC6) == 0
S_KNUM1 = S_KNUM1 + 2000
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 1000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 2000000 _CHBIT[8]=1
ENDIF
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 + 10000 - 10000000
ENDIF
IF (S_KNUM1 _DEC9)
S_KNUM1=S_KNUM1 - 100000000
_M_N[14]=_DP
ENDIF
ENDIF
_KNUM = S_KNUM1
ENDIF
_HA2:
IF (_H_KNUM==0)
S_MVAR=S_MVAR + 100 _KNUM=0
ENDIF
_MVAR=ABS(S_MVAR) _PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _SETV[0]=S_SETV0 _SETV[1]=S_SETV1 _FA=ABS(S_FA) _TSA=ABS(S_TSA)
S_ID=ABS(S_ID) S_ID=-S_ID
_KF[2,2]=S_STA1 _STA1=S_STA1 _ID=S_ID _SZA=S_SZA _SZO=S_SZO _MA=S_MA _HI[3]=1
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_AMODE = ABS(_AMODE)
_SERR=<<"(_AMODE: dec1)"
IF ((_AMODE _DEC1) > 1) GOTOF _M_ERR
_SERR=<<"(_AMODE: dec2)"
IF ((_AMODE _DEC2) > 1) GOTOF _M_ERR
IF (_AMODE _DEC1) == 1
_TZL=ABS(S_TZL) _TDIF=ABS(S_TDIF) _TUL=S_TUL _TLL=S_TLL _M_N[23]=_M_N[23]+100
ELSE
_TZL=0 _TUL=1.01*(ABS(S_TSA)) _TLL=-_TUL _TDIF=_TUL
ENDIF
_CHBIT[4]=0
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 20 GOTOF _M_ERR
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 0
_CHBIT[4]=1
_K = ABS(S_K)
_TMV=ABS(S_TMV)
ELSE
_TMV=ABS((_TUL - _TLL)/3) _K=1
ENDIF
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC2)*10) + (S_EVNUM _DEC1)) > 20 GOTOF _M_ERR
IF S_EVNUM<>0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(S_TNAME)"
IF _H_KNUM==2
IF (((_H_KNUM _DEC1)==2) AND (S_TNAME == "")) GOTOF _M_ERR
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B1') OR ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10')
_TNAME =<< S_TNAME _TNUM = 0
ELSE
_TNAME=<<"" _TNUM = NUMBER(S_TNAME)
ENDIF
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
_HI[3]=1 _KF[2,2]=_STA1 _M_SPE[3]=1
_ID=ABS(_ID) _ID=-_ID
ELSE
_HI[3]=_MVAR _DEC5 _MVAR=_MVAR MOD 10000 _ALARM=61307
IF _HI[3] > 1 GOTOF _M121
IF _HI[3]
_KF[2,2]=_STA1
IF _KF[2,2]==0
_HI[3]=0
ENDIF
ELSE
_KF[2,2]=0
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
_KF[2,2]=_KF[2,2] MOD 360
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N697701 SETAL(_ALARM,_SERR)
RET
_M_ERA: _ALARM=61021 _OVI[9]=_ALARM
STOPRE
N697702 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
IF _PRNUM _DEC3==1
_PRNUM = _PRNUM - 100
ENDIF
ENDIF
ENDIF
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M120
_ALARM=0
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
_OVI[2]=977
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1066 DIAMCYCOF G0 G90 G94
_HMA=_MA _HMVAR=_MVAR MOD 10000 _HI[0]=_HMVAR _DEC1 _HI[2]=0 _HR[0]=$P_ADT[1]
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HR[2]=$P_ADT[6]/2
ELSE
_HR[2]=$P_ADT[6]
ENDIF
IF _HI[3]== 1
_TMP_SAVEFRAME=$P_CYCFRAME
_INTERN[37]=1
IF _SMI_R[10]==93101.901
_SMI_R[10]=2
ENDIF
ENDIF
IF (_MVAR _DEC5 == 2)
_INTERN[40+13]=1 _VB[55]=1
ENDIF
IF _MVAR _DEC5 == 1
_VB[18]=1 _INTERN[40+13]=0
ENDIF
IF (_INTERN[40+13]==1)AND((_HR[0]==712)OR(_HR[0]==713)OR(_HR[0]==714))
_INTERN[40+13]=0
ENDIF
IF ((_HMVAR>=1)AND(_HMVAR<=6))OR(_HMVAR >=1001)AND(_HMVAR<=1006) GOTOF _M0
_VB[0]=1
IF ((_HMVAR>=101)AND(_HMVAR<=106))OR(_HMVAR >=1101)AND(_HMVAR<=1106) GOTOF _M0 IF _MVAR _DEC5 <=2 GOTOF _M0
_ALARM=61307
GOTOF _M121
_M0: CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_H_SPE27=_M_SPE[27] _H_SPE28=_M_SPE[28] _IW_C[0]=_M_SPE[5] _IW_C[1]=_M_SPE[6] _HI[1]=_M_SPE[54] MOD 100 _HI[5]=2
IF(_INTERN[68] == 1)
_H_SPE71=_M_SPE[71] _H_SPE72=_M_SPE[72] _HI[8]=_M_SPE[74] MOD 100
_ALARM=61341
IF _INTERN[20+16] AND(_VB[18]==0)AND((_HI[8] B_AND 'B0001'<>1)OR(_HI[8] B_AND 'B0010'<>2)) GOTOF _M121
ENDIF
IF (_HI[0]==5)OR(_HI[0]==6)
_M_ZUST[9]=1 _HI[2]=1 _HI[5]=0
ENDIF
_ALARM=61325
IF ((_HI[0]==3)OR(_HI[0]==4))AND((_MA<1)OR(_MA>2)) GOTOF _M121
_ALARM=61307
IF (_INTERN[18]==0)AND((_HMVAR>1000)OR(_HI[0]==2)OR(_HI[0]==4)OR(_HI[0]==6)) GOTOF _M121
_ALARM=61341
IF _INTERN[20+16] AND(_VB[18]==0)AND((_HI[1] B_AND 'B0001'<>1)OR(_HI[1] B_AND 'B0010'<>2)) GOTOF _M121
_ALARM=61336
IF (_INTERN[2]==0)AND(_INTERN[10]==0) GOTOF _M121 IF (_HI[0]<>3)AND(_HI[0]<>4) GOTOF _M01 IF (_INTERN[2+8*(_MA-1)]==0) GOTOF _M121
_M01:_ALARM=0
IF (_INTERN[2]==0)OR(_INTERN[10]==0)
IF (_HI[0]==1)OR(_HI[0]==2)
_HI[0]=_HI[0]+2
ELSE
IF (_HI[0]==5)OR(_HI[0]==6)
_HI[0]=_HI[0]-2 _M_ZUST[9]=0 _HI[2]=0
IF _INTERN[10]
_M_SPE[16]=_OVR[1]
ENDIF
ENDIF
ENDIF
IF _INTERN[2]
_HMA=1 _HI[5]=0
ELSE
_HMA=2 _HI[5]=2
ENDIF
ENDIF
IF _HMVAR _DEC4 ==1
_HI[4]=_M_SPE[54] _DEC6 _HR[8]=0.15
IF (_HI[4] == 1)
_HR[8] = _HR[8] / 25.4
ENDIF
IF(_MVAR _DEC5 ==1)AND(_VB[2]==0)
_M_SPE[20]=_HR[2]*2
IF(_INTERN[68] == 1)
_M_SPE[64]=_HR[2]*2
ENDIF
ENDIF
_M_ZUST[8]=1 _HR[0]=(_M_SPE[16]-ABS(_SZA)/_M_SPE[29])/2 _HR[1]=_HR[0] _ALARM=61334
IF (_INTERN[2]==0)AND(_INTERN[10])AND(_HMVAR MOD 10 >4)
_HR[0]=(_M_SPE[16]-ABS(_SZO)/_M_SPE[29])/2
ENDIF
IF _M_ZUST[9]
_HR[1]=(_M_SPE[16]-(_SETV[0]-_SETV[1]+ABS(_SZO))/_M_SPE[29])/2
ENDIF
IF (_HI[0]==2)OR(_HI[0]==4)OR(_HI[0]==6)
_HR[0]=-_HR[0] _HR[1]=-_HR[1] _M_ZUST[4]=1
ENDIF
IF _HR[0]<ABS(_M_SPE[3]+ABS(_M_SPE[20]))
_H_SPE3_1=_HR[0]- _M_SPE[20]
IF _H_SPE3_1 < (_HR[8]/_M_SPE[52]) GOTOF _M122
IF NOT(_M_ZUST[9])
_H_SPE3_2=_H_SPE3_1
ENDIF
ELSE
IF (_HI[0]==1)OR(_HI[0]==2)OR(_HI[0]==3)OR(_HI[0]==4)
_H_SPE3_1=_M_SPE[3] _H_SPE3_2=_H_SPE3_1
ELSE
_H_SPE3_1=_M_SPE[3]
ENDIF
ENDIF
IF _M_ZUST[9]
IF _HR[1]<ABS(_M_SPE[3]+ABS(_M_SPE[20]))
_H_SPE3_2=_HR[1]- _M_SPE[20]
IF _H_SPE3_2 < (_HR[8]/_M_SPE[52]) GOTOF _M122
ELSE
_H_SPE3_2=_M_SPE[3]
ENDIF
ENDIF
ELSE
_H_SPE3_1=_M_SPE[3] _H_SPE3_2=_H_SPE3_1
ENDIF
_OVR[0]=_M_SPE[16] _ALARM=0 _ACHS[0]=_XX _ACHS[1]=_YY _OVR[5]=SET(_M_SPE[5],_M_SPE[6])
IF _HI[0]<=4
_OVR[1]=_M_SPE[5] _OVR[2]=_M_SPE[6]
ELSE
_OVR[1]=_M_SPE[16]-(_SETV[0]-_SETV[1])/_M_SPE[29] _OVR[2]=_M_SPE[5] _OVR[3]=_M_SPE[6]
ENDIF
IF(_INTERN[68] == 1)
_OVR[100]=_M_SPE[16] _OVR[105]=SET(_M_SPE[5],_M_SPE[6])
IF _HI[0]<=4
_OVR[101]=_M_SPE[5] _OVR[102]=_M_SPE[6]
ELSE
_OVR[101]=_M_SPE[16]-(_SETV[0]-_SETV[1])/_M_SPE[29] _OVR[102]=_M_SPE[5] _OVR[103]=_M_SPE[6]
ENDIF
ENDIF
_IW_C[0]=_OVR[1+_HI[2]] _IW_C[1]=_OVR[2+_HI[2]] _M_ZUST[0]=1 _HI[1]=1
IF NOT((_HI[0]==3)OR(_HI[0]==4)) GOTOF _M6
_M_ZUST[6]=1 _HI[5]=0
IF _HI[0] == 3
_VB[20]=1
ENDIF
IF _HMA==1 GOTOF _M6
_M_ZUST[0]=0 _M_ZUST[2]=1 _AXIND=1 _HI[5]=2
_M6:IF (_HI[0]==3)OR(_HI[0]==5)OR(_HI[0]==1) GOTOF _M7
IF(_OVI[1]==710)OR(_OVI[1]==714)
_M_ZUST[4]=1 _HI[1]=-1 _INTERN[69]=1
ELSE
_M_ZUST[4]=1 _HI[1]=-1 _INTERN[69]=0
ENDIF
_M7:
IF (_MVAR _DEC5 == 2)AND(_VB[2]==0)
_VB[2]=1 _VB[3]=1 _INTERN[20+8]=0
IF (_M_SPE[27]==0)AND(_M_SPE[28]==0)
_M_SPE[27]=(_M_SPE[21]-ABS(_M_SPE[22]))/2 _M_SPE[28]=(_M_SPE[23]-ABS(_M_SPE[24]))/2
_M_SPE[21]=_M_SPE[21]-_M_SPE[27] _M_SPE[22]=_M_SPE[22]-_M_SPE[27] _M_SPE[23]=_M_SPE[23]-_M_SPE[28] _M_SPE[24]=_M_SPE[24]-_M_SPE[28]
ENDIF
_HR[7]=(ABS(_KF[2,2]+(_M_SPE[4] MOD 1000)))MOD 360 _HR[8]=(_M_SPE[23]-_M_SPE[21])/2
IF (_HR[7] > 90)
IF (_HR[7] >= 180)
_HR[7]= ABS(_HR[7])-180
IF (_HR[7] > 90)
_HR[7]=90-(ABS(90-(_HR[7])))
ENDIF
ELSE
_HR[7]=90-(ABS(90-(_HR[7])))
ENDIF
ENDIF
IF (_HI[0]==3)OR(_HI[0]==4)
_M_SPE[21]=SET(-(_M_SPE[22]+_M_SPE[27]),_M_SPE[22]+_M_SPE[27])
_M_SPE[23]=_M_SPE[21] _M_SPE[24]=_M_SPE[22]
ELSE
_M_SPE[23]=_M_SPE[23]-_HR[8]-(_HR[8]*SIN(_HR[7])) _M_SPE[24]=_M_SPE[24]+_HR[8]+(_HR[8]*SIN(_HR[7]))
_M_SPE[21]=SET(_M_SPE[21]-_M_SPE[27],_M_SPE[22]+_M_SPE[27],_M_SPE[23]-_M_SPE[27],_M_SPE[24]+_M_SPE[27])
ENDIF
_H_SPE27=0 _H_SPE28=0 _INTERN[40+13]=0 _INTERN[69]=0
IF(_INTERN[68] == 1)
IF (_M_SPE[71]==0)AND(_M_SPE[72]==0)
_M_SPE[71]=(_M_SPE[65]-ABS(_M_SPE[66]))/2 _M_SPE[72]=(_M_SPE[67]-ABS(_M_SPE[68]))/2
_M_SPE[65]=_M_SPE[65]-_M_SPE[71] _M_SPE[66]=_M_SPE[66]-_M_SPE[71] _M_SPE[67]=_M_SPE[67]-_M_SPE[72] _M_SPE[68]=_M_SPE[68]-_M_SPE[72]
ENDIF
; Kali.dat.versatz zwischen 1. und 2.Achse, bezueglich Startw. und ROT um Z verrechnen
_HR[9]=(ABS(_KF[2,2]+(_M_SPE[4] MOD 1000)))MOD 360 _HR[10]=(_M_SPE[67]-_M_SPE[65])/2
IF (_HR[9] > 90)
IF (_HR[9] >= 180)
_HR[9]= ABS(_HR[9])-180
IF (_HR[9] > 90)
_HR[9]=90-(ABS(90-(_HR[9])))
ENDIF
ELSE
_HR[9]=90-(ABS(90-(_HR[9])))
ENDIF
ENDIF
IF (_HI[0]==3)OR(_HI[0]==4)
_M_SPE[65]=SET(-(_M_SPE[66]+_M_SPE[71]),_M_SPE[66]+_M_SPE[71])
_M_SPE[67]=_M_SPE[65] _M_SPE[68]=_M_SPE[66]
ELSE
_M_SPE[67]=_M_SPE[67]-_HR[10]-(_HR[10]*SIN(_HR[9])) _M_SPE[68]=_M_SPE[68]+_HR[10]+(_HR[10]*SIN(_HR[9]))
_M_SPE[65]=SET(_M_SPE[65]-_M_SPE[71],_M_SPE[66]+_M_SPE[71],_M_SPE[67]-_M_SPE[71],_M_SPE[68]+_M_SPE[71])
ENDIF
_H_SPE71=0 _H_SPE72=0
ENDIF
ELSE
IF (_MVAR _DEC5 == 1)AND(_VB[2]==0)
_VB[3]=1 _M_SPE[27]=0 _M_SPE[28]=0 _H_SPE27=0 _H_SPE28=0 _M_N[20]=1 _INTERN[20+8]=0 _OVI[5]=0
_M_SPE[21]=SET(_HR[2],-_HR[2],_HR[2],-_HR[2]) _M_SPE[8]=(((_M_SPE[8]+179.999)MOD 360)+360)MOD 360
IF(_INTERN[68] == 1)
_M_SPE[71]=0 _M_SPE[72]=0 _H_SPE71=0 _H_SPE72=0
_M_SPE[65]=SET(_HR[2],-_HR[2],_HR[2],-_HR[2])
ENDIF
ENDIF
ENDIF
_M_SPE[5]=_M_SPE[5]+_M_SPE[27] _M_SPE[6]=_M_SPE[6]+_M_SPE[28]
_M_SPE[17]=_M_SPE[17]+_M_SPE[27]*_DAT[0,1]+_M_SPE[28]*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_M_SPE[27]*_DAT[0,2]+_M_SPE[28]*_DAT[1,2]
_M_SPE[19]=_M_SPE[19]+_M_SPE[27]*_DAT[0,3]+_M_SPE[28]*_DAT[1,3]
IF _VB[1]==0
G1 F=_M_SPE[1]
ENDIF
N1079 G90 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
IF _INTERN[2]
N1080 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF _INTERN[10]
N1090 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
N1100 _M9:_MAV=_ACHS[_AXIND] _MESSR=-1
IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _M92
_MESSR=1
_M92:
IF (_M_ZUST[0] OR _M_ZUST[1])AND(_M_ZUST[2]==0)AND(_M_ZUST[3]==0)
_M_SPE[3]=_H_SPE3_1
ENDIF
IF (_M_ZUST[2] OR _M_ZUST[3])AND(_M_ZUST[0]==0)AND(_M_ZUST[1]==0)
_M_SPE[3]=_H_SPE3_2
ENDIF
_HR[1]=(_M_SPE[16]/2-(_HR[2]+_M_SPE[3])*_HI[1])*_MESSR _M_SPE[10]=_M_SPE[5+_AXIND] -_HR[1]*_HI[1]
_M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR
IF _M_ZUST[4] GOTOF _M94 IF ((_MESSR==-1)AND(_M_SPE[10]>_M_SPE[5+_AXIND]))OR((_MESSR==1)AND(_M_SPE[10]<_M_SPE[5+_AXIND])) GOTOF _M94
_M_SPE[10]=_M_SPE[5+_AXIND]
_M94:_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR
IF((_M_SPE[9]+ _HR[2])>(_M_SPE[16]/2))AND(_M_SPE[60]==1)AND(_HI[7]==0)AND(_M_ZUST[4]==0)
_HI[7]=1
ENDIF
IF _HI[7]
_M_SPE[9]=(-(_M_SPE[16]/2 - _HR[2]))*_MESSR
IF _M_SPE[16]/2 <= _HR[2]
_ALARM=61006
GOTOF _M119A
ENDIF
ENDIF
N1110 _M95: CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _VB[18]==1
_VB[3]=0
ENDIF
IF (_M_ZUST[4]==0)AND(_M_ZUST[8]==0) GOTOF _M96
IF _INTERN[40+16] AND _INTERN[40+2]
N1115 F=$MA_MAX_AX_VELO[_ZZ]*_M_N[14]/100
ELSE
N1116 F=_M_SPE[2]
ENDIF
N1120 G91 AX[_ZZ]=-_ID
_M96:_M_ME[0]=_M_ME[8] _M_ME[8]=SET(0,0)
IF(_INTERN[68] == 1)
_M_ME[20]=_M_ME[28]
_H_ME[0]=_M_ME[29] _M_ME[28]=SET(0,0)
ENDIF
IF _M_ZUST[0] GOTOF _MPKT1 IF _M_ZUST[1] GOTOF _MPKT2 IF _M_ZUST[2] GOTOF _MPKT3 IF _M_ZUST[3] GOTOF _MPKT4
_MPKT1:_M_ZUST[0]=0 _M_ZUST[1]=1 _M_ME[4]=_M_ME[0]-(_M_SPE[22]+_H_SPE27) _M_ME[12+_HI[6]]=_M_ME[0]
IF _VB[48]
_M_ME[4]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 +_H_SPE27)
ENDIF
IF _M_N[18]
_M_ME[4]=_M_ME[11]-_HR[2]*_MESSR
ENDIF
IF(_INTERN[68] == 1)
_M_ME[24]=_M_ME[20]-(_M_SPE[66]+_H_SPE71) _M_ME[32+_HI[6]]=_M_ME[20]
IF _VB[48]
_M_ME[24]=_M_ME[20]-(_M_SPE[64]*_MESSR/2 +_H_SPE71)
ENDIF
IF _M_N[18]
_M_ME[24]=_M_ME[31]-_HR[2]*_MESSR
ENDIF
_H_ME[4]=_H_ME[0]
ENDIF
IF _MVAR _DEC5 == 2
N1170 G91 AX[_YY]=-(_M_SPE[28]*2)
ENDIF
IF (_INTERN[40+16]==0)OR(_INTERN[40+2]==0) GOTOB _M9
F=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_XX]>$MA_MAX_AX_VELO[_YY]
F=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
N1121 G90 G60 AX[_MAV]=_M_SPE[5+_AXIND]*_M_SPE[29]
GOTOB _M9
_MPKT2:_M_ZUST[1]=0 _M_ZUST[2]=1 _M_ME[5]=_M_ME[0]-(_M_SPE[21]+_H_SPE27) _M_ME[13+_HI[6]]=_M_ME[0]
IF _VB[48]
_M_ME[5]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 +_H_SPE27)
ENDIF
IF _M_N[18]
_M_ME[5]=_M_ME[0]-_HR[2]*_MESSR
ENDIF
_AXIND=1 _OVR[5]=(_M_ME[4]+_M_ME[5])/2 _HR[4]=_OVR[5]+_M_SPE[27]-_M_SPE[5] _M_SPE[5]=_OVR[5]+_M_SPE[27]
_M_SPE[17]=_M_SPE[17]+_HR[4]*_DAT[0,1] _M_SPE[18]=_M_SPE[18]+_HR[4]*_DAT[0,2] _M_SPE[19]=_M_SPE[19]+_HR[4]*_DAT[0,3]
IF(_INTERN[68] == 1)
_M_ME[25]=_M_ME[20]-(_M_SPE[65]+_H_SPE71) _M_ME[33+_HI[6]]=_M_ME[20]
IF _VB[48]
_M_ME[25]=_M_ME[20]-(_M_SPE[64]*_MESSR/2 +_H_SPE71)
ENDIF
IF _M_N[18]
_M_ME[25]=_M_ME[20]-_HR[2]*_MESSR
ENDIF
_OVR[105]=(_M_ME[24]+_M_ME[25])/2 _H_SPE5=_OVR[105]+_M_SPE[71]
_H_ME[5]=_H_ME[0]
ENDIF
IF _INTERN[40+16] AND _INTERN[40+2]
N1125 F=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_XX]>$MA_MAX_AX_VELO[_YY]
F=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
ELSE
N1126 F=_M_SPE[1]
ENDIF
IF _MVAR _DEC5 == 2
N1127 G90 AX[_XX]=(_M_SPE[5]-_M_SPE[27]-_M_SPE[28])*_M_SPE[29]
ELSE
N1128 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF _M_ZUST[6] GOTOF _M102 IF _M_ZUST[9]==0 GOTOB _M9
_M_SPE[16]=_OVR[1]
GOTOB _M9
_MPKT3:_M_ZUST[2]=0 _M_ZUST[3]=1 _M_ME[6]=_M_ME[0]-(_M_SPE[24]+_H_SPE28) _M_ME[14+_HI[6]]=_M_ME[0]
IF _VB[48]
_M_ME[6]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 +_H_SPE28)
ENDIF
IF _M_N[18]
_M_ME[6]=_M_ME[0]-_HR[2]*_MESSR
ENDIF
IF(_INTERN[68] == 1)
_M_ME[26]=_M_ME[20]-(_M_SPE[68]+_H_SPE72) _M_ME[34+_HI[6]]=_M_ME[20]
IF _VB[48]
_M_ME[26]=_M_ME[20]-(_M_SPE[64]*_MESSR/2 +_H_SPE72)
ENDIF
IF _M_N[18]
_M_ME[26]=_M_ME[20]-_HR[2]*_MESSR
ENDIF
_H_ME[6]=_H_ME[0]
ENDIF
IF (_MVAR _DEC5 == 2)
N1170 G91 AX[_XX]=_M_SPE[28]*2
ENDIF
IF (_INTERN[40+16]==0)OR(_INTERN[40+2]==0) GOTOB _M9
F=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_XX]>$MA_MAX_AX_VELO[_YY]
F=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
N1130 G90 G60 AX[_MAV]=_M_SPE[5+_AXIND]*_M_SPE[29]
GOTOB _M9
_MPKT4:_M_ME[7]=_M_ME[0]-(_M_SPE[23]+_H_SPE28) _M_ME[15+_HI[6]]=_M_ME[0]
IF _VB[48]
_M_ME[7]=_M_ME[0]-(_M_SPE[20]*_MESSR/2+ _H_SPE28)
ENDIF
IF _M_N[18]
_M_ME[7]=_M_ME[11]-_HR[2]*_MESSR
ENDIF
_OVR[6]=(_M_ME[6]+_M_ME[7])/2 _HR[4]=_OVR[6]+_M_SPE[28]-_M_SPE[6] _M_SPE[6]=_OVR[6]+_M_SPE[28]
_M_SPE[17]=_M_SPE[17]+_HR[4]*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_HR[4]*_DAT[1,2] _M_SPE[19]=_M_SPE[19]+_HR[4]*_DAT[1,3]
IF(_INTERN[68] == 1)
_M_ME[27]=_M_ME[20]-(_M_SPE[67]+_H_SPE72) _M_ME[35+_HI[6]]=_M_ME[20]
IF _VB[48]
_M_ME[27]=_M_ME[20]-(_M_SPE[64]*_MESSR/2+ _H_SPE72)
ENDIF
IF _M_N[18]
_M_ME[27]=_M_ME[31]-_HR[2]*_MESSR
ENDIF
_OVR[106]=(_M_ME[26]+_M_ME[27])/2 _H_SPE6=_OVR[106]+_M_SPE[72]
_H_ME[7]=_H_ME[0]
ENDIF
IF _INTERN[40+16] AND _INTERN[40+2]
N1140 F=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_XX]>$MA_MAX_AX_VELO[_YY]
N1141 F=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
ELSE
N1142 F=_M_SPE[1]
ENDIF
N1143 G90 AX[_YY]=_M_SPE[6]*_M_SPE[29]
_M102:
IF _VB[18]==1
IF _VB[26]==0
_M_ZUST[7]=0 _HI[6]=4 _VB[26]=1 _MEA_DIF[0]=SET(_M_SPE[5],_M_SPE[6])
IF(_INTERN[68] == 1)
_MEA_DIF[7]=SET(_H_SPE5,_H_SPE6)
ENDIF
IF (_M_ZUST[6])AND(_HMA==2)
_M_ZUST[0]=SET(0,0,1,0)
ELSE
_M_ZUST[0]=SET(1,0,0,0) _AXIND=0
ENDIF
IF _KF[2,2]+ _M_SPE[61] < 0
_HR[5]= 180.001
ELSE
_HR[5]= -179.999
ENDIF
IF _INTERN[40+18]
N2000 CUST_MEACYC(3,_HR[5],4)
ELSE
N2001 SUPA SPOS=IC(_HR[5])
ENDIF
_M_SPE[16]=_OVR[0]
GOTOB _M9
ELSE
_MEA_DIF[2]=SET(_M_SPE[5],_M_SPE[6])
_OVR[4]=(((ABS(_M_ME[12+_HI[5]]-_M_ME[13+_HI[5]]))+(ABS(_M_ME[16+_HI[5]]-_M_ME[17+_HI[5]])))/2)+(_HR[2]*2*_HI[1])
IF _M_ZUST[9]
_OVR[6]=_MEA_DIF[0]-((_MEA_DIF[0]-_MEA_DIF[2])/2) _OVR[7]=_MEA_DIF[1]-((_MEA_DIF[1]-_MEA_DIF[3])/2)
_OVR[5]=(((ABS(_M_ME[14]-_M_ME[15]))+(ABS(_M_ME[18]-_M_ME[19])))/2)+(_HR[2]*2*_HI[1])
_M_SPE[16]=(_M_SPE[16]*_M_SPE[29]-_SETV[1]+_SETV[0])/_M_SPE[29]
ELSE
IF _M_ZUST[6]
IF _HMA==1
_OVR[5]=_MEA_DIF[0]-((_MEA_DIF[0]-_MEA_DIF[2])/2)_OVR[6]=0 _OVR[2]=0
ELSE
_OVR[6]=_MEA_DIF[1]-((_MEA_DIF[1]-_MEA_DIF[3])/2) _OVR[5]=0 _OVR[1]=0
ENDIF
ELSE
_OVR[5]=_MEA_DIF[0]-((_MEA_DIF[0]-_MEA_DIF[2])/2) _OVR[6]=_MEA_DIF[1]-((_MEA_DIF[1]-_MEA_DIF[3])/2)
ENDIF
ENDIF
IF(_INTERN[68] == 1)
_MEA_DIF[9]=SET(_H_SPE5,_H_SPE6)
_OVR[104]=(((ABS(_M_ME[32+_HI[5]]-_M_ME[33+_HI[5]]))+(ABS(_M_ME[36+_HI[5]]-_M_ME[37+_HI[5]])))/2)+(_HR[2]*2*_HI[1])
IF _M_ZUST[9]
_OVR[106]=_MEA_DIF[7]-((_MEA_DIF[7]-_MEA_DIF[9])/2) _OVR[107]=_MEA_DIF[8]-((_MEA_DIF[8]-_MEA_DIF[10])/2)
_OVR[105]=(((ABS(_M_ME[34]-_M_ME[35]))+(ABS(_M_ME[38]-_M_ME[39])))/2)+(_HR[2]*2*_HI[1])
_M_SPE[16]=(_M_SPE[16]*_M_SPE[29]-_SETV[1]+_SETV[0])/_M_SPE[29]
ELSE
IF _M_ZUST[6]
IF _HMA==1
_OVR[105]=_MEA_DIF[7]-((_MEA_DIF[7]-_MEA_DIF[9])/2)_OVR[106]=0 _OVR[102]=0
ELSE
_OVR[106]=_MEA_DIF[8]-((_MEA_DIF[8]-_MEA_DIF[10])/2) _OVR[105]=0 _OVR[101]=0
ENDIF
ELSE
_OVR[105]=_MEA_DIF[7]-((_MEA_DIF[7]-_MEA_DIF[9])/2) _OVR[106]=_MEA_DIF[8]-((_MEA_DIF[8]-_MEA_DIF[10])/2)
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _M_ZUST[9]
_OVR[4]=ABS(_M_ME[4]-_M_ME[5]) _OVR[5]=ABS(_M_ME[6]-_M_ME[7]) _OVR[6]=(_M_ME[4]+_M_ME[5])/2 _OVR[7]=(_M_ME[6]+_M_ME[7])/2
_M_SPE[16]=(_M_SPE[16]*_M_SPE[29]-_SETV[1]+_SETV[0])/_M_SPE[29]
ELSE
IF _M_ZUST[6]
_OVR[4]=ABS(_M_ME[6]-_M_ME[7])
IF _HMA==1
_OVR[4]=ABS(_M_ME[4]-_M_ME[5]) _OVR[6]=0 _OVR[2]=0
ELSE
_OVR[5]=0 _OVR[1]=0
ENDIF
ELSE
_OVR[4]=ABS(_M_ME[6]-_M_ME[7])
ENDIF
ENDIF
IF(_INTERN[68] == 1)
IF _M_ZUST[9]
_OVR[104]=ABS(_M_ME[24]-_M_ME[25]) _OVR[105]=ABS(_M_ME[26]-_M_ME[27]) _OVR[106]=(_M_ME[24]+_M_ME[25])/2 _OVR[107]=(_M_ME[26]+_M_ME[27])/2
ELSE
IF _M_ZUST[6]
_OVR[104]=ABS(_M_ME[26]-_M_ME[27])
IF _HMA==1
_OVR[104]=ABS(_M_ME[24]-_M_ME[25]) _OVR[106]=0 _OVR[102]=0
ELSE
_OVR[105]=0 _OVR[101]=0
ENDIF
ELSE
_CAL[0]=4 _CAL[1]=_M_ME[24] _CAL[2]=_H_ME[4] _CAL[3]=_M_ME[25] _CAL[4]=_H_ME[5] _CAL[5]=_H_ME[6] _CAL[6]=_M_ME[26] _CAL[7]=_H_ME[7] _CAL[8]=_M_ME[27]
CYCLE116(_CAL,_MODE)
_OVR[104]=_CAL[11]*2
ENDIF
ENDIF
ENDIF
ENDIF
IF(_INTERN[68] == 1)
IF _HI[0]<=4
_HR[11]=((_OVR[5]-_OVR[105]) * COS(-_KF[2,2])) + ((_OVR[6]-_OVR[106]) * SIN(-_KF[2,2]))
_HR[12]=((_OVR[6]-_OVR[106]) * COS(-_KF[2,2])) - ((_OVR[5]-_OVR[105]) * SIN(-_KF[2,2]))
ELSE
_HR[11]=((_OVR[6]-_OVR[106]) * COS(-_KF[2,2])) + ((_OVR[7]-_OVR[107]) * SIN(-_KF[2,2]))
_HR[12]=((_OVR[7]-_OVR[107]) * COS(-_KF[2,2])) - ((_OVR[6]-_OVR[106]) * SIN(-_KF[2,2]))
ENDIF
ENDIF
_M_ZUST[7]=1 _M_ZUST[0]=SET(1,0,0,0) _AXIND=0
IF _M_ZUST[6]==0 GOTOF _M103 IF _HMA==1 GOTOF _M103
_M_ZUST[0]=0 _M_ZUST[2]=1 _AXIND=1
_M103: _OVI[6]=SET(0,_M_N[22] MOD 10000)
IF ((_SMI_R[10]==0)OR(_SMI_R[10]==2)OR(_SMI_R[10]==11))AND(_HI[3]== 1)
IF _HI[0]<=4
_IW_C[0]=SET(_OVR[5],_OVR[6])
N1145 G90 AX[_XX]=_IW_C[0]*_M_SPE[29]
N1146 G90 AX[_YY]=_IW_C[1]*_M_SPE[29]
ELSE
_IW_C[0]=SET(_OVR[6],_OVR[7])
N1148 G90 AX[_XX]=_IW_C[0]*_M_SPE[29]
N1149 G90 AX[_YY]=_IW_C[1]*_M_SPE[29]
ENDIF
IF _SMI_R[10]==11
$P_CYCFRAME=_TMP_SAVEFRAME
ELSE
$P_CYCFRAME=CTRANS()
ENDIF
IF _HI[0]<=4
_OVR[5]=SET($AA_IW[_XX],$AA_IW[_YY]) _OVR[1]=SET(_M_SPE[40],_M_SPE[41])
IF ((_AMODE _DEC2) ==1)AND _VB[0] AND _KNUM
IF _HI[0] >=3
IF _MA==1
_OVR[1]=SET(S_XM,_M_SPE[41])
ELSE
_OVR[1]=SET(_M_SPE[40],S_XM)
ENDIF
_NEW_PAR=2
ELSE
_OVR[1]=SET(S_XM,S_YM)
ENDIF
ELSE
_OVR[1]=SET(_M_SPE[40],_M_SPE[41])
ENDIF
ELSE
_OVR[6]=SET($AA_IW[_XX],$AA_IW[_YY]) _OVR[2]=SET(_M_SPE[40],_M_SPE[41])
IF ((_AMODE _DEC2) ==1)AND _VB[0] AND _KNUM
_OVR[2]=SET(S_XM,S_YM)
ELSE
_OVR[2]=SET(_M_SPE[40],_M_SPE[41])
ENDIF
ENDIF
IF(_INTERN[68] == 1)
IF _HI[0]<=4
_OVR[105]=SET($AA_IW[_XX]-_HR[11],$AA_IW[_YY]-_HR[12]) _OVR[101]=SET(_M_SPE[40],_M_SPE[41])
ELSE
_OVR[106]=SET($AA_IW[_XX]-_HR[11],$AA_IW[_YY]-_HR[12]) _OVR[102]=SET(_M_SPE[40],_M_SPE[41])
ENDIF
ENDIF
ENDIF
IF _VB[0] GOTOF _M104
IF _M_N[22]>9999
_OVI[6]=_M_N[22] DIV 10000
ELSE
_OVI[6]=_OVI[7]
ENDIF
_M104: IF _OVI[7]==0 GOTOF _M107
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF _INTERN[40+5]==0 GOTOF _M106
_HR[0]=-_HR[0]
_M106:_OVR[4]=_OVR[4]-_HR[0]
IF _HI[0]<=4 GOTOF _M107
_OVR[5]=_OVR[5]-_HR[0]
_M107:_OVR[16]=SET(_OVR[4]-_OVR[0],_OVR[5]-_OVR[1],_OVR[6]-_OVR[2]) _ALARM=61303
IF _HI[2]
_OVR[19]=_OVR[7]-_OVR[3]
ENDIF
IF(_INTERN[68] == 1)
_OVR[116]=SET(_OVR[104]-_OVR[100],_OVR[105]-_OVR[101],_OVR[106]-_OVR[102])
IF _HI[2]
_OVR[119]=_OVR[107]-_OVR[103]
ENDIF
FOR _HI[0]=0 TO 29
_OVR[900+_HI[0]]=(_OVR[+_HI[0]]+_OVR[100+_HI[0]])/2
ENDFOR
ENDIF
_ALARM=0
IF (_VB[0] == 0)
IF (ABS(_OVR[16])>_M_SPE[32]) OR ((_HI[2])AND(ABS(_OVR[17])>_M_SPE[32]))
_ALARM=61303
ENDIF
IF (_SMI_R[10]==0)AND(_HI[3]==0)
_IW_C[0]=_OVR[5+_HI[2]] _IW_C[1]=_OVR[6+_HI[2]]
ENDIF
IF ((ABS(_OVR[16])>_M_SPE[34]) OR ((_HI[2])AND(ABS(_OVR[17])>_M_SPE[34])) AND (_ALARM <> 61303))
_ALARM=61306
ENDIF
ELSE
IF (ABS(_OVR[17+_HI[2]])>_M_SPE[32]) OR (ABS(_OVR[18+_HI[2]])>_M_SPE[32])
_ALARM=61303
ENDIF
IF (_SMI_R[10]==0)AND(_HI[3]==0)
IF (_KNUM > 0)AND(_KNUM < 100)
_HI[4]=_KNUM+1
ELSE
_HI[4]=1
IF NOT(_KNUM)
_HI[4]=0
ENDIF
ENDIF
_IW_C[0]=_OVR[5+_HI[2]] _IW_C[1]=_OVR[6+_HI[2]]
ENDIF
IF ((_AMODE _DEC2 == 1) AND ((S_XM <> _M_SPE[40]) OR (S_YM <> _M_SPE[41])))
_ALARM = 0
ENDIF
ENDIF
IF (_ALARM == 61303) OR (_ALARM == 61306)
IF _INTERN[20+0] AND (_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]
N1162 SETAL(_ALARM+1000)
N1163 M0
STOPRE
ENDIF
_M_ZUST[7]=0 _ALARM=0
IF ((_SMI_R[10]==0)OR(_SMI_R[10]==11))AND(_HI[3]== 1)
$P_CYCFRAME=$P_CYCFRAME:CTRANS(_XX,$AA_IW[_XX],_YY,$AA_IW[_YY]):CROT(_ZZ,_KF[2,2])
ENDIF
ENDIF
ENDIF
IF _M_ZUST[7]==0 GOTOB _M9
_OVR[28]=_OVR[28]/_M_SPE[29]
IF(_INTERN[68] == 1)
_OVR[128]=_OVR[128]/_M_SPE[29]
ENDIF
IF (_ALARM AND _VB[0]) GOTOF _M125
IF (_VB[0] == 0)
_OVR[20]=_OVR[16] _OVI[4]=_M_N[23] MOD 100 _OVR[8]=_M_SPE[35]/_M_SPE[29] _OVR[12]=_M_SPE[36]/_M_SPE[29] _OVI[0]=_M_N[11] _OVR[29]=_M_SPE[34] _OVR[27]=_M_SPE[33]
IF _M_ZUST[9]
_OVR[20]=(_OVR[16]+_OVR[17])/2
ENDIF
IF(_INTERN[68] == 1)
_OVR[120]=_OVR[116] _OVR[108]=_M_SPE[35]/_M_SPE[29] _OVR[112]=_M_SPE[36]/_M_SPE[29] _OVR[129]=_M_SPE[34] _OVR[127]=_M_SPE[33]
IF _M_ZUST[9]
_OVR[120]=(_OVR[116]+_OVR[117])/2
ENDIF
ENDIF
IF _ALARM GOTOF _M125
IF (ABS(_OVR[20])>_M_SPE[15]) OR ((_HI[2])AND (ABS(_OVR[17])>_M_SPE[15]))
IF (_M_ZUST[4]AND(_OVR[4]>_OVR[0]))OR((_M_ZUST[4]==0)AND(_OVR[4]<_OVR[0]))
_ALARM=61304
ELSE
_ALARM=61305
ENDIF
ENDIF
_MY7: CYCLE114(2,_ALARM,_MAV,0,_M_SPE[37],_M_N[23],_INTERN[40+4],_H_BOOL)
IF _H_BOOL==0
IF (ABS(_OVR[20]) <= _M_SPE[33])
CYCLE114(4,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
GOTOF _M118
ENDIF
ENDIF
IF (_M_ZUST[4] <> 0)
_OVR[20]=-_OVR[20]
ENDIF
_OVR[20]=_OVR[20]/2
IF ((_INTERN[20+2]==0)OR((_INTERN[20+2]==1)AND(_ALARM<>61304)AND(_ALARM<>61305)))
CYCLE114(3,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
GOTOF _M125
_M118:
IF (_OVI[6] <> 0)
IF _INTERN[40+4]==1
_MV[_OVI[6]-1]=_OVR[20] _OVR[31]=_OVR[20] $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=_OVR[20]
ELSE
_MV[_OVI[6]-1]=0 _OVR[31]=0 $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=0
ENDIF
ENDIF
_OVR[20]=0
GOTOF _M125
ENDIF
IF _KNUM==0 GOTOF _M119A
_OVI[0]=_KNUM
IF (_INTERN[40+21]==0)
_ADD=1
ELSE
_ADD=0
ENDIF
CYCLE115(_ALARM,_MAV,_ADD,_NEW_PAR)
_M119A: IF _ALARM==0 GOTOF _M125
STOPRE
_M120:_OVI[9]=_ALARM
N697720 SETAL(_ALARM)
STOPRE
_M121:_OVI[9]=_ALARM
N697721 SETAL(_ALARM)
STOPRE
_M122:_OVI[9]=_ALARM
N697722 SETAL(_ALARM)
STOPRE
_M123:_OVI[9]=_ALARM
N697723 SETAL(_ALARM)
STOPRE
_M124:_OVI[9]=_ALARM
N697724 SETAL(_ALARM)
STOPRE
_M125:_OVI[9]=_ALARM
IF ((_ALARM < 61303) OR (_ALARM > 61306)) AND (_ALARM <> 0)
STOPRE
N697725 SETAL(_ALARM)
_M130: M0
STOPRE
N697726 SETAL(61327)
GOTOB _M130
ENDIF
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF (_SMI_R[10]==0)AND(_HI[3]==0)
IF(($P_GG[8] ==_HI[4])OR(_KNUM==9999))AND(_SMI_R[10]==0)
_IW_C[0]=SET(_M_SPE[5],_M_SPE[6])
ELSE
_IW_C[0]=SET(_M_SPE[40],_M_SPE[41])
ENDIF
IF (_INTERN[2])AND((_M_ZUST[6]==0)OR((_M_ZUST[6]==1)AND(_MA==1)))
N1150 G90 AX[_XX]=_IW_C[0]*_M_SPE[29]
ENDIF
IF (_INTERN[10])AND((_M_ZUST[6]==0)OR((_M_ZUST[6]==1)AND(_MA==2)))
N1151 G90 AX[_YY]=_IW_C[1]*_M_SPE[29]
ENDIF
ELSE
IF _ALARM
N1157 G90 AX[_XX]=_M_SPE[40]*_M_SPE[29]
N1159 G90 AX[_YY]=_M_SPE[41]*_M_SPE[29]
ENDIF
ENDIF
_PROTVAL[29] = _PROTVAL[29] <<"F"<<_M_SPE[0]
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M129
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M128
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N1153 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
IF(_INTERN[68] == 1)
FOR _HI[0]=100 TO 129
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
_OVR[800+_HI[0]]=_OVR[800+_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF NOT(((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3))
IF _M_N[28]==2 GOTOF _M128
G4 F8
ENDIF
CYCLE102(0)
N1162 _M128:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
IF(_INTERN[68] == 1)
FOR _HI[0]=100 TO 129
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
_OVR[800+_HI[0]]=_OVR[800+_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
ENDIF
N1163 _M129:
IF _ALARM
STOPRE
_OVI[9]=_ALARM
IF (_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF (_ALARM > 61303)
IF _INTERN[20+2]
N1168 SETAL(_ALARM+1000)
N1240 M0
STOPRE
IF ((_ALARM==61304) OR (_ALARM==61305))
CYCLE114(3,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697727 SETAL(_ALARM)
ENDIF
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697728 SETAL(_ALARM)
ENDIF
ENDIF
ENDIF
IF _NEW_PAR
_CHBIT[4]=_CHBIT_S[4] _CHBIT[6]=_CHBIT_S[6] _CHBIT[8]=_CHBIT_S[8] _CHBIT[21]=_CHBIT_S[21]
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
IF(_INTERN[68] == 1)
FOR _HI[0]=100 TO 129
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
_OVR[800+_HI[0]]=_OVR[800+_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
ENDIF
M17
N697729 _ENDE: SETAL(62301)
M0
_GENDE: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE978_SPF
PROC CYCLE978(INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,INT S_MA,INT S_MD,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,INT _DP) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.001 ;DATE: 2024-01-15
;Cycle : workpiece, measuring a surface parallel to the axis
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_ADD,_H_BOOL=0
N1010 DEF REAL _M_SPE[80],_M_ME[40],_P_POS,_TRIGLAG,_TRIGLAG2,_LAGE,_SIMTR
N1020 DEF INT _M_N[40],_ALARM,_P_PROB,_P_PL,_P_PT,_MESSR,_AXIND,_STAT,_H_SIM,_H_MVAR,_HI[10]=SET(0,0,0,0,0,1),_RETVAL
N1030 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_VAV1
N1040 DEF REAL _HR[4],_IW_C[2],_DAT[3,6],_KF[3,3],_H_SPE27,_H_SPE28,_H_SPE71,_H_SPE72
N1041 DEF INT _H_DMODE, _H_KNUM, _CHBIT_S[32]
N1042 DEF BOOL _NEW_PAR=0
N1044 DEF STRING[35] _SERR
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[38] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE978_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE978_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE978("<<S_MVAR<<","<<S_KNUM<<","<<S_KNUM1<<","<<S_PRNUM<<","<<S_SETV<<","<<S_FA<<","<<S_TSA<<","<<S_MA<<","<<S_MD<<","<<S_NMSP<<","<<S_TNAME<<","<<S_DLNUM<<","<<S_TZL<<","<<S_TDIF<<","<<S_TUL<<","<<S_TLL<<","<<S_TMV<<","<<S_K<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _NEW_PAR=1 _M_SPE[3]=1
_CHBIT_S[4]=_CHBIT[4] _CHBIT_S[6]=_CHBIT[6] _CHBIT_S[8]=_CHBIT[8] _CHBIT_S[21]=_CHBIT[21]
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 2 GOTOF _M_ERR
S_KNUM=ABS(S_KNUM) S_KNUM1=ABS(S_KNUM1)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 3
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM - 2000 + 50
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
GOTOF _HA2
_HA1:_M_N[14]=0
IF ((_H_KNUM _DEC1)== 2)
S_MVAR = S_MVAR - 200
_SERR=<<"(S_KNUM1: dec6)"
IF ((S_KNUM1 _DEC6) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1: dec7)"
IF ((S_KNUM1 _DEC7) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec8)"
IF ((S_KNUM1 _DEC8) > 1) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec9)"
IF ((S_KNUM1 _DEC9) > 1) GOTOF _M_ERR
_SERR=<<"(ST)"
IF (S_KNUM1 _DEC9)AND(_DP <=0) GOTOF _M_ERR
IF (((S_KNUM1 _DEC7) > 0) AND ((S_KNUM1 _DEC7) < 4))
_DLNUM = S_DLNUM
ELSE
_DLNUM = 0
ENDIF
_CHBIT[6]=0 _CHBIT[8]=0
IF (S_KNUM1 _DEC7) == 4
S_KNUM1 = S_KNUM1 - 4000000 _CHBIT[6]=1
ENDIF
_SERR=<<"(S_KNUM1 DNo > MD18105)"
IF (((S_KNUM1 _DEC5)*10000)+((S_KNUM1 _DEC4)*1000)+((S_KNUM1 _DEC3)*100)+((S_KNUM1 _DEC2)*10)+((S_KNUM1 _DEC1))>$MN_MM_MAX_CUTTING_EDGE_NO) GOTOF _M_ERA
IF ($MN_MM_MAX_CUTTING_EDGE_NO >= 1000)
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 - 10000000 _H_KNUM=_H_KNUM+10
ENDIF
S_KNUM1=S_KNUM1+((S_KNUM1 _DEC6)*10000000)-((S_KNUM1 _DEC6)*100000)
IF ((S_KNUM1 _DEC7) == 0)
IF S_MA == 3
S_KNUM1 = S_KNUM1 + 100000
ELSE
S_KNUM1 = S_KNUM1 + 200000
ENDIF
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 2000000 + 100000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 3000000 + 100000000 _CHBIT[8]=1
ENDIF
IF ((_H_KNUM _DEC2)==1)
S_KNUM1 = S_KNUM1 + 1000000
ENDIF
ELSE
IF ((S_KNUM1 _DEC7) == 0)
IF S_MA == 3
S_KNUM1 = S_KNUM1 + 1000
ELSE
S_KNUM1 = S_KNUM1 + 2000
ENDIF
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 1000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 2000000 _CHBIT[8]=1
ENDIF
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 + 10000 - 10000000
ENDIF
IF (S_KNUM1 _DEC9)
S_KNUM1=S_KNUM1 - 100000000
_M_N[14]=_DP
ENDIF
ENDIF
_KNUM = S_KNUM1
ENDIF
_HA2:
_SERR=<<"(S_MA:"<<S_MA<<")"
IF (S_MA > 3) OR (S_MA <= 0) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 2) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 2) GOTOF _M_ERR
IF (_H_KNUM==0)
S_MVAR=S_MVAR + 100 _KNUM=0
ENDIF
S_MVAR = S_MVAR - ((S_MVAR _DEC4)*1000)
_MVAR=ABS(S_MVAR) _PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _FA=ABS(S_FA) _TSA=ABS(S_TSA) _MA=S_MA
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(_AMODE: dec1)"
_AMODE = ABS(_AMODE)
IF ((_AMODE _DEC1) > 1) GOTOF _M_ERR
IF (_AMODE _DEC1) == 1
_TZL=ABS(S_TZL) _TDIF=ABS(S_TDIF) _TUL=S_TUL _TLL=S_TLL _M_N[23]=_M_N[23]+100
ELSE
_TZL=0 _TUL=1.01*(ABS(S_TSA)) _TLL=-_TUL _TDIF=_TUL
ENDIF
_CHBIT[4]=0
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 20 GOTOF _M_ERR
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 0
_CHBIT[4]=1
_K = ABS(S_K)
_TMV=ABS(S_TMV)
ELSE
_TMV=ABS((_TUL - _TLL) / 3)
_K=1
ENDIF
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC2)*10) + (S_EVNUM _DEC1)) > 20 GOTOF _M_ERR
IF S_EVNUM<>0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(S_TNAME)"
IF _H_KNUM==2
IF (((_H_KNUM _DEC1)==2) AND (S_TNAME == "")) GOTOF _M_ERR
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B1') OR ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10')
_TNAME =<< S_TNAME _TNUM = 0
ELSE
_TNAME=<<"" _TNUM = NUMBER(S_TNAME)
ENDIF
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE = ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
_VB[15]=1 _M_SPE[3]=1
ELSE
_MVAR=_MVAR MOD 10000
IF _MVAR _DEC4
_MVAR=(_MVAR MOD 1000)+10000
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N69781 SETAL(_ALARM,_SERR)
RET
_M_ERA: _ALARM=61021 _OVI[9]=_ALARM
STOPRE
N697802 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
IF _PRNUM _DEC3==1
_PRNUM = _PRNUM - 100
ENDIF
ENDIF
ENDIF
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M120
_ALARM=0
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HI[5]=2
ENDIF
_OVI[2]=978
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1057 DIAMCYCOF G0 G90 G94
_ALARM=61307 _H_MVAR=_MVAR MOD 1000
IF NOT((_H_MVAR==0)OR(_H_MVAR==100))GOTOF _M121 IF _MVAR _DEC5 >2 GOTOF _M121 IF _MVAR _DEC4 <>0 GOTOF _M121
IF _MVAR _DEC3
_VB[0]=1
ENDIF
IF (_MVAR _DEC5 == 2)
_INTERN[40+13]=1 _VB[55]=1
ENDIF
IF (_INTERN[40+13]==1)AND((_HR[0]==712)OR(_HR[0]==713)OR(_HR[0]==714))
_INTERN[40+13]=0
ENDIF
IF _MVAR _DEC5 ==1
_VB[18]=1 _VB[3]=1 _HR[2]=$AA_IM[SPI($AC_MSNUM)] _INTERN[40+13]=0 _INTERN[20+16]=0
ENDIF
_ALARM=0 _VB[16]=1
N1060 CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_IW_C[0]=_M_SPE[5] _IW_C[1]=_M_SPE[6] _H_SPE27=_M_SPE[27] _H_SPE28=_M_SPE[28]
IF(_INTERN[68] == 1)
_H_SPE71=_M_SPE[71] _H_SPE72=_M_SPE[72] _HI[8]=_M_SPE[74] MOD 100
_ALARM=61341
IF (($SNS_MEA_FUNCTION_MASK B_AND 'B10000')OR(($MCS_TECHNOLOGY==1)AND($MCS_TECHNOLOGY_EXTENSION==2)AND(_OVI[1]==710)))AND(_NEW_PAR)
IF((_VB[32]==1)AND((_M_SPE[74] _DEC3)==1))OR((_VB[33]==1)AND((_M_SPE[74] _DEC3)==2))OR((_VB[34]==1)AND((_M_SPE[74] _DEC3)==3))
IF(_MA==1)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0001'<>1)GOTOF _M125
IF(_MA==2)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0010'<>2)GOTOF _M125
IF(_MA==3)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0100'<>4)AND(_HI[8] B_AND 'B1000'<>8) GOTOF _M125
ELSE
IF (_MA==1)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0010'<>2) GOTOF _M125
IF (_MA==2)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0001'<>1) GOTOF _M125
IF (_MA==3)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0100'<>4)AND(_HI[8] B_AND 'B1000'<>8) GOTOF _M125
ENDIF
ELSE
IF(_MA==1)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0001'<>1)GOTOF _M125
IF(_MA==2)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0010'<>2)GOTOF _M125
IF(_MA==3)AND(_INTERN[20+16])AND(_HI[8] B_AND 'B0100'<>4)AND(_HI[8] B_AND 'B1000'<>8) GOTOF _M125
ENDIF
ENDIF
IF _OVI[1]==713
IF _MA==3
_ALARM=61970
IF S_MD==2 GOTOF _M123
_ALARM=0
IF(_INTERN[68] == 1)
_M_SPE[69]=SET(0,0)
ENDIF
ELSE
_M_SPE[24]=_M_SPE[22] _M_SPE[21]=-(_M_SPE[22]) _M_SPE[23]=-(_M_SPE[22]) _ALARM=0
IF(_INTERN[68] == 1)
_M_SPE[68]=_M_SPE[66] _M_SPE[65]=-(_M_SPE[66]) _M_SPE[67]=-(_M_SPE[66])
ENDIF
ENDIF
ENDIF
IF (_VB[2]==1)AND(_VB[18]==1)
_ALARM=61309
GOTOF _M122
ENDIF
IF (_MA==3) AND (_VB[2])
_VB[31]=0 _M_ZUST[0]=0 _M_ZUST[1]=1
ENDIF
IF _VB[15]==0 GOTOF _M7
_M_SPE[10]=_M_SPE[4+_MA] _M_SPE[9]=_M_SPE[4+_MA]+_M_SPE[3]*_M_SPE[60] _M_SPE[16]=_M_SPE[9] _OVR[4]=_M_SPE[9]
IF(_INTERN[68] == 1)
_OVR[104]=_M_SPE[9]
ENDIF
IF _M_N[18]
IF (_INTERN[20+14] AND (_MA==3))
_SIMTR=0
ELSE
_SIMTR=$P_AD[6]
ENDIF
ENDIF
_M_ME[11]=_M_SPE[10]+_M_SPE[3]-_SIMTR*_M_SPE[3]/ABS(_M_SPE[3])
_M7:_MAV=_XX _P_PL=7
IF _MA==1 GOTOF _M8
_MAV=_YY _P_PL=8
IF _MA==2 GOTOF _M8
_MAV=_ZZ
IF _MA==3 GOTOF _M8
_ALARM=61325
GOTOF _M123
_M8:_AXIND=_MA-1 _P_POS=_M_SPE[4+_MA] _P_PT=2*_MA-1 _HI[0]=_M_SPE[54] MOD 100 _ALARM=61336
IF _VB[1]==0
G1 F=_M_SPE[1]
ENDIF
IF _INTERN[2+8*_AXIND]==0 GOTOF _M124
IF _M_SPE[16] < _P_POS GOTOF _M82 IF _MA<>2 GOTOF _M81
_M_ZUST[2]=1
GOTOF _M9
_M81:_M_ZUST[0]=1
GOTOF _M9
_M82:IF _MA<>2 GOTOF _M83
_M_ZUST[3]=1
GOTOF _M9
_M83:_M_ZUST[1]=1
N1070 _M9:_ALARM=61325
IF (_MVAR _DEC5 == 2)AND(_VB[2]==0)
IF _MA==3 GOTOF _M120
_VB[2]=1 _VB[3]=1 _INTERN[20+8]=0 _INTERN[40+13]=0
_M_SPE[21]=_M_SPE[21]-_M_SPE[27] _M_SPE[22]=SET(-_M_SPE[21],_M_SPE[21],-_M_SPE[21]) _M_SPE[27]=0 _M_SPE[28]=0
IF(_INTERN[68] == 1)
_M_SPE[65]=_M_SPE[65]-_M_SPE[71] _M_SPE[66]=SET(-_M_SPE[65],_M_SPE[65],-_M_SPE[65]) _M_SPE[71]=0 _M_SPE[72]=0
ENDIF
IF (_MA==1)AND(_M_ZUST[0]==1) GOTOF _M10
_H_SPE28=-_H_SPE28
IF (_MA==1)AND(_M_ZUST[1]==1) GOTOF _M10
_H_SPE27=_H_SPE28
IF (_MA==2)AND(_M_ZUST[2]==1) GOTOF _M10
_H_SPE27=-_H_SPE28
_M10:
ELSE
IF (_MVAR _DEC5 == 1)AND(_VB[2]==0)
IF _MA==3 GOTOF _M120
_M_N[20]=1 _M_SPE[27]=0 _M_SPE[28]=0 _H_SPE27=0 _H_SPE28=0 _INTERN[20+8]=0
IF(_INTERN[68] == 1)
M_SPE[71]=0 _M_SPE[72]=0 _H_SPE71=0 _H_SPE72=0
ENDIF
ENDIF
ENDIF
_ALARM=61341
IF (($SNS_MEA_FUNCTION_MASK B_AND 'B10000')OR(($MCS_TECHNOLOGY==1)AND($MCS_TECHNOLOGY_EXTENSION==2)AND(_OVI[1]==710)))AND(_NEW_PAR)
IF((_VB[32]==1)AND((_M_SPE[54] _DEC3)==1))OR((_VB[33]==1)AND((_M_SPE[54] _DEC3)==2))OR((_VB[34]==1)AND((_M_SPE[54] _DEC3)==3))
IF(_MA==1)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0001'<>1)GOTOF _M125
IF(_MA==2)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0010'<>2)GOTOF _M125
IF(_MA==3)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0100'<>4)AND(_HI[0] B_AND 'B1000'<>8) GOTOF _M125
ELSE
IF (_MA==1)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0010'<>2) GOTOF _M125
IF (_MA==2)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0001'<>1) GOTOF _M125
IF (_MA==3)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0100'<>4)AND(_HI[0] B_AND 'B1000'<>8) GOTOF _M125
ENDIF
ELSE
IF(_MA==1)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0001'<>1)GOTOF _M125
IF(_MA==2)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0010'<>2)GOTOF _M125
IF(_MA==3)AND(_INTERN[20+16])AND(_HI[0] B_AND 'B0100'<>4)AND(_HI[0] B_AND 'B1000'<>8) GOTOF _M125
ENDIF
_ALARM=61326
IF(((_MA==1)OR(_MA==3))AND(S_MD==2)AND(_M_ZUST[0]==1)AND(_M_ZUST[1]==0))AND(_NEW_PAR==1) GOTOF _M123
IF(((_MA==1)OR(_MA==3))AND(S_MD==1)AND(_M_ZUST[0]==0)AND(_M_ZUST[1]==1)AND(_NEW_PAR==1)) GOTOF _M123
IF((_MA==2)AND(S_MD==2)AND(_M_ZUST[2]==1)AND(_M_ZUST[3]==0))AND(_NEW_PAR==1) GOTOF _M123
IF((_MA==2)AND(S_MD==1)AND(_M_ZUST[2]==0)AND(_M_ZUST[3]==1))AND(_NEW_PAR==1) GOTOF _M123
_ALARM=0
IF _INTERN[2] AND(_MAV <> _XX)
N1064 AX[_XX]=(_M_SPE[5]+_H_SPE27)*_M_SPE[29]
_M_SPE[5]=_M_SPE[5]+_H_SPE27
ENDIF
IF _INTERN[10] AND(_MAV <> _YY)
N1066 AX[_YY]=(_M_SPE[6]+_H_SPE28)*_M_SPE[29]
_M_SPE[6]=_M_SPE[6]+_H_SPE28
ENDIF
_M_SPE[17]=_M_SPE[17]+_M_SPE[27]*_DAT[0,1]+_M_SPE[28]*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_M_SPE[27]*_DAT[0,2]+_M_SPE[28]*_DAT[1,2] _M_SPE[19]=_M_SPE[19]+_M_SPE[27]*_DAT[0,3]+_M_SPE[28]*_DAT[1,3]
IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _M91
_MESSR=1
GOTOF _M92
_M91:_MESSR=-1 _P_PT=_P_PT+1
_M92:IF _VB[15] GOTOF _M94A
IF (_INTERN[20+14]) AND (_MAV==_ZZ) AND (_INTERN[18])
_HR[1]=_M_SPE[3]*_MESSR
ELSE
_HR[1]=(($P_ADT[6]/_HI[5])+_M_SPE[3])*_MESSR
ENDIF
_M_SPE[10]=_M_SPE[16]+_HR[1]
N1075 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR
IF ((_MESSR==-1)AND(_M_SPE[10]>_P_POS))OR((_MESSR==1)AND(_M_SPE[10]<_P_POS)) GOTOF _M94
_M_SPE[10]=_P_POS
_M94: _M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR
_M94A:IF (_VB[18]==0) OR (_VB[26]) GOTOF _M95
_M_SPE[8]=_M_SPE[8]+179.999
N1080 _M95: CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_M_ME[0]=_M_ME[8] _TRIGLAG=_M_SPE[20+_P_PT] _M_ME[8]=0
IF(_INTERN[68] == 1)
_M_ME[20]=_M_ME[28] _TRIGLAG2=_M_SPE[64+_P_PT] _M_ME[28]=0
ENDIF
IF ((_VB[48]) AND (_VB[18]==0) AND (_MA<>3))
_TRIGLAG=_M_SPE[20]*_MESSR/2
IF(_INTERN[68] == 1)
_TRIGLAG2=_M_SPE[64]*_MESSR/2
ENDIF
ENDIF
IF _M_N[18]
IF _VB[15]
_TRIGLAG=_SIMTR*_MESSR
ELSE
_TRIGLAG=_HR[1]-_M_SPE[3]*_MESSR
ENDIF
ENDIF
IF _VB[18]==0 GOTOF _M102
IF _VB[26] GOTOF _M101
_M_ME[4]=_M_ME[0] _M_SPE[8]=_M_SPE[8]-179.999 _VB[26]=1
IF(_INTERN[68] == 1)
_M_ME[24]=_M_ME[20]
ENDIF
GOTOB _M94A
_M101:_HR[1]=(_M_ME[4]+_M_ME[0]-($P_ADT[6]/_HI[5])*2*_MESSR)/2 _TRIGLAG=_M_ME[0]-_HR[1]
_OVR[40]=_M_ME[0]-_M_ME[4]
_M_ME[4]=0
IF(_INTERN[68] == 1)
_HR[3]=(_M_ME[24]+_M_ME[20]-($P_ADT[6]/_HI[5])*2*_MESSR)/2 _TRIGLAG2=_M_ME[20]-_HR[3]
_OVR[140]=ABS(_M_ME[20]-_M_ME[24])
_M_ME[24]=0
ENDIF
IF _INTERN[40+18]
N2000 CUST_MEACYC(3,_HR[2],3)
ELSE
N2001 SUPA SPOS=AC(_HR[2])
ENDIF
GOTOF _M104
_M102: IF(_INTERN[18])AND(_MAV==_ZZ) GOTOF _M104
IF (_M_N[18]==0)
_TRIGLAG=_TRIGLAG+_M_SPE[20+_P_PL]
IF(_INTERN[68] == 1)
_TRIGLAG2=_TRIGLAG2+_M_SPE[64+_P_PL]
ENDIF
ENDIF
_M104:_M_ME[0]=_M_ME[0]-_TRIGLAG
_OVR[4]=_M_ME[0] _M_ZUST[7]=1
IF (S_MA == 1)
_OVR[41] = _M_ME[1] - _TRIGLAG _OVR[42] = _M_ME[2] _OVR[43] = _M_ME[3]
ELSE
IF (S_MA == 2)
_OVR[41] = _M_ME[2] _OVR[42] = _M_ME[1] - _TRIGLAG _OVR[43] = _M_ME[3]
ELSE
_OVR[41] = _M_ME[2] _OVR[42] = _M_ME[3] _OVR[43] = _M_ME[1] - _TRIGLAG
ENDIF
ENDIF
$AC_MEAS_VALID=0
$AC_MEAS_LATCH[0]=1
$AC_MEAS_TYPE=21
; Messwerte zuweisen.
$AA_MEAS_POINT1[_XX]=_OVR[41]
$AA_MEAS_POINT1[_YY]=_OVR[42]
$AA_MEAS_POINT1[_ZZ]=_OVR[43]
$AA_MEAS_SETPOINT[_XX]=0
$AA_MEAS_SETPOINT[_YY]=0
$AA_MEAS_SETPOINT[_ZZ]=0
$AC_MEAS_TOOL_MASK='H20'
$AC_MEAS_FRAME_SELECT =0
$AC_MEAS_FINE_TRANS=0
_RETVAL=MEASURE()
IF (_RETVAL == 0)
_OVR[44] = $AC_MEAS_FRAME[_XX,TR]
_OVR[45] = $AC_MEAS_FRAME[_YY,TR]
_OVR[46] = $AC_MEAS_FRAME[_ZZ,TR]
ENDIF
$AC_MEAS_VALID=0
$AC_MEAS_LATCH[0]=1
$AC_MEAS_TYPE=24
; Messwerte zuweisen.
$AA_MEAS_POINT1[_XX]=_OVR[41]
$AA_MEAS_POINT1[_YY]=_OVR[42]
$AA_MEAS_POINT1[_ZZ]=_OVR[43]
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=2
IF ((($P_TRAFO B_AND 'H2000') AND (($P_TRAFO_CHAIN[0] B_AND 'H1000') OR ($P_TRAFO_CHAIN[1] B_AND 'H1000'))) OR ($P_TRAFO B_AND 'H1000'))
$AC_MEAS_P2_COORD=1
ENDIF
IF ISVAR("$MN_CC_ACTIVE_IN CHAN_ROBX")
IF $MN_CC_ACTIVE_IN_CHAN_ROBX[$P_CHANNO-1]
$AC_MEAS_P2_COORD=1
ENDIF
ENDIF
$AC_MEAS_TOOL_MASK='H20'
_RETVAL=MEASURE()
IF (_RETVAL == 0)
_OVR[47] = $AA_MEAS_POINT2[_XX]
_OVR[48] = $AA_MEAS_POINT2[_YY]
_OVR[49] = $AA_MEAS_POINT2[_ZZ]
ENDIF
IF(_INTERN[68] == 1)
_M_ME[20]=_M_ME[20]-_TRIGLAG2
_OVR[104]=_M_ME[20]
IF (S_MA == 1)
_OVR[141] = _M_ME[21] - _TRIGLAG2 _OVR[142] = _M_ME[22] _OVR[143] = _M_ME[23]
ELSE
IF (S_MA == 2)
_OVR[141] = _M_ME[22] _OVR[142] = _M_ME[21] - _TRIGLAG2 _OVR[143] = _M_ME[23]
ELSE
_OVR[141] = _M_ME[22] _OVR[142] = _M_ME[23] _OVR[143] = _M_ME[21] - _TRIGLAG2
ENDIF
ENDIF
$AC_MEAS_VALID=0
$AC_MEAS_TYPE=21
; Messwerte zuweisen.
$AA_MEAS_POINT1[_XX]=_OVR[141]
$AA_MEAS_POINT1[_YY]=_OVR[142]
$AA_MEAS_POINT1[_ZZ]=_OVR[143]
$AA_MEAS_SETPOINT[_XX]=0
$AA_MEAS_SETPOINT[_YY]=0
$AA_MEAS_SETPOINT[_ZZ]=0
$AC_MEAS_TOOL_MASK='H20'
$AC_MEAS_FRAME_SELECT =0
$AC_MEAS_FINE_TRANS=0
_RETVAL=MEASURE()
IF (_RETVAL == 0)
_OVR[144] = $AC_MEAS_FRAME[_XX,TR]
_OVR[145] = $AC_MEAS_FRAME[_YY,TR]
_OVR[146] = $AC_MEAS_FRAME[_ZZ,TR]
ENDIF
$AC_MEAS_VALID=0
$AC_MEAS_LATCH[0]=1
$AC_MEAS_TYPE=24
; Messwerte zuweisen.
$AA_MEAS_POINT1[_XX]=_OVR[141]
$AA_MEAS_POINT1[_YY]=_OVR[142]
$AA_MEAS_POINT1[_ZZ]=_OVR[143]
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=2
IF ((($P_TRAFO B_AND 'H2000') AND (($P_TRAFO_CHAIN[0] B_AND 'H1000') OR ($P_TRAFO_CHAIN[1] B_AND 'H1000'))) OR ($P_TRAFO B_AND 'H1000'))
$AC_MEAS_P2_COORD=1
ENDIF
IF ISVAR("$MN_CC_ACTIVE_IN CHAN_ROBX")
IF $MN_CC_ACTIVE_IN_CHAN_ROBX[$P_CHANNO-1]
$AC_MEAS_P2_COORD=1
ENDIF
ENDIF
$AC_MEAS_TOOL_MASK='H20'
_RETVAL=MEASURE()
IF (_RETVAL == 0)
_OVR[147] = $AA_MEAS_POINT2[_XX]
_OVR[148] = $AA_MEAS_POINT2[_YY]
_OVR[149] = $AA_MEAS_POINT2[_ZZ]
ENDIF
ENDIF
_M_ME[4]=SET(0,0,0) _OVI[6]=SET(0,_M_N[22] MOD 10000)
IF(_INTERN[68] == 1)
_M_ME[24]=SET(0,0,0)
ENDIF
IF _VB[0] GOTOF _M107
IF _M_N[22]>9999
_OVI[6]=_M_N[22] DIV 10000
ELSE
_OVI[6]=_OVI[7]
ENDIF
_M107:IF _OVI[7]==0 GOTOF _M109
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF _INTERN[40+5]==0 GOTOF _M108
_HR[0]=-_HR[0]
_M108:_OVR[4]=_OVR[4]-_HR[0]
IF(_INTERN[68] == 1)
_OVR[104]=_OVR[104]-_HR[0]
ENDIF
_M109:_OVR[16]=_OVR[4]-_OVR[0]
IF(_INTERN[68] == 1)
_OVR[116]=_OVR[104]-_OVR[100]
FOR _HI[0]=0 TO 50
_OVR[900+_HI[0]]=(_OVR[+_HI[0]]+_OVR[100+_HI[0]])/2
ENDFOR
ENDIF
IF (_VB[15] == 0) AND (ABS(_OVR[16]) > _M_SPE[32])
_ALARM=61303
ENDIF
IF (_ALARM == 0) AND (_VB[0] == 0) AND (ABS(_OVR[16]) > _M_SPE[34])
_ALARM=61306
ENDIF
IF (_ALARM == 61303) OR (_ALARM == 61306)
IF (_INTERN[20+0]) AND (_M_N[7] < 4)
_M_N[7] = _M_N[7] + 1
IF (_VB[18] == 1)
_VB[26] = 0
_M_SPE[8] = _M_SPE[8] + 179.999
ENDIF
IF (_INTERN[20+1] == 1)
N1100 SETAL(_ALARM+1000)
N1110 M0
STOPRE
ENDIF
_M_ZUST[7]=0 _ALARM=0
ENDIF
ENDIF
IF _M_ZUST[7]==0 GOTOB _M95
_OVR[28]=_OVR[28]/_M_SPE[29]
IF(_INTERN[68] == 1)
_OVR[128]=_OVR[128]/_M_SPE[29]
ENDIF
IF (_ALARM AND _VB[0]) GOTOF _M126
IF (_VB[0] == 0)
_OVR[20]=_OVR[16] _OVI[4]=_M_N[23] MOD 100 _OVR[8]=_M_SPE[35]/_M_SPE[29] _OVR[12]=_M_SPE[36]/_M_SPE[29]
IF(_INTERN[68] == 1)
_OVR[120]=_OVR[116] _OVR[108]=_M_SPE[35]/_M_SPE[29] _OVR[112]=_M_SPE[36]/_M_SPE[29]
ENDIF
_OVI[0]=_M_N[11] _OVR[29]=_M_SPE[34] _OVR[27]=_M_SPE[33]
IF _ALARM GOTOF _M126
IF ABS(_OVR[20])>_M_SPE[15]
IF ((_MESSR==-1)AND(_OVR[4]<_OVR[0]))OR ((_MESSR==1)AND(_OVR[4]>_OVR[0]))
_ALARM=61304
ELSE
_ALARM=61305
ENDIF
ENDIF
CYCLE114(2,_ALARM,_MAV,0,_M_SPE[37],_M_N[23],_INTERN[40+4],_H_BOOL)
IF _H_BOOL==0
IF ABS(_OVR[20]) <= _M_SPE[33]
CYCLE114(4,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
GOTOF _M118
ENDIF
ENDIF
IF $MN_MM_TYPE_OF_CUTTING_EDGE==0
_HR[2]=_KNUM DIV 100000 MOD 10 _HR[1]=_KNUM DIV 1000 MOD 10
IF $MN_MM_MAX_CUTTING_EDGE_NO>=1000
_HR[2]=_KNUM DIV 10000000 MOD 10 _HR[1]=_KNUM DIV 100000 MOD 10
ENDIF
ELSE
_HR[2]=_KNUM DIV 10000000 MOD 10 _HR[1]=_KNUM DIV 100000 MOD 10
ENDIF
IF ((_HR[2]==4)AND(_MESSR==-1))OR((_HR[2]==0)AND(_HR[1]==2)AND(_MESSR==-1)) GOTOF _M117C
_OVR[20]=-_OVR[20]
_M117C:
IF ((_INTERN[20+2]==0) OR ((_INTERN[20+2]==1) AND (_ALARM<>61304) AND (_ALARM<>61305)))
CYCLE114(3,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
GOTOF _M126
_M118:IF _OVI[6]==0 GOTOF _M118A
IF _INTERN[40+4]==1
_MV[_OVI[6]-1]=_OVR[20] _OVR[31]=_OVR[20] $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=_OVR[20]
ELSE
_MV[_OVI[6]-1]=0 _OVR[31]=0 $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=0
ENDIF
_M118A:_OVR[20]=0
GOTOF _M126
ENDIF
_OVR[17+_AXIND]=_OVR[16] _OVR[1+_AXIND]=_OVR[0] _OVR[5+_AXIND]=_OVR[4]
IF(_INTERN[68] == 1)
_OVR[117+_AXIND]=_OVR[116] _OVR[101+_AXIND]=_OVR[100] _OVR[105+_AXIND]=_OVR[104]
ENDIF
IF (_KNUM <> 0)
_OVI[0]=_KNUM _HI[1]=0 _ADD=0
IF ((_VB[15] == 0) AND (_INTERN[40+21] == 0))
_HI[1]=1 _ADD=1
ENDIF
CYCLE115(_ALARM,_MAV,_ADD,_NEW_PAR)
ENDIF
IF _ALARM==0 GOTOF _M126
STOPRE
_M120:_OVI[9]=_ALARM
N697820 SETAL(_ALARM)
STOPRE
_M121:_OVI[9]=_ALARM
N697821 SETAL(_ALARM)
STOPRE
_M122:_OVI[9]=_ALARM
N697822 SETAL(_ALARM)
STOPRE
_M123:_OVI[9]=_ALARM
N697823 SETAL(_ALARM)
STOPRE
_M124:_OVI[9]=_ALARM
N697824 SETAL(_ALARM)
STOPRE
_M125:_OVI[9]=_ALARM
N697825 SETAL(_ALARM)
STOPRE
_M126:_OVI[9]=_ALARM
IF ((_ALARM < 61303) OR (_ALARM > 61306)) AND (_ALARM <> 0)
N697826 SETAL(_ALARM)
_M131: M0
STOPRE
N697827 SETAL(61327)
GOTOB _M131
ENDIF
_PROTVAL[29] = _PROTVAL[29] <<"F"<<_M_SPE[0]
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M128A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M128
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N1153 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 50
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
IF(_INTERN[68] == 1)
FOR _HI[0]=100 TO 150
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M129
IF _M_N[28]==2 GOTOF _M128
G4 F8
N1160 _M129: CYCLE102(0)
N1162 _M128:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 50
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
IF(_INTERN[68] == 1)
FOR _HI[0]=100 TO 150
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
_OVR[800+_HI[0]]=_OVR[800+_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
ENDIF
N1162 _M128A:
IF _ALARM
STOPRE
_OVI[9]=_ALARM
IF (_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF (_ALARM > 61303)
IF _INTERN[20+2]
N1168 SETAL(_ALARM+1000)
N1240 M0
STOPRE
IF ((_ALARM==61304) OR (_ALARM==61305))
CYCLE114(3,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697828 SETAL(_ALARM)
ENDIF
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697829 SETAL(_ALARM)
ENDIF
ENDIF
ENDIF
IF (_INTERN[2]) AND (_MA<>1)
N1240 G90 AX[_XX]=_IW_C[0]*_M_SPE[29]
ENDIF
IF (_INTERN[10]) AND (_MA<>2)
N1245 AX[_YY]=_IW_C[1]*_M_SPE[29]
ENDIF
IF _NEW_PAR
_CHBIT[4]=_CHBIT_S[4] _CHBIT[6]=_CHBIT_S[6] _CHBIT[8]=_CHBIT_S[8] _CHBIT[21]=_CHBIT_S[21]
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
IF(_INTERN[68] == 1)
FOR _HI[0]=100 TO 129
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
_OVR[800+_HI[0]]=_OVR[800+_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
ENDIF
M17
N697830 _ENDE: SETAL(62301)
M0
_GENDE: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE979_SPF
PROC CYCLE979(INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_CPA,REAL S_CPO,REAL S_STA1,REAL S_INCA,INT S_NMSP,STRING[32] S_TNAME,REAL S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,REAL S_MPVAL1,REAL S_MPVAL2,INT _DP) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.001 ;DATE: 2024-01-15
;Cycle : workpiece, measure hole/shaft/groove/rib at an angle
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_ADD,_H_BOOL=0, _MPKTA=0
N1010 DEF REAL _M_SPE[80],_M_ME[40],_P_POS,_LAGE,_PL,_PT,_TRIGLAG,_H_STA
N1020 DEF INT _M_N[40],_ALARM,_TMP_NPV,_MESSR,_AXIND,_HI[5],_H_SIM
N1030 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV
N1040 DEF REAL _HR[7],_Winkel,_CAL[13],_DAT[3,6],_KF[3,3],_HINCA
N1042 DEF REAL _PL2,_PT2,_TRIGLAG2,_CAL2[13]
N1043 DEF INT _MODE_2MESS=1
N1050 DEF INT _H_DMODE, _H_KNUM, _CHBIT_S[32]
N1052 DEF BOOL _NEW_PAR=0
N1054 DEF STRING[40] _SERR
N1062 DEF INT _TEMP,_TEMP_ON
N1064 DEF STRING[35] _TEMP_FILE="/_N_MPF_DIR/_N_TEMP_CYCLE979_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE979_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE979("<<S_MVAR<<","<<S_KNUM<<","<<S_KNUM1<<","<<S_PRNUM<<","<<S_SETV<<","<<S_FA<<","<<S_TSA<<","<<S_CPA<<","<<S_CPO<<","<<S_STA1<<","<<S_INCA<<","<<S_NMSP<<","<<S_TNAME<<","<<S_DLNUM<<","<<S_TZL<<","<<S_TDIF<<","<<S_TUL<<","<<S_TLL<<","<<S_TMV<<","<<S_K<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<","<<S_MPVAL1<<","<<S_MPVAL2<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _NEW_PAR=1 _M_SPE[3]=1
_CHBIT_S[4]=_CHBIT[4] _CHBIT_S[6]=_CHBIT[6] _CHBIT_S[8]=_CHBIT[8] _CHBIT_S[21]=_CHBIT[21]
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1)== 0) OR ((S_MVAR _DEC1)> 2) GOTOF _M_ERR
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 2 GOTOF _M_ERR
S_KNUM=ABS(S_KNUM) S_KNUM1=ABS(S_KNUM1)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 3
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM - 2000 + 50
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
GOTOF _HA2
_HA1:_M_N[14]=0
IF ((_H_KNUM _DEC1)== 2)
S_MVAR = S_MVAR - 200
_SERR=<<"(S_KNUM1: dec6)"
IF ((S_KNUM1 _DEC6) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1: dec7)"
IF ((S_KNUM1 _DEC7) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec8)"
IF ((S_KNUM1 _DEC8) > 1) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec9)"
IF ((S_KNUM1 _DEC9) > 1) GOTOF _M_ERR
_SERR=<<"(ST)"
IF (S_KNUM1 _DEC9)AND(_DP <=0) GOTOF _M_ERR
IF (((S_KNUM1 _DEC7) > 0) AND ((S_KNUM1 _DEC7) < 4))
_DLNUM = S_DLNUM
ELSE
_DLNUM = 0
ENDIF
_CHBIT[6]=0 _CHBIT[8]=0
IF (S_KNUM1 _DEC7) == 4
S_KNUM1 = S_KNUM1 - 4000000 _CHBIT[6]=1
ENDIF
_SERR=<<"(S_KNUM1 DNo > MD18105)"
IF (((S_KNUM1 _DEC5)*10000)+((S_KNUM1 _DEC4)*1000)+((S_KNUM1 _DEC3)*100)+((S_KNUM1 _DEC2)*10)+((S_KNUM1 _DEC1))>$MN_MM_MAX_CUTTING_EDGE_NO) GOTOF _M_ERA
IF ($MN_MM_MAX_CUTTING_EDGE_NO >= 1000)
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 - 10000000 _H_KNUM=_H_KNUM+10
ENDIF
IF (S_KNUM1 _DEC6) == 0
S_KNUM1 = S_KNUM1 + 200000
ELSE
S_KNUM1=S_KNUM1+((S_KNUM1 _DEC6)*10000000)-((S_KNUM1 _DEC6)*100000)
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC6)*100000)
ENDIF
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 2000000 + 100000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 3000000 + 100000000 _CHBIT[8]=1
ENDIF
IF ((_H_KNUM _DEC2)==1)
S_KNUM1 = S_KNUM1 + 1000000
ENDIF
ELSE
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC4)*1000)
ENDIF
IF (S_KNUM1 _DEC6) == 0
S_KNUM1 = S_KNUM1 + 2000
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 1000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 2000000 _CHBIT[8]=1
ENDIF
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 + 10000 - 10000000
ENDIF
IF (S_KNUM1 _DEC9)
S_KNUM1=S_KNUM1 - 100000000
_M_N[14]=_DP
ENDIF
ENDIF
_KNUM = S_KNUM1
ENDIF
_HA2:
S_PRNUM=ABS(S_PRNUM) S_PRNUM = S_PRNUM - ((S_PRNUM _DEC4)*1000)
IF (S_MVAR _DEC4) == 1
S_MVAR=S_MVAR - 1000 S_PRNUM = S_PRNUM + 1000
_MPKTA=1
ENDIF
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 2) GOTOF _M_ERR
IF (_H_KNUM==0)
S_MVAR=S_MVAR + 100 _KNUM=0
ENDIF
_MVAR=ABS(S_MVAR) _PRNUM = S_PRNUM _SETVAL=S_SETV _FA=ABS(S_FA) _TSA=ABS(S_TSA) _STA1=S_STA1
_CPA=S_CPA _CPO=S_CPO _INCA=S_INCA
_RF=$SCS_MEA_FEED_CIRCLE
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(_AMODE: dec1)"
_AMODE = ABS(_AMODE)
IF ((_AMODE _DEC1) > 1) GOTOF _M_ERR
_SERR=<<"(_AMODE: dec2)"
_AMODE = ABS(_AMODE)
IF ((_AMODE _DEC2) > 1) GOTOF _M_ERR
IF (_AMODE _DEC1) == 1
_TZL=ABS(S_TZL) _TDIF=ABS(S_TDIF) _TUL=S_TUL _TLL=S_TLL _M_N[23]=_M_N[23]+100
ELSE
_TZL=0 _TUL=1.01*(ABS(S_TSA)) _TLL=-_TUL _TDIF=_TUL
ENDIF
_CHBIT[4]=0
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 20 GOTOF _M_ERR
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 0
_CHBIT[4]=1
_K = ABS(S_K)
_TMV=ABS(S_TMV)
ELSE
_TMV=ABS((_TUL - _TLL)/3) _K=1
ENDIF
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC2)*10) + (S_EVNUM _DEC1)) > 20 GOTOF _M_ERR
IF S_EVNUM<>0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(S_TNAME)"
IF _H_KNUM==2
IF (((_H_KNUM _DEC1)==2) AND (S_TNAME == "")) GOTOF _M_ERR
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B1') OR ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10')
_TNAME =<< S_TNAME _TNUM = 0
ELSE
_TNAME=<<"" _TNUM = NUMBER(S_TNAME)
ENDIF
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
ELSE
_MVAR=_MVAR MOD 1000
ENDIF
IF(_PRNUM _DEC4 == 1)
_MPKTA = 1
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N697901 SETAL(_ALARM,_SERR)
RET
_M_ERA: _ALARM=61021 _OVI[9]=_ALARM
STOPRE
N697702 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
IF _PRNUM _DEC3==1
_PRNUM = _PRNUM - 100
ENDIF
ENDIF
ENDIF
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M120
_ALARM=0
IF($SCS_MEA_SIM_ENABLE == 9)
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
_OVI[2]=979
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1060 DIAMCYCOF G0 G90 G94
_HI[3] = _MVAR _DEC5 _ALARM=61307
IF (_MVAR MOD 10 <1)OR((_MVAR MOD 1000 >4)AND(_MVAR MOD 1000 <101))OR(_MVAR MOD 1000 >104) GOTOF _M120 IF (_NEW_PAR==1)AND(_HI[3]>2) GOTOF _M120
IF (_MVAR _DEC1 <= 2) AND (_RF <= 0)
_ALARM=61365
GOTOF _M120
ENDIF
IF (_MVAR _DEC1 <= 2)
IF (_MPKTA==1)
IF (ABS(_INCA)>90)OR(_INCA==0)
_ALARM=61443
GOTOF _M120
ENDIF
ELSE
IF (ABS(_INCA)>120)OR(_INCA==0)
_ALARM=61443
GOTOF _M120
ENDIF
ENDIF
ENDIF
_H_STA=_STA1 MOD 360 _HI[0]=_MVAR _DEC1
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HR[2]=$P_ADT[6]/2
ELSE
_HR[2]=$P_ADT[6]
ENDIF
IF _MVAR _DEC3 ==1
_VB[0]=1
ENDIF
IF (_HI[3] == 1)
_VB[18]=1 _INTERN[40+13]=0
ENDIF
IF (_HI[3] == 2)
_INTERN[40+27]=1 _VB[55]=1
ENDIF
IF (_INTERN[40+13]==1)AND((_HR[0]==712)OR(_HR[0]==713)OR(_HR[0]==714))
_INTERN[40+13]=0
ENDIF
N1070 CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_HI[2]=_M_SPE[54] MOD 100
IF _VB[3] AND _VB[2] AND _M_N[13]
_VB[18]=0 _HI[3]=0 _TMP_NPV=$P_GG[8]
IF _M_SPE[60]==2
_PL=-_M_SPE[27] _PT=-_M_SPE[28] _TRIGLAG=-_M_SPE[27]
IF(_INTERN[68] == 1)
_PL2=-_M_SPE[71] _PT2=-_M_SPE[72] _TRIGLAG2=-_M_SPE[71]
ENDIF
ENDIF
$P_PFRAME[SPI(_M_N[13]),TR]=0 $P_IFRAME[SPI(_M_N[13]),TR]=0
IF ($MC_MM_NUM_BASE_FRAMES)
$P_BFRAME[SPI(_M_N[13]),TR]=0
ENDIF
G[8]=_TMP_NPV
ELSE
IF ((_HI[3] ==1)OR(_HI[3] ==2))AND(_M_N[13])
_VB[2]=1 _VB[3]=1 _VB[55]=1 _INTERN[20+8]=0 _INTERN[40+13]=0 _TMP_NPV=$P_GG[8]
IF _M_SPE[60]==2
_TRIGLAG=-(_M_SPE[27])
IF(_INTERN[68] == 1)
_TRIGLAG2=-(_M_SPE[71])
ENDIF
ENDIF
$P_PFRAME[SPI(_M_N[13]),TR]=0 $P_IFRAME[SPI(_M_N[13]),TR]=0
IF ($MC_MM_NUM_BASE_FRAMES)
$P_BFRAME[SPI(_M_N[13]),TR]=0
ENDIF
IF _HI[3]==1
_TRIGLAG=_HR[2] _M_SPE[20]=0 _OVI[5]=0
IF(_INTERN[68] == 1)
_TRIGLAG2=_HR[2] _M_SPE[64]=0
ENDIF
ENDIF
G[8]=_TMP_NPV
ELSE
IF _M_SPE[60]==2
_PL=-_M_SPE[27] _PT=-_M_SPE[28]
IF(_INTERN[68] == 1)
_PL2=-_M_SPE[71] _PT2=-_M_SPE[72]
ENDIF
ENDIF
ENDIF
ENDIF
_ALARM=61307
IF (_INTERN[18]==0)AND(_HI[0]==4) GOTOF _M121
_ALARM=61341
IF _INTERN[20+16] AND(_VB[18]==0)AND((_HI[2] B_AND 'B0001'<>1)OR(_HI[2] B_AND 'B0010'<>2)) GOTOF _M121
_ALARM=61336
IF (_INTERN[2]==0)OR(_INTERN[10]==0) GOTOF _M121
_ALARM=0
_M5:_HI[1]=1 _M_ZUST[0]=1
IF(_INTERN[68] == 1)
_OVR[101]=_CPA/_M_SPE[29] _OVR[102]=_CPO/_M_SPE[29]
ENDIF
IF (_HI[0]==1)OR(_HI[0]==2) GOTOF _M6
_M_ZUST[6]=1
IF _HI[0] == 3
_VB[20]=1
ENDIF
_M6:IF (_HI[0]==1)OR (_HI[0]==3) GOTOF _M6A
_HI[1]=-1 _M_ZUST[4]=1
_M6A:IF (_HI[0]<>4) GOTOF _M7
_M_ZUST[5]=1
N1080 _M7: G111 AX[_XX]=_CPA AX[_YY]=_CPO
IF (_HR[2]+_M_SPE[3]) >= (_M_SPE[16]/2)
_M_SPE[3]=_M_SPE[16]/2 - _HR[2] - 0.1
ENDIF
_M_SPE[10]=(_M_SPE[16]/2-(_HR[2]+_M_SPE[3])*_HI[1]) _M_SPE[9]=_M_SPE[10]+_M_SPE[60]*_M_SPE[3]*_HI[1]
_M_ME[11]=_M_SPE[10]+_M_SPE[3]*_HI[1]
IF(_INTERN[68] == 1)
_M_ME[31]=_M_SPE[10]+_M_SPE[3]*_HI[1]
ENDIF
IF _VB[1] GOTOF _M81
N1100 G1 F=_M_SPE[1]
_M81:IF _INTERN[40+2] GOTOF _M83
N1110 RP=_M_SPE[10]*_M_SPE[29] AP=_H_STA
GOTOF _M86
_M83:_HR[3]=_CPA/_M_SPE[29]+_M_SPE[10]*COS(_H_STA) _HR[4]=_CPO/_M_SPE[29]+_M_SPE[10]*SIN(_H_STA)
IF (ABS(_HR[3]-_M_SPE[5])<0.001) AND (ABS(_HR[4]-_M_SPE[6])<0.001) GOTOF _M86
IF (_VB[2]==0)OR(_VB[55]) GOTOF _M85
_WINKEL=ATAN2(_HR[4]-_M_SPE[6],_HR[3]-_M_SPE[5])
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_WINKEL
ELSE
_M_SPE[8]= _M_SPE[61] +_WINKEL
ENDIF
IF _INTERN[20+8]
_M_SPE[8]=_M_SPE[8]+_M_SPE[38]
ENDIF
_M_SPE[8]=((_M_SPE[8] MOD 360)+360) MOD 360
IF _INTERN[40+18]
N112 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N113 SUPA SPOS=DC(_M_SPE[8])
ENDIF
_M85:
IF(_INTERN[68] == 0)
N1115 MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_H_STA
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _M86
ELSE
WHEN (($A_PROBE[ABS(_M_N[0])]==1) OR ($A_PROBE[ABS(_M_N[30])]==1)) DO DELDTG SYG_RS[1]=1
N111 MEASA[_XX]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_YY]=(_MODE_2MESS,_M_N[0],_M_N[30]) MEASA[_ZZ]=(_MODE_2MESS,_M_N[0],_M_N[30]) RP=_M_SPE[10]*_M_SPE[29] AP=_H_STA
STOPRE
IF (SYG_RS[1] == 0) GOTOF _M86
SYG_RS[1] = 0
ENDIF
_ALARM=61302
GOTOF _M122
_M86: _WINKEL=_H_STA
IF _VB[2]
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] - _H_STA
ELSE
_M_SPE[8]=_M_SPE[61] +_H_STA
ENDIF
ENDIF
IF _VB[18]
IF _M_ZUST[4]
_M_SPE[8]=_M_SPE[8]+180
ELSE
_M_SPE[8]=_M_SPE[8]+179.99
ENDIF
ENDIF
N1120 _M9:_M_ME[8]=0 _M_ME[9]=0
IF(_INTERN[68] == 1)
_M_ME[28]=0 _M_ME[29]=0
ENDIF
CYCLE112(_XX,_YY,_ZZ,_M_SPE,_M_ME,_WINKEL,_M_N,_ALARM,_M_ZUST,_VB,_INTERN)
IF _M_ZUST[0] GOTOF _PKT1 IF _M_ZUST[1] GOTOF _PKT2 IF _M_ZUST[2] GOTOF _PKT3 IF _M_ZUST[3] GOTOF _PKT4
_PKT1: IF _VB[18]==0 GOTOF _PKT1A IF _VB[26] GOTOF _PKT1A
_HR[1]=_M_ME[8] _HR[3]=_M_ME[9] _VB[26]=1
IF(_INTERN[68] == 1)
_HR[5]=_M_ME[28] _HR[6]=_M_ME[29]
ENDIF
IF _M_ZUST[4]==0
_M_SPE[8]=_M_SPE[8]-179.99
ENDIF
GOTOB _M9
_PKT1A:_VB[26]=0 _CAL[1]=_M_ME[8] _CAL[2]=_M_ME[9] _M_ZUST[0]=0 _M_ZUST[1]=1 _WINKEL=_H_STA+_INCA
IF(_INTERN[68] == 1)
_CAL2[1]=_M_ME[28] _CAL2[2]=_M_ME[29]
ENDIF
IF _VB[18]
_TRIGLAG=_TRIGLAG+(((SQRT(POT(_HR[1]-_OVR[1])+POT(_HR[3]-_OVR[2]))-SQRT(POT(_M_ME[8]-_OVR[1])+POT(_M_ME[9]-_OVR[2])))/2))*_HI[1]
IF(_INTERN[68] == 1)
_TRIGLAG2=_TRIGLAG2+(((SQRT(POT(_HR[5]-_OVR[101])+POT(_HR[6]-_OVR[102]))-SQRT(POT(_M_ME[28]-_OVR[101])+POT(_M_ME[29]-_OVR[102])))/2))*_HI[1]
ENDIF
ENDIF
IF _M_ZUST[6]==0 GOTOF _PKT1E
_WINKEL=_H_STA+180
_PKT1E: IF _VB[2] GOTOF _MONO
GOTOB _M9
_PKT2:_M_ZUST[1]=0 _M_ZUST[2]=1 _CAL[3]=_M_ME[8] _CAL[4]=_M_ME[9]
IF(_INTERN[68] == 1)
_CAL2[3]=_M_ME[28] _CAL2[4]=_M_ME[29]
ENDIF
IF _M_ZUST[6] GOTOF _M102
_WINKEL=_H_STA+2*_INCA _HINCA=2*_INCA
IF _VB[2] GOTOF _MONO
GOTOB _M9
_PKT3:_M_ZUST[2]=0 _M_ZUST[3]=1 _CAL[5]=_M_ME[8] _CAL[6]=_M_ME[9] _CAL[0]=3 _WINKEL=_H_STA+3*_INCA _HINCA=_HINCA+_INCA
IF(_INTERN[68] == 1)
_CAL2[5]=_M_ME[28] _CAL2[6]=_M_ME[29] _CAL2[0]=3
ENDIF
IF (_VB[2]) AND (_MPKTA==1) GOTOF _MONO IF (_MPKTA==1) GOTOB _M9
GOTOF _M102
_MONO:
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_WINKEL
ELSE
_M_SPE[8]= _M_SPE[61] +_WINKEL
ENDIF
IF _M_ZUST[2] AND _INTERN[19] AND _VB[55]
_M_SPE[8]=(_M_SPE[8]+180)MOD 360
ENDIF
GOTOB _M9
_PKT4:_CAL[7]=_M_ME[8] _CAL[8]=_M_ME[9] _CAL[0]=4
IF(_INTERN[68] == 1)
_CAL2[7]=_M_ME[28] _CAL2[8]=_M_ME[29] _CAL2[0]=4
ENDIF
_M102:_M_ZUST[7]=1
IF _M_ZUST[6] GOTOF _M102A
N1130 CYCLE116(_CAL,_ALARM)
IF _CAL[12] GOTOF _M123
IF(_INTERN[68] == 1)
N1131 CYCLE116(_CAL2,_ALARM)
IF _CAL2[12] GOTOF _M123
ENDIF
_OVR[5]=_CAL[9]+_PL _OVR[6]=_CAL[10]+_PT _OVR[4]=(_CAL[11]+_HI[1]*_TRIGLAG)*2+_HI[1]*_M_SPE[20]
IF(_INTERN[68] == 1)
_OVR[105]=_CAL2[9]+_PL2 _OVR[106]=_CAL2[10]+_PT2 _OVR[104]=(_CAL2[11]+_HI[1]*_TRIGLAG2)*2+_HI[1]*_M_SPE[64]
ENDIF
GOTOF _M103
_M102A: _OVR[5]=(_CAL[1]+_CAL[3])/2 _OVR[6]=(_CAL[2]+_CAL[4])/2 _OVR[4]=(SQRT(POT(_CAL[3]-_CAL[1])+POT(_CAL[4]-_CAL[2]))+2*_TRIGLAG*_HI[1])+_HI[1]*_M_SPE[20]
_CAL[0]=_PL*COS(_H_STA)+_PT*SIN(_H_STA) _OVR[5]=_OVR[5]+_CAL[0]*COS(_H_STA) _OVR[6]=_OVR[6]+_CAL[0]*SIN(_H_STA)
IF(_INTERN[68] == 1)
_OVR[105]=(_CAL2[1]+_CAL2[3])/2 _OVR[106]=(_CAL2[2]+_CAL2[4])/2 _OVR[104]=(SQRT(POT(_CAL2[3]-_CAL2[1])+POT(_CAL2[4]-_CAL2[2]))+2*_TRIGLAG2*_HI[1])+_HI[1]*_M_SPE[64]
_CAL2[0]=_PL2*COS(_H_STA)+_PT2*SIN(_H_STA) _OVR[105]=_OVR[105]+_CAL2[0]*COS(_H_STA) _OVR[106]=_OVR[106]+_CAL2[0]*SIN(_H_STA)
ENDIF
_M103:_M_ZUST[0]=1 _M_ZUST[1]=0 _M_ZUST[2]=0 _M_ZUST[3]=0
_OVI[6]=SET(0,_M_N[22] MOD 10000)
IF _VB[0] GOTOF _M105
IF _M_N[22]>9999
_OVI[6]=_M_N[22] DIV 10000
ELSE
_OVI[6]=_OVI[7]
ENDIF
_M105: IF _OVI[7]==0 GOTOF _M107
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF(_INTERN[68] == 1)
_OVR[130]=_HR[0]
ENDIF
IF _INTERN[40+5]==0 GOTOF _M106
_HR[0]=-_HR[0]
_M106:_OVR[4]=_OVR[4]-_HR[0]
IF(_INTERN[68] == 1)
_OVR[104]=_OVR[104]-_HR[0]
ENDIF
_M107:
IF (_AMODE _DEC2) == 1
_OVR[1]=S_MPVAL1/_M_SPE[29] _OVR[2]=S_MPVAL2/_M_SPE[29]
ELSE
_OVR[1]=_CPA/_M_SPE[29] _OVR[2]=_CPO/_M_SPE[29]
ENDIF
_OVR[16]=SET(_OVR[4]-_OVR[0],_OVR[5]-_OVR[1],_OVR[6]-_OVR[2])
IF(_INTERN[68] == 1)
_OVR[116]=SET(_OVR[104]-_OVR[100],_OVR[105]-_OVR[101],_OVR[106]-_OVR[102])
ENDIF
IF (_VB[0] == 0)
IF (ABS(_OVR[16]) > _M_SPE[34])
_ALARM=61306
ENDIF
IF (ABS(_OVR[16]) > _M_SPE[32])
_ALARM=61303
ENDIF
ELSE
IF (ABS(_OVR[17]) > _M_SPE[32]) OR (ABS(_OVR[18]) > _M_SPE[32])
_ALARM=61303
ENDIF
IF ((_AMODE _DEC2 == 1) AND ((S_CPA <> S_MPVAL1) OR (S_CPO <> S_MPVAL2)))
_ALARM = 0
ENDIF
ENDIF
IF (_ALARM == 61303) OR (_ALARM == 61306)
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==1
N1150 SETAL(_ALARM+1000)
N1160 M0
STOPRE
ENDIF
_M_ZUST[7]=0 _ALARM=0
ENDIF
ENDIF
IF (_M_ZUST[7] == 0)
_WINKEL=_H_STA _VB[27]=1 _M_ZUST[0]=1 _INTERN[40+2]=0
IF _VB[2]==0 GOTOB _M9
IF _VB[31]==0
IF _INTERN[40+18]
CUST_MEACYC(3,_HINCA,4)
ELSE
SPOS=IC(_HINCA)
ENDIF
_M_SPE[8]=360-_WINKEL
ELSE
IF _INTERN[40+18]
CUST_MEACYC(3,-_HINCA,4)
ELSE
SPOS=IC(-_HINCA)
ENDIF
_M_SPE[8]=_WINKEL
ENDIF
GOTOB _M9
ENDIF
IF _VB[2]
IF _VB[31]==0
IF _INTERN[40+18]
CUST_MEACYC(3,_HINCA,4)
ELSE
SPOS=IC(_HINCA)
ENDIF
_M_SPE[8]=360-_H_STA
ELSE
IF _INTERN[40+18]
CUST_MEACYC(3,-_HINCA,4)
ELSE
SPOS=IC(-_HINCA)
ENDIF
_M_SPE[8]=_H_STA
ENDIF
ENDIF
_OVR[28]=_OVR[28]/_M_SPE[29]
IF(_INTERN[68] == 1)
_OVR[128]=_OVR[128]/_M_SPE[29]
ENDIF
IF (_ALARM AND _VB[0]) GOTOF _M125
IF (_VB[0] == 0)
_OVR[20]=_OVR[16] _OVI[4]=_M_N[23] MOD 100 _OVR[8]=_M_SPE[35]/_M_SPE[29] _OVR[12]=_M_SPE[36]/_M_SPE[29]
_OVI[0]=_M_N[11] _OVR[29]=_M_SPE[34] _OVR[27]=_M_SPE[33]
IF(_INTERN[68] == 1)
_OVR[120]=_OVR[116] _OVR[108]=_M_SPE[35]/_M_SPE[29] _OVR[112]=_M_SPE[36]/_M_SPE[29]
_OVR[129]=_M_SPE[34] _OVR[127]=_M_SPE[33]
ENDIF
IF _ALARM GOTOF _M125
IF ABS(_OVR[20]) > _M_SPE[15]
IF (_M_ZUST[4] AND (_OVR[4]>_OVR[0])) OR ((_M_ZUST[4]==0) AND (_OVR[4]<_OVR[0]))
_ALARM=61304
ELSE
_ALARM=61305
ENDIF
ENDIF
CYCLE114(2,_ALARM,_MAV,0,_M_SPE[37],_M_N[23],_INTERN[40+4],_H_BOOL)
IF _H_BOOL==0
IF ABS(_OVR[20]) <= _M_SPE[33]
CYCLE114(4,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
GOTOF _M118
ENDIF
ENDIF
IF (_M_ZUST[4] <> 0)
_OVR[20]=-_OVR[20]
IF(_INTERN[68] == 1)
_OVR[120]=-_OVR[120]
ENDIF
ENDIF
_OVR[20]=_OVR[20]/2
IF(_INTERN[68] == 1)
_OVR[120]=_OVR[120]/2
ENDIF
IF ((_INTERN[20+2]==0) OR ((_INTERN[20+2]==1) AND (_ALARM<>61304) AND (_ALARM<>61305)))
CYCLE114(3,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
GOTOF _M125
_M118:
IF (_OVI[6] <> 0)
IF _INTERN[40+4]==1
_MV[_OVI[6]-1]=_OVR[20] _OVR[31]=_OVR[20] $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=_OVR[20]
ELSE
_MV[_OVI[6]-1]=0 _OVR[31]=0 $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=0
ENDIF
ENDIF
_OVR[20]=0
GOTOF _M125
ENDIF
IF (_KNUM <> 0)
_OVI[0]=_KNUM
IF (_INTERN[40+21]==0)
_ADD=1
ELSE
_ADD=0
ENDIF
CYCLE115(_ALARM,_MAV,_ADD,_NEW_PAR)
ENDIF
IF _ALARM==0 GOTOF _M125
STOPRE
_M120:_OVI[9]=_ALARM
N697920 SETAL(_ALARM)
STOPRE
_M121:_OVI[9]=_ALARM
N697921 SETAL(_ALARM)
STOPRE
_M122:_OVI[9]=_ALARM
N697922 SETAL(_ALARM)
STOPRE
_M123:_OVI[9]=_ALARM
N697923 SETAL(_ALARM)
STOPRE
_M124:_OVI[9]=_ALARM
N697924 SETAL(_ALARM)
STOPRE
_M125:_OVI[9]=_ALARM
IF ((_ALARM>=61303)AND(_ALARM<=61306)OR (_ALARM==0)) GOTOF _M127
N697925 SETAL(_ALARM)
_M130: M0
STOPRE
N697726 SETAL(61327)
GOTOB _M130
_M127: _PROTVAL[29] = _PROTVAL[29] <<"F"<<_M_SPE[0]
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M129A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M129
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N1153 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
IF(_INTERN[68] == 1)
_OVR[_HI[0]+100]=_OVR[_HI[0]+100]*_M_SPE[29]
ENDIF
ENDFOR
ENDIF
IF(_INTERN[68] == 1)
FOR _HI[0]=0 TO 29
_OVR[_HI[0]+900]=(_OVR[_HI[0]+100]+_OVR[_HI[0]])/2
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M128 IF _M_N[28]==2 GOTOF _M129
G4 F8
N1160 _M128: CYCLE102(0)
N1200 _M129:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
IF(_INTERN[68] == 1)
_OVR[_HI[0]+100]=_OVR[_HI[0]+100]*(1/_M_SPE[29])
ENDIF
ENDFOR
ENDIF
N1200 _M129A:
IF(_INTERN[68] == 1)
FOR _HI[0]=0 TO 29
_OVR[_HI[0]+900]=(_OVR[_HI[0]+100]+_OVR[_HI[0]])/2
ENDFOR
ENDIF
IF _ALARM
STOPRE
_OVI[9]=_ALARM
IF (_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF (_ALARM>61303)
IF _INTERN[20+2]
N1230 SETAL(_ALARM+1000)
N1240 M0
STOPRE
IF ((_ALARM==61304) OR (_ALARM==61305))
CYCLE114(3,_ALARM,_MAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697927 SETAL(_ALARM)
ENDIF
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N697928 SETAL(_ALARM)
ENDIF
ENDIF
ENDIF
IF _NEW_PAR
_CHBIT[4]=_CHBIT_S[4] _CHBIT[6]=_CHBIT_S[6] _CHBIT[8]=_CHBIT_S[8] _CHBIT[21]=_CHBIT_S[21]
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
IF(_INTERN[68] == 1)
_OVR[_HI[0]+100]=_OVR[_HI[0]+100]*_M_SPE[52]
ENDIF
ENDFOR
ENDIF
M17
N697929 _ENDE: SETAL(62301)
M0
_GENDE: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE982_SPF
PROC CYCLE982(INT S_MVAR,INT S_KNUM,INT S_PRNUM,INT S_MA,INT S_MD,REAL S_ID,REAL S_FA,REAL S_TSA,REAL S_VMS,REAL S_STA1,REAL S_CORA,REAL S_TZL,REAL S_TDIF,INT S_NMSP,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.20.00.00.013 ;DATE: 2020-05-03
;tool measurement and calibrate tool probe
DEF BOOL _INTERN[70],_M_ZUST[19],_VB[56],_H_RINMA,_H_HB,_BEL_WI=0,_OK_TW=0,_NEW_PAR=0,_FRAES_DREH=0,S_TW_TAUSCH=0
DEF REAL _M_SPE[64],_M_ME[120],_P_POS,_TRIGLAG,_KOR_TOOLL[3],_IW_SOLL,_LTP4,_LTP5,S_AC_MEAS_RESULT3,S_AC_MEAS_RESULT4,S_AC_MEAS_RESULT5,S_TAUSCH
DEF REAL _HR[13],_DAT[3,6],_KF[3,3],_LTP[10],_LTP_R[10],_TOOLR,_LTA_MAT[3,3],_GC_LEN[11],_SOLL_L1,_SOLL_L2,_IW_RESU,_MD_RESU,S_V_WKS[4,3],S_V_MKS[4,3]
DEF INT _M_N[30],_ALARM,_P_PROB,_P_PL,_P_PT,_MESSR,_AXIND,_SPECD=0,_H_MVAR,_GEOAX,S_ADAPT_TRAFO_NR,_K_STAT_SAVE[3]=REP(0)
DEF INT _HI[4],_H1,_HM=1,_H_XX=1,_H_YY=1,_H_ZZ=1,_H_STMV[8],_H_WZT,_HH_WZT,_MPCOUNT=1,_MPSOLL=1,_HMA,_MAAC,_AD2,_H_MD,_AD2_TAB[10],_UMSTAT,_ZAEHL,_DUMMY=0,_H_SIM,_CORCOMP,_CORMODE
DEF INT _LTA_ST,_LTA_AXI[3],_GC_ST,_TNO,_DNO,_K_STAT_PL,_K_STAT_ABS,_K_STAT_ORD,_K_STAT_APP,_K_STAT_CYC,_K_STAT_KOORD,_AGV[4],_GUD_SD,_H_DMODE,_S_MVAR_INTERN,_SC_TLC=0,_TEMP,_H_AMODE[4],_TEMP_ON
DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_HF1,_HF2,_SP
DEF STRING[2] _COMP=""
DEF STRING[10] _M_SPE20
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE982_MPF",_S_XX,_S_YY,_S_ZZ
DEF STRING[100] _SERR=""
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE982_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19") ; aktive Ebene
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...") ; Inch/Metrisch
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...") ; DIAMON/DIAMOF/DIAM90
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...") ; aktive Einstellbare Nullpunktverschiebung
WRITE(_TEMP,_TEMP_FILE,";CYCLE982("<<S_MVAR<<","<<S_KNUM<<","<<S_PRNUM<<","<<S_MA<<","<<S_MD<<","<<S_ID<<","<<S_FA<<","<<S_TSA<<","<<S_VMS<<","<<S_STA1<<","<<S_CORA<<","<<S_TZL<<","<<S_TDIF<<","<<S_NMSP<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _AMODE=ABS(_AMODE)
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) > 2) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec2)"
IF ((S_MVAR _DEC2) > 1) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 1) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4) > 3) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 1) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec6)"
IF ((S_MVAR _DEC6) > 1) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec7)"
IF ((S_MVAR _DEC7) > 1) GOTOF _M_ERR
_PRNUM=ABS(S_PRNUM) _MA=ABS(S_MA) _MD=ABS(S_MD) _ID=S_ID _FA=ABS(S_FA) _TSA=ABS(S_TSA) _TDIF=ABS(S_TDIF)
_STA1=S_STA1 _CORA=((S_CORA MOD 360)+360) MOD 360
IF S_VMS <> 0
_VMS = ABS(S_VMS)
ELSE
_VMS=$SCS_MEA_TP_FEED_MEASURE
ENDIF
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(S_KNUM:)"
IF (S_KNUM > 1) GOTOF _M_ERR
_CHBIT[3]=0
IF ((S_KNUM _DEC1) == 1)
_CHBIT[3]=1
ENDIF
IF ((S_MVAR _DEC1)==0)
_TZL=0
ELSE
_TZL=ABS(S_TZL)
ENDIF
_CHBIT[20]=1
IF ((S_MVAR _DEC7)==1)
_CHBIT[20]=0 S_MVAR=S_MVAR - 1000000
ENDIF
_S_MVAR_INTERN=S_MVAR
_H_STMV[0]=(S_MVAR _DEC1) _H_STMV[1]=(S_MVAR _DEC2) _H_STMV[2]=(S_MVAR _DEC3) _H_STMV[3]=(S_MVAR _DEC4) _H_STMV[4]=(S_MVAR _DEC5) _H_STMV[5]=(S_MVAR _DEC6) _H_STMV[6]=(S_MVAR _DEC7)
IF ( ((_DMODE _DEC3)==1)AND(_H_STMV[0]==2) )
IF (_H_STMV[3]==2)
_H_STMV[3]=0
ELSE
IF (_H_STMV[3]==3)
_H_STMV[3]=4
ENDIF
ENDIF
_S_MVAR_INTERN=_H_STMV[0]+10*_H_STMV[1]+100*_H_STMV[2]+1000*_H_STMV[3]+10000*_H_STMV[4]+100000*_H_STMV[5]+1000000*_H_STMV[6]
ENDIF
_MVAR=ABS(_S_MVAR_INTERN)
IF S_EVNUM<>0
_CHBIT[4]=0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF( (_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)AND NOT(($SC_TOOL_LENGTH_TYPE==0)AND((ABS($P_AD[1] _DEC3))==2)) )
G[6]=_H_DMODE
ENDIF
_H_AMODE[3]=_AMODE _DEC4
_SERR=<<"(_AMODE: dec4)"
IF ( (_H_AMODE[3]<0)OR(_H_AMODE[3]>1) ) GOTOF _M_ERR
_NEW_PAR=1 _M_SPE[3]=1
ELSE
IF _SMI_R[10] >99
_M_SPE[3]=1
ELSE
_H_STMV[0]=ABS(_MVAR _DEC1)
IF ( (_VMS==0)AND(_H_STMV[0]==0) )
_VMS=$SCS_MEA_TP_FEED_MEASURE
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N698201 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0 _SERR=""
IF (_SC_Y_TURN<>0)
SETAL(61058,"'"'Measure Y-TURN'"'")
ENDIF
_ALARM=61314
_H_WZT=$P_AD[1] _HH_WZT=_H_WZT
IF (_H_WZT>799) GOTOF _FEHL4
IF ((_H_WZT>599) AND (_H_WZT<711)) GOTOF _FEHL4
_H_WZT=(_H_WZT DIV 100)
IF (_H_WZT==7)
_H_WZT=1
ENDIF
IF ((_H_WZT<>1)AND(_H_WZT<>5)AND(_H_WZT<>2)) GOTOF _FEHL4
IF ( (_H_WZT==5)AND(((_HH_WZT _DEC2)<>8)AND((_HH_WZT _DEC1)==5)) ) GOTOF _FEHL4
_PROTVAL[25]="" _PROTVAL[26]="" _PROTVAL[27]="" _PROTVAL[28]=""
_STA1=((_STA1 MOD 360)+360) MOD 360
_SC_TLC=($SC_TOOL_LENGTH_CONST) MOD 100
IF ( ($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1) )
_FRAES_DREH=1
IF ($SC_TOOL_LENGTH_TYPE==3)
IF (_H_WZT==5)
_SC_TLC=($SC_TOOL_LENGTH_CONST_T) MOD 100
ELSE
_SC_TLC=($SC_TOOL_LENGTH_CONST) MOD 100
ENDIF
ENDIF
ENDIF
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10000000')
IF ( ISVAR("$TC_MPP7["<<$A_MYMN[$P_TOOLNO]<<","<<$A_MYMLN[$P_TOOLNO]<<"]") )
IF ( (($TC_MPP7[$A_MYMN[$P_TOOLNO],$A_MYMLN[$P_TOOLNO]])<>0)OR(($TC_MPP7[$A_TOOLMN[$P_TOOLNO],$A_TOOLMLN[$P_TOOLNO]])<>0) )
_ALARM=61024 _SERR="SD42950 $SC_TOOL_LENGTH_TYPE"
IF ( ((_H_WZT==1)OR(_H_WZT==2))AND($SC_TOOL_LENGTH_TYPE<>2) ) GOTOF _FEHL19
IF ( (_H_WZT==5)AND(($SC_TOOL_LENGTH_TYPE<>0)AND($SC_TOOL_LENGTH_TYPE<>2)) ) GOTOF _FEHL19
ENDIF
ENDIF
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _FEHL1
_ALARM=0 _SERR=""
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF ("_N_CYCLE972_SPF"==$P_PROG[$P_STACK-1])
_OVI[2]=972
ELSE
_OVI[2]=982
ENDIF
_VB[50]=1
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
_P_PROB=_M_N[21]-1
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
_ALARM=61935
IF ($MN_SCALING_SYSTEM_IS_METRIC)
IF ( ($P_GG[13]==1)OR($P_GG[13]==3) )
GOTOF _FEHL22
ENDIF
ELSE
IF ( ($P_GG[13]==2)OR($P_GG[13]==4) )
GOTOF _FEHL22
ENDIF
ENDIF
_ALARM=0 _SERR=""
ENDIF
IF ($MN_SCALING_SYSTEM_IS_METRIC)
N1056 G71
ELSE
N1057 G70
ENDIF
N1058 DIAMOF G0 G94 G90
_ALARM=61307
_H_STMV[0]=(_MVAR _DEC1)
_H_STMV[1]=(_MVAR _DEC2)
_H_STMV[2]=(_MVAR _DEC3)
_H_STMV[3]=(_MVAR _DEC4)
_H_STMV[4]=(_MVAR _DEC5)
_H_STMV[5]=(_MVAR _DEC6)
_H_STMV[6]=(_MVAR _DEC7)
IF (_NEW_PAR)
IF (_H_STMV[0]==0)
IF ( (_HH_WZT==585)OR(_HH_WZT==725) )
_H_STMV[7]=0
ELSE
_H_STMV[7]=1
ENDIF
ELSE
_H_STMV[7]=0
ENDIF
ELSE
_H_STMV[7]=(_MVAR _DEC8)
ENDIF
_H_MVAR=_MVAR MOD 1000000
IF ( (_OVI[2]==972) AND (_INTERN[20+7]) ) GOTOF _FEHL3
IF ( (_H_STMV[0]>2)OR(_H_STMV[1]>1)OR(_H_STMV[2]>1)OR(_H_STMV[3]>4)OR(_H_STMV[4]>1)OR(_H_STMV[5]>1)OR(_H_STMV[6]>8)OR(_H_STMV[7]>1)OR(_MVAR>18114112) ) GOTOF _FEHL3
IF ( ($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1)AND(_H_STMV[0]==0) ) GOTOF _FEHL3
IF (_INTERN[20+7]==1)
_LTA_ST=LENTOAX(_LTA_AXI,_LTA_MAT)
_ALARM=61440
IF _LTA_ST<0 GOTOF _FEHL8
IF ( (ABS(_M_SPE[39]))>1 )
_ALARM=61021 _SERR="_CM[8]"
GOTOF _FEHL16
ENDIF
_HR[12]=SIN(ABS(_M_SPE[39]))+ COS(ABS(_M_SPE[39]))
_ALARM=61441
IF (ABS(_LTA_AXI[0]) OR ABS(_LTA_AXI[1]))==3 GOTOF _FEHL9
_ALARM=61025
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
IF ( _HR[12]<(ABS(_LTA_MAT[0,2])+ABS(_LTA_MAT[1,2])+ABS(_LTA_MAT[2,2])) ) GOTOF _FEHL10
IF ( (_HR[12]<(ABS(_LTA_MAT[0,0])+ABS(_LTA_MAT[1,0])+ABS(_LTA_MAT[2,0])))OR(_HR[12]<(ABS(_LTA_MAT[0,1])+ABS(_LTA_MAT[1,1])+ABS(_LTA_MAT[2,1]))) )
_BEL_WI=1
ENDIF
GOTOF _END_SC_TLC
_P19_M17:
IF ( _HR[12]<(ABS(_LTA_MAT[0,1])+ABS(_LTA_MAT[1,1])+ABS(_LTA_MAT[2,1])) ) GOTOF _FEHL10
IF ( (_HR[12]<(ABS(_LTA_MAT[0,0])+ABS(_LTA_MAT[1,0])+ABS(_LTA_MAT[2,0])))OR(_HR[12]<(ABS(_LTA_MAT[0,2])+ABS(_LTA_MAT[1,2])+ABS(_LTA_MAT[2,2]))) )
_BEL_WI=1
ENDIF
GOTOF _END_SC_TLC
_P17_M19:
IF ( _HR[12]<(ABS(_LTA_MAT[0,0])+ABS(_LTA_MAT[1,0])+ABS(_LTA_MAT[2,0])) ) GOTOF _FEHL10
IF ( (_HR[12]<(ABS(_LTA_MAT[0,1])+ABS(_LTA_MAT[1,1])+ABS(_LTA_MAT[2,1])))OR(_HR[12]<(ABS(_LTA_MAT[0,2])+ABS(_LTA_MAT[1,2])+ABS(_LTA_MAT[2,2]))) )
_BEL_WI=1
ENDIF
GOTOF _END_SC_TLC
_END_SC_TLC:
_ALARM=61442
IF ( (_BEL_WI==1)AND((_H_STMV[0]==0)OR((_HH_WZT<>500)AND(_HH_WZT<>510)AND(_HH_WZT<>550))OR(_H_WZT==1)OR(_H_WZT==2)) ) GOTOF _FEHL11
IF ( _BEL_WI==1 )
IF ((_HH_WZT==500)OR(_HH_WZT==510))
_ALARM=61445
IF ( (($P_ADT[2]>=1)AND($P_ADT[2]<=4))AND(($P_ADT[10]<90)OR($P_ADT[10]>=180)) ) GOTOF _FEHL12
IF ( (($P_ADT[2]>=5)AND($P_ADT[2]<=8))AND(($P_ADT[10]<=0)OR($P_ADT[10]>=90)) ) GOTOF _FEHL12
_ALARM=61446
IF (180-$P_ADT[10]-$P_ADT[24]<=0) GOTOF _FEHL13
ENDIF
ENDIF
_ALARM=0 _SERR=""
ENDIF
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
_SOLL_L1=$P_ADT[3]+$P_ADT[12] _SOLL_L2=$P_ADT[4]+$P_ADT[13]
GOTOF _END_SC_TLC
_P19_M17:
_SOLL_L1=$P_ADT[3]+$P_ADT[12] _SOLL_L2=$P_ADT[5]+$P_ADT[14]
GOTOF _END_SC_TLC
_P17_M19:
_SOLL_L1=$P_ADT[4]+$P_ADT[13] _SOLL_L2=$P_ADT[5]+$P_ADT[14]
GOTOF _END_SC_TLC
_END_SC_TLC:
_ALARM=61307
IF (_HH_WZT==725)
IF ((_H_MVAR==0)OR(_H_MVAR==10)OR(_H_MVAR==100000)OR(_H_MVAR==100010))
GOTOF _MVAROK
ELSE
GOTOF _FEHL3
ENDIF
ENDIF
IF (_H_WZT==5)
IF (_H_STMV[4]==1)
_H_MVAR=_H_MVAR-10000 _H_STMV[4]=0
ENDIF
IF ((_H_MVAR==0)OR(_H_MVAR==1)OR(_H_MVAR==2)OR(_H_MVAR==10)OR(_H_MVAR==11)OR(_H_MVAR==12)OR(_H_MVAR==100000)OR(_H_MVAR==100001)OR(_H_MVAR==100010)OR(_H_MVAR==100011))
GOTOF _MVAROK
ELSE
GOTOF _FEHL3
ENDIF
ENDIF
IF ( (_H_STMV[0]==0)OR(_H_STMV[7]>0)OR(_H_STMV[6]>0) ) GOTOF _FEHL3
IF ( (_H_WZT==2)AND(_H_STMV[3]<>0) ) GOTOF _FEHL3
IF ( (_H_STMV[5]==1)AND(_H_STMV[0]==2) ) GOTOF _FEHL3
IF ( (_H_STMV[5]==1)AND(_H_STMV[3]>1) ) GOTOF _FEHL3
IF ( (_H_STMV[3]>2)AND(_H_STMV[0]<>2) ) GOTOF _FEHL3
IF ( (_H_STMV[3]==1)AND(_H_STMV[0]==2) ) GOTOF _FEHL3
IF ( (_H_STMV[3]==2)AND(_H_STMV[0]==2) ) GOTOF _FEHL3
IF (_INTERN[20+7]==1)
IF ( ((_H_STMV[3]==3)AND(_H_STMV[0]==2)) OR ((_H_STMV[3]==4)AND(_H_STMV[0]==2)) ) GOTOF _FEHL3
ENDIF
IF _INTERN[40+20]
IF ((_H_STMV[0]<>1)OR(_H_STMV[2]<>0)OR(_H_STMV[3]>1))
GOTOF _FEHL3
ENDIF
ENDIF
_MVAROK:
_M_SPE20=<<_M_SPE[20]
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
IF (_M_SPE20=="-777")
_GUD_SD=2
ELSE
_AGV[3]=INDEX(_M_SPE20,"3") _AGV[2]=INDEX(_M_SPE20,"2") _AGV[1]=INDEX(_M_SPE20,"1") _AGV[0]=INDEX(_M_SPE20,"0")
IF ( (_AGV[3]==(-1))AND(_AGV[2]==(-1))AND(_AGV[1]==(-1))AND(_AGV[0]==(-1)) )
_GUD_SD=2
IF (_H_STMV[1]==1)
_TPW[_P_PROB,0]=SET($SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB],$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB],$SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB],$SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB])
_TPW[_P_PROB,8]=$SNS_MEA_TPW_TYPE[_P_PROB]
ELSE
_TP[_P_PROB,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB],$SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB])
_TP[_P_PROB,8]=$SNS_MEA_TP_TYPE[_P_PROB]
ENDIF
ELSE
IF ( (_AGV[3]<>(-1))AND(_AGV[2]<>(-1))AND(_AGV[1]<>(-1))AND(_AGV[0]<>(-1)) )
_GUD_SD=1
ELSE
_ALARM=61375
GOTOF _FEHL17
ENDIF
ENDIF
ENDIF
ENDIF
IF ( (($P_TC) AND ($P_TRAFO>0)) AND (($P_TRAFO<256) OR ($P_TRAFO>1024)) )
_ALARM=61099 _SERR="TRAORI und TOOLCARRIER aktiv"
GOTOF _FEHL2
ENDIF
IF (_H_STMV[5]==1)
IF ((_MD==0)OR(_MD==1))
_H_MD=_MD
ELSE
_ALARM=61326
GOTOF _FEHL3
ENDIF
ENDIF
_HMA=_MA
_ALARM=61117
IF ( (_H_WZT==1) AND (((_H_STMV[4]==1)AND(_HMA==1)) OR ((_H_STMV[4]==0)AND(_HMA==2))) AND ($P_TOOLR<=0) )
GOTOF _FEHL4
ENDIF
IF (_H_WZT==2)
IF ( (((_H_STMV[4]==1)AND(_HMA==1)) OR ((_H_STMV[4]==0)AND(_HMA==2))) AND (_H_STMV[0]==1) )
IF ($P_TOOLR<=0)
GOTOF _FEHL4
ELSE
_TOOLR=$P_TOOLR
ENDIF
ELSE
_TOOLR=0
ENDIF
ELSE
_TOOLR=$P_TOOLR
ENDIF
_ALARM=0 _SERR=""
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
IF _ALARM>0 GOTOF _FEHL1
IF (_H_STMV[1]==0)
_K_STAT_PL=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC1
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC3
_K_STAT_APP=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC4
_K_STAT_CYC=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC5
_K_STAT_KOORD=((10*($SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC7))+($SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC6))
IF (_H_STMV[0]==0)
IF ( (_K_STAT_PL<>0)AND((_K_STAT_PL<>$P_GG[6])OR(_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM)OR($SNS_MEA_TP_FEED[_P_PROB]<(_M_SPE[0]-1))OR($SNS_MEA_TP_FEED[_P_PROB]>(_M_SPE[0]+1))) )
$SNS_MEA_TP_STATUS_GEN[_P_PROB]=0 _K_STAT_PL=0 $SNS_MEA_TP_FEED[_P_PROB]=0
$SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]) $SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB])
$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]) $SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB])
ENDIF
ELSE
_ALARM=61385
IF ( (_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM)AND(_FRAES_DREH==0) )
GOTOF _FEHL23
ENDIF
_ALARM=61341
IF ( (_K_STAT_PL==0)AND(_FRAES_DREH) ) GOTOF _FEHL14
IF ( (_K_STAT_PL<>$P_GG[6])AND(_FRAES_DREH==0) )
IF (_H_WZT<>2)
GOTOF _FEHL14
ELSE
IF ($SC_TOOL_LENGTH_TYPE==2) GOTOF _FEHL14
ENDIF
ENDIF
IF ( (_H_STMV[0]==2)AND(_FRAES_DREH==0)AND((_K_STAT_ABS==0)OR(_K_STAT_ORD==0)) ) GOTOF _FEHL14
_ALARM=61444
IF ( (_M_SPE[0])<>($SNS_MEA_TP_FEED[_P_PROB]) ) GOTOF _FEHL18
ENDIF
ELSE
_K_STAT_PL=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC1
_K_STAT_ABS=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC3
_K_STAT_APP=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC4
_K_STAT_CYC=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC5
_K_STAT_KOORD=((10*($SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC7))+($SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC6))
IF (_H_STMV[0]==0)
IF ( (_K_STAT_PL<>0)AND((_K_STAT_PL<>$P_GG[6])OR(_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM)OR($SNS_MEA_TPW_FEED[_P_PROB]<(_M_SPE[0]-1))OR($SNS_MEA_TPW_FEED[_P_PROB]>(_M_SPE[0]+1))) )
$SNS_MEA_TPW_STATUS_GEN[_P_PROB]=0 _K_STAT_PL=0 $SNS_MEA_TPW_FEED[_P_PROB]=0
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]) $SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB])
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]) $SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB]=ROUND($SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB])
ENDIF
ELSE
_ALARM=61385
IF ( (_K_STAT_KOORD<>$MCS_DISP_COORDINATE_SYSTEM)AND(_FRAES_DREH==0) )
GOTOF _FEHL23
ENDIF
_ALARM=61341
IF ( (_K_STAT_PL==0)AND(_FRAES_DREH) ) GOTOF _FEHL14
IF ( (_K_STAT_PL<>$P_GG[6])AND(_FRAES_DREH==0) )
IF (_H_WZT<>2)
GOTOF _FEHL14
ELSE
IF ($SC_TOOL_LENGTH_TYPE==2) GOTOF _FEHL14
ENDIF
ENDIF
IF ( (_H_STMV[0]==2)AND(_FRAES_DREH==0)AND((_K_STAT_ABS==0)OR(_K_STAT_ORD==0)) ) GOTOF _FEHL14
_ALARM=61444
IF ( (_M_SPE[0])<>($SNS_MEA_TPW_FEED[_P_PROB]) ) GOTOF _FEHL18
ENDIF
ENDIF
_M_N[15]=ABS(_M_N[15]) _M_N[16]=ABS(_M_N[16]) _M_N[17]=ABS(_M_N[17])
IF ( (_H_WZT==5)OR(_HH_WZT==725) )
IF (_INTERN[20+7]==0)
_AD2=$P_ADT[2]
IF _INTERN[40+23]
_AD2_TAB[1]=SET(2,1,4,3,7,6,5,8,9)
_AD2=_AD2_TAB[_AD2]
ENDIF
ELSE
_AD2=_M_N[24]
ENDIF
ENDIF
_LAGEOK: _ALARM=0 _SERR=""
_VB[3]=0
IF (_H_STMV[5]==1)
_INTERN[40+3]=0
_M_SPE[33]=0
ENDIF
_ALARM=61314
IF ( (_H_WZT==5) AND ($SC_TOOL_LENGTH_TYPE==1) ) GOTOF _FEHL4
IF (_INTERN[20+7]==0)
IF ((_H_WZT==1)AND($SC_TOOL_LENGTH_TYPE<>2)) GOTOF _FEHL4
IF ((_H_WZT==2)AND($SC_TOOL_LENGTH_TYPE<>2))
IF ($SC_TOOL_LENGTH_TYPE==0)
IF ($P_GG[6]==1)
_SPECD=1
ENDIF
IF ($P_GG[6]==3)
_SPECD=2
ENDIF
IF ($P_GG[6]==2)
GOTOF _FEHL4
ENDIF
ELSE
GOTOF _FEHL4
ENDIF
ENDIF
ELSE
IF ( ((_H_WZT==1)OR(_H_WZT==2))AND(($SC_TOOL_LENGTH_TYPE<>2)OR($P_GG[6]<>2)) ) GOTOF _FEHL4
ENDIF
_ALARM=61351
IF (_H_STMV[5]==0)
IF (_H_STMV[0]==2)
IF (_H_WZT==1)
IF (_H_STMV[4]==1)
IF ( (_M_SPE[12]==0)OR($P_TOOLR==0) ) GOTOF _FEHL20
ELSE
IF ( (_M_SPE[11]==0)OR($P_TOOLR==0) ) GOTOF _FEHL20
ENDIF
ENDIF
IF (_H_WZT==2)
IF (_SPECD==0)
IF ( ((_HMA==1)AND(_M_SPE[11]==0))OR((_HMA==2)AND(_M_SPE[12]==0)) ) GOTOF _FEHL20
ELSE
IF (_M_SPE[13]==0) GOTOF _FEHL20
ENDIF
ENDIF
IF (_H_WZT==5)
IF ( ((_AD2>=1)AND(_AD2<=4))AND((_M_SPE[11]==0)OR(_M_SPE[12]==0)) ) GOTOF _FEHL20
IF ( ((_AD2==5)OR(_AD2==7))AND(_M_SPE[11]==0) ) GOTOF _FEHL20
IF ( ((_AD2==6)OR(_AD2==8))AND(_M_SPE[12]==0) ) GOTOF _FEHL20
ENDIF
ENDIF
IF (_H_STMV[0]==1)
IF ((_H_WZT==2)OR(_H_WZT==5))
IF (_SPECD==0)
IF ( ((_HMA==1)AND(_M_SPE[11]==0))OR((_HMA==2)AND(_M_SPE[12]==0)) ) GOTOF _FEHL20
ELSE
IF (_M_SPE[13]==0) GOTOF _FEHL20
ENDIF
ELSE
IF (_H_STMV[3]==1)
IF ($P_TOOLR==0) GOTOF _FEHL20
ELSE
IF ( ((_HMA==1)AND(_M_SPE[11]==0))OR((_HMA==2)AND(_M_SPE[12]==0)) ) GOTOF _FEHL20
ENDIF
ENDIF
ENDIF
IF (_H_STMV[0]==0)
IF ( ((_HMA==1)AND(_M_SPE[11]==0))OR((_HMA==2)AND(_M_SPE[12]==0)) ) GOTOF _FEHL20
IF (_H_STMV[7]==0)
IF ($P_TOOLR==0) GOTOF _FEHL20
ENDIF
ENDIF
ENDIF
_ALARM=61336
IF ( _SPECD==0 )
IF ( (_XX==_YY)OR(_INTERN[2]==0)OR(_INTERN[10]==0) ) GOTOF _FEHL5
ELSE
IF ( _SPECD==1 )
IF ( (_XX==_ZZ)OR(_INTERN[2]==0)OR(_INTERN[18]==0) ) GOTOF _FEHL5
ELSE
IF ( (_YY==_ZZ)OR(_INTERN[10]==0)OR(_INTERN[18]==0) ) GOTOF _FEHL5
ENDIF
ENDIF
_ALARM=0 _SERR=""
IF ((_INTERN[0])OR(_INTERN[8])OR(_INTERN[16]))
IF ($P_GG[29]==1)AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
_HM=2
IF _INTERN[0]
_H_XX=2
ELSE
IF _INTERN[8]
_H1=1 _H_YY=2
ELSE
IF _INTERN[16]
_H1=2 _H_ZZ=2
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_M_SPE[5]=SET($AA_IW[_XX],$AA_IW[_YY],$AA_IW[_ZZ])
IF _M_N[18]==2
_M_SPE[5]=SET($P_EP[_XX],$P_EP[_YY],$P_EP[_ZZ])
ENDIF
_M_SPE[5+_H1]=_M_SPE[5+_H1]/_HM
IF (_H_STMV[1]==0)
IF ( ($P_TRAFO==256) OR ($P_TRAFO==512) )
_ALARM=61099 _SERR="TRANSMIT/TRACYL"
GOTOF _FEHL2
ENDIF
ENDIF
_ALARM=0 _SERR=""
_OVR[0]=0 _OVI[0]=$P_TOOL _OVI[8]=$P_TOOLNO _OVR[27]=SET(_M_SPE[33],_M_SPE[32]/_M_SPE[29],_M_SPE[34]) _VB[0]=1
IF ( _INTERN[20+7] )
_OVI[1]=_AD2*1000+_M_N[17]*100+_M_N[16]*10+_M_N[15]
ENDIF
IF (_H_STMV[1]==0)
_LTP_R[0]=SET(_TP[_P_PROB,0],_TP[_P_PROB,1],_TP[_P_PROB,2],_TP[_P_PROB,3],_TP[_P_PROB,4],_TP[_P_PROB,5])
IF (_FRAES_DREH)
IF (_K_STAT_PL<>$P_GG[6])
IF (_K_STAT_PL==1)
IF ($P_GG[6]==2)
_LTP_R[0]=SET(_TP[_P_PROB,4],_TP[_P_PROB,5],_TP[_P_PROB,0],_TP[_P_PROB,1],_TP[_P_PROB,2],_TP[_P_PROB,3])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_APP _K_STAT_APP=_K_STAT_ORD _K_STAT_ORD=_ZAEHL
ELSE
_LTP_R[0]=SET(_TP[_P_PROB,2],_TP[_P_PROB,3],_TP[_P_PROB,4],_TP[_P_PROB,5],_TP[_P_PROB,0],_TP[_P_PROB,1])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_ORD _K_STAT_ORD=_K_STAT_APP _K_STAT_APP=_ZAEHL
ENDIF
ENDIF
IF (_K_STAT_PL==2)
IF ($P_GG[6]==1)
_LTP_R[0]=SET(_TP[_P_PROB,2],_TP[_P_PROB,3],_TP[_P_PROB,4],_TP[_P_PROB,5],_TP[_P_PROB,0],_TP[_P_PROB,1])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_ORD _K_STAT_ORD=_K_STAT_APP _K_STAT_APP=_ZAEHL
ELSE
_LTP_R[0]=SET(_TP[_P_PROB,4],_TP[_P_PROB,5],_TP[_P_PROB,0],_TP[_P_PROB,1],_TP[_P_PROB,2],_TP[_P_PROB,3])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_APP _K_STAT_APP=_K_STAT_ORD _K_STAT_ORD=_ZAEHL
ENDIF
ENDIF
IF (_K_STAT_PL==3)
IF ($P_GG[6]==1)
_LTP_R[0]=SET(_TP[_P_PROB,4],_TP[_P_PROB,5],_TP[_P_PROB,0],_TP[_P_PROB,1],_TP[_P_PROB,2],_TP[_P_PROB,3])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_APP _K_STAT_APP=_K_STAT_ORD _K_STAT_ORD=_ZAEHL
ELSE
_LTP_R[0]=SET(_TP[_P_PROB,2],_TP[_P_PROB,3],_TP[_P_PROB,4],_TP[_P_PROB,5],_TP[_P_PROB,0],_TP[_P_PROB,1])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_ORD _K_STAT_ORD=_K_STAT_APP _K_STAT_APP=_ZAEHL
ENDIF
ENDIF
ENDIF
IF ( (_H_STMV[0]<>0)AND(_H_STMV[5]==0) )
IF ( (((_K_STAT_ORD<>3)AND(_K_STAT_ORD<>0))OR((_K_STAT_APP<>3)AND(_K_STAT_APP<>0)))AND($MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]<=0) )
N698202 SETAL(61230)
RET
ENDIF
IF ( (_K_STAT_ABS<>3)AND(_K_STAT_ABS<>0)AND($MNS_MEA_T_PROBE_THICKNESS[_P_PROB]<=0) )
N698202 SETAL(61380)
RET
ENDIF
IF (_K_STAT_ABS==1)
_LTP_R[1]=_LTP_R[0]-$MNS_MEA_T_PROBE_THICKNESS[_P_PROB]
ENDIF
IF (_K_STAT_ABS==2)
_LTP_R[0]=_LTP_R[1]+$MNS_MEA_T_PROBE_THICKNESS[_P_PROB]
ENDIF
IF (_K_STAT_ORD==1)
_LTP_R[3]=_LTP_R[2]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_ORD==2)
_LTP_R[2]=_LTP_R[3]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_APP==1)
_LTP_R[5]=_LTP_R[4]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_APP==2)
_LTP_R[4]=_LTP_R[5]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
ENDIF
ENDIF
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
FOR _ZAEHL=0 TO 1
IF (_SPECD>0)
IF (_SPECD==1)
$AA_MEAS_POINT1[_ZZ]=_LTP_R[_ZAEHL] $AA_MEAS_POINT1[_XX]=_LTP_R[_ZAEHL+2]
IF (_INTERN[10])
$AA_MEAS_POINT1[_YY]=_LTP_R[_ZAEHL+4]
ENDIF
ELSE
$AA_MEAS_POINT1[_YY]=_LTP_R[_ZAEHL] $AA_MEAS_POINT1[_ZZ]=_LTP_R[_ZAEHL+2]
IF (_INTERN[2])
$AA_MEAS_POINT1[_XX]=_LTP_R[_ZAEHL+4]
ENDIF
ENDIF
ELSE
$AA_MEAS_POINT1[_XX]=_LTP_R[_ZAEHL] $AA_MEAS_POINT1[_YY]=_LTP_R[_ZAEHL+2]
IF (_INTERN[18])
$AA_MEAS_POINT1[_ZZ]=_LTP_R[_ZAEHL+4]
ENDIF
ENDIF
$AC_MEAS_P1_COORD=1 $AC_MEAS_P2_COORD=0
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _FEHL1
ENDIF
IF (_SPECD>0)
IF (_SPECD==1)
_LTP[_ZAEHL]=$AA_MEAS_POINT2[_ZZ] _LTP[_ZAEHL+2]=$AA_MEAS_POINT2[_XX]
IF (_INTERN[10])
_LTP[_ZAEHL+4]=$AA_MEAS_POINT2[_YY]
ENDIF
ELSE
_LTP[_ZAEHL]=$AA_MEAS_POINT2[_YY] _LTP[_ZAEHL+2]=$AA_MEAS_POINT2[_ZZ]
IF (_INTERN[2])
_LTP[_ZAEHL+4]=$AA_MEAS_POINT2[_XX]
ENDIF
ENDIF
ELSE
_LTP[_ZAEHL]=$AA_MEAS_POINT2[_XX] _LTP[_ZAEHL+2]=$AA_MEAS_POINT2[_YY]
IF (_INTERN[18])
_LTP[_ZAEHL+4]=$AA_MEAS_POINT2[_ZZ]
ENDIF
ENDIF
ENDFOR
IF (_VB[24])
S_V_WKS[0,0]=SET(0,0,0,1,0,0,0,1,0,0,0,1)
FOR _ZAEHL=0 To 3
$AC_MEAS_VALID=0 $AC_MEAS_TYPE=24
$AA_MEAS_POINT1[_XX]=S_V_WKS[_ZAEHL,0]
$AA_MEAS_POINT1[_YY]=S_V_WKS[_ZAEHL,1]
$AA_MEAS_POINT1[_ZZ]=S_V_WKS[_ZAEHL,2]
$AC_MEAS_P1_COORD=0
$AC_MEAS_P2_COORD=1
$AC_MEAS_P1_COORD=0 $AC_MEAS_P2_COORD=1
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _FEHL1
ENDIF
S_V_MKS[_ZAEHL,0]=SET($AA_MEAS_POINT2[_XX],$AA_MEAS_POINT2[_YY],$AA_MEAS_POINT2[_ZZ])
ENDFOR
FOR _ZAEHL=1 TO 3
S_V_MKS[_ZAEHL,0]=SET((S_V_MKS[_ZAEHL,0]-S_V_MKS[0,0]),(S_V_MKS[_ZAEHL,1]-S_V_MKS[0,1]),(S_V_MKS[_ZAEHL,2]-S_V_MKS[0,2]))
ENDFOR
_K_STAT_SAVE[0]=SET(_K_STAT_ABS,_K_STAT_ORD,_K_STAT_APP)
FOR _ZAEHL=1 TO 3
FOR _DUMMY=0 TO 2
IF (S_V_MKS[_ZAEHL,_DUMMY]>=0.999)
IF (_ZAEHL==1)
_K_STAT_ABS=_K_STAT_SAVE[_DUMMY]
ELSE
IF (_ZAEHL==2)
_K_STAT_ORD=_K_STAT_SAVE[_DUMMY]
ELSE
_K_STAT_APP=_K_STAT_SAVE[_DUMMY]
ENDIF
ENDIF
ELSE
IF (S_V_MKS[_ZAEHL,_DUMMY]<=-0.999)
S_TW_TAUSCH=1
IF ( (_K_STAT_SAVE[_DUMMY]==3)OR(_K_STAT_SAVE[_DUMMY]==0) )
IF (_ZAEHL==1)
_K_STAT_ABS=_K_STAT_SAVE[_DUMMY]
ELSE
IF (_ZAEHL==2)
_K_STAT_ORD=_K_STAT_SAVE[_DUMMY]
ELSE
_K_STAT_APP=_K_STAT_SAVE[_DUMMY]
ENDIF
ENDIF
ELSE
IF (_K_STAT_SAVE[_DUMMY]==2)
IF (_ZAEHL==1)
_K_STAT_ABS=1
ELSE
IF (_ZAEHL==2)
_K_STAT_ORD=1
ELSE
_K_STAT_APP=1
ENDIF
ENDIF
ELSE
IF (_ZAEHL==1)
_K_STAT_ABS=2
ELSE
IF (_ZAEHL==2)
_K_STAT_ORD=2
ELSE
_K_STAT_APP=2
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF (S_V_MKS[_ZAEHL,_DUMMY]>0.001)OR(S_V_MKS[_ZAEHL,_DUMMY]<(-0.001))
_ALARM=61330
GOTOF _FEHL6
ENDIF
ENDIF
ENDIF
ENDFOR
ENDFOR
IF (S_TW_TAUSCH==1)
FOR _ZAEHL=0 TO 2
IF (_LTP[2*_ZAEHL+1]>_LTP[2*_ZAEHL])
S_TAUSCH=_LTP[2*_ZAEHL+1] _LTP[2*_ZAEHL+1]=_LTP[2*_ZAEHL] _LTP[2*_ZAEHL]=S_TAUSCH
ENDIF
ENDFOR
S_TW_TAUSCH=0
ENDIF
ENDIF
_LTP[8]=_TP[_P_PROB,8]
ELSE
_LTP[0]=SET(_TPW[_P_PROB,0],_TPW[_P_PROB,1],_TPW[_P_PROB,2],_TPW[_P_PROB,3],_TPW[_P_PROB,4],_TPW[_P_PROB,5])
IF (_FRAES_DREH)
IF (_K_STAT_PL<>$P_GG[6])
IF (_K_STAT_PL==1)
IF ($P_GG[6]==2)
_LTP[0]=SET(_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,0],_TPW[_P_PROB,1],_TPW[_P_PROB,2],_TPW[_P_PROB,3])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_APP _K_STAT_APP=_K_STAT_ORD _K_STAT_ORD=_ZAEHL
ELSE
_LTP[0]=SET(_TPW[_P_PROB,2],_TPW[_P_PROB,3],_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,0],_TPW[_P_PROB,1])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_ORD _K_STAT_ORD=_K_STAT_APP _K_STAT_APP=_ZAEHL
ENDIF
ENDIF
IF (_K_STAT_PL==2)
IF ($P_GG[6]==1)
_LTP[0]=SET(_TPW[_P_PROB,2],_TPW[_P_PROB,3],_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,0],_TPW[_P_PROB,1])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_ORD _K_STAT_ORD=_K_STAT_APP _K_STAT_APP=_ZAEHL
ELSE
_LTP[0]=SET(_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,0],_TPW[_P_PROB,1],_TPW[_P_PROB,2],_TPW[_P_PROB,3])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_APP _K_STAT_APP=_K_STAT_ORD _K_STAT_ORD=_ZAEHL
ENDIF
ENDIF
IF (_K_STAT_PL==3)
IF ($P_GG[6]==1)
_LTP[0]=SET(_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,0],_TPW[_P_PROB,1],_TPW[_P_PROB,2],_TPW[_P_PROB,3])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_APP _K_STAT_APP=_K_STAT_ORD _K_STAT_ORD=_ZAEHL
ELSE
_LTP[0]=SET(_TPW[_P_PROB,2],_TPW[_P_PROB,3],_TPW[_P_PROB,4],_TPW[_P_PROB,5],_TPW[_P_PROB,0],_TPW[_P_PROB,1])
_ZAEHL=_K_STAT_ABS _K_STAT_ABS=_K_STAT_ORD _K_STAT_ORD=_K_STAT_APP _K_STAT_APP=_ZAEHL
ENDIF
ENDIF
ENDIF
IF ( (_H_STMV[0]<>0)AND(_H_STMV[5]==0) )
IF ( (((_K_STAT_ORD<>3)AND(_K_STAT_ORD<>0))OR((_K_STAT_APP<>3)AND(_K_STAT_APP<>0)))AND($MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]<=0) )
N698202 SETAL(61230)
RET
ENDIF
IF ( (_K_STAT_ABS<>3)AND(_K_STAT_ABS<>0)AND($MNS_MEA_T_PROBE_THICKNESS[_P_PROB]<=0) )
N698202 SETAL(61380)
RET
ENDIF
IF (_K_STAT_ABS==1)
_LTP[1]=_LTP[0]-$MNS_MEA_T_PROBE_THICKNESS[_P_PROB]
ENDIF
IF (_K_STAT_ABS==2)
_LTP[0]=_LTP[1]+$MNS_MEA_T_PROBE_THICKNESS[_P_PROB]
ENDIF
IF (_K_STAT_ORD==1)
_LTP[3]=_LTP[2]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_ORD==2)
_LTP[2]=_LTP[3]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_APP==1)
_LTP[5]=_LTP[4]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
IF (_K_STAT_APP==2)
_LTP[4]=_LTP[5]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_P_PROB]
ENDIF
ENDIF
ENDIF
_LTP[8]=_TPW[_P_PROB,8]
ENDIF
IF ((_FRAES_DREH)AND((_LTP[8]<>0)AND(_LTP[8]<>3)))
_ALARM=61309
GOTOF _FEHL21
ENDIF
IF (_NEW_PAR)
IF ( ((_DMODE _DEC3)==1)AND(_H_STMV[0]==2)AND(_H_STMV[3]==4) )
IF (_H_STMV[4]==0)
IF ( (($P_ADT[2]==7)AND(_M_SPE[5]<_LTP[1]))OR(($P_ADT[2]==5)AND(_M_SPE[5]>_LTP[0])) )
_H_STMV[3]=3
ENDIF
ELSE
IF ( (($P_ADT[2]==8)AND(_M_SPE[6]<_LTP[3]))OR(($P_ADT[2]==6)AND(_M_SPE[6]>_LTP[2])) )
_H_STMV[3]=3
ENDIF
ENDIF
ENDIF
ENDIF
IF (_H_STMV[2]<>1) GOTOF _MPKD
_VB[3]=1 _M_SPE[8]=_STA1
_MPKD:
IF ((_H_WZT==1)AND(_INTERN[40+20]==0))
IF (_M_N[13]>0)
IF ($AC_SDIR[0]==5)
SUPA SPOS=_STA1
ENDIF
ELSE
_ALARM=61287
GOTOF _FEHL24
ENDIF
ENDIF
_HMA=_MA
IF (_SPECD>0)
_HMA=3 _MAV=_ZZ _P_POS=_M_SPE[7] _AXIND=2 _HI[0]=4 _P_PT=4
_LTP4=_LTP[4] _LTP5=_LTP[5]
IF (_SPECD==1)
_VAV=_XX _P_PL=2 _LTP[4]=_LTP[0] _LTP[5]=_LTP[1]
ELSE
_VAV=_YY _P_PL=0 _LTP[4]=_LTP[2] _LTP[5]=_LTP[3]
ENDIF
GOTOF _M4F
ENDIF
IF (_H_STMV[0]<>2) GOTOF _M1MA
_HMA=1 _MAAC=1
IF ((_H_WZT==5)AND((_AD2==5)OR(_AD2==7))) GOTOF _M1MA
IF ((_H_WZT==2)AND(_H_STMV[4]==0)) GOTOF _M1MA
_HMA=2
IF ((_H_WZT==5)AND((_AD2==6)OR(_AD2==8))) GOTOF _M1MA
IF ((_H_WZT==2)AND(_H_STMV[4]==1)) GOTOF _M1MA
_HMA=1 _MAAC=2 _MPSOLL=2 _MPCOUNT=_MPSOLL
_M1MA: _MAV=_XX _P_POS=_M_SPE[5] _P_PT=0 _VAV=_YY _HI[0]=0 _P_PL=2 _ALARM=61325
IF _HMA>2 GOTOF _FEHL5 IF _HMA==1 GOTOF _M2
_MAV=_YY _P_POS=_M_SPE[6] _P_PT=2 _AXIND=1 _VAV=_XX _HI[0]=2 _P_PL=0
_M2:
IF ( (_HH_WZT<>725)AND(_TOOLR<>0)AND((_H_WZT==1)OR(_H_WZT==2)) )
IF (((_H_STMV[4]==1)AND(_HMA==1))OR((_H_STMV[4]==0)AND(_HMA==2)))
_H_RINMA=1
ENDIF
ELSE
IF ((_TOOLR<>0)AND(_HH_WZT==725))
IF ( (((_AD2==6)OR(_AD2==8))AND(_HMA==1))OR(((_AD2==5)OR(_AD2==7))AND(_HMA==2)) )
_H_RINMA=1
ENDIF
ENDIF
ENDIF
_ALARM=61315
IF (_H_STMV[0]==0)
IF (_HH_WZT==725)
IF ( (_AD2<5)OR(_AD2>8) ) GOTOF _FEHL4
ELSE
IF ( (_AD2<1)OR(_AD2>4) ) GOTOF _FEHL4
ENDIF
ENDIF
_ALARM=61307
IF (((_H_STMV[3]==1)OR(_H_STMV[3]==2))AND(_H_RINMA==0)) GOTOF _FEHL3
_M4: IF ((_H_WZT<>5)AND(_HH_WZT<>725)) GOTOF _M4F
_VB[45]=1 _ALARM=61332
IF (_VB[1]==0)
N1010 G1 F=_M_SPE[1]
ENDIF
IF (_H_STMV[5]==1)
IF (_H_MD==0)
_MESSR=-1 _P_PT=_P_PT+1
ELSE
_MESSR=1 _HI[0]=_HI[0]+1
ENDIF
GOTOF _M7
ENDIF
_MESSR=-1
IF (_P_POS>_LTP[_P_PT]) GOTOF _M6
IF ( ( (_H_STMV[0]<>0)AND(_P_POS >= _LTP[_P_PT+1]) ) OR ( (_H_STMV[0]==0)AND(_H_STMV[7])AND(_P_POS >= _LTP[_P_PT+1]) ) ) GOTOF _FEHL6
IF ( (_H_STMV[7]==0) AND (_H_STMV[0]==0) AND (_HH_WZT<>725) )
IF ( (_AD2==1) AND (_P_POS >= _LTP[_P_PT+1]) ) GOTOF _FEHL6
IF ( (_AD2==2) AND ( (_HMA==1) AND (_P_POS+_TOOLR*2 >= _LTP[_P_PT+1]) OR (_HMA==2) AND (_P_POS >=_LTP[_P_PT+1]) ) ) GOTOF _FEHL6
IF ( (_AD2==3) AND (_P_POS+_TOOLR*2 >= _LTP[_P_PT+1]) ) GOTOF _FEHL6
IF ( (_AD2==4) AND ( (_HMA==2) AND (_P_POS+_TOOLR*2 >= _LTP[_P_PT+1]) OR (_HMA==1) AND (_P_POS >=_LTP[_P_PT+1]) ) ) GOTOF _FEHL6
ENDIF
_P_PT=_P_PT+1
GOTOF _M7
_M6: _MESSR=1 _HI[0]=_HI[0]+1
IF ( (_H_STMV[7]==0) AND (_H_STMV[0]==0) AND (_HH_WZT<>725) )
IF ( (_AD2==1) AND (_P_POS-_TOOLR*2 <= _LTP[_P_PT]) ) GOTOF _FEHL6
IF ( (_AD2==2) AND ( (_HMA==2) AND (_P_POS-_TOOLR*2 <= _LTP[_P_PT]) OR (_HMA==1) AND (_P_POS <= _LTP[_P_PT]) ) ) GOTOF _FEHL6
IF ( (_AD2==4) AND ( (_HMA==1) AND (_P_POS-_TOOLR*2 <= _LTP[_P_PT]) OR (_HMA==2) AND (_P_POS <= _LTP[_P_PT]) ) ) GOTOF _FEHL6
ENDIF
GOTOF _M7
_M4F: _VB[45]=0 _ALARM=61332
IF (_VB[1]==0)
N1010 G1 F=_M_SPE[1]
ENDIF
IF (_H_STMV[0]<>2) GOTOF _M5FM
_MESSR=-1
IF (_H_WZT==2) GOTOF _M5FNORA
IF ((_H_WZT==1)AND(_TOOLR==0)) GOTOF _M5FNORA
IF (_HMA==1)
_MPSOLL=4 _MPCOUNT=_MPSOLL
ENDIF
IF _H_RINMA==0 GOTOF _M5FNORA
_HR[2]=0
IF _MPCOUNT==_MPSOLL
IF (_M_SPE[6]>(_LTP[2]))
_HR[7]=_M_SPE[6]-(_LTP[2])
ELSE
_HR[7]=_M_SPE[6]-(_LTP[3])
ENDIF
IF (_H_STMV[3]==4)
_HR[7]=-_HR[7]
ENDIF
ENDIF
IF (_P_POS > (_LTP[_P_PT]+_TOOLR)) GOTOF _M6FA IF (_P_POS >= (_LTP[_P_PT+1]+_TOOLR)) GOTOF _FEHL6
IF ((_P_POS+_TOOLR) >= _LTP[_P_PT+1]) GOTOF _FEHL6
_P_PT=_P_PT+1
GOTOF _M7FA
_M5FNORA: _HR[2]=_TOOLR
IF _MPCOUNT==_MPSOLL
IF (_M_SPE[5]>(_LTP[0]))
_HR[7]=_M_SPE[5]-(_LTP[0])
ELSE
_HR[7]=_M_SPE[5]-(_LTP[1])
ENDIF
ENDIF
IF ((_MPCOUNT==_MPSOLL)AND(_H_STMV[3]==4)) GOTOF _M6FA0
IF (_P_POS>_LTP[_P_PT]) GOTOF _M6FA IF (_P_POS>=_LTP[_P_PT+1]) GOTOF _FEHL6
_P_PT=_P_PT+1
GOTOF _M7FA
_M6FA0:
IF (_P_POS>(_LTP[0]+_M_SPE[3])) GOTOF _M6FA01
IF (_P_POS>(_LTP[1]-_M_SPE[3])) GOTOF _FEHL6
_MESSR=1 _P_PT=0 _HI[0]=1
GOTOF _M6FA02
_M6FA01:_MESSR=-1 _P_PT=1 _HI[0]=0
_M6FA02: _M_ZUST[_HI[0]]=1
REPEAT _K_STAT_A _K_STAT_E
_ALARM=61332
_VB[42]=1 _HI[1]=_M_N[15]
IF (_M_SPE[6]>(_LTP[2]+ABS(_HR[2])))
_HR[10]=_LTP[2]+ABS(_HR[2])+_M_SPE[3]
ELSE
IF (_M_SPE[6]<(_LTP[3]-ABS(_HR[2])))
_HR[10]=_LTP[3]-ABS(_HR[2])-_M_SPE[3]
ELSE
GOTOF _FEHL1
ENDIF
ENDIF
IF (_HR[7]>0)
_HR[11]=_LTP[1]-_M_SPE[3]
ELSE
_HR[11]=_LTP[0]+_M_SPE[3]
ENDIF
_ALARM=61302
IF (_INTERN[40+2])
N520 MEAS=_M_N[0] AX[_VAV]=_HR[10]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N530 MEAS=_M_N[0] AX[_MAV]=_HR[11]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N540 AX[_VAV]=_HR[10]
N550 AX[_MAV]=_HR[11]
ENDIF
_ALARM=61332
_P_POS=_HR[11]
_HR[3]=_HR[10]
_HR[7]=-_HR[7]
GOTOF _M8FA
_M6FA: _MESSR=1 _HI[0]=_HI[0]+1
_M7FA: _M_ZUST[_HI[0]]=1
REPEAT _K_STAT_A _K_STAT_E
_ALARM=61332
_VB[42]=1 _HI[1]=_M_N[15] _HR[3]=_M_SPE[6]
IF ((_M_ZUST[0]==0)AND(_M_ZUST[1]==0))
_VB[42]=0 _VB[40]=1 _HI[1]=_M_N[16] _HR[3]=_M_SPE[5]
IF ((_MPCOUNT<>_MPSOLL)AND(_H_STMV[3]<3))
_HR[3]=_M_SPE[10]
ENDIF
ENDIF
_M8FA:
IF (_HR[3]<=((_LTP[_P_PL]+_LTP[_P_PL+1])/2))
_HR[2]=-_HR[2]
ENDIF
IF ((_HR[3]>(_LTP[_P_PL]+ABS(_HR[2]))) OR (_HR[3]<(_LTP[_P_PL+1]-ABS(_HR[2])))) GOTOF _M8
GOTOF _FEHL6
_M5FM:
IF (_H_STMV[5]==1)
IF (_H_MD==0)
_MESSR=-1 _P_PT=_P_PT+1
ELSE
_MESSR=1 _HI[0]=_HI[0]+1
ENDIF
GOTOF _M7F
ENDIF
_MESSR=-1
IF _H_RINMA==0 GOTOF _M5FNOR
_M5FM1:
IF ((_H_STMV[3]<>2)AND(_H_STMV[0]==1)) GOTOF _M5F1
_MPSOLL=2 _MPCOUNT=_MPSOLL
_M5F1: _HR[2]=0
IF (_P_POS > (_LTP[_P_PT]+_TOOLR)) GOTOF _M6F IF (_P_POS >= (_LTP[_P_PT+1]+_TOOLR)) GOTOF _FEHL6
IF ((_P_POS+_TOOLR) >= _LTP[_P_PT+1]) GOTOF _FEHL6
_P_PT=_P_PT+1
GOTOF _M7F
_M5FNOR: _HR[2]=_TOOLR
_ALARM=61307
IF (_H_STMV[3]==2) GOTOF _FEHL3
_ALARM=61332
IF (_P_POS>_LTP[_P_PT]) GOTOF _M6F IF (_P_POS>=_LTP[_P_PT+1]) GOTOF _FEHL6
_P_PT=_P_PT+1
GOTOF _M7F
_M6F: _MESSR=1 _HI[0]=_HI[0]+1
_M7F: _M_ZUST[_HI[0]]=1
REPEAT _K_STAT_A _K_STAT_E
_ALARM=61332
IF _SPECD
_VB[42]=0 _VB[40]=1 _HI[1]=_M_N[17] _HR[3]=0
GOTOF _M8
ENDIF
_VB[42]=1 _HI[1]=_M_N[15] _HR[3]=_M_SPE[6]
IF ((_M_ZUST[0]==0)AND(_M_ZUST[1]==0))
_VB[42]=0 _VB[40]=1 _HI[1]=_M_N[16] _HR[3]=_M_SPE[5]
ENDIF
IF (_H_STMV[5]==1)GOTOF _M8
IF (_HR[3]<=((_LTP[_P_PL]+_LTP[_P_PL+1])/2))
_HR[2]=-_HR[2]
ENDIF
IF (_H_STMV[3]<>2) GOTOF _M8
IF ((_HR[3]>(_LTP[_P_PL])) OR (_HR[3]<(_LTP[_P_PL+1]))) GOTOF _M8
GOTOF _FEHL6
_M7: _M_ZUST[_HI[0]]=1
REPEAT _K_STAT_A _K_STAT_E
_ALARM=61332
IF ((_H_STMV[0]==0)AND(_H_STMV[7]==0))
IF (_HH_WZT==725)
IF ( ((_AD2==5)AND(_M_ZUST[1]))OR((_AD2==6)AND(_M_ZUST[3]))OR((_AD2==7)AND(_M_ZUST[0]))OR((_AD2==8)AND(_M_ZUST[2])) ) GOTOF _FEHL6
ENDIF
GOTOF _M70
ENDIF
IF ((_M_ZUST[0]) AND ((_AD2==2) OR (_AD2==3) OR (_AD2==7))) OR ((_M_ZUST[2]) AND ((_AD2==3) OR (_AD2==4) OR (_AD2==8))) GOTOF _FEHL6
IF ((_M_ZUST[1]) AND ((_AD2==1) OR (_AD2==4) OR (_AD2==5))) OR ((_M_ZUST[3]) AND ((_AD2==1) OR (_AD2==2) OR (_AD2==6))) GOTOF _FEHL6
IF (_SMI_R[10]==93101.901) GOTOF _M70
_ALARM=61315
IF ((_M_ZUST[0]) OR (_M_ZUST[1])) AND ((_AD2==6) OR (_AD2==8))GOTOF _FEHL4
IF ((_M_ZUST[2]) OR (_M_ZUST[3])) AND ((_AD2==5) OR (_AD2==7))GOTOF _FEHL4
_M70: IF _AD2>4 GOTOF _M71
_HR[2]=_TOOLR _HR[2]=-_HR[2]
IF ((_VAV==_XX) AND ((_AD2==2)OR(_AD2==3))) OR ((_VAV==_YY) AND (_AD2>=3)) GOTOF _M71
_HR[2]=-_HR[2]
_M71: _VB[42]=1 _HI[1]=_M_N[15]
IF ((_M_ZUST[0]==0)AND(_M_ZUST[1]==0))
_VB[42]=0 _VB[40]=1 _HI[1]=_M_N[16]
ENDIF
_M8:
IF (_H_STMV[5]==0)
IF (_HH_WZT==725)
_HR[2]=0
ENDIF
IF ( (_FRAES_DREH==1)AND(_K_STAT_CYC==1) )
IF (_SPECD==0)
IF ( (_INTERN[18])AND(_H_STMV[0]<>0)AND(_GUD_SD<>1) )
_ALARM=61302
IF (_INTERN[40+2])
MEAS=_M_N[0] AX[_ZZ]=((_LTP[4]+_LTP[5])/2)
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
AX[_ZZ]=((_LTP[4]+_LTP[5])/2)
ENDIF
ENDIF
ELSE
IF (_SPECD==1)
IF ( (_INTERN[10])AND(_H_STMV[0]<>0)AND(_GUD_SD<>1) )
_ALARM=61302
IF (_INTERN[40+2])
MEAS=_M_N[0] AX[_YY]=((_LTP4+_LTP5)/2)
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
AX[_YY]=((_LTP4+_LTP5)/2)
ENDIF
ENDIF
ELSE
IF ( (_INTERN[2])AND(_H_STMV[0]<>0)AND(_GUD_SD<>1) )
_ALARM=61302
IF (_INTERN[40+2])
MEAS=_M_N[0] AX[_XX]=((_LTP4+_LTP5)/2)
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
AX[_XX]=((_LTP4+_LTP5)/2)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_HR[4]=(_LTP[_P_PL]+_LTP[_P_PL+1])/2+_HR[2]
_ALARM=61302
IF (_INTERN[40+2])
N1020 MEAS=_M_N[0] AX[_VAV]=_HR[4]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N1030 AX[_VAV]=_HR[4]
ENDIF
ENDIF
_M_SPE[16]=_M_SPE[11+_AXIND] _ALARM=0 _SERR=""
N1040 _M9:
IF (_H_STMV[5]==1)
_M_SPE[10]=_P_POS
_M_SPE[9]=_P_POS-_M_SPE[60]*_M_SPE[3]*_MESSR
N1044 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR
GOTOF _M90A
ENDIF
_M_SPE[10]=_LTP[_P_PT]+_M_SPE[3]*_MESSR
IF ((_H_WZT<>5)AND(_H_RINMA<>0))
_M_SPE[10]=_M_SPE[10]+(_TOOLR*_MESSR)
N1045 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR
ENDIF
IF ((_MESSR==-1)AND(_M_SPE[10]<_P_POS))OR((_MESSR==1)AND(_M_SPE[10]>_P_POS))
_M_SPE[10]=_P_POS
ENDIF
_M90: _M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR
_M90A:
IF ( (_H_STMV[0]<>0)OR(_M_N[7])OR((_H_STMV[0]==0)AND(_H_STMV[7])) ) GOTOF _M91
_HR[0]=_TOOLR*2
IF (_H_STMV[5]==0)
IF ( (_H_STMV[7]==0) AND (_H_STMV[0]==0) )
IF ( (_MESSR==1) AND ( (_AD2==1) OR ((_AD2==2) AND (_HMA==2)) OR ((_AD2==4) AND (_HMA==1)) ) )
_M_SPE[10]=_M_SPE[10]+_HR[0] _M_SPE[9]=_M_SPE[9]+_HR[0]
ENDIF
IF ( (_MESSR==-1) AND ( (_AD2==3) OR ((_AD2==2) AND (_HMA==1)) OR ((_AD2==4) AND (_HMA==2)) ) )
_M_SPE[10]=_M_SPE[10]-_HR[0] _M_SPE[9]=_M_SPE[9]-_HR[0]
ENDIF
ENDIF
IF ((_MESSR==-1)AND(_M_SPE[10]<_P_POS))OR((_MESSR==1)AND(_M_SPE[10]>_P_POS))
_M_SPE[10]=_P_POS
ENDIF
ENDIF
N1050 _M91:
N1045 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR
N1075 CYCLE121(_MAV,_XX,_YY,_ZZ,_SP,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN)
IF (_ALARM == 61301) GOTOF _GENDE
IF _ALARM GOTOF _FEHL1
IF ((_H_WZT==1)AND(_H_STMV[2]==1))
IF (_UMSTAT==0)
_M_ME[6]=_M_ME[8] _M_SPE[8]=((_M_SPE[8]+180+_CORA)+360) MOD 360
SUPA SPOS=DC(_M_SPE[8])
_M_ME[8]=SET(0,0) _UMSTAT=1
GOTOB _M91
ELSE
_M_ME[8]=(_M_ME[8]+_M_ME[6])/2 _M_SPE[8]=_STA1
SUPA SPOS=DC(_M_SPE[8])
_M_ME[6]=0 _UMSTAT=0
ENDIF
ENDIF
_MPCOUNT=_MPCOUNT-1
IF ( (_H_WZT==5)OR(_HH_WZT==725) ) GOTOF _M91END
IF ((_H_WZT==1)AND(_TOOLR<>0)AND(_H_RINMA==0)AND(_H_STMV[0]==2)) GOTOF _M91LA
IF (_MPCOUNT==0) GOTOF _M91END
IF ((_MPCOUNT==2)AND(_H_STMV[0]==2)) GOTOF _M91END
IF ((_H_WZT==1)AND(_TOOLR==0)) GOTOF _M91END
IF (_H_RINMA==0) GOTOF _M91END
_M_ME[4]=_M_ME[8]-_LTP[_P_PT] _M_ME[8]=SET(0,0)
_M91UB: _P_PT=_P_PT+1*_MESSR
_MESSR=-_MESSR _H_HB =_M_ZUST[0] _M_ZUST[0]=_M_ZUST[1] _M_ZUST[1]=_H_HB
_H_HB =_M_ZUST[2] _M_ZUST[2]=_M_ZUST[3] _M_ZUST[3]=_H_HB
_HR[5]=_LTP[_P_PT]+(_M_SPE[3]+_TOOLR)*_MESSR
_M_SPE[10]=_HR[5]
_HR[8]=_HR[3]
IF (_H_STMV[0]<>2) GOTOF _M91S1
IF (_H_STMV[3]>2) GOTOF _M91GU
_HR[8]=_LTP[_P_PL]+_M_SPE[3]
IF (_HR[3]>_LTP[_P_PL]) GOTOF _M91S1
_HR[8]=_LTP[_P_PL+1]-_M_SPE[3]
GOTOF _M91S1
_M91GU:
IF (_HR[7]<0)
_HR[8]=_LTP[_P_PL]-_HR[7]
ELSE
_HR[8]=_LTP[_P_PL+1]-_HR[7]
ENDIF
_M91S1:
IF (_H_STMV[2]==0)
IF (_M_N[13]>0)
IF ($AC_SDIR[0]==5)
SPOS=IC(180)
ENDIF
ELSE
_ALARM=61287
GOTOF _FEHL24
ENDIF
_ALARM=61302
ENDIF
IF (_INTERN[40+2])
N10201 MEAS=_M_N[0] AX[_VAV]=_HR[8]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N10202 MEAS=_M_N[0] AX[_MAV]=_HR[5]
STOPRE
REPEAT _K_STAT_A _K_STAT_E
_ALARM=61302
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N10203 MEAS=_M_N[0] AX[_VAV]=_HR[4]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
_ALARM=0 _SERR=""
GOTOB _M90
ELSE
N10301 AX[_VAV]=_HR[8]
N10302 AX[_MAV]=_HR[5]
ENDIF
REPEAT _K_STAT_A _K_STAT_E
_ALARM=61302
N10303 AX[_VAV]=_HR[4]
_ALARM=0 _SERR=""
GOTOB _M90
_M91LA: IF (_H_STMV[0]<>2) GOTOF _M91END
IF ((_MPCOUNT<>3)AND(_MPCOUNT<>1))
_M_ME[8]=(_M_ME[8]+_M_ME[4])/2
GOTOF _M91END
ENDIF
_M_ME[4]=_M_ME[8] _M_ME[8]=SET(0,0)
_M91MWH: IF (_H_STMV[3]>2) GOTOF _M91S
IF (_H_STMV[2]==0)
IF (_M_N[13]>0)
IF ($AC_SDIR[0]==5)
SPOS=IC(180)
ENDIF
ELSE
_ALARM=61287
GOTOF _FEHL24
ENDIF
ENDIF
_HR[2]=-_HR[2]
_HR[4]=(_LTP[_P_PL]+_LTP[_P_PL+1])/2+_HR[2]
_ALARM=61302
IF (_INTERN[40+2])
N9020 MEAS=_M_N[0] AX[_VAV]=_HR[4]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N9030 AX[_VAV]=_HR[4]
ENDIF
_ALARM=0 _SERR=""
_M91S: GOTOB _M90
_M91END: _M_ZUST[7]=1
IF (_H_STMV[0]==2)
_MAAC=_MAAC-1
ENDIF
IF (_H_STMV[0]<>0) GOTOF _M92
IF ( (_INTERN[18])AND(_FRAES_DREH==0) )
_LTP[4]=_M_SPE[7] _LTP[5]=_M_SPE[7]
IF ($P_GG[13]==1)OR($P_GG[13]==3)
_ZAEHL=$MNS_DISP_RES_INCH
ELSE
_ZAEHL=$MNS_DISP_RES_MM
ENDIF
_AGV[0]=1
FOR _AGV[1]=1 TO _ZAEHL
_AGV[0]=_AGV[0]*10
ENDFOR
_LTP[4]=(ROUND(_LTP[4]*_AGV[0]))/_AGV[0] _LTP[5]=(ROUND(_LTP[5]*_AGV[0]))/_AGV[0]
ENDIF
IF (_H_STMV[1]==0)
$AC_MEAS_VALID=0 $AC_MEAS_P1_COORD=0 $AC_MEAS_P2_COORD=1 $AC_MEAS_TYPE=24
FOR _ZAEHL=0 TO 1
$AA_MEAS_POINT1[_XX]=_LTP[_ZAEHL] $AA_MEAS_POINT1[_YY]=_LTP[_ZAEHL+2]
IF (_INTERN[18])
$AA_MEAS_POINT1[_ZZ]=_LTP[_ZAEHL+4]
ENDIF
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _FEHL1
ENDIF
_LTP[_ZAEHL]=$AA_MEAS_POINT2[_XX] _LTP[_ZAEHL+2]=$AA_MEAS_POINT2[_YY]
IF (_INTERN[18])
_LTP[_ZAEHL+4]=$AA_MEAS_POINT2[_ZZ]
ENDIF
_OVR[8+2*_ZAEHL]=_LTP[_ZAEHL] _OVR[12+2*_ZAEHL]=_LTP[_ZAEHL+2]
IF ( (_INTERN[18])AND(_FRAES_DREH==0) )
_OVR[16+2*_ZAEHL]=_LTP[_ZAEHL+4]
ENDIF
ENDFOR
IF(_HMA==1)
$AA_MEAS_POINT1[_XX]=_M_ME[8]
ELSE
$AA_MEAS_POINT1[_YY]=_M_ME[8]
ENDIF
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _FEHL1
ENDIF
IF(_HMA==1)
_M_ME[8]=$AA_MEAS_POINT2[_XX]
ELSE
_M_ME[8]=$AA_MEAS_POINT2[_YY]
ENDIF
ELSE
_OVR[8]=_LTP[0] _OVR[10]=_LTP[1] _OVR[12]=_LTP[2] _OVR[14]=_LTP[3]
IF ( (_INTERN[18])AND(_FRAES_DREH==0) )
_OVR[16]=_LTP[4] _OVR[18]=_LTP[5]
ENDIF
ENDIF
_HI[3]=_P_PT*2 _TRIGLAG=_LTP[_P_PT]
IF ( (_H_STMV[7]==0) AND (_H_STMV[0]==0) )
IF (_HH_WZT==725)
IF ( (_MESSR==1)AND( (((_AD2==6)OR(_AD2==8))AND(_HMA==1))OR(((_AD2==5)OR(_AD2==7))AND(_HMA==2)) ) )
_M_ME[8]=_M_ME[8]-$P_TOOLR
ENDIF
IF ( (_MESSR==-1)AND( (((_AD2==6)OR(_AD2==8))AND(_HMA==1))OR(((_AD2==5)OR(_AD2==7))AND(_HMA==2)) ) )
_M_ME[8]=_M_ME[8]+$P_TOOLR
ENDIF
ELSE
IF ( (_MESSR==1) AND ( (_AD2==1) OR ((_AD2==2) AND (_HMA==2)) OR ((_AD2==4) AND (_HMA==1)) ) )
_M_ME[8]=_M_ME[8]-_HR[0]
ENDIF
IF ( (_MESSR==-1) AND ( (_AD2==3) OR ((_AD2==2) AND (_HMA==1)) OR ((_AD2==4) AND (_HMA==2)) ) )
_M_ME[8]=_M_ME[8]+_HR[0]
ENDIF
ENDIF
ENDIF
_M_ME[0]=_M_ME[8]
_OVR[8+_HI[3]]=_M_ME[0]
_OVR[9+_HI[3]]=_OVR[8+_HI[3]]-_TRIGLAG
GOTOF _M111
_M92: IF (_H_WZT==5) GOTOF _M92L
IF ( (_H_WZT==2) AND ((((_H_STMV[4]==1)AND(_HMA==1)) OR ((_H_STMV[4]==0)AND(_HMA==2))) AND (_H_STMV[0]==1)) )
GOTOF _M92ME
ELSE
IF (_H_WZT==2)
GOTOF _M92L
ENDIF
ENDIF
IF (_H_STMV[0]<>2) GOTOF _M92ME
_TRIGLAG=_M_SPE[11+_AXIND]
IF _H_RINMA==1 GOTOF _M92LUR
_M92ME: IF _H_RINMA==0 GOTOF _M92L
_M92LR:
_TRIGLAG=_M_SPE[11+_AXIND]
IF (_H_STMV[3]<>0) GOTOF _MRAD
_M_ME[0]=((_M_ME[8]-_LTP[_P_PT])-(_MESSR*_TOOLR))+_TRIGLAG
_M_ME[8]=(_M_ME[8]-(_MESSR*_TOOLR))
_HI[3]=2*(_HI[1]-1)
GOTOF _M93
_MRAD: IF (_H_STMV[3]<>1) GOTOF _M92LUR
_M_ME[0]=ABS(_M_ME[8]-_LTP[_P_PT])
_HI[3]=4
_OVR[8+_HI[3]]=_M_ME[0]
GOTOF _M93ERF
_M92LUR:
_M_ME[5]=_M_ME[8]-_LTP[_P_PT]
_OVR[12]=(ABS(_M_ME[5])+ABS(_M_ME[4]))/2
_OVR[13]=_OVR[12]-_TOOLR
_M_ME[0]=(_M_ME[5]-(_MESSR*_OVR[12]))+_M_SPE[11+_AXIND]
_M_ME[8]=(_M_ME[8]-(_MESSR*_OVR[12]))
_HI[3]=2*(_HI[1]-1)
GOTOF _M93
_M92L:
_HI[3]=2*(_HI[1]-1)
_TRIGLAG=_M_SPE[11+_AXIND] _M_ME[0]=(_M_ME[8]-_LTP[_P_PT])+_TRIGLAG
_M93:
_IW_RESU=_M_ME[0]
$AC_MEAS_VALID=0 $AC_MEAS_P1_COORD=0 $AC_MEAS_T_NUMBER=$P_TOOLNO $AC_MEAS_D_NUMBER=$P_TOOL
$AC_MEAS_ACT_PLANE=$P_GG[6]-1
$AC_MEAS_INPUT[0]=0
$AC_MEAS_TYPE=23
IF (_SPECD==0)
IF(_HMA==1)
$AA_MEAS_POINT1[_XX]=_M_ME[8]
$AA_MEAS_SETPOINT[_XX]=_LTP[_P_PT]
ELSE
$AA_MEAS_POINT1[_YY]=_M_ME[8]
$AA_MEAS_SETPOINT[_YY]=_LTP[_P_PT]
ENDIF
ELSE
$AA_MEAS_POINT1[_ZZ]=_M_ME[8]
$AA_MEAS_SETPOINT[_ZZ]=_LTP[_P_PT]
ENDIF
_OVI[12]=MEASURE()
IF _OVI[12]<>0
_ALARM=61403
GOTOF _FEHL1
ENDIF
S_AC_MEAS_RESULT3=$AC_MEAS_RESULTS[3] S_AC_MEAS_RESULT4=$AC_MEAS_RESULTS[4] S_AC_MEAS_RESULT5=$AC_MEAS_RESULTS[5]
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10000000')
IF ( ISVAR("$TC_MPP7["<<$A_MYMN[$P_TOOLNO]<<","<<$A_MYMLN[$P_TOOLNO]<<"]") )
IF ($TC_MAP1[$A_MYMN[$P_TOOLNO]]==3)
IF ( ($TC_MPP7[$A_MYMN[$P_TOOLNO],$A_MYMLN[$P_TOOLNO]])<>0 )
S_ADAPT_TRAFO_NR=$TC_ADPTT[$TC_MPP7[$A_MYMN[$P_TOOLNO],$A_MYMLN[$P_TOOLNO]]]
ENDIF
ELSE
IF ( ($TC_MPP7[$A_TOOLMN[$P_TOOLNO],$A_TOOLMLN[$P_TOOLNO]])<>0 )
S_ADAPT_TRAFO_NR=$TC_ADPTT[$TC_MPP7[$A_TOOLMN[$P_TOOLNO],$A_TOOLMLN[$P_TOOLNO]]]
ENDIF
ENDIF
IF ( (S_ADAPT_TRAFO_NR==3)OR(S_ADAPT_TRAFO_NR==4) )
S_AC_MEAS_RESULT3=(-1)*S_AC_MEAS_RESULT3
ENDIF
IF ( (S_ADAPT_TRAFO_NR==2)OR(S_ADAPT_TRAFO_NR==4) )
S_AC_MEAS_RESULT4=(-1)*S_AC_MEAS_RESULT4
ENDIF
IF ( S_ADAPT_TRAFO_NR>4 )
S_TAUSCH=S_AC_MEAS_RESULT3 S_AC_MEAS_RESULT3=S_AC_MEAS_RESULT4 S_AC_MEAS_RESULT4=S_TAUSCH
ENDIF
IF ( (S_ADAPT_TRAFO_NR==6)OR(S_ADAPT_TRAFO_NR==8) )
S_AC_MEAS_RESULT3=(-1)*S_AC_MEAS_RESULT3
ENDIF
IF ( (S_ADAPT_TRAFO_NR==7)OR(S_ADAPT_TRAFO_NR==8) )
S_AC_MEAS_RESULT4=(-1)*S_AC_MEAS_RESULT4
ENDIF
ENDIF
ENDIF
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
IF (_BEL_WI==1)
_OVR[8]=S_AC_MEAS_RESULT3 _OVR[10]=S_AC_MEAS_RESULT4
ELSE
IF (8+_HI[3]==8)
_OVR[8]=S_AC_MEAS_RESULT3
ELSE
_OVR[10]=S_AC_MEAS_RESULT4
ENDIF
ENDIF
GOTOF _END_SC_TLC
_P19_M17:
IF (_BEL_WI==1)
_OVR[8]=S_AC_MEAS_RESULT3 _OVR[12]=S_AC_MEAS_RESULT5
ELSE
IF (8+_HI[3]==8)
_OVR[8]=S_AC_MEAS_RESULT3
ELSE
_OVR[12]=S_AC_MEAS_RESULT5
ENDIF
ENDIF
GOTOF _END_SC_TLC
_P17_M19:
IF (_BEL_WI==1)
_OVR[10]=S_AC_MEAS_RESULT4 _OVR[12]=S_AC_MEAS_RESULT5
ELSE
IF (8+_HI[3]==10)
_OVR[10]=S_AC_MEAS_RESULT4
ELSE
_OVR[12]=S_AC_MEAS_RESULT5
ENDIF
ENDIF
GOTOF _END_SC_TLC
_END_SC_TLC:
IF ( (_H_STMV[0]==0)OR(_BEL_WI) ) GOTOF _M97
_M93ERF:
IF (_H_STMV[5]==1) GOTOF _M97
_M_N[8]=_M_N[22] MOD 10000
_OVI[7]=_M_N[8]
IF (_OVI[7]>0)
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF (_INTERN[40+5])
_HR[0]=-_HR[0]
ENDIF
_OVR[8+_HI[3]]=_OVR[8+_HI[3]]-_HR[0]
IF (_H_RINMA<>1) GOTOF _M97
IF ((_H_STMV[3]<>2)AND(_H_STMV[0]<>2)) GOTOF _M97
_OVR[12]=_OVR[12]-_HR[0]
_OVR[13]=_OVR[12]-_TOOLR
ENDIF
IF (_H_RINMA<>1) GOTOF _M97
IF ((_H_STMV[3]<>2)AND(_H_STMV[0]<>2)) GOTOF _M97
_ALARM=61303
IF(( ABS(_OVR[13]))>=_M_SPE[32]) GOTOF _M113
_ALARM=61306
IF ABS(_OVR[13])>=_M_SPE[34] GOTOF _M113
_ALARM=0 _SERR=""
_M97:
IF ( (_H_WZT==1)AND(_HI[3]==4)AND(_H_STMV[0]<>0) )
_OVR[9+_HI[3]]=_OVR[8+_HI[3]]-_TOOLR _M_ME[4]=SET(0,0,0,0,0)
ELSE
_MD_RESU=_IW_RESU-_TRIGLAG
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
IF (_BEL_WI==1)
_OVR[9]=_OVR[8]-_SOLL_L1 _OVR[11]=_OVR[10]-_SOLL_L2
ELSE
IF (9+_HI[3]==9)
_OVR[9]=_OVR[8]-_SOLL_L1
ELSE
_OVR[11]=_OVR[10]-_SOLL_L2
ENDIF
ENDIF
GOTOF _END_SC_TLC
_P19_M17:
IF (_BEL_WI==1)
_OVR[9]=_OVR[8]-_SOLL_L1 _OVR[13]=_OVR[12]-_SOLL_L2
ELSE
IF (9+_HI[3]==9)
_OVR[9]=_OVR[8]-_SOLL_L1
ELSE
_OVR[13]=_OVR[12]-_SOLL_L2
ENDIF
ENDIF
GOTOF _END_SC_TLC
_P17_M19:
IF (_BEL_WI==1)
_OVR[11]=_OVR[10]-_SOLL_L1 _OVR[13]=_OVR[12]-_SOLL_L2
ELSE
IF (9+_HI[3]==11)
_OVR[11]=_OVR[10]-_SOLL_L1
ELSE
_OVR[13]=_OVR[12]-_SOLL_L2
ENDIF
ENDIF
GOTOF _END_SC_TLC
_END_SC_TLC:
ENDIF
_M_ME[4]=SET(0,0,0,0,0)
_M111:
IF (_H_STMV[5]==1) GOTOF _M113
IF (_BEL_WI==0)
IF ABS(_OVR[9+_HI[3]])<_M_SPE[32] GOTOF _M112
ELSE
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
IF (ABS(_OVR[9])<_M_SPE[32])AND(ABS(_OVR[11])<_M_SPE[32]) GOTOF _M112
GOTOF _END_SC_TLC
_P19_M17:
IF (ABS(_OVR[9])<_M_SPE[32])AND(ABS(_OVR[13])<_M_SPE[32]) GOTOF _M112
GOTOF _END_SC_TLC
_P17_M19:
IF (ABS(_OVR[11])<_M_SPE[32])AND(ABS(_OVR[13])<_M_SPE[32]) GOTOF _M112
GOTOF _END_SC_TLC
_END_SC_TLC:
ENDIF
_ALARM=61303
_M112: IF (_ALARM)OR(_H_STMV[0]==0) GOTOF _M113
IF (_BEL_WI==0)
IF ABS(_OVR[9+_HI[3]])<_M_SPE[34] GOTOF _M113
ELSE
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
IF (ABS(_OVR[9])<_M_SPE[34])AND(ABS(_OVR[11])<_M_SPE[34]) GOTOF _M113
GOTOF _END_SC_TLC
_P19_M17:
IF (ABS(_OVR[9])<_M_SPE[34])AND(ABS(_OVR[13])<_M_SPE[34]) GOTOF _M113
GOTOF _END_SC_TLC
_P17_M19:
IF (ABS(_OVR[11])<_M_SPE[34])AND(ABS(_OVR[13])<_M_SPE[34]) GOTOF _M113
GOTOF _END_SC_TLC
_END_SC_TLC:
ENDIF
_ALARM=61306
_M113: IF (_ALARM<>61303)AND(_ALARM<>61306) GOTOF _M115
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF (_INTERN[20+1])
N1100 SETAL(_ALARM+1000)
N1110 M0
ENDIF
_M_ZUST[7]=0 _ALARM=0 _SERR=""
_MPCOUNT=_MPCOUNT+1
_M_ME[4]=SET(0,0,0,0,0)
ENDIF
IF (_H_RINMA==0) GOTOF _M113NR
IF ((_H_STMV[3]<>2)AND(_H_STMV[0]<>2)) GOTOF _M115
IF (_M_ZUST[7]==1) GOTOF _M115B
_MPCOUNT=_MPCOUNT+1
GOTOB _M91UB
_M113NR: IF (_H_STMV[0]<>2) GOTOF _M115
IF ((_H_WZT==2)OR(_H_WZT==5)) GOTOF _M115
IF (_M_ZUST[7]==1) GOTOF _M115B
_MPCOUNT=_MPCOUNT+1
GOTOB _M91MWH
_M115: IF _M_ZUST[7]==0 GOTOB _M91
_M115B:
IF (_ALARM)
IF ((_ALARM>=61303)AND(_ALARM<=61306))
GOTOF _ENDALARM
ELSE
GOTOF _FEHL1
ENDIF
ENDIF
IF (_H_STMV[0]==0) GOTOF _M116AE
IF ((_M_N[18]==2)OR(_M_N[18]==4)) GOTOF _M116AE
IF ( (_H_RINMA==1)AND((_H_STMV[3]>=2)OR(_H_STMV[0]==2)) )
IF ( (ABS(_OVR[13]))>=(_M_SPE[33]) )
REPEAT _KORR_R_A _KORR_R_E
ELSE
REPEAT _WERTE_PROT_R_A _WERTE_PROT_R_E
ENDIF
IF ( (ABS(_OVR[9+_HI[3]]))>=(_M_SPE[33]) )
REPEAT _KORR_L_A _KORR_L_E
ELSE
REPEAT _WERTE_PROT_L_A _WERTE_PROT_L_E
ENDIF
ELSE
IF ((_H_STMV[3]==1)AND(_H_STMV[0]==1))
IF ( (ABS(_OVR[13]))>=(_M_SPE[33]) )
REPEAT _KORR_R_A _KORR_R_E
ELSE
REPEAT _WERTE_PROT_R_A _WERTE_PROT_R_E
ENDIF
ELSE
IF (_BEL_WI==0)
IF ( (ABS(_OVR[9+_HI[3]]))>=(_M_SPE[33]) )
REPEAT _KORR_L_A _KORR_L_E
ELSE
REPEAT _WERTE_PROT_L_A _WERTE_PROT_L_E
ENDIF
ELSE
CASE (_SC_TLC) OF 0 GOTOF _P18_M18 18 GOTOF _P18_M18 -18 GOTOF _P18_M18 19 GOTOF _P19_M17 -17 GOTOF _P19_M17 17 GOTOF _P17_M19 -19 GOTOF _P17_M19
_P18_M18:
IF ( (ABS(_OVR[9])>=_M_SPE[33])OR(ABS(_OVR[11])>=_M_SPE[33]) )
REPEAT _KORR_L_A _KORR_L_E
ELSE
REPEAT _WERTE_PROT_L_A _WERTE_PROT_L_E
ENDIF
GOTOF _END_SC_TLC
_P19_M17:
IF ( (ABS(_OVR[9])>=_M_SPE[33])OR(ABS(_OVR[13])>=_M_SPE[33]) )
REPEAT _KORR_L_A _KORR_L_E
ELSE
REPEAT _WERTE_PROT_L_A _WERTE_PROT_L_E
ENDIF
GOTOF _END_SC_TLC
_P17_M19:
IF ( (ABS(_OVR[11])>=_M_SPE[33])OR(ABS(_OVR[13])>=_M_SPE[33]) )
REPEAT _KORR_L_A _KORR_L_E
ELSE
REPEAT _WERTE_PROT_L_A _WERTE_PROT_L_E
ENDIF
GOTOF _END_SC_TLC
_END_SC_TLC:
ENDIF
ENDIF
ENDIF
_M116AE:
IF ( (_H_AMODE[3]==1)AND((_H_STMV[0]==0)OR(_H_STMV[0]==1)) )
IF (_H_STMV[3]==2)
_HF1=_VAV _HF2=_MAV
IF (_HMA==1)
_HR[5]=_M_SPE[6] _HR[6]=_M_SPE[5]
ELSE
IF (_HMA==2)
_HR[5]=_M_SPE[5] _HR[6]=_M_SPE[6]
ELSE
GOTOF _ENDSTARTPOS
ENDIF
ENDIF
ELSE
_HF1=_MAV _HF2=_VAV
IF (_HMA==1)
_HR[5]=_M_SPE[5] _HR[6]=_M_SPE[6]
ELSE
IF (_HMA==2)
_HR[5]=_M_SPE[6] _HR[6]=_M_SPE[5]
ELSE
GOTOF _ENDSTARTPOS
ENDIF
ENDIF
ENDIF
N40302 AX[_HF1]=_HR[5]
N40303 AX[_HF2]=_HR[6]
ENDIF
_ENDSTARTPOS:
IF (_H_STMV[0]==0)
IF ( ABS(_OVR[9+_HI[3]])<_M_SPE[33] )
_OK_TW=1
ENDIF
GOTOF _M117
ENDIF
IF (_H_STMV[0]==1) GOTOF _ENDALARM
IF (_MPCOUNT==0) GOTOF _M116HEI
IF ((_H_WZT==1)AND(_TOOLR==0)) GOTOF _M116FR0
IF (_H_WZT<>5) GOTOF _M116FRA
_ALARM=61302
IF ((_AD2==1)OR(_AD2==2)) GOTOF _M116NE
_M116POS: _HR[5]=_LTP[_P_PL]+_M_SPE[3]
GOTOF _M116FA
_M116NE: _HR[5]=_LTP[_P_PL+1]-_M_SPE[3]
_M116FA:
IF (_INTERN[40+2])
N3020 MEAS=_M_N[0] AX[_VAV]=_HR[5]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N3030 AX[_VAV]=_HR[5]
ENDIF
_HMA=2 _ALARM=61325 _M_ZUST[7]=0 _M_ZUST[0]=SET(0,0,0,0)
_MAV=_YY _P_POS=_HR[5] _P_PT=2 _AXIND=1 _VAV=_XX _HI[0]=2 _P_PL=0
IF (_BEL_WI==1)
_ALARM=61099 _SERR="GETTCOR"
_GC_ST=GETTCOR(_GC_LEN,"-TCK:W",,_TNO,_DNO)
IF _GC_ST<0 GOTOF _FEHL2
_ALARM=0 _SERR=""
_M_SPE[11]=SET(_GC_LEN[2],_GC_LEN[3],_GC_LEN[4])
ENDIF
GOTOB _M2
_M116FR0: _ALARM=61302
IF (_M_SPE[6]>_HR[4]) GOTOB _M116POS
GOTOB _M116NE
_M116FRA: IF (_H_RINMA==0) GOTOF _M116FL
IF (_H_STMV[3]<3) GOTOF _M116KU
_P_PT=_P_PT+1*_MESSR
_MESSR=-_MESSR
_HR[6]=_LTP[_P_PT]+((_M_SPE[3]+_TOOLR)*_MESSR)
IF (_H_STMV[2]==0)
IF (_M_N[13]>0)
IF ($AC_SDIR[0]==5)
SPOS=IC(180)
ENDIF
ELSE
_ALARM=61287
GOTOF _FEHL24
ENDIF
ENDIF
IF (_HR[7]<0)
_HR[9]=_LTP[2]
_HR[5]=_LTP[3]-_M_SPE[3]
ELSE
_HR[9]=_LTP[3]
_HR[5]=_LTP[2]+_M_SPE[3]
ENDIF
IF (_INTERN[40+2])
_ALARM=61302
N60201 MEAS=_M_N[0] AX[_YY]= _HR[9]-_HR[7]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N60202 MEAS=_M_N[0] AX[_XX]=_HR[6]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N60203 MEAS=_M_N[0] AX[_YY]=_HR[5]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N60301 AX[_YY]=_HR[9]-_HR[7]
N60302 AX[_XX]=_HR[6]
N60303 AX[_YY]=_HR[5]
ENDIF
_ALARM=0 _SERR=""
_M116N: _HMA=2 _ALARM=61325 _M_ZUST[7]=0 _M_ZUST[0]=SET(0,0,0,0) _H_RINMA=0
_MAV=_YY _P_POS=_HR[5] _P_PT=2 _AXIND=1 _VAV=_XX _HI[0]=2 _P_PL=0
GOTOB _M2
_M116KU:
IF (_M_SPE[6]>_HR[4])
_HR[5]=_LTP[2]+_M_SPE[3]
ELSE
_HR[5]=_LTP[3]-_M_SPE[3]
ENDIF
_ALARM=61302
IF (_INTERN[40+2])
N90201 MEAS=_M_N[0] AX[_YY]=_HR[5]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N90301 AX[_YY]=_HR[5]
ENDIF
_ALARM=0 _SERR=""
GOTOB _M116N
_M116FL: IF (_H_STMV[3]<3) GOTOF _M116NR
IF (_H_STMV[2]==0)
IF (_M_N[13]>0)
IF ($AC_SDIR[0]==5)
SPOS=IC(180)
ENDIF
ELSE
_ALARM=61287
GOTOF _FEHL24
ENDIF
ENDIF
IF (_HR[7]<0)
_HR[9]=_LTP[0]
ELSE
_HR[9]=_LTP[1]
ENDIF
IF (_M_SPE[6]<=_HR[4])
_HR[8]=_LTP[3]-_M_SPE[3]-_TOOLR
_HR[5]=_LTP[2]+_M_SPE[3]+_TOOLR
ELSE
_HR[8]= _LTP[2]+_M_SPE[3]+_TOOLR
_HR[5]=_LTP[3]-_M_SPE[3]-_TOOLR
ENDIF
IF (_INTERN[40+2])
_ALARM=61302
N80201 MEAS=_M_N[0] AX[_YY]=_HR[8]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N80202 MEAS=_M_N[0] AX[_XX]=_HR[9]-_HR[7]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N80203 MEAS=_M_N[0] AX[_YY]=_HR[5]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N80301 AX[_YY]=_HR[8]
N80302 AX[_XX]=_HR[9]-_HR[7]
N80302 AX[_YY]=_HR[5]
ENDIF
_ALARM=0 _SERR=""
GOTOB _M116N
_M116NR:
IF (_M_SPE[6]>_HR[4])
_HR[5]=_LTP[3]-_M_SPE[3]-_TOOLR
ELSE
_HR[5]=_LTP[2]+_M_SPE[3]+_TOOLR
ENDIF
IF (_INTERN[40+2])
_ALARM=61302
N70201 MEAS=_M_N[0] AX[_YY]=_HR[5]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N70301 AX[_YY]=_HR[5]
ENDIF
_ALARM=0 _SERR=""
GOTOB _M116N
_M116HEI: IF (_MPSOLL>1) GOTOF _M116MP2
_HR[5]=_P_POS _HF1=_MAV _HF2=_VAV
_HR[6]=_M_SPE[5]
IF _HMA==2 GOTOF _M116KW
_HR[6]=_M_SPE[6]
_M116KW:
IF (_INTERN[40+2])
_ALARM=61302
N40202 MEAS=_M_N[0] AX[_HF1]=_HR[5]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
N40203 MEAS=_M_N[0] AX[_HF2]=_HR[6]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _FEHL7
ELSE
N40302 AX[_HF1]=_HR[5]
N40303 AX[_HF2]=_HR[6]
ENDIF
_ALARM=0 _SERR=""
GOTOF _ENDALARM
_M116MP2:
IF (_MPSOLL<=2)
_HF1=_XX _HF2=_YY _HR[5]=_M_SPE[5] _HR[6]=_M_SPE[6]
GOTOB _M116KW
ENDIF
_HF1=_XX _HF2=_YY
IF ((_H_STMV[3]==4)AND(_H_RINMA==0))
N40402 AX[_HF1]=_HR[6]
N40403 AX[_HF2]=((_LTP[2]+_LTP[3])/2)
ENDIF
_HR[5]=_M_SPE[5] _HR[6]=_M_SPE[6]
GOTOB _M116KW
_M117:
IF (_M_N[18]==2) OR (_M_N[18]==4) GOTOF _ENDALARM
IF (_H_STMV[1]==0)
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_P_PROB] _DEC3
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
$SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]=_LTP[0] $SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB]=_LTP[1]
$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]=_LTP[2] $SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB]=_LTP[3]
ENDIF
IF (_MA==1)
IF (_HI[0]==0)
IF (_OK_TW==0)
$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==1) )
_K_STAT_ABS=_K_STAT_ABS+2
ENDIF
ELSE
IF (_OK_TW==0)
$SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==2) )
_K_STAT_ABS=_K_STAT_ABS+1
ENDIF
ENDIF
ENDIF
IF (_MA==2)
IF (_HI[0]==2)
IF (_OK_TW==0)
$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==1) )
_K_STAT_ORD=_K_STAT_ORD+2
ENDIF
ELSE
IF (_OK_TW==0)
$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==2) )
_K_STAT_ORD=_K_STAT_ORD+1
ENDIF
ENDIF
ENDIF
IF ( (_INTERN[18])AND(_FRAES_DREH==0) )
$SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_P_PROB]=_LTP[4] $SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_P_PROB]=_LTP[5]
ENDIF
$SNS_MEA_TP_FEED[_P_PROB]=_M_SPE[0] _K_STAT_CYC=2 _K_STAT_KOORD=$MCS_DISP_COORDINATE_SYSTEM
$SNS_MEA_TP_STATUS_GEN[_P_PROB]=$P_GG[6]+(10*_K_STAT_ABS)+(100*_K_STAT_ORD)+(10000*_K_STAT_CYC)+(100000*_K_STAT_KOORD)
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
_TP[0,0]=REP(-9999)
ENDIF
ELSE
_K_STAT_ABS=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC2
_K_STAT_ORD=$SNS_MEA_TPW_STATUS_GEN[_P_PROB] _DEC3
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]=_LTP[0] $SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB]=_LTP[1]
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]=_LTP[2] $SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB]=_LTP[3]
ENDIF
IF (_MA==1)
IF (_HI[0]==0)
IF (_OK_TW==0)
$SNS_MEA_TPW_TRIG_PLUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==1) )
_K_STAT_ABS=_K_STAT_ABS+2
ENDIF
ELSE
IF (_OK_TW==0)
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX1[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==2) )
_K_STAT_ABS=_K_STAT_ABS+1
ENDIF
ENDIF
ENDIF
IF (_MA==2)
IF (_HI[0]==2)
IF (_OK_TW==0)
$SNS_MEA_TPW_TRIG_PLUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==1) )
_K_STAT_ORD=_K_STAT_ORD+2
ENDIF
ELSE
IF (_OK_TW==0)
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX2[_P_PROB]=_OVR[8+_HI[3]]
ENDIF
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==2) )
_K_STAT_ORD=_K_STAT_ORD+1
ENDIF
ENDIF
ENDIF
IF ( (_INTERN[18])AND(_FRAES_DREH==0) )
$SNS_MEA_TPW_TRIG_MINUS_DIR_AX3[_P_PROB]=_LTP[4] $SNS_MEA_TPW_TRIG_PLUS_DIR_AX3[_P_PROB]=_LTP[5]
ENDIF
$SNS_MEA_TPW_FEED[_P_PROB]=_M_SPE[0] _K_STAT_CYC=2 _K_STAT_KOORD=$MCS_DISP_COORDINATE_SYSTEM
$SNS_MEA_TPW_STATUS_GEN[_P_PROB]=$P_GG[6]+(10*_K_STAT_ABS)+(100*_K_STAT_ORD)+(10000*_K_STAT_CYC)+(100000*_K_STAT_KOORD)
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
_TPW[0,0]=REP(-9999)
ENDIF
ENDIF
GOTOF _ENDALARM
_FEHL1: STOPRE
_OVI[9]=_ALARM
N698201 SETAL(_ALARM)
_FEHL2: STOPRE
_OVI[9]=_ALARM
N698202 SETAL(_ALARM,_SERR)
_FEHL3: STOPRE
_OVI[9]=_ALARM
N698203 SETAL(_ALARM)
_FEHL4: STOPRE
_OVI[9]=_ALARM
N698204 SETAL(_ALARM)
_FEHL5: STOPRE
_OVI[9]=_ALARM
N698205 SETAL(_ALARM)
_FEHL6: STOPRE
_OVI[9]=_ALARM
N698206 SETAL(_ALARM)
_FEHL7: STOPRE
_OVI[9]=_ALARM
N698207 SETAL(_ALARM)
_FEHL8: STOPRE
_OVI[9]=_ALARM
N698208 SETAL(_ALARM)
_FEHL9: STOPRE
_OVI[9]=_ALARM
N698209 SETAL(_ALARM)
_FEHL10: STOPRE
_OVI[9]=_ALARM
N698210 SETAL(_ALARM)
_FEHL11: STOPRE
_OVI[9]=_ALARM
N698211 SETAL(_ALARM)
_FEHL12: STOPRE
_OVI[9]=_ALARM
N698212 SETAL(_ALARM)
_FEHL13: STOPRE
_OVI[9]=_ALARM
N698213 SETAL(_ALARM)
_FEHL14: STOPRE
_OVI[9]=_ALARM
N698214 SETAL(_ALARM)
_FEHL15: STOPRE
_OVI[9]=_ALARM
N698215 SETAL(_ALARM,_SERR)
_FEHL16: STOPRE
_OVI[9]=_ALARM
N698216 SETAL(_ALARM,_SERR)
_FEHL17: STOPRE
_OVI[9]=_ALARM
N698217 SETAL(_ALARM)
_FEHL18: STOPRE
_OVI[9]=_ALARM
N698218 SETAL(_ALARM)
_FEHL19: STOPRE
_OVI[9]=_ALARM
N698219 SETAL(_ALARM,_SERR)
_FEHL20: STOPRE
_OVI[9]=_ALARM
N698220 SETAL(_ALARM)
_FEHL21: STOPRE
_OVI[9]=_ALARM
N698221 SETAL(_ALARM)
_FEHL22: STOPRE
_OVI[9]=_ALARM
N698222 SETAL(_ALARM)
_FEHL23: STOPRE
_OVI[9]=_ALARM
N698223 SETAL(_ALARM)
_FEHL24: STOPRE
_OVI[9]=_ALARM
N698224 SETAL(_ALARM)
_ENDALARM:
_OVI[9]=_ALARM
_M120A:
IF ((_ALARM>=61303)AND(_ALARM<=61306))
IF (_INTERN[4]==1)
CUST_MEACYC(4)
ENDIF
GOTOF _M121
ENDIF
IF (_ALARM == 0) GOTOF _M121
STOPRE
N1200 SETAL(_ALARM)
_M120B:M0
STOPRE
N698208 SETAL(61327)
GOTOB _M120B
_M121: _PROTVAL[29]="T,"<<($P_GG[6]+16)<<",,,,,F"<<_M_SPE[0]
IF (((_SMI_R[10]==0)OR(_SMI_R[10]==11))AND(_M_SPE20=="-777"))
IF (_H_STMV[1]==0)
_TP[0,0]=REP(-9999)
ELSE
_TPW[0,0]=REP(-9999)
ENDIF
ENDIF
D=$P_TOOL DL=$P_DLNO
IF (_ALARM)
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M123
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M122
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
IF NOT((_INTERN[4]==1) AND (_INTERN[5]==1))
N1153 SETAL(_ALARM+1000)
ENDIF
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M121A IF _M_N[28]==2 GOTOF _M122
G4 F8
N1160 _M121A: CYCLE102(0)
N1200 _M122:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF (_M_SPE[29]<>1)
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
_M123:
IF _ALARM
STOPRE
IF NOT((_INTERN[4]==1) AND (_INTERN[5]==1))
IF (_ALARM>61303)
IF _INTERN[20+2]
N1230 SETAL(_ALARM+1000)
N1240 M0
ELSE
_OVI[9]=_OVI[9]-1000
N1230 SETAL(_ALARM)
ENDIF
ELSE
_OVI[9]=_ALARM
N698209 SETAL(_ALARM)
ENDIF
STOPRE
N1195 MSG()
ENDIF
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
IF (_H_STMV[1]==0)
$P_CYCFRAME=CTRANS()
ENDIF
M17
N698217 _ENDE: SETAL(62301)
M0
_GENDE: M17
_K_STAT_A:
IF (_H_STMV[0]<>0)
_ALARM=61374
_S_XX=AXSTRING(_XX) _S_YY=AXSTRING(_YY) _S_ZZ=AXSTRING(_ZZ)
IF ( (_M_ZUST[0])OR((_SPECD==1)AND(_M_ZUST[4])) )
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==1) )
IF (_SPECD==1)
_SERR=<<"+"<<_S_ZZ
ELSE
_SERR=<<"+"<<_S_XX
ENDIF
GOTOB _FEHL15
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF ( (_M_ZUST[1])OR((_SPECD==1)AND(_M_ZUST[5])) )
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==2) )
IF (_SPECD==1)
_SERR=<<"-"<<_S_ZZ
ELSE
_SERR=<<"-"<<_S_XX
ENDIF
GOTOB _FEHL15
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF ( (_M_ZUST[2])OR((_SPECD==2)AND(_M_ZUST[4])) )
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==1) )
IF (_SPECD==2)
_SERR=<<"+"<<_S_ZZ
ELSE
_SERR=<<"+"<<_S_YY
ENDIF
GOTOB _FEHL15
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
IF (_M_ZUST[3])OR((_SPECD==2)AND(_M_ZUST[5]))
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==2) )
IF (_SPECD==2)
_SERR=<<"-"<<_S_ZZ
ELSE
_SERR=<<"-"<<_S_YY
ENDIF
GOTOB _FEHL15
ELSE
GOTOF _K_STAT_ENDE
ENDIF
ENDIF
_K_STAT_ENDE:
_ALARM=0 _SERR=""
ENDIF
_K_STAT_E:
_KORR_R_A:
_WERTE_PROT_R_A:
_CORCOMP=6
IF (_INTERN[40+3])
_COMP="W" _CORMODE=1 _KOR_TOOLL[0]=_OVR[13] _PROTVAL[28]="$P_ADT[15]"
ELSE
_COMP="GW" _CORMODE=2 _KOR_TOOLL[0]=_OVR[12] _PROTVAL[28]="$P_ADT[6]"
ENDIF
_WERTE_PROT_R_E:
REPEAT _SETTCOR_A _SETTCOR_E
_KORR_R_E:
_KORR_L_A:
_WERTE_PROT_L_A:
_CORCOMP=0
IF (_INTERN[40+3])
_COMP="W" _CORMODE=1 _GEOAX=_HMA-1 _KOR_TOOLL[0]=_MD_RESU
IF (_BEL_WI==0)
IF (9+_HI[3]==9)
_PROTVAL[25] ="$P_ADT[12]"
ENDIF
IF (9+_HI[3]==11)
_PROTVAL[26] ="$P_ADT[13]"
ENDIF
IF (9+_HI[3]==13)
_PROTVAL[27] ="$P_ADT[14]"
ENDIF
IF ( ($SC_TOOL_LENGTH_TYPE==0) AND (_H_WZT==2) AND (($P_GG[6]==1) OR ($P_GG[6]==3)) )
_GEOAX=2
_PROTVAL[25] ="$P_ADT[12]"
ENDIF
IF( (($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1') OR ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B10')) AND (_H_WZT==5) )
_IW_SOLL=$P_ADT[11+_M_N[15+_AXIND]]
ENDIF
ELSE
_PROTVAL[25] ="$P_ADT[12]"
_PROTVAL[26] ="$P_ADT[13]"
_PROTVAL[27] ="$P_ADT[14]"
ENDIF
ELSE
_COMP="GW" _CORMODE=2 _GEOAX=_HMA-1 _KOR_TOOLL[0]=_IW_RESU
IF (_BEL_WI==0)
IF (8+_HI[3]==8)
_PROTVAL[25] ="$P_ADT[3]"
ENDIF
IF (8+_HI[3]==10)
_PROTVAL[26] ="$P_ADT[4]"
ENDIF
IF (8+_HI[3]==12)
_PROTVAL[27] ="$P_ADT[5]"
ENDIF
IF ( ($SC_TOOL_LENGTH_TYPE==0) AND (_H_WZT==2) AND (($P_GG[6]==1) OR ($P_GG[6]==3)) )
_GEOAX=2
_PROTVAL[25] ="$P_ADT[3]"
ENDIF
IF( (($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1') OR ($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B10')) AND (_H_WZT==5) )
_IW_SOLL=$P_ADT[2+_M_N[15+_AXIND]]+$P_ADT[11+_M_N[15+_AXIND]]
ENDIF
ELSE
_PROTVAL[25] ="$P_ADT[3]"
_PROTVAL[26] ="$P_ADT[4]"
_PROTVAL[27] ="$P_ADT[5]"
ENDIF
ENDIF
_WERTE_PROT_L_E:
REPEAT _SETTCOR_A _SETTCOR_E
_KORR_L_E:
_SETTCOR_A:
_OVI[12]=SETTCOR(_KOR_TOOLL,_COMP,_CORCOMP,_CORMODE,_GEOAX)
IF _OVI[12]<>0
_ALARM=61404
GOTOB _FEHL1
ENDIF
_SETTCOR_E:

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE994_SPF
PROC CYCLE994(INT S_MVAR,INT S_KNUM,INT S_KNUM1,INT S_PRNUM,REAL S_SETV,INT S_MA,REAL S_SZA,REAL S_SZO,REAL S_FA,REAL S_TSA,INT S_NMSP,STRING[32] S_TNAME,INT S_DLNUM,REAL S_TZL,REAL S_TDIF,REAL S_TUL,REAL S_TLL,REAL S_TMV,INT S_K,INT S_EVNUM,INT S_MCBIT,INT _DMODE,INT _AMODE,INT _DP) SAVE DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.015 ;DATE: 2024-07-15
;Cycle : workpiece measurement, turn machine
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_H_BOOL=0
N1010 DEF REAL _M_SPE[64],_M_ME[16],_P_POS,_TRIGLAG,_LAGE,_LAGE3,_HR[7],_DAT[3,6],_KF[3,3],_HSETVAL,_H_SIM
N1020 DEF INT _M_N[30],_ALARM,_P_PL,_P_PT,_MESSR,_AXIND,_H_A,_HI[6],_H_VAV1[2],_AD2,_IMA,_IVA,_H_SMVAR
N1030 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_VAV1,_HMAV
N1040 DEF INT _H_DMODE, _H_KNUM, _CHBIT_S[32]
N1042 DEF BOOL _NEW_PAR=0
N1044 DEF STRING[40] _SERR
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[38] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE994_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE994_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE994("<<S_MVAR<<","<<S_KNUM<<","<<S_KNUM1<<","<<S_PRNUM<<","<<S_SETV<<","<<S_MA<<","<<S_SZA<<","<<S_SZO<<","<<S_FA<<","<<S_TSA<<","<<S_NMSP<<","<<S_TNAME<<","<<S_DLNUM<<","<<S_TZL<<","<<S_TDIF<<","<<S_TUL<<","<<S_TLL<<","<<S_TMV<<","<<S_K<<","<<S_EVNUM<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _H_SMVAR=S_MVAR _OVI[3]=S_MVAR _NEW_PAR=1 _M_SPE[3]=1
_CHBIT_S[4]=_CHBIT[4] _CHBIT_S[6]=_CHBIT[6] _CHBIT_S[8]=_CHBIT[8] _CHBIT_S[21]=_CHBIT[21]
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 2 GOTOF _M_ERR
S_KNUM=ABS(S_KNUM) S_KNUM1=ABS(S_KNUM1)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 3
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM - 2000 + 50
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
GOTOF _HA2
_HA1:_M_N[14]=0
IF ((_H_KNUM _DEC1)== 2)
S_MVAR = S_MVAR - 200
_SERR=<<"(S_KNUM1: dec6)"
IF ((S_KNUM1 _DEC6) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1: dec7)"
IF ((S_KNUM1 _DEC7) > 4) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec8)"
IF ((S_KNUM1 _DEC8) > 1) GOTOF _M_ERR
_SERR=<<"(S_KNUM1 dec9)"
IF ((S_KNUM1 _DEC9) > 1) GOTOF _M_ERR
_SERR=<<"(ST)"
IF (S_KNUM1 _DEC9)AND(_DP <=0) GOTOF _M_ERR
IF (((S_KNUM1 _DEC7) > 0) AND ((S_KNUM1 _DEC7) < 4))
_DLNUM = S_DLNUM
ELSE
_DLNUM = 0
ENDIF
_CHBIT[6]=0 _CHBIT[8]=0
IF (S_KNUM1 _DEC7) == 4
S_KNUM1 = S_KNUM1 - 4000000 _CHBIT[6]=1
ENDIF
_SERR=<<"(S_KNUM1 DNo > MD18105)"
IF (((S_KNUM1 _DEC5)*10000)+((S_KNUM1 _DEC4)*1000)+((S_KNUM1 _DEC3)*100)+((S_KNUM1 _DEC2)*10)+((S_KNUM1 _DEC1))>$MN_MM_MAX_CUTTING_EDGE_NO) GOTOF _M_ERA
IF ($MN_MM_MAX_CUTTING_EDGE_NO >= 1000)
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 - 10000000 _H_KNUM=_H_KNUM+10
ENDIF
IF (S_KNUM1 _DEC6) == 0
ELSE
S_KNUM1=S_KNUM1+((S_KNUM1 _DEC6)*10000000)-((S_KNUM1 _DEC6)*100000)
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC6)*100000)
ENDIF
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 2000000 + 100000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 3000000 + 100000000 _CHBIT[8]=1
ENDIF
IF ((_H_KNUM _DEC2)==1)
S_KNUM1 = S_KNUM1 + 1000000
ENDIF
ELSE
IF ((S_KNUM1 _DEC7)== 0)
S_KNUM1 = S_KNUM1 - ((S_KNUM1 _DEC4)*1000)
ENDIF
IF (S_KNUM1 _DEC7) == 2
S_KNUM1 = S_KNUM1 - 1000000 _CHBIT[6]=1
ENDIF
IF (S_KNUM1 _DEC7) == 3
S_KNUM1 = S_KNUM1 - 2000000 _CHBIT[8]=1
ENDIF
IF ((S_KNUM1 _DEC8) == 1)
S_KNUM1 = S_KNUM1 + 10000 - 10000000
ENDIF
IF (S_KNUM1 _DEC9)
S_KNUM1=S_KNUM1 - 100000000
_M_N[14]=_DP
ENDIF
ENDIF
_KNUM = S_KNUM1
ENDIF
_HA2:
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) > 2) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 2) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4) > 3) GOTOF _M_ERR
S_MVAR = S_MVAR - ((S_MVAR _DEC2)*10)
S_MVAR = S_MVAR - ((S_MVAR _DEC5)*10000)
IF (((S_MVAR _DEC4)==0) AND ((S_MVAR _DEC1)==1))
S_MVAR = S_MVAR + 1
ENDIF
S_MA=ABS(S_MA)
_SERR=<<"(S_MA ?)"
IF (S_MA > 3) GOTOF _M_ERR
IF (((S_MVAR _DEC4)>0) AND ($MCS_MEA_FUNCTION_MASK B_AND 'B10'))
S_MA=S_MA + ((S_MVAR _DEC4)*100)
IF S_MA==201
S_MA=1
ENDIF
ENDIF
S_MVAR = S_MVAR - ((S_MVAR _DEC4)*1000)
IF (_H_KNUM==0)
_KNUM=0
IF ((_AMODE _DEC1) == 1)
_AMODE = _AMODE -1
ENDIF
ENDIF
_MVAR=S_MVAR _PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _MA=S_MA _FA=ABS(S_FA) _TSA=ABS(S_TSA)
_SZO=S_SZA _SZA=S_SZO _HI[3]=61940
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(_AMODE: dec1)"
_AMODE = ABS(_AMODE)
IF ((_AMODE _DEC1) > 1) GOTOF _M_ERR
IF (_AMODE _DEC1) == 1
_TZL=S_TZL _TDIF=S_TDIF _TUL=S_TUL _TLL=S_TLL _M_N[23]=_M_N[23]+100
ELSE
_TZL=0 _TUL=1.01*(ABS(S_TSA)) _TLL=-_TUL _TDIF=_TUL
ENDIF
_CHBIT[4]=0
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 20 GOTOF _M_ERR
IF (((S_EVNUM _DEC6)*10) + (S_EVNUM _DEC5)) > 0
_CHBIT[4]=1
_K = ABS(S_K)
_TMV=ABS(S_TMV)
ELSE
_TMV=ABS((_TUL - _TLL) / 3)
_K=1
ENDIF
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC2)*10) + (S_EVNUM _DEC1)) > 20 GOTOF _M_ERR
IF S_EVNUM<>0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(S_TNAME)"
IF _H_KNUM==2
IF (((_H_KNUM _DEC1)==2) AND (S_TNAME == "")) GOTOF _M_ERR
IF ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B1') OR ($MN_MM_TOOL_MANAGEMENT_MASK B_AND 'B10')
_TNAME =<< S_TNAME _TNUM = 0
ELSE
_TNAME=<<"" _TNUM = NUMBER(S_TNAME)
ENDIF
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
_VB[15]=1 _M_SPE[3]=1 _NEW_PAR=1
IF (_MVAR _DEC5 == 1)
_H_SMVAR = 1
_MVAR = _MVAR - 10000
ENDIF
ELSE
_HI[3]=61307
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N699401 SETAL(_ALARM,_SERR)
RET
_M_ERA: _ALARM=61021 _OVI[9]=_ALARM
STOPRE
N699402 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M120
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18]=1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
_OVI[2]=994
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N1056 CYCLE109(_INTERN,_M_SPE,_M_N)
IF _NEW_PAR
DIAMON
ELSE
IF $P_GG[29]==3
N1058 DIAMON
ENDIF
ENDIF
_ALARM=61307
IF (_MVAR<1) AND (_MVAR>2) GOTOF _M120
_IMA=(_MA MOD 10) _IVA=(_MA DIV 100 MOD 10)
_ALARM=61325
IF (_IMA<1) OR (_IMA>3) GOTOF _M120
IF (_IVA>3) GOTOF _M120
IF (_IVA==2) AND (_IMA==1) GOTOF _M120
IF ((_MA DIV 10 MOD 10)>0) GOTOF _M120
IF (_MA>302) GOTOF _M120
N1060 _ALARM=0
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_ALARM=61336
IF (_INTERN[2]==0)OR(_INTERN[10]==0) GOTOF _M120
IF ((_IMA==3)AND(_INTERN[18]==0)) GOTOF _M120
IF ((_IVA==3)AND(_INTERN[18]==0)) GOTOF _M120
_AD2=$P_ADT[2]
_OVR[27]=_M_SPE[33] _OVR[0]=_M_SPE[16] _OVR[_IMA]=_OVR[0] _ALARM=61330
IF _VB[0]==0
IF _M_N[12]==0
IF _IMA==1
_M_N[12]=_M_N[15]
ELSE
IF _IMA==2
_M_N[12]=_M_N[16]
ELSE
IF _VB[33] AND _INTERN[40+19]
_M_N[12]=_M_N[16]
ELSE
_M_N[12]=_M_N[17]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HR[2]=$P_ADT[6]/2
ELSE
_HR[2]=$P_ADT[6]
ENDIF
_M5:IF _VB[24] GOTOF _M120
N1061 G0 G90 G94
IF _VB[1] GOTOF _M6
N1062 G1 F=_M_SPE[1]
_M6:_ALARM=61024 _HSETVAL=_SETVAL/_M_SPE[29] _HI[2]=1
IF _HSETVAL<0 GOTOF _M122A IF _IVA==0 GOTOF _M61
_HR[3]=_SZO/_M_SPE[29]
_HR[4]=_SZA/_M_SPE[29]
IF _IMA==1
_MAV=_XX _HMAV=_MAV _P_POS=_M_SPE[5] _P_PL=7 _P_PT=1 _AXIND=0 _H_A=0
ELSE
IF _IMA==2
_MAV=_YY _HMAV=_MAV _P_POS=_M_SPE[6] _P_PL=8 _P_PT=3 _AXIND=1 _H_A=2
ELSE
_MAV=_ZZ _HMAV=_MAV _P_POS=_M_SPE[7] _P_PT=5 _AXIND=2 _H_A=0 _HI[2]=2
IF _IVA==1
_H_VAV1[0]=1 _VAV1=_YY
ELSE
_H_VAV1[0]=0 _VAV1=_XX
ENDIF
IF _VB[33] AND _INTERN[40+19]
_HMAV=_YY
IF (_INTERN[8] AND _INTERN[9])
IF (_MVAR==2)
_HSETVAL=_HSETVAL/2
ENDIF
_M_SPE[16]=_M_SPE[16]/2 _HR[3]=_HR[3]/2
ENDIF
ENDIF
_H_VAV1[1]=_INTERN[_H_VAV1[0]*8+1] _H_VAV1[1]=_H_VAV1[1]+1
ENDIF
ENDIF
IF _IVA==1
_VAV=_XX _HI[0]=0
ELSE
IF _IVA==2
_VAV=_YY _HI[0]=1
ELSE
_VAV=_ZZ _HI[0]=2
IF _VB[33] AND _INTERN[40+19]
IF (_INTERN[8] AND _INTERN[9])
_HR[4]=_HR[4]/2
ENDIF
ENDIF
IF _IMA==1
_H_VAV1[0]=1 _VAV1=_YY
ELSE
_H_VAV1[0]=0 _VAV1=_XX
ENDIF
_H_VAV1[1]=_INTERN[_H_VAV1[0]*8+1] _H_VAV1[1]=_H_VAV1[1]+1
ENDIF
ENDIF
GOTOF _M7
_M61:
_MAV=_XX _HMAV=_MAV _P_POS=_M_SPE[5] _P_PL=7 _P_PT=1 _HR[3]=_SZA/_M_SPE[29]
_VAV=_YY _HI[0]=1 _HR[4]=_SZO/_M_SPE[29] _IVA=2
IF _IMA==1 GOTOF _M7
_MAV=_YY _HMAV=_MAV _P_POS=_M_SPE[6] _P_PL=8 _P_PT=3 _AXIND=1 _HR[3]=_SZO/_M_SPE[29] _H_A=2
_VAV=_XX _HI[0]=0 _HR[4]=_SZA/_M_SPE[29] _IVA=1
IF _IMA==2 GOTOF _M7
_MAV=_ZZ _HMAV=_MAV _P_POS=_M_SPE[7] _P_PT=5 _AXIND=2 _HI[2]=1 _HR[3]=_SZO/_M_SPE[29] _H_A=0
_VAV=_XX _HI[0]=0 _HR[4]=_SZA/_M_SPE[29] _H_VAV1[0]=1 _VAV1=_YY
IF (_VB[33] AND _INTERN[40+19])
_HMAV=_YY
IF (_INTERN[8] AND _INTERN[9])
_M_SPE[16]=_M_SPE[16]/2 _HR[3]=_HR[3]/2 _HI[2]=2
ENDIF
ENDIF
_H_VAV1[1]=_INTERN[_H_VAV1[0]*8+1] _H_VAV1[1]=_H_VAV1[1]+1
_M7:_HI[1]=_INTERN[_HI[0]*8+1] _HI[1]=_HI[1]+1 _M_ME[10]=_HR[4] _HI[5]=_M_SPE[54] MOD 100
IF _HSETVAL < (_P_POS*_HI[2]) GOTOF _M72
_ALARM=61940
IF (_MVAR==2)AND(_MA>3)AND(_NEW_PAR) GOTOF _M120
IF _MVAR==1
IF _HR[3]<0
_ALARM=61334
ENDIF
IF (_IMA==2)AND(_INTERN[9])
IF (_HR[3] >= _HSETVAL - _HR[2]*2)
_ALARM=61334
ENDIF
ELSE
IF (_HR[3] >= _HSETVAL - _HR[2])
_ALARM=61334
ENDIF
ENDIF
ENDIF
IF _ALARM==61334 GOTOF _M120 IF _MAV<>_YY GOTOF _M71
_M_ZUST[2]=1 _MD=0
GOTOF _M8
_M71:_M_ZUST[0]=1 _MD=0
GOTOF _M8
_M72: _M_ZUST[4]=1 _ALARM=_HI[3]
IF _MVAR==1 GOTOF _M120 IF(_MVAR==2)AND(_H_SMVAR==1)AND(_NEW_PAR) GOTOF _M120
IF _HR[3]<0
_ALARM=61334
ENDIF
IF (_IMA==2)AND(_INTERN[9])
IF (_HR[3] < _HSETVAL + _HR[2]*2)
_ALARM=61334
ENDIF
ELSE
IF (_HR[3]<(_HSETVAL + _HR[2]))
_ALARM=61334
ENDIF
ENDIF
IF _ALARM==61334 GOTOF _M120 IF _MAV<>_YY GOTOF _M73
_M_ZUST[3]=1 _MD=1
GOTOF _M8
_M73: _M_ZUST[1]=1 _MD=1
_M8:_ALARM=0
IF(($SNS_MEA_FUNCTION_MASK B_AND 'B10000')OR(($MCS_TECHNOLOGY==1)AND($MCS_TECHNOLOGY_EXTENSION==2)AND(_VB[33]==1)))AND(_OVI[1]==710)AND(_NEW_PAR)
_ALARM=61341
IF _M_N[24]==8
_M_SPE[21]=SET(-_M_SPE[24],-_M_SPE[23],_M_SPE[21],_M_SPE[22],_M_SPE[25],_M_SPE[26],-_M_SPE[28],_M_SPE[27])
IF(_M_SPE[54] _DEC3)==1
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _M_N[24]==6
_M_SPE[21]=SET(_M_SPE[23],_M_SPE[24],-_M_SPE[22],-_M_SPE[21],_M_SPE[25],_M_SPE[26],_M_SPE[28],-_M_SPE[27])
IF(_M_SPE[54] _DEC3)==1
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF _M_N[24]==5
_M_SPE[21]=SET(-_M_SPE[22],-_M_SPE[21],-_M_SPE[24],-_M_SPE[23],_M_SPE[25],_M_SPE[26],-_M_SPE[27],_M_SPE[28])
IF(_M_SPE[54] _DEC3)==1
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==1
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ENDIF
ENDIF
ELSE
IF(_M_SPE[54] _DEC3)==3
IF(_MA MOD 100)==1
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M120
ELSE
IF(_MA MOD 100)==2
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M120
ELSE
IF(_INTERN[20+16]==1)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M120
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_HI[4]=_INTERN[20+14] _LAGE3=(_M_SPE[25]-ABS(_M_SPE[26]))/2
IF _INTERN[3] AND(NOT(_INTERN[11]))AND(NOT($SCS_FUNCTION_MASK_SWIVEL_SET B_AND 'B100000'))AND(_M_N[24]==8)
_LAGE3=-_LAGE3
ENDIF
ENDIF
_HR[5]=_M_SPE[5+_HI[0]]+(_M_SPE[27+_HI[0]]*_HI[1])
IF _NEW_PAR
IF(_M_N[24]==5)OR(_M_N[24]==7)
IF(_MA==2)OR(_MA==102)OR(_MA==302)
IF _VAV== _ZZ
_HR[5]=(_M_SPE[5+_HI[0]]+_LAGE3)*_HI[1]
ENDIF
N1063 AX[_ZZ]=(_M_SPE[7]+_LAGE3)*_M_SPE[29]
ELSE
IF(_MA==3)OR(_MA==103)OR(_MA==203)
N1065 AX[_YY]=(_M_SPE[6]+(_M_SPE[28]*2))*_M_SPE[29]
ENDIF
ENDIF
IF _HI[4]==1
N1067 AX[_XX]=(_M_SPE[5]-_HR[2])*_M_SPE[29]
ENDIF
ELSE
IF(_MA==1)OR(_MA==301)
IF _VAV== _ZZ
_HR[5]=(_M_SPE[5+_HI[0]]+_LAGE3)*_HI[1]
ENDIF
N1069 AX[_ZZ]=(_M_SPE[7]+_LAGE3)*_M_SPE[29]
ELSE
IF(_MA==203)OR(_MA==103)
N1071 AX[_XX]=(_M_SPE[5]+_M_SPE[27])*_M_SPE[29]
ENDIF
ENDIF
IF _HI[4]==1
N1075 AX[_YY]=(_M_SPE[6]-(_HR[2]*2))*_M_SPE[29]
ENDIF
ENDIF
ELSE
_HR[5]=_M_SPE[5+_HI[0]]+(_M_SPE[27+_HI[0]]*_HI[1])
IF _VAV== _ZZ
_HR[5]=_M_SPE[5+_HI[0]]*_HI[1]
ENDIF
N1077 AX[_VAV]=_HR[5]*_M_SPE[29]
IF (_IMA==3)AND(_IVA==3)
N1078 AX[_VAV1]=(_M_SPE[5+_H_VAV1[0]]+(_M_SPE[27+_H_VAV1[0]]*_H_VAV1[1]))*_M_SPE[29]
ENDIF
ENDIF
_HI[1]=_INTERN[_AXIND*8+1] _HI[1]=_HI[1]+1 _ALARM=0 _HI[2]=2
N1079 _M9:IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _M91
_MESSR=1
GOTOF _M92
_M91:_MESSR=-1 _P_PT=_P_PT+1
_M92:_HR[1]=(_HR[2]+_M_SPE[3])*_MESSR _LAGE=0 _ALARM=0
IF _MAV==_ZZ
_LAGE=_LAGE3
ELSE
_LAGE=_M_SPE[20+_P_PL]
ENDIF
_M_SPE[10]=_M_SPE[16]+(_HR[1]+_LAGE)*_HI[1]
N1082 _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR*_HI[1]
IF ((_MESSR==-1)AND(_M_SPE[10]>_P_POS))OR((_MESSR==1)AND(_M_SPE[10]<_P_POS)) GOTOF _M94
_M_SPE[10]=_P_POS
_M94:_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR*_HI[1]
N1083 _M95:CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _ALARM GOTOF _M120
_M_ME[0]=ABS(_M_ME[8]) _M_ME[8]=0
IF _M_ME[6] GOTOF _M104
_M_ME[6]=_M_ME[0] _M_SPE[16]=-_M_SPE[16] _P_POS=-_P_POS _ALARM=61302
IF (_M_ZUST[4]==0)AND(_MVAR==2) GOTOF _M103
_P_POS=-_HR[3]
N1084 G0
IF _VB[1] GOTOF _M102A
N1085 G1 F=_M_SPE[1]
_M102A:IF ((_INTERN[40+2]) AND (_M_N[7]==0)) GOTOF _M102B
N1086 AX[_MAV]=_HR[3]*_M_SPE[29]
N1087 AX[_VAV]=(_HR[4]-_HR[6])*_M_SPE[29]
GOTOF _M102C
N1088 _M102B: IF $AA_IW[_MAV]==_HR[3] GOTOF _M102G
N1090 MEAS=_M_N[0] AX[_MAV]=_HR[3]*_M_SPE[29]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
N1093 _M102G:MEAS=_M_N[0] AX[_VAV]=(_HR[4]-_HR[6])*_M_SPE[29]
STOPRE
IF $AC_MEA[ABS(_M_N[0])] GOTOF _M120
_M102C: _HI[2]=_HI[2]-1 _HR[3]=-_HR[3] _HR[4]=_HR[5]
IF _HI[4]==1
IF (_M_N[24]==6)OR(_M_N[24]==8)
_HR[6]=_HR[2]*2
IF (_MVAR==2)AND((_MA==103)OR(_MA==301))
_HR[6]=0
ENDIF
ELSE
_HR[6]=_HR[2]
IF (_MVAR==2)AND((_MA==203)OR(_MA==302))
_HR[6]=0
ENDIF
ENDIF
ENDIF
IF _HI[2] GOTOB _M102A
_M103:
IF _M_ZUST[_H_A]
_M_ZUST[_H_A]=0 _M_ZUST[_H_A+1]=1
ELSE
_M_ZUST[_H_A]=1 _M_ZUST[_H_A+1]=0
ENDIF
GOTOB _M9
_M104:_M_ME[0]=(_M_ME[0]+_M_ME[6])/2
IF _M_N[18]
_M_ME[0]=_M_ME[0]+_HR[2]*_MESSR*_HI[1]
GOTOF _NACHTRK
ENDIF
IF _INTERN[40+7] OR _VB[48]
_M_ME[0]=_M_ME[0]+_M_SPE[20]/2*_MESSR*_HI[1]
ELSE
_M_ME[0]=_M_ME[0]+(_M_SPE[21+_AXIND*2]-_M_SPE[22+_AXIND*2])/2*_HI[1]*_MESSR
ENDIF
_NACHTRK: _OVR[4]=_M_ME[0] _M_ZUST[7]=1
IF ((_IMA==3) AND (_VB[33]) AND (_INTERN[40+19]))
IF (_INTERN[8] AND _INTERN[9])
_OVR[4]=_OVR[4]*2
ENDIF
ENDIF
_M_ME[4]=SET(0,0,0)_HI[2]=2 _M_SPE[16]=-_M_SPE[16] _P_POS=ABS(_P_POS)
_M_N[8]=_M_N[22] MOD 10000 _M_N[9]=_M_N[22] DIV 10000 _OVI[7]=_M_N[8]
IF (_M_N[22] > 9999)
_OVI[6]=_M_N[9]
ELSE
_OVI[6]=_OVI[7]
ENDIF
IF (_OVI[7] <> 0)
_HR[0]=_EV[_OVI[7]-1] _OVR[30]=_HR[0]
IF (_INTERN[40+5] == 1)
_HR[0]=-_HR[0]
ENDIF
_OVR[4]=_OVR[4]-_HR[0]
ENDIF
_OVR[4+_IMA]=_OVR[4]
_OVR[16]=_OVR[4]-_OVR[0] _OVR[16+_IMA]=_OVR[16] _OVR[8]=_M_SPE[15] _OVR[12]=-_M_SPE[15] _OVI[0]=_M_N[11]
_OVR[29]=_M_SPE[34] _OVR[27]=_M_SPE[33] _OVR[28]=_OVR[28]/_M_SPE[29]
IF (_VB[15] == 0) AND (ABS(_OVR[16]) >= _M_SPE[32])
_ALARM=61303
ENDIF
IF (_ALARM) OR (_VB[0]) OR (_VB[15]) GOTOF _M113 IF ABS(_OVR[16])<_M_SPE[34] GOTOF _M113
_ALARM=61306
_M113:IF (_ALARM<>61303)AND(_ALARM<>61306) GOTOF _M115 IF _INTERN[20+0]==0 GOTOF _M115
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==1
N699403 SETAL(_ALARM+1000)
N1110 M0
ENDIF
_M_ZUST[7]=0 _ALARM=0
ENDIF
IF (_M_ZUST[4]==0)AND(_MVAR==2) GOTOF _M114D
_HR[4]=_M_ME[10] _HR[3]=-_HR[3]
N1120 _M114C: AX[_MAV]=_HR[3]*_M_SPE[29]
N1125 AX[_VAV]=_HR[4]*_M_SPE[29]
_HI[2]=_HI[2]-1 _HR[3]=-_HR[3] _HR[4]=_HR[5]
IF _HI[2] GOTOB _M114C
_M114D:
IF _M_ZUST[_H_A]
_M_ZUST[_H_A]=0 _M_ZUST[_H_A+1]=1
ELSE
_M_ZUST[_H_A]=1 _M_ZUST[_H_A+1]=0
ENDIF
_HI[2]=2 _HR[3]=-_HR[3] _HR[4]=_M_ME[10]
_M115:IF _M_ZUST[7]==0 GOTOB _M9
_OVR[20]=_OVR[16] _OVI[4]=_M_N[23] MOD 100
IF _ALARM GOTOF _M120
IF (ABS(_OVR[20])>_M_SPE[15]) AND (_VB[15] == 0)
IF ((_M_ZUST[4])AND(_OVR[4]>_OVR[0]))OR ((_M_ZUST[4]==0)AND(_OVR[4]<_OVR[0]))
_ALARM=61304
ELSE
_ALARM=61305
ENDIF
ENDIF
CYCLE114(2,_ALARM,_HMAV,0,_M_SPE[37],_M_N[23],_INTERN[40+4],_H_BOOL)
IF _H_BOOL==0
IF ABS(_OVR[20]) <= _M_SPE[33]
CYCLE114(4,_ALARM,_HMAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
GOTOF _M118
ENDIF
ENDIF
IF (_IMA==3) AND (_VB[33]) AND (_INTERN[40+19])
_HI[1]=_INTERN[9] _HI[1]=_HI[1]+1
ENDIF
_OVR[20]= -_OVR[20]/_HI[1]
IF ((_INTERN[20+2]==0) OR ((_INTERN[20+2]==1) AND (_ALARM<>61304) AND (_ALARM<>61305)))
CYCLE114(3,_ALARM,_HMAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
GOTOF _M120
_M118:IF _OVI[6]==0 GOTOF _M118A
IF _INTERN[40+4]==1
_MV[_OVI[6]-1]=_OVR[20] _OVR[31]=_OVR[20] $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=_OVR[20]
ELSE
_MV[_OVI[6]-1]=0 _OVR[31]=0 $SCS_MEA_AVERAGE_VALUE[_OVI[6]-1]=0
ENDIF
_M118A:_OVR[20]=0
_M120:_OVI[9]=_ALARM
IF ((_ALARM>=61303)AND(_ALARM<=61306))OR(_ALARM==0) GOTOF _M121
STOPRE
N699404 SETAL(_ALARM)
_M120A:M0
STOPRE
N699405 SETAL(61327)
GOTOB _M120A
_M121: _PROTVAL[29] = _PROTVAL[29] <<"F"<<_M_SPE[0]
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M122A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M122
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N699406 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[29]
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M121A IF _M_N[28]==2 GOTOF _M122
G4 F8
N1160 _M121A: CYCLE102(0)
N1200 _M122:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*(1/_M_SPE[29])
ENDFOR
ENDIF
N1201 _M122A:
IF _ALARM
STOPRE
_OVI[9]=_ALARM
IF (_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF (_ALARM>61303)
IF _INTERN[20+2]
N699407 SETAL(_ALARM+1000)
N1240 M0
STOPRE
IF ((_ALARM==61304) OR (_ALARM==61305))
CYCLE114(3,_ALARM,_HMAV,1,_M_SPE[37],_M_N[23],_INTERN[40+4],_INTERN[40+6],_INTERN[40+8],_INTERN[40+19],_INTERN[20+7],_M_SPE[52])
ENDIF
ELSE
IF NOT(_INTERN[12] AND _INTERN[13])
N699408 SETAL(_ALARM)
ENDIF
ENDIF
ELSE
IF _ALARM<>61024
IF NOT(_INTERN[12] AND _INTERN[13])
N699409 SETAL(_ALARM)
ENDIF
ELSE
N699410 SETAL(_ALARM,"S_SETV")
ENDIF
ENDIF
ENDIF
IF (_INTERN[2]) AND (_IMA <>1)
N1240 G90 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF (_INTERN[10]) AND (_IMA <>2)
N1245 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
IF (_INTERN[18]) AND (_IMA <>3)
N1245 AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _HI[0]=0 TO 29
_OVR[_HI[0]]=_OVR[_HI[0]]*_M_SPE[52]
ENDFOR
ENDIF
M17
N699410 _ENDE: SETAL(62301)
M0
_GENDE: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE995_SPF
PROC CYCLE995 (INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_INCA,REAL S_DZ,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_TUL,REAL S_TZL,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.20.00.00.002 ;DATE: 2021-08-26
;Measure geometry maschine
DEF INT _ALARM,_H_MVAR,_II,_CHBIT10,_H_DMODE,_H_ME,_M_N28,_SD42940,_SD55740_0,_H_SIM, _PSTAT_0
DEF REAL _H_DB,_H_PR,_H_OVR[32],_MP[20],_FAK1,_FAK2
DEF AXIS _XX,_YY,_ZZ
DEF FRAME _RET_CYCFR
DEF STRING[40] _SERR
DEF INT _TEMP,_TEMP_ON
DEF STRING[40] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE995_MPF"
_OVI[2]=995
IF(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE995_MPF")
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,";! only for internal diagnostics ! Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,"CYCLE995("<<S_MVAR<<","<<S_KNUM<<","<<S_PRNUM<<","<<S_PRNUM<<","<<S_SETV<<","<<S_FA<<","<<S_TSA<<","<<S_STA1<<","<<S_INCA<<","<<S_SETV0<<","<<S_SETV1<<","<<S_SETV2<<","<<S_DZ<<","<<S_TUL<<","<<S_TZL<<","<<S_NMSP<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,"M30")
ENDIF
IF ($AN_NCK_VERSION<720000) GOTOF _ERR0
S_MVAR=ABS(S_MVAR) _H_MVAR=S_MVAR _MP[4]=ABS(S_DZ) _AMODE = ABS(_AMODE)
S_STA1=S_STA1 MOD 360 S_INCA=90
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1)<>5) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec2)"
IF ((S_MVAR _DEC2)<>1) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3)<>0) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4)<1) OR ((S_MVAR _DEC4)>2) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5)<>0) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec6)"
IF ((S_MVAR _DEC6)<>1) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec7)"
IF ((S_MVAR _DEC7)>1) GOTOF _ERR1
_SERR=<<"(S_MVAR: dec8)"
IF ((S_MVAR _DEC8)<>0) GOTOF _ERR1
S_TUL=ABS(S_TUL MOD 360) S_TZL=ABS(S_TZL MOD 360)
_SERR=<<"(S_TZL > S_TUL)"
IF (S_TZL > S_TUL) GOTOF _ERR1
S_FA=ABS(S_FA)
IF S_NMSP<>0
S_NMSP=ABS(S_NMSP)
ELSE
S_NMSP=1
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>4) GOTOF _ERR1
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
_FAK1=1
IF (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1))
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
IF (($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2))
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
_FAK2=1
IF (($MN_SCALING_SYSTEM_IS_METRIC==1)AND(($P_GG[13]==1)OR($P_GG[13]==3)))
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
IF (($MN_SCALING_SYSTEM_IS_METRIC==0)AND(($P_GG[13]==2)OR($P_GG[13]==4)))
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
_SERR=<<"(_AMODE: dec1)"
_AMODE = ABS(_AMODE)
IF ((_AMODE _DEC1) > 1) GOTOF _ERR1
S_TUL=ABS(S_TUL MOD 360) S_TZL=ABS(S_TZL MOD 360)
IF (_AMODE _DEC1) == 1
_SERR=<<"(S_TUL)"
IF S_TUL<=0 GOTOF _ERR2
_SERR=<<"(S_TZL > S_TUL)"
IF (S_TZL > S_TUL) GOTOF _ERR1
ENDIF
_H_DB=ABS(S_SETV)
_H_PR=($SNS_MEA_WP_BALL_DIAM[S_PRNUM-1]/2)*_FAK1
_H_ME=($MCS_MEA_FUNCTION_MASK B_AND 'B1')+1
_SERR=<<"A"
IF (($P_TOOLNO==0) OR ($P_TOOL==0)) GOTOF _ERR6
_MP[14]=$P_TOOLL[1]*_FAK1
_SD42940=($SC_TOOL_LENGTH_CONST _DEC1) + (($SC_TOOL_LENGTH_CONST _DEC2)*10)
IF ((($P_ADT[2]==5) OR ($P_ADT[2]==7)) AND (_SD42940==18) AND (($SC_TOOL_LENGTH_TYPE _DEC1)==2))
_MP[14]=$P_TOOLL[2]*_FAK1
ENDIF
_MP[15]=0 _MP[16]=$P_TOOLR*_FAK1
IF ($MNS_MEA_FUNCTION_MASK B_AND 'B10')
_MP[15]=($SNS_MEA_WP_BALL_DIAM[S_PRNUM-1]/2)*_FAK1
ENDIF
DIAMCYCOF
S_SETV0=$AA_IW[_XX]*_FAK1 S_SETV1=$AA_IW[_YY]*_FAK1
S_SETV2=$AA_IW[_ZZ]*_FAK1-_H_DB/2-S_FA
_SERR=<<"S_SETV= "<<_H_DB
IF (_H_DB<=0) GOTOF _ERR2
_SERR=<<"S_DZ= "<<_MP[4]
IF (_MP[4] < _H_DB) GOTOF _ERR2
_MP[14]=_MP[14]+_MP[15]
_SERR=<<"S_DZ>L1:"<<_MP[4]<<">"<<_MP[14]
IF (_MP[4] > _MP[14]) GOTOF _ERR2
_CHBIT10=_CHBIT[10] _PSTAT_0=S_PROTSTAT[0]
_CHBIT[10]=0 S_PROTSTAT[0]=0
_OVI[18]=0
_MP[11]=S_SETV/2
CYCLE997 (S_MVAR+4,0,S_PRNUM,S_SETV,S_FA,_MP[11],S_STA1,S_INCA,S_SETV0,S_SETV1,S_SETV2,,,,,,,,S_NMSP,,_DMODE)
_OVI[2]=995
FOR _II=0 TO 31
_H_OVR[_II]=_OVR[_II]
ENDFOR
_MP[0]=_OVR[9]*_FAK2 _MP[1]=_OVR[10]*_FAK2
_MP[10]=_OVR[7]*_FAK2 -_MP[15]
_MP[8]=_OVR[5]*_FAK2 _MP[9]=_OVR[6]*_FAK2
_H_DB=_OVR[4]*_FAK2
IF ISVAR("$MN_SIM_ENVIRONMENT")
_H_SIM=(($MN_SIM_ENVIRONMENT B_AND 'B100')*100)
ELSE
IF $P_SIM
_H_SIM=2
ENDIF
ENDIF
IF _OVI[18]==1
_H_SIM=3
ENDIF
IF _H_SIM==0
IF $P_SEARCH GOTOF _GEND IF $P_ISTEST OR $P_DRYRUN GOTOF _GEND
ENDIF
_RET_CYCFR=$P_CYCFRAME
$P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,S_STA1)
CUST_MEACYC(1)
_SD55740_0=1
IF _CHBIT[2]== -1
IF NOT($SCS_MEA_FUNCTION_MASK B_AND 'B1')
_SD55740_0=0
ENDIF
ELSE
_SD55740_0=_CHBIT[2]
ENDIF
IF _H_SIM<>0
_SD55740_0=0
ENDIF
G1 F=$SCS_MEA_FEED_PLANE_VALUE
IF _SD55740_0==0
N9961 AX[_XX]=IC(_H_DB/2+_FA+_H_PR)
N9962 AX[_ZZ]=AC(_MP[10]) F=$SCS_MEA_FEED_FEEDAX_VALUE
N9963 AX[_ZZ]=IC(-_MP[4])
ELSE
N9951 MEAS=_H_ME AX[_XX]=IC(_H_DB/2+_FA+_H_PR)
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR4
N9952 MEAS=_H_ME AX[_ZZ]=AC(_MP[10]) F=$SCS_MEA_FEED_FEEDAX_VALUE
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR4
N9953 MEAS=_H_ME AX[_ZZ]=IC(-_MP[4])
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR4
ENDIF
$P_CYCFRAME=_RET_CYCFR
CUST_MEACYC(2)
_CHBIT[10]=0 S_PROTSTAT[0]=0
CYCLE979(21002,,,S_PRNUM,S_SETV,S_FA,_MP[11],_MP[8],_MP[9],S_STA1,S_INCA,S_NMSP,,,,,,,,,,,_DMODE)
_OVI[2]=995
_MP[5]=_OVR[17]*_FAK2
_MP[6]=_OVR[18]*_FAK2
_MP[2]=ATAN2((_MP[5]),(_MP[4]))
_MP[3]=ATAN2((_MP[6]),(_MP[4]))
_RET_CYCFR=$P_CYCFRAME
$P_CYCFRAME=$P_CYCFRAME:CROT(_ZZ,(S_STA1+3*S_INCA) MOD 360)
CUST_MEACYC(1)
G1 F=$SCS_MEA_FEED_PLANE_VALUE
IF _SD55740_0==0
N9964 AX[_XX]=IC(_FA+_H_PR)
N9965 AX[_ZZ]=AC(_MP[10]+_MP[15]+_H_DB/2+_FA) F=$SCS_MEA_FEED_FEEDAX_VALUE
$P_CYCFRAME=_RET_CYCFR
N9966 AX[_XX]=AC(_MP[8]) AX[_YY]=AC(_MP[9]) F=$SCS_MEA_FEED_PLANE_VALUE
ELSE
N9954 MEAS=_H_ME AX[_XX]=IC(_FA+_H_PR)
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR4
N9955 MEAS=_H_ME AX[_ZZ]=AC(_MP[10]+_MP[15]+_H_DB/2+_FA) F=$SCS_MEA_FEED_FEEDAX_VALUE
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR4
$P_CYCFRAME=_RET_CYCFR
N9956 MEAS=_H_ME AX[_XX]=AC(_MP[8]) AX[_YY]=AC(_MP[9]) F=$SCS_MEA_FEED_PLANE_VALUE
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR4
ENDIF
CUST_MEACYC(2)
_OVR[22]=_OVR[0] _OVR[23]=_OVR[1] _OVR[24]=_OVR[2] _OVR[25]=_OVR[5] _OVR[26]=_OVR[6] _OVR[27]=_OVR[17] _OVR[28]=_OVR[18]
FOR _II=0 TO 21
_OVR[_II]=0
ENDFOR
FOR _II=0 TO 11
_OVR[_II+10]=_H_OVR[_II]
ENDFOR
_OVR[2]=_MP[2] _OVR[3]=_MP[3] _OVR[4]=_MP[4] _OVR[7]=_MP[5] _OVR[8]=_MP[6] _OVR[9]=S_TUL
_PRNUM=S_PRNUM _OVI[5]=_PRNUM
_MVAR=_H_MVAR+(_AMODE _DEC1)*10000000
_OVI[2]=995 _OVI[3]=S_MVAR
_CHBIT[10]=_CHBIT10
IF $SCS_MEA_RESULT_MRD
IF (_CHBIT[10] == -1)
IF S_PROTMEA_RESULT_DISPLAY == -9999
_M_N28= $SCS_MEA_RESULT_DISPLAY
ELSE
_M_N28= S_PROTMEA_RESULT_DISPLAY
ENDIF
ELSE
_M_N28=0
IF _CHBIT[10]
IF _CHBIT[11]
_M_N28=3
ELSE
_M_N28=1
IF _CHBIT[18]
_M_N28=2
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_OVR[5]=0 _OVR[6]=0
_OVI[9]=0 _ALARM=0
IF ((_AMODE _DEC1) == 1)
IF ((S_TZL<>0) AND (ABS(_OVR[2])<S_TZL))
_OVR[2]=0 _OVR[7]=0
ENDIF
IF ((S_TZL<>0) AND (ABS(_OVR[3])<S_TZL))
_OVR[3]=0 _OVR[8]=0
ENDIF
_MP[12]=ROUND(_OVR[2]*1000000)/1000000
_MP[13]=ROUND(_OVR[3]*1000000)/1000000
IF (ABS(_OVR[2])>S_TUL)
_OVR[5]=ABS(_MP[2])-S_TUL
IF (_M_N28<>0)
_SERR=<<"OVR[2]>S_TUL:"<<_MP[12]<<">"<<S_TUL
_ALARM=62377 _OVI[9]=_ALARM
SETAL(_ALARM,_SERR)
ENDIF
ENDIF
IF (ABS(_OVR[3])>S_TUL)
_OVR[6]=ABS(_MP[3])-S_TUL
IF (_M_N28<>0)
_SERR=<<"OVR[3]>S_TUL:"<<_MP[13]<<">"<<S_TUL
_ALARM=62377 _OVI[9]=_ALARM
SETAL(_ALARM,_SERR)
ENDIF
ENDIF
ENDIF
_TSA=ABS(S_TSA)
IF ((ABS(_MP[2]))>_TSA) OR ((ABS(_MP[3]))>_TSA)
_ALARM=62303 _OVI[9]=_ALARM
ENDIF
IF (_M_N28==0) OR (_M_N28==2) OR (_M_N28>4) GOTOF _M125
IF ((_M_N28==4) AND ((_ALARM>=62303)XOR(_ALARM<=62306))) GOTOF _M125
IF (_ALARM==62303)
SETAL(_ALARM,_SERR)
ENDIF
_OVR[10]=_OVR[10]*_FAK2 _OVR[14]=_OVR[14]*_FAK2
CYCLE102(1,_M_N28)
STOPRE
IF (_M_N28>=3) GOTOF _M128
IF (_ALARM<>0)
M0
STOPRE
ELSE
G4 F8
ENDIF
_M128: CYCLE102(0)
_OVR[4]=_OVR[4]/_FAK2 _OVR[7]=_OVR[7]/_FAK2 _OVR[8]=_OVR[8]/_FAK2
_M125:
_OVR[10]=_H_OVR[0] _OVR[14]=_H_OVR[4]
IF (_ALARM==62303) GOTOF _ERR5
S_PROTSTAT[0]=_PSTAT_0
IF S_PROTSTAT[0]==1
CYCLE151
ENDIF
IF (_AMODE _DEC1) == 1
_MP[12]=ROUND(_OVR[2]*1000000)/1000000
_MP[13]=ROUND(_OVR[3]*1000000)/1000000
_SERR=<<"OVR[2]>S_TUL:"<<_MP[12]<<">"<<S_TUL
IF (ABS(_OVR[2])>S_TUL) GOTOF _ERR3
_SERR=<<"OVR[3]>S_TUL:"<<_MP[13]<<">"<<S_TUL
IF (ABS(_OVR[3])>S_TUL) GOTOF _ERR3
ELSE
_OVR[5]=0 _OVR[6]=0
ENDIF
_GEND:
RET
_ERR0: _ALARM=61342 _OVI[9]=_ALARM
N699500 SETAL(_ALARM)
STOPRE
RET
_ERR1: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N699501 SETAL(_ALARM,_SERR)
RET
_ERR2: _ALARM=61022 _OVI[9]=_ALARM
STOPRE
N699502 SETAL(_ALARM,_SERR)
RET
_ERR3: _ALARM=61377 _OVI[9]=_ALARM
STOPRE
N699503 SETAL(_ALARM,_SERR)
RET
_ERR4: _ALARM=61302 _OVI[9]=_ALARM
STOPRE
N699504 SETAL(_ALARM)
RET
_ERR5: _ALARM=61303 _OVI[9]=_ALARM
STOPRE
N699505 SETAL(_ALARM)
RET
_ERR6: _ALARM=61427 _OVI[9]=_ALARM
STOPRE
N699506 SETAL(_ALARM,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE996_SPF
PROC CYCLE996(INT S_MVAR,INT S_TC,INT S_PRNUM,REAL S_SETV,REAL S_STA1,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_TNVL,REAL S_FA,REAL S_TSA,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE,STRING[32] S_KC) SAVE SBLOF ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.007 ;DATE: 2024-04-30
;Measure Kinematic
DEF BOOL _NEW_PAR=0,_T_ACT,_M9960,_ACALC, _NO_ALARM
DEF REAL _MIN_ANG_TRIA=10, _MIN_L_TRIA=2, _CORR_V[3]
DEF REAL _RG[20],_DB,_L1,_RAD,_TR_LIM,_VAR[10,9],_INARRAY[10],_OUTARRAY[10],_CAL[13],_FAK1,_FAK2,_FAK3,_DM_TOL,_CORR_VECT[3],_MD10200_MM,_MD10210_DEG
DEF INT _M_VAR,_M_VAR1,_MT,_TC,_PROT,_RAX[3],_NAX,_NAX2,_I,_II,_LOG,_TNR,_DNR,_G17_18_19,_CMEA,_CERG,_CCM,_TRTYP[2],_NV_ACT,_CBIT14,_L1_CALC,_ALARM,_H_DMODE,_CHBIT_S[32],_SD42940,_CHBIT29,_H_216,_PSTAT_0,_MVAR_SP,_TOL_ON
DEF INT _SD55740_8,_SD55740_12,_SD55740_13, _CARR23 ,_CARR37,_CALC_G3,_OEM_ACT
DEF AXIS _XX,_YY,_ZZ,_RAX1,_RAX2,_XXA,_YYA,_ZZA
DEF STRING[40] _SN[4], _SERR, _FILE_VCS, _FILE_VCS_VERIFI
DEF STRING[32] _CARR34,_CARR35,_CARR36
DEF STRING[255] _LINE[1]
DEF STRING[2] S_MMC_INFO=""
DEF INT _LOG_ON, _LOGSIZE, _NT_NO, _CORR_INDEX, _CORR_MODE, _MEA_KIN_MODE[2], _CORR_STATUS, _CORR_M[3]
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _M_VAR1=S_MVAR _AMODE = ABS(_AMODE) _NEW_PAR=1
_CHBIT_S[25]=_CHBIT[25] _CHBIT_S[26]=_CHBIT[26] _CHBIT_S[28]=_CHBIT[28] _CHBIT_S[29]=_CHBIT[29]
IF (((S_MVAR _DEC1)>=4)AND((S_MVAR _DEC1)<=7))
_MEA_KIN_MODE[0]=ABS($SCS_MEA_KIN_MODE[0]) _MEA_KIN_MODE[1]=ABS($SCS_MEA_KIN_MODE[1])
ENDIF
IF ((S_MVAR _DEC1)==4)OR((S_MVAR _DEC1)==5)
_SERR=<<"(S_MVAR: dec2)"
IF (((S_MVAR _DEC3)<>2)AND((S_MVAR _DEC3)<>4))GOTOF _M_ERR
_M9960=1
S_MVAR=S_MVAR-3
ENDIF
IF ((S_MVAR _DEC1)==6)OR((S_MVAR _DEC1)==7)
_SERR=<<"(B $SCS_MEA_KIN_MODE?)"
IF NOT(ISVAR("$SCS_MEA_KIN_MODE")) GOTOF _ERR0
IF ((S_MVAR _DEC1)==7)
_CALC_G3=1
ENDIF
S_MVAR=S_MVAR-(S_MVAR _DEC1)
S_MVAR=S_MVAR-((S_MVAR _DEC6)*100000)
S_MVAR=S_MVAR-((S_MVAR _DEC7)*1000000)
S_TNVL=$SCS_MEA_KIN_MIN_ANG_TRIANGLE
_M9960=1
ENDIF
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1) > 3) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 4) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec4)"
IF (((S_MVAR _DEC4) > 1)AND(_M9960==0)) GOTOF _M_ERR
IF (((S_MVAR _DEC4) > 5)AND(_M9960==1)) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec5)"
IF (((S_MVAR _DEC5) > 3)AND(_M9960==0)) GOTOF _M_ERR
IF (((S_MVAR _DEC5) > 5)AND(_M9960==1)) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec6)"
IF ((S_MVAR _DEC6) > 3) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec7)"
IF ((S_MVAR _DEC7) > 3) GOTOF _M_ERR
_SERR=<<"(S_MVAR: dec8)"
IF ((S_MVAR _DEC8) > 1) GOTOF _M_ERR
S_MVAR = S_MVAR - ((S_MVAR _DEC2)*10) + 90
_CHBIT[26]=0 _CHBIT[28]=0
IF ((S_MVAR _DEC1) <> 0)
S_TNVL=0
IF ((S_MVAR _DEC3) > 0)
_CHBIT[26]=1
ENDIF
IF ((S_MVAR _DEC3) == 2)
_CHBIT[28]=1
ENDIF
IF ((S_MVAR _DEC3) > 2)
_MVAR_SP=(S_MVAR _DEC3)
ENDIF
S_MVAR = S_MVAR - ((S_MVAR _DEC3)*100)
ELSE
S_MVAR = S_MVAR - (S_MVAR _DEC1) + 4
S_MVAR = S_MVAR - ((S_MVAR _DEC3)*100)
_CHBIT[25]=0
_SERR=<<"(_AMODE: dec2)"
IF ((_AMODE _DEC2) > 1) GOTOF _M_ERR
_SERR=<<"(_AMODE: dec3)"
IF ((_AMODE _DEC3) > 1) GOTOF _M_ERR
_SERR=<<"(_AMODE: dec4)"
IF ((_AMODE _DEC4) > 1) GOTOF _M_ERR
IF ((_AMODE _DEC3) == 1)
IF ((S_MVAR _DEC4) == 0)
S_MVAR = S_MVAR + 1000
ELSE
S_MVAR = S_MVAR + 100
IF ((_AMODE _DEC4) == 1)
S_MVAR = S_MVAR + 1000
ENDIF
ENDIF
ELSE
IF (((S_MVAR _DEC4)MOD 2)==1)
S_MVAR = S_MVAR - 1000 + 100
IF ((_AMODE _DEC2) == 1)
_CHBIT[25]=1
ENDIF
ENDIF
ENDIF
IF ((S_MVAR _DEC8) == 1)
IF ((SUBSTR($P_PATH[$P_STACK-1],0,12)=="/_N_EXT_DIR/") AND (($ON_SYSTEM_FUNCTION_MASK B_AND 'H200')==0)) GOTOF _ERR15
FOR _II=1 TO 20
_SERR=<<"$MC_TRAFO_TYPE_"<<_II
EXECSTRING("IF(ISVAR(_SERR)) GOTOF _MYVAR1")
GOTOF _TSFOR
_MYVAR1: EXECSTRING("IF(("<<_SERR<<">0) AND ("<<_SERR<<"<256) AND ("<<_SERR<<"<>72))GOTOF _MYVAR2")
_TSFOR:
ENDFOR
GOTOF TSEND
_MYVAR2: S_MVAR=S_MVAR + 10000000
TSEND:
ENDIF
ENDIF
_SERR=<<"(_AMODE: dec1)"
IF ((_AMODE _DEC1) > 1) GOTOF _M_ERR
IF ((_AMODE _DEC1) == 1) AND ((S_SETV4 <> 0) OR (S_SETV5 <> 0))
_SETV[7]=S_SETV4 _SETV[8]=S_SETV5
ELSE
_SETV[7]=0 _SETV[8]=0
ENDIF
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_MVAR=S_MVAR _TNUM=ABS(S_TC) _PRNUM=ABS(S_PRNUM) _TNVL=ABS(S_TNVL) _FA=ABS(S_FA) _TSA=ABS(S_TSA)
_SETVAL=S_SETV _STA1=S_STA1 _SETV[3]=S_SETV0 _SETV[4]=S_SETV1 _SETV[5]=S_SETV2 _SETV[6]=S_SETV3
IF S_KC<>""
IF((ISVAR("NAMETOINT"))AND(ISVAR("$NT_NAME"))AND(ISVAR("$NT_IDENT")))
_TNUM=NAMETOINT("$NT_NAME",S_KC,TRUE)
IF _TNUM > 0
_NT_NO=_TNUM
_TNUM=_TNUM + 1000
ELSE
_SERR=<<"(4 TRAFO NO=0?)"
GOTOF _ERR2
ENDIF
ELSE
_SERR=<<"(3 $NT_NAME?)"
GOTOF _ERR2
ENDIF
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N699601 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
_SN[2]=<<" $MC_TRAFO5_"
_VAR[5,6]=20
_M_VAR=ABS(_MVAR) _MT=_PRNUM _DB=ABS(_SETVAL) _TC=_TNUM
_OVI[2]=996 _OVI[8]=_TC _OVI[9]=0
_OVI[3]=_M_VAR
_RG[7]=ABS(_SETV[7]) _RG[8]=ABS(_SETV[8])
IF _M9960==1
_PROT=1
ELSE
_PROT=_M_VAR _DEC8
ENDIF
_G17_18_19=$P_GG[6]
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF(_G17_18_19==1)
_XXA=$P_AXN1 _YYA=$P_AXN2 _ZZA=$P_AXN3
ELSE
IF(_G17_18_19==2)
_XXA=$P_AXN2 _YYA=$P_AXN3 _ZZA=$P_AXN1
ELSE
_XXA=$P_AXN3 _YYA=$P_AXN1 _ZZA=$P_AXN2
ENDIF
ENDIF
IF($P_GG[13]<3)
_FAK1=1 _FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
_FAK1=1 _FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ENDIF
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK3=$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1
ENDIF
IF (_M9960==0)
_SERR=<<"A _OVR[110] ?"
IF NOT ISVAR("_OVR[110]") GOTOF _ERR0
ELSE
_SERR=<<"A _OVR[499] ?"
IF NOT ISVAR("_OVR[499] ?") GOTOF _ERR0
ENDIF
_SERR=<<"A (_MVAR dec2<>9):"<<_M_VAR
IF ((_M_VAR _DEC2)<>9) GOTOF _ERR1
_SERR=<<"A (_MVAR dec1):"<<_M_VAR
IF (((_M_VAR _DEC1)<0) OR ((_M_VAR _DEC1)>4)) GOTOF _ERR1
IF (_NEW_PAR)
_SERR=<<"S_TC"
ELSE
_SERR=<<"_TNUM"
ENDIF
_SD55740_8=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'B100000000')
_SD55740_8=1
ENDIF
_SD55740_12=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H1000')
_SD55740_12=1
ENDIF
_SD55740_13=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H2000')
_SD55740_13=1
ENDIF
IF (_TC>=1001)
_CARR23=$P_TRAFO
_SERR=<<"(5 TRAFO TYP?) "<<_CARR23
IF NOT((_CARR23==24)OR(_CARR23==40)OR(_CARR23==56)) GOTOF _ERR2
_SERR=<<"(6 S_MVAR="<<_M_VAR1<<" ?)"
IF _M9960==0 GOTOF _ERR2
_SERR=<<"(7 TRAFO Roundaxis 3?)"
IF $NT_ROT_AX_NAME[$P_TRAFO_PARSET-1000,2]<>"" GOTOF _ERR2
_SERR=<<"(A SD55740 bit8=1?)"
IF _SD55740_8<>1 GOTOF _ERR20
_CARR35=<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[0])
_CARR36=<<AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[1])
IF (_CARR36=="NO_AXIS")
_CARR36=""
ENDIF
_RG[14]=0 _RG[15]=0
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TNUM-1000,0],TRUE)
IF(_II>0)
_RG[14]=$NK_A_OFF[_II]
ENDIF
IF _CARR36<>""
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TNUM-1000,1],TRUE)
IF(_II>0)
_RG[15]=$NK_A_OFF[_II]
ENDIF
ENDIF
ELSE
IF NOT _TC GOTOF _ERR2
IF NOT ISVAR("$TC_CARR1") GOTOF _ERR2
_CARR35=<<$TC_CARR35[_TC]
_CARR36=<<$TC_CARR36[_TC]
IF ($TC_CARR23[_TC]=="T")
_CARR23=24
ENDIF
IF ($TC_CARR23[_TC]=="P")
_CARR23=40
ENDIF
IF ($TC_CARR23[_TC]=="M")
_CARR23=56
ENDIF
_RG[14]=$TC_CARR24[_TC] MOD 360 _RG[15]=$TC_CARR25[_TC] MOD 360
ENDIF
_RAX[0]=_M_VAR _DEC5
_SERR=<<"D (_MVAR dec5):"<<_M_VAR
IF (((_RAX[0]<0) OR (_RAX[0]>3))AND(_M9960==0)) GOTOF _ERR1
IF (((_RAX[0]<0) OR (_RAX[0]>5))AND(_M9960==1)) GOTOF _ERR1
_SERR=<<"A"
IF ((_M_VAR _DEC1)<>4)
IF (_NEW_PAR)
_SERR=<<"S_SETV"
ELSE
_SERR=<<"_SETVAL"
ENDIF
IF NOT _DB GOTOF _ERR3
IF ((_RAX[0]<1) OR (_RAX[0]>2)) GOTOF _ERR4
ELSE
_NAX=_M_VAR _DEC6
_SERR=<<"B (_MVAR dec6):"<<_M_VAR
IF ((_NAX<0) OR (_NAX>3)) GOTOF _ERR1
ENDIF
IF (_TC<1001)
IF (_RAX[0]==1)
_SERR=<<"B"
IF (_CARR35=="") GOTOF _ERR4
_SERR=<<"C (V1xyz=0)"
IF ($TC_CARR_KIN_CNTRL[_TC] B_AND 'B1')
IF (((ABS($PC_TCARR_AX_VECT[1,0]))+(ABS($PC_TCARR_AX_VECT[1,1]))+(ABS($PC_TCARR_AX_VECT[1,2])))==0) GOTOF _ERR4
ELSE
IF (((ABS($TC_CARR7[_TC])) + (ABS($TC_CARR8[_TC])) + (ABS($TC_CARR9[_TC])))==0) GOTOF _ERR4
ENDIF
ENDIF
IF (_RAX[0]==2)
_SERR=<<"D"
IF (_CARR36=="") GOTOF _ERR4
_SERR=<<"E (V2xyz=0)"
IF ($TC_CARR_KIN_CNTRL[_TC] B_AND 'B1')
IF (((ABS($PC_TCARR_AX_VECT[2,0]))+(ABS($PC_TCARR_AX_VECT[2,1]))+(ABS($PC_TCARR_AX_VECT[2,2])))==0) GOTOF _ERR4
ELSE
IF (((ABS($TC_CARR10[_TC])) + (ABS($TC_CARR11[_TC])) + (ABS($TC_CARR12[_TC])))==0) GOTOF _ERR4
ENDIF
ENDIF
ENDIF
_NV_ACT=$P_GG[8]
IF ((($P_TRAFO_CHAIN[0]>0) AND ($P_TRAFO_CHAIN[0]<256))OR(($P_TRAFO_CHAIN[1]>0) AND ($P_TRAFO_CHAIN[1]<256)))
_TRTYP[0]=$P_TRAFO_PARSET
ENDIF
IF ISVAR("$MN_CC_ACTIVE_IN_CHAN_ROBX[0]")
IF $MN_CC_ACTIVE_IN_CHAN_ROBX[0]>0
_TRTYP[0]=$P_TRAFO_PARSET
ENDIF
ENDIF
_TRTYP[1]=$P_TC
IF ((($P_TRAFO B_AND 'H2000') AND (($P_TRAFO_CHAIN[0] B_AND 'H1000') OR ($P_TRAFO_CHAIN[1] B_AND 'H1000'))) OR ($P_TRAFO B_AND 'H1000'))
_OEM_ACT=1
ENDIF
IF ((_SD55740_8==1) AND ((_M_VAR _DEC1)<>4)OR(_M9960==1))
_SERR=<<"TRAORI or TCARR"
IF ((_TRTYP[0]==0) AND (_TRTYP[1]==0)) GOTOF _ERR11
_T_ACT=1
ENDIF
IF (_OEM_ACT==1)
IF (((_M_VAR1 _DEC4)==1) AND ((_M_VAR1 _DEC1)==0))OR(((_M_VAR1 _DEC1)>5)AND ((_M_VAR1 _DEC4)MOD 2==1))
_SERR="B"
GOTOF _ERR14
ELSE
_T_ACT=1
ENDIF
ENDIF
IF _T_ACT==0
TRAFOOF
G[8]=_NV_ACT
IF (ISFILE("/_N_CST_DIR/_N_CYCLE800_SPF")) OR (ISFILE("/_N_CMA_DIR/_N_CYCLE800_SPF")) OR (ISFILE("/_N_CUS_DIR/_N_CYCLE800_SPF"))
CYCLE800()
ELSE
TCARR=0
ENDIF
IF ($P_TRAFO_CHAIN[0]<>0) AND (((_M_VAR1 _DEC4) MOD 2)==1)
_SERR="A"
GOTOF _ERR14
ENDIF
ENDIF
_MD10200_MM=$MN_INT_INCR_PER_MM
_MD10210_DEG=$MN_INT_INCR_PER_DEG
IF (((_M_VAR _DEC1)<>4) AND ((_M_VAR1 _DEC1)<4))
_TNR=$P_TOOLNO _DNR=$P_TOOL
_SERR=<<"A"
IF ((_TNR==0) OR (_DNR==0)) GOTOF _ERR6
_L1=$P_TOOLL[1]*_FAK1
_SD42940=($SC_TOOL_LENGTH_CONST _DEC1) + (($SC_TOOL_LENGTH_CONST _DEC2)*10)
IF ((($P_ADT[2]==5) OR ($P_ADT[2]==7)) AND (_SD42940==18) AND (($SC_TOOL_LENGTH_TYPE _DEC1)==2))
_L1=$P_TOOLL[2]*_FAK1
ENDIF
_OVR[50]=_L1
ELSE
_L1=_OVR[50]
ENDIF
_SERR=<<"B"
IF (_OVR[50]==0) GOTOF _ERR6
IF (_TC>=1001)
_RAX1=AXNAME(_CARR35) _RAX[1]=1
IF (_CARR36<>"")
_RAX2=AXNAME(_CARR36) _RAX[2]=1
ENDIF
IF NOT($SCS_MILL_SWIVEL_ALARM_MASK B_AND 'B1000')
_SERR=<<"D"
IF (ABS($P_ACTFRAME[_RAX1,TR])) GOTOF _ERR5
IF $MN_MM_FRAME_FINE_TRANS
IF (ABS($P_ACTFRAME[_RAX1,FI])) GOTOF _ERR5
ENDIF
IF (_CARR36<>"")
_SERR=<<"E"
IF (ABS($P_ACTFRAME[_RAX2,TR])) GOTOF _ERR5
IF $MN_MM_FRAME_FINE_TRANS
IF (ABS($P_ACTFRAME[_RAX2,FI])) GOTOF _ERR5
ENDIF
ENDIF
ENDIF
ELSE
_CARR37=ABS($TC_CARR37[_TC])
IF NOT (_CARR37 _DEC2)
_RAX1=AXNAME(_CARR35) _RAX[1]=1
_RG[9]=(TRUNC($AA_IM[_RAX1]*_MD10210_DEG)/_MD10210_DEG)
_SERR=<<"D"
IF (($P_ACTFRAME[_RAX1,TR]) OR ($P_ACTFRAME[_RAX1,FI])) GOTOF _ERR5
ELSE
_RG[9]=_SETV[3] _RG[10]=0
ENDIF
IF NOT (_CARR37 _DEC3)
IF (_CARR36<>"")
_RAX2=AXNAME(_CARR36) _RAX[2]=1
_RG[10]=(TRUNC($AA_IM[_RAX2]*_MD10210_DEG)/_MD10210_DEG)
_SERR=<<"E"
IF (($P_ACTFRAME[_RAX2,TR]) OR ($P_ACTFRAME[_RAX2,FI])) GOTOF _ERR5
ENDIF
ELSE
IF (_CARR36<>"")
_RG[10]=_SETV[4]
ENDIF
ENDIF
ENDIF
IF ($P_SEARCH OR $P_ISTEST) GOTOF _END
IF _PROT
_SERR=<<"(MD $MN_LEN_PROTOCOL_FILE<20)"
IF ($MN_LEN_PROTOCOL_FILE < 20) GOTOF _ERR10
IF (_M9960==0)
_CARR34=$TC_CARR34[_TC]
WHILE(INDEX(_CARR34," ")>-1)
_CARR34[INDEX(_CARR34," ")]="_"
ENDWHILE
FOR _I=1 TO 100
_SN[0]=<<"_N_"<<SUBSTR(_CARR34,0,16)<<"_M"<<_I<<"_SPF"
IF NOT (ISFILE(_SN[0])) GOTOF _POK1
ENDFOR
_POK1: _SERR=<<"A (Protfile>99):"<<_I
IF (_I>=100) GOTOF _ERR7
IF (_I>1)
_SN[0]=<<"_N_"<<SUBSTR(_CARR34,0,16)<<"_M"<<_I-1<<"_SPF"
ENDIF
IF ((_M_VAR _DEC1)==1)
_SN[0]=<<"_N_"<<SUBSTR(_CARR34,0,16)<<"_M"<<_I<<"_SPF"
ENDIF
_CARR34=$TC_CARR34[_TC]
ELSE
IF (_TC>=1001)
_CARR34=$NT_NAME[_TC-1000]
ELSE
_CARR34=$TC_CARR34[_TC]
ENDIF
_SN[0]="//NC:/_N_MPF_DIR/_N_LOG_CYCLE996_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_SN[0])
IF(_LOG_ON)
FILESIZE(_LOG,_SN[0],_LOGSIZE)
IF _LOGSIZE > ($MN_LEN_PROTOCOL_FILE-1)
ENDIF
_PROT=1
ELSE
_PROT=0
ENDIF
ENDIF
ENDIF
IF ((_M_VAR _DEC1)==1)
IF _RAX[0]==1
_OVR[66]=$P_ACTFRAME[_XXA,RT] _OVR[67]=$P_ACTFRAME[_YYA,RT] _OVR[68]=$P_ACTFRAME[_ZZA,RT]
FOR _II=0 TO 2
IF (ABS(_OVR[66+_II])<0.0001)
_OVR[66+_II]=0
ENDIF
ENDFOR
_II=41
_OVR[40]=_OVR[40]-(_OVR[40] _DEC1)
_OVR[60]=0 _OVR[61]=0 _OVR[62]=0 _OVR[69]=0
_OVR[72]=_DB _OVR[73]=_DB _OVR[74]=_DB
ELSE
_II=51
_OVR[40]=_OVR[40]-((_OVR[40] _DEC2)*10)
_OVR[63]=0 _OVR[64]=0 _OVR[65]=0 _OVR[70]=0
_OVR[75]=_DB _OVR[76]=_DB _OVR[77]=_DB
ENDIF
FOR _I=_II TO _II+8
_OVR[_I]=0
ENDFOR
IF (ISVAR("VCS_ACTIVE_STATE") AND ISVAR("VCSROTVEC_VERIFICATION") AND (_TC<1000))
IF VCS_ACTIVE_STATE==1
IF VCSROTVEC_VERIFICATION==0
_FILE_VCS="/_N_CMA_DIR/_N_VCSROTVEC_SPF"
IF (ISFILE(_FILE_VCS))
DELETE(_LOG,_FILE_VCS)
ENDIF
WRITE(_LOG,_FILE_VCS,"[ROTV1]")
WRITE(_LOG,_FILE_VCS,<<$TC_CARR7[_TC]<<" "<<$TC_CARR8[_TC]<<" "<<$TC_CARR9[_TC])
WRITE(_LOG,_FILE_VCS,"[ROTV2]")
WRITE(_LOG,_FILE_VCS,<<$TC_CARR10[_TC]<<" "<<$TC_CARR11[_TC]<<" "<<$TC_CARR12[_TC])
WRITE(_LOG,_FILE_VCS,<<" ")
CCVCSREREAD()
ELSE
ENDIF
ENDIF
ENDIF
ENDIF
_RG[11]=_OVR[71]
_CMEA=_OVR[40]
IF ISVAR("$MNS_MEA_PROBE_LENGTH_RELATE")
IF _CBIT[14]== -1
_CBIT14=$MNS_MEA_PROBE_LENGTH_RELATE
ELSE
_CBIT14=_CBIT[14]
ENDIF
ELSE
IF ISVAR("$MNS_MEA_FUNCTION_MASK")
IF _CBIT[14]== -1
_CBIT14=0
IF ($MNS_MEA_FUNCTION_MASK B_AND 'B10')
_CBIT14=1
ENDIF
ELSE
_CBIT14=_CBIT[14]
ENDIF
ENDIF
ENDIF
_PSTAT_0=S_PROTSTAT[0]
IF ((_M_VAR _DEC1)==4) GOTOF _MA4
S_PROTSTAT[0]=0
IF (_T_ACT==1) GOTOF _M_T1
_RG[9]=_RG[9]-_RG[14] _RG[10]=_RG[10]-_RG[15]
IF ((_CARR23==24) OR ((_RAX[0]==1) AND (_CARR23==56) AND (_RG[9]<>0)))
TOROTOF
$P_PFRAME=CTRANS()
_RG[0]=ABS($TC_CARR7[_TC]) _RG[1]=ABS($TC_CARR8[_TC]) _RG[2]=ABS($TC_CARR9[_TC])
IF ((_RG[0]+_RG[1])==0) OR ((_RG[1]+_RG[2])==0) OR ((_RG[0]+_RG[2])==0)
IF _RG[2]
AROT AX[_ZZA]=_RG[9]
ENDIF
IF _RG[1]
AROT AX[_YYA]=_RG[9]
ENDIF
IF _RG[0]
AROT AX[_XXA]=_RG[9]
ENDIF
ENDIF
$TC_CARR13[_TC]=_RG[9]+_RG[14] $TC_CARR14[_TC]=_RG[10]+_RG[15]
TCOABS TCARR=_TC
CASE _G17_18_19 OF 2 GOTOF _HG18 3 GOTOF _HG19 DEFAULT GOTOF _HG17
_HG18: TOROTY
GOTOF _HGGE
_HG19: TOROTX
GOTOF _HGGE
_HG17: TOROT
_HGGE: TCARR=0
IF ISVAR("$P_TOOLFRAME")
$P_PFRAME=$P_TOOLFRAME:$P_PFRAME
TOROTOF
ENDIF
ENDIF
_M_T1:
IF ((_M_VAR _DEC1)==1)
FOR _I=0 TO 8
_VAR[0,_I]=0
ENDFOR
_VAR[0,3]=1 _VAR[0,7]=1 _TR_LIM=0
REPEAT _VCA1 _VCE
IF _M9960==0
IF (_RAX[0]==1)
IF ((_CARR23<>40) AND (_CARR36==""))
_SERR=<<"A"
IF ((ROUND(_RG[9]*100)/100)<>0) GOTOF _ERR8
ENDIF
IF (_CARR23==56)
_SERR=<<"A"
IF ((ROUND(_RG[9]*100)/100)<>0) GOTOF _ERR8
ENDIF
ENDIF
IF (_RAX[0]==2)
IF ((_CARR23<>40) AND (_CARR36<>""))
_SERR=<<"B"
IF ((ROUND(_RG[10]*100)/100)<>0) GOTOF _ERR8
ENDIF
IF ($TC_CARR23[_TC]=="M")
_SERR=<<"A"
IF ((ROUND(_RG[9]*100)/100)<>0) GOTOF _ERR8
ENDIF
ENDIF
ENDIF
IF ((_M9960==1) AND ((_M_VAR1 _DEC4)>=4))
REPEAT _ERR_REF_A _ERR_REF_E
ENDIF
IF (_RAX[0]==1)
IF (_RAX[1]==1)
_OVR[60]=$P_EPM[_RAX1]
IF ((_CARR36<>"")AND(_RAX[2]==1))
_OVR[69]=$P_EPM[_RAX2]
ENDIF
ELSE
_OVR[60]=_RG[9]
ENDIF
ENDIF
IF (_RAX[0]==2)
IF (_RAX[2]==1)
_OVR[63]=$P_EPM[_RAX2]
IF (_RAX[1]==1)
_OVR[70]=$P_EPM[_RAX1]
ENDIF
ELSE
_OVR[63]=_RG[10]
ENDIF
ENDIF
ENDIF
IF _M9960==0
IF (((_M_VAR _DEC1)==2) OR ((_M_VAR _DEC1)==3))
IF ((_RAX[0]==1) AND (_RAX[1]==1) AND (_M9960==0))
_SERR=<<"D"
IF ((ROUND(_OVR[60]*100)/100)==(ROUND($P_EPM[_RAX1]*100)/100)) GOTOF _ERR8
ENDIF
IF ((_RAX[0]==2) AND (_RAX[2]==1))
_SERR=<<"C"
IF ((ROUND(_OVR[63]*100)/100)==(ROUND($P_EPM[_RAX2]*100)/100)) GOTOF _ERR8
ENDIF
ENDIF
ENDIF
DIAMCYCOF
_SETV[0]=$AA_IW[_XX]*_FAK1 _SETV[1]=$AA_IW[_YY]*_FAK1
_SETV[2]=$AA_IW[_ZZ]*_FAK1-_DB/2
IF (_NEW_PAR==1)
_SETV[2]=_SETV[2]-_FA
IF ((_M9960==1)AND(_CARR23<>40)AND((_M_VAR _DEC1)==1))
IF (((_M_VAR1 _DEC4)==4)OR((_M_VAR1 _DEC4)==5))
_CAL[0]=-_OVR[68] _CAL[1]=-_OVR[67] _CAL[2]=-_OVR[66]
_H_216=1
CYCLE216(_CAL,_H_216)
_SETV[2]=-_DB/2*_CAL[0]
_SETV[1]=-_DB/2*_CAL[1]
_SETV[0]=-_DB/2*_CAL[2]
ENDIF
ENDIF
IF ((_M9960==1)AND((_M_VAR1 _DEC1)==5))
_SETV[0]=($AA_IW[_XX]*_FAK1) _SETV[1]=($AA_IW[_YY]*_FAK1)
_SETV[2]=($AA_IW[_ZZ]*_FAK1)-_DB/2-_FA
ENDIF
_FA=_FA*_FAK3
ELSE
IF (_CBIT14==0)
_RAD=$P_TOOLR*_FAK1
_SETV[2]=_SETV[2]-_RAD
ENDIF
_NMSP=1
ENDIF
_CBIT[10]=1
_RG[3]=_SETV[0] _RG[4]=_SETV[1] _RG[5]=_SETV[2]
IF ((_CARR23==24) AND ($P_ACTFRAME[_ZZA,RT]))
_CHBIT[27]=1
ENDIF
IF _CHBIT[26]==1
IF _CHBIT[28]==1
_MVAR=102119
ELSE
_MVAR=101119
ENDIF
IF (_NEW_PAR==1)
IF (_MVAR_SP==3)
_MVAR=103119
ENDIF
IF (_MVAR_SP==4)
_MVAR=104119
ENDIF
ENDIF
IF ISVAR("$SCS_MEA_FEED_PLANE_VALUE")
_RF=$SCS_MEA_FEED_PLANE_VALUE
IF ISVAR("$SCS_MEA_FEED_CIRCLE")
_RF=$SCS_MEA_FEED_CIRCLE
ENDIF
ELSE
_RF=_SPEED[1]
ENDIF
_STA1=_STA1 MOD 360 _INCA=90
IF (($SCS_MEA_FUNCTION_MASK B_AND 'H800')AND((_MVAR _DEC4)<3))
_MVAR=_MVAR-100000
ENDIF
ELSE
_MVAR=100119
ENDIF
_OVI[2]=9961
CUST_MEACYC(1)
_KNUM=0 _SETVAL=_DB _PRNUM=_MT
IF ((_M9960==1) AND (((_M_VAR1 _DEC4)==2)OR((_M_VAR1 _DEC4)==3)) AND ((_M_VAR _DEC1)==1))
_SERR=<<"(B REF G500?)"
IF _NV_ACT==0 GOTOF _ERR20
_SERR=<<"(C REF TYP?)"
IF (_CARR23==40) GOTOF _ERR20
IF ((_M_VAR1 _DEC4)==2)
FOR _I=104 TO 112
_OVR[_I]=0
ENDFOR
ENDIF
ENDIF
IF _NMSP<=0
_NMSP=1
ENDIF
CYCLE997
IF (_M9960==1)
IF ((_M_VAR _DEC1)==1)
IF ((_M_VAR1 _DEC4)>=4)
IF (((_CARR23==24) AND (_RAX[0]==1)) OR ((_CARR23==56) AND (_RAX[0]==2)))
_CAL[0]=_OVR[68] _CAL[1]=_OVR[67] _CAL[2]=_OVR[66]
_CAL[3]=_OVR[9] _CAL[4]=_OVR[10] _CAL[5]=_OVR[11]
_H_216=1
CYCLE216(_CAL,_H_216)
_OVR[110]=_CAL[3] _OVR[111]=_CAL[4] _OVR[112]=_CAL[5]
ENDIF
_OVR[11]=_OVR[3]-(($AA_IW[_ZZ]*_FAK1)-_DB/2-_FA)+_OVR[11]
_OVR[113]=0
IF ((_CARR23==24) AND (_CARR36<>""))
IF _TC>1000
_OVR[113]=$AC_TRAFO_CORR_ELEM_T[2,2]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_OVI[2]=9961
IF _M9960==1
IF _MIJ_I[0]==1
CUST_MEACYC(2)
ENDIF
ELSE
CUST_MEACYC(2)
ENDIF
_OVI[3]=_M_VAR
_OVI[2]=996 _OVI[8]=_TC _OVI[9]=0
_CBIT[10]=0 _CHBIT[27]=0
IF ((_M_VAR _DEC1==1) AND (_RAX[0]==1))
_OVR[71]=_OVR[4]
IF ISVAR("$SCS_MEA_KIN_DM_TOL")
IF _M9960==1
_DM_TOL=0
ELSE
_DM_TOL=ABS($SCS_MEA_KIN_DM_TOL)
ENDIF
ENDIF
IF (_DM_TOL>0)
_SERR=<<"1 (see S_SETV, _OVR[71])"
IF ((_DB>(_OVR[71]+_DM_TOL))OR(_DB<(_OVR[71]-_DM_TOL))) GOTOF _ERR12
ENDIF
ENDIF
IF (_PROT AND ((_M_VAR _DEC1)==1))
IF (_M9960==0)
WRITE(_LOG,_SN[0],";"<<_SN[0]<<" "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
ENDIF
ENDIF
ORIMKS
$AC_MEAS_VALID=0
$AC_MEAS_LATCH[0]=1
$AA_MEAS_POINT1[_XX]=_OVR[5]
$AA_MEAS_POINT1[_YY]=_OVR[6]
$AA_MEAS_POINT1[_ZZ]=_OVR[7]
$AC_MEAS_P1_COORD=0
IF _OEM_ACT==0
$AC_MEAS_P2_COORD=2
ELSE
$AC_MEAS_P2_COORD=1
ENDIF
IF _T_ACT==1
$AC_MEAS_TOOL_MASK='H20'
ENDIF
$AC_MEAS_TYPE=24
_LOG=MEASURE()
_SERR=<<"A (MEASURE ?):"<<_LOG
IF _LOG GOTOF _ERR99
_OVR[25]=$AA_MEAS_POINT2[_XX]
_OVR[26]=$AA_MEAS_POINT2[_YY]
_OVR[27]=$AA_MEAS_POINT2[_ZZ]
IF ((_T_ACT==1)AND(_M9960==0))
_OVR[27]=_OVR[27]-_L1
ENDIF
FOR _I=4 TO 11
_OVR[_I]=(TRUNC(_OVR[_I]*_MD10200_MM)/_MD10200_MM)
ENDFOR
FOR _I=25 TO 27
_OVR[_I]=(TRUNC(_OVR[_I]*_MD10200_MM)/_MD10200_MM)
ENDFOR
IF ((_M_VAR _DEC1)<=3)
IF (_RAX[0]==1)
IF ((_CMEA _DEC1) < 3)
IF NOT (((_CMEA _DEC1)==2) AND ((_M_VAR _DEC1)==2))
_CMEA=_CMEA+1
ENDIF
ENDIF
_CERG=((_CMEA _DEC1)-1)*3 + 41
_OVR[_CERG+0]=_OVR[25] _OVR[_CERG+1]=_OVR[26] _OVR[_CERG+2]=_OVR[27]
_CERG=((_CMEA _DEC1)+ 59)
IF (_RAX[1]==1)
_OVR[_CERG]=$P_EPM[_RAX1]
ELSE
_OVR[_CERG]=_RG[9]
ENDIF
IF ISVAR("_OVR[79]")
_OVR[71+(_M_VAR _DEC1)]=_OVR[4]
ENDIF
ENDIF
IF (_RAX[0]==2)
IF ((_CMEA _DEC2) < 3)
_CMEA=_CMEA+10
ENDIF
_CERG=((_CMEA _DEC2)-1)*3 + 51
_OVR[_CERG+0]=_OVR[25] _OVR[_CERG+1]=_OVR[26] _OVR[_CERG+2]=_OVR[27]
_CERG=((_CMEA _DEC2)+ 62)
IF (_RAX[2]==1)
_OVR[_CERG]=$P_EPM[_RAX2]
ELSE
_OVR[_CERG]=_RG[10]
ENDIF
IF ISVAR("_OVR[79]")
_OVR[74+(_M_VAR _DEC1)]=_OVR[4]
ENDIF
ENDIF
ENDIF
_MA4:
IF _PROT
IF ((_M_VAR _DEC1)==4)
IF (_M9960==0)
WRITE(_LOG,_SN[0],"; ! only for internal diagnostics ! ------------------")
WRITE(_LOG,_SN[0],";CYCLE996 Measure Kinematic "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_SN[0],";_OVR[40]="<<_CMEA<<" ;_MVAR="<<_M_VAR<<" _PRNUM="<<_PRNUM<<" TCARR="<<_TC<<" _OVR[50]="<<_L1<<" ;L1 TCP="<<NOT _CBIT14<<" G"<<_G17_18_19+16<<" DB="<<_RG[11]<<" SD55740="<<$SCS_MEA_FUNCTION_MASK)
ELSE
IF ISVAR("$MN_SIM_ENVIRONMENT")
WRITE(_LOG,_SN[0],";NCK-Version: "<<$AN_NCK_VERSION<<" $MN_SIM_ENVIRONMENT="<<$MN_SIM_ENVIRONMENT<<" $P_SIM="<<$P_SIM)
ENDIF
WRITE(_LOG,_SN[0],";_OVR[40]="<<_CMEA<<" ;S_MVAR="<<_M_VAR1<<" _PRNUM="<<_PRNUM<<" _OVR[50]="<<_L1<<" ;L1 TCP="<<NOT _CBIT14<<" G"<<_G17_18_19+16<<" DB="<<_RG[11])
IF _TC>=1001
WRITE(_LOG,_SN[0],";TRAFO KC: NO="<<_TC-1000<<" NAME="<<_CARR34)
ELSE
WRITE(_LOG,_SN[0],";TCARR: NO="<<_TC<<" NAME="<<_CARR34)
ENDIF
WRITE(_LOG,_SN[0],";SD55740 $SCS_MEA_FUNCTION_MASK bit7="<<($SCS_MEA_FUNCTION_MASK B_AND 'H80')/128<<" bit8="<<($SCS_MEA_FUNCTION_MASK B_AND 'H100')/256<<" bit9="<<($SCS_MEA_FUNCTION_MASK B_AND 'H200')/512<<" bit10="<<($SCS_MEA_FUNCTION_MASK B_AND 'H400')/1024<<" bit11="<<($SCS_MEA_FUNCTION_MASK B_AND 'H1000')/2048)
ENDIF
IF ((_M_VAR1 _DEC1)==7)
_II=21
REPEAT _M_PA _M_PE
_II=32
REPEAT _M_PA _M_PE
_II=41
REPEAT _M_PA _M_PE
IF (_CARR36<>"")
_II=24
REPEAT _M_PA _M_PE
_II=35
REPEAT _M_PA _M_PE
_II=51
REPEAT _M_PA _M_PE
ENDIF
ELSE
FOR _II=41 TO 69
_M_PA:
WRITE(_LOG,_SN[0],";_OVR["<<_II<<"]="<<_OVR[_II]<<" _OVR["<<_II+1<<"]="<<_OVR[_II+1]<<" _OVR["<<_II+2<<"]="<<_OVR[_II+2])
_M_PE:
_II=_II+2
IF _II==49
_II=_II+1
ENDIF
IF ((_II==50)AND(_CARR36==""))
_II=59
ENDIF
ENDFOR
ENDIF
ELSE
IF (_M9960==0)
WRITE(_LOG,_SN[0],";_OVR[40]="<<_CMEA<<" _MVAR="<<_M_VAR<<" PMxyz="<<_OVR[25]<<"|"<<_OVR[26]<<"|"<<_OVR[27])
ENDIF
ENDIF
ENDIF
IF ((_M_VAR _DEC1)==4)
IF (_CARR36=="")
_CMEA=_CMEA-((_CMEA _DEC2)*10)+30
FOR _I=51 TO 59
_OVR[_I]=0
ENDFOR
_OVR[63]=0 _OVR[64]=0 _OVR[65]=0
_VAR[1,3]=0 _VAR[1,4]=0 _VAR[1,5]=0
ENDIF
IF (_M9960==1)
IF ((_CMEA==30)AND(_M_VAR1 _DEC5==5))OR((_CMEA==03)AND(_M_VAR1 _DEC5==4))
_CMEA=33
ENDIF
ENDIF
_SERR=<<"C (_OVR[40]?):"<<_CMEA
IF (((_CMEA _DEC1) < 3) OR ((_CMEA _DEC2) < 3)) GOTOF _ERR1
ENDIF
IF (((_M_VAR _DEC1)<>4) AND ((((_CMEA _DEC1)==3) AND (_RAX[0]==1)) OR (((_CMEA _DEC2)==3) AND (_RAX[0]==2))))
IF (_M9960==0)
REPEAT _VCA _VCE
ENDIF
FOR _I=0 TO 31
_OVR[_I]=0
ENDFOR
ENDIF
IF ((_M_VAR _DEC1)==4)
DIAMCYCOF
_OVI[2]=996
CUST_MEACYC(1)
_OVR[0]=REP(0,21)
_OVR[27]=REP(0,5)
_OVR[78]=REP(0,26)
_OVR[114]=REP(0,6)
IF ISVAR("$SCS_MEA_KIN_DM_TOL")
_DM_TOL=ABS($SCS_MEA_KIN_DM_TOL)
ENDIF
IF ((_M9960==0) AND (_DM_TOL>0) AND (_OVR[72]<>0))
_SERR=<<"1/2 (see _OVR[72,73])"
IF ((_OVR[73]>(_OVR[72]+_DM_TOL))OR(_OVR[73]<(_OVR[72]-_DM_TOL))) GOTOF _ERR12
_SERR=<<"2/3 (see _OVR[73,74])"
IF ((_OVR[74]>(_OVR[73]+_DM_TOL))OR(_OVR[74]<(_OVR[73]-_DM_TOL))) GOTOF _ERR12
_SERR=<<"1/3 (see _OVR[72,74])"
IF ((_OVR[74]>(_OVR[72]+_DM_TOL))OR(_OVR[74]<(_OVR[72]-_DM_TOL))) GOTOF _ERR12
ENDIF
IF ((_M9960==1)AND(_M_VAR1 _DEC5==5)) GOTOF _CRA1_END
IF (_M9960==1) AND (_TC >= 1001)
IF (_CARR23==24)
_VAR[2,0]=$AC_TRAFO_ORIAX_DIR_T[0,0]
_VAR[2,1]=$AC_TRAFO_ORIAX_DIR_T[0,1]
_VAR[2,2]=$AC_TRAFO_ORIAX_DIR_T[0,2]
ELSE
IF ((_CARR23==40)AND(_CARR36<>""))
_VAR[2,0]=$AC_TRAFO_ORIAX_DIR_P[1,0]
_VAR[2,1]=$AC_TRAFO_ORIAX_DIR_P[1,1]
_VAR[2,2]=$AC_TRAFO_ORIAX_DIR_P[1,2]
ELSE
_VAR[2,0]=$AC_TRAFO_ORIAX_DIR_P[0,0]
_VAR[2,1]=$AC_TRAFO_ORIAX_DIR_P[0,1]
_VAR[2,2]=$AC_TRAFO_ORIAX_DIR_P[0,2]
ENDIF
ENDIF
ELSE
_VAR[2,0]=$TC_CARR7[_TC] _VAR[2,1]=$TC_CARR8[_TC] _VAR[2,2]=$TC_CARR9[_TC]
ENDIF
_SERR=<<"(F VECTOR=0?)"
IF ((_VAR[2,0]==0)AND(_VAR[2,1]==0)AND(_VAR[2,2]==0)) GOTOF _ERR4
_RAX[0]=1
IF ((_M9960==1)AND(_CALC_G3==1))
_VAR[6,6]=_OVR[21] _VAR[6,7]=_OVR[22] _VAR[6,8]=_OVR[23]
_VAR[8,5]=_OVR[32] _VAR[8,6]=_OVR[33] _VAR[8,7]=_OVR[34]
ELSE
REPEAT _VCA _VCE
ENDIF
REPEAT _VMA _VME
REPEAT _VEA _VEE
_CRA1_END:
IF (_CARR36<>"")
IF ((_M9960==1) AND (_M_VAR1 _DEC5==4)) GOTOF _CRA2_END
IF ((_M9960==0) AND (_DM_TOL>0) AND (_OVR[75]<>0))
_SERR=<<"1/2 (see _OVR[75,76])"
IF ((_OVR[76]>(_OVR[75]+_DM_TOL))OR(_OVR[76]<(_OVR[75]-_DM_TOL))) GOTOF _ERR13
_SERR=<<"2/3 (see _OVR[76,77])"
IF ((_OVR[77]>(_OVR[76]+_DM_TOL))OR(_OVR[77]<(_OVR[76]-_DM_TOL))) GOTOF _ERR13
_SERR=<<"1/3 (see _OVR[75,77])"
IF ((_OVR[77]>(_OVR[75]+_DM_TOL))OR(_OVR[77]<(_OVR[75]-_DM_TOL))) GOTOF _ERR13
ENDIF
IF ((_M9960==1) AND (_TC >= 1001))
IF (_CARR23==24)
_VAR[2,3]=$AC_TRAFO_ORIAX_DIR_T[1,0]
_VAR[2,4]=$AC_TRAFO_ORIAX_DIR_T[1,1]
_VAR[2,5]=$AC_TRAFO_ORIAX_DIR_T[1,2]
ENDIF
IF (_CARR23==40)
_VAR[2,3]=$AC_TRAFO_ORIAX_DIR_P[0,0]
_VAR[2,4]=$AC_TRAFO_ORIAX_DIR_P[0,1]
_VAR[2,5]=$AC_TRAFO_ORIAX_DIR_P[0,2]
ENDIF
IF (_CARR23==56)
_VAR[2,3]=$AC_TRAFO_ORIAX_DIR_T[0,0]
_VAR[2,4]=$AC_TRAFO_ORIAX_DIR_T[0,1]
_VAR[2,5]=$AC_TRAFO_ORIAX_DIR_T[0,2]
ENDIF
ELSE
_VAR[2,3]=$TC_CARR10[_TC] _VAR[2,4]=$TC_CARR11[_TC] _VAR[2,5]=$TC_CARR12[_TC]
ENDIF
_RAX[0]=2
IF ((_M9960==1)AND(_CALC_G3==1))
_VAR[6,6]=_OVR[24] _VAR[6,7]=_OVR[25] _VAR[6,8]=_OVR[26]
_VAR[8,5]=_OVR[35] _VAR[8,6]=_OVR[36] _VAR[8,7]=_OVR[37]
ELSE
REPEAT _VCA _VCE
ENDIF
REPEAT _VMA _VME
REPEAT _VEA _VEE
ENDIF
_CRA2_END:
_CHBIT29=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'B10000000') OR (_CHBIT[29]==1)
_CHBIT29=1
ENDIF
IF (_M9960==1)
_NAX=(_MEA_KIN_MODE[0] _DEC1) _SETV[5]=$SCS_MEA_KIN_VALUE[0]
IF _NAX>3
IF (_CARR23==24)
_SETV[5]=$AC_TRAFO_SECTION_T[1,_NAX-4]
ENDIF
IF (_CARR23==56)
_SETV[5]=$AC_TRAFO_SECTION_P[0,_NAX-4]
ENDIF
IF (_CARR23==40)
IF (_CARR36<>"")
_SETV[5]=$AC_TRAFO_SECTION_P[1,_NAX-4]
ELSE
_SETV[5]=$AC_TRAFO_SECTION_P[0,_NAX-4]
ENDIF
ENDIF
_NAX=_NAX-3
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";$SCS_MEA_KIN_MODE[0]="<<$SCS_MEA_KIN_MODE[0]<<"("<<_NAX<<") set to:"<<_SETV[5])
ENDIF
ENDIF
IF (_CARR36<>"")
_NAX2=(_MEA_KIN_MODE[1] _DEC1) _SETV[6]= $SCS_MEA_KIN_VALUE[1]
IF _NAX2>3
IF(_CARR23==24)
_SETV[6]=$AC_TRAFO_SECTION_T[2,_NAX2-4]
ENDIF
IF(_CARR23==56)
_SETV[6]=$AC_TRAFO_SECTION_T[1,_NAX2-4]
ENDIF
IF (_CARR23==40)
_SETV[6]=$AC_TRAFO_SECTION_P[0,_NAX2-4]
ENDIF
_NAX2=_NAX2-3
ENDIF
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";$SCS_MEA_KIN_MODE[1]="<<$SCS_MEA_KIN_MODE[1]<<"("<<_NAX2<<") set to:"<<_SETV[6])
ENDIF
ENDIF
ELSE
_NAX=(_M_VAR _DEC6)
IF (_CARR36<>"")
_NAX2=(_M_VAR _DEC7)
ENDIF
ENDIF
IF (_M9960==0) OR ((_M9960==1)AND(_TC<1001))
IF (_CARR23<>40)
IF (_CARR36<>"")
IF (_CARR23==24)
_VAR[6,0]=_OVR[32]-_OVR[51] _VAR[6,1]=_OVR[33]-_OVR[52] _VAR[6,2]=_OVR[34]-_OVR[43]
ELSE
_VAR[6,0]=_OVR[32]-_OVR[51] _VAR[6,1]=_OVR[33]-_OVR[52] _VAR[6,2]=_OVR[34]-_OVR[53]
ENDIF
ELSE
_VAR[6,0]=_OVR[32]-_OVR[41] _VAR[6,1]=_OVR[33]-_OVR[42] _VAR[6,2]=_OVR[34]-_OVR[43]
ENDIF
ELSE
_VAR[6,0]=_OVR[32] _VAR[6,1]=_OVR[33] _VAR[6,2]=_OVR[34]
ENDIF
ENDIF
IF ((_M9960==1)AND(_TC>=1001))
IF (_CARR23==24)
IF (_CARR36<>"")
_VAR[6,0]=_OVR[32]-_OVR[51] _VAR[6,1]=_OVR[33]-_OVR[52] _VAR[6,2]=_OVR[34]-_OVR[43]
ELSE
_VAR[6,0]=_OVR[32]-_OVR[41] _VAR[6,1]=_OVR[33]-_OVR[42] _VAR[6,2]=_OVR[34]-_OVR[43]
ENDIF
ENDIF
IF (_CARR23==56)
_VAR[6,0]=_OVR[35]-_OVR[41] _VAR[6,1]=_OVR[36]-_OVR[42] _VAR[6,2]=_OVR[37]-_OVR[43]
ENDIF
IF (_CARR23==40)
IF _CARR36<>""
_VAR[6,0]=_OVR[35] _VAR[6,1]=_OVR[36] _VAR[6,2]=_OVR[37]
ELSE
_VAR[6,0]=_OVR[32] _VAR[6,1]=_OVR[33] _VAR[6,2]=_OVR[34]
ENDIF
ENDIF
ENDIF
_VAR[8,5]=_VAR[6,0] _VAR[8,6]=_VAR[6,1] _VAR[8,7]=_VAR[6,2]
IF ((_NAX>0)AND(_NAX<=3)AND(_M9960==0))
_VAR[8,8]=_SETV[5]
_VAR[6,3]=_VAR[1,0] _VAR[6,4]=_VAR[1,1] _VAR[6,5]=_VAR[1,2]
IF _CHBIT29==1
_VAR[6,3]=$TC_CARR7[_TC] _VAR[6,4]=$TC_CARR8[_TC] _VAR[6,5]=$TC_CARR9[_TC]
ENDIF
REPEAT _VNA _VNE
ENDIF
REPEAT _VEA _VEE
IF _CARR23==24
IF (_TC < 1001)
_OVR[1]=_VAR[8,5] _OVR[2]=_VAR[8,6] _OVR[3]=_VAR[8,7]
ELSE
_OVR[4]=_VAR[8,5] _OVR[5]=_VAR[8,6] _OVR[6]=_VAR[8,7]
ENDIF
ENDIF
IF _CARR23==40
_OVR[4]=_VAR[8,5] _OVR[5]=_VAR[8,6] _OVR[6]=_VAR[8,7]
ENDIF
IF _CARR23==56
IF (_TC < 1001)
_OVR[4]=-_VAR[8,5] _OVR[5]=-_VAR[8,6] _OVR[6]=-_VAR[8,7]
ELSE
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ENDIF
ENDIF
_SERR=<<"B (_MVAR dec7):"<<_M_VAR
IF (_CARR23==24)
_VAR[6,0]=_OVR[35]-_OVR[51] _VAR[6,1]=_OVR[36]-_OVR[52] _VAR[6,2]=_OVR[37]-_OVR[53]
ELSE
IF (_TC<1001)
IF _CARR23==40
_VAR[6,0]=-(_OVR[4]-_OVR[35]) _VAR[6,1]=-(_OVR[5]-_OVR[36]) _VAR[6,2]=-(_OVR[6]-_OVR[37])
ELSE
_VAR[6,0]=_OVR[35] _VAR[6,1]=_OVR[36] _VAR[6,2]=_OVR[37]
ENDIF
ELSE
_VAR[6,0]=_OVR[32] _VAR[6,1]=_OVR[33] _VAR[6,2]=_OVR[34]
ENDIF
ENDIF
_VAR[8,5]=_VAR[6,0] _VAR[8,6]=_VAR[6,1] _VAR[8,7]=_VAR[6,2]
IF ((_NAX2>0)AND(_NAX2<=3)AND(_M9960==0))
_VAR[8,8]=_SETV[6]
_VAR[6,3]=_VAR[1,3] _VAR[6,4]=_VAR[1,4] _VAR[6,5]=_VAR[1,5]
IF _CHBIT29==1
_VAR[6,3]=$TC_CARR10[_TC] _VAR[6,4]=$TC_CARR11[_TC] _VAR[6,5]=$TC_CARR12[_TC]
ENDIF
_NAX=_NAX2
REPEAT _VNA _VNE
ENDIF
REPEAT _VEA _VEE
IF _CARR23==24
_OVR[15]=-_VAR[8,5] _OVR[16]=-_VAR[8,6] _OVR[17]=-_VAR[8,7]
ENDIF
IF _CARR23==40
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ENDIF
IF _CARR23==56
IF (_TC < 1001)
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ELSE
_OVR[4]=-_VAR[8,5] _OVR[5]=-_VAR[8,6] _OVR[6]=-_VAR[8,7]
ENDIF
ENDIF
_CAL[0]=_OVR[68] _CAL[1]=_OVR[67] _CAL[2]=_OVR[66]
_H_216=1
CYCLE216(_CAL,_H_216)
IF _CARR23==24
IF (_CARR36<>"")
IF (_TC < 1001)
_OVR[4]=-(_OVR[15]+_OVR[1]) _OVR[5]=-(_OVR[16]+_OVR[2]) _OVR[6]=-(_OVR[17]+_OVR[3])
ELSE
_OVR[4]=-_OVR[15]-_OVR[4] _OVR[5]=-_OVR[16]-_OVR[5] _OVR[6]=-_OVR[17]-_OVR[6]
IF ((_OVR[66]==0)AND(_OVR[67]==0)AND(_OVR[68]==0))
_OVR[4]=_OVR[4]+(_L1*_CAL[2]) _OVR[5]=_OVR[5]+(_L1*_CAL[1]) _OVR[6]=_OVR[6]+(_L1*_CAL[0])
_OVR[15]=_OVR[15]-(_L1*_CAL[2]) _OVR[16]=_OVR[16]-(_L1*_CAL[1]) _OVR[17]=_OVR[17]-(_L1*_CAL[0])
ELSE
_OVR[4]=_OVR[4]-(_L1*_CAL[2]) _OVR[5]=_OVR[5]-(_L1*_CAL[1]) _OVR[6]=_OVR[6]-(_L1*_CAL[0])
ENDIF
ENDIF
ELSE
IF (_TC < 1001)
_OVR[15]=-_OVR[1] _OVR[16]=-_OVR[2] _OVR[17]=-_OVR[3]
ELSE
_OVR[15]=-_OVR[4] _OVR[16]=-_OVR[5] _OVR[17]=-_OVR[6]
_OVR[15]=_OVR[15]-(_L1*_CAL[2]) _OVR[16]=_OVR[16]-(_L1*_CAL[1]) _OVR[17]=_OVR[17]-(_L1*_CAL[0])
ENDIF
_OVR[4]=0 _OVR[5]=0 _OVR[6]=0
ENDIF
ENDIF
IF _CARR23==40
IF (_CARR36<>"")
_OVR[18]=-(_OVR[15]+_OVR[4]) _OVR[19]=-(_OVR[16]+_OVR[5]) _OVR[20]=-(_OVR[17]+_OVR[6])
IF ((_SD55740_13==1) AND ((_M_VAR _DEC5)==0))
_VAR[6,3]=$TC_CARR10[_TC] _VAR[6,4]=$TC_CARR11[_TC] _VAR[6,5]=$TC_CARR12[_TC]
_VAR[6,0]=SET(_OVR[18],_OVR[19],_OVR[20])
_VAR[8,8]=_SETV[6]
_NAX=_NAX2
REPEAT _VNA _VNE
REPEAT _VEA _VEE
_OVR[18]=_VAR[8,5] _OVR[19]=_VAR[8,6] _OVR[20]=_VAR[8,7]
_OVR[15]=-(_OVR[18]+_OVR[4]) _OVR[16]=-(_OVR[19]+_OVR[5]) _OVR[17]=-(_OVR[20]+_OVR[6])
ENDIF
ELSE
_OVR[15]=SET(0,0,0)
_OVR[18]=-_OVR[4] _OVR[19]=-_OVR[5] _OVR[20]=-_OVR[6]
ENDIF
ENDIF
IF _CARR23==56
_OVR[1]=-_OVR[4] _OVR[2]=-_OVR[5] _OVR[3]=-_OVR[6]
IF (_CARR36<>"")
_OVR[18]=-_OVR[15] _OVR[19]=-_OVR[16] _OVR[20]=-_OVR[17]
ENDIF
ENDIF
IF ((_NAX>0)AND(_NAX<=6)AND(_M9960==1))
_VAR[6,3]=_VAR[2,0] _VAR[6,4]=_VAR[2,1] _VAR[6,5]=_VAR[2,2]
IF _CARR23==24
_VAR[8,8]=-_SETV[5]
IF (_CARR36<>"")
_VAR[6,0]=_OVR[4] _VAR[6,1]=_OVR[5] _VAR[6,2]=_OVR[6]
ELSE
_VAR[6,0]=_OVR[15] _VAR[6,1]=_OVR[16] _VAR[6,2]=_OVR[17]
ENDIF
ENDIF
IF _CARR23==40
_VAR[8,8]=_SETV[5]
IF (_CARR36<>"")
_VAR[6,0]=_OVR[15] _VAR[6,1]=_OVR[16] _VAR[6,2]=_OVR[17]
ELSE
_VAR[6,0]=_OVR[4] _VAR[6,1]=_OVR[5] _VAR[6,2]=_OVR[6]
ENDIF
ENDIF
IF _CARR23==56
_VAR[8,8]=-_SETV[5]
_VAR[6,0]=_OVR[4] _VAR[6,1]=_OVR[5] _VAR[6,2]=_OVR[6]
ENDIF
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";set value RA1 ["<<_VAR[6,3]<<" "<<_VAR[6,4]<<" "<<_VAR[6,5]<<"] ;_VAR[6,0..2]="<<_VAR[6,0]<<"  "<<_VAR[6,1]<<"  "<<_VAR[6,2])
ENDIF
REPEAT _VNA _VNE
IF _CARR23==24
IF (_CARR36<>"")
_OVR[4]=_VAR[8,5] _OVR[5]=_VAR[8,6] _OVR[6]=_VAR[8,7]
ELSE
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ENDIF
ENDIF
IF _CARR23==40
IF (_CARR36<>"")
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ELSE
_OVR[4]=_VAR[8,5] _OVR[5]=_VAR[8,6] _OVR[6]=_VAR[8,7]
ENDIF
ENDIF
IF _CARR23==56
_OVR[4]=_VAR[8,5] _OVR[5]=_VAR[8,6] _OVR[6]=_VAR[8,7]
ENDIF
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";  ->_VAR[8,5..7]="<<_VAR[8,5]<<"  "<<_VAR[8,6]<<"  "<<_VAR[8,7]<<" ;Offset RA1")
ENDIF
ENDIF
IF ((_NAX2>0)AND(_NAX2<=6)AND(_M9960==1))
_VAR[6,3]=_VAR[2,3] _VAR[6,4]=_VAR[2,4] _VAR[6,5]=_VAR[2,5]
IF _CARR23==24
_VAR[8,8]=-_SETV[6]
_VAR[6,0]=_OVR[15] _VAR[6,1]=_OVR[16] _VAR[6,2]=_OVR[17]
ENDIF
IF _CARR23==40
_VAR[8,8]=_SETV[6]
_VAR[6,0]=_OVR[4] _VAR[6,1]=_OVR[5] _VAR[6,2]=_OVR[6]
ENDIF
IF _CARR23==56
_VAR[8,8]=_SETV[6]
_VAR[6,0]=_OVR[15] _VAR[6,1]=_OVR[16] _VAR[6,2]=_OVR[17]
ENDIF
_NAX=_NAX2
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";set value RA2 ["<<_VAR[6,3]<<" "<<_VAR[6,4]<<" "<<_VAR[6,5]<<"] ;_VAR[6,0..2]="<<_VAR[6,0]<<"  "<<_VAR[6,1]<<"  "<<_VAR[6,2])
ENDIF
REPEAT _VNA _VNE
IF _CARR23==24
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ENDIF
IF _CARR23==40
_OVR[4]=_VAR[8,5] _OVR[5]=_VAR[8,6] _OVR[6]=_VAR[8,7]
_CORR_V[0]=_VAR[6,0] _CORR_V[1]=_VAR[6,1] _CORR_V[2]=_VAR[6,2]
ENDIF
IF _CARR23==56
_OVR[15]=_VAR[8,5] _OVR[16]=_VAR[8,6] _OVR[17]=_VAR[8,7]
ENDIF
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";  ->_VAR[8,5..7]="<<_VAR[8,5]<<"  "<<_VAR[8,6]<<"  "<<_VAR[8,7]<<" ;Offset RA2")
ENDIF
ENDIF
IF (((_M_VAR _DEC5)==3)AND(_M9960==0))
IF _CARR23==24
_OVR[1]=0 _OVR[2]=0 _OVR[3]=0
ENDIF
IF _CARR23==40
_OVR[18]=0 _OVR[19]=0 _OVR[20]=0
ENDIF
IF _CARR23==56
_OVR[1]=0 _OVR[2]=0 _OVR[3]=0
_OVR[18]=0 _OVR[19]=0 _OVR[20]=0
ENDIF
ENDIF
IF (_PROT AND (_M9960==1))
WRITE(_LOG,_SN[0],";_OVR[1...]=["<<_OVR[1]<<" "<<_OVR[2]<<" "<<_OVR[3]<<" ]   _OVR[4...]=["<<_OVR[4]<<"  "<<_OVR[5]<<"  "<<_OVR[6]<<"]")
WRITE(_LOG,_SN[0],";_OVR[15..]=["<<_OVR[15]<<" "<<_OVR[16]<<" "<<_OVR[17]<<" ]   _OVR[18..]=["<<_OVR[18]<<"  "<<_OVR[19]<<"  "<<_OVR[20]<<"]")
ENDIF
ENDIF
_OVR[40]=_CMEA
IF (S_MVAR _DEC1)==0
_OVR[7]=_VAR[1,0] _OVR[8]=_VAR[1,1] _OVR[9]=_VAR[1,2]
_OVR[10]=_VAR[1,3] _OVR[11]=_VAR[1,4] _OVR[12]=_VAR[1,5]
ENDIF
IF (((_M_VAR _DEC1)==4) AND ((_M_VAR _DEC4)==2))
IF (_M9960==0)
_OVR[38]=_RG[7] _OVR[39]=_RG[8]
S_CHANNO_RESULT_DISPLAY=$P_CHANNO
_PON1:
MMC("MCYCLES,LM,mz96_erg.com,erg_kin","A")
STOPRE
S_MMC_INFO = SUBSTR($P_MMCA,0,1)
IF S_MMC_INFO=="B"
G4 F1
GOTOB _PON1
ENDIF
M0
STOPRE
CYCLE102(0)
ENDIF
ENDIF
_OVI[3]=_M_VAR1
IF (_PROT AND ((_M_VAR _DEC1)==4))
IF _TC >= 1001
WRITE(_LOG,_SN[0],";old TRAFO KC")
IF NOT ISVAR("$AC_TRAFO_SECTION_T")
WRITE(_LOG,_SN[0],"NCK-Version ?? Kinematic chain ??")
GOTOF _M_P1
ENDIF
WRITE(_LOG,_SN[0],";$NT_CORR_ELEM_T= "<<$NT_CORR_ELEM_T[_NT_NO,0]<<" / "<<$NT_CORR_ELEM_T[_NT_NO,1]<<" / "<<$NT_CORR_ELEM_T[_NT_NO,2]<<" / "<<$NT_CORR_ELEM_T[_NT_NO,3])
WRITE(_LOG,_SN[0],";$NT_CORR_ELEM_P= "<<$NT_CORR_ELEM_P[_NT_NO,0]<<" / "<<$NT_CORR_ELEM_P[_NT_NO,1]<<" / "<<$NT_CORR_ELEM_P[_NT_NO,2]<<" / "<<$NT_CORR_ELEM_P[_NT_NO,3])
IF ISVAR("$AC_TRAFO_CORR_ELEM_T[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[0]= "<<$AC_TRAFO_CORR_ELEM_T[0,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[0,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_T[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[1]= "<<$AC_TRAFO_CORR_ELEM_T[1,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[1,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_T[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[2]= "<<$AC_TRAFO_CORR_ELEM_T[2,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[2,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_T[3,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[3]= "<<$AC_TRAFO_CORR_ELEM_T[3,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[3,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[3,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_P[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[0]= "<<$AC_TRAFO_CORR_ELEM_P[0,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[0,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_P[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[1]= "<<$AC_TRAFO_CORR_ELEM_P[1,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[1,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_P[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[2]= "<<$AC_TRAFO_CORR_ELEM_P[2,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[2,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_CORR_ELEM_P[3,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[3]= "<<$AC_TRAFO_CORR_ELEM_P[3,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[3,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[3,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[0]= "<<$AC_TRAFO_SECTION_T[0,0]<<"  "<<$AC_TRAFO_SECTION_T[0,1]<<"  "<<$AC_TRAFO_SECTION_T[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[1]= "<<$AC_TRAFO_SECTION_T[1,0]<<"  "<<$AC_TRAFO_SECTION_T[1,1]<<"  "<<$AC_TRAFO_SECTION_T[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[2]= "<<$AC_TRAFO_SECTION_T[2,0]<<"  "<<$AC_TRAFO_SECTION_T[2,1]<<"  "<<$AC_TRAFO_SECTION_T[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[3,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[3]= "<<$AC_TRAFO_SECTION_T[3,0]<<"  "<<$AC_TRAFO_SECTION_T[3,1]<<"  "<<$AC_TRAFO_SECTION_T[3,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[0]= "<<$AC_TRAFO_SECTION_P[0,0]<<"  "<<$AC_TRAFO_SECTION_P[0,1]<<"  "<<$AC_TRAFO_SECTION_P[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[1]= "<<$AC_TRAFO_SECTION_P[1,0]<<"  "<<$AC_TRAFO_SECTION_P[1,1]<<"  "<<$AC_TRAFO_SECTION_P[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[2]= "<<$AC_TRAFO_SECTION_P[2,0]<<"  "<<$AC_TRAFO_SECTION_P[2,1]<<"  "<<$AC_TRAFO_SECTION_P[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[3,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[3]= "<<$AC_TRAFO_SECTION_P[3,0]<<"  "<<$AC_TRAFO_SECTION_P[3,1]<<"  "<<$AC_TRAFO_SECTION_P[3,2])
ENDIF
IF ISVAR("$AC_TRAFO_ORIAX_DIR_T[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_ORIAX_DIR_T[0]= "<<$AC_TRAFO_ORIAX_DIR_T[0,0]<<"  "<<$AC_TRAFO_ORIAX_DIR_T[0,1]<<"  "<<$AC_TRAFO_ORIAX_DIR_T[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_ORIAX_DIR_T[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_ORIAX_DIR_T[1]= "<<$AC_TRAFO_ORIAX_DIR_T[1,0]<<"  "<<$AC_TRAFO_ORIAX_DIR_T[1,1]<<"  "<<$AC_TRAFO_ORIAX_DIR_T[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_ORIAX_DIR_T[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_ORIAX_DIR_T[2]= "<<$AC_TRAFO_ORIAX_DIR_T[2,0]<<"  "<<$AC_TRAFO_ORIAX_DIR_T[2,1]<<"  "<<$AC_TRAFO_ORIAX_DIR_T[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_ORIAX_DIR_P[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_ORIAX_DIR_P[0]= "<<$AC_TRAFO_ORIAX_DIR_P[0,0]<<"  "<<$AC_TRAFO_ORIAX_DIR_P[0,1]<<"  "<<$AC_TRAFO_ORIAX_DIR_P[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_ORIAX_DIR_P[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_ORIAX_DIR_P[1]= "<<$AC_TRAFO_ORIAX_DIR_P[1,0]<<"  "<<$AC_TRAFO_ORIAX_DIR_P[1,1]<<"  "<<$AC_TRAFO_ORIAX_DIR_P[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_ORIAX_DIR_P[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_ORIAX_DIR_P[2]= "<<$AC_TRAFO_ORIAX_DIR_P[2,0]<<"  "<<$AC_TRAFO_ORIAX_DIR_P[2,1]<<"  "<<$AC_TRAFO_ORIAX_DIR_P[2,2])
ENDIF
_M_P1:
ELSE
_SN[1]=<<" $TC_CARR"
IF ((_M_VAR _DEC3)==1)
IF (_PROT==2)
REPEAT _PROE _PRO_T
ENDIF
REPEAT _PROA _PROE
ENDIF
IF (_PROT==2)
REPEAT _PRA_T _PRE_T
ENDIF
IF (_CARR23==24)
REPEAT _PRA_1 _PRE_3
ENDIF
IF (_CARR23==40)
REPEAT _PRE_1 _PRE_4
ENDIF
IF (_CARR23==56)
REPEAT _PRA_1 _PRE_4
ENDIF
ENDIF
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H200')
IF _TC >= 1001
ELSE
_SN[1]=<<" $TC_CARR"
WRITE(_LOG,_SN[0],";"<<_SN[1]<<"7["<<_TC<<"]="<<_OVR[98]<<_SN[1]<<"8["<<_TC<<"]="<<_OVR[99]<<_SN[1]<<"9["<<_TC<<"]="<<_OVR[100]<<" ;V1xyz")
WRITE(_LOG,_SN[0],";"<<_SN[1]<<"10["<<_TC<<"]="<<_OVR[101]<<_SN[1]<<"11["<<_TC<<"]="<<_OVR[102]<<_SN[1]<<"12["<<_TC<<"]="<<_OVR[103]<<" ;V2xyz")
ENDIF
ENDIF
IF (_DM_TOL<>0)
WRITE(_LOG,_SN[0],";SD55644 $SCS_MEA_KIN_DM_TOL="<<$SCS_MEA_KIN_DM_TOL)
WRITE(_LOG,_SN[0],";_OVR[72]="<<_OVR[72]<<" _OVR[73]="<<_OVR[73]<<" _OVR[74]="<<_OVR[74])
WRITE(_LOG,_SN[0],";_OVR[75]="<<_OVR[75]<<" _OVR[76]="<<_OVR[76]<<" _OVR[77]="<<_OVR[77])
ENDIF
IF _TC < 1001
WRITE(_LOG,_SN[0],";----------end")
ENDIF
ENDIF
_TOL_ON=0
IF (((_M_VAR _DEC1)==4) AND (_TC < 1001))
_SERR=<<""
_OVI[9]=0
IF _RG[7]
IF (ABS($TC_CARR1[_TC]-_OVR[1]) > _RG[7]) OR (ABS($TC_CARR2[_TC]-_OVR[2]) > _RG[7]) OR (ABS($TC_CARR3[_TC]-_OVR[3])>_RG[7])
_OVI[9]=62317
ENDIF
IF (ABS($TC_CARR4[_TC]-_OVR[4]) > _RG[7]) OR (ABS($TC_CARR5[_TC]-_OVR[5]) > _RG[7]) OR (ABS($TC_CARR6[_TC]-_OVR[6])>_RG[7])
_OVI[9]=62317
ENDIF
IF (ABS($TC_CARR15[_TC]-_OVR[15]) > _RG[7]) OR (ABS($TC_CARR16[_TC]-_OVR[16]) > _RG[7]) OR (ABS($TC_CARR17[_TC]-_OVR[17])> _RG[7])
_OVI[9]=62317
ENDIF
IF (ABS($TC_CARR18[_TC]-_OVR[18]) > _RG[7]) OR (ABS($TC_CARR19[_TC]- _OVR[19]) > _RG[7]) OR (ABS($TC_CARR20[_TC]-_OVR[20])>_RG[7])
_OVI[9]=62317
ENDIF
IF (_OVI[9]==62317)
_TOL_ON=1
IF (_SD55740_12==1)
_OVI[9]=61362
ENDIF
ENDIF
ENDIF
IF _RG[8]
IF (ABS($TC_CARR7[_TC] - _OVR[7]) > _RG[8]) OR (ABS($TC_CARR8[_TC] - _OVR[8]) > _RG[8]) OR (ABS($TC_CARR9[_TC] - _OVR[9]) > _RG[8])
_OVI[9]=62318
ENDIF
IF (ABS($TC_CARR10[_TC] - _OVR[10]) > _RG[8]) OR (ABS($TC_CARR11[_TC] - _OVR[11]) > _RG[8]) OR (ABS($TC_CARR12[_TC] - _OVR[12]) > _RG[8])
_OVI[9]=62318
ENDIF
IF (_OVI[9]==62318)
_TOL_ON=1
IF (_SD55740_12==1)
_OVI[9]=61363
ENDIF
ENDIF
ENDIF
ENDIF
IF ((_M_VAR _DEC1)==4)
_OVR[38]=_RG[7] _OVR[39]=_RG[8]
IF ((_M_VAR _DEC4)==1) OR (_TOL_ON==1)
S_CHANNO_RESULT_DISPLAY=$P_CHANNO
_PON2:
MMC("MCYCLES,LM,mz96_erg.com,erg_kin","A")
STOPRE
S_MMC_INFO = SUBSTR($P_MMCA,0,1)
IF S_MMC_INFO=="B"
G4 F1
GOTOB _PON2
ENDIF
ENDIF
IF _TOL_ON==1
SETAL(_OVI[9],_SERR)
M0
CYCLE102(0)
RET
ENDIF
IF ((_CHBIT[25]<>1) AND (((_M_VAR1 _DEC4)MOD 2)==1))
SETAL(62315,_SERR)
M0
STOPRE
CYCLE102(0)
ENDIF
ENDIF
IF ((S_PROTSTAT[0]==1)AND(_M9960==0))
_PROTVAL[25]=SET("","","",""," ,"<<($P_GG[6]+16)<<", ")
CYCLE151
ENDIF
IF (_PROT AND (_M9960==1) AND((_M_VAR _DEC1)==4))
WRITE(_LOG,_SN[0],";OVECT V1xyz= "<<_OVR[7]<<"  "<<_OVR[8]<<"  "<<_OVR[9])
IF (_CARR36<>"")
WRITE(_LOG,_SN[0],";OVECT V2xyz= "<<_OVR[10]<<"  "<<_OVR[11]<<"  "<<_OVR[12])
ENDIF
ENDIF
IF (((_M_VAR _DEC1)==4) AND ((((_M_VAR _DEC3)==1)AND(_M9960==0)) OR (_M9960==1)))
_SERR=<<_TC
IF (_M9960==1)
_SERR=<<(_TC-1000)
ENDIF
STOPRE
IF ((S_PROTSTAT[0]==1)AND(_M9960==0))
_PROTVAL[29]="V"<<_PROTVAL[29]
CYCLE151
ENDIF
IF _TC >=1001
IF (_CARR23==24)
IF ISVAR("$AC_TRAFO_SECTION_T[1,0]")
_VAR[3,0]=$AC_TRAFO_SECTION_T[1,0] _VAR[3,1]=$AC_TRAFO_SECTION_T[1,1] _VAR[3,2]=$AC_TRAFO_SECTION_T[1,2]
ENDIF
ELSE
IF ISVAR("$AC_TRAFO_SECTION_P[0,0]")
_VAR[3,0]=$AC_TRAFO_SECTION_P[0,0] _VAR[3,1]=$AC_TRAFO_SECTION_P[0,1] _VAR[3,2]=$AC_TRAFO_SECTION_P[0,2]
ENDIF
ENDIF
_NO_ALARM=1
_CORR_MODE=20
IF (((_AMODE _DEC1) == 1) AND (S_SETV4 <> 0))
$SN_CORR_TRAFO_LIN_MAX=ABS(S_SETV4)
ELSE
_CORR_MODE=_CORR_MODE + 1000
ENDIF
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TNUM-1000,0],TRUE)
IF(_II>0)
_RG[12]=SQRT(POT(_VAR[2,0])+POT(_VAR[2,1])+POT(_VAR[2,2]))
IF _RG[12]>0
_VAR[2,0]=SET((_VAR[2,0]/_RG[12]),(_VAR[2,1]/_RG[12]),(_VAR[2,2]/_RG[12]))
ENDIF
ENDIF
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TNUM-1000,1],TRUE)
IF(_II>0)
_RG[12]=SQRT(POT(_VAR[2,3])+POT(_VAR[2,4])+POT(_VAR[2,5]))
IF _RG[12]>0
_VAR[2,3]=SET((_VAR[2,3]/_RG[12]),(_VAR[2,4]/_RG[12]),(_VAR[2,5]/_RG[12]))
ENDIF
ENDIF
IF ((_CARR36<>"") AND (_M_VAR1 _DEC5<>4))
IF (_CARR23==24)
IF ISVAR("$AC_TRAFO_SECTION_T[2,0]")
_VAR[3,3]=$AC_TRAFO_SECTION_T[2,0] _VAR[3,4]=$AC_TRAFO_SECTION_T[2,1] _VAR[3,5]=$AC_TRAFO_SECTION_T[2,2]
ENDIF
ENDIF
IF (_CARR23==56)
IF ISVAR("$AC_TRAFO_SECTION_T[1,0]")
_VAR[3,3]=$AC_TRAFO_SECTION_T[1,0] _VAR[3,4]=$AC_TRAFO_SECTION_T[1,1] _VAR[3,5]=$AC_TRAFO_SECTION_T[1,2]
ENDIF
ENDIF
IF (_CARR23==40)
IF ISVAR("$AC_TRAFO_SECTION_P[1,0]")
_VAR[3,3]=$AC_TRAFO_SECTION_P[1,0] _VAR[3,4]=$AC_TRAFO_SECTION_P[1,1] _VAR[3,5]=$AC_TRAFO_SECTION_P[1,2]
ENDIF
ENDIF
_NO_ALARM=1
_CORR_INDEX=$AC_TRAFO_ORIAX_LOC[AXNAME(_CARR36)]
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TNUM-1000,1],TRUE)
IF(_II>0)
_RG[0]=SET($NK_OFF_DIR[_II,0],$NK_OFF_DIR[_II,1],$NK_OFF_DIR[_II,2])
_RG[12]=SQRT(POT(_RG[0])+POT(_RG[1])+POT(_RG[2]))
IF _RG[12]>0
_RG[0]=SET(_RG[0]/_RG[12],_RG[1]/_RG[12],_RG[2]/_RG[12])
ENDIF
ENDIF
IF (_CARR23==24)
_CORR_INDEX=_CORR_INDEX+1
_CORR_VECT[0]=-_OVR[15] _CORR_VECT[1]=-_OVR[16] _CORR_VECT[2]=-_OVR[17]
ENDIF
IF (_CARR23==56)
_CORR_INDEX=_CORR_INDEX+1
_CORR_VECT[0]=_OVR[15] _CORR_VECT[1]=_OVR[16] _CORR_VECT[2]=_OVR[17]
ENDIF
IF (_CARR23==40)
_CORR_INDEX=_CORR_INDEX+1
_CORR_VECT[0]=_OVR[15] _CORR_VECT[1]=_OVR[16] _CORR_VECT[2]=_OVR[17]
IF _MEA_KIN_MODE[1]>0
IF NOT ((_MEA_KIN_MODE[0]==1) OR (_MEA_KIN_MODE[0]==4))
_CORR_VECT[0]=_CORR_VECT[0]+_CORR_V[0]-_OVR[4]
ENDIF
IF NOT ((_MEA_KIN_MODE[0]==2) OR (_MEA_KIN_MODE[0]==5))
_CORR_VECT[1]=_CORR_VECT[1]+_CORR_V[1]-_OVR[5]
ENDIF
IF NOT ((_MEA_KIN_MODE[0]==3) OR (_MEA_KIN_MODE[0]==6))
_CORR_VECT[2]=_CORR_VECT[2]+_CORR_V[2]-_OVR[6]
ENDIF
ENDIF
ENDIF
IF (_PROT AND ((_M_VAR _DEC1)==4))
WRITE(_LOG,_SN[0],";_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2]<<" _CORR_INDEX= "<<_CORR_INDEX<<" _CORR_MODE= "<<_CORR_MODE<<" _ACALC="<<_ACALC<<" $AC_MEAS_RESULTS[9]="<<$AC_MEAS_RESULTS[9])
ENDIF
_CORR_M[1]=_CORR_INDEX _CORR_M[2]=_CORR_MODE
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
_CORR_M[0]=_CORR_STATUS
IF ((_CORR_STATUS>0)AND(_CORR_STATUS<>41))
_NO_ALARM=0
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF (_CORR_STATUS==41)
FOR _I=0 TO 2
_OVR[_I+117]=(TRUNC(_CORR_VECT[_I]*_MD10200_MM)/_MD10200_MM)
ENDFOR
_SERR=<<_CARR34<<" AXIS: "<<_CARR36 _OVI[9]=62317
GOTOF _ERR17A
ENDIF
ENDIF
TRAFOOF
NEWCONF
TRAFOON($NT_NAME[_TC-1000])
STOPRE
IF NOT(_M_VAR1 _DEC5==5)
_CORR_INDEX=$AC_TRAFO_ORIAX_LOC[AXNAME(_CARR35)]
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TNUM-1000,0],TRUE)
IF(_II>0)
_RG[0]=SET($NK_OFF_DIR[_II,0],$NK_OFF_DIR[_II,1],$NK_OFF_DIR[_II,2])
_RG[12]=SQRT(POT(_RG[0])+POT(_RG[1])+POT(_RG[2]))
IF _RG[12]>0
_RG[0]=SET(_RG[0]/_RG[12],_RG[1]/_RG[12],_RG[2]/_RG[12])
ENDIF
ENDIF
IF (_CARR23==24)
_CORR_INDEX=_CORR_INDEX+1
IF (_CARR36=="")
_CORR_VECT[0]=-_OVR[15] _CORR_VECT[1]=-_OVR[16] _CORR_VECT[2]=-_OVR[17]
ELSE
_CORR_VECT[0]=-_OVR[4] _CORR_VECT[1]=-_OVR[5] _CORR_VECT[2]=-_OVR[6]
ENDIF
ENDIF
IF (_CARR23==56)
_CORR_VECT[0]=-_OVR[4] _CORR_VECT[1]=-_OVR[5] _CORR_VECT[2]=-_OVR[6]
ENDIF
IF (_CARR23==40)
IF (_CARR36<>"")
_CORR_INDEX=_CORR_INDEX-1
ENDIF
_CORR_VECT[0]=_OVR[4] _CORR_VECT[1]=_OVR[5] _CORR_VECT[2]=_OVR[6]
ENDIF
IF ((_M9960==1) AND ((_M_VAR1 _DEC4)>=4))
REPEAT _ERR_REF_A _ERR_REF_E
IF ((_MEA_KIN_MODE[0] _DEC1)==4)
_CORR_VECT[0]=_CORR_VECT[0]-_OVR[110]
IF ((_CARR36<>"")AND(_CARR23==24))
ENDIF
ENDIF
IF ((_MEA_KIN_MODE[0] _DEC1)==5)
_CORR_VECT[1]=_CORR_VECT[1]-_OVR[111]
IF ((_CARR36<>"")AND(_CARR23==24))
ENDIF
ENDIF
IF ((_MEA_KIN_MODE[0] _DEC1)==6)
_CORR_VECT[2]=_CORR_VECT[2]-_OVR[112]
IF ((_CARR36<>"")AND(_CARR23==24))
_VAR[3,6]=$AC_TRAFO_CORR_ELEM_T[2,2]
_CORR_VECT[2]=_CORR_VECT[2]-_VAR[3,6]+_OVR[113]
ENDIF
ENDIF
ENDIF
IF (_PROT AND ((_M_VAR _DEC1)==4))
IF ((_M_VAR1 _DEC4)>=4)
WRITE(_LOG,_SN[0],";REF $AC_TRAFO_CORR_ELEM_T(new)="<<_VAR[3,6]<<" (old)="<<_OVR[113]<<" DIFF GS="<<_OVR[112])
ENDIF
WRITE(_LOG,_SN[0],";_CORR_VECT= "<<_CORR_VECT[0]<<"  "<<_CORR_VECT[1]<<"  "<<_CORR_VECT[2]<<" _CORR_INDEX= "<<_CORR_INDEX<<" _CORR_MODE= "<<_CORR_MODE<<" _ACALC="<<_ACALC<<" $AC_MEAS_RESULTS[9]="<<$AC_MEAS_RESULTS[9])
ENDIF
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
IF ((_CORR_STATUS>0)AND(_CORR_STATUS<>41))
_NO_ALARM=0
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF ((_CORR_STATUS==0)AND(((_M_VAR1 _DEC4)MOD 2)==0))
TRAFOOF
NEWCONF
TRAFOON($NT_NAME[_TC-1000])
STOPRE
REPEAT _CORR_R1A _CORR_R2E
_NO_ALARM=0
_CORR_VECT[0]=_VAR[3,0] _CORR_VECT[1]=_VAR[3,1] _CORR_VECT[2]=_VAR[3,2]
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
IF (_CORR_STATUS==41)
FOR _I=0 TO 2
_OVR[_I+114]=(TRUNC(_CORR_VECT[_I]*_MD10200_MM)/_MD10200_MM)
ENDFOR
IF (_CARR36<>"")
_CORR_INDEX=_CORR_M[1] _CORR_MODE=_CORR_M[2] _NO_ALARM=0 _OVI[9]=62317
_CORR_VECT[0]=_VAR[3,3] _CORR_VECT[1]=_VAR[3,4] _CORR_VECT[2]=_VAR[3,5]
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
_SERR=<<_CARR34<<" AXIS: "<<_CARR35 _OVI[9]=62317
GOTOF _ERR17A
ELSE
IF ((_CORR_M[0]==0)AND(((_M_VAR1 _DEC4)MOD 2)==0))
IF (_CARR36<>"")
_CORR_INDEX=_CORR_M[1] _CORR_MODE=_CORR_M[2] _NO_ALARM=0
_CORR_VECT[0]=_VAR[3,3] _CORR_VECT[1]=_VAR[3,4] _CORR_VECT[2]=_VAR[3,5]
_CORR_STATUS = CORRTRAFO(_CORR_VECT, _CORR_INDEX, _CORR_MODE, _NO_ALARM)
ENDIF
ENDIF
ENDIF
ENDIF
TRAFOOF
NEWCONF
TRAFOON($NT_NAME[_TC-1000])
STOPRE
IF (((_M_VAR1 _DEC4)MOD 2)==1)
_CORR_R1A:
IF (_CARR23==24)
_OVR[21]=$AC_TRAFO_CORR_ELEM_T[1,0] _OVR[22]=$AC_TRAFO_CORR_ELEM_T[1,1] _OVR[23]=$AC_TRAFO_CORR_ELEM_T[1,2]
ENDIF
IF (_CARR23==56)
_OVR[21]=$AC_TRAFO_CORR_ELEM_P[0,0] _OVR[22]=$AC_TRAFO_CORR_ELEM_P[0,1] _OVR[23]=$AC_TRAFO_CORR_ELEM_P[0,2]
ENDIF
IF (_CARR23==40)
_OVR[21]=$AC_TRAFO_CORR_ELEM_P[0,0] _OVR[22]=$AC_TRAFO_CORR_ELEM_P[0,1] _OVR[23]=$AC_TRAFO_CORR_ELEM_P[0,2]
ENDIF
_CORR_R2A:
IF (_CARR36<>"")
IF (_CARR23==24)
_OVR[24]=$AC_TRAFO_CORR_ELEM_T[2,0] _OVR[25]=$AC_TRAFO_CORR_ELEM_T[2,1] _OVR[26]=$AC_TRAFO_CORR_ELEM_T[2,2]
ENDIF
IF (_CARR23==56)
_OVR[24]=$AC_TRAFO_CORR_ELEM_T[1,0] _OVR[25]=$AC_TRAFO_CORR_ELEM_T[1,1] _OVR[26]=$AC_TRAFO_CORR_ELEM_T[1,2]
ENDIF
IF (_CARR23==40)
_OVR[21]=$AC_TRAFO_CORR_ELEM_P[1,0] _OVR[22]=$AC_TRAFO_CORR_ELEM_P[1,1] _OVR[23]=$AC_TRAFO_CORR_ELEM_P[1,2]
_OVR[24]=$AC_TRAFO_CORR_ELEM_P[0,0] _OVR[25]=$AC_TRAFO_CORR_ELEM_P[0,1] _OVR[26]=$AC_TRAFO_CORR_ELEM_P[0,2]
ENDIF
ENDIF
_CORR_R2E:
ENDIF
FOR _I=21 TO 26
_OVR[_I]=(TRUNC(_OVR[_I]*_MD10200_MM)/_MD10200_MM)
ENDFOR
IF (_PROT AND ((_M_VAR _DEC1)==4))
WRITE(_LOG,_SN[0],";new TRAFO KC")
IF $NT_CORR_ELEM_T[_NT_NO,0]<>""
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[0]= "<<$AC_TRAFO_CORR_ELEM_T[0,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[0,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[0,2])
ENDIF
IF $NT_CORR_ELEM_T[_NT_NO,1]<>""
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[1]= "<<$AC_TRAFO_CORR_ELEM_T[1,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[1,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[1,2])
ENDIF
IF $NT_CORR_ELEM_T[_NT_NO,2]<>""
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_T[2]= "<<$AC_TRAFO_CORR_ELEM_T[2,0]<<"  "<<$AC_TRAFO_CORR_ELEM_T[2,1]<<"  "<<$AC_TRAFO_CORR_ELEM_T[2,2])
ENDIF
IF $NT_CORR_ELEM_P[_NT_NO,0]<>""
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[0]= "<<$AC_TRAFO_CORR_ELEM_P[0,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[0,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[0,2])
ENDIF
IF $NT_CORR_ELEM_P[_NT_NO,1]<>""
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[1]= "<<$AC_TRAFO_CORR_ELEM_P[1,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[1,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[1,2])
ENDIF
IF $NT_CORR_ELEM_P[_NT_NO,2]<>""
WRITE(_LOG,_SN[0],";$AC_TRAFO_CORR_ELEM_P[2]= "<<$AC_TRAFO_CORR_ELEM_P[2,0]<<"  "<<$AC_TRAFO_CORR_ELEM_P[2,1]<<"  "<<$AC_TRAFO_CORR_ELEM_P[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[0]= "<<$AC_TRAFO_SECTION_T[0,0]<<"  "<<$AC_TRAFO_SECTION_T[0,1]<<"  "<<$AC_TRAFO_SECTION_T[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[1]= "<<$AC_TRAFO_SECTION_T[1,0]<<"  "<<$AC_TRAFO_SECTION_T[1,1]<<"  "<<$AC_TRAFO_SECTION_T[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[2]= "<<$AC_TRAFO_SECTION_T[2,0]<<"  "<<$AC_TRAFO_SECTION_T[2,1]<<"  "<<$AC_TRAFO_SECTION_T[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_T[3,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_T[3]= "<<$AC_TRAFO_SECTION_T[3,0]<<"  "<<$AC_TRAFO_SECTION_T[3,1]<<"  "<<$AC_TRAFO_SECTION_T[3,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[0,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[0]= "<<$AC_TRAFO_SECTION_P[0,0]<<"  "<<$AC_TRAFO_SECTION_P[0,1]<<"  "<<$AC_TRAFO_SECTION_P[0,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[1,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[1]= "<<$AC_TRAFO_SECTION_P[1,0]<<"  "<<$AC_TRAFO_SECTION_P[1,1]<<"  "<<$AC_TRAFO_SECTION_P[1,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[2,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[2]= "<<$AC_TRAFO_SECTION_P[2,0]<<"  "<<$AC_TRAFO_SECTION_P[2,1]<<"  "<<$AC_TRAFO_SECTION_P[2,2])
ENDIF
IF ISVAR("$AC_TRAFO_SECTION_P[3,0]")
WRITE(_LOG,_SN[0],";$AC_TRAFO_SECTION_P[3]= "<<$AC_TRAFO_SECTION_P[3,0]<<"  "<<$AC_TRAFO_SECTION_P[3,1]<<"  "<<$AC_TRAFO_SECTION_P[3,2])
ENDIF
WRITE(_LOG,_SN[0],";----------end")
ENDIF
ELSE
IF (_M9960==1)
_OVR[24]=$TC_CARR4[_TC]-_OVR[4] _OVR[25]=$TC_CARR5[_TC]-_OVR[5] _OVR[26]=$TC_CARR6[_TC]-_OVR[6]
_OVR[27]=$TC_CARR15[_TC]-_OVR[15] _OVR[28]=$TC_CARR16[_TC]-_OVR[16] _OVR[29]=$TC_CARR17[_TC]-_OVR[17]
FOR _I=21 TO 26
_OVR[_I]=(TRUNC(_OVR[_I]*_MD10200_MM)/_MD10200_MM)
ENDFOR
ENDIF
$TC_CARR1[_TC]=_OVR[1] $TC_CARR2[_TC]=_OVR[2] $TC_CARR3[_TC]=_OVR[3]
$TC_CARR4[_TC]=_OVR[4] $TC_CARR5[_TC]=_OVR[5] $TC_CARR6[_TC]=_OVR[6]
$TC_CARR15[_TC]=_OVR[15] $TC_CARR16[_TC]=_OVR[16] $TC_CARR17[_TC]=_OVR[17]
$TC_CARR18[_TC]=_OVR[18] $TC_CARR19[_TC]=_OVR[19] $TC_CARR20[_TC]=_OVR[20]
IF NOT ISVAR("$MC_TRAFO5_BASE_TOOL_1") GOTOF _M_TR1
IF (_CARR23==24)
$MC_TRAFO5_PART_OFFSET_1[0]=_OVR[1]
$MC_TRAFO5_PART_OFFSET_1[1]=_OVR[2]
$MC_TRAFO5_PART_OFFSET_1[2]=_OVR[3]
$MC_TRAFO5_JOINT_OFFSET_1[0]=_OVR[4]
$MC_TRAFO5_JOINT_OFFSET_1[1]=_OVR[5]
$MC_TRAFO5_JOINT_OFFSET_1[2]=_OVR[6]
$MC_TRAFO5_BASE_TOOL_1[0]=_OVR[15]
$MC_TRAFO5_BASE_TOOL_1[1]=_OVR[16]
$MC_TRAFO5_BASE_TOOL_1[2]=_OVR[17]
$MC_TRAFO5_JOINT_OFFSET_PART_1[0]=_OVR[18]
$MC_TRAFO5_JOINT_OFFSET_PART_1[1]=_OVR[19]
$MC_TRAFO5_JOINT_OFFSET_PART_1[2]=_OVR[20]
ENDIF
IF (_CARR23==40)
$MC_TRAFO5_JOINT_OFFSET_PART_1[0]=_OVR[1]
$MC_TRAFO5_JOINT_OFFSET_PART_1[1]=_OVR[2]
$MC_TRAFO5_JOINT_OFFSET_PART_1[2]=_OVR[3]
$MC_TRAFO5_BASE_TOOL_1[0]=_OVR[4]
$MC_TRAFO5_BASE_TOOL_1[1]=_OVR[5]
$MC_TRAFO5_BASE_TOOL_1[2]=_OVR[6]
$MC_TRAFO5_JOINT_OFFSET_1[0]=_OVR[15]
$MC_TRAFO5_JOINT_OFFSET_1[1]=_OVR[16]
$MC_TRAFO5_JOINT_OFFSET_1[2]=_OVR[17]
$MC_TRAFO5_PART_OFFSET_1[0]=_OVR[18]
$MC_TRAFO5_PART_OFFSET_1[1]=_OVR[19]
$MC_TRAFO5_PART_OFFSET_1[2]=_OVR[20]
ENDIF
IF (_CARR23==56)
$MC_TRAFO5_JOINT_OFFSET_1[0]=_OVR[1]
$MC_TRAFO5_JOINT_OFFSET_1[1]=_OVR[2]
$MC_TRAFO5_JOINT_OFFSET_1[2]=_OVR[3]
$MC_TRAFO5_BASE_TOOL_1[0]=_OVR[4]
$MC_TRAFO5_BASE_TOOL_1[1]=_OVR[5]
$MC_TRAFO5_BASE_TOOL_1[2]=_OVR[6]
$MC_TRAFO5_JOINT_OFFSET_PART_1[0]=_OVR[15]
$MC_TRAFO5_JOINT_OFFSET_PART_1[1]=_OVR[16]
$MC_TRAFO5_JOINT_OFFSET_PART_1[2]=_OVR[17]
$MC_TRAFO5_PART_OFFSET_1[0]=_OVR[18]
$MC_TRAFO5_PART_OFFSET_1[1]=_OVR[19]
$MC_TRAFO5_PART_OFFSET_1[2]=_OVR[20]
ENDIF
STOPRE
NEWCONF
ENDIF
_M_TR1:
ELSE
IF (((_M_VAR _DEC1)==4) AND (_M9960==1))
WRITE(_LOG,_SN[0],";Kinematik nur berechnen -> _OVR[1] .. _OVR[20]")
ENDIF
ENDIF
IF ((_M_VAR _DEC1)==4)
IF (ISVAR("VCS_ACTIVE_STATE") AND ISVAR("VCSROTVEC_VERIFICATION") AND (_TC<1001))
_FILE_VCS="/_N_CMA_DIR/_N_VCSROTVEC_SPF"
IF VCS_ACTIVE_STATE==1
IF VCSROTVEC_VERIFICATION==0
IF (ISFILE(_FILE_VCS))
DELETE(_LOG,_FILE_VCS)
ENDIF
WRITE(_LOG,_FILE_VCS,"[ROTV1]")
WRITE(_LOG,_FILE_VCS,<<_OVR[7]<<" "<<_OVR[8]<<" "<<_OVR[9])
WRITE(_LOG,_FILE_VCS,"[ROTV2]")
WRITE(_LOG,_FILE_VCS,<<_OVR[10]<<" "<<_OVR[11]<<" "<<_OVR[12])
WRITE(_LOG,_FILE_VCS,<<" ")
CCVCSREREAD()
ELSE
_FILE_VCS_VERIFI="/_N_CMA_DIR/_N_VCSROTVEC_VERIFI_SPF"
IF (ISFILE(_FILE_VCS_VERIFI))
DELETE(_LOG,_FILE_VCS_VERIFI)
ENDIF
WRITE(_LOG,_FILE_VCS_VERIFI,"//activ compensation for rotary axis orientation")
_I=1
WHILE (_LINE[0]<>" ") AND (_I<6)
READ(_LOG,_FILE_VCS,_I,_I,_LINE)
WRITE(_LOG,_FILE_VCS_VERIFI,<<_LINE[0])
_I=_I+1
ENDWHILE
WRITE(_LOG,_FILE_VCS_VERIFI,"//measured rotary axis orientation with active compensation")
WRITE(_LOG,_FILE_VCS_VERIFI,"[ROTV1]")
WRITE(_LOG,_FILE_VCS_VERIFI,<<_OVR[7]<<" "<<_OVR[8]<<" "<<_OVR[9])
WRITE(_LOG,_FILE_VCS_VERIFI,"[ROTV2]")
WRITE(_LOG,_FILE_VCS_VERIFI,<<_OVR[10]<<" "<<_OVR[11]<<" "<<_OVR[12])
WRITE(_LOG,_FILE_VCS_VERIFI,<<" ")
ENDIF
ENDIF
ENDIF
ENDIF
_OVI[2]=996
IF ((_M_VAR _DEC1)==4)
CUST_MEACYC(2)
ENDIF
_END:
IF _NEW_PAR
_CHBIT[25]=_CHBIT_S[25] _CHBIT[26]=_CHBIT_S[26] _CHBIT[28]=_CHBIT_S[28] _CHBIT[29]=_CHBIT_S[29]
ENDIF
S_PROTSTAT[0]=_PSTAT_0
IF (_T_ACT==0)
TRANS
IF ((_TRTYP[0])AND(_M9960==0))
TRAORI(_TRTYP[0])
ENDIF
IF _TRTYP[1]
TCARR=_TRTYP[1]
ENDIF
G[8]=_NV_ACT
ENDIF
M17
_VMA:
FOR _I=5 TO 7
IF (ABS(_VAR[6,_I+1]) < 0.000001)
_VAR[6,_I+1]=0
ENDIF
IF (ABS(_VAR[8,_I]) < 0.000001)
_VAR[8,_I]=0
ENDIF
ENDFOR
IF _RAX[0]==1
_RG[4]=_OVR[60]-_RG[14] _RG[5]=_OVR[61]-_RG[14] _RG[6]=_OVR[62]-_RG[14]
ENDIF
IF _RAX[0]==2
_RG[4]=_OVR[63]-_RG[15] _RG[5]=_OVR[64]-_RG[15] _RG[6]=_OVR[65]-_RG[15]
ENDIF
_RG[3]=(((_RG[6]-_RG[4]) MOD 360)+360)MOD 360
_RG[2]=(((_RG[5]-_RG[4]) MOD 360)+360)MOD 360
IF ((_RG[3]<_RG[2])AND(_ACALC==0))
IF ((_CARR23==56) AND (_RAX[0]==1))
_VAR[6,6]=-_VAR[6,6] _VAR[6,7]=-_VAR[6,7] _VAR[6,8]=-_VAR[6,8]
ENDIF
IF (_CARR23==24)
_VAR[6,6]=-_VAR[6,6] _VAR[6,7]=-_VAR[6,7] _VAR[6,8]=-_VAR[6,8]
ENDIF
IF ((_CARR23==40) OR ((_CARR23==56) AND (_RAX[0]==2)))
_VAR[6,6]=-_VAR[6,6] _VAR[6,7]=-_VAR[6,7] _VAR[6,8]=-_VAR[6,8]
ENDIF
ENDIF
IF ((_M9960==1) AND (_CARR23==56))
IF(_RAX[0]==2)
_VAR[8,7]=_VAR[8,7]+_L1
ELSE
_VAR[8,7]=_VAR[8,7]-_L1
ENDIF
ENDIF
IF (_M9960==0)
_L1_CALC=1
IF ((_RAX[0]==1))
_RG[0]=ABS($TC_CARR7[_TC]) _RG[1]=ABS($TC_CARR8[_TC]) _RG[2]=ABS($TC_CARR9[_TC])
IF ((_G17_18_19==1) AND ((_RG[0]+_RG[1])==0)) OR ((_G17_18_19==2) AND ((_RG[0]+_RG[2])==0)) OR ((_G17_18_19==3) AND ((_RG[1]+_RG[2])==0))
_L1_CALC=0
ENDIF
ENDIF
IF (((_CARR23==24) AND (_L1_CALC==1)) OR ((_CARR23==56) AND (_RAX[0]==1)))
_VAR[8,7]=_VAR[8,7]+_L1
ENDIF
ENDIF
IF (_RAX[0]==1)
_VAR[1,0]=_VAR[6,6] _VAR[1,1]=_VAR[6,7] _VAR[1,2]=_VAR[6,8]
_OVR[32]=_VAR[8,5] _OVR[33]=_VAR[8,6] _OVR[34]=_VAR[8,7]
ENDIF
IF (_RAX[0]==2)
_VAR[1,3]=_VAR[6,6] _VAR[1,4]=_VAR[6,7] _VAR[1,5]=_VAR[6,8]
_OVR[35]=_VAR[8,5] _OVR[36]=_VAR[8,6] _OVR[37]=_VAR[8,7]
ENDIF
_VME:
_VEA:
IF (_RAX[0]==1)
IF(_G17_18_19==1)
_OVR[7]=_VAR[1,0] _OVR[8]=_VAR[1,1] _OVR[9]=_VAR[1,2]
ELSE
_VAR[9,5]=_VAR[8,5] _VAR[9,6]=_VAR[8,6] _VAR[9,7]=_VAR[8,7]
IF(_G17_18_19==2)
_OVR[7]=_VAR[1,1] _OVR[8]=_VAR[1,2] _OVR[9]=_VAR[1,0]
_VAR[8,5]=_VAR[9,6] _VAR[8,6]=_VAR[9,7] _VAR[8,7]=_VAR[9,5]
ELSE
_OVR[7]=_VAR[1,2] _OVR[8]=_VAR[1,0] _OVR[9]=_VAR[1,1]
_VAR[8,5]=_VAR[9,7] _VAR[8,6]=_VAR[9,5] _VAR[8,7]=_VAR[9,6]
ENDIF
ENDIF
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H200')
_CAL[0]=_OVR[7] _CAL[1]=_OVR[8] _CAL[2]=_OVR[9]
_OVR[98]=_OVR[7] _OVR[99]=_OVR[8] _OVR[100]=_OVR[9]
_H_216=4
CYCLE216(_CAL,_H_216)
_OVR[7]=_CAL[3] _OVR[8]=_CAL[4] _OVR[9]=_CAL[5]
ENDIF
_CAL[0]=_OVR[7] _CAL[1]=_OVR[8] _CAL[2]=_OVR[9]
IF _TC >= 1001
_CAL[3]=_VAR[2,0] _CAL[4]=_VAR[2,1] _CAL[5]=_VAR[2,2]
ELSE
_CAL[3]=$TC_CARR7[_TC] _CAL[4]=$TC_CARR8[_TC]_CAL[5]=$TC_CARR9[_TC]
ENDIF
_H_216=3
CYCLE216(_CAL,_H_216)
IF _CAL[12]==0
FOR _I=0 TO 8
_OVR[_I+80]=_CAL[_I]
ENDFOR
_OVR[78]=_CAL[9]
ENDIF
ENDIF
IF (_RAX[0]==2)
IF(_G17_18_19==1)
_OVR[10]=_VAR[1,3] _OVR[11]=_VAR[1,4] _OVR[12]=_VAR[1,5]
ELSE
_VAR[9,5]=_VAR[8,5] _VAR[9,6]=_VAR[8,6] _VAR[9,7]=_VAR[8,7]
IF(_G17_18_19==2)
_OVR[10]=_VAR[1,4] _OVR[11]=_VAR[1,5] _OVR[12]=_VAR[1,3]
_VAR[8,5]=_VAR[9,6] _VAR[8,6]=_VAR[9,7] _VAR[8,7]=_VAR[9,5]
ELSE
_OVR[10]=_VAR[1,5] _OVR[11]=_VAR[1,3] _OVR[12]=_VAR[1,4]
_VAR[8,5]=_VAR[9,7] _VAR[8,6]=_VAR[9,5] _VAR[8,7]=_VAR[9,6]
ENDIF
ENDIF
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H200')
_CAL[0]=_OVR[10] _CAL[1]=_OVR[11] _CAL[2]=_OVR[12]
_OVR[101]=_OVR[10] _OVR[102]=_OVR[11] _OVR[103]=_OVR[12]
_H_216=4
CYCLE216(_CAL,_H_216)
_OVR[10]=_CAL[3] _OVR[11]=_CAL[4] _OVR[12]=_CAL[5]
ENDIF
_CAL[0]=_OVR[10] _CAL[1]=_OVR[11] _CAL[2]=_OVR[12]
IF _TC >= 1001
_CAL[3]=_VAR[2,3] _CAL[4]=_VAR[2,4] _CAL[5]=_VAR[2,5]
ELSE
_CAL[3]=$TC_CARR10[_TC] _CAL[4]=$TC_CARR11[_TC]_CAL[5]=$TC_CARR12[_TC]
ENDIF
_H_216=3
CYCLE216(_CAL,_H_216)
IF _CAL[12]==0
FOR _I=0 TO 8
_OVR[_I+89]=_CAL[_I]
ENDFOR
_OVR[79]=_CAL[9]
ENDIF
ENDIF
_VEE:
_PRA_1:
WRITE(_LOG,_SN[0],";new TCARR="<<_TC<<" "<<_CARR34)
WRITE(_LOG,_SN[0],""<<_SN[1]<<"1["<<_TC<<"]="<<_OVR[1]<<_SN[1]<<"2["<<_TC<<"]="<<_OVR[2]<<_SN[1]<<"3["<<_TC<<"]="<<_OVR[3]<<" ;I1xyz")
_PRE_1:
WRITE(_LOG,_SN[0],""<<_SN[1]<<"4["<<_TC<<"]="<<_OVR[4]<<_SN[1]<<"5["<<_TC<<"]="<<_OVR[5]<<_SN[1]<<"6["<<_TC<<"]="<<_OVR[6]<<" ;I2xyz")
_PRE_2:
WRITE(_LOG,_SN[0],";"<<_SN[1]<<"7["<<_TC<<"]="<<_OVR[7]<<_SN[1]<<"8["<<_TC<<"]="<<_OVR[8]<<_SN[1]<<"9["<<_TC<<"]="<<_OVR[9]<<" ;V1xyz")
_PRE_V1:
WRITE(_LOG,_SN[0],";"<<_SN[1]<<"10["<<_TC<<"]="<<_OVR[10]<<_SN[1]<<"11["<<_TC<<"]="<<_OVR[11]<<_SN[1]<<"12["<<_TC<<"]="<<_OVR[12]<<" ;V2xyz")
_PRE_V2:
WRITE(_LOG,_SN[0],""<<_SN[1]<<"15["<<_TC<<"]="<<_OVR[15]<<_SN[1]<<"16["<<_TC<<"]="<<_OVR[16]<<_SN[1]<<"17["<<_TC<<"]="<<_OVR[17]<<" ;I3xyz")
_PRE_3:
WRITE(_LOG,_SN[0],""<<_SN[1]<<"18["<<_TC<<"]="<<_OVR[18]<<_SN[1]<<"19["<<_TC<<"]="<<_OVR[19]<<_SN[1]<<"20["<<_TC<<"]="<<_OVR[20]<<" ;I4xyz")
_PRE_4:
_PRA_T:
WRITE(_LOG,_SN[0],";new TRAORI(1)")
IF (_CARR23==24)
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[0]="<<_OVR[1]<<" ;T I1xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[1]="<<_OVR[2])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[2]="<<_OVR[3])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[0]="<<_OVR[4]<<" ;I2xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[1]="<<_OVR[5])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[2]="<<_OVR[6])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[0]="<<_OVR[15]<<" ;I3xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[1]="<<_OVR[16])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[2]="<<_OVR[17])
ENDIF
IF (_CARR23==40)
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[0]="<<_OVR[4]<<" ;P I2xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[1]="<<_OVR[5])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[2]="<<_OVR[6])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[0]="<<_OVR[15]<<" ;I3xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[1]="<<_OVR[16])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[2]="<<_OVR[17])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[0]="<<_OVR[18]<<" ;I4xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[1]="<<_OVR[19])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[2]="<<_OVR[20])
ENDIF
IF (_CARR23==56)
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[0]="<<_OVR[1]<<" ;M I1xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[1]="<<_OVR[2])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_1"<<"[2]="<<_OVR[3])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[0]="<<_OVR[4]<<" ;I2xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[1]="<<_OVR[5])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"BASE_TOOL_1"<<"[2]="<<_OVR[6])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_PART_1"<<"[0]="<<_OVR[15]<<" ;I3xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_PART_1"<<"[1]="<<_OVR[16])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"JOINT_OFFSET_PART_1"<<"[2]="<<_OVR[17])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[0]="<<_OVR[18]<<" ;I4xyz")
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[1]="<<_OVR[19])
WRITE(_LOG,_SN[0],""<<_SN[2]<<"PART_OFFSET_1"<<"[2]="<<_OVR[20])
ENDIF
WRITE(_LOG,_SN[0],";"<<_SN[2]<<"AXIS1_1"<<"[0]="<<_OVR[7]<<" ;V1xyz")
WRITE(_LOG,_SN[0],";"<<_SN[2]<<"AXIS1_1"<<"[1]="<<_OVR[8])
WRITE(_LOG,_SN[0],";"<<_SN[2]<<"AXIS1_1"<<"[2]="<<_OVR[9])
WRITE(_LOG,_SN[0],";"<<_SN[2]<<"AXIS2_1"<<"[0]="<<_OVR[10]<<" ;V2xyz")
WRITE(_LOG,_SN[0],";"<<_SN[2]<<"AXIS2_1"<<"[1]="<<_OVR[11])
WRITE(_LOG,_SN[0],";"<<_SN[2]<<"AXIS2_1"<<"[2]="<<_OVR[12])
_PRE_T:
_PROA:
WRITE(_LOG,_SN[0],";old TCARR="<<_TC<<" "<<_CARR34)
WRITE(_LOG,_SN[0],"$TC_CARR1["<<_TC<<"]="<<$TC_CARR1[_TC]<<" $TC_CARR2["<<_TC<<"]="<<$TC_CARR2[_TC]<<" $TC_CARR3["<<_TC<<"]="<<$TC_CARR3[_TC])
WRITE(_LOG,_SN[0],"$TC_CARR4["<<_TC<<"]="<<$TC_CARR4[_TC]<<" $TC_CARR5["<<_TC<<"]="<<$TC_CARR5[_TC]<<" $TC_CARR6["<<_TC<<"]="<<$TC_CARR6[_TC])
WRITE(_LOG,_SN[0],";$TC_CARR7["<<_TC<<"]="<<$TC_CARR7[_TC]<<" $TC_CARR8["<<_TC<<"]="<<$TC_CARR8[_TC]<<" $TC_CARR9["<<_TC<<"]="<<$TC_CARR9[_TC])
WRITE(_LOG,_SN[0],";$TC_CARR10["<<_TC<<"]="<<$TC_CARR10[_TC]<<" $TC_CARR11["<<_TC<<"]="<<$TC_CARR11[_TC]<<" $TC_CARR12["<<_TC<<"]="<<$TC_CARR12[_TC])
WRITE(_LOG,_SN[0],"$TC_CARR15["<<_TC<<"]="<<$TC_CARR15[_TC]<<" $TC_CARR16["<<_TC<<"]="<<$TC_CARR16[_TC]<<" $TC_CARR17["<<_TC<<"]="<<$TC_CARR17[_TC])
WRITE(_LOG,_SN[0],"$TC_CARR18["<<_TC<<"]="<<$TC_CARR18[_TC]<<" $TC_CARR19["<<_TC<<"]="<<$TC_CARR19[_TC]<<" $TC_CARR20["<<_TC<<"]="<<$TC_CARR20[_TC])
WRITE(_LOG,_SN[0],";----------")
_PROE:
WRITE(_LOG,_SN[0],";old TRAORI(1)")
WRITE(_LOG,_SN[0],"$MC_TRAFO5_BASE_TOOL_1[0]="<<$MC_TRAFO5_BASE_TOOL_1[0])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_BASE_TOOL_1[1]="<<$MC_TRAFO5_BASE_TOOL_1[1])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_BASE_TOOL_1[2]="<<$MC_TRAFO5_BASE_TOOL_1[2])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_JOINT_OFFSET_1[0]="<<$MC_TRAFO5_JOINT_OFFSET_1[0])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_JOINT_OFFSET_1[1]="<<$MC_TRAFO5_JOINT_OFFSET_1[1])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_JOINT_OFFSET_1[2]="<<$MC_TRAFO5_JOINT_OFFSET_1[2])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_PART_OFFSET_1[0]="<<$MC_TRAFO5_PART_OFFSET_1[0])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_PART_OFFSET_1[1]="<<$MC_TRAFO5_PART_OFFSET_1[1])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_PART_OFFSET_1[2]="<<$MC_TRAFO5_PART_OFFSET_1[2])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_JOINT_OFFSET_PART_1[0]="<<$MC_TRAFO5_JOINT_OFFSET_PART_1[0])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_JOINT_OFFSET_PART_1[1]="<<$MC_TRAFO5_JOINT_OFFSET_PART_1[1])
WRITE(_LOG,_SN[0],"$MC_TRAFO5_JOINT_OFFSET_PART_1[2]="<<$MC_TRAFO5_JOINT_OFFSET_PART_1[2])
WRITE(_LOG,_SN[0],";$MC_TRAFO5_AXIS1_1[0]="<<$MC_TRAFO5_AXIS1_1[0])
WRITE(_LOG,_SN[0],";$MC_TRAFO5_AXIS1_1[1]="<<$MC_TRAFO5_AXIS1_1[1])
WRITE(_LOG,_SN[0],";$MC_TRAFO5_AXIS1_1[2]="<<$MC_TRAFO5_AXIS1_1[2])
WRITE(_LOG,_SN[0],";$MC_TRAFO5_AXIS2_1[0]="<<$MC_TRAFO5_AXIS2_1[0])
WRITE(_LOG,_SN[0],";$MC_TRAFO5_AXIS2_1[1]="<<$MC_TRAFO5_AXIS2_1[1])
WRITE(_LOG,_SN[0],";$MC_TRAFO5_AXIS2_1[2]="<<$MC_TRAFO5_AXIS2_1[2])
_PRO_T:
_VCA:
IF (_RAX[0]==1)
_VAR[0,0]=_OVR[41] _VAR[0,1]=_OVR[42] _VAR[0,2]=_OVR[43]
_VAR[0,3]=_OVR[44] _VAR[0,4]=_OVR[45] _VAR[0,5]=_OVR[46]
_VAR[0,6]=_OVR[47] _VAR[0,7]=_OVR[48] _VAR[0,8]=_OVR[49]
FOR _I=0 TO 8
_CAL[_I]=_VAR[0,_I]
ENDFOR
ENDIF
IF (_RAX[0]==2)
_VAR[0,0]=_OVR[51] _VAR[0,1]=_OVR[52] _VAR[0,2]=_OVR[53]
_VAR[0,3]=_OVR[54] _VAR[0,4]=_OVR[55] _VAR[0,5]=_OVR[56]
_VAR[0,6]=_OVR[57] _VAR[0,7]=_OVR[58] _VAR[0,8]=_OVR[59]
ENDIF
_TR_LIM=ABS(_TNVL)/1.001
IF (_TR_LIM>60) OR ((_MVAR _DEC1)<>4)
_TR_LIM=0
ENDIF
_VCA1: $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XXA]=_VAR[0,0] $AA_MEAS_POINT1[_YYA]=_VAR[0,1] $AA_MEAS_POINT1[_ZZA]=_VAR[0,2]
$AA_MEAS_POINT2[_XXA]=_VAR[0,3] $AA_MEAS_POINT2[_YYA]=_VAR[0,4] $AA_MEAS_POINT2[_ZZA]=_VAR[0,5]
$AA_MEAS_POINT3[_XXA]=_VAR[0,6] $AA_MEAS_POINT3[_YYA]=_VAR[0,7] $AA_MEAS_POINT3[_ZZA]=_VAR[0,8]
$AC_MEAS_P1_COORD=0 $AC_MEAS_P2_COORD=0 $AC_MEAS_P3_COORD=0
$AC_MEAS_INPUT[0]=_TR_LIM
IF ISVAR("$MN_CC_ACTIVE_IN_CHAN_C996")
_CCM=$MN_CC_ACTIVE_IN_CHAN_C996[0]
IF _CCM
_INARRAY[0]=_VAR[0,0] _INARRAY[1]=_VAR[0,1] _INARRAY[2]=_VAR[0,2]
_INARRAY[3]=_VAR[0,3] _INARRAY[4]=_VAR[0,4] _INARRAY[5]=_VAR[0,5]
_INARRAY[6]=_VAR[0,6] _INARRAY[7]=_VAR[0,7] _INARRAY[8]=_VAR[0,8]
_INARRAY[9]=_TR_LIM
CC_MEASURE(_INARRAY,_OUTARRAY,_LOG)
_SERR=<<"CC Option ? "
IF _LOG==1 GOTOF _ERR9
ELSE
_SERR=<<"$MN_CC_ACTIVE_IN_CHAN_C996[0] ?"
GOTOF _ERR9
ENDIF
ELSE
IF ($AN_NCK_VERSION>=720000)
$AC_MEAS_TYPE=29
_LOG=MEASURE()
_SERR=<<"Licence ?"
IF _LOG==1 GOTOF _ERR9
ELSE
_SERR=<<"CC Option or Licence ?"
GOTOF _ERR9
ENDIF
ENDIF
IF ((_LOG==13)OR(_LOG==9))
IF (_RAX[0]==1)
_RG[5]=ABS($SCS_MEA_KIN_MIN_ANG_POS)
IF $MA_ROT_IS_MODULO[_RAX1]==1
_RG[2]=((_OVR[60] MOD 360)+360) MOD 360
_RG[3]=((_OVR[61] MOD 360)+360) MOD 360
ELSE
_RG[2]=_OVR[60]
_RG[3]=_OVR[61]
ENDIF
_ACALC=1
IF (_RG[2]>_RG[3])
IF ((_RG[2]- _RG[3]) < _RG[5])
_ACALC=0
ENDIF
ELSE
IF ((_RG[3]-_RG[2]) < _RG[5])
_ACALC=0
ENDIF
ENDIF
IF (_ACALC==1)
_LOG=0
ELSE
_SERR=<<"H SD55648 ?"
GOTOF _ERR9
ENDIF
ENDIF
IF (_ACALC==1)
_H_216=5
CYCLE216(_CAL,_H_216)
_SERR=<<"I "<<_H_216
IF (_H_216<>55) GOTOF _ERR9
_SERR=<<"I "<<_CAL[1]
IF (_CAL[1]>_MIN_L_TRIA) GOTOF _ERR9
ENDIF
ENDIF
IF _LOG
_SERR=<<"A "
IF _LOG==13 GOTOF _ERR9
IF _LOG==9 GOTOF _ERR9
_SERR=<<"B "
IF _LOG==3 GOTOF _ERR9
_SERR=<<"C "
IF _LOG==4 GOTOF _ERR9
_SERR=<<"D "
IF _LOG==5 GOTOF _ERR9
IF (_RAX[0]==1)
IF (_M9960==0)
_SERR=<<"G Axis:"<<_CARR35<<" ->TVLmin="<<$AC_MEAS_RESULTS[9]
ENDIF
ENDIF
IF (_RAX[0]==2)
IF (_M9960==0)
_SERR=<<"G Axis:"<<_CARR36<<" -> TVLmin="<<$AC_MEAS_RESULTS[9]
ENDIF
ENDIF
IF (_LOG==11)
IF _M9960==0 GOTOF _ERR9
IF _M9960==1 GOTOF _NEXT
ENDIF
_SERR=<<"? "<<_LOG
GOTOF _ERR9
_NEXT:
ENDIF
IF _CCM
_VAR[6,6]=_OUTARRAY[0] _VAR[6,7]=_OUTARRAY[1] _VAR[6,8]=_OUTARRAY[2]
_VAR[8,5]=_OUTARRAY[3]*_FAK2 _VAR[8,6]=_OUTARRAY[4]*_FAK2 _VAR[8,7]=_OUTARRAY[5]*_FAK2
ELSE
IF _ACALC==0
_VAR[6,6]=$AC_MEAS_RESULTS[0] _VAR[6,7]=$AC_MEAS_RESULTS[1] _VAR[6,8]=$AC_MEAS_RESULTS[2]
_VAR[8,5]=$AC_MEAS_RESULTS[3]*_FAK2 _VAR[8,6]=$AC_MEAS_RESULTS[4]*_FAK2 _VAR[8,7]=$AC_MEAS_RESULTS[5]*_FAK2
ELSE
_VAR[6,6]=_VAR[2,0] _VAR[6,7]=_VAR[2,1] _VAR[6,8]=_VAR[2,2]
_VAR[8,5]=_CAL[4] _VAR[8,6]=_CAL[5] _VAR[8,7]=_CAL[6]
_ACALC=0
ENDIF
ENDIF
_VCE:
_VNA:
IF _NEW_PAR
IF _DMODE==3
IF _NAX==3
_NAX=1
ELSE
IF _NAX==2
_NAX=3
ELSE
IF _NAX==1
_NAX=2
ENDIF
ENDIF
ENDIF
ENDIF
IF _DMODE==2
IF _NAX==1
_NAX=3
ELSE
IF _NAX==2
_NAX=1
ELSE
IF _NAX==3
_NAX=2
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_SERR=<<"E"
IF(_G17_18_19==1)
CASE (_NAX) OF 0 GOTOF CALCNO 1 GOTOF CALCPX 2 GOTOF CALCPY 3 GOTOF CALCPZ DEFAULT GOTOF _ERR9
ELSE
IF(_G17_18_19==2)
CASE (_NAX) OF 0 GOTOF CALCNO 1 GOTOF CALCPY 2 GOTOF CALCPZ 3 GOTOF CALCPX DEFAULT GOTOF _ERR9
ELSE
CASE (_NAX) OF 0 GOTOF CALCNO 1 GOTOF CALCPZ 2 GOTOF CALCPX 3 GOTOF CALCPY DEFAULT GOTOF _ERR9
ENDIF
ENDIF
CALCNO:
_VAR[8,5]=_VAR[6,0] _VAR[8,6]=_VAR[6,1] _VAR[8,7]=_VAR[6,2]
GOTOF _VNE
CALCPX:
_VAR[8,5]=_VAR[8,8]
IF (_VAR[6,3]==0)
IF ((_PROT)AND(_M9960==1))
WRITE(_LOG,_SN[0],";Lage der Drehachse lsst den gewhlten Schnittpunkt in der X-Orientierung nicht zu, originaler Stuetzpunkt beibehalten")
ENDIF
GOTOB CALCNO
ENDIF
_VAR[8,6]=_VAR[6,1]+((_VAR[8,5]-_VAR[6,0])/_VAR[6,3])*_VAR[6,4]
_VAR[8,7]=_VAR[6,2]+((_VAR[8,5]-_VAR[6,0])/_VAR[6,3])*_VAR[6,5]
GOTOF _VNE
CALCPY:
_VAR[8,6]=_VAR[8,8]
IF (_VAR[6,4]==0)
IF ((_PROT)AND(_M9960==1))
WRITE(_LOG,_SN[0],";Lage der Drehachse lsst den gewhlten Schnittpunkt in der Y-Orientierung nicht zu, originaler Stuetzpunkt beibehalten")
ENDIF
GOTOB CALCNO
ENDIF
_VAR[8,5]=_VAR[6,0]+((_VAR[8,6]-_VAR[6,1])/_VAR[6,4])*_VAR[6,3]
_VAR[8,7]=_VAR[6,2]+((_VAR[8,6]-_VAR[6,1])/_VAR[6,4])*_VAR[6,5]
GOTOF _VNE
CALCPZ:
_VAR[8,7]=_VAR[8,8]
IF (_VAR[6,5]==0)
IF ((_PROT)AND(_M9960==1))
WRITE(_LOG,_SN[0],";Lage der Drehachse lsst den gewhlten Schnittpunkt in der Z-Orientierung nicht zu, originaler Stuetzpunkt beibehalten")
ENDIF
GOTOB CALCNO
ENDIF
_VAR[8,5]=_VAR[6,0]+((_VAR[8,7]-_VAR[6,2])/_VAR[6,5])*_VAR[6,3]
_VAR[8,6]=_VAR[6,1]+((_VAR[8,7]-_VAR[6,2])/_VAR[6,5])*_VAR[6,4]
_VNE:
_ERR_REF_A:
_SERR=<<"(D REF?)"
IF (_OVR[104]<=0) GOTOF _ERR20
_SERR=<<"(E REF Workoffset?)"
IF _NV_ACT==0 GOTOF _ERR20
_SERR=<<"(F REF Workoffset?)"
IF ((_OVR[104]+1)<>_NV_ACT)GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_XX)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_XX,TR]*1000)/1000) <> _OVR[107]) GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_YY)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_YY,TR]*1000)/1000) <> _OVR[108]) GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_ZZ)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_ZZ,TR]*1000)/1000) <> _OVR[109]) GOTOF _ERR20
IF $MN_MM_FRAME_FINE_TRANS
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_XX)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_XX,FI]*1000)/1000) <> 0) GOTOF _ERR20
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_YY)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_YY,FI]*1000)/1000) <> 0) GOTOF _ERR20
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_ZZ)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_ZZ,FI]*1000)/1000) <> 0) GOTOF _ERR20
ENDIF
_SERR=<<" I HEAD REF $SD_MEA_KIN_MODE[0]=?"<<_MEA_KIN_MODE[0]
IF (_MEA_KIN_MODE[0]<4) GOTOF _ERR20
_ERR_REF_E:
_ERR0: STOPRE
_OVI[9]=61421
N699600 SETAL(61421,_SERR)
RET
_ERR1: STOPRE
_OVI[9]=61422
N699601 SETAL(61422,_SERR)
RET
_ERR2: STOPRE
_OVI[9]=61423
N699602 SETAL(61423,_SERR)
RET
_ERR3: STOPRE
_OVI[9]=61424
SETAL(61424,_SERR)
RET
_ERR4: STOPRE
_OVI[9]=61425
N699604 SETAL(61425,_SERR)
RET
_ERR5: STOPRE
_OVI[9]=61426
N699605 SETAL(61426,_SERR)
RET
_ERR6: STOPRE
_OVI[9]=61427
N699606 SETAL(61427,_SERR)
RET
_ERR7: STOPRE
_OVI[9]=61428
N699607 SETAL(61428,_SERR)
RET
_ERR8: STOPRE
_OVI[9]=61429
N699608 SETAL(61429,_SERR)
RET
_ERR9: STOPRE
_OVI[9]=61430
N699609 SETAL(61430,_SERR)
RET
_ERR10: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N699610 SETAL(_ALARM,_SERR)
RET
_ERR11: _ALARM=61167 _OVI[9]=_ALARM
STOPRE
N699611 SETAL(_ALARM,_SERR)
RET
_ERR12: _ALARM=61383 _OVI[9]=_ALARM
STOPRE
N699612 SETAL(_ALARM,_SERR)
RET
_ERR13: _ALARM=61384 _OVI[9]=_ALARM
STOPRE
N699613 SETAL(_ALARM,_SERR)
RET
_ERR14: STOPRE
_OVI[9]=61431
N699614 SETAL(61431,_SERR)
RET
_ERR15: _ALARM=61071 _OVI[9]=_ALARM
STOPRE
N699615 SETAL(_ALARM,_SERR)
RET
_ERR99: STOPRE
_OVI[9]=61099
N699699 SETAL(61099,_SERR)
_ERR17: STOPRE
N699617 SETAL(62317,_SERR)
M0
_ERR17A: RET
_ERR18: STOPRE
N699618 SETAL(62318,_SERR)
M0
RET
_ERR19: STOPRE
_OVI[9]=61019
N699619 SETAL(61019,_SERR)
RET
_ERR20: STOPRE
N699620 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE9960_SPF
PROC CYCLE9960(INT S_MVAR,STRING[40] S_TNAME,INT S_PRNUM,REAL S_SETV,REAL S_SETV1,REAL S_START_RA1,REAL S_END_RA1,INT S_CMEA_RA1,REAL S_POS_RA2,REAL S_SETV2,REAL S_START_RA2,REAL S_END_RA2,INT S_CMEA_RA2,REAL S_POS_RA1,REAL S_SETV4,REAL S_FA,REAL S_TSA,INT S_NMSP,INT S_DMODE,INT S_AMODE,INT S_KNUM,INT S_MEC_INDEX) SAVE SBLOF ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.011 ;DATE: 2024-06-05
;Measure Kinematic completed
;
DEF REAL _DISTANCE[2],_POS1,_POS2,_RA1_POS[146],_RA2_POS[146],_RA1_ZW_POS[12],_TRTYP[2],_S_POS[3],_POS[3],_TOFFL,_RA1_OFF,_RA2_OFF,_MAX[3],_MIN[3],_MOVR[10], _MEA_DIAM[145]
DEF REAL _DM_TOL,_RA_TOL,_OFF_RA1[3],_OFF_RA2[3],_GST[3],_DIR_RA1[3],_DIR_RA2[3],_ANG[2],_MOD_R,_MOD_S,_MEA_DIR[2],_LEN[11]
DEF REAL _CORR_ELEM_T[3],_NV_REF_DIFF[3],_E_START1, _E_END1, _E_START2, _E_END2,_E_MOD1,_E_MOD2, _CAL[44],_E_DATA[144,3],_LIM_M_RA1,_LIM_P_RA1,_LIM_M_RA2,_LIM_P_RA2
DEF REAL _SD41610,_SETV1,_GEO_MITTEL[3],_CORR_LAGE[2],_ROT_LAGE[2],_CORR_OLD[6],_NUM_RA[2],_DIR_RA[3], _CIRC[15],_OVR_REF[4],_ACTFR_1[3]
DEF REAL _FAK1,_FAK2,_FAK3,_DIR_RA1_CALC[3],_DIR_RA2_CALC[3],_WZ_L[3], _M_SPE[80]
DEF AXIS _XX,_YY,_ZZ,_RAX1,_RAX2,_RAX3,_XXA,_YYA,_ZZA,_XXCHAN,_YYCHAN,_ZZCHAN
DEF INT _I,_II,_III,_H,_ANZ,_ANZGES,_LOG,_TT=0,_SOVR,_TC,_CHAN_NR,_MVARC997,_MVAR_CALC,_TCNUM,_AMODEC996,_ALARM,_G17_18_19,_M_COMP,_E996_ACT,_NV_ACT,_TOL_ON,_M_PROTFORM[6],_M_PROTSTAT,_KIN_MODE[2],_TC_KIN,_ID_TOFFL,_OEM_AKT
DEF INT _SD55740_8, _SD55740_0,_SD55740_12, _H_ME, _KINTYP, _CMEA1, _CMEA2, _HIRTH, _HIRTH_STEP[2], _LOG_ON,_E_CMEA1,_E_CMEA2,_MODE, _GST1, _GST2,_SD54610[2],_MVARC976,_MD10200,_MVARC122,_MEA_RA[3],_MEC,_MEC_ACT,_MEC_TAB
DEF INT _M_N[40]
DEF BOOL _INTERN[70]
DEF STRING[128] _FILE_COMP, _FILE_COMP_OLD, _M_PROTNAME,_M_TXT,_FILE_VCS,_FILE_VCS_VERIFI
DEF STRING[255] _LINE[8]
DEF STRING[40] _KC, _SERR, _LOGFILE,_RA_NAME, _ACT_E996,_FILE_COMP_LOC
CYCLE210(0)
IF $MC_ORI_IPO_WITH_G_CODE==0
_SERR="$MC_ORI_IPO_WITH_G_CODE=1"
GOTOF _ERR3
ENDIF
_CHAN_NR=$P_CHANNO
_TC=_TCNUM
_SOVR=130
_ANZ=14
_FAK1=1 _FAK2=1 _FAK3=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF(($P_GG[13]==1) OR ($P_GG[13]==3))
_FAK2=1/$MN_SCALING_VALUE_INCH
IF($P_GG[13]==1)
_FAK1=1/$MN_SCALING_VALUE_INCH
ELSE
_FAK3=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ELSE
IF(($P_GG[13]==2) OR ($P_GG[13]==4))
_FAK2=$MN_SCALING_VALUE_INCH
IF($P_GG[13]==2)
_FAK1=$MN_SCALING_VALUE_INCH
ELSE
_FAK3=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
ENDIF
IF ((($P_TRAFO B_AND 'H2000') AND (($P_TRAFO_CHAIN[0] B_AND 'H1000') OR ($P_TRAFO_CHAIN[1] B_AND 'H1000'))) OR ($P_TRAFO B_AND 'H1000'))
_OEM_AKT=1
ENDIF
IF ISVAR("$MN_CC_ACTIVE_IN CHAN_ROBX")
IF $MN_CC_ACTIVE_IN_CHAN_ROBX[$P_CHANNO-1]
_OEM_AKT=1
ENDIF
ENDIF
IF $P_DRYRUN
_DM_TOL=0
ELSE
_DM_TOL=ABS($SCS_MEA_KIN_DM_TOL)
ENDIF
_RA_TOL=ABS($SN_CORR_TRAFO_DIR_MAX)
_LOGFILE="//NC:/_N_MPF_DIR/_N_LOG_CYCLE9960_"<<$P_CHANNO<<"_MPF"
_LOG_ON=ISFILE(_LOGFILE)
_MD10200=$MN_INT_INCR_PER_MM
_KIN_MODE[0]=SET($SCS_MEA_KIN_MODE[0],$SCS_MEA_KIN_MODE[1])
IF (($MNS_MEA_ACCESS_EXEC==1) AND ($MN_ACCESS_EXEC_CST==7))
_SERR=<<"01 MD11160"
IF $P_ACCESSLEVEL>1 GOTOF _ERR20
ENDIF
IF (S_MVAR _DEC4) <2
_MEA_MKS[0,0]=REP(0,125)
ENDIF
IF S_TNAME==""
_SERR=<<"S_TNAME = 0"
IF (($P_TRAFO==0) OR ($P_TRAFO>256))
GOTOF _ERR2
ENDIF
ELSE
IF ((ISVAR("NAMETOINT"))AND(ISVAR("$NT_NAME"))AND(ISVAR("$NT_IDENT")))
_TC=NAMETOINT("$NT_NAME",S_TNAME,TRUE)
IF _TC>0
_TC=_TC+1000
IF $P_TRAFO_PARSET<>_TC
IF $P_TRAFO_PARSET>1000
ENDIF
_SERR=<<S_TNAME
GOTOF _ERR2
ENDIF
ELSE
GOTOF _SEARCH_TCARR
ENDIF
GOTOF _NEXT
ENDIF
_SEARCH_TCARR:
_TCNUM=1
_SERR=<<S_TNAME
WHILE (TOUPPER($TC_CARR34[_TCNUM])<>TOUPPER(S_TNAME))
_TCNUM=_TCNUM+1
IF (_TCNUM>$P_TCNUM) GOTOF _ERR2
ENDWHILE
IF $P_TC<>_TCNUM GOTOF _ERR2
IF (($P_TRAFO>0) AND ($P_TRAFO<256))
_TRTYP[0]=$P_TRAFO_PARSET
ENDIF
_TRTYP[1]=$P_TC
IF ((_TRTYP[0]==0) AND (_TRTYP[1]==0)) GOTOF _ERR2
_NEXT:
ENDIF
IF _TC>=1001
_TCNUM=0
_KC=S_TNAME
_KINTYP=$P_TRAFO
_RA1_OFF=0 _RA2_OFF=0
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TC-1000,0],TRUE)
IF(_II>0)
_RA1_OFF=$NK_A_OFF[_II]
ENDIF
IF (AXSTRING($PC_TRAFO_ROT_CHAN_AX_IN[1])<>"")
_II=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TC-1000,1],TRUE)
IF(_II>0)
_RA2_OFF=$NK_A_OFF[_II]
ENDIF
ENDIF
_FAK3=1
ELSE
_TC=_TCNUM
_KC=""
_TC_KIN=($TC_CARR_KIN_CNTRL[_TC] B_AND 'B1')
IF _TC_KIN==0
_RA1_OFF=$TC_CARR24[_TCNUM]
_RA2_OFF=$TC_CARR25[_TCNUM]
ELSE
_RA1_OFF=$PC_TCARR_AX_OFFSET[1]
_RA2_OFF=$PC_TCARR_AX_OFFSET[2]
_FAK3=1
ENDIF
IF ($TC_CARR23[_TC]=="T")
_KINTYP=24
ENDIF
IF ($TC_CARR23[_TC]=="P")
_KINTYP=40
ENDIF
IF ($TC_CARR23[_TC]=="M")
_KINTYP=56
ENDIF
$TC_CARR21[_TC]=_XX
$TC_CARR22[_TC]=_XX
ENDIF
IF $P_TC AND _TC>1000
_SERR=<<"5 (KC + TC)"
GOTOF _ERR2
ENDIF
_G17_18_19=S_DMODE _DEC1
IF(_G17_18_19>0)AND($P_GG[6]<>_G17_18_19)
G[6]=_G17_18_19
ENDIF
_G17_18_19=$P_GG[6]
DIAMCYCOF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
_MEA_DIR[0]=SET(S_AMODE _DEC3, S_AMODE _DEC4)
_MEA_RA[0]=SET(1,1,0)
IF (S_MVAR _DEC1)==3
IF (S_MVAR _DEC5)==4
_MEA_RA[1]=0
ENDIF
IF (S_MVAR _DEC5)==5
_MEA_RA[0]=0
ENDIF
ENDIF
_MEC=0
IF $ON_COMP_MASK B_AND 'H200'
_MEC=1
ENDIF
IF $ON_COMP_MASK B_AND 'H400'
_MEC=2
ENDIF
IF $ON_COMP_MASK B_AND 'H800'
_MEC=3
ENDIF
IF (_TC>=1001)
_RAX1=$PC_TRAFO_ROT_CHAN_AX_IN[0]
_RAX2=$PC_TRAFO_ROT_CHAN_AX_IN[1]
IF (_KINTYP<>24)AND (AXSTRING(_RAX2)<>"NO_AXIS")
_CAL[0]=SET(S_START_RA1,S_END_RA1,S_CMEA_RA1,S_POS_RA1,S_SETV1,_MEA_RA[0],_MEA_RA[1])
S_START_RA1=S_START_RA2 S_END_RA1=S_END_RA2 S_CMEA_RA1=S_CMEA_RA2 S_POS_RA1=S_POS_RA2 S_SETV1=S_SETV2
S_START_RA2=_CAL[0] S_END_RA2=_CAL[1] S_CMEA_RA2=_CAL[2] S_POS_RA2=_CAL[3] S_SETV2=_CAL[4]
_MEA_RA[0]=SET(_CAL[6],_CAL[5])
_MEA_DIR[0]=SET(S_AMODE _DEC4, S_AMODE _DEC3)
ENDIF
ELSE
_RAX1=AXNAME($TC_CARR35[_TC])
IF $TC_CARR36[_TC]==""
_RAX2=NO_AXIS
ELSE
_RAX2=AXNAME($TC_CARR36[_TC])
ENDIF
ENDIF
IF (S_MVAR _DEC1)==3
IF _MEA_RA[1]==0
_RAX2=NO_AXIS
ENDIF
IF _MEA_RA[0]==0
S_START_RA1=S_START_RA2 S_END_RA1=S_END_RA2 S_CMEA_RA1=S_CMEA_RA2 S_POS_RA1=S_POS_RA2 S_SETV1=S_SETV2
_RAX1=_RAX2
_RAX2=NO_AXIS
_MEA_RA[0]=SET(1,0,1)
ENDIF
ENDIF
IF _TC>1000
_H=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TC-1000,0],TRUE)
_DIR_RA1[0]=SET($NK_OFF_DIR[_H,0],$NK_OFF_DIR[_H,1],$NK_OFF_DIR[_H,2])
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_H=NAMETOINT("$NK_NAME",$NT_ROT_AX_NAME[_TC-1000,1],TRUE)
_DIR_RA2[0]=SET($NK_OFF_DIR[_H,0],$NK_OFF_DIR[_H,1],$NK_OFF_DIR[_H,2])
ENDIF
ELSE
IF ($TC_CARR_KIN_CNTRL[_TC] B_AND 'B1')
_DIR_RA1[0]=SET($PC_TCARR_AX_VECT[1,0],$PC_TCARR_AX_VECT[1,1],$PC_TCARR_AX_VECT[1,2])
IF(AXSTRING(_RAX2)<>"NO_AXIS")
_DIR_RA2[0]=SET($PC_TCARR_AX_VECT[2,0],$PC_TCARR_AX_VECT[2,1],$PC_TCARR_AX_VECT[2,2])
ENDIF
ELSE
_DIR_RA1[0]=SET($TC_CARR7[_TC],$TC_CARR8[_TC],$TC_CARR9[_TC])
_DIR_RA2[0]=SET($TC_CARR10[_TC],$TC_CARR11[_TC],$TC_CARR12[_TC])
ENDIF
ENDIF
_SERR=<<"16 MIRROR"
IF($P_ACTFRAME[_ZZ,MI]) GOTOF _ERR20
_SERR=<<"2 (AMODE DEC5)"
IF ((S_AMODE _DEC5>0) AND ($MCS_TECHNOLOGY<>1)) GOTOF _ERR8
IF $MCS_TECHNOLOGY==1
IF (AXSTRING(_RAX2)<>"NO_AXIS")
IF ((_KINTYP==56) AND ((_RAX1==_F_S_AX[6]) OR (_RAX2==_F_S_AX[6])))
IF S_AMODE _DEC5 ==0 GOTOF _ERR8
ELSE
IF S_AMODE _DEC5 ==2 GOTOF _ERR8
ENDIF
IF _TC>=1001
IF ($P_EP[_RAX2] MOD 90)==0
_RA2_OFF=$P_EP[_RAX2]
ENDIF
ENDIF
ELSE
IF _TC>=1001
IF ($P_EP[_RAX1] MOD 90)==0
_RA1_OFF=$P_EP[_RAX1]
ENDIF
ENDIF
ENDIF
IF _TC<1000
IF (((S_AMODE _DEC5)==3) AND ($MA_ROT_IS_MODULO[_RAX1]==0))
_RA1_OFF=_RA1_OFF-90
ELSE
_RA1_OFF=(_RA1_OFF+(S_AMODE _DEC5)*90)
ENDIF
ENDIF
ENDIF
IF NOT($SCS_MEA_FUNCTION_MASK B_AND 'H400')
IF (S_MVAR _DEC1==1) OR (S_MVAR _DEC1==2)
_SERR="4 (SD55740 Bit10)"
GOTOF _ERR1
ENDIF
ENDIF
IF (S_MVAR _DEC1)>3
_SERR="1 (_MVAR DEC1)"
GOTOF _ERR1
ENDIF
IF (S_MVAR _DEC2)<>0
_SERR="1 (_MVAR DEC2)"
GOTOF _ERR1
ENDIF
IF ((S_MVAR _DEC3)<1) OR ((S_MVAR _DEC3)>4)
_SERR="1 (_MVAR DEC3)"
GOTOF _ERR1
ENDIF
IF (S_MVAR _DEC4)>2
_SERR="1 (_MVAR DEC4)"
GOTOF _ERR1
ENDIF
IF ((S_MVAR _DEC5)>1)
_SERR="1 (_MVAR DEC5)"
IF (((S_MVAR _DEC5) ==2) AND ($MCS_TECHNOLOGY<>1))
GOTOF _ERR1
ELSE
IF (((S_MVAR _DEC1)<>3) AND ((_MEA_RA[0]+_MEA_RA[1])<>2))
GOTOF _ERR1
ENDIF
ENDIF
ENDIF
_MEC_TAB=0
IF ($SNS_MEA_FUNCTION_MASK_PIECE B_AND 'H20000000')
IF _MEC>0
_MEC=_MEC+10
_MEC_TAB=S_MEC_INDEX
ENDIF
ENDIF
_E996_ACT=0
IF ISVAR("_E996_ACTIVE_STATE")
IF _E996_ACTIVE_STATE == 1
_E996_ACT=1
IF (((_E996_FILE[0]<>"") AND (STRLEN(_E996_FILE[0])<>STRLEN(S_TNAME)) AND (MATCH(_E996_FILE[0],S_TNAME)<>0)) OR (S_MVAR _DEC4<>0))
_ACT_E996=_E996_FILE[0]
IF (($SCS_MEA_FUNCTION_MASK B_AND 'H4000')==0) OR ((S_MVAR _DEC4<>0) AND (S_MVAR _DEC1==3))
CC_E996()
_E996_ACT=-1
ENDIF
ENDIF
ENDIF
ENDIF
_MEC_ACT=0
IF _MEC>0
FOR _I=0 TO 3
IF $SN_MEC_TABLE_ENABLE[_I]<>0
_MEC_ACT=_MEC_ACT+1
ENDIF
ENDFOR
ENDIF
IF ((S_MVAR _DEC1==3)AND((S_MVAR _DEC4)<>0) AND (_MEC_ACT<>0))
IF (($SCS_MEA_FUNCTION_MASK B_AND 'H4000')==0) AND ((_MEC _DEC2)==0)
$SN_MEC_TABLE_ENABLE[_MEC_TAB]=0
_MEC_ACT=0
ENDIF
ENDIF
IF S_MVAR _DEC4 ==2
IF S_MVAR _DEC1 == 3
_SERR="1 (_MVAR DEC1&DEC4)"
GOTOF _ERR1
ENDIF
IF (AXSTRING(_RAX2)=="NO_AXIS")
_ANZGES=_OVR[120]
ENDIF
IF (AXSTRING(_RAX2)<>"NO_AXIS") AND ((S_MVAR _DEC1)<3)
_ANZGES=_OVR[120]+_OVR[121]
ENDIF
_WZ_L[0]=SET(_OVR[50],_OVR[51],_OVR[52])
GOTOF _CALC
ENDIF
S_MVAR=ABS(S_MVAR)
IF (S_MVAR _DEC1)==3
_SERR="1-"<<AXSTRING(_RAX1)<<" >144"
IF ((_MEA_RA[1]==0) AND (S_CMEA_RA1>144)) GOTOF _ERR4
_SERR="1-"<<AXSTRING(_RAX2)<<" >144"
IF ((_MEA_RA[0]==0) AND (S_CMEA_RA2>144)) GOTOF _ERR4
_SERR="1-"<<AXSTRING(_RAX1)<<"*"<<AXSTRING(_RAX2)<<">144"
IF ((_MEA_RA[0]+_MEA_RA[1])==2)
IF ((S_CMEA_RA1*S_CMEA_RA2)>144) GOTOF _ERR4
ENDIF
ELSE
IF (S_CMEA_RA1>12)
_SERR="2-"<<AXSTRING(_RAX1)
GOTOF _ERR4
ENDIF
IF (S_CMEA_RA2>12) AND(AXSTRING(_RAX2)<>"NO_AXIS")
_SERR="2-"<<AXSTRING(_RAX2)
GOTOF _ERR4
ENDIF
ENDIF
IF ((_TC>1000) AND ((S_MVAR _DEC4)<2))
_OFF_RA1[0]=SET(0,0,0)
_I=$AC_TRAFO_ORIAX_LOC[_RAX1]
_I=_I+(_I _DEC2)
_LOG=CORRTRAFO(_OFF_RA1,_I,1100,0)
IF AXSTRING(_RAX2)<>"NO_AXIS"
_I=$AC_TRAFO_ORIAX_LOC[_RAX2]
_I=_I+(_I _DEC2)
_LOG=CORRTRAFO(_OFF_RA1,_I,1100,0)
ENDIF
ENDIF
IF (S_MVAR _DEC1)<3
IF _KINTYP==56
IF _TC<1001
_SERR=<<AXSTRING(_RAX1)<<"<>"<<_RA1_OFF
IF S_POS_RA1<>_RA1_OFF GOTOF _ERR8
ELSE
_SERR=<<AXSTRING(_RAX2)<<"<>"<<_RA2_OFF
IF AXSTRING(_RAX2)<>"NO_AXIS"
IF S_POS_RA2<>_RA2_OFF GOTOF _ERR8
ENDIF
ENDIF
ENDIF
IF _KINTYP==40
_SERR=<<AXSTRING(_RAX2)<<"<>"<<_RA2_OFF
IF AXSTRING(_RAX2)<>"NO_AXIS"
IF ((S_POS_RA2<>_RA2_OFF) AND (_TC>1000)) GOTOF _ERR8
ENDIF
_SERR=<<AXSTRING(_RAX1)<<"<>"<<_RA1_OFF
IF AXSTRING(_RAX2)<>"NO_AXIS"
IF ((S_POS_RA1<>_RA1_OFF) AND (_TC<1000)) GOTOF _ERR8
ENDIF
ENDIF
IF _KINTYP==24
_SERR=<<AXSTRING(_RAX1)<<"<>"<<_RA1_OFF
IF AXSTRING(_RAX2)<>"NO_AXIS"
IF (S_POS_RA1<>_RA1_OFF) GOTOF _ERR8
ENDIF
ENDIF
ELSE
IF ((ISVAR("_E996_ACTIVE_STATE")==0) AND (_MEC<2))
_SERR=<<"MEC Basic"
GOTOF _ERR7
ENDIF
_FILE_COMP_LOC=""
IF ((ISVAR("$MC_E996_FILE_LOCATION")) AND (_MEC==0))
CASE ($MC_E996_FILE_LOCATION) OF 1 GOTOF _CASE1_0 2 GOTOF _CASE1_1 DEFAULT GOTOF _ENDCASE1
_CASE1_0:
_FILE_COMP_LOC="/_N_CMA_DIR/_N_E996"
GOTOF _ENDCASE1
_CASE1_1:
_FILE_COMP_LOC="/_N_CUS_DIR/_N_E996"
_ENDCASE1:
IF _FILE_COMP_LOC==""
_SERR=<<"12 VCS_Rotary MD62738"
GOTOF _ERR20
ENDIF
ELSE
_FILE_COMP_LOC="/_N_CMA_DIR/_N_MEC_"<<_MEC_TAB<<"_"
ENDIF
_FILE_COMP=<<_FILE_COMP_LOC<<S_TNAME<<"_"<<_CHAN_NR<<"_SPF"
IF (S_MVAR _DEC4)==0
_FILE_COMP=<<_FILE_COMP_LOC<<S_TNAME<<"_MEA"<<_CHAN_NR<<"_SPF"
IF (ISFILE(_FILE_COMP))
DELETE(_LOG,_FILE_COMP)
ENDIF
ELSE
IF (ISFILE(_FILE_COMP))
_M_COMP=0
_FILE_COMP_OLD=<<_FILE_COMP_LOC<<S_TNAME<<"_OLD"<<_M_COMP<<"_"<<_CHAN_NR<<"_SPF"
WHILE (ISFILE(_FILE_COMP_OLD))
_SERR="13 comp file"
IF _M_COMP>10 GOTOF _ERR20
_M_COMP=_M_COMP+1
_FILE_COMP_OLD=<<_FILE_COMP_LOC<<S_TNAME<<"_OLD"<<_M_COMP<<"_"<<_CHAN_NR<<"_SPF"
ENDWHILE
_I=1
WHILE ((_LINE[0]<>"M17")AND(_I<161))
READ(_LOG,_FILE_COMP,_I,_I,_LINE)
WRITE(_LOG,_FILE_COMP_OLD,<<_LINE[0])
_I=_I+1
ENDWHILE
DELETE (_LOG,_FILE_COMP)
ENDIF
ENDIF
ENDIF
_LIM_M_RA1=$MA_POS_LIMIT_MINUS[_RAX1] _LIM_P_RA1=$MA_POS_LIMIT_PLUS[_RAX1]
IF _TC<1000
_LIM_M_RA1=$TC_CARR30[_TC]
_LIM_P_RA1=$TC_CARR32[_TC]
ENDIF
IF $MA_ROT_IS_MODULO[_RAX1]==0
_SERR=<<"start/end RA - "<<AXSTRING(_RAX1)
IF (S_END_RA1-S_START_RA1)>=0
IF ((S_POS_RA1<_LIM_M_RA1) OR(S_POS_RA1>_LIM_P_RA1)) GOTOF _ERR14
ELSE
IF ((S_POS_RA1>_LIM_P_RA1) OR(S_POS_RA1<_LIM_M_RA1)) GOTOF _ERR14
ENDIF
ENDIF
IF AXSTRING(_RAX2)<>"NO_AXIS"
_LIM_M_RA2=$MA_POS_LIMIT_MINUS[_RAX2] _LIM_P_RA2=$MA_POS_LIMIT_PLUS[_RAX2]
IF _TC<1000
_LIM_M_RA2=$TC_CARR31[_TC]
_LIM_P_RA2=$TC_CARR33[_TC]
ENDIF
IF $MA_ROT_IS_MODULO[_RAX2]==0
_SERR=<<"start/end RA - "<<AXSTRING(_RAX2)
IF (S_END_RA2-S_START_RA2)>=0
IF ((S_POS_RA2<_LIM_M_RA2) OR(S_POS_RA2>_LIM_P_RA2)) GOTOF _ERR14
ELSE
IF ((S_POS_RA2>_LIM_P_RA2) OR(S_POS_RA2<_LIM_M_RA2)) GOTOF _ERR14
ENDIF
ENDIF
ENDIF
_ANZGES=S_CMEA_RA1*S_CMEA_RA2
IF (AXSTRING(_RAX2)=="NO_AXIS")
_ANZGES=S_CMEA_RA1
S_CMEA_RA2=0
ENDIF
IF (AXSTRING(_RAX2)<>"NO_AXIS") AND ((S_MVAR _DEC1)<3)
_ANZGES=S_CMEA_RA1+S_CMEA_RA2
ENDIF
_SERR=<<"1 (CMEA)"
IF (_ANZGES*9+_SOVR)>999 GOTOF _ERR11
_OVR[120]=S_CMEA_RA1
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_OVR[121]=S_CMEA_RA2
ELSE
_OVR[121]=0
ENDIF
IF (NOT $P_SEARCH) AND (NOT $P_ISTEST) AND (NOT $P_SIM)
_OVR[40]=0
ENDIF
IF (S_MVAR _DEC1)<3
_SERR=<<"3-"<<AXSTRING(_RAX1)
IF S_CMEA_RA1<3 GOTOF _ERR4
IF (AXSTRING(_RAX2)<>"NO_AXIS")
IF S_CMEA_RA2<3
_SERR=<<"3-"<<AXSTRING(_RAX2)
GOTOF _ERR4
ENDIF
ENDIF
ELSE
IF ((S_CMEA_RA1<2) AND (_MEA_RA[0]==1))
_SERR=<<"6-"<<AXSTRING(_RAX1)
GOTOF _ERR4
ENDIF
IF (AXSTRING(_RAX2)<>"NO_AXIS")
IF S_CMEA_RA2<2
_SERR=<<"6-"<<AXSTRING(_RAX2)
GOTOF _ERR4
ENDIF
ENDIF
ENDIF
_SD55740_0=1
IF NOT($SCS_MEA_FUNCTION_MASK B_AND 'B1')
_SD55740_0=0
ENDIF
IF $P_SIM
_SD55740_0=0
ENDIF
IF _OVI[18]==1
_SD55740_0=0
ENDIF
_SD55740_12=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H1000')
_SD55740_12=1
ENDIF
G1 F=$SCS_MEA_FEED_PLANE_VALUE
_H_ME=($MCS_MEA_FUNCTION_MASK B_AND 'B1')+1
_HIRTH=0
IF (_TC>=1001)
IF $NT_CNTRL[_TC-1000] B_AND 'H10'=='H10'
_HIRTH=1
_HIRTH_STEP[0]=$MA_INDEX_AX_NUMERATOR[_RAX1]/$MA_INDEX_AX_DENOMINATOR[_RAX1]
IF $MA_ROT_IS_MODULO[_RAX1]==1
_HIRTH_STEP[0]=$MA_MODULO_RANGE[_RAX1]/$MA_INDEX_AX_DENOMINATOR[_RAX1]
ENDIF
ENDIF
IF $NT_CNTRL[_TC-1000] B_AND 'H20'=='H20'
_HIRTH=2
_HIRTH_STEP[1]=$MA_INDEX_AX_NUMERATOR[_RAX2]/$MA_INDEX_AX_DENOMINATOR[_RAX2]
IF $MA_ROT_IS_MODULO[_RAX2]==1
_HIRTH_STEP[1]=$MA_MODULO_RANGE[_RAX2]/$MA_INDEX_AX_DENOMINATOR[_RAX2]
ENDIF
ENDIF
ENDIF
_RA1_ZW_POS[0]=REP(999,12)
IF (AXSTRING(_RAX2)=="NO_AXIS")
_CMEA1=S_CMEA_RA1
_GST1=0 _II=0 _III=0
REPEAT _M_RA1_POS_A _M_RA1_POS_E
IF (_GST1==0) AND (S_MVAR _DEC1 <>3)
_CMEA1=_CMEA1-1
_II=0 _III=0
REPEAT _M_RA1_POS_A _M_RA1_POS_E
ENDIF
_CMEA1=S_CMEA_RA1
ELSE
_CMEA1=S_CMEA_RA1
_GST1=0 _II=0 _III=0
REPEAT _M_RA1_POS_A _M_RA1_POS_E
IF (S_MVAR _DEC1)<>3
IF (_KINTYP<>24)
IF ((_GST1==0))
_CMEA1=_CMEA1-1
_GST1=0 _II=0 _III=0
REPEAT _M_RA1_POS_A _M_RA1_POS_E
IF _GST1==1
FOR _I=0 TO _CMEA1
_RA1_POS[_I]=_RA1_POS[_I+1]
ENDFOR
_RA1_POS[_CMEA1+1]=_RA1_OFF
ELSE
_CMEA1=_CMEA1+1
ENDIF
ENDIF
ENDIF
ENDIF
_CMEA2=S_CMEA_RA2
_GST2=0 _II=0 _III=0
REPEAT _M_RA2_POS_A _M_RA2_POS_E
IF (S_MVAR _DEC1)<>3
IF ((_KINTYP<>56) OR ((_KINTYP==56)AND(S_POS_RA1<>_RA1_OFF)))
IF ((_GST2==0))
_CMEA2=_CMEA2-1
_GST2=0 _II=0 _III=0
REPEAT _M_RA2_POS_A _M_RA2_POS_E
IF _GST2==1
FOR _I=0 TO _CMEA2
_RA2_POS[_I]=_RA2_POS[_I+1]
ENDFOR
_RA2_POS[_CMEA2+1]=_RA2_OFF
ELSE
_CMEA2=_CMEA2+1
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
_OVR[120]=SET(_CMEA1,_CMEA2)
; *stopre
_LIM_M_RA1=$MA_POS_LIMIT_MINUS[_RAX1] _LIM_P_RA1=$MA_POS_LIMIT_PLUS[_RAX1]
IF AXSTRING(_RAX2)<>"NO_AXIS"
_LIM_M_RA2=$MA_POS_LIMIT_MINUS[_RAX2] _LIM_P_RA2=$MA_POS_LIMIT_PLUS[_RAX2]
ENDIF
IF ($MA_ROT_IS_MODULO[_RAX1]==0)
FOR _I=0 TO S_CMEA_RA1
IF (_RA1_POS[_I]<_LIM_M_RA1) OR (_RA1_POS[_I]>_LIM_P_RA1)
_SERR=<<"start/end RA - "<<AXSTRING(_RAX1)
GOTOF _ERR14
ENDIF
ENDFOR
ENDIF
IF (AXSTRING(_RAX2)<>"NO_AXIS") ; 2 Rundachsen vermessen
IF ($MA_ROT_IS_MODULO[_RAX2]==0)
FOR _I=0 TO S_CMEA_RA2
IF (_RA2_POS[_I]<_LIM_M_RA2) OR (_RA2_POS[_I]>_LIM_P_RA2)
_SERR=<<"start/end RA - "<<AXSTRING(_RAX2)
GOTOF _ERR14
ENDIF
ENDFOR
ENDIF
ENDIF
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_SERR=<<AXSTRING(_RAX2)<<"="<<$P_EP[_RAX2]<<"<>"<<_RA2_OFF
IF ($P_EP[_RAX2]<>_RA2_OFF) GOTOF _ERR8
_SERR=<<AXSTRING(_RAX1)<<"="<<$P_EP[_RAX1]<<"<>"<<_RA1_OFF
IF ($P_EP[_RAX1]<>_RA1_OFF) GOTOF _ERR8
ELSE
_SERR=<<AXSTRING(_RAX1)<<"="<<$P_EP[_RAX1]<<"<>"<<_RA1_OFF
IF ($P_EP[_RAX1]<>_RA1_OFF) GOTOF _ERR8
ENDIF
IF _G17_18_19==1
TOROT
ELSE
IF _G17_18_19==2
TOROTY
ELSE
TOROTX
ENDIF
ENDIF
IF (S_MVAR _DEC4<2)
_OVR[50]=SET(0,0,0)
_OVR[998]=0
IF $SC_TOOL_LENGTH_CONST==0
_H=GETTCOR(_LEN,"-KT:W")
_OVR[50]=SET(_LEN[4],_LEN[3],_LEN[2])
ELSE
IF (($MCS_TECHNOLOGY==1) AND ($P_AD[2]==8))
_OVR[998]=1
_OVR[50]=$P_TOOLL[$P_M_TOOL_LENGTH_INDEX[0]]
ELSE
_OVR[50]=$P_TOOLL[$P_M_TOOL_LENGTH_INDEX[2]]
ENDIF
ENDIF
_WZ_L[0]=SET(_OVR[50],_OVR[51],_OVR[52])
S_KNUM=ABS(S_KNUM)
IF ((S_MVAR _DEC1)==1)
_SERR=<<"25 REF HEAD S_KNUM"
IF ((S_KNUM<>9000)AND((S_KNUM==0)OR(S_KNUM>99))) GOTOF _ERR20
IF S_KNUM<99
_NV_ACT=S_KNUM+1
G[8]=_NV_ACT
ENDIF
ENDIF
IF ((S_MVAR _DEC1)==2)
_SERR=<<"26 REF HEAD"
IF (_OVR[105]<=0) GOTOF _ERR20
_SERR=<<"27 REF Workoffset"
IF ((_OVR[104]<0)OR(_OVR[104]>99)) GOTOF _ERR20
_NV_ACT=_OVR[104]+1
G[8]=_NV_ACT
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_XX)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_XX,TR]*_MD10200)/_MD10200) <> _OVR[107]) GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_YY)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_YY,TR]*_MD10200)/_MD10200) <> _OVR[108]) GOTOF _ERR20
_SERR=<<" G HEAD REF Workoffset "<<AXSTRING(_ZZ)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_ZZ,TR]*_MD10200)/_MD10200) <> _OVR[109]) GOTOF _ERR20
IF $MN_MM_FRAME_FINE_TRANS
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_XX)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_XX,FI]*_MD10200)/_MD10200) <> 0) GOTOF _ERR20
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_YY)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_YY,FI]*_MD10200)/_MD10200) <> 0) GOTOF _ERR20
_SERR=<<" H HEAD REF Workoffset "<<AXSTRING(_ZZ)<<" ?"
IF ((ROUND($P_UIFR[_NV_ACT-1,_ZZ,FI]*_MD10200)/_MD10200) <> 0) GOTOF _ERR20
ENDIF
ENDIF
IF ((S_MVAR _DEC1)==1)OR((S_MVAR _DEC1)==2)
_SERR=<<"24 REF HEAD TRAFOTYP"
IF (_KINTYP==40) GOTOF _ERR20
IF _TC>1000
_SERR=<<"(20 $NT_CNTRL["<<(_TC-1000)<<"] bit8<>0 ?)"
IF ($NT_CNTRL[_TC-1000] B_AND 'H100'=='H100') GOTOF _ERR20
ELSE
_SERR=<<"21 $SCS_MEA_KIN_MODE[0] _DEC2==0"
IF (_KIN_MODE[0] _DEC2)==0 GOTOF _ERR20
ENDIF
IF ((S_MVAR _DEC1)==2)
_SERR=<<"(F REF Workoffset?)"
IF ((_OVR[104]+1)<>_NV_ACT)GOTOF _ERR20
_SERR=<<" I HEAD REF $SD_MEA_KIN_MODE[0]=?"<<_KIN_MODE[0]
IF (_KIN_MODE[0]<4) GOTOF _ERR20
ENDIF
ENDIF
IF _TT
M01
ELSE
FOR _I=0 TO 5
_OVR[60+_I]=0
ENDFOR
_OVR[40]=0
FOR _I=0 TO S_CMEA_RA1-1
_RA1_POS[_I]= ROUND(_RA1_POS[_I]*1000)/1000
ENDFOR
IF S_CMEA_RA2>1
FOR _I=0 TO S_CMEA_RA2-1
_RA2_POS[_I]= ROUND(_RA2_POS[_I]*1000)/1000
ENDFOR
ENDIF
IF _LOG_ON
WRITE(_LOG,_LOGFILE,";------------------------------------------------------------------")
WRITE(_LOG,_LOGFILE,"; ----------- only for internal diagnostics -----------------------")
WRITE(_LOG,_LOGFILE,";CYCLE9960: measure Kinematic complete "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
WRITE(_LOG,_LOGFILE,";S_MVAR=" <<S_MVAR<<" TNAME="<<S_TNAME)
WRITE(_LOG,_LOGFILE,";S_SETV1="<<S_SETV1<<" S_START_RA1="<<S_START_RA1<<" S_END_RA1="<<S_END_RA1<<" S_CMEA_RA1="<<S_CMEA_RA1<<" S_POS_RA2="<<S_POS_RA2)
WRITE(_LOG,_LOGFILE,";S_SETV2="<<S_SETV2<<" S_START_RA2="<<S_START_RA2<<" S_END_RA2="<<S_END_RA2<<" S_CMEA_RA2="<<S_CMEA_RA2<<" S_POS_RA1="<<S_POS_RA1)
WRITE(_LOG,_LOGFILE,";S_SETV4="<<S_SETV4<<" _DMODE="<<S_DMODE<<" _AMODE="<<S_AMODE)
IF ISVAR("_E996_ACTIVE_STATE")
IF _E996_ACTIVE_STATE==1
WRITE(_LOG,_LOGFILE,";E996 active compensation file:"<< _E996_FILE[0])
ELSE
_LINE[0]=<<";E996 inactive while measuring"
IF _E996_ACT==-1
_LINE[0]=_LINE[0]<<"  E996"<<_ACT_E996<<" was deactivated"
ENDIF
WRITE(_LOG,_LOGFILE,_LINE[0])
ENDIF
ENDIF
_LINE[0]=<<"bit8="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H100')/256)<<"  bit10="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H400')/1024)<<"  bit11="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H800')/2048)
_LINE[0]=_LINE[0]<<"  bit13="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H2000')/8192)<<"  bit20="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H100000')/1048576)<<"  bit21="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H200000')/2097152)
_LINE[0]=_LINE[0]<<"  bit22="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H400000')/4194304)<<"  bit23="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H800000')/8388608)<<"  bit24="<<(($SCS_MEA_FUNCTION_MASK B_AND 'H1000000')/16777216)
WRITE(_LOG,_LOGFILE,";SD55740 $SCS_MEA_FUNCTION_MASK: "<<_LINE[0])
WRITE(_LOG,_LOGFILE,";------------------------------------------------------------------")
_LINE[0]=<<_RA1_POS[0]
IF S_CMEA_RA1>2
FOR _I=1 TO S_CMEA_RA1-1
_LINE[0]=_LINE[0]<<"|"<<_RA1_POS[_I]
IF (STRLEN(_LINE[0])>245)
_LINE[0]=_LINE[0]<<"|..."
GOTOF _NEXT2
ENDIF
ENDFOR
_NEXT2:
WRITE(_LOG,_LOGFILE,"; _RA1_POS:"<<_LINE[0])
ENDIF
IF AXSTRING(_RAX2)<>"NO_AXIS"
_LINE[0]=<<_RA2_POS[0]
FOR _I=1 TO S_CMEA_RA2-1
_LINE[0]=_LINE[0]<<"|"<<_RA2_POS[_I]
IF (STRLEN(_LINE[0])>245)
_LINE[0]=_LINE[0]<<"|..."
GOTOF _NEXT3
ENDIF
ENDFOR
_NEXT3:
WRITE(_LOG,_LOGFILE,"; _RA2_POS:"<<_LINE[0])
ENDIF
ENDIF
IF _LOG_ON
IF _G17_18_19==1
WRITE(_LOG,_LOGFILE,<<AXSTRING(_RAX1)<<" | "<<AXSTRING(_RAX2)<<" |MKS-X|MKS-Y|MKS-Z|ERR-X|ERR-Y|ERR-Z|ERR^2|SOLL-X|SOLL-Y|SOLL-Z|")
ENDIF
IF _G17_18_19==2
WRITE(_LOG,_LOGFILE,<<AXSTRING(_RAX1)<<" | "<<AXSTRING(_RAX2)<<" |MKS-Z|MKS-X|MKS-Y|ERR-Z|ERR-X|ERR-Y|ERR^2|SOLL-Z|SOLL-X|SOLL-Y|")
ENDIF
IF _G17_18_19==3
WRITE(_LOG,_LOGFILE,<<AXSTRING(_RAX1)<<" | "<<AXSTRING(_RAX2)<<" |MKS-Y|MKS-Z|MKS-X|ERR-Y|ERR-Z|ERR-X|ERR^2|SOLL-Y|SOLL-Z|SOLL-X|")
ENDIF
ENDIF
ORIAXES
ORIMKS
_OVI[2]=9961
CUST_MEACYC(1)
IF ISVAR ("$SCS_MEA_KIN_PREPOS_RA")
IF $SCS_MEA_KIN_PREPOS_RA>0
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_POS[0]=SET($P_EP[_RAX1],$P_EP[_RAX2])
ELSE
_POS[0]=SET($P_EP[_RAX1],0)
ENDIF
_RA1_ZW_POS[1]=_POS[0]-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[0]/ABS(_DISTANCE[0])
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_RA1_ZW_POS[2]=_POS[1]-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[1]/ABS(_DISTANCE[1])
ELSE
_RA1_ZW_POS[2]=0
ENDIF
IF _LOG_ON
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX1)<<"="<<_RA1_ZW_POS[1]<<" und "<<AXSTRING(_RAX2)<<"="<<_RA1_ZW_POS[2])
ELSE
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX1)<<"="<<_RA1_ZW_POS[1])
ENDIF
ENDIF
CUST_800(996,_TC,_RA1_ZW_POS[1],_RA1_ZW_POS[2])
CUST_800(996,_TC,_POS[0],_POS[1])
ENDIF
ENDIF
_MVARC997=19+ (S_MVAR _DEC3)*1000
IF (S_MVAR _DEC3==2)
_MVARC997=_MVARC997+100000
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H800')
_MVARC997=_MVARC997-100000
ENDIF
ENDIF
_MIJ_I[0]=0
_MODE=2
CYCLE216(_CAL,_MODE)
_MODE=8
_CAL[0]=REP(0)
_CAL[0]=S_SETV1
_CAL[2]=SET(-((S_MVAR _DEC3)-4)/2)
CYCLE216(_CAL,_MODE)
_SETV1=_CAL[1]
_OVR[11]=0
_OVR[66]=$P_ACTFRAME[_XX,RT] _OVR[67]=$P_ACTFRAME[_YY,RT] _OVR[68]=$P_ACTFRAME[_ZZ,RT]
FOR _II=0 TO 2
IF (ABS(_OVR[66+_II])<0.0001)
_OVR[66+_II]=0
ENDIF
ENDFOR
_POS[0]=SET($P_EP[_XX]*_FAK1,$P_EP[_YY]*_FAK1, $P_EP[_ZZ]*_FAK1 )
_OVI[2]=976
CYCLE109(_INTERN,_M_SPE,_M_N)
IF (S_AMODE _DEC2)==1
_OVR[40]=REP(0,10)
_OVR[53]=REP(0,35)
_SD54610[0]=($SNS_MEA_WP_STATUS_GEN[_PRNUM-1] _DEC1)+($SNS_MEA_WP_STATUS_GEN[_PRNUM-1] _DEC2)*10
IF NOT((_SD54610[0] B_AND 'B100')OR(_SD54610[0] B_AND 'B1000'))
_SERR="Z"
GOTOF _ERR13
ENDIF
_MODE=2
CYCLE216(_CAL,_MODE)
_MODE=8
_CAL[0]=REP(0)
_CAL[0]=S_SETV1
CYCLE216(_CAL,_MODE)
_SETV1=_CAL[1]
_OVR[0]=REP(0,50)
_MVARC976=3
IF (S_MVAR _DEC3)==2
_MVARC976=_MVARC976+100000
ENDIF
CYCLE976( _MVARC976,S_PRNUM,S_SETV,0,,,S_FA,$SNS_MEA_WP_BALL_DIAM[_PRNUM-1]*_FAK1,$SNS_MEA_WP_FEED[_PRNUM-1],_SETV1,1,,S_DMODE,)
_SD54610[1]=($SNS_MEA_WP_STATUS_GEN[_PRNUM-1] _DEC1)+($SNS_MEA_WP_STATUS_GEN[_PRNUM-1] _DEC2)*10
IF NOT((_SD54610[1] B_AND 'B100')OR(_SD54610[1] B_AND 'B1000'))
IF _SD54610[0] B_AND 'B100'
$SNS_MEA_WP_STATUS_GEN[_PRNUM-1]=$SNS_MEA_WP_STATUS_GEN[_PRNUM-1] +4
ENDIF
IF _SD54610[0] B_AND 'B1000'
$SNS_MEA_WP_STATUS_GEN[_PRNUM-1]=$SNS_MEA_WP_STATUS_GEN[_PRNUM-1] +8
ENDIF
ENDIF
_OVR[4]=_OVR[3]
_OVR[5]=SET(_OVR[6],_OVR[7],_OVR[2])
_OVR[1]=SET(_POS[0]/_FAK2,_POS[1]/_FAK2,(_POS[2]-S_SETV/2-S_FA)/_FAK2)
_CAL[0]=SET(_OVR[5],_OVR[6],_OVR[7])
REPEAT _WKS_MKS_A _WKS_MKS_E
IF $P_DRYRUN==0
_OVR[9]=_OVR[5]-_POS[0]
_OVR[10]=_OVR[6]-_POS[1]
_OVR[11]=_OVR[7]-(_POS[2]-S_SETV/2-S_FA)/_FAK2
ENDIF
FOR _I=0 TO 2
_OVR[_I+9]=(TRUNC(_OVR[_I+9]*_MD10200)/_MD10200)
_OVR[_I+41]=(TRUNC(_OVR[_I+41]*_MD10200)/_MD10200)
ENDFOR
IF _LOG_ON
WRITE(_LOG,_LOGFILE,<<"; Abgleich als Messung Grundstellung: Diff "<<_OVR[9]<<" "<<_OVR[10]<<" "<<_OVR[11]<<" ")
ENDIF
ELSE
IF ((S_MVAR _DEC1)==2)
_CAL[0]=SET(_OVR[68],_OVR[67],_OVR[66])
_MODE=1
CYCLE216(_CAL,_MODE)
CYCLE997(_MVARC997,S_KNUM,S_PRNUM,S_SETV,S_FA,S_TSA,_SETV1,90,-S_SETV/2*_CAL[2],-S_SETV/2*_CAL[1],-S_SETV/2*_CAL[0],,,,,,,,S_NMSP,,S_DMODE,)
ELSE
IF ((S_MVAR _DEC1)==1)
_OVR[104]=REP(0,9)
ENDIF
_CAL[0]=SET($P_EP[_XX]*_FAK1,$P_EP[_YY]*_FAK1,$P_EP[_ZZ]*_FAK1-S_SETV/2-S_FA)
CYCLE997(_MVARC997,S_KNUM,S_PRNUM,S_SETV,S_FA,S_TSA,_SETV1,90,_CAL[0],_CAL[1],_CAL[2],,,,,,,,S_NMSP,,S_DMODE,)
ENDIF
IF _LOG_ON
WRITE(_LOG,_LOGFILE,<<"; Messung Grundstellung: Diff "<<_OVR[9]<<" "<<_OVR[10]<<" "<<_OVR[11])
ENDIF
ENDIF
FOR _I=0 TO 5
_MOVR[_I]=_OVR[60+_I]
ENDFOR
_OVR[_SOVR]=SET(0,0,0,_POS1,_POS2)
_CAL[0]=SET(_OVR[5],_OVR[6],_OVR[7])
REPEAT _WKS_MKS_A _WKS_MKS_E
_MEA_MKS[0,0]=SET(_CAL[0],_CAL[1],_CAL[2],_POS1,_POS2)
_MEA_MKS_OLD[0,0]=SET(_CAL[0],_CAL[1],_CAL[2])
_MEA_DIAM[0]=_OVR[4]
IF _DM_TOL<>0
_OVR[71]=_OVR[4]
IF _DM_TOL<ABS(_OVR[4]-S_SETV/_FAK2)
_SERR=<<"1."
GOTOF _ERR5
ENDIF
ENDIF
IF ((S_MVAR _DEC1)==2)
_OVR[11]=_OVR[3]*_FAK2-(($AA_IW[_ZZ])*_FAK1-S_SETV/2-_FA)+_OVR[11]*_FAK2
ENDIF
IF _SD55740_0==0
AX[_ZZ]=_POS[2]+_OVR[11]
AX[_XX]=_OVR[5]*_FAK2
AX[_YY]=_OVR[6]*_FAK2
ELSE
MEAS=_H_ME AX[_ZZ]=_POS[2]+_OVR[11]
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR0
MEAS=_H_ME AX[_XX]=_OVR[5]*_FAK2 AX[_YY]=_OVR[6]*_FAK2
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR0
ENDIF
IF ((S_MVAR _DEC1)==1)
IF (ISVAR("$AC_TRAFO_CORR_ELEM_T[1,0]") AND (_TC>1000))
_CORR_ELEM_T[0]=$AC_TRAFO_CORR_ELEM_T[1,0]
_CORR_ELEM_T[1]=$AC_TRAFO_CORR_ELEM_T[1,1]
_CORR_ELEM_T[2]=$AC_TRAFO_CORR_ELEM_T[1,2]
ELSE
_CORR_ELEM_T[0]=SET($TC_CARR4[_TC],$TC_CARR5[_TC],$TC_CARR6[_TC])
ENDIF
_NV_ACT=$P_GG[8]-1
_OVR[104]=_NV_ACT
_OVR[105]=_TC
_OVR[106]=$P_GG[13]
$P_UIFR[_NV_ACT,_XX,TR]=$P_UIFR[_NV_ACT,_XX,TR]+_OVR[5]/_FAK1*_FAK2
$P_UIFR[_NV_ACT,_YY,TR]=$P_UIFR[_NV_ACT,_YY,TR]+_OVR[6]/_FAK1*_FAK2
$P_UIFR[_NV_ACT,_ZZ,TR]=$P_UIFR[_NV_ACT,_ZZ,TR]+_OVR[7]/_FAK1*_FAK2+S_SETV/_FAK1/2
IF $MN_MM_FRAME_FINE_TRANS
$P_UIFR[_NV_ACT,_XX,FI]=0
$P_UIFR[_NV_ACT,_YY,FI]=0
$P_UIFR[_NV_ACT,_ZZ,FI]=0
ENDIF
_NV_ACT=_NV_ACT+1
G[8]=_NV_ACT
IF _LOG_ON
WRITE(_LOG,_LOGFILE,";HEAD REF OVR[104]="<<_OVR[104]<<"(NPV) _OVR[105]="<<_OVR[105]<<"(REF_HEAD) _OVR[106]="<<_OVR[106]<<"(G70/71)   NVP grob: _OVR[107]="<<_OVR[107]<<" _OVR[108]="<<_OVR[108]<<" _OVR[109]="<<_OVR[109])
ENDIF
ENDIF
IF ((S_MVAR _DEC1)==2)
IF ((_KINTYP==24) OR (_KINTYP==56))
_CAL[0]=SET(_OVR[68],_OVR[67],_OVR[66])
_CAL[3]=SET(_OVR[9],_OVR[10],_OVR[11])
_MODE=1
CYCLE216(_CAL,_MODE)
_OVR[110]=_CAL[3] _OVR[111]=_CAL[4] _OVR[112]=_CAL[5]
ENDIF
_OVR[113]=0
IF ((_KINTYP==24) AND (AXSTRING(_RAX2)<>"NO_AXIS"))
IF _TC>1000
_OVR[113]=$AC_TRAFO_CORR_ELEM_T[2,2]
ENDIF
ENDIF
IF _LOG_ON
WRITE(_LOG,_LOGFILE,";Adapt REF _OVR[11]="<<_OVR[11]<<" mea diff: _OVR[110]="<<_OVR[110]<<" _OVR[111]="<<_OVR[111]<<" _OVR[112]="<<_OVR[112]<<" | _OVR[113]="<<_OVR[113]<<"corr_elem ref head")
ENDIF
ENDIF
_III=0
_RA1:
FOR _II=0 TO _CMEA1-1
_POS1=_RA1_POS[_II]
_POS2=_RA2_OFF
IF (S_MVAR _DEC1)==3
_POS2=_RA2_POS[_III]
ENDIF
IF ((S_MVAR _DEC1)<3) AND (AXSTRING(_RAX2)<>"NO_AXIS")
_POS2=S_POS_RA2
ENDIF
IF (_POS2==_RA2_OFF) AND (_POS1==_RA1_OFF)
FOR _I=0 TO 2
_OVR[_SOVR+5+(5*(_II+(_CMEA1*_III)))+_I]=_OVR[_SOVR+_I]
IF _III==0
_MEA_MKS[1+_II,_I]=_MEA_MKS[0,_I]
_MEA_MKS_OLD[1+_II,_I]=_MEA_MKS_OLD[0,_I]
ENDIF
ENDFOR
_OVR[_SOVR+5+3+(5*(_II+(_CMEA1*_III)))]=SET(_POS1,_POS2)
_MEA_MKS[1+_II,3]=SET(_POS1,_POS2)
_MEA_DIAM[1+_II+(_CMEA1*_III)]=_MEA_DIAM[0]
IF _LOG_ON
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_LOGFILE,<<_POS1<<"|"<<_POS2<<"|"<<(TRUNC(_MEA_MKS[0,0]*10000)/10000)<<"|"<<(TRUNC(_MEA_MKS[0,1]*10000)/10000)<<"|"<<(TRUNC(_MEA_MKS[0,2]*10000)/10000)<<"|0.0000|0.0000|0.0000|0.0000|"<<_MEA_MKS_OLD[0,0]<<"|"<<_MEA_MKS_OLD[0,1]<<"|"<<_MEA_MKS_OLD[0,2])
ELSE
WRITE(_LOG,_LOGFILE,<<_POS1<<"|--|"<<(TRUNC(_MEA_MKS[0,0]*10000)/10000)<<"|"<<(TRUNC(_MEA_MKS[0,1]*10000)/10000)<<"|"<<(TRUNC(_MEA_MKS[0,2]*10000)/10000)<<"|0.0000|0.0000|0.0000|0.0000|"<<_MEA_MKS_OLD[0,0]<<"|"<<_MEA_MKS_OLD[0,1]<<"|"<<_MEA_MKS_OLD[0,2])
ENDIF
ENDIF
FOR _I=0 TO 5
_OVR[60+_I]=_MOVR[_I]
ENDFOR
_OVR[40]=2
ELSE
ORIAXES
ORIMKS
_ID_TOFFL=1
IF (($SC_TOOL_LENGTH_CONST>16) AND ($SC_TOOL_LENGTH_CONST<20))
IF (($SC_TOOL_LENGTH_TYPE==3) OR ($SC_TOOL_LENGTH_TYPE==1))
_ID_TOFFL=(((($SC_TOOL_LENGTH_CONST-17)*2)+$P_GG[6]-1)MOD 3)+1
ENDIF
IF $SC_TOOL_LENGTH_TYPE==2
_ID_TOFFL=((ABS($SC_TOOL_LENGTH_CONST-19)+$P_GG[6]-1) MOD 3)+1
ENDIF
ENDIF
TOFFL[_ID_TOFFL]=0
TOFFL[_ID_TOFFL]= S_SETV/2+S_FA
IF (((S_MVAR _DEC1)==3)AND(_MEA_RA[2]==1))
IF ISVAR ("$SCS_MEA_KIN_PREPOS_RA")
IF (($SCS_MEA_KIN_PREPOS_RA>0) AND (_II==0))
_RA1_ZW_POS[2]=_POS2-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[1]/ABS(_DISTANCE[1])
IF _LOG_ON
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX2)<<"="<<_RA1_ZW_POS[2])
ENDIF
CUST_800(996,_TC,_RA1_ZW_POS[2],_POS1)
ENDIF
ENDIF
CUST_800(996,_TC,_POS2,_POS1)
ELSE
IF ISVAR ("$SCS_MEA_KIN_PREPOS_RA")
IF (($SCS_MEA_KIN_PREPOS_RA>0) )
IF ((_II==0) AND (((_RA1_POS[1]+360)MOD 360)==((S_START_RA1+360)MOD 360)) AND (_RA1_POS[0]<>_RA1_OFF)) OR ((_II==1)AND(_RA1_POS[0]==_RA1_OFF)AND(((_RA1_POS[1]+360)MOD 360)==((S_START_RA1+360)MOD 360)))
_RA1_ZW_POS[1]=SET(_POS1-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[0]/ABS(_DISTANCE[0]),0)
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_RA1_ZW_POS[2]=_POS2-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[1]/ABS(_DISTANCE[1])
ENDIF
IF _LOG_ON
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX1)<<"="<<_RA1_ZW_POS[1]<<" und "<<AXSTRING(_RAX2)<<"="<<_RA1_ZW_POS[2])
ELSE
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX1)<<"="<<_RA1_ZW_POS[1])
ENDIF
ENDIF
CUST_800(996,_TC,_RA1_ZW_POS[1],_RA1_ZW_POS[2])
ENDIF
ENDIF
ENDIF
CUST_800(996,_TC,_POS1,_POS2)
ENDIF
ORIAXES
ORIMKS
TOFFL[_ID_TOFFL]=0
TOROTOF
IF _G17_18_19==1
TOROT
ELSE
IF _G17_18_19==2
TOROTY
ELSE
TOROTX
ENDIF
ENDIF
IF _TT
M01
ELSE
_POS[0]=$P_EP[_XX]*_FAK1 _POS[1]=$P_EP[_YY]*_FAK1 _POS[2]=$P_EP[_ZZ]*_FAK1
_MODE=2
CYCLE216(_CAL,_MODE)
_MODE=8
_CAL[0]=REP(0)
_CAL[0]=S_SETV1
_CAL[2]=-((S_MVAR _DEC3)-4)/2
IF _KINTYP==40
IF _TC>1000
_CAL[3]=SET(_POS1,_DIR_RA1[0],_DIR_RA1[1],_DIR_RA1[2],_POS2,_DIR_RA2[0],_DIR_RA2[1],_DIR_RA2[2])
ELSE
_CAL[3]=SET(_POS2,_DIR_RA2[0],_DIR_RA2[1],_DIR_RA2[2],_POS1,_DIR_RA1[0],_DIR_RA1[1],_DIR_RA1[2])
ENDIF
ENDIF
IF _KINTYP==56
IF _TC>1000
_CAL[3]=SET(_POS1,_DIR_RA1[0],_DIR_RA1[1],_DIR_RA1[2])
ELSE
_CAL[3]=SET(_POS2,_DIR_RA2[0],_DIR_RA2[1],_DIR_RA2[2])
ENDIF
ENDIF
CYCLE216(_CAL,_MODE)
_SETV1=_CAL[1]
CYCLE997(_MVARC997,S_KNUM,S_PRNUM,S_SETV,S_FA,S_TSA,_SETV1,90,_POS[0],_POS[1],_POS[2]-S_SETV/2-S_FA,,,,,,,0,S_NMSP,,S_DMODE,)
IF _DM_TOL<>0
_OVR[72]=_OVR[4]
IF _DM_TOL<ABS(S_SETV/_FAK2-_OVR[4])
_SERR=""<<_II+_CMEA1*_III+1<<"."
GOTOF _ERR5
ENDIF
ENDIF
IF _SD55740_0==0
AX[_XX]=_POS[0] AX[_YY]=_POS[1] AX[_ZZ]=_POS[2]
ELSE
MEAS=_H_ME AX[_XX]=_POS[0] AX[_YY]=_POS[1] AX[_ZZ]=_POS[2]
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR0
ENDIF
IF (S_MVAR _DEC1)==3
IF _MEC>0
_E_DATA[_II+(S_CMEA_RA1*_III),0]=_OVR[29]+$VA_MEC_COMP_VAL[_XX]
_E_DATA[_II+(S_CMEA_RA1*_III),1]=_OVR[30]+$VA_MEC_COMP_VAL[_YY]
_E_DATA[_II+(S_CMEA_RA1*_III),2]=_OVR[31]+$VA_MEC_COMP_VAL[_ZZ]
ELSE
FOR _I=0 TO 2
_E_DATA[_II+(S_CMEA_RA1*_III),_I]=_OVR[29+_I]+_E996_COMP_VAL_GEO[_I]
IF ((ISVAR("$MC_E996_COMP_LIMIT["<<_I<<"]")) AND (_MEC==0))
IF (ABS(_E_DATA[_II+(_CMEA1*_III),_I])>$MC_E996_COMP_LIMIT[_I])
_SERR="24 VCS_Rotar MD62736"
GOTOF _ERR20
ENDIF
ENDIF
ENDFOR
ENDIF
ENDIF
_OVR[_SOVR+5+(5*(_II+(_CMEA1*_III)))]=SET(_OVR[29],_OVR[30],_OVR[31],_POS1,_POS2)
_LINE[0]=<<(TRUNC(_OVR[29]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_OVR[30]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_OVR[31]*_MD10200)/_MD10200)<<"|"<<TRUNC((SQRT(POT(_OVR[29])+POT(_OVR[30])+POT(_OVR[31])))*_MD10200)/_MD10200
_CAL[0]=SET(_OVR[5],_OVR[6],_OVR[7])
REPEAT _WKS_MKS_A _WKS_MKS_E
_MEA_MKS[1+_II,0]=SET(_CAL[0],_CAL[1],_CAL[2],_POS1,_POS2)
_LINE[0]=<<(TRUNC(_CAL[0]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[1]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[2]*_MD10200)/_MD10200)<<"|"<<_LINE[0]
_CAL[0]=SET(_OVR[1],_OVR[2],_OVR[3])
REPEAT _WKS_MKS_A _WKS_MKS_E
_MEA_MKS_OLD[1+_II,0]=SET(_CAL[0],_CAL[1],_CAL[2])
_LINE[0]=_LINE[0]<<"|"<<(TRUNC(_CAL[0]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[1]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[2]*_MD10200)/_MD10200)
_MEA_DIAM[1+_II+(_CMEA1*_III)]=_OVR[4]
IF _LOG_ON
IF AXSTRING(_RAX2)<>"NO_AXIS"
WRITE(_LOG,_LOGFILE,<<_POS1<<"|"<<_POS2<<"|"<<_LINE[0])
ELSE
WRITE(_LOG,_LOGFILE,<<_POS1<<"|--|"<<_LINE[0])
ENDIF
IF (_E996_ACT<>0)
IF AXSTRING(_RAX2)<>"NO_AXIS"
WRITE(_LOG,_LOGFILE,"; _E996_COMP_VAL_GEO  "<<AXSTRING(_RAX1)<<"="<<$P_EP[_RAX1]<<" "<<AXSTRING(_RAX2)<<"="<<$P_EP[_RAX2]<<": "<<ROUND(_E996_COMP_VAL_GEO[0]*_MD10200)/_MD10200<<"  "<<ROUND(_E996_COMP_VAL_GEO[1]*_MD10200)/_MD10200<<"  "<<ROUND(_E996_COMP_VAL_GEO[2]*_MD10200)/_MD10200)
ELSE
WRITE(_LOG,_LOGFILE,"; _E996_COMP_VAL_GEO  "<<AXSTRING(_RAX1)<<"="<<$P_EP[_RAX1]<<": "<<ROUND(_E996_COMP_VAL_GEO[0]*_MD10200)/_MD10200<<"  "<<ROUND(_E996_COMP_VAL_GEO[1]*_MD10200)/_MD10200<<"  "<<ROUND(_E996_COMP_VAL_GEO[2]*_MD10200)/_MD10200)
ENDIF
ENDIF
IF (_MEC_ACT<>0)
IF AXSTRING(_RAX2)<>"NO_AXIS"
WRITE(_LOG,_LOGFILE,"; $VA_MEC_COMP_VAL "<<AXSTRING(_RAX1)<<"="<<$P_EP[_RAX1]<<" "<<AXSTRING(_RAX2)<<"="<<$P_EP[_RAX2]<<": "<<ROUND($VA_MEC_COMP_VAL[_XX]*_MD10200)/_MD10200<<"  "<<ROUND($VA_MEC_COMP_VAL[_YY]*_MD10200)/_MD10200<<"  "<<ROUND($VA_MEC_COMP_VAL[_ZZ]*_MD10200)/_MD10200)
ELSE
WRITE(_LOG,_LOGFILE,"; $VA_MEC_COMP_VAL "<<AXSTRING(_RAX1)<<"="<<$P_EP[_RAX1]<<": "<<ROUND($VA_MEC_COMP_VAL[_XX]*_MD10200)/_MD10200<<"  "<<ROUND($VA_MEC_COMP_VAL[_YY]*_MD10200)/_MD10200<<"  "<<ROUND($VA_MEC_COMP_VAL[_ZZ]*_MD10200)/_MD10200)
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
ENDFOR
IF ((AXSTRING(_RAX2)<>"NO_AXIS") AND ((S_MVAR _DEC5)<>4))
IF ((S_MVAR _DEC1)==3) AND (S_CMEA_RA2>0)
_III=_III+1
REPEAT _RA1 P=S_CMEA_RA2-1
ENDIF
ENDIF
IF (((S_MVAR _DEC1)==3) OR (AXSTRING(_RAX2)=="NO_AXIS")) GOTOF _CALC
_RA2:
_H=0
_III=_OVR[120]+1
_GST2=0
FOR _II=0 TO S_CMEA_RA2-1
_POS1=S_POS_RA1
_POS2=_RA2_POS[_II]
IF (_POS2==_RA2_OFF) AND (_POS1==_RA1_OFF)
FOR _I=0 TO 2
_OVR[_SOVR+5*(_III+_II)+_I]=_OVR[_SOVR+_I]
_MEA_MKS[_II+_III,_I]=_MEA_MKS[0,_I]
_MEA_MKS_OLD[_II+_III,_I]=_MEA_MKS_OLD[0,_I]
ENDFOR
_OVR[_SOVR+3+5*(_II+_III)]=SET(_POS1,_POS2)
_MEA_MKS[_II+_III,3]=SET(_POS1,_POS2)
_MEA_DIAM[_II+_III]=_MEA_DIAM[0]
FOR _I=0 TO 5
_OVR[60+_I]=_MOVR[_I]
ENDFOR
_GST2=1
ELSE
ORIAXES
ORIMKS
TOFFL[_ID_TOFFL]= S_SETV/2+S_FA
IF ((_II==0) OR ((_II==1) AND (_GST2==1)))
IF (-S_START_RA1+S_END_RA1)==360
IF _RA1_POS[S_CMEA_RA1-1]<S_END_RA1
_RA1_ZW_POS[10]=_RA1_POS[S_CMEA_RA1-1]+(((_POS1+360)-_RA1_POS[S_CMEA_RA1-1])/2)
ELSE
_RA1_ZW_POS[10]=_RA1_POS[S_CMEA_RA1-1]+(((_POS1)-_RA1_POS[S_CMEA_RA1-1])/2)
ENDIF
ELSE
_RA1_ZW_POS[10]=_RA1_POS[S_CMEA_RA1-1]+((_POS1-_RA1_POS[S_CMEA_RA1-1])/2)
ENDIF
IF (_HIRTH==1) OR (_HIRTH==10)
_RA1_ZW_POS[10]=_RA1_ZW_POS[10]-(_RA1_ZW_POS[10] MOD _HIRTH_STEP[0])
ENDIF
IF _POS2<>_RA2_OFF
IF (($MA_ROT_IS_MODULO[_RAX2]==1) AND ((_RA2_POS[0]<_RA2_POS[1]) AND (_RA2_OFF==0)))
_RA1_ZW_POS[11]=_POS2+(360-_POS2)/2
ELSE
_RA1_ZW_POS[11]=_RA2_OFF+((_POS2-_RA2_OFF)/2)
ENDIF
ELSE
_RA1_ZW_POS[11]=S_START_RA2
ENDIF
IF (_HIRTH==2) OR (_HIRTH==20)
_RA1_ZW_POS[11]=_RA1_ZW_POS[11]-(_RA1_ZW_POS[11] MOD _HIRTH_STEP[1])
ENDIF
CUST_800(996,_TC,_RA1_ZW_POS[10],_RA1_ZW_POS[11])
ENDIF
CUST_800(996,_TC,_POS1,_POS2)
IF ISVAR ("$SCS_MEA_KIN_PREPOS_RA")
IF (($SCS_MEA_KIN_PREPOS_RA>0)AND((_II==0) OR ((_II==1) AND (_GST2==1))))
_POS[0]=SET($P_EP[_RAX1],0)
_RA1_ZW_POS[1]=SET(_POS[0]-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[0]/ABS(_DISTANCE[0]),0)
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_POS[0]=SET($P_EP[_RAX1],$P_EP[_RAX2])
_RA1_ZW_POS[2]=_POS[1]-$SCS_MEA_KIN_PREPOS_RA*_DISTANCE[1]/ABS(_DISTANCE[1])
ENDIF
IF _LOG_ON
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX1)<<"="<<_RA1_ZW_POS[1])
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_LOGFILE,"; Vorpositionieren auf "<<AXSTRING(_RAX1)<<"="<<_RA1_ZW_POS[1]<<" und "<<AXSTRING(_RAX2)<<"="<<_RA1_ZW_POS[2])
ENDIF
ENDIF
CUST_800(996,_TC,_RA1_ZW_POS[1],_RA1_ZW_POS[2])
CUST_800(996,_TC,_POS[0],_POS[1])
ENDIF
ENDIF
ORIAXES
ORIMKS
TOFFL[_ID_TOFFL]=0
TOROTOF
IF _G17_18_19==1
TOROT
ELSE
IF _G17_18_19==2
TOROTY
ELSE
TOROTX
ENDIF
ENDIF
IF _TT
M01
ELSE
_POS[0]=$P_EP[_XX]*_FAK1 _POS[1]=$P_EP[_YY]*_FAK1 _POS[2]=$P_EP[_ZZ]*_FAK1
_MODE=2
CYCLE216(_CAL,_MODE)
_MODE=8
_CAL[0]=REP(0)
_CAL[0]=S_SETV2
_CAL[2]=-((S_MVAR _DEC3)-4)/2
IF _KINTYP==40
_CAL[3]=SET(_POS1,_DIR_RA1[0],_DIR_RA1[1],_DIR_RA1[2],_POS2,_DIR_RA2[0],_DIR_RA2[1],_DIR_RA2[2])
ENDIF
IF _KINTYP==56
IF _TC>1000
_CAL[3]=SET(_POS1,_DIR_RA1[0],_DIR_RA1[1],_DIR_RA1[2])
ELSE
_CAL[3]=SET(_POS2,_DIR_RA2[0],_DIR_RA2[1],_DIR_RA2[2])
ENDIF
ENDIF
CYCLE216(_CAL,_MODE)
_SETV1=_CAL[1]
CYCLE997(_MVARC997,S_KNUM,S_PRNUM,S_SETV,S_FA,S_TSA,_SETV1,90,_POS[0],_POS[1],_POS[2]-S_SETV/2-S_FA,5,5,5,10,10,10,0,S_NMSP,,S_DMODE,)
IF _DM_TOL<>0
_OVR[75]=_OVR[4]
IF _DM_TOL<ABS(S_SETV/_FAK2-_OVR[4])
_SERR=""<<_II+1<<"."
GOTOF _ERR6
ENDIF
ENDIF
IF _SD55740_0==0
AX[_XX]=_POS[0] AX[_YY]=_POS[1] AX[_ZZ]=_POS[2]
ELSE
MEAS=_H_ME AX[_XX]=_POS[0] AX[_YY]=_POS[1] AX[_ZZ]=_POS[2]
STOPRE
IF $AC_MEA[_H_ME]<>0 GOTOF _ERR0
ENDIF
_OVR[40]=_OVR[40]-10
ENDIF
_OVR[_SOVR+5*(_III+_II)]=SET(_OVR[29],_OVR[30],_OVR[31],_POS1,_POS2)
_LINE[0]=<<(TRUNC(_OVR[29]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_OVR[30]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_OVR[31]*_MD10200)/_MD10200)<<"|"<<TRUNC((SQRT(POT(_OVR[29])+POT(_OVR[30])+POT(_OVR[31])))*10000)/10000
_CAL[0]=SET(_OVR[5],_OVR[6],_OVR[7])
REPEAT _WKS_MKS_A _WKS_MKS_E
_MEA_MKS[_III+_II,0]=SET(_CAL[0],_CAL[1],_CAL[2],_POS1,_POS2)
_LINE[0]=<<(TRUNC(_CAL[0]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[1]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[2]*_MD10200)/_MD10200)<<"|"<<_LINE[0]
_CAL[0]=SET(_OVR[1],_OVR[2],_OVR[3])
REPEAT _WKS_MKS_A _WKS_MKS_E
_MEA_MKS_OLD[_III+_II,0]=SET(_CAL[0],_CAL[1],_CAL[2])
_LINE[0]=_LINE[0]<<"|"<<(TRUNC(_CAL[0]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[1]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[2]*_MD10200)/_MD10200)
_MEA_DIAM[_III+_II]=_OVR[4]
IF _LOG_ON
WRITE(_LOG,_LOGFILE,<<_POS1<<"|"<<_POS2<<"|"<<_LINE[0])
ENDIF
ENDIF
ENDFOR
ENDIF
_OVR[50]=SET(_WZ_L[0],_WZ_L[1],_WZ_L[2])
_CALC:
IF ((S_MVAR _DEC4)<2)
ORIMKS
ORIAXES
TOFFL[_ID_TOFFL]= S_SETV/2+S_FA
CUST_800(996,_TC,_RA1_OFF,_RA2_OFF)
ORIAXES
ORIMKS
TOFFL[_ID_TOFFL]=0
TOROTOF
IF _G17_18_19==1
TOROT
ELSE
IF _G17_18_19==2
TOROTY
ELSE
TOROTX
ENDIF
ENDIF
ENDIF
_OVI[2]=9961
CUST_MEACYC(2)
_OVI[2]=9960
IF $P_DRYRUN GOTOF _ERR15
IF _TC>1000
IF (_KINTYP==24)
_CORR_OLD[0]=SET($AC_TRAFO_CORR_ELEM_T[1,0],$AC_TRAFO_CORR_ELEM_T[1,1],$AC_TRAFO_CORR_ELEM_T[1,2])
ELSE
_CORR_OLD[0]=SET($AC_TRAFO_CORR_ELEM_P[0,0],$AC_TRAFO_CORR_ELEM_P[0,1],$AC_TRAFO_CORR_ELEM_P[0,2])
ENDIF
IF AXSTRING(_RAX2)<>"NO_AXIS"
IF (_KINTYP==24)
_CORR_OLD[3]=SET($AC_TRAFO_CORR_ELEM_T[2,0],$AC_TRAFO_CORR_ELEM_T[2,1],$AC_TRAFO_CORR_ELEM_T[2,2])
ENDIF
IF (_KINTYP==56)
_CORR_OLD[3]=SET($AC_TRAFO_CORR_ELEM_T[1,0],$AC_TRAFO_CORR_ELEM_T[1,1],$AC_TRAFO_CORR_ELEM_T[1,2])
ENDIF
IF (_KINTYP==40)
_CORR_OLD[0]=SET($AC_TRAFO_CORR_ELEM_P[1,0],$AC_TRAFO_CORR_ELEM_P[1,1],$AC_TRAFO_CORR_ELEM_P[1,2])
_CORR_OLD[3]=SET($AC_TRAFO_CORR_ELEM_P[0,0],$AC_TRAFO_CORR_ELEM_P[0,1],$AC_TRAFO_CORR_ELEM_P[0,2])
ENDIF
ENDIF
ELSE
IF _TC_KIN==0
_CORR_OLD[0]=SET($TC_CARR4[_TC],$TC_CARR5[_TC],$TC_CARR6[_TC])
_CORR_OLD[3]=SET($TC_CARR15[_TC],$TC_CARR16[_TC],$TC_CARR17[_TC])
ELSE
_I=NAMETOINT("$NK_NAME",$TC_CARR_CORR_ELEM[_TC,1],TRUE)
_CORR_OLD[0]=SET($NK_OFF_DIR[_I,0],$NK_OFF_DIR[_I,1],$NK_OFF_DIR[_I,2])
_I=NAMETOINT("$NK_NAME",$TC_CARR_CORR_ELEM[_TC,2],TRUE)
IF _I>0
_CORR_OLD[3]=SET($NK_OFF_DIR[_I,0],$NK_OFF_DIR[_I,1],$NK_OFF_DIR[_I,2])
ENDIF
ENDIF
ENDIF
_OVI[2]=9960
IF (S_PROTSTAT[0]==1) OR (S_PROTMEA_RESULT_DISPLAY<>0)
_OVI[3]=S_MVAR
_OVI[9]=9960
IF ((S_MVAR _DEC4)<2)
IF (AXSTRING(_RAX2)=="NO_AXIS")
_OVR[122]=SET(0,0,0)
ELSE
_OVR[122]=SET(S_START_RA2,S_END_RA2,S_POS_RA1)
ENDIF
_OVR[125]=SET(S_START_RA1,S_END_RA1,S_POS_RA2)
IF (S_MVAR _DEC1==3)
IF _OVR[121]==0
_OVR[128]=_OVR[120]
ELSE
_OVR[128]=_OVR[120]*_OVR[121]
ENDIF
ELSE
_OVR[128]=_OVR[120]+_OVR[121]
ENDIF
ENDIF
_PROTVAL[26]=""
_H=0
IF _TC>1000
_H=-1000
ENDIF
IF AXSTRING(_RAX2)=="NO_AXIS"
_PROTVAL[25]=<<S_TNAME<<" / "<<_TC+_H<<" ,"<<AXSTRING(_RAX1)<<",--"
ELSE
_PROTVAL[25]=<<S_TNAME<<" / "<<_TC+_H<<" ,"<<AXSTRING(_RAX1)<<","<<AXSTRING(_RAX2)
ENDIF
FOR _I=1 TO _ANZGES
FOR _II=0 TO 2
IF _MAX[_II]<_OVR[_SOVR+5*_I+_II]
_MAX[_II]=TRUNC(_OVR[_SOVR+5*_I+_II]*100000000)/100000000
ENDIF
IF _MIN[_II]>_OVR[_SOVR+5*_I+_II]
_MIN[_II]=TRUNC(_OVR[_SOVR+5*_I+_II]*100000000)/100000000
ENDIF
ENDFOR
ENDFOR
_PROTVAL[27]=_MAX[0]<<","<<_MAX[1]<<","<<_MAX[2]<<","<<_MIN[0]<<","<<_MIN[1]<<","<<_MIN[2]
_PROTVAL[28]=""
_PROTVAL[29]=" ,"<<(_G17_18_19+16)
_OVR[21]=SET(_CORR_OLD[0]/_FAK3,_CORR_OLD[1]/_FAK3,_CORR_OLD[2]/_FAK3)
_OVR[24]=SET(_CORR_OLD[3]/_FAK3,_CORR_OLD[4]/_FAK3,_CORR_OLD[5]/_FAK3)
IF (S_MVAR _DEC1)<3
REPEAT _PROT_A _PROT_E
IF _TC<1000
FOR _I=1 TO 20
EXECSTRING("_OVR["<<_I<<"]=$TC_CARR"<<_I<<"["<<_TC<<"]/_FAK3")
ENDFOR
ENDIF
ENDIF
_MVAR=S_MVAR
IF S_PROTSTAT[0]==1
CYCLE151
ENDIF
_II=0
_M_WRITE_RESULT_A:
IF S_PROTMEA_RESULT_DISPLAY<>0
_M_PROTNAME=_PROTNAME[0]
FOR _I=0 TO 5
_M_PROTFORM[_I]=_PROTFORM[_I]
ENDFOR
_M_PROTSTAT=S_PROTSTAT[0]
_M_TXT=_TXT[0]
_TXT[0]="0"
S_PROTSTAT[0]=1
_PROTFORM[0]=SET(1,66,1,1)
_PROTNAME[0]="//NC:/WKS.DIR/TEMP.WPD/RESULT_DISPLAY.TXT"
IF _II==0
DELETE(_LOG,_PROTNAME[0])
_II=1
ENDIF
CYCLE151
_PROTNAME[0]=_M_PROTNAME
FOR _I=0 TO 5
_PROTFORM[_I]=_M_PROTFORM[_I]
ENDFOR
S_PROTSTAT[0]=_M_PROTSTAT
_TXT[0]=_M_TXT
ENDIF
_M_WRITE_RESULT_E:
ENDIF
IF S_MVAR _DEC1 <>3
_MVAR_CALC=S_MVAR-(S_MVAR _DEC4)*1000
_OVR[114]=SET(0,0,0,0,0,0)
_OVR[999]=1
_H=0
REPEAT _M_CALC_A _M_CALC_E
_OVR[999]=0
_TOL_ON=0
IF _OVI[9]==62317
_TOL_ON=1
ENDIF
IF $SCS_MEA_KIN_MIN_ANG_TRIANGLE<>0
IF _OVR[120]==3
_I=1 _II=2 _III=3
_SERR=<<"G Axis:"<<AXSTRING(_RAX1)<<" -> TVLmin="
REPEAT _CALC_IW_A _CALC_IW_E
ENDIF
IF ((AXSTRING(_RAX2)<>"NO_AXIS") AND (_OVR[121]==3))
_I=1+_OVR[120] _II=_I+1 _III=_II+1
_SERR=<<"G Axis:"<<AXSTRING(_RAX2)<<" -> TVLmin="
REPEAT _CALC_IW_A _CALC_IW_E
ENDIF
ENDIF
_GEO_MITTEL[0]=SET(0,0,0)
FOR _I=0 TO 2
FOR _II=1 TO _ANZGES
_GEO_MITTEL[_I]=_GEO_MITTEL[_I]+POT(_OVR[_SOVR+5*_II+_I])
ENDFOR
_GEO_MITTEL[_I]=SQRT(_GEO_MITTEL[_I]/_ANZGES)
_GEO_MITTEL[_I]=ROUND(_GEO_MITTEL[_I]*10000)/10000
ENDFOR
_CORR_LAGE[0]=SQRT(POT(_CORR_OLD[0]-_OVR[21])+POT(_CORR_OLD[1]-_OVR[22])+POT(_CORR_OLD[2]-_OVR[23]))
_CORR_LAGE[1]=SQRT(POT(_CORR_OLD[3]-_OVR[24])+POT(_CORR_OLD[4]-_OVR[25])+POT(_CORR_OLD[5]-_OVR[26]))
_DIR_RA[0]=SET(_DIR_RA1[0],_DIR_RA1[1],_DIR_RA1[2])
_H=0
_ANZ=_OVR[120]
_III=1
_CAL[0]=REP(0)
REPEAT _CALC_CIRC_A _CALC_CIRC_E
REPEAT _STAT_A _STAT_E
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_DIR_RA[0]=SET(_DIR_RA2[0],_DIR_RA2[1],_DIR_RA2[2])
_H=1
_ANZ=_OVR[121]
_III=_OVR[120]+1
REPEAT _CALC_CIRC_A _CALC_CIRC_E
REPEAT _STAT_A _STAT_E
ENDIF
ENDIF
IF (S_MVAR _DEC1==2)
_OVR_REF[0]=SET(_OVR[110],_OVR[111],_OVR[112],_OVR[113])
ENDIF
_OVR[111]=0 _OVR[112]=0
IF S_MVAR _DEC1 <>3
IF (_ROT_LAGE[0]>ABS($SN_CORR_TRAFO_DIR_MAX))AND ($SN_CORR_TRAFO_DIR_MAX<>0)
_OVR[111]=_ROT_LAGE[0]
_TOL_ON=2 _OVI[9]=62318
ENDIF
IF (_ROT_LAGE[1]>ABS($SN_CORR_TRAFO_DIR_MAX))AND ($SN_CORR_TRAFO_DIR_MAX<>0)
_TOL_ON=2 _OVI[9]=62318
_OVR[112]=_ROT_LAGE[1]
ENDIF
ENDIF
IF (S_PROTSTAT[0]==1) OR (S_PROTMEA_RESULT_DISPLAY<>0)
IF _TOL_ON>0
_I=0
_PROTVAL[29]="E ,"<<(_G17_18_19+16)
IF (ABS(_OVR[114])+ABS(_OVR[115])+ABS(_OVR[116]))<>0
_PROTVAL[29]=_PROTVAL[29]<<","<<"Rotary axis 1"
ELSE
_PROTVAL[29]=_PROTVAL[29]<<","
ENDIF
IF (ABS(_OVR[117])+ABS(_OVR[118])+ABS(_OVR[119]))<>0
_PROTVAL[29]=_PROTVAL[29]<<","<<"Rotary axis 2"
ELSE
_PROTVAL[29]=_PROTVAL[29]<<","
ENDIF
IF _OVR[111]>0
_PROTVAL[29]=_PROTVAL[29]<<","<<"Rotary axis 1"
ELSE
_PROTVAL[29]=_PROTVAL[29]<<","
ENDIF
IF _OVR[112]>0
_PROTVAL[29]=_PROTVAL[29]<<","<<"Rotary axis 2"
ELSE
_PROTVAL[29]=_PROTVAL[29]<<","
ENDIF
IF S_PROTSTAT[0]==1
CYCLE151
ENDIF
REPEAT _M_WRITE_RESULT_A _M_WRITE_RESULT_E
ENDIF
IF (S_PROTMEA_RESULT_DISPLAY<>0) AND (_TOL_ON==0)
_PROTVAL[29]="V,"<<(_G17_18_19+16)
IF (S_MVAR _DEC1)<3
REPEAT _PROT_A _PROT_E
REPEAT _M_WRITE_RESULT_A _M_WRITE_RESULT_E
ENDIF
WRITE(_LOG,"//NC:/WKS.DIR/TEMP.WPD/RESULT_DISPLAY.TXT","")
IF (S_MVAR _DEC4)>1
WRITE(_LOG,"//NC:/WKS.DIR/TEMP.WPD/RESULT_DISPLAY.TXT","Overwrite kinematics data record , yes -> NC start, no -> reset")
WRITE(_LOG,"//NC:/WKS.DIR/TEMP.WPD/RESULT_DISPLAY.TXT","")
ENDIF
ENDIF
ENDIF
IF ((S_PROTMEA_RESULT_DISPLAY<>0) AND ($SCS_MEA_RESULT_MRD<>0))
CYCLE102(1,S_PROTMEA_RESULT_DISPLAY)
IF (((S_MVAR _DEC4)==0) AND (S_PROTMEA_RESULT_DISPLAY==3))
MSG("$83005")
M0
MSG("")
ENDIF
STOPRE
ENDIF
_MVAR_CALC=S_MVAR
IF (S_MVAR _DEC1==2)
_OVR[110]=SET(_OVR_REF[0],_OVR_REF[1],_OVR_REF[2],_OVR_REF[3])
ENDIF
_H=1
_M_CALC_A:
IF _TOL_ON>0
GOTOF _M_CALC_E
ENDIF
IF (S_MVAR _DEC1)<>3
_OVR[71]=_MEA_DIAM[0]
_MVARC122=_MVAR_CALC-(_MVAR_CALC _DEC1)
_MVARC122=_MVARC122-(_MVARC122 _DEC2)*10
_MVARC122=_MVARC122-(_MVARC122 _DEC3)*100
_MVARC122=_MVARC122-(_MVARC122 _DEC4)*1000+(S_MVAR _DEC1)*2000
_MVARC122=_MVARC122+(_MVAR_CALC _DEC4)*1000
IF _MVAR_CALC _DEC4 ==2
_MVARC122=_MVARC122-1000
ENDIF
_AMODEC996=S_AMODE-(S_AMODE _DEC2)*10
_CALC_RA_A:
IF _CMEA1+1==_OVR[120]
_ANZ=_CMEA1
ELSE
_ANZ=_OVR[120]
ENDIF
_III=1
_CALC_CIRC_A:
_CAL[0]=REP(0)
FOR _I=0 TO 2
FOR _II=0 TO _ANZ-1
IF ((($SCS_MEA_FUNCTION_MASK B_AND 'H100000')OR($SCS_MEA_FUNCTION_MASK B_AND 'H200000')) AND (_ANZ>3))
_CAL[(_II*3)+_I]=_MEA_MKS_OLD[_II+_III,_I]
ELSE
_CAL[(_II*3)+_I]=_MEA_MKS[_II+_III,_I]
ENDIF
ENDFOR
ENDFOR
_MODE=7
_CAL[39]=_ANZ
CYCLE216(_CAL,_MODE)
IF ((($SCS_MEA_FUNCTION_MASK B_AND 'H100000')OR($SCS_MEA_FUNCTION_MASK B_AND 'H200000')) AND (_ANZ>3))
_MODE=12
_CAL[7]=SET(_CAL[3],_CAL[4],_CAL[5])
_LINE[0]=<<(TRUNC(_CAL[7]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[8]*_MD10200)/_MD10200)<<"|"<<(TRUNC(_CAL[9]*_MD10200)/_MD10200)
_CAL[4]=SET(_CAL[0],_CAL[1],_CAL[2])
_CAL[0]=_III
_CAL[1]=_III+_ANZ-1
_CAL[2]=_ANZ
CYCLE216(_CAL,_MODE)
IF ((_LOG_ON) AND (_H==0))
WRITE(_LOG,_LOGFILE,";$SCS_MEA_FUNCTION_MASK Bit21   "<<_LINE[0]<<" ==> "<<_CAL[3]<<"|"<<_CAL[4]<<"|"<<_CAL[5]<<"|"<<_CAL[6])
ENDIF
ENDIF
_CALC_CIRC_E:
IF _H==0
_DIR_RA1_CALC[0]=SET(_CAL[0],_CAL[1],_CAL[2])
ENDIF
_OFF_RA1[0]=SET(_CAL[3],_CAL[4],_CAL[5])
;IF (_MVAR_CALC _DEC5==5) OR ((_MVAR_CALC _DEC5)==1 AND (AXSTRING(_RAX2)<>"NO_AXIS"))
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_ANZ=_OVR[121]
_III=_OVR[120]+1
REPEAT _CALC_CIRC_A _CALC_CIRC_E
IF _H==0
_DIR_RA2_CALC[0]=SET(_CAL[0],_CAL[1],_CAL[2])
ENDIF
_OFF_RA2[0]=SET(_CAL[3],_CAL[4],_CAL[5])
ENDIF
_GST[0]=SET(_MEA_MKS[0,0],_MEA_MKS[0,1],_MEA_MKS[0,2])
; Grundstellung bei gemischter kinematik. Wenn die Tisch Achse nicht in Grundstellung beim vermessen des Tishes ist.
IF _KINTYP==56
IF ((S_POS_RA2<>_RA2_OFF) OR (S_POS_RA1<>_RA1_OFF))
FOR _I=0 TO _ANZGES
IF ((_MEA_MKS[_I,3]==_RA1_OFF) AND (_MEA_MKS[_I,4]==S_POS_RA2) AND ((_TC<1001)))
_GST[0]=SET(_MEA_MKS[_I,0],_MEA_MKS[_I,1],_MEA_MKS[_I,2])
ENDIF
IF ((_MEA_MKS[_I,4]==_RA2_OFF) AND (_MEA_MKS[_I,3]==S_POS_RA1) AND ((_TC>1000)))
_GST[0]=SET(_MEA_MKS[_I,0],_MEA_MKS[_I,1],_MEA_MKS[_I,2])
ENDIF
ENDFOR
ENDIF
ENDIF
_ACTFR_1[0]=SET(_OVR[66],_OVR[67],_OVR[68])
CYCLE122(_MVARC122,S_TNAME,_OFF_RA1,_OFF_RA2,_GST,_DIR_RA1_CALC,_DIR_RA2_CALC,_WZ_L,S_SETV4,_ACTFR_1,S_DMODE,_AMODEC996)
_OVI[2]=9960
IF ((_MVAR_CALC _DEC1)==1)
_NV_ACT=$P_GG[8]-1
_OVR[104]=_NV_ACT
_OVR[105]=_TC
IF _TC>1000
_NV_REF_DIFF[0]=$AC_TRAFO_CORR_ELEM_T[1,0]-_CORR_ELEM_T[0]
_NV_REF_DIFF[1]=$AC_TRAFO_CORR_ELEM_T[1,1]-_CORR_ELEM_T[1]
_NV_REF_DIFF[2]=$AC_TRAFO_CORR_ELEM_T[1,2]-_CORR_ELEM_T[2]
ELSE
_NV_REF_DIFF[0]=SET($TC_CARR4[_TC]-_CORR_ELEM_T[0],$TC_CARR5[_TC]-_CORR_ELEM_T[1],$TC_CARR6[_TC]-_CORR_ELEM_T[2])
ENDIF
IF (_KIN_MODE[0] _DEC1)==4
_NV_REF_DIFF[0]=0
ENDIF
IF (_KIN_MODE[0] _DEC1)==5
_NV_REF_DIFF[1]=0
ENDIF
IF (_KIN_MODE[0] _DEC1)==6
_NV_REF_DIFF[2]=0
ENDIF
$P_UIFR[_NV_ACT,_XX,TR]=$P_UIFR[_NV_ACT,_XX,TR]+_NV_REF_DIFF[0]
$P_UIFR[_NV_ACT,_YY,TR]=$P_UIFR[_NV_ACT,_YY,TR]+_NV_REF_DIFF[1]
$P_UIFR[_NV_ACT,_ZZ,TR]=$P_UIFR[_NV_ACT,_ZZ,TR]+_NV_REF_DIFF[2]
_OVR[107]=(ROUND($P_UIFR[_NV_ACT,_XX,TR]*_MD10200)/_MD10200)
_OVR[108]=(ROUND($P_UIFR[_NV_ACT,_YY,TR]*_MD10200)/_MD10200)
_OVR[109]=(ROUND($P_UIFR[_NV_ACT,_ZZ,TR]*_MD10200)/_MD10200)
_NV_ACT=_NV_ACT+1
G[8]=_NV_ACT
IF _LOG_ON
WRITE(_LOG,_LOGFILE,";HEAD REF SAVED NPV  _OVR[107]="<<_OVR[107]<<" _OVR[108]="<<_OVR[108]<<" _OVR[109]="<<_OVR[109])
ENDIF
ENDIF
ENDIF
_M_CALC_E:
IF (($SCS_MEA_FUNCTION_MASK B_AND 'H800000') AND ((S_MVAR _DEC1)<>3))
IF _CMEA1+1==_OVR[120]
_ANZ=_CMEA1
ELSE
_ANZ=_OVR[120]
ENDIF
_III=1
_II=1
_CAL[0]=REP(0)
IF S_POS_RA2<>_RA2_OFF
_CAL[3]=S_POS_RA2
ENDIF
_CALC_ENC_A:
_CAL[0]=_III
_CAL[1]=_III+_ANZ-1
_CAL[2]=_ANZ
EXECSTRING("_CAL[4]=SET(_DIR_RA"<<_II<<"[0],_DIR_RA"<<_II<<"[1],_DIR_RA"<<_II<<"[2])")
EXECSTRING("_CAL[7]=SET(_OFF_RA"<<_II<<"[0],_OFF_RA"<<_II<<"[1],_OFF_RA"<<_II<<"[2])")
_MODE=13
CYCLE216(_CAL,_MODE)
EXECSTRING("_RA_NAME=<<AXSTRING(_RAX"<<_II<<")")
_FILE_COMP="/_N_CMA_DIR/_N_ENC_COMP_"<<_RA_NAME<<"_SPF"
IF _LOG_ON
WRITE(_LOG,_LOGFILE,"; write the file "<<_FILE_COMP)
ENDIF
IF (ISFILE(_FILE_COMP))
DELETE(_LOG,_FILE_COMP)
ENDIF
WRITE(_LOG,_FILE_COMP,"; "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF _CAL[3]<>0
WRITE(_LOG,_FILE_COMP,"; other axis "<<_CAL[3]<<" while measuring the "<<_RA_NAME<<" axsis")
ENDIF
WRITE(_LOG,_FILE_COMP,"CHANDATA("<<$P_CHANNO<<")")
FOR _I=0 TO (_CAL[2]-1)
WRITE(_LOG,_FILE_COMP,"$AA_ENC_COMP[0,"<<_I<<","<<_RA_NAME<<"]="<<_CAL[10+_I]<<"   ; Pos - "<<_RA_NAME<<" = "<<_CAL[30+_I])
ENDFOR
WRITE(_LOG,_FILE_COMP,"$AA_ENC_COMP_STEP[0,"<<_RA_NAME<<"]="<<_CAL[43])
EXECSTRING("WRITE(_LOG,_FILE_COMP,'"'$AA_ENC_COMP_MIN[0,'"'<<_RA_NAME<<'"']='"'<<S_START_RA"<<_II<<")")
EXECSTRING("WRITE(_LOG,_FILE_COMP,'"'$AA_ENC_COMP_MAX[0,'"'<<_RA_NAME<<'"']='"'<<S_END_RA"<<_II<<")")
IF _II==1
IF $MA_ROT_IS_MODULO[_RAX1]==1
WRITE(_LOG,_FILE_COMP,"$AA_ENC_COMP_IS_MODULO[0,"<<_RA_NAME<<"]=1")
ELSE
WRITE(_LOG,_FILE_COMP,"$AA_ENC_COMP_IS_MODULO[0,"<<_RA_NAME<<"]=0")
ENDIF
ELSE
IF $MA_ROT_IS_MODULO[_RAX2]==1
WRITE(_LOG,_FILE_COMP,"$AA_ENC_COMP_IS_MODULO[0,"<<_RA_NAME<<"]=1")
ELSE
WRITE(_LOG,_FILE_COMP,"$AA_ENC_COMP_IS_MODULO[0,"<<_RA_NAME<<"]=0")
ENDIF
ENDIF
WRITE(_LOG,_FILE_COMP,"M17")
_CALC_ENC_E:
IF (AXSTRING(_RAX2)<>"NO_AXIS")
_ANZ=_OVR[121]
IF _CMEA1+1==_OVR[120]
_III=_CMEA1+1
ELSE
_III=_OVR[120]+1
ENDIF
_II=2
_CAL[0]=REP(0)
IF S_POS_RA1<>_RA1_OFF
_CAL[3]=S_POS_RA1
ENDIF
REPEAT _CALC_ENC_A _CALC_ENC_E
ENDIF
ENDIF
IF (_TOL_ON >0)
_SERR=""
IF _TOL_ON==1
IF _SD55740_12==0
SETAL(62317,_SERR)
ELSE
SETAL(61362,_SERR)
ENDIF
ENDIF
IF _TOL_ON==2
IF (_ROT_LAGE[0]>ABS($SN_CORR_TRAFO_DIR_MAX))
_SERR=<<AXSTRING(_RAX1)<<" (ANG="<<_ROT_LAGE[0]<<") "
ENDIF
IF (_ROT_LAGE[1]>ABS($SN_CORR_TRAFO_DIR_MAX))AND ($SN_CORR_TRAFO_DIR_MAX<>0)
_SERR=<<AXSTRING(_RAX2)<<" (ANG="<<_ROT_LAGE[1]<<") "
ENDIF
IF _SD55740_12==0
SETAL(62318,_SERR)
ELSE
SETAL(61363,_SERR)
ENDIF
ENDIF
IF (S_PROTMEA_RESULT_DISPLAY<>0)
M0
STOPRE
ENDIF
ENDIF
CYCLE102()
_FILE_WRITE:
IF (S_MVAR _DEC1 == 3)
FOR _I=0 TO 2
IF AXSTRING($P_AXN1)==$MC_AXCONF_GEOAX_NAME_TAB[_I]
_H=$MC_AXCONF_GEOAX_ASSIGN_TAB[_I]
_XXCHAN=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_H-1])
ENDIF
IF AXSTRING($P_AXN2)==$MC_AXCONF_GEOAX_NAME_TAB[_I]
_H=$MC_AXCONF_GEOAX_ASSIGN_TAB[_I]
_YYCHAN=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_H-1])
ENDIF
IF AXSTRING($P_AXN3)==$MC_AXCONF_GEOAX_NAME_TAB[_I]
_H=$MC_AXCONF_GEOAX_ASSIGN_TAB[_I]
_ZZCHAN=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_H-1])
ENDIF
ENDFOR
_E_START1=S_START_RA1
_E_END1=S_END_RA1
_E_START2=S_START_RA2
_E_END2=S_END_RA2
_E_CMEA1=S_CMEA_RA1-1
_E_CMEA2=S_CMEA_RA2-1
_E_MOD1=$MA_MODULO_RANGE[_RAX1]
IF ((_E_END1-_E_START1)==_E_MOD1) OR ((_E_END1-_E_START1)==360)
_E_CMEA1=_E_CMEA1+1
ENDIF
IF _E_START1>_E_END1
_E_START1=S_END_RA1
_E_END1=S_START_RA1
ENDIF
IF AXSTRING(_RAX2)<>"NO_AXIS"
_E_MOD2=$MA_MODULO_RANGE[_RAX2]
IF ((_E_END2-_E_START2)==_E_MOD2) OR ((_E_END2-_E_START2)==360)
_E_CMEA2=_E_CMEA2+1
ENDIF
IF _E_START2>_E_END2
_E_START2=S_END_RA2
_E_END2=S_START_RA2
ENDIF
ENDIF
WRITE(_LOG,_FILE_COMP,"; "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND<<"     S_TNAME="<<S_TNAME)
WRITE(_LOG,_FILE_COMP,"; For the axis names the machine data 20080 AXCONF_CHANAX_NAME_TAB is used.")
IF _MEC==0
IF $P_GG[13]==3
WRITE(_LOG,_FILE_COMP,";G700")
ENDIF
IF $P_GG[13]==4
WRITE(_LOG,_FILE_COMP,";G710")
ENDIF
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_FILE_COMP,"E996DEF(1,"<<AXSTRING(_XXCHAN)<<","<<AXSTRING(_YYCHAN)<<","<<AXSTRING(_ZZCHAN)<<","<<AXSTRING(_RAX1)<<","<<_E_START1<<","<<_E_END1<<","<<_E_CMEA1<<","<<AXSTRING(_RAX2)<<","<<_E_START2<<","<<_E_END2<<","<<_E_CMEA2<<","<<_OVR[50]<<","<<_E_MOD1<<","<<_E_MOD2<<")")
ENDIF
IF (AXSTRING(_RAX2)=="NO_AXIS")
WRITE(_LOG,_FILE_COMP,"E996DEF(1,"<<AXSTRING(_XXCHAN)<<","<<AXSTRING(_YYCHAN)<<","<<AXSTRING(_ZZCHAN)<<","<<AXSTRING(_RAX1)<<","<<_E_START1<<","<<_E_END1<<","<<_E_CMEA1<<",,,,,"<<_OVR[50]<<","<<_E_MOD1<<")")
ENDIF
FOR _I=1 TO (_ANZGES)
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_FILE_COMP,<<AXSTRING(_RAX1)<<"="<<_OVR[_SOVR+3+_I*5]<<" "<<AXSTRING(_RAX2)<<"="<<_OVR[_SOVR+4+_I*5]<<" "<< AXSTRING(_XXCHAN)<<"="<<_E_DATA[_I-1,0]<<" "<<AXSTRING(_YYCHAN)<<"="<<_E_DATA[_I-1,1]<<" "<<AXSTRING(_ZZCHAN)<<"="<<_E_DATA[_I-1,2])
ENDIF
IF (AXSTRING(_RAX2)=="NO_AXIS")
WRITE(_LOG,_FILE_COMP,<<AXSTRING(_RAX1)<<"="<<_OVR[_SOVR+3+_I*5]<<" "<< AXSTRING(_XXCHAN)<<"="<<_E_DATA[_I-1,0]<<" "<<AXSTRING(_YYCHAN)<<"="<<_E_DATA[_I-1,1]<<" "<<AXSTRING(_ZZCHAN)<<"="<<_E_DATA[_I-1,2])
ENDIF
ENDFOR
WRITE(_LOG,_FILE_COMP,"EXECUTE()")
WRITE(_LOG,_FILE_COMP,"M17")
_SERR=<<"E996"
IF (S_MVAR _DEC4==1)
SETAL(62315,_SERR)
M0
STOPRE
CC_E996(<<S_TNAME)
ENDIF
IF (S_MVAR _DEC4==2)
CC_E996(<<S_TNAME)
ENDIF
ELSE
WRITE(_LOG,_FILE_COMP,"$SN_MEC_TABLE_ENABLE["<<_MEC_TAB<<"]=1")
WRITE(_LOG,_FILE_COMP,"$MA_MEC_ENABLE["<<AXSTRING(_XXCHAN)<<"]=0")
WRITE(_LOG,_FILE_COMP,"$MA_MEC_ENABLE["<<AXSTRING(_YYCHAN)<<"]=0")
WRITE(_LOG,_FILE_COMP,"$MA_MEC_ENABLE["<<AXSTRING(_ZZCHAN)<<"]=0")
WRITE(_LOG,_FILE_COMP,"NEWCONF")
WRITE(_LOG,_FILE_COMP,"; definition of in- and output axis")
WRITE(_LOG,_FILE_COMP,"$AN_MEC_INPUT_AXIS["<<_MEC_TAB<<",0]="<<AXSTRING(_RAX1)<<" ; input axis")
IF (AXSTRING(_RAX2)<>"NO_AXIS")
WRITE(_LOG,_FILE_COMP,"$AN_MEC_INPUT_AXIS["<<_MEC_TAB<<",1]="<<AXSTRING(_RAX2)<<" ; input axis")
ENDIF
IF ((_MEC _DEC2)==1)
WRITE(_LOG,_FILE_COMP,"; $AN_MEC_INPUT_AXIS["<<_MEC_TAB<<",0]="<<AXSTRING(_XXCHAN)<<" ;additional input axis")
WRITE(_LOG,_FILE_COMP,"; $AN_MEC_INPUT_AXIS["<<_MEC_TAB<<",0]="<<AXSTRING(_YYCHAN)<<" ;additional input axis")
WRITE(_LOG,_FILE_COMP,"; $AN_MEC_INPUT_AXIS["<<_MEC_TAB<<",0]="<<AXSTRING(_ZZCHAN)<<" ;additional input axis")
ENDIF
WRITE(_LOG,_FILE_COMP,"$AN_MEC_OUTPUT_AXIS["<<_MEC_TAB<<",0]="<<AXSTRING(_XXCHAN)<<" ; output axis")
WRITE(_LOG,_FILE_COMP,"$AN_MEC_OUTPUT_AXIS["<<_MEC_TAB<<",1]="<<AXSTRING(_YYCHAN)<<" ; output axis")
WRITE(_LOG,_FILE_COMP,"$AN_MEC_OUTPUT_AXIS["<<_MEC_TAB<<",2]="<<AXSTRING(_ZZCHAN)<<" ; output axis")
WRITE(_LOG,_FILE_COMP," ")
IF ((_MEC _DEC2)==1)
WRITE(_LOG,_FILE_COMP,";measuring position of calibration ball in MCS: "<<AXSTRING(_XXCHAN)<<"="<<_MEA_MKS[0,0]<<" "<<AXSTRING(_YYCHAN)<<"="<<_MEA_MKS[0,1]<<" "<<AXSTRING(_ZZCHAN)<<"="<<_MEA_MKS[0,1]<<" ")
ENDIF
_H=0
_BLOCK_A:
IF (AXSTRING(_RAX2)=="NO_AXIS")
_LINE[0]="$AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_OVR[_SOVR+8]
_LINE[1]="; $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET(<X>"
_LINE[2]="; $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET(<Y>"
_LINE[3]="; $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET(<Z>"
_LINE[4]="$AN_MEC_VAL["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_E_DATA[0,0]
_LINE[5]="$AN_MEC_VAL["<<_MEC_TAB<<",1,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_E_DATA[0,1]
_LINE[6]="$AN_MEC_VAL["<<_MEC_TAB<<",2,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_E_DATA[0,2]
FOR _II=1 TO S_CMEA_RA1-1
_LINE[0]=_LINE[0]<<","<<_OVR[_SOVR+3+(_II+1)*5]
_LINE[1]=_LINE[1]<<",<X>"
_LINE[2]=_LINE[2]<<",<Y>"
_LINE[3]=_LINE[3]<<",<Z>"
_LINE[4]=_LINE[4]<<","<<_E_DATA[_II,0]
_LINE[5]=_LINE[5]<<","<<_E_DATA[_II,1]
_LINE[6]=_LINE[6]<<","<<_E_DATA[_II,2]
ENDFOR
FOR _II=0 TO 6
IF ((_II==0) OR (_II>3) OR ((_MEC _DEC2)==1))
_LINE[_II]=_LINE[_II]<<")"
IF _H==0
WRITE(_LOG,_FILE_COMP,<<_LINE[_II])
ELSE
EXECSTRING(<<_LINE[_II])
ENDIF
ENDIF
ENDFOR
WRITE(_LOG,_FILE_COMP," ")
ELSE
FOR _I=0 TO S_CMEA_RA2-1
_LINE[0]=" $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_OVR[_SOVR+3+(_I*S_CMEA_RA1+1)*5]
_LINE[1]=" $AN_MEC_INPUT_POS["<<_MEC_TAB<<",1,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_OVR[_SOVR+4+(_I*S_CMEA_RA1+1)*5]
_LINE[2]="; $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET(<X>"
_LINE[3]="; $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET(<Y>"
_LINE[4]="; $AN_MEC_INPUT_POS["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET(<Z>"
_LINE[5]=" $AN_MEC_VAL["<<_MEC_TAB<<",0,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_E_DATA[_I*S_CMEA_RA1,0]
_LINE[6]=" $AN_MEC_VAL["<<_MEC_TAB<<",1,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_E_DATA[_I*S_CMEA_RA1,1]
_LINE[7]=" $AN_MEC_VAL["<<_MEC_TAB<<",2,"<<(S_CMEA_RA1*_I)<<"] = SET("<<_E_DATA[_I*S_CMEA_RA1,2]
FOR _II=1 TO S_CMEA_RA1-1
_LINE[0]=_LINE[0]<<","<<_OVR[_SOVR+3+(_I*S_CMEA_RA1+_II+1)*5]
_LINE[1]=_LINE[1]<<","<<_OVR[_SOVR+4+(_I*S_CMEA_RA1+_II+1)*5]
_LINE[2]=_LINE[2]<<",<X>"
_LINE[3]=_LINE[3]<<",<Y>"
_LINE[4]=_LINE[4]<<",<Z>"
_LINE[5]=_LINE[5]<<","<<_E_DATA[_I*S_CMEA_RA1+_II,0]
_LINE[6]=_LINE[6]<<","<<_E_DATA[_I*S_CMEA_RA1+_II,1]
_LINE[7]=_LINE[7]<<","<<_E_DATA[_I*S_CMEA_RA1+_II,2]
ENDFOR
FOR _II=0 TO 7
IF ((_II<2) OR (_II>4) OR ((_MEC _DEC2)==1))
_LINE[_II]=_LINE[_II]<<")"
IF _H==0
WRITE(_LOG,_FILE_COMP,<<_LINE[_II])
ELSE
EXECSTRING(<<_LINE[_II])
ENDIF
ENDIF
ENDFOR
WRITE(_LOG,_FILE_COMP," ")
ENDFOR
ENDIF
_BLOCK_E:
WRITE(_LOG,_FILE_COMP,"$AN_MEC_NUM_POINTS["<<_MEC_TAB<<"]="<<_ANZGES)
WRITE(_LOG,_FILE_COMP,"; activate table no."<<_MEC_TAB)
; WRITE(_LOG,_FILE_COMP,"$SN_MEC_TABLE_ENABLE["<<_MEC_TAB<<"]=1")
WRITE(_LOG,_FILE_COMP,"$MA_MEC_ENABLE["<<AXSTRING(_XXCHAN)<<"]=1")
WRITE(_LOG,_FILE_COMP,"$MA_MEC_ENABLE["<<AXSTRING(_YYCHAN)<<"]=1")
WRITE(_LOG,_FILE_COMP,"$MA_MEC_ENABLE["<<AXSTRING(_ZZCHAN)<<"]=1")
WRITE(_LOG,_FILE_COMP,"NEWCONF")
WRITE(_LOG,_FILE_COMP,"M17 ")
WRITE(_LOG,_FILE_COMP," ")
IF ((S_MVAR _DEC4<>0) AND ((_MEC _DEC2)==0))
_SERR=<<"MEC TAB["<<_MEC_TAB<<"]"
IF (S_MVAR _DEC4==1)
SETAL(62315,_SERR)
M0
STOPRE
ENDIF
$SN_MEC_TABLE_ENABLE[_MEC_TAB]=1
$MA_MEC_ENABLE[_XXCHAN]=0
$MA_MEC_ENABLE[_YYCHAN]=0
$MA_MEC_ENABLE[_ZZCHAN]=0
NEWCONF
$AN_MEC_INPUT_AXIS[_MEC_TAB, 0]=_RAX1
IF (AXSTRING(_RAX2)<>"NO_AXIS")
$AN_MEC_INPUT_AXIS[_MEC_TAB, 1]=_RAX2
ENDIF
$AN_MEC_OUTPUT_AXIS[_MEC_TAB, 0]=_XXCHAN
$AN_MEC_OUTPUT_AXIS[_MEC_TAB, 1]=_YYCHAN
$AN_MEC_OUTPUT_AXIS[_MEC_TAB, 2]=_ZZCHAN
_H=1
REPEAT _BLOCK_A _BLOCK_E
$AN_MEC_NUM_POINTS[_MEC_TAB]=_ANZGES
$SN_MEC_TABLE_ENABLE[_MEC_TAB]=1
$MA_MEC_ENABLE[_XXCHAN]=1
$MA_MEC_ENABLE[_YYCHAN]=1
$MA_MEC_ENABLE[_ZZCHAN]=1
NEWCONF
ENDIF
ENDIF
ENDIF
IF (S_PROTSTAT[0]==1) AND (_TOL_ON==0)
_MVAR=S_MVAR
_OVI[9]=9960
G4 F1
_PROTVAL[28]=""
IF ((ISVAR("_E996_ACTIVE_STATE")) AND (_MEC==0))
IF _E996_ACTIVE_STATE==0
_PROTVAL[28]="Status E996    : inactive"
ELSE
_PROTVAL[28]="Status E996    : active"
ENDIF
ENDIF
IF (S_MVAR _DEC1)<3
_PROTVAL[29]="V,"<<(_G17_18_19+16)
REPEAT _PROT_A _PROT_E
ENDIF
_MVAR=S_MVAR
CYCLE151
ENDIF
IF (S_MVAR _DEC1)<3 ; Bei Sttzpunktemessen nicht
IF (ISVAR("VCS_ACTIVE_STATE") AND ISVAR("VCSROTVEC_VERIFICATION"))
_FILE_VCS="/_N_CMA_DIR/_N_VCSROTVEC_SPF"
IF VCS_ACTIVE_STATE==1
IF VCSROTVEC_VERIFICATION==0
IF (ISFILE(_FILE_VCS))
DELETE(_LOG,_FILE_VCS)
ENDIF
WRITE(_LOG,_FILE_VCS,"// "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND<<"     "<<S_TNAME)
WRITE(_LOG,_FILE_VCS,"[ROTV1]")
IF ((_KINTYP<>24) AND (_TC>1000))
WRITE(_LOG,_FILE_VCS,<<_DIR_RA2_CALC[0]<<" "<<_DIR_RA2_CALC[1]<<" "<<_DIR_RA2_CALC[2])
WRITE(_LOG,_FILE_VCS,"[ROTV2]")
WRITE(_LOG,_FILE_VCS,<<_DIR_RA1_CALC[0]<<" "<<_DIR_RA1_CALC[1]<<" "<<_DIR_RA1_CALC[2])
ELSE
WRITE(_LOG,_FILE_VCS,<<_DIR_RA1_CALC[0]<<" "<<_DIR_RA1_CALC[1]<<" "<<_DIR_RA1_CALC[2])
WRITE(_LOG,_FILE_VCS,"[ROTV2]")
WRITE(_LOG,_FILE_VCS,<<_DIR_RA2_CALC[0]<<" "<<_DIR_RA2_CALC[1]<<" "<<_DIR_RA2_CALC[2])
ENDIF
WRITE(_LOG,_FILE_VCS,<<" ")
CCVCSREREAD()
ELSE
_FILE_VCS_VERIFI="/_N_CMA_DIR/_N_VCSROTVEC_VERIFI_SPF"
IF (ISFILE(_FILE_VCS_VERIFI))
DELETE(_LOG,_FILE_VCS_VERIFI)
ENDIF
WRITE(_LOG,_FILE_VCS_VERIFI,"//activ compensation for rotary axis oriantation")
_I=1
WHILE ((_LINE[0]<>" ") AND(_I<6))
READ(_LOG,_FILE_VCS,_I,_I,_LINE)
WRITE(_LOG,_FILE_VCS_VERIFI,<<_LINE[0])
_I=_I+1
ENDWHILE
WRITE(_LOG,_FILE_VCS_VERIFI,"// "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<" "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND<<"     "<<S_TNAME)
WRITE(_LOG,_FILE_VCS_VERIFI,"//measured rotary axis orientation with activ compensation")
WRITE(_LOG,_FILE_VCS_VERIFI,"[ROTV1]")
IF ((_KINTYP<>24) AND (_TC>1000))
WRITE(_LOG,_FILE_VCS_VERIFI,<<_DIR_RA2_CALC[0]<<" "<<_DIR_RA2_CALC[1]<<" "<<_DIR_RA2_CALC[2])
WRITE(_LOG,_FILE_VCS_VERIFI,"[ROTV2]")
WRITE(_LOG,_FILE_VCS_VERIFI,<<_DIR_RA1_CALC[0]<<" "<<_DIR_RA1_CALC[1]<<" "<<_DIR_RA1_CALC[2])
ELSE
WRITE(_LOG,_FILE_VCS_VERIFI,<<_DIR_RA1_CALC[0]<<" "<<_DIR_RA1_CALC[1]<<" "<<_DIR_RA1_CALC[2])
WRITE(_LOG,_FILE_VCS_VERIFI,"[ROTV2]")
WRITE(_LOG,_FILE_VCS_VERIFI,<<_DIR_RA2_CALC[0]<<" "<<_DIR_RA2_CALC[1]<<" "<<_DIR_RA2_CALC[2])
ENDIF
WRITE(_LOG,_FILE_VCS_VERIFI,<<" ")
ENDIF
ENDIF
ENDIF
ENDIF
_END:
IF _LOG_ON
WRITE(_LOG,_LOGFILE,";==================================================================")
ENDIF
RET
_M_RA1_POS_A:
_MOD_R=$MA_MODULO_RANGE[_RAX1]
_MOD_S=$MA_MODULO_RANGE_START[_RAX1]
_DISTANCE[0]=S_END_RA1-S_START_RA1
IF ($MA_ROT_IS_MODULO[_RAX1]==1)
_DISTANCE[0]=(_MOD_R+((S_END_RA1+_MOD_R) MOD _MOD_R)-((S_START_RA1+_MOD_R) MOD _MOD_R))MOD _MOD_R
IF _DISTANCE[0]==0
_DISTANCE[0]=360
ENDIF
IF (_MEA_DIR[0])==1
_DISTANCE[0]=_DISTANCE[0]-_MOD_R
IF _DISTANCE[0]==0
_DISTANCE[0]=-360
ENDIF
ENDIF
ENDIF
_SERR=<<"4-"<<AXSTRING(_RAX1)<<" SD55648"
IF (ABS(_DISTANCE[0])<$SCS_MEA_KIN_MIN_ANG_POS) GOTOF _ERR4
_SERR=<<"4-"<<AXSTRING(_RAX1)
IF (ABS(_DISTANCE[0])<10) GOTOF _ERR4
_SERR=<<"5-"<<AXSTRING(_RAX1)
IF (ABS(_DISTANCE[0])>360) GOTOF _ERR4
IF (ABS(_DISTANCE[0])==360)
_DISTANCE[0]=_DISTANCE[0]/(_CMEA1)
ELSE
_DISTANCE[0]=_DISTANCE[0]/(_CMEA1-1)
ENDIF
_H=0
IF _CMEA1<S_CMEA_RA1
_H=1
_RA1_POS[0]=_RA1_OFF
_RA1_ZW_POS[0]=REP(999,12)
ENDIF
FOR _I=0 TO _CMEA1-1
_RA1_POS[_I+_H]=S_START_RA1+_DISTANCE[0]*(_I)
IF ($MA_ROT_IS_MODULO[_RAX1]==1)
_RA1_POS[_I+_H]=((_RA1_POS[_I+_H]+_MOD_R) MOD _MOD_R)
IF _RA1_POS[_I+_H]==_MOD_S
_III=1
ENDIF
ELSE
IF _RA1_POS[_I+_H]>_LIM_P_RA1 OR _RA1_POS[_I+_H]<_LIM_M_RA1
_SERR=<<"start/end " <<AXSTRING(_RAX1)
GOTOF _ERR14
ENDIF
ENDIF
IF (_HIRTH==1) OR (_HIRTH==10)
_RA1_POS[_I+_H]=_RA1_POS[_I+_H]-(_RA1_POS[_I+_H] MOD _HIRTH_STEP[0])
ENDIF
IF ((_RA1_POS[_I+_H]==_RA1_OFF))
_GST1=1
IF (S_CMEA_RA1==3) AND (_I>0)
_RA1_POS[2]=_RA1_POS[1]
_RA1_POS[1]=_RA1_POS[0]
_RA1_POS[0]=_RA1_OFF
ENDIF
ENDIF
ENDFOR
_ANG[0]=360
IF _H==1
FOR _I=1 TO (_CMEA1-1)
IF ((ABS(((_RA1_POS[_I]+360) MOD 360)-((_RA1_OFF+360) MOD 360))<_ANG[0])AND(_RA1_POS[_I]<>_RA1_OFF))
_ANG[0]=((_RA1_POS[_I]+360) MOD 360)-(_RA1_OFF+360) MOD 360
ENDIF
IF _RA1_OFF==0
IF (ABS(((_RA1_POS[_I]+360) MOD 360)-360)<_ANG[0])
_ANG[0]=ABS(((_RA1_POS[_I]+360) MOD 360)-360)
ENDIF
ENDIF
ENDFOR
_SERR="8 ("<<AXSTRING(_RAX1)<<") minANG="<<_ANG[0]
IF (ABS(_ANG[0])<ABS(_DISTANCE[0]/10))
FOR _I=0 TO 11
_OVR[_I]=_RA1_POS[_I]
ENDFOR
GOTOF _ERR4
ENDIF
ENDIF
_M_RA1_POS_E:
_M_RA2_POS_A:
_MOD_R=$MA_MODULO_RANGE[_RAX2]
_MOD_S=$MA_MODULO_RANGE_START[_RAX2]
_DISTANCE[1]=S_END_RA2-S_START_RA2
IF ($MA_ROT_IS_MODULO[_RAX2]==1)
_DISTANCE[1]=(_MOD_R+((S_END_RA2+_MOD_R) MOD _MOD_R)-((S_START_RA2+_MOD_R) MOD _MOD_R))MOD _MOD_R
IF _DISTANCE[1]==0
_DISTANCE[1]=360
ENDIF
IF (_MEA_DIR[1])==1
_DISTANCE[1]=_DISTANCE[1]-_MOD_R
IF _DISTANCE[1]==0
_DISTANCE[1]=-360
ENDIF
ENDIF
ENDIF
_SERR=<<"4-"<<AXSTRING(_RAX2)<<" SD55648"
IF (ABS(_DISTANCE[1])<$SCS_MEA_KIN_MIN_ANG_POS) GOTOF _ERR4
_SERR=<<"4-"<<AXSTRING(_RAX2)
IF (ABS(_DISTANCE[1])<10) GOTOF _ERR4
_SERR=<<"5-"<<AXSTRING(_RAX2)
IF (ABS(_DISTANCE[1])>360) GOTOF _ERR4
IF ABS(S_END_RA2-S_START_RA2)==360
_DISTANCE[1]=_DISTANCE[1]/(_CMEA2)
ELSE
_DISTANCE[1]=_DISTANCE[1]/(_CMEA2-1)
ENDIF
_H=0
IF _CMEA2<S_CMEA_RA2
_H=1
_RA2_POS[0]=_RA2_OFF
ENDIF
FOR _I=0 TO _CMEA2-1
_RA2_POS[_I+_H]=S_START_RA2+_DISTANCE[1]*(_I)
IF ($MA_ROT_IS_MODULO[_RAX2]==1)
_RA2_POS[_I+_H]=((_RA2_POS[_I+_H]+_MOD_R) MOD _MOD_R)
IF _RA2_POS[_I+_H]==_MOD_S
_III=1
ENDIF
ELSE
IF _RA2_POS[_I+_H]>_LIM_P_RA2 OR _RA2_POS[_I+_H]<_LIM_M_RA2
_SERR=<<"start/end RA - "<<AXSTRING(_RAX2)
GOTOF _ERR14
ENDIF
ENDIF
IF (_HIRTH==2) OR (_HIRTH==20)
_RA2_POS[_I+_H]=_RA2_POS[_I+_H]-(_RA2_POS[_I+_H] MOD _HIRTH_STEP[1])
ENDIF
IF (_RA2_POS[_I+_H]==_RA2_OFF)
_GST2=1
IF (S_CMEA_RA2==3) AND (_I>0)
_RA2_POS[2]=_RA2_POS[1]
_RA2_POS[1]=_RA2_POS[0]
_RA2_POS[0]=_RA2_OFF
ENDIF
ENDIF
ENDFOR
_ANG[0]=360
IF _H==1
FOR _I=1 TO (_CMEA2-1)
IF ((ABS(((_RA2_POS[_I]+360) MOD 360)-((_RA2_OFF+360) MOD 360))<_ANG[0])AND(_RA2_POS[_I]<>_RA2_OFF))
_ANG[0]=((_RA2_POS[_I]+360) MOD 360)-((_RA2_OFF+360) MOD 360)
ENDIF
IF _RA2_OFF==0
IF (ABS(((_RA2_POS[_I]+360) MOD 360)-360)<_ANG[0])
_ANG[0]=ABS(((_RA2_POS[_I]+360) MOD 360)-360)
ENDIF
ENDIF
ENDFOR
_SERR="8 ("<<AXSTRING(_RAX2)<<") minANG="<<_ANG[0]
IF (ABS(_ANG[0])<ABS(_DISTANCE[1]/10))
FOR _I=0 TO 11
_OVR[_I]=_RA2_POS[_I]
ENDFOR
GOTOF _ERR4
ENDIF
ENDIF
_M_RA2_POS_E:
_CALC_IW_A:
_CAL[0]=SQRT(POT(_MEA_MKS[_I,0]-_MEA_MKS[_II,0])+POT(_MEA_MKS[_I,1]-_MEA_MKS[_II,1])+POT(_MEA_MKS[_I,2]-_MEA_MKS[_II,2]))
_CAL[1]=SQRT(POT(_MEA_MKS[_III,0]-_MEA_MKS[_II,0])+POT(_MEA_MKS[_III,1]-_MEA_MKS[_II,1])+POT(_MEA_MKS[_III,2]-_MEA_MKS[_II,2]))
_CAL[2]=SQRT(POT(_MEA_MKS[_I,0]-_MEA_MKS[_III,0])+POT(_MEA_MKS[_I,1]-_MEA_MKS[_III,1])+POT(_MEA_MKS[_I,2]-_MEA_MKS[_III,2]))
IF ((_CAL[0]<0.0001) OR (_CAL[1]<0.0001) OR (_CAL[2]<0.0001)) GOTOF _CALC_IW_E
_CAL[3]=ACOS((POT(_CAL[1])+ POT(_CAL[2])-POT(_CAL[0]))/(2*_CAL[1]*_CAL[2]))
_CAL[4]=ACOS((POT(_CAL[0])+ POT(_CAL[2])-POT(_CAL[1]))/(2*_CAL[0]*_CAL[2]))
_CAL[5]=ACOS((POT(_CAL[0])+ POT(_CAL[1])-POT(_CAL[2]))/(2*_CAL[0]*_CAL[1]))
FOR _H=3 TO 5
IF _CAL[_H]<ABS($SCS_MEA_KIN_MIN_ANG_TRIANGLE)
_SERR=_SERR<<_CAL[_H]
GOTOF _ERR9
ENDIF
ENDFOR
_CALC_IW_E:
_STAT_A:
CASE (_G17_18_19) OF 2 GOTOF _G18 3 GOTOF _G19 DEFAULT GOTOF _G17
_G18: _CAL[7]=SET(_CAL[1],_CAL[2],_CAL[0])
GOTOF _NEXT1
_G19: _CAL[7]=SET(_CAL[2],_CAL[0],_CAL[1])
GOTOF _NEXT1
_G17: _CAL[7]=SET(_CAL[0],_CAL[1],_CAL[2])
_NEXT1:
_ANG[0]=(_DIR_RA[0]*_CAL[7]+_DIR_RA[1]*_CAL[8]+_DIR_RA[2]*_CAL[9])/(SQRT(POT(_DIR_RA[0])+POT(_DIR_RA[1])+POT(_DIR_RA[2]))*SQRT(POT(_CAL[7])+POT(_CAL[8])+POT(_CAL[9])))
_ANG[1]=(_DIR_RA[0]*(-_CAL[7])+_DIR_RA[1]*(-_CAL[8])+_DIR_RA[2]*(-_CAL[9]))/(SQRT(POT(_DIR_RA[0])+POT(_DIR_RA[1])+POT(_DIR_RA[2]))*SQRT(POT(_CAL[7])+POT(_CAL[8])+POT(_CAL[9])))
IF _ANG[0]<-0.95
IF _ANG[1]>0.95
_CAL[7]=SET(-_CAL[7],-_CAL[8],-_CAL[9])
ENDIF
ENDIF
EXECSTRING("_DIR_RA"<<(_H+1)<<"_CALC[0]=SET(_CAL[7],_CAL[8],_CAL[9])")
_ROT_LAGE[_H]=ACOS(ABS((_DIR_RA[0]*_CAL[7]+_DIR_RA[1]*_CAL[8]+_DIR_RA[2]*_CAL[9])/(SQRT(POT(_DIR_RA[0])+POT(_DIR_RA[1])+POT(_DIR_RA[2]))*SQRT(POT(_CAL[7])+POT(_CAL[8])+POT(_CAL[9])))))
_ROT_LAGE[_H]=TRUNC(_ROT_LAGE[_H]*1000000)/1000000
_CIRC[0]=REP(0)
_CIRC[14]=999999999
FOR _I=0 TO _ANZ-1
_CIRC[_I]=SQRT(POT(_MEA_MKS[_I+_III,0]-_CAL[3])+POT(_MEA_MKS[_I+_III,1]-_CAL[4])+POT(_MEA_MKS[_I+_III,2]-_CAL[5]))
_CIRC[12]=_CIRC[12]+_CIRC[_I]
IF _CIRC[_I]>_CIRC[13]
_CIRC[13]=_CIRC[_I]
ENDIF
IF _CIRC[_I]<_CIRC[14]
_CIRC[14]=_CIRC[_I]
ENDIF
ENDFOR
_CIRC[12]=_CIRC[12]/_ANZ
_STAT_E:
_PROT_A:
IF _TC>1000
IF (_KINTYP==24)
_PROTVAL[29]=_PROTVAL[29]<<","<<SUBSTR($NT_CORR_ELEM_T[_TC-1000,1],0,26)
ELSE
IF NOT ((_KINTYP==40) AND (AXSTRING(_RAX2)<>"NO_AXIS"))
_PROTVAL[29]=_PROTVAL[29]<<","<<SUBSTR($NT_CORR_ELEM_P[_TC-1000,0],0,26)
ENDIF
ENDIF
IF AXSTRING(_RAX2)<>"NO_AXIS"
IF (_KINTYP==24)
_PROTVAL[29]=_PROTVAL[29]<<","<<SUBSTR($NT_CORR_ELEM_T[_TC-1000,2],0,26)
ENDIF
IF (_KINTYP==56)
_PROTVAL[29]=_PROTVAL[29]<<","<<SUBSTR($NT_CORR_ELEM_T[_TC-1000,1],0,26)
ENDIF
IF (_KINTYP==40)
_PROTVAL[29]=_PROTVAL[29]<<","<<SUBSTR($NT_CORR_ELEM_P[_TC-1000,1],0,26)
_PROTVAL[29]=_PROTVAL[29]<<","<<SUBSTR($NT_CORR_ELEM_P[_TC-1000,0],0,26)
ENDIF
ENDIF
ELSE
IF _TC_KIN==0
IF ((($SCS_MEA_KIN_MODE[0]+0) _DEC2 ==0) AND (_KINTYP<>40))
_PROTVAL[29]=_PROTVAL[29]<<",I1"
ENDIF
_PROTVAL[29]=_PROTVAL[29]<<",I2"
IF AXSTRING(_RAX2)<>"NO_AXIS"
_PROTVAL[29]=_PROTVAL[29]<<",I3"
ENDIF
IF ((($SCS_MEA_KIN_MODE[1]+0) _DEC2 ==0)AND(_KINTYP<>24))
_PROTVAL[29]=_PROTVAL[29]<<",I4"
ENDIF
ELSE
_PROTVAL[29]=_PROTVAL[29]<<","<<$TC_CARR_CORR_ELEM[_TC,1]
IF AXSTRING(_RAX2)<>"NO_AXIS"
_PROTVAL[29]=_PROTVAL[29]<<","<<$TC_CARR_CORR_ELEM[_TC,2]
ENDIF
ENDIF
ENDIF
_PROT_E:
_WKS_MKS_A:
$AC_MEAS_VALID=0
$AC_MEAS_LATCH[0]=1
$AA_MEAS_POINT1[_XX]=_CAL[0]*(_FAK2/_FAK1)
$AA_MEAS_POINT1[_YY]=_CAL[1]*(_FAK2/_FAK1)
$AA_MEAS_POINT1[_ZZ]=_CAL[2]*(_FAK2/_FAK1)
$AC_MEAS_P1_COORD=0
IF _OEM_AKT==0
$AC_MEAS_P2_COORD=2
ELSE
$AC_MEAS_P2_COORD=1
ENDIF
$AC_MEAS_TYPE=24
$AC_MEAS_TOOL_MASK='H20'
ORIMKS
_LOG=MEASURE()
_CAL[0]=SET($AA_MEAS_POINT2[_XX],$AA_MEAS_POINT2[_YY],$AA_MEAS_POINT2[_ZZ])
_WKS_MKS_E:
_ERR0: _ALARM=61302 _OVI[9]=_ALARM
STOPRE
N699504 SETAL(_ALARM)
RET
_ERR1: STOPRE
_OVI[9]=61422
N699601 SETAL(61422,_SERR)
RET
_ERR2: STOPRE
_OVI[9]=61432
N699602 SETAL(61432,_SERR)
RET
_ERR3: STOPRE
_OVI[9]=61166
N699603 SETAL(61166,_SERR)
_ERR4: STOPRE
_OVI[9]=61425
N699604 SETAL(61425,_SERR)
RET
_ERR5: STOPRE
_OVR[9]=61383
SETAL(61383,_SERR)
RET
_ERR6: STOPRE
_OVI[9]=61384
SETAL(61384,_SERR)
RET
_ERR7: STOPRE
_OVI[9]=61058
N699607 SETAL(61058,_SERR)
RET
_ERR8:
_OVI[9]=61429
N699608 SETAL(61429,_SERR)
RET
_ERR9: STOPRE
_OVI[9]=61430
N699609 SETAL(61430,_SERR)
RET
_ERR11:_OVI[9]=61021
STOPRE
N699611 SETAL(61021,_SERR)
RET
_ERR12: STOPRE
N699612 SETAL(62317,_SERR)
_ERR13: STOPRE
N699613 SETAL(61374,_SERR)
_ERR14: STOPRE
N699614 SETAL(61024,_SERR)
_ERR15:
N699615 SETAL(62301)
RET
_ERR20: STOPRE
N699620 SETAL(61019,_SERR)
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE997_SPF
PROC CYCLE997 (INT S_MVAR,INT S_KNUM,INT S_PRNUM,REAL S_SETV,REAL S_FA,REAL S_TSA,REAL S_STA1,REAL S_INCA,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,REAL S_SETV4,REAL S_SETV5,REAL S_SETV6,REAL S_SETV7,REAL S_SETV8,REAL S_TNVL,INT S_NMSP,INT S_MCBIT,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.001 ;DATE: 2023-12-13
;Cycle : Measuring a sphere and ZO determination
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56],_ADD,_NEW_PAR=0
N1010 DEF REAL _M_SPE[64],_M_ME[16],_LAGE,_RMT,_LMT,_DH,_H_SPE22,_H_SPE27,_H_SPE28
N1011 DEF INT _M_N[30],_ALARM,_P_PROB,_MESSR,_AXIND,_H_MSNUM,_H_SIM
N1012 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_ACHS[2]
N1013 DEF REAL _HR[40],_Winkel,_CAL[13],_DAT[3,6],_KF[3,3],_MEX,_KUGDM,_KUGR_X
N1014 DEF REAL _Z_PPOS,_Z_TPOS,_X_MPOS,_Y_MPOS,_Z_ZENIT,_X_MP,_Y_MP,_Z_MP
N1015 DEF REAL _SETPOINT[3,3],_MEASPOINT[3,3],_MC_MTL[3]=SET(33.3,33.3,33.4),_RES
N1016 DEF INT _H_STMV[7],_KUGIN,_KUGOUT,_KUGZA=1,_I_KGD,_I_MWH,_REPCNT
N1017 DEF INT _AIND1,_AIND2,_AIND3,_AKTEB,_ITMP,_HI[5]
N1018 DEF FRAME _REFRAME,_TMP_SAVEFRAME
N1040 DEF INT _H_KNUM,_H_DMODE, _CHBIT_S21
N1044 DEF STRING[30] _SERR
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[38] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE997_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE997_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE997 ("<<S_MVAR<<","<<S_KNUM<<","<<S_PRNUM<<","<<S_SETV<<","<<S_FA<<","<<S_TSA<<","<<S_STA1<<","<<S_INCA<<","<<S_SETV0<<","<<S_SETV1<<","<<S_SETV2<<","<<S_SETV3<<","<<S_SETV4<<","<<S_SETV5<<","<<S_SETV6<<","<<S_SETV7<<","<<S_SETV8<<","<<S_TNVL<<","<<S_NMSP<<","<<S_MCBIT<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _CHBIT_S21=_CHBIT[21] _NEW_PAR=1 _M_SPE[3]=1
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 1 GOTOF _M_ERR
S_KNUM=ABS(S_KNUM)
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M_ERR
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M_ERR
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 3
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M_ERR
S_KNUM = S_KNUM - 2000 + 50
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
_HA1:
IF (_H_KNUM==0)
S_MVAR=S_MVAR + 100 _KNUM=0
ENDIF
_MVAR=ABS(S_MVAR) _PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _FA=ABS(S_FA) _TSA=ABS(S_TSA) _STA1=S_STA1 _HI[3]=0 _INCA=S_INCA _HR[7]=$P_F
IF (S_MVAR _DEC4 ==3)OR(S_MVAR _DEC4 ==4)
_KF[2,2]=S_STA1 MOD 360 _HI[3]=1
ENDIF
_SETV[0]=S_SETV0 _SETV[1]=S_SETV1 _SETV[2]=S_SETV2 _SETV[3]=S_SETV3 _SETV[4]=S_SETV4 _SETV[5]=S_SETV5 _SETV[6]=S_SETV6 _SETV[7]=S_SETV7 _SETV[8]=S_SETV8
_RF=$SCS_MEA_FEED_CIRCLE
IF S_TNVL > 0
_TNVL = ABS(S_TNVL)
ELSE
_TNVL = 1.2
ENDIF
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>4) GOTOF _M_ERR
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
ELSE
_INTERN[40+16]=0 _HI[3]=0
ENDIF
_OVI[3]=-_MVAR
ENDIF
GOTOF _M_END
_M_ERR: _ALARM=61019 _OVI[9]=_ALARM
STOPRE
N699701 SETAL(_ALARM,_SERR)
RET
_M_END: _ALARM=0
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
IF _PRNUM _DEC3==1
_PRNUM = _PRNUM - 100
ENDIF
ENDIF
ENDIF
ENDIF
IF (_MVAR _DEC4 ==3)OR(_MVAR _DEC4 ==4)
_KF[2,2]=_STA1 MOD 360 _HI[3]=1
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<720000) GOTOF _M121
_ALARM=0
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18] =1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
_OVI[2]=997 _OVI[11]=0
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1057 DIAMCYCOF G0 G94 G90
_ALARM=61307 _INTERN[20+8]=0
_H_STMV[0]=(_MVAR MOD 10)
_H_STMV[1]=(_MVAR DIV 10 MOD 10)
_H_STMV[2]=(_MVAR DIV 100 MOD 10)
_H_STMV[3]=(_MVAR DIV 1000 MOD 10)
_H_STMV[4]=(_MVAR DIV 10000 MOD 10)
_H_STMV[5]=(_MVAR DIV 100000 MOD 10)
_H_STMV[6]=(_MVAR DIV 1000000 MOD 10)
IF (_M_N[4] MOD 10000 == 9960)
_M_N[28]=0
IF (_M_N[4] _DEC5)
IF _H_STMV[3]==4
_H_STMV[3]=3 _INTERN[40+13]=0 _MVAR=_MVAR - 1000
ENDIF
IF _H_STMV[3]==2
_H_STMV[3]=1 _INTERN[40+13]=0 _MVAR=_MVAR - 1000
ENDIF
ENDIF
ENDIF
IF ((_H_STMV[0]<>9)OR(_H_STMV[1]>1)OR(_H_STMV[2]<>1)OR(_H_STMV[3]>4)OR(_H_STMV[4]>1)OR(_H_STMV[5]>1)OR(_H_STMV[6]>1)OR(_MVAR>1114119)) GOTOF _M121
IF _VB[48] AND _H_STMV[3] GOTOF _M121
IF(_NEW_PAR==0)AND(_MVAR _DEC6==0)AND((_H_STMV[3]==3)OR(_H_STMV[3]==4))GOTOF _M121
_MVAROK:_ALARM=61309
IF(_H_STMV[3]==0)AND(_M_N[21] _DEC3)GOTOF _M122
_ALARM=61413
IF (_SETVAL<=0) GOTOF _M121
IF(_H_STMV[3]==1)AND(_H_STMV[3]==2)
_ALARM= 61365
IF (_RF<=0) GOTOF _M121
ENDIF
IF ((_H_STMV[3]==2)AND(NOT(_M_N[21] _DEC3)))
_INTERN[40+27]=1 _VB[55]=1
ENDIF
IF ((_H_STMV[3]==4)AND(NOT(_M_N[21] _DEC3)))
_INTERN[40+13]=1 _VB[55]=1
ENDIF
_ALARM=0 _VB[0]=1
IF (_H_STMV[4]==1)
_KUGZA=3
ENDIF
IF (_H_STMV[6]==1)
_I_KGD=1
ENDIF
IF (_HI[3]==1)
_TMP_SAVEFRAME=$P_CYCFRAME
_INTERN[37]=1
ENDIF
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_ALARM=61336 _ITMP=_M_SPE[54] MOD 100
IF ((_INTERN[2]==0)OR(_INTERN[10]==0)OR(_INTERN[18]==0)) GOTOF _M122
IF ((_XX==_YY)OR(_XX==_ZZ)OR(_YY==_ZZ)) GOTOF _M122
_ALARM=61341
IF (_INTERN[20+16]==1)AND((_ITMP B_AND 'B0001'<>1)OR(_ITMP B_AND 'B0010'<>2)OR((_ITMP B_AND 'B0100'<>4)AND(_ITMP B_AND 'B1000'<>8))) GOTOF _M122
IF(_H_STMV[3]>=3)AND(_M_N[21] _DEC3)
_H_STMV[3]=3 _M_N[29]=1
ENDIF
_ALARM=0 _OVR[1]=_SETV[0]/_M_SPE[29] _OVR[2]=_SETV[1]/_M_SPE[29] _OVR[3]=_SETV[2]/_M_SPE[29]
_OVR[28]=_M_SPE[32] _HR[6]=_M_SPE[25] _H_SPE27=_M_SPE[27] _H_SPE28=_M_SPE[28]
_M4:
IF (_INTERN[20+14])
_HR[0]=_M_SPE[3] _HR[1]=_M_SPE[20]/2
ELSE
_HR[0]=(_M_SPE[20]/2 +_M_SPE[3]) _HR[1]=0
ENDIF
IF (_ITMP B_AND 'B1000'==8)
_HR[0]=_M_SPE[3] _HR[1]=_M_SPE[20]/2
ELSE
_HR[6]=0
ENDIF
_M_N[7]=0 _REPCNT=0
_Z_PPOS=_SETV[2+_KUGIN]+_SETVAL/2+(_HR[0]+_HR[6])*_M_SPE[29]
_Z_TPOS=_SETV[2+_KUGIN]-_HR[1]*_M_SPE[29]+_HR[6] _KUGDM=_SETVAL/_M_SPE[29]
_X_MP=_SETV[0+_KUGIN] _Y_MP=_SETV[1+_KUGIN] _Z_MP=_SETV[2+_KUGIN]
IF(_H_STMV[3]==0)OR(_H_STMV[3]==3)OR(_H_STMV[3]==4) GOTOF _MAXPAR
IF (_M_SPE[20] <=0)AND(_M_N[18]==0)
_ALARM=61341
GOTOF _M123
ENDIF
_STA1=_STA1 MOD 360 _INCA=_INCA MOD 360 _ALARM=61443
IF _INCA==0 GOTOF _M122 IF((_MVAR _DEC6)==0)AND(ABS(_INCA)>120) GOTOF _M122 IF((_MVAR _DEC6)==1)AND(ABS(_INCA)>90) GOTOF _M122
_M4UW: _ALARM=0 _VB[16]=1 _VB[22]=1 _VB[3]=1 _M_ZUST[0]=1 _M_ZUST[6]=0 _M_ZUST[4]=1 _VB[0]=1 _VB[15]=0 _VB[27]=0
IF((_H_STMV[3]==2)AND NOT(_VB[2]))OR(_HI[1])
_VB[2]=1 _VB[55]=1 _HI[1]=1
ENDIF
N1080 G111 AX[_XX]=_X_MP AX[_YY]=_Y_MP
_CPA=_X_MP _CPO=_Y_MP
_HR[2]=_M_SPE[20]/2 _M_SPE[16]=_KUGDM _HR[5]=_M_SPE[3] _M_SPE[10]=_M_SPE[16]/2+_HR[2]+_M_SPE[3]
IF _M_SPE[60] ==2
IF _M_SPE[3] >= (_M_SPE[16]/2)
_HR[5]=_M_SPE[16]/2 - 0.1
ENDIF
_M_SPE[9]=_M_SPE[10] - (_HR[5] + _M_SPE[3])
ELSE
_M_SPE[9]=_M_SPE[10] - (_M_SPE[3] * _M_SPE[60])
ENDIF
_M_ME[11]=(_M_SPE[16]+_M_SPE[20])/2
_HR[3]=(_X_MP/_M_SPE[29])+_M_SPE[10]*COS(_STA1) _HR[4]=(_Y_MP/_M_SPE[29])+_M_SPE[10]*SIN(_STA1)
IF (ABS(_HR[3]-_M_SPE[5])<0.001) AND (ABS(_HR[4]-_M_SPE[6])<0.001) GOTOF _M86
N1100 G0
IF _VB[1]==0
N1105 G1
ENDIF
IF _INTERN[40+2] GOTOF _M85
N1110 F=_M_SPE[1] RP=_M_SPE[10]*_M_SPE[29] AP=_STA1
GOTOF _M86
N1115 _M85: F=_M_SPE[1] MEAS=_M_N[0] RP=_M_SPE[10]*_M_SPE[29] AP=_STA1
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _M86
_ALARM=61302
GOTOF _M124
N2100 _M86: IF _INTERN[40+2] GOTOF _M88
N2110 F=_M_SPE[2] AX[_ZZ]=_Z_TPOS
GOTOF _M89
N2115 _M88: F=_M_SPE[2] MEAS=_M_N[0] AX[_ZZ]=_Z_TPOS
STOPRE
IF $AC_MEA[_M_N[0]]==0 GOTOF _M89
_ALARM=61302
GOTOF _M124
_M89: _M_N[7]=0
IF (_VB[2]==0)OR(_VB[55]) GOTOF _M90
_WINKEL=ATAN2(_HR[4]- $AA_IW[_YY],_HR[3]- $AA_IW[_XX]) _INTERN[20+8]=1
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_WINKEL
ELSE
_M_SPE[8]=_M_SPE[61] +_WINKEL
ENDIF
IF _INTERN[20+8]
_M_SPE[8]=_M_SPE[8]+_M_SPE[38]
ENDIF
_M_SPE[8]=(TRUNC(_M_SPE[8]*1000))/1000
_M_SPE[8]=((_M_SPE[8] MOD 360)+360) MOD 360
IF _INTERN[40+18]
N112 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N113 SUPA SPOS=DC(_M_SPE[8])
ENDIF
_M90: _WINKEL=_STA1
IF _VB[2]
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_STA1
ELSE
_M_SPE[8]=_M_SPE[61] +_STA1
ENDIF
ENDIF
N1120 _M9: _M_ME[8]=0 _M_ME[9]=0
CYCLE112(_XX,_YY,_ZZ,_M_SPE,_M_ME,_WINKEL,_M_N,_ALARM,_M_ZUST,_VB,_INTERN)
IF (_WINKEL==0) OR (ABS(_WINKEL)==180) GOTOF _M91 IF (ABS(_WINKEL)<>90) AND (ABS(_WINKEL)<>270) GOTOF _M10
_M_ME[8]=_X_MP/_M_SPE[29]
GOTOF _M10
_M91: _M_ME[9]=_Y_MP/_M_SPE[29]
_M10: IF _M_ZUST[0] GOTOF _MPK1 IF _M_ZUST[1] GOTOF _MPK2 IF _M_ZUST[2] GOTOF _MPK3 IF _M_ZUST[3] GOTOF _MPK4
_MPK1: _CAL[1]=_M_ME[8] _CAL[2]=_M_ME[9] _M_ZUST[0]=0 _M_ZUST[1]=1 _WINKEL=_STA1+_INCA
IF _VB[2] GOTOF _MUMT_RI
GOTOB _M9
_MPK2: _M_ZUST[1]=0 _M_ZUST[2]=1 _CAL[3]=_M_ME[8] _CAL[4]=_M_ME[9] _WINKEL=_STA1+2*_INCA
IF _VB[2] GOTOF _MUMT_RI
GOTOB _M9
_MPK3: _M_ZUST[2]=0 _M_ZUST[3]=1 _CAL[5]=_M_ME[8] _CAL[6]=_M_ME[9] _CAL[0]=3 _WINKEL=_STA1+3*_INCA
IF (_H_STMV[5]==0) GOTOF _M102
IF _VB[2] GOTOF _MUMT_RI
GOTOB _M9
_MUMT_RI:
IF _VB[31]==0
_M_SPE[8]=360- _M_SPE[61] -_WINKEL
ELSE
_M_SPE[8]=_M_SPE[61] +_WINKEL
ENDIF
IF _M_ZUST[2] AND _INTERN[19] AND _VB[55]
_M_SPE[8]=(_M_SPE[8]+180)MOD 360
ENDIF
GOTOB _M9
_MPK4: _CAL[7]=_M_ME[8] _CAL[8]=_M_ME[9] _CAL[0]=4
_M102: _M_ZUST[7]=1
N1130 CYCLE116(_CAL,_ALARM)
IF _M_SPE[60]==1
_M_SPE[27]=0 _M_SPE[28]=0
ENDIF
IF _H_STMV[3]<2
_OVR[5+_KUGOUT]=_CAL[9]-_M_SPE[27] _HR[15+_KUGOUT]=_OVR[5+_KUGOUT]
_OVR[6+_KUGOUT]=_CAL[10]-_M_SPE[28] _OVR[7+_KUGOUT]=_Z_MP/_M_SPE[29]
IF _H_STMV[1] > 1
_OVR[4+_KUGOUT]=(_CAL[11]*2)-_M_SPE[20]
ENDIF
ELSE
_OVR[5+_KUGOUT]=_CAL[9] _HR[15+_KUGOUT]=_OVR[5+_KUGOUT]
_OVR[6+_KUGOUT]=_CAL[10] _OVR[7+_KUGOUT]=_Z_MP/_M_SPE[29]
IF _H_STMV[1] > 1
_OVR[4+_KUGOUT]=((_CAL[11]*2)-_M_SPE[20])+(_M_SPE[27]*2)
ENDIF
ENDIF
_M103:_M_ZUST[0]=1 _M_ZUST[1]=0 _M_ZUST[2]=0 _M_ZUST[3]=0
_M107:
_OVR[9+_KUGOUT]=_OVR[5+_KUGOUT] -(_SETV[0+_KUGIN]/_M_SPE[29])
_OVR[10+_KUGOUT]=_OVR[6+_KUGOUT]-(_SETV[1+_KUGIN]/_M_SPE[29])
IF (ABS(_OVR[9+_KUGOUT])<_M_SPE[32])AND(ABS(_OVR[10+_KUGOUT])<_M_SPE[32])
_X_MP=_OVR[5+_KUGOUT]*_M_SPE[29] _Y_MP=_OVR[6+_KUGOUT]*_M_SPE[29]
GOTOF _M111
ENDIF
_ALARM=61303
_M111: IF (_ALARM<>61303)AND(_ALARM<>61306) GOTOF _M115
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==0 GOTOF _M113
N1150 SETAL(_ALARM+1000)
N1160 M0
STOPRE
_M113:_M_ZUST[7]=0 _ALARM=0
ENDIF
_M115: IF _M_ZUST[7] GOTOF _M115ANF
_WINKEL=_STA1 _M_ZUST[0]=1 _VB[27]=1
GOTOB _M9
_M115ANF:
IF _ALARM GOTOF _M130
IF _INTERN[40+16] AND _INTERN[40+2]
N4093 _HR[8]=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100 _HR[9]=$MA_MAX_AX_VELO[_ZZ]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_XX]>$MA_MAX_AX_VELO[_YY]
N4095 _HR[8]=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
ELSE
N4097 _HR[8]=_M_SPE[1] _HR[9]=_M_SPE[2]
ENDIF
_X_MPOS=(_OVR[5+_KUGOUT]+_M_SPE[27])*_M_SPE[29] _Y_MPOS=(_OVR[6+_KUGOUT]+_M_SPE[28])*_M_SPE[29]
IF _INTERN[40+2] GOTOF _M288
N4105 F=_HR[9] AX[_ZZ]=_Z_PPOS
N4107 F=_HR[8] AX[_XX]=_X_MPOS AX[_YY]=_Y_MPOS
GOTOF _M290
N4110 _M288: F=_HR[9] MEAS=_M_N[0] AX[_ZZ]=_Z_PPOS
_ALARM=61302
STOPRE
IF $AC_MEA[_M_N[0]]<>0 GOTOF _M126
N4116 F=_HR[8] MEAS=_M_N[0] AX[_XX]=_X_MPOS AX[_YY]=_Y_MPOS
STOPRE
IF $AC_MEA[_M_N[0]]<>0 GOTOF _M126
_ALARM=0
_M290: _M_SPE[5]=_X_MPOS/_M_SPE[29] _M_SPE[6]=_Y_MPOS/_M_SPE[29]
GOTOF _M115A
N6060 _MAXPAR: G0
IF _VB[1]==0
N6070 G1
ENDIF
IF _HI[3]==0
_M_SPE[5]=_SETV[0+_KUGIN]/_M_SPE[29]+_M_SPE[27] _M_SPE[6]=_SETV[1+_KUGIN]/_M_SPE[29]+_M_SPE[28]
ELSE
IF((_H_STMV[4]==1)AND(_KUGZA==3))OR((_H_STMV[4]==0)AND(_KUGZA==1))
_M_SPE[5]=_M_SPE[5]+_M_SPE[27]*_M_SPE[29] _M_SPE[6]=_M_SPE[6]+_M_SPE[28]*_M_SPE[29]
ELSE
_HR[3]=_SETV[0+_KUGIN]/_M_SPE[29] _HR[4]=_SETV[1+_KUGIN]/_M_SPE[29]
N7073 F=_M_SPE[1] AX[_XX]=_HR[3]
N7075 AX[_YY]=_HR[4]
_HR[35]=SET($AA_IW[_XX],$AA_IW[_YY]) _TMP_SAVEFRAME=$P_CYCFRAME
$P_CYCFRAME=CTRANS(_XX,_HR[35],_YY,_HR[36]):CROT(_ZZ,_KF[2,2])
_M_SPE[5]=SET(_M_SPE[27],_M_SPE[28]) _M_SPE[17]=SET($AA_IM[_XX],$AA_IM[_YY],$AA_IM[_ZZ])
ENDIF
ENDIF
_X_MPOS=_M_SPE[5] _Y_MPOS=_M_SPE[6] _H_SPE22=_M_SPE[22]
IF (_VB[2])
_INTERN[20+8]=1
ENDIF
IF (_H_STMV[3]==4)AND(NOT(_VB[2]))
_VB[2]=1 _VB[3]=1 _VB[55]=0 _INTERN[20+8]=0 _INTERN[40+13]=1
_M_SPE[21]=_M_SPE[21] - _M_SPE[27]
_M_SPE[22]=SET(-_M_SPE[21],_M_SPE[21],-_M_SPE[21])
_H_SPE27=0 _H_SPE28=0
ENDIF
N6080 F=_M_SPE[1] AX[_XX]=_X_MPOS
N6090 AX[_YY]=_Y_MPOS
_MAXP2:_VB[16]=1 _VB[22]=1 _VB[3]=1 _VB[0]=1 _VB[15]=0 _VB[27]=0
_M_ZUST[0]=SET(1,0,0,0,0,0,0,0,0) _M_N[7]=0
_MAV=_XX _AXIND=0 _M_ME[1]=0 _M_ME[2]=0 _M_ME[8]=0 _M_ME[9]=0 _ALARM=0 _ACHS[0]=_XX _ACHS[1]=_YY
IF((_H_STMV[3]==1)OR(_H_STMV[3]==2))AND(_I_KGD)
N7166 G1 F=_HR[8] AX[_XX]=_X_MP AX[_YY]=_Y_MP
_HR[33] =SET(_M_SPE[5],_M_SPE[6]) _HR[35]=SET($AA_IW[_XX],$AA_IW[_YY]) _VB[2]=1 _HR[37]=$AA_IM[SPI($AC_MSNUM)]
_TMP_SAVEFRAME=$P_CYCFRAME
$P_CYCFRAME=CTRANS(_XX,_HR[35],_YY,_HR[36]):CROT(_ZZ,_STA1)
_M_SPE[5]=SET(0,0) _HR[15+_KUGOUT]=0 _KF[2,2]=_STA1 _M_SPE[17]=SET($AA_IM[_XX],$AA_IM[_YY],$AA_IM[_ZZ])
_HR[3]=(_M_SPE[5]+_M_SPE[27])*_M_SPE[29] _HR[4]=(_M_SPE[6]+_M_SPE[28])*_M_SPE[29]
N6083 F=_M_SPE[1] AX[_XX]=_HR[3]
N6085 AX[_YY]=_HR[4]
ENDIF
N6100 _MAP9: _MAV=_ACHS[_AXIND] _MESSR=-1
IF _M_ZUST[0] OR _M_ZUST[2] GOTOF _MAP92
_MESSR=1
_MAP92:_M_SPE[16]=_KUGDM _HR[2]=_M_SPE[20]/2 _HR[5]=(_M_SPE[16]/2+_HR[2]+_M_SPE[3])*_MESSR
_M_SPE[10]=_M_SPE[5+_AXIND]+_HR[5]
_M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR
_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR
_ID=_Z_TPOS _M_ZUST[4]=1 _M_N[29]=1 _INTERN[69]=1
N7120 CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_MAP101: _M_ME[0]=_M_ME[8] _M_ME[1]=_M_ME[9] _M_ME[8]=SET(0,0)
IF _INTERN[40+16] AND _INTERN[40+2]
N7123 _HR[8]=$MA_MAX_AX_VELO[_XX]*_M_N[14]/100 _HR[9]=$MA_MAX_AX_VELO[_ZZ]*_M_N[14]/100
IF $MA_MAX_AX_VELO[_XX]>$MA_MAX_AX_VELO[_YY]
N7125 _HR[8]=$MA_MAX_AX_VELO[_YY]*_M_N[14]/100
ENDIF
ELSE
N7127 _HR[8]=_M_SPE[1] _HR[9]=_M_SPE[2]
ENDIF
IF _M_ZUST[0] GOTOF _PAP1 IF _M_ZUST[1] GOTOF _PAP2 IF _M_ZUST[2] GOTOF _PAP3 IF _M_ZUST[3] GOTOF _PAP4
_PAP1:_M_ZUST[0]=0 _M_ZUST[1]=1 _MEX=_M_ME[0]-_M_SPE[27] _M_ME[4]=_M_ME[0]-_M_SPE[22]-_H_SPE27 _M_ME[12]=_M_ME[1]+_M_SPE[28]
IF _VB[48]
_M_ME[4]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 + _M_SPE[27])
ENDIF
IF _M_N[18]
_M_ME[4]=_M_ME[11]-_HR[2]*_MESSR
ENDIF
N7130 F=_HR[9] AX[_ZZ]=_Z_PPOS
IF((_H_STMV[3]==1)OR(_H_STMV[3]==2))AND(_I_KGD)
_M_SPE[5] =SET(_HR[33],_HR[34]) _KF[2,2]=0
IF NOT(_M_N[21] _DEC3)
_VB[2]=0
ENDIF
IF _SMI_R[10]==11
$P_CYCFRAME=_TMP_SAVEFRAME
ELSE
$P_CYCFRAME=CTRANS()
ENDIF
IF _H_STMV[3]==1
IF _INTERN[40+18]
N150 CUST_MEACYC(3,_HR[37],0)
ELSE
N151 SUPA SPOS=DC(_HR[37])
ENDIF
_M_SPE[8]=_HR[37]
ENDIF
ENDIF
IF (_H_STMV[3]==4)AND(_REPCNT<>1)
N7135 G91 AX[_YY]=-(_M_SPE[28]*2*_M_SPE[29])
N7137 G90 F=_HR[8] AX[_XX]=_X_MPOS
ELSE
N7140 G90 F=_HR[8] AX[_XX]=_X_MPOS AX[_YY]=_Y_MPOS
ENDIF
IF (_REPCNT==1) GOTOF _MDBER
GOTOB _MAP9
_PAP2: _M_ZUST[7]=1
_M_ME[5]=_M_ME[0]-(_M_SPE[21]+_H_SPE27) _M_ME[13]=_M_ME[1]-_M_SPE[28]
IF _VB[48]
_M_ME[5]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 + _M_SPE[27])
ENDIF
IF _M_N[18]
_M_ME[5]=_M_ME[0]-_HR[2]*_MESSR
ENDIF
_HR[15+_KUGOUT]=(_M_ME[4]+_M_ME[5])/2 _OVR[5+_KUGOUT]=_HR[15+_KUGOUT]
_OVR[9+_KUGOUT]=_HR[15+_KUGOUT]-(_SETV[0+_KUGIN]/_M_SPE[29])
IF _HI[3]
_OVR[9+_KUGOUT]=_HR[15+_KUGOUT]
ENDIF
IF ABS(_OVR[9+_KUGOUT]) < _M_SPE[32]
_M_SPE[5]=_HR[15+_KUGOUT]+_M_SPE[27] _X_MPOS=_M_SPE[5]*_M_SPE[29]
ELSE
_ALARM=61303
ENDIF
IF _ALARM<>61303 GOTOF _MAP114
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==0 GOTOF _MAP113
N7150 SETAL(_ALARM+1000)
N7160 M0
STOPRE
_MAP113: _M_ZUST[7]=0 _ALARM=0
ENDIF
N7150 _MAP114:F=_HR[9] AX[_ZZ]=_Z_PPOS
IF (_H_STMV[3]==4)
N7160 G90 AX[_XX]=_X_MPOS - _M_SPE[27]*_M_SPE[29] - _M_SPE[28]*_M_SPE[29]
ELSE
N7163 F=_HR[8] AX[_XX]=_X_MPOS
ENDIF
IF _M_ZUST[7] GOTOF _MAP115A
_M_ZUST[0]=1 _M_ZUST[1]=0
GOTOB _MAP9
_MAP115A:
IF _ALARM
STOPRE
GOTOF _M130
ENDIF
_M_ZUST[1]=0 _M_ZUST[2]=1 _M_ZUST[7]=0 _AXIND=1 _M_N[7]=0
GOTOB _MAP9
_PAP3: _M_ZUST[2]=0 _M_ZUST[3]=1 _M_ME[6]=_M_ME[0]-(_M_SPE[24]+_H_SPE28) _M_ME[14]=_M_ME[1]+_M_SPE[28]
IF _VB[48]
_M_ME[6]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 + _M_SPE[28])
ENDIF
IF _M_N[18]
_M_ME[6]=_M_ME[0]-_HR[2]*_MESSR
ENDIF
N7170 F=_HR[9] AX[_ZZ]=_Z_PPOS
IF (_H_STMV[3]==4)
N7175 G91 AX[_XX]=_M_SPE[28]*2*_M_SPE[29]
ENDIF
N7180 G90 F=_HR[8] AX[_YY]=_Y_MPOS
GOTOB _MAP9
_PAP4: _M_ZUST[7]=1
_M_ME[7]=_M_ME[0]-(_M_SPE[23]+_H_SPE28) _M_ME[15]=_M_ME[1]-_M_SPE[28]
IF _VB[48]
_M_ME[7]=_M_ME[0]-(_M_SPE[20]*_MESSR/2 + _M_SPE[28])
ENDIF
IF _M_N[18]
_M_ME[7]=_M_ME[11]-_HR[2]*_MESSR
ENDIF
_HR[16+_KUGOUT]=(_M_ME[6]+_M_ME[7])/2 _OVR[6+_KUGOUT]=_HR[16+_KUGOUT]
_OVR[10+_KUGOUT]=_HR[16+_KUGOUT]-(_SETV[1+_KUGIN]/_M_SPE[29])
IF _HI[3]
IF (_H_STMV[3]==4)
_CAL[0]=SET(4,_M_ME[4],_M_ME[12],_M_ME[5],_M_ME[13],_M_ME[14],_M_ME[6],_M_ME[15],_M_ME[7])
CYCLE116(_CAL,_ALARM)
_HR[15]=_CAL[9] _HR[16]= _CAL[10]
ENDIF
_OVR[9+_KUGOUT]=_HR[15+_KUGOUT]*COS(_KF[2,2]*(-1))+ _HR[16+_KUGOUT]*SIN(_KF[2,2]*(-1))
_OVR[10+_KUGOUT]=_HR[16+_KUGOUT]*COS(_KF[2,2]*(-1))- _HR[15+_KUGOUT]*SIN(_KF[2,2]*(-1))
_OVR[5+_KUGOUT]=(_SETV[0+_KUGIN]/_M_SPE[29])+_OVR[9+_KUGOUT] _OVR[6+_KUGOUT]=(_SETV[1+_KUGIN]/_M_SPE[29])+_OVR[10+_KUGOUT]
IF _H_STMV[1] >1
_OVR[4+_KUGOUT]=ABS(_M_ME[5]-_M_ME[4])
IF (_H_STMV[3]==4)
_OVR[4+_KUGOUT]=_CAL[11]*2
ENDIF
ENDIF
ENDIF
IF ABS(_OVR[10+_KUGOUT]) < _M_SPE[32]
_M_SPE[6]=_HR[16+_KUGOUT]+_M_SPE[28] _Y_MPOS=_M_SPE[6]*_M_SPE[29]
ELSE
_ALARM=61303
ENDIF
IF _ALARM<>61303 GOTOF _MAP415
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==0 GOTOF _MAP413
N7150 SETAL(_ALARM+1000)
N7160 M0
STOPRE
_MAP413: _M_ZUST[7]=0 _ALARM=0
ENDIF
N7190 _MAP415: F=_HR[9] AX[_ZZ]=_Z_PPOS
IF (_H_STMV[3]==4)
N7193 F=_HR[8] AX[_XX]=_X_MPOS
ENDIF
N7200 F=_HR[8] AX[_YY]=_Y_MPOS
IF _M_ZUST[7] GOTOF _M115A
_M_ZUST[2]=1 _M_ZUST[3]=0
GOTOB _MAP9
_M115A: _M_N[7]=0
IF _ALARM
STOPRE
GOTOF _M130
ENDIF
_M_ZUST[0]=SET(0,1,0,0,0,0,0,0,0) _VB[27]=0 _M_N[7]=0 _VB[55]=0
_MAV=_ZZ _AXIND=2 _M_ME[1]=0 _M_ME[2]=0 _M_ME[8]=0 _M_ME[9]=0 _ALARM=0
IF((_H_STMV[3]==1)OR(_H_STMV[3]==2))AND(_M_N[21] _DEC3)
_M_N[29]=1
ENDIF
_M_SPE[16]=(_Z_MP/_M_SPE[29])+_KUGDM/2 _M_SPE[10]=_Z_PPOS/_M_SPE[29]
_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]
_M_ME[11]=_M_SPE[16]+_M_SPE[25]
IF (NOT(_KNUM))AND(_H_STMV[1]>1)
_M_SPE[10]=_M_SPE[7]
ENDIF
N5080 _M950: CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
_M1000: _M_ME[0]=_M_ME[8] _M_ME[8]=0
_Z_ZENIT=(_M_ME[0]-_M_SPE[25])*_M_SPE[29] _M_ZUST[7]=1
IF((_H_STMV[3])AND(_H_STMV[1]==2)AND(_I_KGD==0))OR((_I_KGD)AND(_H_STMV[3])AND(_H_STMV[1]>1))GOTOF _M1002
_OVR[4+_KUGOUT]=_KUGDM
_M1002:
IF (NOT(_H_STMV[6]))
_OVR[7+_KUGOUT]=(_Z_ZENIT - (_SETVAL/2)) / _M_SPE[29]
ELSE
_OVR[7+_KUGOUT]=(_Z_ZENIT/_M_SPE[29])- _OVR[4+_KUGOUT]/2
ENDIF
GOTOF _M1001
_MDBER: _M_ZUST[7]=1 _RMT=ABS(_M_SPE[22]) _ITMP=_M_N[1]
IF _M_N[18]
_RMT=_HR[2]
ENDIF
IF _H_STMV[3]==4
_KUGR_X= _HR[15+_KUGOUT] - _M_ME[0] + _H_SPE22 + _M_SPE[27]
GOTOF _MDBER_E
ENDIF
_KUGR_X=(POT(_KUGDM/2)-POT(_RMT)+POT(_HR[15+_KUGOUT]-_MEX))/(2*(_RMT+_KUGDM/2))
IF (NOT (ISVAR("_MC_MTL["<<_ITMP <<"]")))
GOTOF _MDBER_E
ENDIF
_LMT=_HR[2]*_MC_MTL[_ITMP]
IF (_LMT<0.5) OR (_MC_MTL[_ITMP]<3.0) GOTOF _MDBER_E
_DH=(_HR[2]*(_KUGDM/2-_KUGR_X))/(_KUGR_X+_RMT)
_RMT=_RMT*(_LMT+_DH)/_LMT
_KUGR_X=(POT(_KUGDM/2)-POT(_RMT)+POT(_HR[15+_KUGOUT]-_MEX))/(2*(_RMT+_KUGDM/2))
_MDBER_E: _OVR[4+_KUGOUT]=_KUGR_X*2
_OVR[7+_KUGOUT]=(_Z_ZENIT/_M_SPE[29])-_OVR[4+_KUGOUT]/2
_M1001: _OVR[11+_KUGOUT]=_OVR[7+_KUGOUT]-(_SETV[2+_KUGIN]/_M_SPE[29])
_OVR[8+_KUGOUT]=_OVR[4+_KUGOUT]-(_SETVAL/_M_SPE[29])
IF (ABS(_OVR[11+_KUGOUT])<_M_SPE[32])AND(ABS(_OVR[8+_KUGOUT])<_M_SPE[32]) GOTOF _M1111
_ALARM=61303
IF (_REPCNT==1) GOTOF _M130
_M1111: IF (_ALARM<>61303)AND(_ALARM<>61306) GOTOF _M1115
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==0 GOTOF _M1113
N1150 SETAL(_ALARM+1000)
N1160 M0
STOPRE
_M1113:_M_ZUST[7]=0 _ALARM=0
ENDIF
_M1115:
IF _M_ZUST[7]
_KUGDM=_OVR[4+_KUGOUT] _Z_MP=_OVR[7+_KUGOUT]*_M_SPE[29]
GOTOF _M1115A
ENDIF
_M_ZUST[0]=0 _M_ZUST[1]=1 _VB[27]=0 _M_ME[8]=0 _M_ME[9]=0
GOTOB _M950
_M1115A: IF _ALARM GOTOF _M130
IF(_I_KGD==0)OR(_REPCNT==1)OR((_H_STMV[3]>2)AND(_REPCNT==2))GOTOF _M1115B
_Z_TPOS=(_OVR[7+_KUGOUT]-_HR[1]+_HR[6])*_M_SPE[29]
_Z_PPOS=(_OVR[7+_KUGOUT]+(_KUGDM/2+_HR[0])+_HR[6])*_M_SPE[29]
_M_N[7]=0 _M_ME[8]=0 _M_ME[9]=0 _REPCNT=1
GOTOB _MAXP2
_M1115B:
_Z_TPOS=(_OVR[7+_KUGOUT]-_HR[1]+_HR[6])*_M_SPE[29] _Z_PPOS=(_OVR[7+_KUGOUT]+(_KUGDM/2+_HR[0])+_HR[6])*_M_SPE[29]
IF (_H_STMV[1]==1)
_H_STMV[1]=_H_STMV[1]+1
IF(_H_STMV[3]==1)OR(_H_STMV[3]==2)
GOTOB _M4UW
ELSE
_REPCNT=2
GOTOB _MAXP2
ENDIF
ENDIF
_M1115C:_KUGZA=_KUGZA-1
IF _Z_PPOS < (_M_SPE[7]*_M_SPE[29])
N5110 F=_HR[9] AX[_ZZ]=_M_SPE[7]*_M_SPE[29]
ENDIF
IF _SMI_R[10]==11
$P_CYCFRAME=_TMP_SAVEFRAME
ELSE
$P_CYCFRAME=CTRANS()
N5113 F=_HR[8] AX[_XX]=(_OVR[5] + _M_SPE[27]) * _M_SPE[29]
N5115 F=_HR[8] AX[_YY]=(_OVR[6] + _M_SPE[28]) * _M_SPE[29]
ENDIF
IF (_KUGZA>0)
_KUGIN=_KUGIN+3 _KUGOUT=_KUGOUT+8
IF _H_STMV[1]>0
_H_STMV[1]=1
ENDIF
GOTOB _M4
ENDIF
IF (_H_STMV[4] == 0)
IF ((_M_N[19] _DEC4) OR (_M_N[19] _DEC5)) ;Messen am Roboter oder Sonder-/OEM-Trafo
_CAL[6] = 1
ELSE
_CAL[6] = 2
ENDIF
_CAL[0]=SET(_OVR[1],_OVR[2],_OVR[3],_OVR[5],_OVR[6],_OVR[7]) _HI[0]=6
CYCLE216(_CAL,_HI[0])
_OVR[29]=SET(_CAL[9],_CAL[10],_CAL[11])
ENDIF
IF _KNUM==0 GOTOF _M120
_OVI[0]=_KNUM
IF (_H_STMV[4] == 1)
_AKTEB=$P_GG[6]
IF(_AKTEB==1)
_AIND1=0 _AIND2=1 _AIND3=2
ELSE
IF(_AKTEB==2)
_AIND1=1 _AIND2=2 _AIND3=0
ELSE
_AIND1=2 _AIND2=0 _AIND3=1
ENDIF
ENDIF
_SETPOINT[_AIND1,0]=SET(_SETV[0],_SETV[1],_SETV[2])
_SETPOINT[_AIND2,0]=SET(_SETV[3],_SETV[4],_SETV[5])
_SETPOINT[_AIND3,0]=SET(_SETV[6],_SETV[7],_SETV[8])
_MEASPOINT[_AIND1,0]=SET(_OVR[5],_OVR[6],_OVR[7])
_MEASPOINT[_AIND2,0]=SET(_OVR[13],_OVR[14],_OVR[15])
_MEASPOINT[_AIND3,0]=SET(_OVR[21],_OVR[22],_OVR[23])
_OVI[11]=-1
CYCLE119(_SETPOINT,_MEASPOINT,_ALARM,_RES,_REFRAME,_KNUM,_TNVL)
_OVI[12]=_RES*1000
_OVI[11]=1
GOTOF _M120
ENDIF
IF (_INTERN[40+21]==0)
_ADD=1
ENDIF
CYCLE115(_ALARM,_MAV,_ADD,_NEW_PAR)
STOPRE
_M120: IF _ALARM==0 GOTOF _M130
STOPRE
_M121:_OVI[9]=_ALARM
N699701 SETAL(_ALARM)
STOPRE
_M122:_OVI[9]=_ALARM
N699702 SETAL(_ALARM)
STOPRE
_M123:_OVI[9]=_ALARM
N699703 SETAL(_ALARM)
STOPRE
_M124:_OVI[9]=_ALARM
N699704 SETAL(_ALARM)
STOPRE
_M126:_OVI[9]=_ALARM
N699706 SETAL(_ALARM)
STOPRE
_M127:_OVI[9]=_ALARM
N699707 SETAL(_ALARM)
STOPRE
_M130:_OVI[9]=_ALARM
IF ((_ALARM>=61303)AND(_ALARM<=61306)OR (_ALARM==0)) GOTOF _M132
N699708 SETAL(_ALARM)
_M120A: M0
STOPRE
N699808 SETAL(61327)
GOTOB _M120A
_M132: _PROTVAL[29] = _PROTVAL[29] <<"F"<<_M_SPE[0]
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M125A
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M125
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N699709 SETAL(_ALARM+1000)
ENDIF
IF _M_SPE[29]<>1
FOR _ITMP=0 TO 31
_OVR[_ITMP]=_OVR[_ITMP]*_M_SPE[29]
ENDFOR
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M128 IF _M_N[28]==2 GOTOF _M125
G4 F8
N1160 _M128: CYCLE102(0)
N1200 _M125:
IF (_INTERN[20+9] == 1) AND (_M_N[4] MOD 10000<>9960)
CYCLE151
ENDIF
IF _M_SPE[29]<>1
FOR _ITMP=0 TO 31
_OVR[_ITMP]=_OVR[_ITMP]*(1/_M_SPE[29])
ENDFOR
ENDIF
N1201 _M125A:
IF _ALARM
STOPRE
IF (_ALARM>61303)
N699710 SETAL(_ALARM+1000)
IF _INTERN[20+2]
N1240 M0
STOPRE
ENDIF
ELSE
_OVI[9]=_ALARM
IF(_INTERN[12]AND (_M_N[4] MOD 10000 <> 9960))
CUST_MEACYC(5)
ENDIF
IF NOT(_INTERN[12] AND _INTERN[13] AND (_M_N[4] MOD 10000 <> 9960))
N699711 SETAL(_ALARM)
ENDIF
ENDIF
ENDIF
IF _NEW_PAR
_CHBIT[21]=_CHBIT_S21
IF _HR[7]>0
F=_HR[7]
ENDIF
ENDIF
IF(((_SMI_R[10]==0)OR(_SMI_R[10]==11))AND(_M_N[4] MOD 10000<>9960))OR((_M_N[4] MOD 10000==9960)AND(_MIJ_I[0]))
CUST_MEACYC(2)
ENDIF
IF _M_SPE[52]<>1
FOR _ITMP=0 TO 31
_OVR[_ITMP]=_OVR[_ITMP]*_M_SPE[52]
ENDFOR
ENDIF
M17
N699712 _ENDE: SETAL(62301)
M0
_GENDE: M17

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_CYCLE998_SPF
PROC CYCLE998(INT S_MVAR,INT S_KNUM,INT S_RA,INT S_PRNUM,REAL S_SETV,REAL S_STA1,REAL S_INCA,REAL S_FA,REAL S_TSA,INT S_MA,INT S_MD,REAL S_ID,REAL S_SETV0,REAL S_SETV1,REAL S_SETV2,REAL S_SETV3,INT S_NMSP,INT S_EVNUM,INT _DMODE,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.23.00.00.004 ;DATE: 2023-10-05
;Cycle : Angle measurement and ZO determination
N1000 DEF BOOL _INTERN[70],_M_ZUST[16],_VB[56], _BGEKIPPT[3]
N1010 DEF REAL _M_SPE[80],_M_ME[40],_P_POS,_TRIGLAG,_TRIGLAG2,_LAGE,_MER11
N1020 DEF INT _M_N[40],_ALARM,_P_PROB,_P_PL,_P_PT,_MESSR,_AXIND,_MP3,_HMVAR,_M_BFNR
N1030 DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV,_H_VAV,_VRA
N1032 DEF FRAME _REL_FRAME,_RET_FRAME1,_RET_CYCFRAME, _ORIG_FRAME, _AFTER_FRAME
N1034 DEF INT _Z1,_Z2,_Z3,_Z4,_HI[15],_AXIND_V,_RETVAL,_H_SIM
N1036 DEF REAL _HR[29],_DAT[3,6],_KF[3,3],_H,_P_POS_V,_HH
N1037 DEF REAL _H_OVR0,_H_OVR1,_H_OVR4,_H_OVR5,_H_OVR16,_H_OVR17,_H_OVR20,_H_OVR100,_H_OVR101,_H_OVR104,_H_OVR105,_H_OVR116,_H_OVR117,_H_OVR120
N1038 DEF STRING[8] _HSTR_PROT
N1039 DEF STRING[2] _HSTR_PROT1
N1040 DEF INT _H_DMODE, _H_KNUM, _CHBIT_S21
N1042 DEF BOOL _NEW_PAR=0
N1044 DEF STRING[30] _SERR
N1052 DEF INT _TEMP,_TEMP_ON
N1054 DEF STRING[38] _TEMP_FILE="//NC:/_N_MPF_DIR/_N_TEMP_CYCLE998_MPF"
_TEMP_ON=(ISFILE(_TEMP_FILE))AND($P_PROG[$P_STACK-1]<>"_N_TEMP_CYCLE998_MPF")
IF _TEMP_ON
DELETE(_TEMP,_TEMP_FILE)
WRITE(_TEMP,_TEMP_FILE,"; Date: "<<$A_DAY<<"."<<$A_MONTH<<"."<<($A_YEAR+2000)<<"  Time: "<<$A_HOUR<<":"<<$A_MINUTE<<":"<<$A_SECOND)
IF (($P_TOOL)AND($P_TOOLNO))
WRITE(_TEMP,_TEMP_FILE,";$TC_DP1[1,1]="<<$P_ADT[1]<<"    ; Tool type")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP2[1,1]="<<$P_ADT[2]<<"    ; Cutting edge position")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP3[1,1]="<<$P_ADT[3]<<"    ; Tool length L1")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP4[1,1]="<<$P_ADT[4]<<"    ; Tool length L2")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP5[1,1]="<<$P_ADT[5]<<"    ; Tool length L3")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP6[1,1]="<<$P_ADT[6]<<"    ; Tool geo radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP15[1,1]="<<$P_ADT[15]<<"  ; Tool wear radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP7[1,1]="<<$P_ADT[7]<<"    ; Boom length/Outside radius")
WRITE(_TEMP,_TEMP_FILE,";$TC_DP10[1,1]="<<$P_ADT[10]<<"  ; Correction angle")
WRITE(_TEMP,_TEMP_FILE,";T-Number internal $P_TOOLNO="<<$P_TOOLNO)
WRITE(_TEMP,_TEMP_FILE,";D-Number $P_TOOL="<<$P_TOOL)
ENDIF
IF ($P_TOOLNO>0)
WRITE(_TEMP,_TEMP_FILE,";T1")
ELSE
WRITE(_TEMP,_TEMP_FILE,";T0")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";M6")
IF ($P_TOOL==0)
WRITE(_TEMP,_TEMP_FILE,";D0")
ELSE
WRITE(_TEMP,_TEMP_FILE,";D1")
ENDIF
WRITE(_TEMP,_TEMP_FILE,";G[06]="<<$P_GG[6]<<"     ; G17/G18/G19")
WRITE(_TEMP,_TEMP_FILE,";G[13]="<<$P_GG[13]<<"    ; G70/G71/...")
WRITE(_TEMP,_TEMP_FILE,";G[29]="<<$P_GG[29]<<"    ; DIAMON /...")
WRITE(_TEMP,_TEMP_FILE,";G[08]="<<$P_GG[8]<<"     ; G500/G54/G55/...")
WRITE(_TEMP,_TEMP_FILE,";CYCLE998("<<S_MVAR<<","<<S_KNUM<<","<<S_RA<<","<<S_PRNUM<<","<<S_SETV<<","<<S_STA1<<","<<S_INCA<<","<<S_FA<<","<<S_TSA<<","<<S_MA<<","<<S_MD<<","<<S_ID<<","<<S_SETV0<<","<<S_SETV1<<","<<S_SETV2<<","<<S_SETV3<<","<<S_NMSP<<","<<S_EVNUM<<","<<_DMODE<<","<<_AMODE<<")")
WRITE(_TEMP,_TEMP_FILE,";M30")
ENDIF
IF ($P_SUBPAR[1])
S_MVAR=ABS(S_MVAR) _OVI[3]=S_MVAR _CHBIT_S21=_CHBIT[21] _NEW_PAR=1 _M_SPE[3]=1
_SERR=<<"(S_MVAR: dec1)"
IF ((S_MVAR _DEC1)<5) OR ((S_MVAR _DEC1)> 6) GOTOF _M122
_H_KNUM = (S_MVAR _DEC3)
_SERR=<<"(S_MVAR: dec3)"
IF _H_KNUM > 1 GOTOF _M122
S_KNUM=ABS(S_KNUM)
IF (_H_KNUM <> 1) GOTOF _HA1
IF (S_KNUM _DEC3) > 0
S_KNUM = S_KNUM - ((S_KNUM _DEC3)*100)
ENDIF
_SERR=<<"(S_KNUM: dec4)"
IF (((S_KNUM _DEC4) > 3) AND ((S_KNUM _DEC4) <> 9)) GOTOF _M122
_SERR=<<"(S_KNUM: dec5)"
IF (S_KNUM _DEC5) > 1 GOTOF _M122
_CHBIT[21] = 0
IF (S_KNUM _DEC5) == 1
_CHBIT[21]=1 S_KNUM = S_KNUM - 10000
ENDIF
_SERR=<<"(S_KNUM: (dec2 + dec1)>16)"
IF (S_KNUM _DEC4) == 1
IF (((S_KNUM _DEC2)+(S_KNUM _DEC1)) > 16) GOTOF _M122
S_KNUM = S_KNUM + 10
ENDIF
IF (S_KNUM _DEC4) == 2
S_KNUM = 2000
ENDIF
IF (S_KNUM _DEC4) == 9
S_KNUM = 9999
ENDIF
_KNUM = S_KNUM
_HA1:
_SERR=<<"(S_MVAR: dec3)"
IF ((S_MVAR _DEC3) > 1) GOTOF _M122
_SERR=<<"(S_MVAR: dec4)"
IF ((S_MVAR _DEC4) > 1) GOTOF _M122
_SERR=<<"(S_MVAR: dec5)"
IF ((S_MVAR _DEC5) > 1) GOTOF _M122
_SERR=<<"(S_MVAR: dec6)"
IF ((S_MVAR _DEC6) > 1) GOTOF _M122
IF (_H_KNUM==0)
S_MVAR=S_MVAR + 100 _KNUM=0
ENDIF
_VB[25]=0
IF ((S_MVAR _DEC4)==1)
_VB[25]=1 S_MVAR = S_MVAR - ((S_MVAR _DEC4)*1000)
ENDIF
IF ((S_MVAR _DEC1)==6)
IF (S_SETV0 == 0)
_SERR=<<"S_SETV0"
GOTOF _M123
ENDIF
IF (S_SETV3 == 0)
_SERR=<<"S_SETV3"
GOTOF _M123
ENDIF
_ID=S_SETV0 _SETV[0]=S_SETV3
S_MD=2 S_MA=3 _MA=S_MA _MD=S_MD-1
ELSE
_ID=ABS(S_ID) S_MD=ABS(S_MD)
_SERR=<<"(S_MD: "<<S_MD<<")"
IF ((S_MD < 1) OR (S_MD > 2)) GOTOF _M122
_MD=S_MD-1
ENDIF
_MVAR=ABS(S_MVAR) _RA=ABS(S_RA) _PRNUM=ABS(S_PRNUM) _SETVAL=S_SETV _STA1=S_STA1 MOD 360 _INCA=S_INCA MOD 360 _FA=ABS(S_FA) _TSA=ABS(S_TSA)
_MA=ABS(S_MA)
IF S_NMSP<>0
_NMSP=ABS(S_NMSP)
ELSE
_NMSP=1
ENDIF
_SERR=<<"(S_EVNUM: ??)"
IF (((S_EVNUM _DEC2)*10) + (S_EVNUM _DEC1)) > 20 GOTOF _M122
IF S_EVNUM<>0
_EVNUM = ABS(S_EVNUM)
ELSE
_EVNUM = 0
ENDIF
_SERR=<<"(_DMODE: dec1)"
_H_DMODE=ABS(_DMODE _DEC1)
IF(_H_DMODE>3) GOTOF _M122
IF(_H_DMODE>0)AND($P_GG[6]<>_H_DMODE)
G[6]=_H_DMODE
ENDIF
ELSE
IF _SMI_R[10]
ELSE
_MVAR=_MVAR MOD 1000000
IF _MVAR _DEC4
_MVAR=((_MVAR - _MVAR MOD 10000)+ _MVAR MOD 1000)+10000
ENDIF
ENDIF
_OVI[3]=-_MVAR
ENDIF
IF (($P_TOOLNO>0) AND ($P_TOOL>0))
IF (_PRNUM>0)
IF ($P_AD[1]==712) OR ($P_AD[1]==713) OR ($P_AD[1]==714)
_CORA=($P_AD[10]+360) MOD 360
IF _PRNUM _DEC3==0
_PRNUM = _PRNUM + 100
ENDIF
ELSE
IF ($P_AD[1]==710)
_CORA=($P_AD[10]+360) MOD 360
ELSE
_CORA=0
ENDIF
IF _PRNUM _DEC3==1
_PRNUM = _PRNUM - 100
ENDIF
ENDIF
ENDIF
ENDIF
_ALARM=61342
IF ($AN_NCK_VERSION<660000) GOTOF _M121
_ALARM=0
IF $SCS_MEA_SIM_ENABLE ==9
_INTERN[7] =1
ENDIF
_H_SIM=$MN_SIM_ENVIRONMENT*100 _M_N[18]=0 _M_SPE[60]=1
IF (_H_SIM)AND($P_SIM)
_H_SIM=_H_SIM+1
ENDIF
IF _H_SIM
IF $SCS_MEA_SIM_ENABLE==0 GOTOF _GENDE
IF ($SCS_MEA_SIM_ENABLE<9)
IF _H_SIM == 501
IF ($AC_SERUPRO>0)
_M_N[18] =1
ENDIF
ELSE
IF _H_SIM _DEC3 ==3
IF _H_SIM _DEC1
_M_N[18] =301
ELSE
_INTERN[7] =1
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
IF $P_SEARCH GOTOF _GENDE
IF $P_ISTEST OR $P_DRYRUN GOTOF _ENDE
ENDIF
IF ($MN_MM_NUM_GLOBAL_USER_FRAMES>0)
_HI[0]=1
_RET_CYCFRAME=$P_CYCFRAME
$P_CYCFRAME=CTRANS()
ENDIF
IF $MC_TOOL_PARAMETER_DEF_MASK B_AND 'B100000000000'
_HI[7]=2
ELSE
_HI[7]=1
ENDIF
_OVI[2]=998
IF (ISFILE("/_N_CST_DIR/_N_CYCLE120_SPF"))
CYCLE120
ENDIF
N190 CYCLE109(_INTERN,_M_SPE,_M_N)
N1057 DIAMCYCOF G0 G90 G94
_HMVAR=_MVAR MOD 100000 _VB[0]=1
IF (_ID == 0)
_ALARM=61364
GOTOF _M121
ENDIF
_ALARM=61307
IF (_MVAR _DEC6 <0)OR(_MVAR _DEC6 >1) GOTOF _M121
IF (_HMVAR <>105)AND(_HMVAR <>10105)AND(_HMVAR MOD 10000 <>106) GOTOF _M121
_ALARM=0
IF _MVAR _DEC6 ==1
_VB[15]=1
IF (_MD < 0) OR (_MD > 1)
_ALARM=61326
ENDIF
ENDIF
IF _MVAR _DEC5 ==1
IF _PRNUM > 99
_ALARM=61309
ENDIF
_VB[18]=1 _VB[3]=1 _HR[2]=$AA_IM[SPI($AC_MSNUM)]
ENDIF
IF _ALARM GOTOF _M121
IF (_HMVAR _DEC1 == 6)
_VB[49]=1
ENDIF
CYCLE110(_VB,_M_SPE,_M_N,_XX,_YY,_ZZ,_ALARM,_INTERN,_DAT,_KF)
_HI[5]=_M_SPE[54] MOD 100 _ALARM=61341 _HR[8]=0 _M_SPE[32]=_M_SPE[32]*_M_SPE[29]
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND((_HI[5] B_AND 'B0001'<>1)OR(_HI[5] B_AND 'B0010'<>2)OR((_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8))) GOTOF _M124
IF (_INTERN[68] == 1)
_HI[7]=_M_SPE[74] MOD 100
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND((_HI[7] B_AND 'B0001'<>1)OR(_HI[7] B_AND 'B0010'<>2)OR((_HI[7] B_AND 'B0100'<>4)AND(_HI[7] B_AND 'B1000'<>8))) GOTOF _M124
ENDIF
IF (_VB[18]==0)AND(_HI[5] B_AND 'B1000'==8)
_HR[8]=_M_SPE[25]
IF _INTERN[20+14]==0
_HR[8]=_HR[8] - _M_SPE[20]/2
ENDIF
ENDIF
IF (_INTERN[68] == 1)
_HR[9]=_M_SPE[69]
IF _INTERN[20+14]==0
_HR[9]=_HR[9] - _M_SPE[64]/2
ENDIF
ENDIF
_ALARM=0 _OVR[0]=_STA1 _H_OVR0=_OVR[0] _OVI[0]=_KNUM _HR[5]=_M_SPE[32] _VB[16]=1 _HR[0]=_STA1 _HR[6]=_ID _HI[4]=1 _HI[9]=_HI[4]
IF (_INTERN[68] == 1)
_OVR[100]=_STA1
_H_OVR100=_OVR[100]
ENDIF
IF _VB[49] GOTOF _M2
IF _VB[18]==1
_M_SPE[27]=SET(0,0)
IF (_INTERN[68] == 1)
_M_SPE[71]=SET(0,0)
ENDIF
ENDIF
IF _MA == 103
_HI[4]=-1 _HI[9]=_HI[4]
ENDIF
IF (ABS(_STA1)+ABS(_M_SPE[32]))<60 GOTOF _M7
_HR[0]=30 _HR[5]=30
IF _STA1<0
_HR[0]=-30
ENDIF
IF ABS(_STA1)<60 GOTOF _M7
_ALARM=61331
GOTOF _M124
_M2:_ALARM=61341 _HI[3]=1 _HI[1]=3 _HI[4]=-1 _HI[9]=_HI[4] _MAV=_ZZ _AXIND=2 _VAV=_XX _OVR[1]=_INCA _H_OVR1=_OVR[1] _HR[0]=_INCA
IF (_INTERN[68] == 1)
_OVR[101]=_INCA
_H_OVR101=_OVR[101]
ENDIF
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M128
IF (_INTERN[68] == 1)
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[7] B_AND 'B0100'<>4)AND(_HI[7] B_AND 'B1000'<>8) GOTOF _M128
ENDIF
GOTOF _M7A
_M7:_HI[3]=_MA/100 _HI[1]=_MA MOD 100 _ALARM=61341
IF (_HI[3]<0)OR(_HI[3]>3)OR(_HI[1]<0)OR(_HI[1]>3)OR(_HI[3]==_HI[1])OR((_HI[1]==3)AND(_VB[18]==1))
_OVI[9]=61325
SETAL(_OVI[9])
M17
ENDIF
IF _HI[3]==1
_VAV=_XX
ELSE
IF _HI[3]==2
_VAV=_YY
ELSE
_VAV=_ZZ
ENDIF
ENDIF
IF _HI[1]==1
_MAV=_XX _HI[2]=-90
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[5] B_AND 'B0001'<>1) GOTOF _M128
ELSE
IF _HI[1]==2
_MAV=_YY
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[5] B_AND 'B0010'<>2) GOTOF _M128
ELSE
_MAV=_ZZ
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[5] B_AND 'B0100'<>4)AND(_HI[5] B_AND 'B1000'<>8) GOTOF _M128
ENDIF
ENDIF
IF (_INTERN[68] == 1)
IF _HI[1]==1
_MAV=_XX _HI[2]=-90
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[7] B_AND 'B0001'<>1) GOTOF _M128
ELSE
IF _HI[1]==2
_MAV=_YY
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[7] B_AND 'B0010'<>2) GOTOF _M128
ELSE
_MAV=_ZZ
IF (_INTERN[20+16]==1)AND(_VB[18]==0)AND(_HI[7] B_AND 'B0100'<>4)AND(_HI[7] B_AND 'B1000'<>8) GOTOF _M128
ENDIF
ENDIF
ENDIF
_M7A: _AXIND_V=_HI[3]-1 _P_POS_V=_M_SPE[5+_AXIND_V] _AXIND=_HI[1]-1 _P_POS=_M_SPE[5+_AXIND] _P_PL=7+_AXIND _P_PT=1+_AXIND*2 _ALARM=0
IF _VAV<>_ZZ
_P_POS_V=_M_SPE[5+_AXIND_V]+_M_SPE[27+_AXIND_V]
ENDIF
IF _NEW_PAR==1
IF _VB[25]==0
_VB[52]=1
IF _MD
_M_SPE[16]=_M_SPE[5+_AXIND]-_M_SPE[3]*2
ELSE
_M_SPE[16]=_M_SPE[5+_AXIND]+_M_SPE[3]*2
ENDIF
_M_SPE[10]=_P_POS
ELSE
IF _MD
_M_SPE[16]=_M_SPE[5+_AXIND] - ABS(_M_SPE[16])
ELSE
_M_SPE[16]=_M_SPE[5+_AXIND] + ABS(_M_SPE[16])
ENDIF
ENDIF
IF (_HI[1]==1)AND(_VB[49]==0)
_HI[4]=-1 _HI[9]=_HI[4]
ENDIF
IF $MNS_DISP_RES_ROT_WO >0
IF _VB[49] OR(NOT(_RA))
_HI[6]=$MNS_DISP_RES_ROT_WO
ELSE
_HI[6]=$MNS_DISP_RES_ANGLE
ENDIF
ELSE
_HI[6]=$MNS_DISP_RES_ANGLE
ENDIF
_HI[11]=1 _HI[12]=1
FOR _HI[8]=0 TO _HI[6]
_HI[13]=_HI[11]*_HI[12] _HI[11]=10
IF _HI[8] >=1
_HI[12]=_HI[12]*10
ENDIF
ENDFOR
_OVR[0]=(ROUND(_OVR[0]*_HI[13]))/_HI[13] _OVR[1]=(ROUND(_OVR[1]*_HI[13]))/_HI[13] _OVR[28]=(ROUND(_OVR[28]*_HI[13]))/_HI[13]
IF (_INTERN[68] == 1)
_OVR[100]=(ROUND(_OVR[100]*_HI[13]))/_HI[13] _OVR[101]=(ROUND(_OVR[101]*_HI[13]))/_HI[13] _OVR[128]=(ROUND(_OVR[128]*_HI[13]))/_HI[13]
ENDIF
ELSE
_HI[13]=10000
IF _VB[15]==1
IF _MD
_M_SPE[16]=_M_SPE[5+_AXIND]-_M_SPE[3]*2
ELSE
_M_SPE[16]=_M_SPE[5+_AXIND]+_M_SPE[3]*2
ENDIF
_M_SPE[10]=_P_POS
ELSE
IF (_HI[1]==1)AND(_VB[49]==0)
_HI[4]=-1 _HI[9]=_HI[4]
ENDIF
ENDIF
ENDIF
IF (_M_SPE[16] > _P_POS)
IF (_MAV == _YY)
_M_ZUST[2]=1
GOTOF _M84
ENDIF
_M_ZUST[0]=1
GOTOF _M84
ENDIF
IF(_MAV <> _ZZ)
IF(_MAV <> _YY)
_M_ZUST[1]=1 _INTERN[37]=1
GOTOF _M84
ENDIF
_M_ZUST[3]=1 _INTERN[37]=1
GOTOF _M84
ENDIF
_M_ZUST[1]=1
_M84:_M_SPE[5]=_M_SPE[5]+_M_SPE[27] _M_SPE[6]=_M_SPE[6]+_M_SPE[28] _HR[7]=_M_SPE[5]
_M_SPE[17]=_M_SPE[17]+_M_SPE[27]*_DAT[0,1]+_M_SPE[28]*_DAT[1,1] _M_SPE[18]=_M_SPE[18]+_M_SPE[27]*_DAT[0,2]+_M_SPE[28]*_DAT[1,2]
_M_SPE[19]=_M_SPE[19]+_M_SPE[27]*_DAT[0,3]+_M_SPE[28]*_DAT[1,3]
IF _VB[1]==0
G1 F=_M_SPE[1]
ENDIF
IF _INTERN[2]
N1080 AX[_XX]=_M_SPE[5]*_M_SPE[29]
ENDIF
IF _INTERN[10]
N1090 AX[_YY]=_M_SPE[6]*_M_SPE[29]
ENDIF
IF ((_M_ZUST[0]==0) AND (_M_ZUST[2]==0))
_MESSR=1
GOTOF _M92
ENDIF
_MESSR=-1 _P_PT=_P_PT+1
_M92:_LAGE=0 _TRIGLAG=_M_SPE[20+_P_PT]
IF _VB[18]
_HR[1]=(($P_ADT[6]/_HI[7]+_M_SPE[3])*_MESSR)+_HR[8]
ELSE
_HR[1]=((_M_SPE[20]/2+_M_SPE[3])*_MESSR)+_HR[8]
ENDIF
IF (_INTERN[20+14])AND(_MAV==_ZZ)AND(_INTERN[18])
_HR[1]=_M_SPE[3]*_MESSR+_HR[8]
ENDIF
IF ((_VB[48]) AND (_VB[18]==0) AND (_HI[1]<>3))
_TRIGLAG=_M_SPE[20]*_MESSR/2
ENDIF
IF _MAV<>_ZZ
_LAGE=_M_SPE[20+_P_PL]
ENDIF
_TRIGLAG=_TRIGLAG+_LAGE
IF _NEW_PAR
IF _VB[25]
_M_SPE[10]=_M_SPE[16]+_HR[1]+_LAGE _KF[2,0]=_M_SPE[5+_AXIND]-_M_SPE[10] _M_ME[15]=_KF[2,0]
IF (_VB[18])
_KF[2,0]=0
ENDIF
IF NOT(((_MESSR==-1) AND (_M_SPE[10]>_P_POS)) OR ((_MESSR==1) AND (_M_SPE[10]<_P_POS)))
_M_SPE[10]=_P_POS
ENDIF
IF (_VB[15]==1)
_P_POS=_M_SPE[10]
ENDIF
_VB[15]=0
ELSE
IF (_VB[49])AND(_VB[15]==0)
_M_SPE[10]=_P_POS
ENDIF
ENDIF
ELSE
IF _VB[15] ==0
_M_SPE[10]=_M_SPE[16]+_HR[1]+_LAGE
IF NOT(((_MESSR==-1) AND (_M_SPE[10]>_P_POS)) OR ((_MESSR==1) AND (_M_SPE[10]<_P_POS)))
_M_SPE[10]=_P_POS
ENDIF
_P_POS=_M_SPE[10]
ENDIF
ENDIF
_M_SPE[9]=_M_SPE[10]-_M_SPE[60]*_M_SPE[3]*_MESSR _M_ME[11]=_M_SPE[10]-_M_SPE[3]*_MESSR _MER11=_M_ME[11]
_HR[3]=_M_SPE[9] _HR[4]=_M_SPE[10]
_M97: IF (_VB[18]==0) OR (_VB[26]) GOTOF _M95
_M_SPE[8]=_M_SPE[8]+179.999
N1100 _M95:CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF _MVAR _DEC6 == 1
_VB[15]=1
ENDIF
_M_ME[0]=_M_ME[8] _M_ME[8]=SET(0,0)
IF (_INTERN[68] == 1)
_M_ME[20]=_M_ME[28] _M_ME[28]=SET(0,0)
ENDIF
IF (_VB[18] == 1)
IF (_VB[26] == 0)
_M_ME[4]=_M_ME[0] _M_SPE[8]=_M_SPE[8]-179.999 _VB[26]=1 _KF[2,0]=_M_ME[15]
IF (_INTERN[68] == 1)
_M_ME[24]=_M_ME[20]
ENDIF
GOTOB _M95
ENDIF
_HR[1]=(_M_ME[4]+_M_ME[0]-($P_ADT[6]/_HI[7])*2*_MESSR)/2 _TRIGLAG=_M_ME[0]-_HR[1]
IF (_INTERN[68] == 1)
_HR[10]=(_M_ME[24]+_M_ME[20]-($P_ADT[6]/_HI[7])*2*_MESSR)/2 _TRIGLAG2=_M_ME[20]-_HR[10]
_M_ME[24]=0
ENDIF
_M_ME[4]=0 _VB[18]=0 _VB[26]=0 _VB[3]=0
IF _INTERN[40+18]
N2000 CUST_MEACYC(3,_HR[2],0)
ELSE
N2001 SUPA SPOS=DC(_HR[2])
ENDIF
ENDIF
_M_ME[0]=_M_ME[0]-_TRIGLAG
IF (_INTERN[68] == 1)
_M_ME[20]=_M_ME[20]-_TRIGLAG2
ENDIF
N1110 G0 G90 G94
IF (_VB[1] == 0)
N1120 G1 F=_M_SPE[1]
ENDIF
IF _M_ME[7] GOTOF _M104C IF _MP3 GOTOF _MP3A
_M_ME[7]=1 _M_ME[4]=_M_ME[0]
IF (_INTERN[68] == 1)
_M_ME[27]=1 _M_ME[24]=_M_ME[20]
ENDIF
IF _M_N[18]
_M_ME[4]=_MER11-_TRIGLAG
IF (_INTERN[68] == 1)
_M_ME[24]=_MER11-_TRIGLAG2
ENDIF
ENDIF
$AC_MEAS_SEMA=1 $AC_MEAS_VALID=0
$AA_MEAS_POINT1[_XX]=$AA_IW[_XX]-_M_SPE[27] $AA_MEAS_POINT1[_YY]=$AA_IW[_YY]-_M_SPE[28] $AA_MEAS_POINT1[_ZZ]=$AA_IW[_ZZ] $AA_MEAS_POINT1[_MAV]=_M_ME[4]
IF (_INTERN[68] == 1)
_HR[11]=$AA_IW[_XX]-_M_SPE[71] _HR[12]=$AA_IW[_YY]-_M_SPE[72] _HR[13]=$AA_IW[_ZZ] _HR[14]=_M_ME[24]
ENDIF
GOTOF _M105
_M104C:_M_ZUST[7]=1 _M_ME[5]=_M_ME[0]
$AA_MEAS_POINT2[_XX]=$AA_IW[_XX]-_M_SPE[27] $AA_MEAS_POINT2[_YY]=$AA_IW[_YY]-_M_SPE[28] $AA_MEAS_POINT2[_ZZ]=$AA_IW[_ZZ] $AA_MEAS_POINT2[_MAV]=_M_ME[5]
IF (_INTERN[68] == 1)
_M_ME[25]=_M_ME[20]
_HR[15]=$AA_IW[_XX]-_M_SPE[71] _HR[16]=$AA_IW[_YY]-_M_SPE[72] _HR[17]=$AA_IW[_ZZ] _HR[18]=_M_ME[25]
ENDIF
IF (_VB[49] == 0)
IF _VB[32]
IF (_MA==102)OR(_MA==201)
_H_VAV=_ZZ $AC_MEAS_ACT_PLANE=0 $AC_MEAS_INPUT[0]=(_MA DIV 100)-1
ELSE
IF (_MA==103)OR(_MA==301)
_H_VAV=_YY $AC_MEAS_ACT_PLANE=1 $AC_MEAS_INPUT[0]=_MA MOD 100 DIV 3
ELSE
_H_VAV=_XX $AC_MEAS_ACT_PLANE=2 $AC_MEAS_INPUT[0]=(_MA DIV 100)-2
ENDIF
ENDIF
ELSE
IF _VB[33]
IF (_MA==102)OR(_MA==201)
_H_VAV=_ZZ $AC_MEAS_ACT_PLANE=1 $AC_MEAS_INPUT[0]=(_MA DIV 100)-1
ELSE
IF (_MA==103)OR(_MA==301)
_H_VAV=_YY $AC_MEAS_ACT_PLANE=2 $AC_MEAS_INPUT[0]=_MA MOD 100 DIV 3
ELSE
_H_VAV=_XX $AC_MEAS_ACT_PLANE=0 $AC_MEAS_INPUT[0]=(_MA DIV 100)-2
ENDIF
ENDIF
ELSE
IF (_MA==102)OR(_MA==201)
_H_VAV=_ZZ $AC_MEAS_ACT_PLANE=2 $AC_MEAS_INPUT[0]=(_MA DIV 100)-1
ELSE
IF (_MA==103)OR(_MA==301)
_H_VAV=_YY $AC_MEAS_ACT_PLANE=0 $AC_MEAS_INPUT[0]=_MA MOD 100 DIV 3
ELSE
_H_VAV=_XX $AC_MEAS_ACT_PLANE=1 $AC_MEAS_INPUT[0]=(_MA DIV 100)-2
ENDIF
ENDIF
ENDIF
ENDIF
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0 $AC_MEAS_TYPE=16 $AC_MEAS_WP_SETANGLE=0
_OVI[12]=MEASURE()
IF _OVI[12]==0
_H_OVR4=$AC_MEAS_WP_ANGLE _OVR[4]=(ROUND(_H_OVR4*_HI[13]))/_HI[13]
ELSE
_ALARM=61403
GOTOF _M129
ENDIF
IF (_INTERN[68] == 1)
$AA_MEAS_POINT1[_XX]=_HR[11] $AA_MEAS_POINT1[_YY]=_HR[12] $AA_MEAS_POINT1[_ZZ]=_HR[13] $AA_MEAS_POINT1[_MAV]=_HR[14]
$AA_MEAS_POINT2[_XX]=_HR[15] $AA_MEAS_POINT2[_YY]=_HR[16] $AA_MEAS_POINT2[_ZZ]=_HR[17] $AA_MEAS_POINT2[_MAV]=_HR[18]
_OVI[12]=MEASURE()
IF _OVI[12]==0
_H_OVR104=$AC_MEAS_WP_ANGLE _OVR[104]=(ROUND(_H_OVR104*_HI[13]))/_HI[13]
ELSE
_ALARM=61403
GOTOF _M129
ENDIF
ENDIF
GOTOF _M106
ENDIF
_H_OVR5=_H_OVR4 _H_OVR4=0 _M_ZUST[7]=0 _MP3=1 _M_ME[7]=0
IF NOT(((S_MVAR _DEC1)==6) AND (S_SETV2 <> 0))
AX[_XX]=_HR[7]*_M_SPE[29] AX[_MAV]=(_HR[4]+_KF[2,0])*_M_SPE[29]
ENDIF
_M_SPE[17]=SET($AA_IM[_XX],$AA_IM[_YY],$AA_IM[_ZZ]) _M_SPE[5]=SET($AA_IW[_XX],$AA_IW[_YY],$AA_IW[_ZZ])
_VAV=_YY _AXIND_V=1 _HR[0]=_STA1 _HR[6]=_SETV[0] _P_POS_V=_M_SPE[5+_AXIND_V]
GOTOF _M105
_MP3A:_M_ZUST[7]=1 _MP3=0 _M_ME[6]=_M_ME[0]
$AA_MEAS_POINT3[_XX]=$AA_IW[_XX]-_M_SPE[27] $AA_MEAS_POINT3[_YY]=$AA_IW[_YY]-_M_SPE[28] $AA_MEAS_POINT3[_ZZ]=$AA_IW[_ZZ] $AA_MEAS_POINT3[_MAV]=_M_ME[6]
IF (_INTERN[68] == 1)
_M_ME[26]=_M_ME[20]
_HR[19]=$AA_IW[_XX]-_M_SPE[71] _HR[20]=$AA_IW[_YY]-_M_SPE[72] _HR[21]=$AA_IW[_ZZ] _HR[22]=_M_ME[26]
ENDIF
$AC_MEAS_T_NUMBER=0 $AC_MEAS_D_NUMBER=0 $AC_MEAS_TYPE=17
$AA_MEAS_SETANGLE[_XX]=_STA1 $AA_MEAS_SETANGLE[_YY]=_INCA
_OVI[12]=MEASURE()
IF _OVI[12]==0
_H_OVR4=$AC_MEAS_RESULTS[0] _H_OVR5=$AC_MEAS_RESULTS[1]
_OVR[4]=(ROUND(_H_OVR4*_HI[13]))/_HI[13] _OVR[5]=(ROUND(_H_OVR5*_HI[13]))/_HI[13]
_HR[23]=(ROUND($AC_MEAS_RESULTS[3]*_HI[13]))/_HI[13]
_HR[24]=(ROUND($AC_MEAS_RESULTS[4]*_HI[13]))/_HI[13]
_HR[25]=(ROUND($AC_MEAS_RESULTS[5]*_HI[13]))/_HI[13]
ELSE
_ALARM=61403
GOTOF _M129
ENDIF
IF (_INTERN[68] == 1)
$AA_MEAS_POINT1[_XX]=_HR[11] $AA_MEAS_POINT1[_YY]=_HR[12] $AA_MEAS_POINT1[_ZZ]=_HR[13] $AA_MEAS_POINT1[_MAV]=_HR[14]
$AA_MEAS_POINT2[_XX]=_HR[15] $AA_MEAS_POINT2[_YY]=_HR[16] $AA_MEAS_POINT2[_ZZ]=_HR[17] $AA_MEAS_POINT2[_MAV]=_HR[18]
$AA_MEAS_POINT3[_XX]=_HR[19] $AA_MEAS_POINT3[_YY]=_HR[20] $AA_MEAS_POINT3[_ZZ]=_HR[21] $AA_MEAS_POINT3[_MAV]=_HR[22]
_OVI[12]=MEASURE()
IF _OVI[12]==0
_H_OVR104=$AC_MEAS_RESULTS[0] _H_OVR105=$AC_MEAS_RESULTS[1]
_OVR[104]=(ROUND(_H_OVR104*_HI[13]))/_HI[13] _OVR[105]=(ROUND(_H_OVR105*_HI[13]))/_HI[13]
_HR[26]=(ROUND($AC_MEAS_RESULTS[3]*_HI[13]))/_HI[13]
_HR[27]=(ROUND($AC_MEAS_RESULTS[4]*_HI[13]))/_HI[13]
_HR[28]=(ROUND($AC_MEAS_RESULTS[5]*_HI[13]))/_HI[13]
ELSE
_ALARM=61403
GOTOF _M129
ENDIF
ENDIF
_M105:IF _M_ZUST[7]==1 GOTOF _M106
IF _VB[15]
IF _VB[25]
_HR[8]=_HR[4]
ENDIF
_M_SPE[9]=SET(_HR[3],_HR[4])
ELSE
IF _VB[25]
_M_SPE[10]=(_HR[4]+_KF[2,0])+(TAN(_HR[0]+_MESSR*_HI[4]*_HR[5])*(_HR[6]/_M_SPE[29]))*_HI[4]
_M_SPE[9]=_HR[3]+(TAN(_HR[0]-_MESSR*_HI[4]*_HR[5])*(_HR[6]/_M_SPE[29]))*_HI[4]
ELSE
_M_SPE[10]=_HR[4]+(TAN(_HR[0]+_MESSR*_HI[4]*_HR[5])*(_HR[6]/_M_SPE[29]))*_HI[4]
_M_SPE[9]=_HR[3]+(TAN(_HR[0]-_MESSR*_HI[4]*_HR[5])*(_HR[6]/_M_SPE[29]))*_HI[4]
ENDIF
ENDIF
_M_ME[11]=_MER11
_H=_M_SPE[9] _HH=_M_SPE[10] _M_ZUST[14]=SET(1,1) _M_SPE[5+_AXIND_V]=_M_SPE[5+_AXIND_V]+_HR[6] _M_SPE[17]=_M_SPE[17]+_HR[6]*_DAT[_AXIND_V,1]
_M_SPE[18]=_M_SPE[18]+_HR[6]*_DAT[_AXIND_V,2] _M_SPE[19]=_M_SPE[19]+_HR[6]*_DAT[_AXIND_V,3]
CYCLE111(_MAV,_XX,_YY,_ZZ,_M_SPE,_M_ME,_M_N,_ALARM,_M_ZUST,_VB,_INTERN,_DAT,_KF)
IF (_M_ZUST[12]==0) AND (_M_ZUST[13]==0) GOTOF _M105A
_ALARM=61401
IF _M_ZUST[12]==0 GOTOF _M105A0 IF _M_SPE[9] < _HH GOTOF _M105A
GOTOF _M125
_M105A0: IF _M_SPE[10]<=_H GOTOF _M125
_M105A: _ALARM=0 _M_ZUST[14]=SET(0,0) _H=_M_SPE[10]-_M_SPE[5+_AXIND] _M_SPE[5+_AXIND]=_M_SPE[10] _M_SPE[17]=_M_SPE[17]+_H*_DAT[_AXIND,1] _HI[4]=1
_M_SPE[18]=_M_SPE[18]+_H*_DAT[_AXIND,2] _M_SPE[19]=_M_SPE[19]+_H*_DAT[_AXIND,3]
IF _INTERN[40+2]==0 GOTOF _M105E
IF _VB[2]==0 GOTOF _M105B IF (_AXIND==2)OR(_AXIND_V==2) GOTOF _M105B
IF _VB[31]==1
_M_SPE[8]=360- _M_SPE[61] -(ATAN2(_M_SPE[10]-_P_POS,ABS(_ID))+_HI[2])
ELSE
_M_SPE[8]=_M_SPE[61] +(ATAN2(_M_SPE[10]-_P_POS,ABS(_ID))+_HI[2])
ENDIF
IF _INTERN[20+8]
_M_SPE[8]=_M_SPE[8]+_M_SPE[38]
ENDIF
_M_SPE[8]=((_M_SPE[8] MOD 360) + 360) MOD 360
IF _INTERN[40+18]
N1128 CUST_MEACYC(3,_M_SPE[8],0)
ELSE
N1129 SUPA SPOS=DC(_M_SPE[8])
ENDIF
N1130 _M105B:
IF (((S_MVAR _DEC1)==6)AND(_AXIND_V==1)AND(S_SETV2 <> 0))
IF _VB[25]
MEAS=_M_N[0] AX[_XX]=S_SETV2+_HR[7]*_M_SPE[29] AX[_VAV]=_HR[6]+_P_POS_V*_M_SPE[29] AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
IF _VB[15]
IF _VB[49]==0
MEAS=_M_N[0] AX[_MAV]=_HR[8]*_M_SPE[29]
ENDIF
ENDIF
ELSE
MEAS=_M_N[0] AX[_XX]=S_SETV2+_HR[7]*_M_SPE[29] AX[_VAV]=_HR[6]+_P_POS_V*_M_SPE[29] AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
ENDIF
ELSE
IF _VB[25]
IF _VB[15]
MEAS=_M_N[0] AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
IF _VB[49]==0
STOPRE
IF (_INTERN[18])AND(_MAV==_ZZ)
F=_M_SPE[2]
ENDIF
MEAS=_M_N[0] AX[_MAV]=_HR[8]*_M_SPE[29]
ENDIF
ELSE
MEAS=_M_N[0] AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=_M_SPE[10]*_M_SPE[29]
_M_SPE[10]=_M_SPE[10] - _KF[2,0]
ENDIF
ELSE
MEAS=_M_N[0] AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=_M_SPE[10]*_M_SPE[29]
ENDIF
ENDIF
IF $AC_MEA[_M_N[0]]==0 GOTOB _M97
_ALARM=61302
IF _M_ZUST[13]
_ALARM=61402
ENDIF
GOTOF _M126
N1150 _M105E:
IF (((S_MVAR _DEC1)==6)AND(_AXIND_V==1)AND(S_SETV2 <> 0))
IF _VB[25]
AX[_XX]=S_SETV2+_HR[7]*_M_SPE[29] AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
IF _VB[15]
IF _VB[49]==0
AX[_MAV]=_HR[8]*_M_SPE[29]
ENDIF
ENDIF
ELSE
AX[_XX]=S_SETV2+_HR[7]*_M_SPE[29] AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
ENDIF
ELSE
IF _VB[25]
IF _VB[15]
AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=(_M_SPE[10]+_KF[2,0])*_M_SPE[29]
IF _VB[49]==0
STOPRE
AX[_MAV]=_HR[8]*_M_SPE[29]
ENDIF
ELSE
AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=_M_SPE[10]*_M_SPE[29]
_M_SPE[10]=_M_SPE[10] - _KF[2,0]
ENDIF
ELSE
AX[_VAV]=_P_POS_V*_M_SPE[29]+_HR[6] AX[_MAV]=_M_SPE[10]*_M_SPE[29]
ENDIF
ENDIF
GOTOB _M97
_M106:_M_ZUST[7]=1 _M_ME[4]=SET(0,0,0,0) _OVI[7]=_M_N[22] MOD 10000
IF _OVI[7]==0 GOTOF _M109
_HR[0]=_EV[_OVI[7]-1]
IF _INTERN[40+5]==0 GOTOF _M108
_HR[0]=-_HR[0]
_M108:_H_OVR4=_H_OVR4-_HR[0]
IF _VB[49]
_H_OVR5=_H_OVR5-_HR[0]
ENDIF
IF (_INTERN[68] == 1)
_H_OVR104=_H_OVR104-_HR[0]
IF _VB[49]
_H_OVR105=_H_OVR105-_HR[0]
ENDIF
ENDIF
_M109:_H_OVR16=_H_OVR4-_H_OVR0 _OVR[16]=(ROUND(_H_OVR16*_HI[13]))/_HI[13]
IF _VB[49]
_H_OVR17=_H_OVR5-_H_OVR1 _OVR[17]=(ROUND(_H_OVR17*_HI[13]))/_HI[13]
ENDIF
IF (_INTERN[68] == 1)
_H_OVR116=_H_OVR104-_H_OVR100 _OVR[116]=(ROUND(_H_OVR116*_HI[13]))/_HI[13]
IF _VB[49]
_H_OVR117=_H_OVR105-_H_OVR101 _OVR[117]=(ROUND(_H_OVR117*_HI[13]))/_HI[13]
ENDIF
FOR _HI[0]=0 TO 29
_OVR[900+_HI[0]]=(_OVR[+_HI[0]]+_OVR[100+_HI[0]])/2
ENDFOR
ENDIF
IF (ABS(_H_OVR16)<_M_SPE[32])AND(ABS(_H_OVR17)<_M_SPE[32]) GOTOF _M115
_ALARM=61303
IF (_INTERN[20+0])AND(_M_N[7]<4)
_M_N[7]=_M_N[7]+1
IF _INTERN[20+1]==0 GOTOF _M114A
N1180 SETAL(_ALARM+1000)
N1190 M0
STOPRE
_M114A:_M_ZUST[7]=0 _ALARM=0
ENDIF
_M115:IF _M_ZUST[7] GOTOF _M116
_M_SPE[9]=_HR[3] _M_SPE[10]=_HR[4] _M_ME[7]=0 _HI[4]=_HI[9]
N1200 AX[_VAV]=_P_POS_V*_M_SPE[29] AX[_MAV]=(_M_SPE[10]+ _KF[2,0])*_M_SPE[29]
_M_SPE[5+_AXIND_V]=_M_SPE[5+_AXIND_V]-_HR[6] _H=_M_SPE[10]-_M_SPE[5+_AXIND] _M_SPE[5+_AXIND]=_M_SPE[10]
_M_SPE[17]=_M_SPE[17]-_HR[6]*_DAT[_AXIND_V,1]+_H*_DAT[_AXIND,1] _M_SPE[18]=_M_SPE[18]-_HR[6]*_DAT[_AXIND_V,2]+_H*_DAT[_AXIND,2]
_M_SPE[19]=_M_SPE[19]-_HR[6]*_DAT[_AXIND_V,3]+_H*_DAT[_AXIND,3]
IF _VB[49]
_HR[6]=_ID _HR[0]=_STA1 _VAV=_XX _AXIND_V=0 _P_POS_V=_M_SPE[5]
ENDIF
GOTOB _M95
_M116:IF _ALARM GOTOF _M129
_Z2=$P_GG[8]
IF _RA GOTOF _M119
_H_OVR20=_H_OVR16 _OVR[20]=(ROUND(_H_OVR16*_HI[13]))/_HI[13]
IF (_INTERN[68] == 1)
_H_OVR120=_H_OVR116 _OVR[120]=(ROUND(_H_OVR116*_HI[13]))/_HI[13]
ENDIF
IF _VB[49]
IF _OVI[12]==0
_REL_FRAME=$AC_MEAS_FRAME
_OVR[20]=_HR[23]
_OVR[21]=_HR[24]
_OVR[22]=_HR[25]
IF (_INTERN[68] == 1)
_OVR[120]=_HR[26]
_OVR[121]=_HR[27]
_OVR[122]=_HR[28]
FOR _HI[0]=0 TO 29
_OVR[900+_HI[0]]=(_OVR[+_HI[0]]+_OVR[100+_HI[0]])/2
ENDFOR
ENDIF
ELSE
_ALARM=61403
ENDIF
ELSE
_REL_FRAME[_H_VAV,RT]=_H_OVR20
ENDIF
IF _ALARM GOTOF _M128 IF _KNUM==0 GOTOF _M130
_MP3=0
IF _KNUM==1000
_ALARM=0 _MP3=1
IF ($MC_MM_NUM_BASE_FRAMES>0)
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
G[8]=_Z2
ELSE
_ALARM=61321
ENDIF
ENDIF
_PROTVAL[25] =SET("","","","","")
IF _ALARM GOTOF _M129
IF _VB[49]
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]" _PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",,,,F"<<_M_SPE[0]
ELSE
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_H_VAV)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",1,"<<AXSTRING(_H_VAV)<<",,F"<<_M_SPE[0]
ENDIF
IF _MP3 GOTOF _M129
IF _KNUM < 1000
_Z1=_KNUM+1 _ALARM=0 _MP3=1
IF _HI[0]
_ALARM=61321
GOTOF _M129
ENDIF
IF (_KNUM<$MC_MM_NUM_USER_FRAMES)
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_UIFR["<<_KNUM<<"]")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF _Z2 == _Z1
G[8]=_Z1
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
_PROTVAL[25] =SET("","","","","")
IF _ALARM GOTOF _M129
IF _VB[49]
_PROTVAL[25] ="$P_UIFR["<<_KNUM<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_UIFR["<<_KNUM<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_UIFR["<<_KNUM<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_KNUM<<",,,,F"<<_M_SPE[0]
ELSE
_PROTVAL[25] ="$P_UIFR["<<_KNUM<<","<<AXSTRING(_H_VAV)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_KNUM<<",1,"<<AXSTRING(_H_VAV)<<",,F"<<_M_SPE[0]
ENDIF
IF _MP3 GOTOF _M129
IF _KNUM==2000
_ALARM=0 _MP3=1
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_SETFR")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
G[8]=_Z2
ELSE
_ALARM=61321
ENDIF
ENDIF
_PROTVAL[25] =SET("","","","","")
IF _ALARM GOTOF _M129
IF _VB[49]
_PROTVAL[25] ="$P_SETFR["<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_SETFR["<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_SETFR["<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<",,,,,F"<<_M_SPE[0]
ELSE
_PROTVAL[25] ="$P_SETFR["<<AXSTRING(_H_VAV)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<",,1,"<<AXSTRING(_H_VAV)<<",,F"<<_M_SPE[0]
ENDIF
IF _MP3 GOTOF _M129
IF _KNUM==9999
_ALARM=0 _MP3=1
IF ($P_GG[8]==1)
IF ($P_CHBFRMASK==0)OR($MC_MM_NUM_BASE_FRAMES==0)
_ALARM=61321
ELSE
_Z2=0 _Z3=1 _M_BFNR=$MC_MM_NUM_BASE_FRAMES
FOR _Z4=1 TO _M_BFNR
IF ($P_CHBFRMASK B_AND _Z3)
_Z2=_Z4-1
ENDIF
_Z3=_Z3*2
ENDFOR
_M_BFNR=_Z2 _HI[10]=6 _HSTR_PROT="$P_CHB"
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
G500
ENDIF
ELSE
_M_BFNR=$P_UIFRNUM _HI[10]=5 _HSTR_PROT="$P_UI"
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_UIFR["<<_M_BFNR<<"]")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
G[8]=_Z2
ENDIF
ENDIF
_PROTVAL[25] =SET("","","","","")
IF _ALARM GOTOF _M129
IF _VB[49]
_PROTVAL[25] =""<<SUBSTR(_HSTR_PROT,0,_HI[10])<<"["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] =""<<SUBSTR(_HSTR_PROT,0,_HI[10])<<"["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] =""<<SUBSTR(_HSTR_PROT,0,_HI[10])<<"["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",,,,F"<<_M_SPE[0]
ELSE
_PROTVAL[25] =""<<SUBSTR(_HSTR_PROT,0,_HI[10])<<"["<<_M_BFNR<<","<<AXSTRING(_H_VAV)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",1,"<<AXSTRING(_H_VAV)<<",,F"<<_M_SPE[0]
ENDIF
IF _MP3 GOTOF _M129
IF ((_KNUM>1010)AND(_KNUM<=($MC_MM_NUM_BASE_FRAMES+1010)))
_M_BFNR=_KNUM-1011 _MP3=1
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
G[8]=_Z2
ELSE
_ALARM=61321
ENDIF
_PROTVAL[25] =SET("","","","","")
IF _ALARM GOTOF _M129
IF _VB[49]
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_XX)<<",RT]" _PROTVAL[26] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_YY)<<",RT]"
_PROTVAL[27] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_ZZ)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",,,,F"<<_M_SPE[0]
ELSE
_PROTVAL[25] ="$P_CHBFR["<<_M_BFNR<<","<<AXSTRING(_H_VAV)<<",RT]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_M_BFNR<<",1,"<<AXSTRING(_H_VAV)<<",,F"<<_M_SPE[0]
ENDIF
GOTOF _M129
_M119:_H_OVR20=_H_OVR16 _OVR[20]=(ROUND(_H_OVR16*_HI[13]))/_HI[13]
IF _KNUM==0 GOTOF _M130
IF ((_RA < 0) OR ($MC_AXCONF_CHANAX_NAME_TAB[_RA-1] == "") OR (($MCS_AXIS_USAGE_ATTRIB[_RA-1] B_AND 'B1000000') == 0)) GOTOF _M120
_VRA=AXNAME($MC_AXCONF_CHANAX_NAME_TAB[_RA-1]) _MP3=0 _HI[5]=0 _OVR[20]=0 _H_OVR20=_OVR[20] _HR[7]=0.0000009
IF ($MA_IS_ROT_AX[_VRA] == 0) GOTOF _M120
_ORIG_FRAME=$P_ACTFRAME
IF _KNUM==1000
IF ($MC_MM_NUM_BASE_FRAMES>0)
SBLOF
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1
_MP3=1 _REL_FRAME[_H_VAV,RT]=_H_OVR16 _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT] _RET_FRAME1=$P_CHBFR[_M_BFNR]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
_AFTER_FRAME=$P_CHBFR[_M_BFNR]
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_XX,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_XX,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_YY,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_YY,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_CHBFR[_M_BFNR]=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
_ALARM=0 $P_CHBFR[_M_BFNR]=_RET_FRAME1 _HSTR_PROT="$P_CHBFR" _HI[10]=_M_BFNR
SBLON
REPEAT _KIPPA _KIPPE
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - ($P_ACTFRAME[_VRA,TR] - $P_CHBFR[_M_BFNR,_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
REPEAT _KIPPA _KIPPE
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - (($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_CHBFR[_M_BFNR,_VRA,TR] + $P_CHBFR[_M_BFNR,_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
G[8]=_Z2
ELSE
_ALARM=61321
ENDIF
ENDIF
IF _ALARM OR _MP3 GOTOF _PROTOK
IF _KNUM<1000
IF (_KNUM<$MC_MM_NUM_USER_FRAMES)
_MP3=1 _ALARM=0 _Z1=_KNUM+1
IF _HI[0]
SBLOF
_REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CYCFRAME")
IF _OVI[12]<>0
_ALARM=61403
ENDIF
_AFTER_FRAME=$P_CYCFRAME
IF((ABS($P_CYCFRAME[_XX,RT])>_HR[7])AND((ABS($P_CYCFRAME[_XX,RT])< 179.9999991)OR(ABS($P_CYCFRAME[_XX,RT])>180.0000009)))
_OVR[20]=(ROUND(($P_CYCFRAME[_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF((ABS($P_CYCFRAME[_YY,RT])>_HR[7])AND((ABS($P_CYCFRAME[_YY,RT])<179.9999991)OR(ABS($P_CYCFRAME[_YY,RT])>180.0000009)))
_OVR[20]=(ROUND(($P_CYCFRAME[_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF((ABS($P_CYCFRAME[_ZZ,RT])>_HR[7])AND((ABS($P_CYCFRAME[_ZZ,RT])<179.9999991)OR(ABS($P_CYCFRAME[_ZZ,RT])>180.0000009)))
_OVR[20]=(ROUND(($P_CYCFRAME[_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_CYCFRAME=_RET_CYCFRAME
_ALARM=61403
GOTOF _M129
ENDIF
$P_CYCFRAME=_RET_CYCFRAME _ALARM=0
SBLON
ELSE
SBLOF
_RET_FRAME1=$P_UIFR[_KNUM] _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_UIFR["<<_KNUM<<"]")
_AFTER_FRAME=$P_UIFR[_KNUM]
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_UIFR[_KNUM,_XX,RT])> _HR[7]) AND ((ABS($P_UIFR[_KNUM,_XX,RT]) < 179.9999991) OR (ABS($P_UIFR[_KNUM,_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_UIFR[_KNUM,_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_UIFR[_KNUM,_YY,RT])> _HR[7]) AND ((ABS($P_UIFR[_KNUM,_YY,RT]) < 179.9999991) OR (ABS($P_UIFR[_KNUM,_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_UIFR[_KNUM,_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_UIFR[_KNUM,_ZZ,RT])> _HR[7]) AND ((ABS($P_UIFR[_KNUM,_ZZ,RT]) < 179.9999991) OR (ABS($P_UIFR[_KNUM,_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_UIFR[_KNUM,_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_UIFR[_KNUM]=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
$P_UIFR[_KNUM]=_RET_FRAME1 _ALARM=0
SBLON
ENDIF
REPEAT _KIPPA _KIPPE
_HSTR_PROT="$P_UIFR" _HI[10]=_KNUM
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=((($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]) + ($P_IFRAME[_VRA,TR] - $P_UIFR[_KNUM,_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_UIFR[_KNUM,_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_UIFR[_KNUM,_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-($P_ACTFRAME[_VRA,TR] - $P_IFRAME[_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_UIFR[_KNUM,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_UIFR[_KNUM,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-(($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_IFRAME[_VRA,TR] + $P_IFRAME[_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_UIFR[_KNUM,_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_UIFR[_KNUM,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_UIFR[_KNUM,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
IF _Z2 == _Z1
G[8]=_Z1
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
IF _ALARM OR _MP3 GOTOF _PROTOK
IF _KNUM==2000
IF ($MC_MM_SYSTEM_FRAME_MASK B_AND 'B1')
SBLOF
_MP3=1 _ALARM=0 _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT] _RET_FRAME1=$P_SETFR
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_SETFR")
_AFTER_FRAME=$P_SETFR
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_SETFR[_XX,RT])> _HR[7]) AND ((ABS($P_SETFR[_XX,RT]) < 179.9999991) OR (ABS($P_SETFR[_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_SETFR[_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_SETFR[_YY,RT])> _HR[7]) AND ((ABS($P_SETFR[_YY,RT]) < 179.9999991) OR (ABS($P_SETFR[_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_SETFR[_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_SETFR[_ZZ,RT])> _HR[7]) AND ((ABS($P_SETFR[_ZZ,RT]) < 179.9999991) OR (ABS($P_SETFR[_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_SETFR[_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_SETFR=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
_ALARM=0 $P_SETFR=_RET_FRAME1 _HSTR_PROT="$P_SETFR"
SBLON
REPEAT _KIPPA _KIPPE
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_SETFR[_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_SETFR[_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-($P_ACTFRAME[_VRA,TR] - $P_SETFR[_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_SETFR[_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_SETFR[_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-(($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_SETFR[_VRA,TR] + $P_SETFR[_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_SETFR[_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_SETFR[_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_SETFR[_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
G[8]=_Z2
ELSE
_ALARM=61321
ENDIF
ENDIF
IF _ALARM OR _MP3 GOTOF _PROTOK
IF _KNUM==9999
_ALARM=0 _MP3=1
IF ($P_GG[8]==1)
IF ($P_CHBFRMASK==0)OR($MC_MM_NUM_BASE_FRAMES==0)
_ALARM=61321
ELSE
_Z2=0 _Z3=1 _M_BFNR=$MC_MM_NUM_BASE_FRAMES
FOR _Z4=1 TO _M_BFNR
IF ($P_CHBFRMASK B_AND _Z3)
_Z2=_Z4-1
ENDIF
_Z3=_Z3*2
ENDFOR
SBLOF
_M_BFNR=_Z2 _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT] _RET_FRAME1=$P_CHBFR[_M_BFNR]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
_AFTER_FRAME=$P_CHBFR[_M_BFNR]
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_XX,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_XX,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_YY,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_YY,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_CHBFR[_M_BFNR]=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
_ALARM=0 $P_CHBFR[_M_BFNR]=_RET_FRAME1 _HSTR_PROT="$P_CHBFR" _HI[10]=_M_BFNR
SBLON
REPEAT _KIPPA _KIPPE
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-($P_ACTFRAME[_VRA,TR] - $P_CHBFR[_M_BFNR,_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-(($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_CHBFR[_M_BFNR,_VRA,TR] + $P_CHBFR[_M_BFNR,_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
G500
ENDIF
ELSE
SBLOF
_HI[9]=$P_UIFRNUM
_RET_FRAME1=$P_UIFR[_HI[9]] _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_UIFR["<<_HI[9]<<"]")
_AFTER_FRAME=$P_UIFR[_HI[9]]
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_UIFR[_HI[9],_XX,RT])> _HR[7]) AND ((ABS($P_UIFR[_HI[9],_XX,RT]) < 179.9999991) OR (ABS($P_UIFR[_HI[9],_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_UIFR[_HI[9],_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_UIFR[_HI[9],_YY,RT])> _HR[7]) AND ((ABS($P_UIFR[_HI[9],_YY,RT]) < 179.9999991) OR (ABS($P_UIFR[_HI[9],_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_UIFR[_HI[9],_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_UIFR[_HI[9],_ZZ,RT])> _HR[7]) AND ((ABS($P_UIFR[_HI[9],_ZZ,RT]) < 179.9999991) OR (ABS($P_UIFR[_HI[9],_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_UIFR[_HI[9],_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_UIFR[_HI[9]]=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
_ALARM=0 $P_UIFR[_HI[9]]=_RET_FRAME1 _HSTR_PROT="$P_UIFR" _HI[10]=_HI[9]
SBLON
REPEAT _KIPPA _KIPPE
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=((($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]) + ($P_IFRAME[_VRA,TR] - $P_UIFR[_HI[9],_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_UIFR[_HI[9],_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_UIFR[_HI[9],_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-($P_ACTFRAME[_VRA,TR] - $P_IFRAME[_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_UIFR[_HI[9],_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_UIFR[_HI[9],_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-(($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_IFRAME[_VRA,TR] + $P_IFRAME[_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_UIFR[_HI[9],_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_UIFR[_HI[9],_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_UIFR[_HI[9],_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
G[8]=_Z2
ENDIF
ENDIF
IF _ALARM OR _MP3 GOTOF _PROTOK
IF ((_KNUM>1010)AND(_KNUM<=($MC_MM_NUM_BASE_FRAMES+1010)))
SBLOF
_M_BFNR=_KNUM-1011 _ALARM=0 _MP3=1 _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT] _RET_FRAME1=$P_CHBFR[_M_BFNR]
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_CHBFR["<<_M_BFNR<<"]")
_AFTER_FRAME=$P_CHBFR[_M_BFNR]
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_XX,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_XX,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_YY,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_YY,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT])> _HR[7]) AND ((ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) < 179.9999991) OR (ABS($P_CHBFR[_M_BFNR,_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_CHBFR[_M_BFNR,_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_CHBFR[_M_BFNR]=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
_ALARM=0 $P_CHBFR[_M_BFNR]=_RET_FRAME1 _HSTR_PROT="$P_CHBFR" _HI[10]=_M_BFNR
SBLON
REPEAT _KIPPA _KIPPE
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-($P_ACTFRAME[_VRA,TR] - $P_CHBFR[_M_BFNR,_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-(($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_CHBFR[_M_BFNR,_VRA,TR] + $P_CHBFR[_M_BFNR,_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_CHBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
G[8]=_Z2
ELSE
IF ((_KNUM>1050)AND(_KNUM<=($MN_MM_NUM_GLOBAL_BASE_FRAMES+1050)))
SBLOF
_M_BFNR=_KNUM-1051 _ALARM=0 _MP3=1 _REL_FRAME[_H_VAV,RT]=_H_OVR16- $P_ACTFRAME[_H_VAV,RT] _RET_FRAME1=$P_IFRAME
_OVI[12]=ADDFRAME(_REL_FRAME,"$P_IFRAME")
_AFTER_FRAME=$P_IFRAME
IF _OVI[12]<>0
_ALARM=61403
ENDIF
IF ((ABS($P_IFRAME[_XX,RT])> _HR[7]) AND ((ABS($P_IFRAME[_XX,RT]) < 179.9999991) OR (ABS($P_IFRAME[_XX,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_IFRAME[_XX,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_IFRAME[_YY,RT])> _HR[7]) AND ((ABS($P_IFRAME[_YY,RT]) < 179.9999991) OR (ABS($P_IFRAME[_YY,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_IFRAME[_YY,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF ((ABS($P_IFRAME[_ZZ,RT])> _HR[7]) AND ((ABS($P_IFRAME[_ZZ,RT]) < 179.9999991) OR (ABS($P_IFRAME[_ZZ,RT]) > 180.0000009)))
_OVR[20]=(ROUND(($P_IFRAME[_ZZ,RT])*_HI[13]))/_HI[13] _HI[5]=_HI[5]+1
ENDIF
IF (_HI[5] > 1)
$P_IFRAME=_RET_FRAME1
_ALARM=61403
GOTOF _M129
ENDIF
_ALARM=0 $P_IFRAME=_RET_FRAME1 _HSTR_PROT="$P_NCBFR" _HI[10]=_M_BFNR
SBLON
REPEAT _KIPPA _KIPPE
IF _INTERN[40+21]==0
IF $MN_MM_FRAME_FINE_TRANS
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA]) - $P_ACTFRAME[_VRA,TR]
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="FI"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_NCBFR[_M_BFNR,_VRA,FI]=_M_SPE[47] - 360
ELSE
$P_NCBFR[_M_BFNR,_VRA,FI]=_M_SPE[47]
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-($P_ACTFRAME[_VRA,TR] - $P_NCBFR[_M_BFNR,_VRA,TR])
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_NCBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_NCBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
ELSE
_M_SPE[47]=(($AA_IM[_VRA]+_OVR[20]) - $AA_IW[_VRA])-(($P_ACTFRAME[_VRA,TR] + $P_ACTFRAME[_VRA,FI])-($P_NCBFR[_M_BFNR,_VRA,TR] + $P_NCBFR[_M_BFNR,_VRA,FI]))
_M_SPE[47]=((_M_SPE[47] MOD 360) + 360) MOD 360 _HSTR_PROT1="TR"
IF $MN_MM_FRAME_FINE_TRANS
$P_NCBFR[_M_BFNR,_VRA,FI]=0
ENDIF
IF(_M_SPE[47]>=180)AND(_M_SPE[47]<360)
$P_NCBFR[_M_BFNR,_VRA,TR]=_M_SPE[47] - 360
ELSE
$P_NCBFR[_M_BFNR,_VRA,TR]=_M_SPE[47]
ENDIF
ENDIF
G[8]=_Z2
ELSE
_ALARM=61321
ENDIF
ENDIF
_PROTOK: _PROTVAL[25] =SET("","","","","")
IF _ALARM GOTOF _M129
IF _KNUM==2000
_PROTVAL[25] =""<<_HSTR_PROT<<"["<<AXSTRING(_VRA)<<","<<_HSTR_PROT1<<"]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<",,1,"<<AXSTRING(_VRA)<<",,F"<<_M_SPE[0]
ELSE
_PROTVAL[25] =""<<_HSTR_PROT<<"["<<_HI[10]<<","<<AXSTRING(_VRA)<<","<<_HSTR_PROT1<<"]" _PROTVAL[29] ="P,"<<($P_GG[6]+16)<<","<<_HI[10]<<",1,"<<AXSTRING(_VRA)<<",,F"<<_M_SPE[0]
ENDIF
GOTOF _M129
STOPRE
_M120: _ALARM=61329 _OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699800 SETAL(_ALARM)
STOPRE
_M121:_OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699801 SETAL(_ALARM)
STOPRE
_M122: _ALARM=61019 _OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699802 SETAL(_ALARM)
STOPRE
_M123: _ALARM=61022 _OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699803 SETAL(_ALARM)
STOPRE
_M124:_OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699804 SETAL(_ALARM)
STOPRE
_M125:_OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699805 SETAL(_ALARM)
STOPRE
_M126:_OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699806 SETAL(_ALARM)
STOPRE
_M128:_OVI[9]=_ALARM $AC_MEAS_SEMA=0
N699807 SETAL(_ALARM)
STOPRE
_M129:_OVI[9]=_ALARM $AC_MEAS_SEMA=0
IF ((_ALARM>=61303)AND(_ALARM<=61306)OR(_ALARM==0)) GOTOF _M130
N699808 SETAL(_ALARM)
_M120A:M0
STOPRE
N699809 SETAL(61327)
GOTOB _M120A
_M130:
IF _ALARM
_OVI[9]=_OVI[9]+1000
ENDIF
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==0) GOTOF _M133
IF ((_M_N[28]==0)OR(_M_N[28]==2)OR((_M_N[28]==4)AND((_ALARM<61303)OR(_ALARM>61306))))AND(_INTERN[20+9]==1) GOTOF _M131
IF (((_M_N[28]==1)OR(_M_N[28]==3)OR(_M_N[28]==4))AND(_ALARM>=61303)AND(_ALARM<=61306))
STOPRE
N699810 SETAL(_ALARM+1000)
ENDIF
N1150 CYCLE102(1,_M_N[28])
STOPRE
IF ((_M_N[28]==1)OR(_M_N[28]==4))AND((_ALARM>=61303)AND(_ALARM<=61306))OR(_M_N[28]==3) GOTOF _M132 IF _M_N[28]==2 GOTOF _M131
G4 F8
N1160 _M132: CYCLE102(0)
N1200 _M131:
IF _INTERN[20+9]==1
CYCLE151
ENDIF
_M133:
IF _ALARM
STOPRE
IF (_ALARM>61303)
N699811 SETAL(_ALARM+1000)
IF _INTERN[20+2]
N1240 M0
STOPRE
ENDIF
ELSE
_OVI[9]=_ALARM
IF(_INTERN[12])
CUST_MEACYC(5)
ENDIF
IF NOT(_INTERN[12] AND _INTERN[13])
N699812 SETAL(_ALARM)
ENDIF
ENDIF
ENDIF
IF _NEW_PAR
_CHBIT[21]=_CHBIT_S21
ENDIF
IF (_SMI_R[10]==0)OR(_SMI_R[10]==11)
CUST_MEACYC(2)
ENDIF
M17
N699812 _ENDE: SETAL(62301)
M0
_GENDE: M17
_KIPPA:
IF ((ABS(_ORIG_FRAME[X,RT] - _AFTER_FRAME[X,RT]) == 180) AND (ABS(_ORIG_FRAME[Z,RT] - _AFTER_FRAME[Z,RT]) == 180))
_BGEKIPPT[1]=1
ENDIF
IF (ABS(_H_OVR16 - _AFTER_FRAME[X,RT]) == 360)
_BGEKIPPT[0]=1
ENDIF
IF (ABS(_H_OVR16 - _AFTER_FRAME[Z,RT]) == 360)
_BGEKIPPT[2]=1
ENDIF
IF (_BGEKIPPT[0] OR _BGEKIPPT[1] OR _BGEKIPPT[2])
_OVR[20] = _H_OVR16
ENDIF
;MSG(<<_BGEKIPPT[0]<<" "<<_BGEKIPPT[1]<<" "<<_BGEKIPPT[2]<<" "<<_H_OVR16)
;M0
;STOPRE
_KIPPE:

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MS_CAL_SPF
PROC E_MS_CAL(INT _ST,REAL _VAL,INT _PRNR,INT _WOPL,INT _MEASFR,REAL _H_VMS,REAL _VAL1,REAL _H_STA1,INT _NAXIS) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.007 ;DATE: 2024-04-24
;Cycle : calibrating workpiece measuring probe
DEF REAL _WI, _J_CAL[12]
DEF INT _TEMP,_NPV,_ADT1,_H_INT[3]=(1,1,1)
DEF INT _A, _O, _AP
DEF AXIS _XX,_YY,_ZZ
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
IF (_PRNR < 1)OR(_PRNR > $MNS_MEA_CAL_WP_NUM)
N630102 SETAL(61313)
ENDIF
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
_MIJ_I[1]=_PRNR + 100 _SMI_R[8]=$P_ADT[10]
ELSE
_MIJ_I[1]=_PRNR _SMI_R[8]=0
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($P_GG[6] == 1)
_A=1 _O=2 _AP=3
ELSE
IF ($P_GG[6] == 2)
_A=3 _O=1 _AP=2
ELSE
_A=2 _O=3 _AP=1
ENDIF
ENDIF
IF(ISAXIS(_A))
_XX=$P_AXN1
ENDIF
IF(ISAXIS(_O))
_YY=$P_AXN2
ENDIF
IF(ISAXIS(_AP))
_ZZ=$P_AXN3
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630101 SETAL(61311)
ENDIF
OFFN=0
_SMI_R[10]=93101.901
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
G1 G90 F10
IF(ISAXIS(_A))
N34 AX[_XX]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
N35 AX[_YY]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
N36 AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
_SETVAL=_VAL _KNUM=0 _OVI[2]=976 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _H_VMS == 0
_H_VMS=$SCS_MEA_FEED_MEASURE
ENDIF
_SMI_R[0]=SET(_H_VMS,$MNS_J_MEA_M_DIST_MANUELL,$MNS_J_MEA_M_DIST_MANUELL) _STA1=0
IF _ST < 10
IF _ST
_MVAR=10108 _SMI_R[2]=_SETVAL
IF ($SCS_MEA_FUNCTION_MASK B_AND 'B1000000000000000')
_MVAR=10101
ENDIF
ELSE
_MVAR=10000 _MA=3 _MD=1
ENDIF
ELSE
IF _ST == 10
_MVAR=1000 _MA=3 _MD=1
ENDIF
IF _ST == 11
_MVAR=0 _MA=_NAXIS _MD=_VAL1
ENDIF
IF _ST == 12
_MVAR=2105 _MA = _NAXIS _MD=0 _SETVAL=_VAL1 _SETV[0]=_VAL
IF (_ST _DEC3 == 1)
_MVAR=12105
ENDIF
ENDIF
IF _ST _DEC2 == 2
CASE (_ST _DEC1) OF 0 GOTOF _RAKUG0 1 GOTOF _RAKUG1 2 GOTOF _RAKUG2 DEFAULT GOTOF _KUG_END
_RAKUG0:_MVAR=0010103
GOTOF _KUG_END
_RAKUG1:_MVAR=2010103 _SETV[0]=_VAL1
GOTOF _KUG_END
_RAKUG2:_MVAR=1010103 _SETV[0]=_VAL1
_KUG_END:
IF _ST _DEC3
_MVAR=_MVAR + 100000
ENDIF
_STA1=_H_STA1 _SMI_R[2]=_SETVAL _NMSP=1 _RF=$SCS_MEA_FEED_CIRCLE _SMI_R[3]=0
ENDIF
ENDIF
CYCLE976
CUST_MEACYC(2)
STOPRE
_OVI[14]=0
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MS_CAN_SPF
PROC E_MS_CAN(INT _ST,INT _AX,INT _DIR,INT _NPV,REAL _VAL,REAL _AX1,REAL _AX2,REAL _AX3,STRING[32] _T,STRING[32] _TF,INT _BNPV,REAL _BVAL1,REAL _BVAL2,REAL _BVAL3,INT _BLAGE,INT _PRNR,INT _WOPL,INT _MEASFR) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : V06.24.00.00.007 ;DATE: 2024-04-24
;Cycle : measure a corner
DEF REAL _WKS[3],_WI,_FA_SW=1,_VAL_I,_FAK2,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ,_MAV
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF INT _A, _O, _AP
DEF FRAME _REL_FRAME
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
IF ((_PRNR < 1)OR(_PRNR > $MNS_MEA_CAL_WP_NUM))AND(_ST<>10)
N630202 SETAL(61313)
ENDIF
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
_MIJ_I[1]=_PRNR + 100 _SMI_R[8]=$P_ADT[10]
ELSE
_MIJ_I[1]=_PRNR _SMI_R[8]=0
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($P_GG[6] == 1)
_A=1 _O=2 _AP=3
ELSE
IF ($P_GG[6] == 2)
_A=3 _O=1 _AP=2
ELSE
_A=2 _O=3 _AP=1
ENDIF
ENDIF
IF(ISAXIS(_A))
_XX=$P_AXN1
ENDIF
IF(ISAXIS(_O))
_YY=$P_AXN2
ENDIF
IF(ISAXIS(_AP))
_ZZ=$P_AXN3
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630201 SETAL(61311)
ENDIF
E_MESS_AM=0
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2))OR(($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF _ST <10
_MVAR=100
ELSE
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
N630104 SETAL(61307)
RET
ENDIF
IF _ST == 10
_MVAR=10100
ELSE
_MVAR=20100
ENDIF
ENDIF
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
G1 G90 F10
IF(ISAXIS(_A))
N34 AX[_XX]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
N35 AX[_YY]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
N36 AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
_VAL_I=_VAL*_FA_SW _MA=_AX _OVI[2]=978 _KNUM=0 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _ST==10
_SMI_R[0]=SET($SCS_MEA_FEED_MEASURE,$MNS_J_MEA_M_DIST_MANUELL,ABS($MNS_J_MEA_M_DIST_MANUELL))
ELSE
_SMI_R[0]=SET($SNS_MEA_WP_FEED[_PRNR-1],$MNS_J_MEA_M_DIST_MANUELL,ABS($MNS_J_MEA_M_DIST_MANUELL))
ENDIF
IF _MA==1
_MAV=_XX
ELSE
IF _MA==2
_MAV=_YY
ELSE
_MAV=_ZZ
ENDIF
ENDIF
IF (_ST MOD 10)==1
_SMI_R[1]=SET($MNS_J_MEA_M_DIST,ABS($MNS_J_MEA_M_DIST))
E_TFS(_T,_TF,1)
_FAK2=1
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF(E_RP>$P_EP[_ZZ])
N36 G0 G90 AX[_ZZ]=E_RP*_FAK2
ENDIF
N38 G0 G90 AX[_XX]=_AX1 AX[_YY]=_AX2
N40 AX[_ZZ]=_AX3
ENDIF
_STA1=0
IF (_DIR) OR(_AX==3)
_SMI_R[1]=-ABS(_SMI_R[1])
ENDIF
CYCLE978
DIAMCYCOF
CUST_MEACYC(2)
E_MESS[0]=SET($AA_IW[_XX]/_H_INT[0],$AA_IW[_YY]/_H_INT[1],$AA_IW[_ZZ]/_H_INT[2])
E_MESS[_AX-1]=_OVR[4+_MA] _OVI[14]=0
STOPRE
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
IF NOT($MNS_MEA_FUNCTION_MASK B_AND 'B10000000')
_REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR]+$P_UIFR[_KNUM,_XX,FI]
_REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR]+$P_UIFR[_KNUM,_YY,FI]
_REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI]
_REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,FI]=0
ENDIF
ELSE
IF NOT($MNS_MEA_FUNCTION_MASK B_AND 'B10000000')
_REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
ENDIF
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630207 SETAL(61321)
ENDIF
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630208 SETAL(_ALARM)
ENDIF
_OVI[0]=_KNUM _OVR[_MA]=_VAL*_FA_SW _OVR[0]=_OVR[_MA] _OVR[16]=SET(0,0,0,0)
CYCLE115(_ALARM,_MAV,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630209 SETAL(_ALARM+1000)
ENDIF
G[8]=_A_NPV
ELSE
E_MEAS=E_MESS[_AX-1]
ENDIF
IF (_ST MOD 10)==1
N75 G0 AX[_ZZ]=E_RP
ENDIF
STOPRE
_RETS: RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MS_HOL_SPF
PROC E_MS_HOL(INT _ST,INT _NPV,REAL _DIAM,REAL _VAL1,REAL _VAL2,REAL _AX1,REAL _AX2,REAL _AX3,STRING[32] _T,STRING[32] _TF,REAL _ANG1,INT _PRNR,INT _WOPL,INT _MEASFR) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.009 ;DATE: 2023-06-09
;Cycle : measure a hole
DEF REAL _WI,_FA_SW=1,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF FRAME _REL_FRAME
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
IF ((_PRNR < 1)OR(_PRNR > $MNS_MEA_CAL_WP_NUM))AND(_ST<>10)
N630302 SETAL(61313)
ENDIF
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
_MIJ_I[1]=_PRNR + 100 _SMI_R[8]=$P_ADT[10]
ELSE
_MIJ_I[1]=_PRNR _SMI_R[8]=0
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630303 SETAL(61311)
RET
ENDIF
$P_CYCFRAME=CTRANS()
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2)) OR (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF _ST <10
_MVAR=101
ELSE
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
N630104 SETAL(61307)
RET
ENDIF
IF _ST == 10
_MVAR=10101
ELSE
_MVAR=20101
ENDIF
ENDIF
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_KNUM=0 _SETVAL=_DIAM _OVI[2]=977 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _ST==10
_SMI_R[0]=SET($SCS_MEA_FEED_MEASURE,$MNS_J_MEA_M_DIST_MANUELL,2*$MNS_J_MEA_M_DIST_MANUELL+_DIAM)
ELSE
_SMI_R[0]=SET($SNS_MEA_WP_FEED[_PRNR-1],$MNS_J_MEA_M_DIST_MANUELL,2*$MNS_J_MEA_M_DIST_MANUELL+_DIAM)
ENDIF
IF (_ST MOD 10)==1
_SMI_R[1]=$MNS_J_MEA_M_DIST
E_TFS(_T,_TF,1)
N36 G0 G90 AX[_XX]=_AX1 AX[_YY]=_AX2
N38 AX[_ZZ]=_AX3
ENDIF
_STA1=_ANG1
CYCLE977
CUST_MEACYC(2)
$P_CYCFRAME=CTRANS()
_OVR[5]=$AA_IW[_XX]/_H_INT[0] _OVR[6]=$AA_IW[_YY]/_H_INT[1]
E_MESS[0]=SET(_OVR[5],_OVR[6],$AA_IW[_ZZ]) _OVI[14]=0
N50 G90 AX[_XX]=E_MESS[0]/_FA_SW AX[_YY]=E_MESS[1]/_FA_SW
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME _REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
IF $MN_MM_FRAME_FINE_TRANS
_REL_FRAME[_XX,TR]=_REL_FRAME[_XX,TR]+$P_UIFR[_KNUM,_XX,FI] _REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,TR]=_REL_FRAME[_YY,TR]+$P_UIFR[_KNUM,_YY,FI] _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,TR]=_REL_FRAME[_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI] _REL_FRAME[_ZZ,FI]=0
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630308 SETAL(61321)
ENDIF
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630309 SETAL(_ALARM)
ENDIF
_OVR[0]=_SETVAL _OVR[1]=_VAL1*_FA_SW _OVR[2]=_VAL2*_FA_SW _OVR[17]=SET(0,0,0) _OVI[0]=_KNUM
CYCLE115(_ALARM,_XX,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630310 SETAL(_ALARM+1000)
ENDIF
G[8]=_A_NPV
ENDIF
IF (_ST MOD 10)==1
N85 G0 AX[_ZZ]=E_RP
ENDIF
STOPRE
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MS_PIN_SPF
PROC E_MS_PIN(INT _ST,INT _NPV,REAL _DIAM,REAL _MID,REAL _VAL1,REAL _VAL2,REAL _AX1,REAL _AX2,REAL _AX3,STRING[32] _T,STRING[32] _TF,REAL _ANG1,INT _PRNR,INT _WOPL,INT _MEASFR) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.009 ;DATE: 2023-06-09
DEF REAL _WI,_FA_SW=1,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF FRAME _REL_FRAME
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
IF ((_PRNR < 1) OR (_PRNR > $MNS_MEA_CAL_WP_NUM))AND(_ST<>10)
N630402 SETAL(61313)
ENDIF
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
_MIJ_I[1]=_PRNR + 100 _SMI_R[8]=$P_ADT[10]
ELSE
_MIJ_I[1]=_PRNR _SMI_R[8]=0
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630403 SETAL(61311)
ENDIF
$P_CYCFRAME=CTRANS()
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2)) OR (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF _ST <10
_MVAR=102
ELSE
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
N630105 SETAL(61307)
RET
ENDIF
IF _ST == 10
_MVAR=10102
ELSE
_MVAR=20102
ENDIF
ENDIF
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_KNUM=0 _ID=-_MID _SETVAL=_DIAM _OVI[2]=977 _OVI[14]=1 _TEMP=2
_TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _ST==10
_SMI_R[0]=SET($SCS_MEA_FEED_MEASURE,$MNS_J_MEA_M_DIST_MANUELL,_DIAM)
ELSE
_SMI_R[0]=SET($SNS_MEA_WP_FEED[_PRNR-1],$MNS_J_MEA_M_DIST_MANUELL,_DIAM)
ENDIF
IF $MNS_J_MEA_M_DIST_MANUELL > _DIAM/2
_SMI_R[1]=_DIAM/2
ENDIF
IF (_ST MOD 10)==1
_SMI_R[1]=$MNS_J_MEA_M_DIST
E_TFS(_T,_TF,1)
N36 G0 G90 AX[_XX]=_AX1 AX[_YY]=_AX2
N38 AX[_ZZ]=_AX3
ENDIF
_STA1=_ANG1
CYCLE977
CUST_MEACYC(2)
$P_CYCFRAME=CTRANS()
_OVR[5]=$AA_IW[_XX]/_H_INT[0] _OVR[6]=$AA_IW[_YY]/_H_INT[1]
E_MESS[0]=SET(_OVR[5],_OVR[6],$AA_IW[_ZZ]) _OVI[14]=0
N50 G90 AX[_XX]=E_MESS[0]/_FA_SW AX[_YY]=E_MESS[1]/_FA_SW
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME _REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
IF $MN_MM_FRAME_FINE_TRANS
_REL_FRAME[_XX,TR]=_REL_FRAME[_XX,TR]+$P_UIFR[_KNUM,_XX,FI] _REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,TR]=_REL_FRAME[_YY,TR]+$P_UIFR[_KNUM,_YY,FI] _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,TR]=_REL_FRAME[_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI] _REL_FRAME[_ZZ,FI]=0
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630407 SETAL(61321)
ENDIF
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630408 SETAL(_ALARM)
ENDIF
_OVR[0]=_SETVAL _OVR[1]=_VAL1*_FA_SW _OVR[2]=_VAL2*_FA_SW _OVR[17]=SET(0,0,0) _OVI[0]=_KNUM
CYCLE115(_ALARM,_XX,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630409 SETAL(_ALARM+1000)
ENDIF
IF _A_NPV-1==_NPV
_NPV=_NPV+1
G[8]=_NPV
ENDIF
ENDIF
IF (_ST MOD 10)==1
N85 G0 AX[_ZZ]=E_RP
ENDIF
STOPRE
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MS_POC_SPF
PROC E_MS_POC(INT _ST,INT _NPV,REAL _LEN,REAL _WID,REAL _VAL1,REAL _VAL2,REAL _AX1,REAL _AX2,REAL _AX3,STRING[32] _T,STRING[32] _TF,INT _PRNR,INT _WOPL,INT _MEASFR) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.009 ;DATE: 2023-06-09
;Cycle : measure rectangle pocket
DEF REAL _WI,_FA_SW=1,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF FRAME _REL_FRAME
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
IF ((_PRNR < 1) OR (_PRNR > $MNS_MEA_CAL_WP_NUM))AND(_ST<>10)
N630502 SETAL(61313)
ENDIF
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
_MIJ_I[1]=_PRNR + 100 _SMI_R[8]=$P_ADT[10]
ELSE
_MIJ_I[1]=_PRNR _SMI_R[8]=0
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630503 SETAL(61311)
ENDIF
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2)) OR (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF _ST <10
_MVAR=105
ELSE
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
N630104 SETAL(61307)
RET
ENDIF
IF _ST == 10
_MVAR=10105
ELSE
_MVAR=20105
ENDIF
ENDIF
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_KNUM=0 _SETV[0]=_LEN _SETV[1]=_WID _OVI[2]=977 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _ST==10
_SMI_R[0]=SET($SCS_MEA_FEED_MEASURE,$MNS_J_MEA_M_DIST_MANUELL,2*$MNS_J_MEA_M_DIST_MANUELL+_LEN)
ELSE
_SMI_R[0]=SET($SNS_MEA_WP_FEED[_PRNR-1],$MNS_J_MEA_M_DIST_MANUELL,2*$MNS_J_MEA_M_DIST_MANUELL+_LEN)
ENDIF
IF (_ST MOD 10)==1
_SMI_R[1]=$MNS_J_MEA_M_DIST
E_TFS(_T,_TF,1)
N36 G0 G90 AX[_XX]=_AX1 AX[_YY]=_AX2
N38 AX[_ZZ]=_AX3
ENDIF
_STA1=0
CYCLE977
CUST_MEACYC(2)
$P_CYCFRAME=CTRANS()
_OVR[6]=$AA_IW[_XX]/_H_INT[0] _OVR[7]=$AA_IW[_YY]/_H_INT[1]
E_MESS[0]=SET(_OVR[6],_OVR[7],$AA_IW[_ZZ]/_H_INT[2]) _OVI[14]=0
N50 G90 AX[_XX]=E_MESS[0]/_FA_SW AX[_YY]=E_MESS[1]/_FA_SW
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME _REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
IF $MN_MM_FRAME_FINE_TRANS
_REL_FRAME[_XX,TR]=_REL_FRAME[_XX,TR]+$P_UIFR[_KNUM,_XX,FI] _REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,TR]=_REL_FRAME[_YY,TR]+$P_UIFR[_KNUM,_YY,FI] _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,TR]=_REL_FRAME[_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI] _REL_FRAME[_ZZ,FI]=0
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630507 SETAL(61321)
ENDIF
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630508 SETAL(_ALARM)
ENDIF
_OVR[0]=_SETV[0] _OVR[1]=_SETV[1] _OVR[2]=_VAL1*_FA_SW _OVR[3]=_VAL2*_FA_SW _OVR[17]=SET(0,0,0) _OVI[0]=_KNUM
CYCLE115(_ALARM,_XX,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630509 SETAL(_ALARM+1000)
ENDIF
G[8]=_A_NPV
ENDIF
IF (_ST MOD 10)==1
N85 G0 AX[_ZZ]=E_RP
ENDIF
STOPRE
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MS_SPI_SPF
PROC E_MS_SPI(INT _ST,INT _NPV,REAL _LEN,REAL _WID,REAL _MID,REAL _VAL1,REAL _VAL2,REAL _AX1,REAL _AX2,REAL _AX3,STRING[32] _T,STRING[32] _TF,INT _PRNR,INT _WOPL,INT _MEASFR) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.22.00.00.009 ;DATE: 2023-06-09
;Cycle : measure rectangle spigot
DEF REAL _WI,_FA_SW=1,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF FRAME _REL_FRAME
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
IF ((_PRNR < 1)OR(_PRNR > $MNS_MEA_CAL_WP_NUM))AND(_ST<>10)
N630602 SETAL(61313)
ENDIF
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
_MIJ_I[1]=_PRNR + 100 _SMI_R[8]=$P_ADT[10]
ELSE
_MIJ_I[1]=_PRNR _SMI_R[8]=0
ENDIF
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
_XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630403 SETAL(61311)
ENDIF
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2)) OR (($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF _ST <10
_MVAR=106
ELSE
IF (_ADT1==712)OR(_ADT1==713)OR(_ADT1==714)
N630104 SETAL(61307)
RET
ENDIF
IF _ST == 10
_MVAR=10106
ELSE
_MVAR=20106
ENDIF
ENDIF
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_KNUM=0 _ID=-_MID _SETV[0]=_LEN _SETV[1]=_WID _OVI[2]=977 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _ST==10
_SMI_R[0]=SET($SCS_MEA_FEED_MEASURE,$MNS_J_MEA_M_DIST_MANUELL,_LEN)
ELSE
_SMI_R[0]=SET($SNS_MEA_WP_FEED[_PRNR-1],$MNS_J_MEA_M_DIST_MANUELL,_LEN)
ENDIF
IF $MNS_J_MEA_M_DIST_MANUELL > _LEN/2
_SMI_R[1]=_LEN/2
ENDIF
IF (_ST MOD 10)==1
_SMI_R[1]=$MNS_J_MEA_M_DIST
E_TFS(_T,_TF,1)
N36 G0 G90 AX[_XX]=_AX1 AX[_YY]=_AX2
N38 AX[_ZZ]=_AX3
ENDIF
_STA1=0
CYCLE977
CUST_MEACYC(2)
$P_CYCFRAME=CTRANS()
_OVR[6]=$AA_IW[_XX]/_H_INT[0] _OVR[7]=$AA_IW[_YY]/_H_INT[1]
E_MESS[0]=SET(_OVR[6],_OVR[7],$AA_IW[_ZZ]/_H_INT[2]) _OVI[14]=0
N50 G90 AX[_XX]=E_MESS[0]/_FA_SW AX[_YY]=E_MESS[1]/_FA_SW
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME _REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
IF $MN_MM_FRAME_FINE_TRANS
_REL_FRAME[_XX,TR]=_REL_FRAME[_XX,TR]+$P_UIFR[_KNUM,_XX,FI] _REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,TR]=_REL_FRAME[_YY,TR]+$P_UIFR[_KNUM,_YY,FI] _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,TR]=_REL_FRAME[_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI] _REL_FRAME[_ZZ,FI]=0
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630608 SETAL(61321)
ENDIF
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630609 SETAL(_ALARM)
ENDIF
_OVR[0]=_SETV[0] _OVR[1]=_SETV[1] _OVR[2]=_VAL1*_FA_SW _OVR[3]=_VAL2*_FA_SW _OVR[17]=SET(0,0,0) _OVI[0]=_KNUM
CYCLE115(_ALARM,_XX,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630610 SETAL(_ALARM+1000)
ENDIF
G[8]=_A_NPV
ENDIF
IF (_ST MOD 10)==1
N85 G0 AX[_ZZ]=E_RP
ENDIF
STOPRE
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MT_CAL_SPF
PROC E_MT_CAL(INT _ST,INT _NR,INT _WOPL,INT _MEASFR,REAL _H_VMS) SAVE SBLOF ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.20.00.00.006 ;DATE: 2022-02-01
;Cycle : calibration toolsetter
DEF BOOL _SPU=0,_FRAES_DREH=0
DEF INT _MT_E,_H,_ALARM,_P_XX,_P_YY,_P_ZZ,_I_SP[3],_HI,_MD13230
DEF REAL _POS_Z,_POS_X,_POS_Y,_M_POS,_W,_FAK,_MW_I,_J_CAL[12],_SD55619
DEF INT _TEMP,_STAT,_NPV,_MC_SIM,_H_INT[3]=(1,1,1)
DEF STRING[100] _SERR=""
DEF AXIS _XX,_YY,_ZZ
E_MESS[0]=REP(0)
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
_SPU=(_ST B_AND 'B100')
IF ( ($P_TOOL==0)AND((_ST B_AND 'B1')==0) )
_MIJ_I[7]=1
ELSE
_MIJ_I[7]=0
ENDIF
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
IF ( ($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1) )
_FRAES_DREH=1
IF (_F_S_NR[1]==0)
_ALARM=61290 _OVI[9]=_ALARM
N630701 SETAL(_ALARM)
RET
ENDIF
_TEMP=$AC_MSNUM
IF _TEMP<=0
_ALARM=61287 _OVI[9]=_ALARM
N630715 SETAL(_ALARM)
ENDIF
IF (_F_S_NR[1]<>_TEMP)
SETMS(_F_S_NR[1])
ENDIF
ENDIF
IF ( (_NR<1) OR (_NR>$MNS_MEA_CAL_TP_NUM) )
_ALARM=61313 _OVI[9]=_ALARM
N630702 SETAL(_ALARM)
ENDIF
_MIJ_I[2]=_NR _MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4] + 1
_NR=_NR-1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]= _NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ((ABS($SC_TOOL_LENGTH_CONST)<>($P_GG[6]+16))AND($SC_TOOL_LENGTH_CONST<>0))
_ALARM=61024 _OVI[9]=_ALARM _SERR="SD42940"
N630701 SETAL(_ALARM,_SERR)
RET
ENDIF
IF ($AN_NCK_VERSION<660000)
N630703 SETAL(61342)
RET
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF ( (($P_TOOL<>0)AND($P_TOOLL[1]<>0))OR(_MIJ_I[7]) ) GOTOF _MM0A
IF $P_TOOL==0
N630704 SETAL(61311)
RET
ELSE
N630705 SETAL(61351)
RET
ENDIF
_MM0A:
_MC_SIM=0
IF ISVAR("$MN_SIM_ENVIRONMENT")
_MC_SIM=(($MN_SIM_ENVIRONMENT B_AND 'B100')*100)+(($MN_SIM_ENVIRONMENT B_AND 'B1'))
ELSE
IF $P_SIM
_MC_SIM=2
ENDIF
ENDIF
IF NOT(_MC_SIM)
IF (($MA_CTRLOUT_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[1,AX1]==0)AND($MA_CTRLOUT_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[1,AX2]==0)AND($MA_CTRLOUT_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[1,AX3]==0))
_MC_SIM=1
ENDIF
ENDIF
OFFN=0
_SMI_R[10]=93101.901 _XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_TEMP=$SNS_MEA_TP_TYPE[_NR]
IF (_TEMP MOD 10 == 1) AND (TRUNC(_TEMP/100)<>$P_GG[6])
N630706 SETAL(61415)
ENDIF
_NPV=$P_GG[8]
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000')
N630707 SETAL(61016)
RET
ENDIF
$P_CYCFRAME=CTRANS()
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
_TEMP=2
CYCLE216(_J_CAL,_TEMP)
_OVI[2]=971 _OVI[14]=1 _KNUM=0 _MVAR=10000 _MA=3
CUST_MEACYC(1)
_TP[_NR,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_NR],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_NR])
_TP[_NR,4]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_NR])
_TP[_NR,6]=SET($SNS_MEA_TP_EDGE_DISK_SIZE[_NR],$SNS_MEA_TP_AX_DIR_AUTO_CAL[_NR],$SNS_MEA_TP_TYPE[_NR],$SNS_MEA_TP_CAL_MEASURE_DEPTH[_NR])
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N6307008 SETAL(61230)
RET
ENDIF
_P_XX=0 _P_YY=2 _P_ZZ=4
_I_SP[2]=_TP[_NR,7]/100 _I_SP[1]=_TP[_NR,7]/10-TRUNC(_TP[_NR,7]/100)*10 _I_SP[0]=_TP[_NR,7]-TRUNC(_TP[_NR,7]/10)*10
_MM0:
IF _H_VMS == 0
_H_VMS=$SCS_MEA_TP_FEED_MEASURE
ENDIF
_SMI_R[0]=SET(_H_VMS,-$MNS_J_MEA_T_PROBE_MEASURE_DIST,2*$MNS_J_MEA_T_PROBE_MEASURE_DIST)
CYCLE971
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
IF ($MCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000')
_MT_E=2
ELSE
_MT_E=1
ENDIF
IF (_ST B_AND 'B1')
IF (_SPU)
_MVAR=1010000
ENDIF
IF $P_TOOLR==0
N630709 SETAL(61351)
RET
ENDIF
_MW_I=$MNS_J_MEA_T_PROBE_MEASURE_DIST
IF ABS($MNS_J_MEA_T_PROBE_MEASURE_DIST) > ABS($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2)
_MW_I=$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2 _SMI_R[1]=-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
_POS_Z=$AA_IW[_ZZ]/_H_INT[2] _POS_X=$AA_IW[_XX]/_H_INT[0] _POS_Y=$AA_IW[_YY]/_H_INT[1] _W=$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2+$P_TOOLR+_MW_I
IF $MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0
N630710 SETAL(61230)
RET
ENDIF
N95 G1 G90 G94 F=$MNS_J_MEA_COLL_MONIT_FEED
_TP[_NR,_P_YY]=_POS_Y+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2 _TP[_NR,_P_YY+1]=_POS_Y-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2 _TP[_NR,_P_XX]=_POS_X+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2 _TP[_NR,_P_XX+1]=_POS_X-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
IF _I_SP[0]==0 GOTOF _MMXX0 IF _I_SP[1] GOTOF _MMXXA
GOTOF _KKXX
_MMXXA: _M_POS=_POS_X+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2+$P_TOOLR
IF _I_SP[0]==2 GOTOF _MXXA0
IF _MC_SIM
N100 AX[_XX]=_POS_X+_W
N110 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
F=_H_VMS
N120 G91 AX[_XX]=-_MW_I
STOPRE
_M_POS=$AA_IW[_XX]/_H_INT[0]
ELSE
N100 MEAS=_MT_E AX[_XX]=_POS_X+_W
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
N110 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
F=_H_VMS
_MD13230=$MN_MEAS_PROBE_SOURCE
IF $SCS_MEA_SIM_ENABLE==9
_MD13230 = 0
ENDIF
_SD55619=$SCS_MEA_SIM_MEASURE_DIFF
IF _MD13230>0
IF $MN_MEAS_PROBE_LOW_ACTIVE[_MT_E-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _FEHL2
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _FEHL2
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
N120 G91 MEAS=_MT_E AX[_XX]=-2*_MW_I
STOPRE
IF _MD13230>0
DO $A_OUT[_MD13230]=0
G4 F0.1
ENDIF
IF $AC_MEA[_MT_E]==0 GOTOF _FEHL1
_M_POS=$AA_MW[_XX]
ENDIF
N130 G90 G0 AX[_XX]=_POS_X+_W
N140 AX[_ZZ]=_POS_Z
_POS_X=_M_POS-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2-$P_TOOLR
N145 AX[_XX]=_POS_X
IF _I_SP[0]==3 GOTOF _MXXA0
_TP[_NR,_P_XX+1]=_POS_X-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2 _M_POS=_POS_X
GOTOF _MXXA1
_MXXA0:
IF _MC_SIM
N150 G1 F=$MNS_J_MEA_COLL_MONIT_FEED AX[_XX]=_POS_X-_W
N160 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
F=_H_VMS
N170 G91 AX[_XX]=_MW_I
STOPRE
ELSE
N150 G1 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_FEED AX[_XX]=_POS_X-_W
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
N160 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
F=_H_VMS
_MD13230=$MN_MEAS_PROBE_SOURCE
IF $SCS_MEA_SIM_ENABLE==9
_MD13230 = 0
ENDIF
_SD55619=$SCS_MEA_SIM_MEASURE_DIFF
IF _MD13230>0
IF $MN_MEAS_PROBE_LOW_ACTIVE[_MT_E-1]
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _FEHL2
DO $A_OUT[_MD13230]=1
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=0
ELSE
IF ($MN_FASTIO_DIG_NUM_OUTPUTS==0) GOTOF _FEHL2
DO $A_OUT[_MD13230]=0
G4 F0.1
WHEN ABS($AC_DTEW) <= _SD55619 DO $A_OUT[_MD13230]=1
ENDIF
ENDIF
N170 G91 MEAS=_MT_E AX[_XX]=2*_MW_I
STOPRE
IF _MD13230>0
DO $A_OUT[_MD13230]=0
G4 F0.1
ENDIF
IF $AC_MEA[_MT_E]==0 GOTOF _FEHL1
ENDIF
IF _I_SP[0]==2
IF _MC_SIM
_M_POS=($AA_IW[_XX]/_H_INT[0])+$P_TOOLR+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_M_POS=$AA_MW[_XX]+$P_TOOLR+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
_TP[_NR,_P_XX]=_M_POS+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
IF _MC_SIM
_M_POS=(_M_POS+($AA_IW[_XX]/_H_INT[0]))/2
ELSE
_M_POS=(_M_POS+$AA_MW[_XX])/2
ENDIF
ENDIF
N180 G90 G0 AX[_XX]=_POS_X-_W
N190 AX[_ZZ]=_POS_Z
N200 _MXXA1:AX[_XX]=_M_POS
_POS_X=_M_POS
_MMXX0:_MA=2
IF _I_SP[1]==0 GOTOF _END IF _I_SP[1]==2 GOTOF _MMYYA0
IF _MC_SIM
N210 G1 F=$MNS_J_MEA_COLL_MONIT_FEED AX[_YY]=_POS_Y+_W
N215 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
ELSE
N210 G1 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_FEED AX[_YY]=_POS_Y+_W
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
N215 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
ENDIF
_SMI_R[1]=-ABS(_SMI_R[1])
N220 CYCLE971
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
N230 G0 AX[_ZZ]=_POS_Z
N240 AX[_YY]=_POS_Y
IF _I_SP[1]==1 GOTOF _MMYYA1
_MMYYA0:
IF _MC_SIM
N250 G1 F=$MNS_J_MEA_COLL_MONIT_FEED AX[_YY]=_POS_Y-_W
N255 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
ELSE
N250 G1 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_FEED AX[_YY]=_POS_Y-_W
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
N255 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
ENDIF
_SMI_R[1]=ABS(_SMI_R[1])
N260 CYCLE971
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
N270 G0 AX[_ZZ]=_POS_Z
N280 _MMYYA1:AX[_YY]=(_TP[_NR,_P_YY]+_TP[_NR,_P_YY+1])/2
IF _I_SP[0]==0 GOTOF _END
_KKXX: _MA=1
IF _I_SP[0]==2 GOTOF _KKXX0
IF _MC_SIM
N290 G1 F=$MNS_J_MEA_COLL_MONIT_FEED AX[_XX]=_POS_X+_W
N295 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
ELSE
N290 G1 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_FEED AX[_XX]=_POS_X+_W
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
N295 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
ENDIF
_SMI_R[1]=-ABS(_SMI_R[1])
N300 CYCLE971
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
N305 G0 AX[_ZZ]=_POS_Z
N306 AX[_XX]=_POS_X
IF _I_SP[0]==1 GOTOF _KKXX1
_KKXX0:
IF _MC_SIM
N310 G1 F=$MNS_J_MEA_COLL_MONIT_FEED AX[_XX]=_POS_X-_W
N315 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ] -_TP[_NR,9]
ELSE
N310 G1 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_FEED AX[_XX]=_POS_X-_W
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
N315 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ]-_TP[_NR,9]
STOPRE
IF $AC_MEA[_MT_E] GOTOF _FEHL0
ENDIF
_SMI_R[1]=ABS(_SMI_R[1])
N320 CYCLE971
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
N330 G0 AX[_ZZ]=_POS_Z
N340 _KKXX1: AX[_XX]=(_TP[_NR,_P_XX]+_TP[_NR,_P_XX+1])/2
_OVR[9]=E_MESS[9] _OVR[11]=E_MESS[11] _OVR[13]=E_MESS[13] _OVR[15]=E_MESS[15] _OVR[17]=E_MESS[17] _OVR[19]=E_MESS[19]
GOTOF _END
N630711 _FEHL0: SETAL(61302)
RET
N630712 _FEHL1: SETAL(61301)
RET
N630713 _FEHL2: SETAL(61166)
_END:
ENDIF
$P_CYCFRAME=CTRANS()
G[8]=_NPV
CUST_MEACYC(2)
_OVI[14]=0
STOPRE
_RETS: RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MT_LEN_SPF
PROC E_MT_LEN(INT _ST,STRING[32] _T,STRING[32] _TF,INT _DD,INT _NR,REAL _V,REAL _MAX,INT _WOPL,INT _MEASFR,INT _DN,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.20.00.00.006 ;DATE: 2022-02-01
;Cycle : measure-tool-length
DEF BOOL _EVM,_FRAES_DREH=0
DEF INT _M3_5,_MT_E,_ALARM,_P_XX,_P_YY,_P_ZZ,_TNU,_NPV,_TSNR=1,_MESSEN_MANU=0,_H_INT[3]=(1,1,1)
DEF INT _TEMP,_STAT,_MC_SIM,_K_STAT_ABS,_K_STAT_ORD,_K_STAT_APP,_H_AMODE[5]
DEF REAL _DREH,_MESS_F,_W_XX=0,_W_YY=0,_HH,_FAK2=1,_MPOS[2],_LTP6,_SMI_R2,_FA_INTERN,_J_CAL[12]
DEF STRING[100] _SERR=""
DEF STRING[40] _S_XX,_S_YY,_S_ZZ
DEF AXIS _XX,_YY,_ZZ
IF ($AN_NCK_VERSION<660000)
N630801 SETAL(61342)
RET
ENDIF
IF (_NR<1) OR (_NR>$MNS_MEA_CAL_TP_NUM)
N630802 SETAL(61313)
ENDIF
IF ($MCS_J_MEA_T_PROBE_APPR_MODE==1)
_MESSEN_MANU=1
ENDIF
IF NOT(($P_AD[1]>=200)AND($P_AD[1]<300)AND($P_AD[1]<>210)AND($P_AD[24]<>0)AND($P_AD[24]<>180))
IF ((_MESSEN_MANU==0)AND($P_TOOLR==0))
N630803 SETAL(61351)
RET
ENDIF
ENDIF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
_MIJ_I[2]=_NR _MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4]+1 _MIJ_I[7]=_TSNR
_NR=_NR-1
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_NR] _DEC2
_K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_NR] _DEC3
_K_STAT_APP=$SNS_MEA_TP_STATUS_GEN[_NR] _DEC4
_TP[_NR,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_NR],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_NR])
_TP[_NR,4]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_NR])
_TP[_NR,6]=SET($SNS_MEA_TP_EDGE_DISK_SIZE[_NR],$SNS_MEA_TP_AX_DIR_AUTO_CAL[_NR],$SNS_MEA_TP_TYPE[_NR],$SNS_MEA_TP_CAL_MEASURE_DEPTH[_NR])
_EVM=(_ST B_AND 'B10')
_AMODE=ABS(_AMODE)
_H_AMODE[2]=(_AMODE _DEC3)
_MIJ_I[0]=(_AMODE _DEC3)
IF (_H_AMODE[2]==1)
_V=0
ENDIF
IF ( ($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1) )
_FRAES_DREH=1
IF (_F_S_NR[1]==0)
_ALARM=61290 _OVI[9]=_ALARM
N630805 SETAL(_ALARM)
RET
ENDIF
_TEMP=$AC_MSNUM
IF _TEMP<=0
_ALARM=61287 _OVI[9]=_ALARM
N630715 SETAL(_ALARM)
ENDIF
IF (_F_S_NR[1]<>_TEMP)
SETMS(_F_S_NR[1])
ENDIF
ENDIF
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ((ABS($SC_TOOL_LENGTH_CONST)<>($P_GG[6]+16))AND($SC_TOOL_LENGTH_CONST<>0))
_ALARM=61024 _OVI[9]=_ALARM _SERR="SD42940"
N630804 SETAL(_ALARM,_SERR)
RET
ENDIF
IF (_ST B_AND 'B1')
_MIJ_I[6]=1
ENDIF
_LTP6=_TP[_NR,6]
IF (_LTP6<=0)
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N630806 SETAL(61230)
RET
ELSE
_LTP6=$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]
ENDIF
ENDIF
IF ($MCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000')
_MT_E=2
ELSE
_MT_E=1
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
_MC_SIM=0
IF ISVAR("$MN_SIM_ENVIRONMENT")
_MC_SIM=(($MN_SIM_ENVIRONMENT B_AND 'B100')*100)+(($MN_SIM_ENVIRONMENT B_AND 'B1'))
ELSE
IF $P_SIM
_MC_SIM=2
ENDIF
ENDIF
IF NOT(_MC_SIM)
IF (($MA_CTRLOUT_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[1,AX1]==0)AND($MA_CTRLOUT_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[1,AX2]==0)AND($MA_CTRLOUT_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[1,AX3]==0))
_MC_SIM=1
ENDIF
ENDIF
OFFN=0; E_TS_OFFN=0 ???
_SMI_R[10]=93101.901 _XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_S_XX=AXSTRING(_XX) _S_YY=AXSTRING(_YY) _S_ZZ=AXSTRING(_ZZ)
IF (_K_STAT_APP<>1)
_SERR=<<"-"<<_S_ZZ
N630807 SETAL(61374,_SERR)
ENDIF
_TEMP=$SNS_MEA_TP_TYPE[_NR]
IF (_TEMP MOD 10 == 1) AND (TRUNC(_TEMP/100)<>$P_GG[6])
N630808 SETAL(61415)
ENDIF
IF (($P_TOOL<=0)OR($P_TOOLL[1]==0))
IF ($P_TOOL==0)
N630809 SETAL(61311)
RET
ELSE
IF (_MESSEN_MANU==0)
N630810 SETAL(61351)
RET
ENDIF
ENDIF
ENDIF
IF ( (_ST B_AND 'B1')AND(_MESSEN_MANU==0) )
IF(E_RP>$P_EP[_ZZ])
N38 SBLON
N40 G0 G90 AX[_ZZ]=E_RP*_FAK2
N42 SBLOF
ENDIF
ENDIF
_NPV=$P_GG[8]
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000')
N630811 SETAL(61016)
RET
ENDIF
$P_CYCFRAME=CTRANS()
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
_OVI[2]=971 _OVI[14]=1
IF (_EVM)
IF (_MESSEN_MANU==1)
_MVAR=10101
ELSE
_MVAR=102
ENDIF
ELSE
IF ( (($P_AD[1]>=200)AND($P_AD[1]<300)AND($P_AD[1]<>210)AND($P_AD[24]<>0)AND($P_AD[24]<>180))OR($P_AD[1]==110)OR($P_AD[1]==111)OR($P_AD[1]==157) )
_MVAR=(_MESSEN_MANU*10000)+1
IF (_H_AMODE[2]<>2)
_MA=3
ENDIF
ELSE
IF ( (((_LTP6)/2<($P_TOOLR))AND(_H_AMODE[2]==0))OR(_H_AMODE[2]==2) )
_MVAR=(_MESSEN_MANU*10000)+2
ELSE
_MVAR=(_MESSEN_MANU*10000)+1
IF (_H_AMODE[2]<>2)
_MA=3
ENDIF
ENDIF
ENDIF
ENDIF
_P_XX=0 _P_YY=2 _P_ZZ=4
IF (_EVM)
_HH=ABS($MNS_J_MEA_M_DIST_TOOL_RADIUS)+$P_TOOLR
ELSE
_HH=$P_TOOLR
ENDIF
IF ( ((((2*_HH)>=(_LTP6))AND(_H_AMODE[2]==0))OR(_EVM)OR(_H_AMODE[2]==2))AND(_MESSEN_MANU<>1) )
IF (ABS($MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR])==1)OR(ABS($MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR])==0)
_MA=103
IF $MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR]<0
_W_XX=_HH
IF (_EVM)
IF ((_K_STAT_ABS<>1)AND(_K_STAT_ABS<>3) )
_SERR=<<"-"<<_S_XX
N630812 SETAL(61374,_SERR)
ELSE
_MPOS[0]=_TP[_NR,_P_XX]+_W_XX
ENDIF
ENDIF
ELSE
_W_XX=-_HH
IF (_EVM)
IF ( (_K_STAT_ABS<>2)AND(_K_STAT_ABS<>3) )
_SERR=<<"+"<<_S_XX
N630813 SETAL(61374,_SERR)
ELSE
_MPOS[0]=_TP[_NR,_P_XX+1]+_W_XX
ENDIF
ENDIF
ENDIF
IF (_EVM)
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==3) )
_MPOS[1]=(_TP[_NR,_P_YY]+_TP[_NR,_P_YY+1])/2
ELSE
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N630914 SETAL(61230)
RET
ENDIF
IF (_K_STAT_ORD==1)
_MPOS[1]=_TP[_NR,_P_YY]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_MPOS[1]=_TP[_NR,_P_YY+1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
ENDIF
ENDIF
ELSE
_MA=203
IF $MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR]<0
_W_YY=_HH
IF (_EVM)
IF ( (_K_STAT_ORD<>1)AND(_K_STAT_ORD<>3) )
_SERR=<<"-"<<_S_YY
N630815 SETAL(61374,_SERR)
ELSE
_MPOS[1]=_TP[_NR,_P_YY]+_W_YY
ENDIF
ENDIF
ELSE
_W_YY=-_HH
IF (_EVM)
IF ( (_K_STAT_ORD<>2)AND(_K_STAT_ORD<>3) )
_SERR=<<"+"<<_S_YY
N630816 SETAL(61374,_SERR)
ELSE
_MPOS[1]=_TP[_NR,_P_YY+1]+_W_YY
ENDIF
ENDIF
ENDIF
IF (_EVM)
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==3) )
_MPOS[0]=(_TP[_NR,_P_XX]+_TP[_NR,_P_XX+1])/2
ELSE
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N630817 SETAL(61230)
RET
ENDIF
IF (_K_STAT_ABS==1)
_MPOS[0]=_TP[_NR,_P_XX]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_MPOS[0]=_TP[_NR,_P_XX+1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
ENDIF
ENDIF
ENDIF
ELSE
_MA=3
ENDIF
_TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF (_MESSEN_MANU==1) GOTOF _MM2
IF ($AA_IW[_ZZ]/_H_INT[2])>_TP[_NR,_P_ZZ] GOTOF _MM1D
N630818 SETAL (61332)
RET
_MM1D:
IF($P_EP[_ZZ]<_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST))
N18 G0 G90 AX[_ZZ]=_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST)
ENDIF
IF (_EVM==0)
IF ( ((_K_STAT_ABS==0)OR(_K_STAT_ABS==3))AND((_K_STAT_ORD==0)OR(_K_STAT_ORD==3)) )
_MPOS[0]=(_TP[_NR,_P_XX]+_TP[_NR,_P_XX+1])/2 _MPOS[1]=(_TP[_NR,_P_YY]+_TP[_NR,_P_YY+1])/2
ELSE
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N630819 SETAL(61230)
RET
ENDIF
IF (_K_STAT_ABS==1)
_MPOS[0]=_TP[_NR,_P_XX]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_MPOS[0]=_TP[_NR,_P_XX+1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
IF (_K_STAT_ORD==1)
_MPOS[1]=_TP[_NR,_P_YY]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_MPOS[1]=_TP[_NR,_P_YY+1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
ENDIF
ENDIF
IF (_EVM)
N20 G0 G90 G94 AX[_XX]=_MPOS[0] AX[_YY]=_MPOS[1]
ELSE
N20 G0 G90 G94 AX[_XX]=_MPOS[0]+_W_XX AX[_YY]=_MPOS[1]+_W_YY
ENDIF
IF (_EVM) GOTOF _MM2
IF (($AA_IW[_ZZ]/_H_INT[2])>(_TP[_NR,_P_ZZ]+ABS($MNS_J_MEA_T_PROBE_MEASURE_DIST)))
IF _MC_SIM
N30 G1 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ]+ABS($MNS_J_MEA_T_PROBE_MEASURE_DIST)
ELSE
N30 G1 F=$MNS_J_MEA_COLL_MONIT_POS_FEED MEAS=_MT_E AX[_ZZ]=_TP[_NR,_P_ZZ]+ABS($MNS_J_MEA_T_PROBE_MEASURE_DIST)
STOPRE
IF $AC_MEA[_MT_E]
M5
N630820 SETAL(61302)
RET
ENDIF
ENDIF
ENDIF
_MM2:
_FA_INTERN=$MNS_J_MEA_T_PROBE_MEASURE_DIST
IF ( (_MESSEN_MANU==1)AND($MNS_J_MEA_T_PROBE_MEASURE_DIST>0) )
_FA_INTERN=$MNS_J_MEA_T_PROBE_MEASURE_DIST*(-1)
ENDIF
_SMI_R2=ABS(2*$MNS_J_MEA_T_PROBE_MEASURE_DIST)
_SMI_R[0]=SET($SNS_MEA_TP_FEED[_NR],_FA_INTERN,_SMI_R2,0,_SMI_R2,_SMI_R2,_SMI_R2,_SMI_R2) _KNUM=0
IF (_H_AMODE[2]==2)
_ID=_V
ELSE
_ID=0
ENDIF
IF ( (_MVAR _DEC1)<>2 ) GOTOF _MM3
_FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_LENGTH
IF ( (_MESSEN_MANU==1)AND($MNS_J_MEA_M_DIST_TOOL_LENGTH>0) )
_FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_LENGTH*(-1)
ENDIF
IF (_H_AMODE[2]==1)
_ID=0
ELSE
_ID=_V
ENDIF
_SMI_R[1]=SET(_FA_INTERN,ABS(2*$MNS_J_MEA_M_DIST_TOOL_LENGTH))
IF $MN_SCALING_SYSTEM_IS_METRIC
_DREH=$SNS_MEA_CM_MAX_PERI_SPEED[_TSNR]/2/$PI/0.001/$P_TOOLR
ELSE
_DREH=$SNS_MEA_CM_MAX_PERI_SPEED[_TSNR]*12/2/$PI/$P_TOOLR
ENDIF
IF _DREH>$SNS_MEA_CM_MAX_REVOLUTIONS[_TSNR]
_DREH=$SNS_MEA_CM_MAX_REVOLUTIONS[_TSNR]
ENDIF
_M3_5=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF (_M3_5<>0)
IF (_M3_5<1)OR(_M3_5>2)
N630821 SETAL(61102)
RET
ENDIF
IF(_M3_5==1)
_M3_5=4
ELSE
_M3_5=3
ENDIF
ELSE
_M3_5=$SNS_MEA_CM_SPIND_ROT_DIR[_TSNR]
ENDIF
N40 S=_DREH M=_M3_5
_MIJ_I[5]=_M3_5
STOPRE
_MM3:
IF ((_MVAR _DEC1)<>2)
M5
WAITS
ENDIF
CYCLE971
M5
$P_CYCFRAME=CTRANS()
G[8]=_NPV
D=$P_TOOL
CUST_MEACYC(2)
IF ((_ST B_AND 'B1')AND(_MESSEN_MANU==0))
IF(E_RP>$P_EP[_ZZ])
N40 SBLON
N45 G0 G90 AX[_ZZ]=E_RP
N50 SBLOF
ENDIF
ENDIF
IF ( (_ST B_AND 'B1')AND(ABS($P_AD[12])>_MAX)AND(_MESSEN_MANU==0) )
_TNU=$P_TOOLNO
$TC_TP8[_TNU]=$TC_TP8[_TNU] B_OR 4
N55 CYCLE206("0",1,_DN)
N60 CYCLE206(_T,1,_DN)
N70
N80 M5
ENDIF
_OVI[14]=0
STOPRE
_RETS: RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_MT_RAD_SPF
PROC E_MT_RAD(INT _ST,STRING[32] _T,STRING[32] _TF,INT _DD,INT _NR,REAL _V,REAL _MAX,INT _WOPL,INT _MEASFR,INT _DN,INT _AMODE) SAVE ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.20.00.00.006 ;DATE: 2022-02-01
;Cycle : measure-tool-radius
DEF BOOL _EVM,_FRAES_DREH=0
DEF INT _M3_5,_MT_E,_P_XX,_P_YY,_P_ZZ,_TNU,_I_MA,_I_VA,_NPV,_TSNR=1,_MESSEN_MANU=0,_H_INT[3]=(1,1,1)
DEF INT _TEMP,_STAT,_MC_SIM,_K_STAT_ABS,_K_STAT_ORD,_ALARM
DEF REAL _DREH,_MESS_F,_W_MAV,_W_VAV,_HH,_FAK2=1,_MPOS,_FA_INTERN,_SMI_R2,_J_CAL[12]
DEF STRING[100] _SERR=""
DEF STRING[40] _S_XX,_S_YY,_S_ZZ
DEF AXIS _XX,_YY,_ZZ,_MAV,_VAV
IF ($AN_NCK_VERSION<660000)
N630901 SETAL(61342)
RET
ENDIF
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
_EVM=(_ST B_AND 'B10')
_AMODE=ABS(_AMODE)
_MIJ_I[0]=(_AMODE _DEC1) _MIJ_I[8]=(_AMODE _DEC2)
IF ($MCS_J_MEA_T_PROBE_APPR_MODE==1)
_MESSEN_MANU=1
ENDIF
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
IF ( ($MCS_TECHNOLOGY==2)AND($MCS_TECHNOLOGY_EXTENSION==1) )
_FRAES_DREH=1
IF (_F_S_NR[1]==0)
_ALARM=61290 _OVI[9]=_ALARM
N630903 SETAL(_ALARM)
RET
ENDIF
_TEMP=$AC_MSNUM
IF _TEMP<=0
_ALARM=61287 _OVI[9]=_ALARM
N630715 SETAL(_ALARM)
ENDIF
IF (_F_S_NR[1]<>_TEMP)
SETMS(_F_S_NR[1])
ENDIF
ENDIF
IF (_NR<1) OR (_NR>$MNS_MEA_CAL_TP_NUM)
_ALARM=61313 _OVI[9]=_ALARM
N630904 SETAL(_ALARM)
ENDIF
_MIJ_I[2]=_NR _MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4]+1 _MIJ_I[7]=_TSNR
_NR=_NR-1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ((ABS($SC_TOOL_LENGTH_CONST)<>($P_GG[6]+16))AND($SC_TOOL_LENGTH_CONST<>0))
_ALARM=61024 _OVI[9]=_ALARM _SERR="SD42940"
N630902 SETAL(_ALARM,_SERR)
RET
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
_MC_SIM=0
IF ISVAR("$MN_SIM_ENVIRONMENT")
_MC_SIM=(($MN_SIM_ENVIRONMENT B_AND 'B100')*100)+(($MN_SIM_ENVIRONMENT B_AND 'B1'))
ELSE
IF $P_SIM
_MC_SIM=2
ENDIF
ENDIF
IF NOT(_MC_SIM)
IF (($MA_CTRLOUT_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[0,AX1]==0)AND($MA_ENC_TYPE[1,AX1]==0)AND($MA_CTRLOUT_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[0,AX2]==0)AND($MA_ENC_TYPE[1,AX2]==0)AND($MA_CTRLOUT_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[0,AX3]==0)AND($MA_ENC_TYPE[1,AX3]==0))
_MC_SIM=1
ENDIF
ENDIF
OFFN=0
_SMI_R[10]=93101.901 _XX=$P_AXN1 _YY=$P_AXN2 _ZZ=$P_AXN3
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
N34 G1 G90 F10 AX[_XX]=$AA_IW[_XX]/_H_INT[0] AX[_YY]=$AA_IW[_YY]/_H_INT[1] AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
_TEMP=$SNS_MEA_TP_TYPE[_NR]
IF (_TEMP MOD 10 == 1) AND (TRUNC(_TEMP/100)<>$P_GG[6])
N630905 SETAL(61309)
ENDIF
IF ($P_TOOL<=0)
N630906 SETAL(61311)
RET
ENDIF
IF ($P_TOOLL[1]==0)
IF (_MESSEN_MANU==0)
N630907 SETAL(61351)
RET
ENDIF
ENDIF
IF ($P_TOOLR<=0)
N630908 SETAL(61351)
RET
ENDIF
IF($MN_SCALING_SYSTEM_IS_METRIC)
IF($P_GG[13]==1)OR($P_GG[13]==3)
_FAK2=1/$MN_SCALING_VALUE_INCH
ENDIF
ELSE
IF($P_GG[13]==2)OR($P_GG[13]==4)
_FAK2=$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF ( (_ST B_AND 'B1')AND(_MESSEN_MANU==0) )
IF(E_RP>$P_EP[_ZZ])
N38 SBLON
N40 G0 G90 AX[_ZZ]=E_RP*_FAK2
N42 SBLOF
ENDIF
ENDIF
_NPV=$P_GG[8]
IF NOT($MC_MM_SYSTEM_FRAME_MASK B_AND 'B100000')
N630909 SETAL(61016)
RET
ENDIF
$P_CYCFRAME=CTRANS()
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
_OVI[2]=971 _OVI[14]=1
IF (_EVM)
_MVAR=(_MESSEN_MANU*10000)+102
ELSE
_MVAR=(_MESSEN_MANU*10000)+2
ENDIF
_TP[_NR,0]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX1[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX1[_NR],$SNS_MEA_TP_TRIG_MINUS_DIR_AX2[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX2[_NR])
_TP[_NR,4]=SET($SNS_MEA_TP_TRIG_MINUS_DIR_AX3[_NR],$SNS_MEA_TP_TRIG_PLUS_DIR_AX3[_NR])
_TP[_NR,6]=SET($SNS_MEA_TP_EDGE_DISK_SIZE[_NR],$SNS_MEA_TP_AX_DIR_AUTO_CAL[_NR],$SNS_MEA_TP_TYPE[_NR],$SNS_MEA_TP_CAL_MEASURE_DEPTH[_NR])
IF (_ST B_AND 'B1')
_MIJ_I[6]=1
ENDIF
IF ($MCS_MEA_FUNCTION_MASK B_AND 'B10000000000000000')
_MT_E=2
ELSE
_MT_E=1
ENDIF
_P_XX=0 _P_YY=2 _P_ZZ=4 _HH=ABS($MNS_J_MEA_M_DIST_TOOL_RADIUS)+$P_TOOLR
_K_STAT_ABS=$SNS_MEA_TP_STATUS_GEN[_NR] _DEC2
_K_STAT_ORD=$SNS_MEA_TP_STATUS_GEN[_NR] _DEC3
IF (ABS($MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR])==1)OR(ABS($MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR])==0)
_MA=1 _I_VA=_P_YY _MAV=_XX _VAV=_YY
_ALARM=61374
_S_XX=AXSTRING(_XX) _S_YY=AXSTRING(_YY) _S_ZZ=AXSTRING(_ZZ)
IF $MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR]<0
IF ((_K_STAT_ABS<>1)AND(_K_STAT_ABS<>3))
_SERR=<<"-"<<_S_XX
N630910 SETAL(_ALARM,_SERR)
ENDIF
_W_MAV=_HH _I_MA=_P_XX _FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS
IF ($MNS_J_MEA_M_DIST_TOOL_RADIUS>0)
_FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS*(-1)
ENDIF
ELSE
IF ((_K_STAT_ABS<>2)AND(_K_STAT_ABS<>3))
_SERR=<<"+"<<_S_XX
N630911 SETAL(_ALARM,_SERR)
ENDIF
_W_MAV=-_HH _I_MA=_P_XX+1 _FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS
IF ($MNS_J_MEA_M_DIST_TOOL_RADIUS<0)
_FA_INTERN=ABS($MNS_J_MEA_M_DIST_TOOL_RADIUS)
ENDIF
ENDIF
_ALARM=0
IF ( (_K_STAT_ORD==0)OR(_K_STAT_ORD==3) )
_MPOS=(_TP[_NR,_I_VA]+_TP[_NR,_I_VA+1])/2
ELSE
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N630912 SETAL(61230)
RET
ENDIF
IF (_K_STAT_ORD==1)
_MPOS=_TP[_NR,_I_VA]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_MPOS=_TP[_NR,_I_VA+1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
ENDIF
ELSE
_MA=2 _I_VA=_P_XX _MAV=_YY _VAV=_XX
_ALARM=61374
_S_XX=AXSTRING(_XX) _S_YY=AXSTRING(_YY) _S_ZZ=AXSTRING(_ZZ)
IF $MNS_J_MEA_T_PROBE_APPR_AX_DIR[_NR]<0
IF ((_K_STAT_ORD<>1)AND(_K_STAT_ORD<>3))
_SERR=<<"-"<<_S_YY
N630913 SETAL(_ALARM,_SERR)
ENDIF
_W_MAV=_HH _I_MA=_P_YY _FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS
IF ($MNS_J_MEA_M_DIST_TOOL_RADIUS>0)
_FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS*(-1)
ENDIF
ELSE
IF ((_K_STAT_ORD<>2)AND(_K_STAT_ORD<>3))
_SERR=<<"+"<<_S_YY
N630914 SETAL(_ALARM,_SERR)
ENDIF
_W_MAV=-_HH _I_MA=_P_YY+1 _FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS
IF ($MNS_J_MEA_M_DIST_TOOL_RADIUS<0)
_FA_INTERN=ABS($MNS_J_MEA_M_DIST_TOOL_RADIUS)
ENDIF
ENDIF
_ALARM=0
IF ( (_K_STAT_ABS==0)OR(_K_STAT_ABS==3) )
_MPOS=(_TP[_NR,_I_VA]+_TP[_NR,_I_VA+1])/2
ELSE
IF ($MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]<=0)
N630915 SETAL(61230)
RET
ENDIF
IF (_K_STAT_ABS==1)
_MPOS=_TP[_NR,_I_VA]-$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ELSE
_MPOS=_TP[_NR,_I_VA+1]+$MNS_J_MEA_T_PROBE_DIAM_RAD[_NR]/2
ENDIF
ENDIF
ENDIF
_TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF (_MESSEN_MANU==1) GOTOF _MM2
IF ($AA_IW[_ZZ]/_H_INT[2])>_TP[_NR,_P_ZZ] GOTOF _MM1D
N630916 SETAL(61332)
RET
_MM1D:
IF($P_EP[_ZZ]<_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST_TOOL_LENGTH))
N18 G0 G90 AX[_ZZ]=_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST_TOOL_LENGTH)
ENDIF
N20 G0 G90 G94 AX[_MAV]=_TP[_NR,_I_MA]+_W_MAV AX[_VAV]=_MPOS
IF (_MC_SIM)
N30 G1 F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST_TOOL_LENGTH)
ELSE
N30 G1 MEAS=_MT_E F=$MNS_J_MEA_COLL_MONIT_POS_FEED AX[_ZZ]=_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST_TOOL_LENGTH)
STOPRE
IF $AC_MEA[_MT_E]
M5
N630917 SETAL(61302)
RET
ENDIF
ENDIF
_MM2:
IF (_MESSEN_MANU==0)
_FA_INTERN=$MNS_J_MEA_M_DIST_TOOL_RADIUS
ENDIF
_SMI_R2=ABS(2*$MNS_J_MEA_M_DIST_TOOL_RADIUS)
_SMI_R[0]=SET($SNS_MEA_TP_FEED[_NR],_FA_INTERN,_SMI_R2,0,_SMI_R2,_SMI_R2,_SMI_R2,_SMI_R2) _ID=_V _KNUM=0
IF $MN_SCALING_SYSTEM_IS_METRIC
_DREH=$SNS_MEA_CM_MAX_PERI_SPEED[_TSNR]/2/$PI/0.001/$P_TOOLR
ELSE
_DREH=$SNS_MEA_CM_MAX_PERI_SPEED[_TSNR]*12/2/$PI/$P_TOOLR
ENDIF
IF _DREH>$SNS_MEA_CM_MAX_REVOLUTIONS[_TSNR]
_DREH=$SNS_MEA_CM_MAX_REVOLUTIONS[_TSNR]
ENDIF
_M3_5=TRUNC($TC_DP25[$P_TOOLNO,1]/256)MOD 4
IF _M3_5<>0
IF (_M3_5<1)OR(_M3_5>2)
N630918 SETAL(61102)
RET
ENDIF
IF(_M3_5==1)
_M3_5=4
ELSE
_M3_5=3
ENDIF
ELSE
_M3_5=$SNS_MEA_CM_SPIND_ROT_DIR[_TSNR]
ENDIF
N40 S=_DREH M=_M3_5
_MIJ_I[5]=_M3_5
STOPRE
CYCLE971
M5
$P_CYCFRAME=INVFRAME($P_ACTFRAME)
IF (_MESSEN_MANU==0)
N100 G0 AX[_ZZ]=_TP[_NR,_P_ZZ]+2*ABS($MNS_J_MEA_M_DIST_TOOL_LENGTH)
ENDIF
G[8]=_NPV
CUST_MEACYC(2)
IF ( (_ST B_AND 'B1')AND(_MESSEN_MANU==0) )
IF(E_RP>$P_EP[_ZZ])
N40 SBLON
N45 G0 G90 AX[_ZZ]=E_RP
N50 SBLOF
ENDIF
ENDIF
IF ( (_ST B_AND 'B1')AND(ABS($P_AD[15])>_MAX)AND(_MESSEN_MANU==0) )
_TNU=$P_TOOLNO
$TC_TP8[_TNU]=$TC_TP8[_TNU] B_OR 4
N55 CYCLE206("0",1,_DN)
N60 CYCLE206(_T,1,_DN)
N70
N80 M5
ENDIF
_OVI[14]=0
STOPRE
_RETS: RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_F_MS_CAL_SPF
PROC F_MS_CAL(INT _ST,REAL _VAL,INT _PRNR, INT _CALNR,INT _WOPL,INT _MEASFR,INT _VAL1,INT _VAL2,REAL _H_VMS,INT _NAXIS) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.005 ;DATE: 2024-04-12
;Cycle : calibrating workpiece measuring probe on turning machine
DEF REAL _J_CAL[12]
DEF INT _TEMP,_NPV,_ADT1,_H_INT[3]=(1,1,1)
DEF INT _A, _O, _AP
DEF AXIS _XX,_YY,_ZZ
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
_MIJ_I[1]=_PRNR _SMI_R[8]=0
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_NPV
ELSE
IF (_MIJ_I[4] <> 100)
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >= 17) AND (_MIJ_I[3] <= 19)
IF (_MIJ_I[3] == 17)
N26 G17
ELSE
IF (_MIJ_I[3] == 18)
N27 G18
ELSE
IF (_MIJ_I[3] == 19)
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($P_GG[6] == 1)
_A=1 _O=2 _AP=3
ELSE
IF ($P_GG[6] == 2)
_A=3 _O=1 _AP=2
ELSE
_A=2 _O=3 _AP=1
ENDIF
ENDIF
IF(ISAXIS(_A))
_XX=$P_AXN1
ENDIF
IF(ISAXIS(_O))
_YY=$P_AXN2
ENDIF
IF(ISAXIS(_AP))
_ZZ=$P_AXN3
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630101 SETAL(61311)
ENDIF
OFFN=0
_SMI_R[10]=93101.901
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
G1 G90 F10
IF(ISAXIS(_A))
N34 AX[_XX]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
N35 AX[_YY]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
N36 AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
_SETVAL=_VAL _KNUM=0 _OVI[2]=973 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
IF _H_VMS == 0
_H_VMS=$SCS_MEA_FEED_MEASURE
ENDIF
_SMI_R[0]=SET(_H_VMS,$MNS_J_MEA_M_DIST_MANUELL,$MNS_J_MEA_M_DIST_MANUELL) _STA1=0
_MA = _NAXIS
_MD = _VAL1
_CALNUM = _CALNR
IF(_ST _DEC1 == 0)
_MVAR = 0
IF(_ST _DEC7 == 1)
_MVAR = 1000000
ENDIF
ENDIF
IF(_ST _DEC1 == 1)
_MVAR = 0
ENDIF
IF(_ST _DEC1 == 2)
_MVAR = 1113
IF(_ST _DEC7 == 1)
_MVAR = 1001113
ENDIF
_MD = 1
ENDIF
IF(_ST _DEC1 == 3)
_MVAR = 1113
IF(_VAL2 == 2)
_MVAR = 12113
IF(_ST _DEC5 == 1)
_MVAR = 02113
ENDIF
ENDIF
ENDIF
CYCLE973
CUST_MEACYC(2)
E_MESS[13] = _NAXIS
E_MESS[13] = E_MESS[13] + (_VAL1 * 10)
E_MESS[13] = E_MESS[13] + ((_ST _DEC5) * 100)
STOPRE
_OVI[14]=0
RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_F_MS_CAN_SPF
PROC F_MS_CAN(INT _ST,INT _NPV,REAL _VAL,INT _PRNR,INT _WOPL,INT _MEASFR,INT _NAXIS,REAL _ANG, INT _DIR) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.013 ;DATE: 2024-06-17
;Cycle : measure front edge, inside diameter, outside diameter
DEF REAL _FA_SW=1,_VAL_I,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ,_MAV
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF INT _A, _O, _AP
DEF FRAME _REL_FRAME
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
_MIJ_I[1]=_PRNR _SMI_R[8]=0
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($P_GG[6] == 1)
_A=1 _O=2 _AP=3
ELSE
IF ($P_GG[6] == 2)
_A=3 _O=1 _AP=2
ELSE
_A=2 _O=3 _AP=1
ENDIF
ENDIF
IF(ISAXIS(_A))
_XX=$P_AXN1
ENDIF
IF(ISAXIS(_O))
_YY=$P_AXN2
ENDIF
IF(ISAXIS(_AP))
_ZZ=$P_AXN3
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630201 SETAL(61311)
ENDIF
E_MESS_AM=0
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2))OR(($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF (_ADT1<>580) AND (_ADT1<>710)
N630104 SETAL(61307)
RET
ENDIF
_MVAR = _ST
_MVAR = _MVAR + 100
_MD = _DIR
IF (_MVAR _DEC1 == 0)
_MD = 1
ENDIF
IF (_MVAR _DEC1 == 2)
_MVAR= _MVAR - 2
ENDIF
IF (_MVAR _DEC1 == 1)
_MVAR= _MVAR - 1
ENDIF
IF (_MVAR _DEC5 == 1)
_MVAR=_MVAR - 10000 + 1000 - 100
ENDIF
_SETVAL = _VAL
_STA1 = _ANG
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
G1 G90 F10
IF(ISAXIS(_A))
N34 AX[_XX]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
N35 AX[_YY]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
N36 AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
_VAL_I=_VAL*_FA_SW _MA=_NAXIS _OVI[2]=974 _KNUM=0 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
_SMI_R[0]=SET($SNS_MEA_WP_FEED[_PRNR-1],$MNS_J_MEA_M_DIST_MANUELL,ABS($MNS_J_MEA_M_DIST_MANUELL),ABS($MNS_J_MEA_M_DIST_MANUELL)*1.01,ABS($MNS_J_MEA_M_DIST_MANUELL)*1.01,ABS($MNS_J_MEA_M_DIST_MANUELL)*1.01,ABS($MNS_J_MEA_M_DIST_MANUELL)*(-1.01))
IF _MA==1
_MAV=_XX
ELSE
IF _MA==2
_MAV=_YY
ELSE
_MAV=_ZZ
ENDIF
ENDIF
CYCLE974
CUST_MEACYC(2)
IF(ISAXIS(_A))
E_MESS[0]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
E_MESS[1]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
E_MESS[2]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
E_MESS[_MA-1]=_OVR[4+_MA] _OVI[14]=0
E_MESS[13] = _NAXIS
E_MESS[13] = E_MESS[13] + (_MD * 10)
STOPRE
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
IF NOT($MNS_MEA_FUNCTION_MASK B_AND 'B10000000')
_REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR]+$P_UIFR[_KNUM,_XX,FI]
_REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR]+$P_UIFR[_KNUM,_YY,FI]
_REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI]
_REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,FI]=0
ENDIF
ELSE
IF NOT($MNS_MEA_FUNCTION_MASK B_AND 'B10000000')
_REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
ENDIF
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630207 SETAL(61321)
ENDIF
IF($MC_MM_NUM_BASE_FRAMES <> 0)
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630208 SETAL(_ALARM)
ENDIF
_OVI[0]=_KNUM _OVR[_MA]=_VAL*_FA_SW _OVR[0]=_OVR[_MA] _OVR[16]=SET(0,0,0,0)
CYCLE115(_ALARM,_MAV,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630209 SETAL(_ALARM+1000)
ENDIF
G[8]=_A_NPV
ELSE
E_MEAS=E_MESS[_MA-1]
ENDIF
STOPRE
_RETS: RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_F_MS_DIAM_SPF
PROC F_MS_DIAM(INT _ST,INT _NPV,REAL _VAL,INT _PRNR,INT _WOPL,INT _MEASFR,REAL _VAL1, REAL _VAL2, INT _NAXIS) ACTBLOCNO DISPLOF
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.015 ;DATE: 2024-07-15
;Cycle : measure front edge, inside diameter, outside diameter with 2 measure points
DEF REAL _FA_SW=1,_VAL_I,_J_CAL[12]
DEF AXIS _XX,_YY,_ZZ,_MAV
DEF INT _ALARM,_A_NPV,_HNUM,_M_BFNR,_TEMP,_STAT,_ADT1,_H_INT[3]=(1,1,1)
DEF INT _A, _O, _AP
DEF FRAME _REL_FRAME
IF(_E_S_LINE)AND(_E_S_LINE<>$P_LINENO[0]) GOTOF _RETS
_E_S_LINE=0
IF $MN_SCALING_SYSTEM_IS_METRIC
N21 G71
ELSE
N22 G70
ENDIF
_ADT1=$P_ADT[1]
_MIJ_I[1]=_PRNR _SMI_R[8]=0
_MIJ_I[3]=_WOPL _MIJ_I[4]=_MEASFR _A_NPV=_MIJ_I[4] + 1
IF (_MIJ_I[4] >= 0) AND (_MIJ_I[4] < $MC_MM_NUM_USER_FRAMES)
N24 G[8]=_A_NPV
ELSE
IF _MIJ_I[4] <>100
N25 G500
ENDIF
ENDIF
IF (_MIJ_I[3] >=17) AND (_MIJ_I[3] <=19)
IF _MIJ_I[3] ==17
N26 G17
ELSE
IF _MIJ_I[3] ==18
N27 G18
ELSE
IF _MIJ_I[3] ==19
N28 G19
ENDIF
ENDIF
ENDIF
ELSE
_MIJ_I[3]=$P_GG[6] + 16
ENDIF
IF ($P_GG[6] == 1)
_A=1 _O=2 _AP=3
ELSE
IF ($P_GG[6] == 2)
_A=3 _O=1 _AP=2
ELSE
_A=2 _O=3 _AP=1
ENDIF
ENDIF
IF(ISAXIS(_A))
_XX=$P_AXN1
ENDIF
IF(ISAXIS(_O))
_YY=$P_AXN2
ENDIF
IF(ISAXIS(_AP))
_ZZ=$P_AXN3
ENDIF
IF ($MC_GCODE_RESET_VALUES[46]==2)OR($P_GG[47]==2)
N30 G290
N32 D=$P_TOOL DL=$P_DLNO
ENDIF
IF $P_TOOL==0
N630201 SETAL(61311)
ENDIF
E_MESS_AM=0
OFFN=0
_SMI_R[10]=93101.901
IF ((($MN_SCALING_SYSTEM_IS_METRIC==0)AND($P_GG[13]==2))OR(($MN_SCALING_SYSTEM_IS_METRIC==1)AND($P_GG[13]==1)))
IF $MN_SCALING_SYSTEM_IS_METRIC
_FA_SW=$MN_SCALING_VALUE_INCH
ELSE
_FA_SW=1/$MN_SCALING_VALUE_INCH
ENDIF
ENDIF
IF (_ADT1<>580) AND (_ADT1<>710)
N630104 SETAL(61307)
RET
ENDIF
IF (_ST _DEC1 == 1) AND (_ST _DEC4 > 0)
IF (_VAL2 < $AA_IW[_XX]); wenn kleiner als Istposition, dann Umfahrweite auf Istposition vergrern, damit kein crash
_VAL2 = $AA_IW[_XX]
ENDIF
ENDIF
IF (((_ST _DEC4)==0) AND ((_ST _DEC1)==1))
_ST = _ST + 1
_ST = _ST + 10000
ENDIF
IF (((_ST _DEC4) > 0) AND ($MCS_MEA_FUNCTION_MASK B_AND 'B10'))
_NAXIS=_NAXIS + ((_ST _DEC4) * 100)
IF (_NAXIS == 201)
_NAXIS = 1
ENDIF
ENDIF
_ST = _ST - ((_ST _DEC4) * 1000)
_MVAR = _ST
_SETVAL = _VAL
_SZO = _VAL1
_SZA = _VAL2
_STA1=0
IF ($MC_DIAMETER_AX_DEF <> "")AND($MC_TOOL_PARAMETER_DEF_MASK B_AND 'B1000000')
IF (($MC_DIAMETER_AX_DEF == AXSTRING(_XX)) OR ($MA_BASE_FUNCTION_MASK[_XX] B_AND 'B100')) AND NOT($P_DIAM_STAT[_XX] B_AND 'B1')
_H_INT[0]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_YY)) OR ($MA_BASE_FUNCTION_MASK[_YY] B_AND 'B100')) AND NOT($P_DIAM_STAT[_YY] B_AND 'B1')
_H_INT[1]=2
ENDIF
IF (($MC_DIAMETER_AX_DEF==AXSTRING(_ZZ)) OR ($MA_BASE_FUNCTION_MASK[_ZZ] B_AND 'B100')) AND NOT($P_DIAM_STAT[_ZZ] B_AND 'B1')
_H_INT[2]=2
ENDIF
ENDIF
G1 G90 F10
IF(ISAXIS(_A))
N34 AX[_XX]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
N35 AX[_YY]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
N36 AX[_ZZ]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
_VAL_I=_VAL*_FA_SW _MA=_NAXIS _OVI[2]=994 _KNUM=0 _OVI[14]=1 _TEMP=2
CYCLE216(_J_CAL,_TEMP)
CUST_MEACYC(1)
_SMI_R[0]=SET($SCS_MEA_FEED_MEASURE,$MNS_J_MEA_M_DIST_MANUELL,ABS($MNS_J_MEA_M_DIST_MANUELL),ABS($MNS_J_MEA_M_DIST_MANUELL)*1.01,ABS($MNS_J_MEA_M_DIST_MANUELL)*1.01,ABS($MNS_J_MEA_M_DIST_MANUELL)*1.01,ABS($MNS_J_MEA_M_DIST_MANUELL)*(-1.01))
_NAXIS = _NAXIS _DEC1
IF _NAXIS==1
_MAV=_XX
ELSE
IF _NAXIS==2
_MAV=_YY
ELSE
_MAV=_ZZ
ENDIF
ENDIF
CYCLE994
CUST_MEACYC(2)
IF(ISAXIS(_A))
E_MESS[0]=$AA_IW[_XX]/_H_INT[0]
ENDIF
IF(ISAXIS(_O))
E_MESS[1]=$AA_IW[_YY]/_H_INT[1]
ENDIF
IF(ISAXIS(_AP))
E_MESS[2]=$AA_IW[_ZZ]/_H_INT[2]
ENDIF
E_MESS[_NAXIS-1]=_OVR[4+_NAXIS] _OVI[14]=0
E_MESS[13] = _NAXIS
E_MESS[13] = E_MESS[13] + (_MD * 10)
STOPRE
IF _NPV<>100
_A_NPV=$P_GG[8] _KNUM=_NPV
IF _NPV==0
_KNUM=1000
ENDIF
IF _KNUM<=1000
IF _KNUM<1000
IF (_A_NPV==1) OR (_KNUM <> _A_NPV-1)
E_MESS_AM=10
ENDIF
_REL_FRAME=$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
IF NOT($MNS_MEA_FUNCTION_MASK B_AND 'B10000000')
_REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR]+$P_UIFR[_KNUM,_XX,FI]
_REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR]+$P_UIFR[_KNUM,_YY,FI]
_REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]+$P_UIFR[_KNUM,_ZZ,FI]
_REL_FRAME[_XX,FI]=0 _REL_FRAME[_YY,FI]=0 _REL_FRAME[_ZZ,FI]=0
ENDIF
ELSE
IF NOT($MNS_MEA_FUNCTION_MASK B_AND 'B10000000')
_REL_FRAME[_XX,TR]=$P_UIFR[_KNUM,_XX,TR] _REL_FRAME[_YY,TR]=$P_UIFR[_KNUM,_YY,TR] _REL_FRAME[_ZZ,TR]=$P_UIFR[_KNUM,_ZZ,TR]
ENDIF
ENDIF
E_MESS_RETT=$P_UIFR[_KNUM] $P_UIFR[_KNUM]=_REL_FRAME
ELSE
IF _A_NPV <> 1
E_MESS_AM=10
ENDIF
IF $MC_MM_NUM_BASE_FRAMES>0
_M_BFNR=$MC_MM_NUM_BASE_FRAMES-1 E_MESS_RETT=$P_CHBFR[_M_BFNR] $P_CHBFR[_M_BFNR]=$P_CHBFR[_M_BFNR]:$P_IFRAME
IF $MN_MM_FRAME_FINE_TRANS
$P_CHBFR[_M_BFNR,_XX,TR]=$P_CHBFR[_M_BFNR,_XX,TR]+$P_CHBFR[_M_BFNR,_XX,FI] $P_CHBFR[_M_BFNR,_XX,FI]=0
$P_CHBFR[_M_BFNR,_YY,TR]=$P_CHBFR[_M_BFNR,_YY,TR]+$P_CHBFR[_M_BFNR,_YY,FI] $P_CHBFR[_M_BFNR,_YY,FI]=0
$P_CHBFR[_M_BFNR,_ZZ,TR]=$P_CHBFR[_M_BFNR,_ZZ,TR]+$P_CHBFR[_M_BFNR,_ZZ,FI] $P_CHBFR[_M_BFNR,_ZZ,FI]=0
ENDIF
ELSE
_ALARM=61321
ENDIF
ENDIF
ELSE
IF _KNUM==2000
E_MESS_RETT=$P_SETFR
ELSE
IF _KNUM < 1051
_M_BFNR=_KNUM-1011 E_MESS_RETT=$P_CHBFR[_M_BFNR]
ELSE
IF _KNUM < 1066
_M_BFNR=_KNUM-1051 E_MESS_RETT=$P_NCBFR[_M_BFNR]
ELSE
IF (_A_NPV==1) AND ($P_CHBFRMASK==0)
N630207 SETAL(61321)
ENDIF
IF($MC_MM_NUM_BASE_FRAMES <> 0)
_HNUM=1 _STAT=1
FOR _TEMP=1 TO $MC_MM_NUM_BASE_FRAMES
IF $P_CHBFRMASK B_AND _HNUM
_M_BFNR=_STAT-1
ENDIF
_HNUM=_HNUM*2 _STAT=_STAT+1
ENDFOR
E_MESS_RETT=$P_CHBFR[_M_BFNR]
ENDIF
ENDIF
ENDIF
ENDIF
ENDIF
IF _ALARM
N630208 SETAL(_ALARM)
ENDIF
_OVI[0]=_KNUM _OVR[_NAXIS]=_VAL*_FA_SW _OVR[0]=_OVR[_NAXIS] _OVR[16]=SET(0,0,0,0)
CYCLE115(_ALARM,_MAV,0)
E_MESS[0]=SET(_OVR[25],_OVR[26],_OVR[27])
_OVI[9]=_ALARM
IF _ALARM
N630209 SETAL(_ALARM+1000)
ENDIF
G[8]=_A_NPV
ELSE
E_MEAS=E_MESS[_NAXIS-1]
ENDIF
STOPRE
_RETS: RET

;$ACCESS=70771
;$PATH=/_N_CST_DIR/_N_E_PRT_JOG_SPF
PROC E_PRT_JOG SBLOF DISPLOF ACTBLOCNO
;VERSION: 06.24.00.00 ;DATE: 2024-07-15
;CHANGE : 06.24.00.00.012 ;DATE: 2024-06-11
DEF INT _S_PICT,_S_PROT
DEF INT _SPDEC1,_SPDEC2,_SPDEC3,_SPDEC4,_SPDEC5,_MESSAX_NO,_MVAR1,_MVAR5
DEF REAL _DIF16,_DIF17,_DIF18,_DIF19
DEF STRING[160] _S_PATH
DEF STRING[14] _SWA1,_SWA2,_SWA3,_SWMA,_MWMA,_DIF4,_DIF5,_DIF6,_DIF7
_S_PICT=10
_SPDEC1=2 _SPDEC2=0
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H10000000')=='H10000000'
_SPDEC4=1
ELSE
_SPDEC4=0
ENDIF
IF ($SCS_MEA_FUNCTION_MASK B_AND 'H20000000')=='H20000000'
_SPDEC3=1
ELSE
_SPDEC3=0
ENDIF
IF STRLEN($SCS_J_MEA_PROTOCOL_FILE)<160
_S_PATH=$SCS_J_MEA_PROTOCOL_FILE
ELSE
GOTOF _FEHL1
ENDIF
IF (_S_PATH=="")
_SPDEC5=0
ELSE
_SPDEC5=1
ENDIF
_S_PROT=(10000*_SPDEC5)+(1000*_SPDEC4)+(100*_SPDEC3)+(10*_SPDEC2)+_SPDEC1
CYCLE150(_S_PICT,_S_PROT,_S_PATH)
cycle154
CUST_MEAPROT(1)
_PROTNAME[1]="_N_E_PRT_JOG_SPF" ;$P_PROG[$P_STACK]
_HEADLINE[9]=""
IF (_OVI[2]==977) OR (_OVI[2]==978)
_MVAR5=_MVAR _DEC5
IF (_MVAR5==1)
_HEADLINE[9]="                 Spindle reversal"
ENDIF
IF (_MVAR5==2)
_HEADLINE[9]="                 Align 3D probe"
ENDIF
ENDIF
_HEADLINE[10]="Measuring plane: G"<<(NUMBER(S_TXT[25])+16)
_HEADLINE[11]="Probe no.      : "<<_OVI[5]
_MESSAX_NO=_MA _DEC1
_MWMA="_OVR["<<(_MESSAX_NO+4)<<"]"
IF _KNUM>0
_SWA1=",_OVR[1],"
_SWA2=",_OVR[2],"
_SWA3=",_OVR[0],"
ELSE
_SWA1=",,"
_SWA2=",,"
_SWA3=",,"
ENDIF
IF _KNUM>0
IF _MESSAX_No==1
_SWMA=",_OVR[1],"
ELSE
IF _MESSAX_No==2
_SWMA=",_OVR[2],"
ENDIF
IF _MESSAX_No==3
_SWMA=",_OVR[0],"
ENDIF
ENDIF
ELSE
_SWMA=",,"
ENDIF
_DIF16=_OVR[16] _DIF17=_OVR[17] _DIF18=_OVR[18] _DIF19=_OVR[19]
IF (_OVI[16]==0) AND ((_OVI[2]==973) OR (_OVI[2]==974) OR (_OVI[2]==994))
cycle151
RET
ENDIF
IF (_OVI[16]==0) AND (_OVI[2]==976)
cycle151
RET
ENDIF
IF (_OVI[16]==0) AND ((_OVI[2]==971) OR (_OVI[2]==982))
cycle151
RET
ENDIF
IF (_OVI[16]==0) AND ((_OVI[2]==977) OR (_OVI[2]==978))
GOTOF _MA2
ENDIF
IF (_OVI[16]==131)
GOTOF _MA1
ELSE
GOTOF _FEHL3
ENDIF
_MA1:
_OVR[16]=_OVR[4]-_OVR[0]
_OVR[17]=_OVR[5]-_OVR[1]
_OVR[18]=_OVR[6]-_OVR[2]
_OVR[19]=_OVR[7]-_OVR[3]
IF _KNUM>0
_DIF4=",_OVR[16]," _DIF5=",_OVR[17]," _DIF6=",_OVR[18]," _DIF7=",_OVR[19],"
ELSE
_DIF4=",," _DIF5=",," _DIF6=",," _DIF7=",,"
ENDIF
CASE _OVI[17] OF 0 GOTOF _M0 10 GOTOF _M10 11 GOTOF _M11 20 GOTOF _M20 3 GOTOF _M3 13 GOTOF _M13 4 GOTOF _M4 14 GOTOF _M14 5 GOTOF _M5 15 GOTOF _M15 6 GOTOF _M6 16 GOTOF _M16
GOTOF _FEHL2
_M0:
_HEADLINE[8]="Results measure: Spacing 2 edges"
_PROTFORM[4]=2 S_TXT[67]=" 0"
IF _KNUM>0
_OVR[16]=_OVR[NUMBER(SUBSTR(_MWMA,5,1))]-_OVR[NUMBER(SUBSTR(_SWMA,6,1))]
_PROTVAL[5]="<<S_TXT[14]<<S_TXT[67]"<<_SWMA<<_MWMA<<",_OVR[16],"<<S_TXT[3]
ELSE
_PROTVAL[5]="<<S_TXT[14]<<S_TXT[67]"<<_SWMA<<_MWMA<<",,"<<S_TXT[3]
ENDIF
_PROTVAL[6]="Distance<<S_TXT[14],,_OVR[4],,"<<S_TXT[3]
GOTOF _MA1_END
_M10:
IF (_OVI[2]==977)
_HEADLINE[8]="Results measure: 2 Holes/circular spigots"
ELSE
_HEADLINE[8]="Results measure: Align edge"
ENDIF
_PROTFORM[4]=1
IF _KNUM>0
_PROTVAL[5]="Angle to<<S_TXT[15],_OVR[0],_OVR[4],_OVR[16],deg"
ELSE
_PROTVAL[5]="Angle to<<S_TXT[15],,_OVR[4],,deg"
ENDIF
GOTOF _MA1_END
_M11:
_HEADLINE[8]="Results measure: 2 Holes/circular spigots"
_PROTFORM[4]=3 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Angle to<<S_TXT[11]"<<_SWA3<<"_OVR[4]"<<_DIF4<<"deg"
GOTOF _MA1_END
_M20:
_HEADLINE[8]="Results measure: Align plane"
_PROTFORM[4]=2
_PROTVAL[5]="Angle to<<S_TXT[11],,_OVR[4],,deg"
_PROTVAL[6]="Angle to<<S_TXT[12],,_OVR[5],,deg"
GOTOF _MA1_END
_M3:
_HEADLINE[8]="Results measure: 3 Holes/circular spigots"
_PROTFORM[4]=3 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Diameter,,_OVR[7],,"<<S_TXT[3]
GOTOF _MA1_END
_M13:
_HEADLINE[8]="Results measure: 3 Holes/circular spigots"
_PROTFORM[4]=4 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Diameter,,_OVR[7],,"<<S_TXT[3]
_PROTVAL[8]="Angle to<<S_TXT[11]"<<_SWA3<<"_OVR[4]"<<_DIF4<<"deg"
GOTOF _MA1_END
_M4:
_HEADLINE[8]="Results measure: 4 Holes/circular spigots"
_PROTFORM[4]=2 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
GOTOF _MA1_END
_M14:
_HEADLINE[8]="Results measure: 4 Holes/circular spigots"
_PROTFORM[4]=3 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Angle to<<S_TXT[11]"<<_SWA3<<"_OVR[4]"<<_DIF4<<"deg"
GOTOF _MA1_END
_M5:
_HEADLINE[8]="Results measure: Rectangular outside corner"
_PROTFORM[4]=3 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Angle to<<S_TXT[11],,_OVR[4],,deg"
GOTOF _MA1_END
_M15:
_HEADLINE[8]="Results measure: Rectangular inside corner"
_PROTFORM[4]=3 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Angle to<<S_TXT[11],,_OVR[4],,deg"
GOTOF _MA1_END
_M6:
_HEADLINE[8]="Results measure: Any outside corner"
_PROTFORM[4]=4 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Corner,,_OVR[7],,deg"
_PROTVAL[8]="Angle to<<S_TXT[11],,_OVR[4],,deg"
GOTOF _MA1_END
_M16:
_HEADLINE[8]="Results measure: Any inside corner"
_PROTFORM[4]=4 S_TXT[67]="0"
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67]"<<_SWA1<<"_OVR[5]"<<_DIF5<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67]"<<_SWA2<<"_OVR[6]"<<_DIF6<<S_TXT[3]
_PROTVAL[7]="Corner,,_OVR[7],,deg"
_PROTVAL[8]="Angle to<<S_TXT[11],,_OVR[4],,deg"
GOTOF _MA1_END
_MA1_END:
cycle152
GOTOF _END
RET
_MA2:
CASE _OVI[2] OF 977 GOTOF _M977 978 GOTOF _M978
_M977:
_MVAR1=_MVAR _DEC1
CASE _MVAR1 OF 1 GOTOF _M977_1 2 GOTOF _M977_2 5 GOTOF _M977_5 6 GOTOF _M977_6
GOTOF _FEHL4
_M977_1:
_HEADLINE[8]="Results measure: 1 Hole"
_PROTFORM[4]=3 S_TXT[67]="0"
_OVR[17]=_OVR[5]-_OVR[1]
_OVR[18]=_OVR[6]-_OVR[2]
IF _KNUM>0
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ELSE
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67],,_OVR[5],,"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67],,_OVR[6],,"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ENDIF
GOTOF _MA2_END
_M977_2:
_HEADLINE[8]="Results measure: 1 Circular spigot"
_PROTFORM[4]=3 S_TXT[67]="0"
_OVR[17]=_OVR[5]-_OVR[1]
_OVR[18]=_OVR[6]-_OVR[2]
IF _KNUM>0
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ELSE
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67],,_OVR[5],,"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67],,_OVR[6],,"<<S_TXT[3]
_PROTVAL[7]="Diameter,_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ENDIF
GOTOF _MA2_END
_M977_5:
_HEADLINE[8]="Results measure: Rectangular pocket"
GOTOF _M977_7
_M977_6:
_HEADLINE[8]="Results measure: Rectangular spigot"
GOTOF _M977_7
_M977_7:
_PROTFORM[4]=4 S_TXT[67]="0"
_OVR[16]=_OVR[4]-_OVR[0]
_OVR[17]=_OVR[5]-_OVR[1]
_OVR[18]=_OVR[6]-_OVR[2]
_OVR[19]=_OVR[7]-_OVR[3]
IF _KNUM>0
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67],_OVR[2],_OVR[6],_OVR[18],"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67],_OVR[3],_OVR[7],_OVR[19],"<<S_TXT[3]
IF _OVR[0]>=_OVR[1]
_PROTVAL[7]="LENGTH<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
_PROTVAL[8]="Width<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
ELSE
_PROTVAL[7]="LENGTH<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[8]="Width<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ENDIF
ELSE
_PROTVAL[5]="<<S_TXT[11]<<S_TXT[67],,_OVR[6],,"<<S_TXT[3]
_PROTVAL[6]="<<S_TXT[12]<<S_TXT[67],,_OVR[7],,"<<S_TXT[3]
IF _OVR[0]>=_OVR[1]
_PROTVAL[7]="LENGTH<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
_PROTVAL[8]="Width<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
ELSE
_PROTVAL[7]="LENGTH<<S_TXT[12],_OVR[1],_OVR[5],_OVR[17],"<<S_TXT[3]
_PROTVAL[8]="Width<<S_TXT[11],_OVR[0],_OVR[4],_OVR[16],"<<S_TXT[3]
ENDIF
ENDIF
GOTOF _MA2_END
_M978:
_HEADLINE[8]="Results measure: Edge"
_PROTFORM[4]=1 S_TXT[67]="0"
IF _KNUM>0
_OVR[16]=_OVR[4]-_OVR[NUMBER(SUBSTR(_SWMA,6,1))]
_PROTVAL[5]="<<S_TXT[14]<<S_TXT[67]"<<_SWMA<<"_OVR[4],_OVR[16],"<<S_TXT[3]
ELSE
_PROTVAL[5]="<<S_TXT[14]<<S_TXT[67],,_OVR[4],,"<<S_TXT[3]
ENDIF
GOTOF _MA2_END
_MA2_END:
cycle152
GOTOF _END
RET
_END:
_OVR[16]=_DIF16 _OVR[17]=_DIF17 _OVR[18]=_DIF18 _OVR[19]=_DIF19
cycle157(_PROTFORM[2])
RET
_FEHL1: STOPRE
N615091 SETAL(61360,"$SCS_J_MEA_PROTOCOL_FILE")
RET
_FEHL2: STOPRE
N615092 SETAL(61360," _OVI[17]="<<_OVI[17])
RET
_FEHL3: STOPRE
N615093 SETAL(61360," _OVI[16]="<<_OVI[16])
RET
_FEHL4: STOPRE
N615094 SETAL(61360,"_MVAR _DEC1")
RET

