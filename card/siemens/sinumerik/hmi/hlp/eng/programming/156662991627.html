<html>
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Frame calculation from three measuring points in space (MEAFRAME)</title>
  </head>
  <body id="bodyID">
    <div id="nsbanner">
      <div id="TitleRowDefault">
        <h1 class="title">Frame calculation from three measuring points in space (MEAFRAME)</h1>
      </div>
    </div>
    <div id="nstext" valign="bottom">
      <p>
      </p>
      <p>The MEAFRAME function is used to support measuring cycles. It calculates the frame from three ideal points and the corresponding measured points.</p>
      <p>When a workpiece is positioned for machining, its position relative to the Cartesian machine coordinate system is generally both offset and rotated in relation to its ideal position. For exact machining or measuring either a costly physical adjustment of the part is required or the motions defined in the part program must be changed.</p>
      <p>A frame can be defined by sampling three points in space whose ideal positions are known. A touch-trigger probe or optical sensor is used for sampling that touches special holes precisely fixed on the supporting plate or probe balls. </p>
      <a name="block_1">
      </a>
      <h3 class="Blocktitle">Syntax</h3>MEAFRAME(&lt;ideal points>,&lt;measuring points>,&lt;quality>)<a name="block_2"></a><h3 class="Blocktitle">Meaning</h3><a id="table_5e274608-ca26-4e91-b4a7-1d171e997887"></a> <a id="table_0"></a> <a id="table_5e274608-ca26-4e91-b4a7-1d171e997887"></a> <a id="table_0"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_default" border="1"><colgroup><col width="26.6%"><col width="11.3%"><col width="11.3%"><col width="50.8%"></colgroup><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left"><code>MEAFRAME</code>:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">Function call</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;ideal points></code>:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">2-dim. REAL array containing the three coordinates of the ideal points</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;measuring points></code>:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">2-dim. REAL array containing the three coordinates of the measured points</p></td></tr><tr valign="top"><td rowspan="6"><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;quality></code>:</p><p type="p_table_l" align="left"></p><p type="p_table_l" align="left"></p><p type="p_table_l" align="left"></p><p type="p_table_l" align="left"></p><p type="p_table_l" align="left"></p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">Variable with which information on the quality of the FRAME calculation is returned</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">Type:</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">VAR REAL</p></td></tr><tr valign="top"><td rowspan="4"><p type="p_table_l" style="margin-top: 4px" align="left">Value:</p><p type="p_table_l" align="left"></p><p type="p_table_l" align="left"></p><p type="p_table_l" align="left"></p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">-1</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">The ideal points are almost on a straight line: The frame could not be calculated. The returned FRAME variable contains a neutral frame.</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">-2</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">The measuring points are almost on a straight line: The frame could not be calculated. The returned FRAME variable contains a neutral frame.</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">-4</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">The calculation of the rotation matrix failed for a different reason.</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">≥ 0.0</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Sum of distortions (distances between the points), that are required to transform the measured triangle into a triangle that is congruent to the ideal triangle.</p></td></tr></table></p><p class="comment"></p><table cellpadding="0" cellspacing="0" border="0"><tr><td><font size="1px"></font></td></tr></table><table class="safety" border="1" bgcolor="#eeeeee" style="margin-bottom:10px"><colgroup><col width="5%"><col width="95%"></colgroup><tr><td><b>Note</b></td></tr><tr><td><h4 class="Blocklabel">Quality of the measurement</h4><p class="safety">In order to map the measured coordinates onto the ideal coordinates using a rotation and a translation, the triangle formed by the measured points must be congruent to the ideal triangle. This is achieved by means of a compensation algorithm that minimizes the sum of squared deviations needed to reshape the measured triangle into the ideal triangle.</p><p class="safety">Since the effective distortion can be used to judge the quality of the measurement, MEAFRAME returns it as an additional variable.</p></td></tr></table><table cellpadding="0" cellspacing="0" border="0"><tr><td><font size="1px"></font></td></tr></table><table class="safety" border="1" bgcolor="#eeeeee"><colgroup><col width="5%"><col width="95%"></colgroup><tr><td><b>Note</b></td></tr><tr><td><p class="safety">The frame created by MEAFRAME can be transformed by the ADDFRAME function into another frame in the frame chain (see example "Chaining with ADDFRAME").</p></td></tr></table><a name="block_3"></a><h3 class="Blocktitle">Examples</h3><h4 class="Blocklabel">Example 1:</h4><p>Part program 1:</p><a id="table_56c24ced-a7a5-4a76-9062-ecc86184a489"></a> <a id="table_1"></a> <a id="table_56c24ced-a7a5-4a76-9062-ecc86184a489"></a> <a id="table_1"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_listing" border="1" id="EZE"><colgroup><col width="58.0%"><col width="42.0%"></colgroup><tr valign="top"><th>Program code</th><th> </th></tr><tr valign="top"><td>...</td><td> </td></tr><tr valign="top"><td>DEF FRAME CORR_FRAME</td><td> </td></tr></table><textarea id="textarea" style="display: none;" value="">clipboard</textarea></p><p></p><p>Setting measuring points:</p><a id="table_838fb602-8fa3-4439-9fdc-1bd4b6a55b62"></a> <a id="table_2"></a> <a id="table_838fb602-8fa3-4439-9fdc-1bd4b6a55b62"></a> <a id="table_2"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_listing" border="1" id="ETF"><colgroup><col width="58.0%"><col width="42.0%"></colgroup><tr valign="top"><th>Program code</th><th>Comment</th></tr><tr valign="top"><td colspan="2">DEF REAL IDEAL_POINT[3,3]=
SET(10.0,0.0,0.0,0.0,10.0,0.0,0.0,0.0,10.0)</td></tr><tr valign="top"><td>DEF REAL MEAS_POINT[3,3]=
SET(10.1,0.2,-0.2,-0.2,10.2,0.1,-0.2,0.2,9.8)</td><td>; For test.</td></tr><tr valign="top"><td colspan="2"> </td></tr><tr valign="top"><td colspan="2">DEF REAL FIT_QUALITY=0</td></tr><tr valign="top"><td>DEF REAL ROT_FRAME_LIMIT=5</td><td>; Permits max. five degree rotation of the part position.</td></tr><tr valign="top"><td>DEF REAL FIT_QUALITY_LIMIT=3</td><td>; Permits max. 3 mm offset between the 
ideal and the measured triangle.</td></tr><tr valign="top"><td>DEF REAL SHOW_MCS_POS1[3]</td><td> </td></tr><tr valign="top"><td>DEF REAL SHOW_MCS_POS2[3]</td><td> </td></tr><tr valign="top"><td>DEF REAL SHOW_MCS_POS3[3]</td><td> </td></tr></table><textarea id="textarea" style="display: none;" value="">clipboard</textarea></p><p></p><a id="table_f1156932-5964-4528-bd51-58cef85ca0c6"></a> <a id="table_3"></a> <a id="table_f1156932-5964-4528-bd51-58cef85ca0c6"></a> <a id="table_3"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_listing" border="1" id="EVH"><colgroup><col width="58.0%"><col width="42.0%"></colgroup><tr valign="top"><th>Program code</th><th>Comment</th></tr><tr valign="top"><td>N100 G01 G90 F5000</td><td> </td></tr><tr valign="top"><td>N110 X0 Y0 Z0</td><td> </td></tr><tr valign="top"><td colspan="2">N200 CORR_FRAME=MEAFRAME(IDEAL_POINT,MEAS_POINT,FIT_QUALITY)</td></tr><tr valign="top"><td>N230 IF FIT_QUALITY &lt; 0SETAL(65000)GOTOF NO_FRAMEENDIF</td><td> </td></tr><tr valign="top"><td>N240 IF FIT_QUALITY > FIT_QUALITY_LIMITSETAL(65010)GOTOF NO_FRAMEENDIF</td><td> </td></tr><tr valign="top"><td>N250 IF CORR_FRAME[X,RT] > ROT_FRAME_LIMIT</td><td>; Limiting the 1st RPY angle.</td></tr><tr valign="top"><td>SETAL(65020)GOTOF NO_FRAMEENDIF</td><td> </td></tr><tr valign="top"><td>N260 IF CORR_FRAME[Y,RT] > ROT_FRAME_LIMIT</td><td>; Limiting the 2nd RPY angle.</td></tr><tr valign="top"><td>SETAL(65021)GOTOF NO_FRAMEENDIF</td><td> </td></tr><tr valign="top"><td>N270 IF CORR_FRAME[Z,RT] > ROT_FRAME_LIMIT</td><td>; Limiting the 3rd RPY angle.</td></tr><tr valign="top"><td>SETAL(65022)GOTOF NO_FRAMEENDIF</td><td> </td></tr><tr valign="top"><td>N300 $P_IFRAME=CORR_FRAME</td><td>; Activate sample frame with settable frame.</td></tr><tr valign="top"><td> </td><td>; Check frame by positioning the geometry axes to the ideal point.</td></tr><tr valign="top"><td>N400 X=IDEAL_POINT[0,0] Y=IDEAL_POINT[0,1] 
Z=IDEAL_POINT[0,2]</td><td> </td></tr><tr valign="top"><td>N410 SHOW_MCS_POS1[0]=$AA_IM[X]</td><td> </td></tr><tr valign="top"><td>N420 SHOW_MCS_POS1[1]=$AA_IM[Y]</td><td> </td></tr><tr valign="top"><td>N430 SHOW_MCS_POS1[2]=$AA_IM[Z]</td><td> </td></tr><tr valign="top"><td colspan="2">N500 X=IDEAL_POINT[1,0] Y=IDEAL_POINT[1,1] Z=IDEAL_POINT[1,2]</td></tr><tr valign="top"><td>N510 SHOW_MCS_POS2[0]=$AA_IM[X]</td><td> </td></tr><tr valign="top"><td>N520 SHOW_MCS_POS2[1]=$AA_IM[Y]</td><td> </td></tr><tr valign="top"><td>N530 SHOW_MCS_POS2[2]=$AA_IM[Z]</td><td> </td></tr><tr valign="top"><td colspan="2">N600 X=IDEAL_POINT[2,0] Y=IDEAL_POINT[2,1] Z=IDEAL_POINT[2,2]</td></tr><tr valign="top"><td>N610 SHOW_MCS_POS3[0]=$AA_IM[X]</td><td> </td></tr><tr valign="top"><td>N620 SHOW_MCS_POS3[1]=$AA_IM[Y]</td><td> </td></tr><tr valign="top"><td>N630 SHOW_MCS_POS3[2]=$AA_IM[Z]</td><td> </td></tr><tr valign="top"><td>N700 G500</td><td>; Deactivate settable frame as with zero frame (no value entered, pre-assigned). </td></tr><tr valign="top"><td>No_FRAME</td><td>; Deactivate settable frame, as pre-assigned with zero frame (no value entered).</td></tr><tr valign="top"><td>M0</td><td> </td></tr><tr valign="top"><td>M30</td><td> </td></tr></table><textarea id="textarea" style="display: none;" value="">clipboard</textarea></p><p></p><h4 class="Blocklabel">Example 2: Chaining of frames</h4><p><b>Chaining of MEAFRAME for offsets</b></p><p>The MEAFRAME function returns an offset frame. If this offset frame is chained to the settable frame $P_UIFR[1] that was active during the call of the function (e.g. G54), a settable frame is provided for further conversions for the traversing or machining.</p><p><b>Chaining with ADDFRAME</b></p><p>If you want this offset frame in the frame chain to apply at a different position or if other frames are active before the settable frame, the ADDFRAME function can be used for chaining into one of the channel basic frames or a system frame.</p><p>The following must not be active in the frames:</p><ul><li><p>Mirroring with MIRROR</p></li><li><p>Scaling with SCALE</p></li></ul><p>The input parameters for the setpoints and actual values are the workpiece coordinates. These coordinates must always be specified metrically or in inches (G71/G70) and radius-related (DIAMOF) in the basic system of the control.</p><p><b>Additional information</b> on ADDFRAME, see Function Manual Basic Functions.</p></div>
  </body>
</html>