<html>
  <head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>Process DataShare - Ausgabe auf ein externes Gerät/Datei (EXTOPEN, WRITE, EXTCLOSE)</title>
  </head>
  <body id="bodyID">
    <div id="nsbanner">
      <div id="TitleRowDefault">
        <h1 class="title">Process DataShare - Ausgabe auf ein externes Gerät/Datei (EXTOPEN, WRITE, EXTCLOSE)</h1>
      </div>
    </div>
    <div id="nstext" valign="bottom">
      <p>
      </p>
      <p>Das Schreiben von Daten aus einem Teileprogramm heraus auf ein externes Gerät/Datei erfolgt in drei Schritten: </p>
      <ol>
        <li>
          <p>Externes Gerät/Datei öffnen</p>
          <p>Mit dem Befehl EXTOPEN wird das externe Gerät/Datei für den Kanal zum Schreiben geöffnet. </p>
        </li>
        <li>
          <p>Daten schreiben</p>
          <p>Das Ausgabedatum kann mit den Stringfunktionen der NC-Sprache, z. B. SPRINT, aufbereitet werden. Das Schreiben selbst erfolgt über den WRITE-Befehl.</p>
        </li>
        <li>
          <p>Externes Gerät/Datei schließen</p>
          <p>Mit dem Befehl EXTCLOSE oder durch Erreichen des Programmendes (M30) sowie bei Kanal-Reset wird das im Kanal belegte externe Gerät/Datei wieder freigegeben.</p>
        </li>
      </ol>
      <a name="block_1">
      </a>
      <h3 class="Blocktitle">Syntax</h3>
      <a id="table_b4a65940-3686-462b-a4d2-16b04ae39680">
      </a> <a id="table_0"></a> <a id="table_b4a65940-3686-462b-a4d2-16b04ae39680"></a> <a id="table_0"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_sourcecode" border="1" id="EOB"><colgroup><col width="100.0%"></colgroup><tr valign="top"><td>DEF INT &lt;Result></td></tr><tr valign="top"><td>DEF STRING[&lt;n>] &lt;Output></td></tr><tr valign="top"><td>…</td></tr><tr valign="top"><td>EXTOPEN(&lt;Result>,&lt;ExtDev>,&lt;SyncMode>,&lt;AccessMode>,&lt;WriteMode>)</td></tr><tr valign="top"><td>…</td></tr><tr valign="top"><td>&lt;Output>="Ausgabe Daten"</td></tr><tr valign="top"><td>WRITE(&lt;Result>,&lt;ExtDev>,&lt;Output>)</td></tr><tr valign="top"><td>…</td></tr><tr valign="top"><td>EXTCLOSE(&lt;Result>,&lt;ExtDev>)</td></tr></table><textarea id="textarea" style="display: none;" value="">clipboard</textarea></p><a name="block_2"></a><h3 class="Blocktitle">Bedeutung</h3><a id="table_e8e99a99-81ed-4288-91d1-9be646910a68"></a> <a id="table_1"></a> <a id="table_e8e99a99-81ed-4288-91d1-9be646910a68"></a> <a id="table_1"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_default" border="1"><colgroup><col width="21.0%"><col width="10.0%"><col width="6.0%"><col width="8.0%"><col width="55.0%"></colgroup><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left"><code>EXTOPEN</code>:</p></td><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left">Vordefinierte Prozedur zum Öffnen eines externen Geräts/Datei</p></td></tr><tr valign="top"><td rowspan="16"><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;Result></code>:</p></td><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Parameter 1:</b> Ergebnisvariable</p><p type="p_table_l" align="left">Anhand des Ergebnisvariablenwerts kann im Programm das Gelingen der Operation ausgewertet und entsprechend fortgefahren werden.</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">Typ:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">INT</p></td></tr><tr valign="top"><td rowspan="14"><p type="p_table_l" style="margin-top: 4px" align="left">Werte:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">0</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">kein Fehler</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">1</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">externes Gerät kann nicht geöffnet werden</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">2</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">externes Gerät ist nicht projektiert</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">3</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">externes Gerät mit ungültigem Pfad projektiert</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">4</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">keine Zugriffsrechte für externes Gerät</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">5</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Benutzungsmodus: externes Gerät bereits "exklusiv" belegt</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">6</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Benutzungsmodus: externes Gerät bereits "shared" belegt</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">7</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Dateilänge größer als LOCAL_DRIVE_MAX_FILESIZE</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">8</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">maximale Anzahl externer Geräte überschritten</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">9</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Option für LOCAL_DRIVE nicht gesetzt</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">11</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">reserviert</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">12</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Schreibmodus: Angabe widersprüchlich zu extdev.ini</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">16</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">ungültiger externer Pfad programmiert</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">22</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">externes Gerät nicht gemountet</p></td></tr><tr valign="top"><td rowspan="9"><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;ExtDev></code>:</p></td><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Parameter 2:</b> Symbolischer Bezeichner für das zu öffnende externe Gerät/Datei</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">Typ:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">STRING</p></td></tr><tr valign="top"><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left">Der symbolische Bezeichner besteht aus:</p><ol class="table"><li><p>dem logischen Gerätenamen</p></li><li><p>ggf. gefolgt von einem Dateipfad (angehängt mit "/").</p></li></ol><p type="p_table_l" align="left">Folgende <b>logische Gerätenamen</b> sind definiert:</p></td></tr><tr valign="top"><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"LOCAL_DRIVE"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Lokale SD Card (vordefiniert)</p></td></tr><tr valign="top"><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"CYC_DRIVE"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">reservierte Laufwerksangabe zur Verwendung in SIEMENS-Zyklen (vordefiniert)</p></td></tr><tr valign="top"><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"/dev/ext/1"</code>, ...<br /><code>"/dev/ext/9"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Verfügbare Netzlaufwerke</p><p type="p_table_l" align="left"><b>Hinweis:</b><br />Projektierung in der Datei extdev.ini erforderlich!</p></td></tr><tr valign="top"><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"/dev/cyc/1"</code>,<code><br />"/dev/cyc/2"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">reservierte Laufwerksangaben zur Verwendung in SIEMENS-Zyklen</p><p type="p_table_l" align="left"><b>Hinweis:<br /></b>Projektierung in der Datei extdev.ini erforderlich!</p></td></tr><tr valign="top"><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Dateipfad:</b></p><ul class="table"><li><p>Zu "LOCAL_DRIVE" und "CYC_DRIVE" muss ein Dateipfad angegeben werden, z. B.:</p><p>"LOCAL_DRIVE/my_dir/my_file.txt"</p></li><li><p>Die logischen Gerätenamen "/dev/ext/1...9" und "/dev/cyc/1...2" können per Projektierung:</p><ul><li><p>schon auf eine Datei verweisen, dann darf nur der logische Gerätenamen angegeben werden, z. B.:</p><p>"/dev/ext/4"</p></li><li><p>oder auf ein Verzeichnis, dann muss ein Dateipfad angegeben werden, z. B.:</p><p>"/dev/ext/5/my_dir/my_file.txt"</p></li></ul><p></p></li></ul></td></tr><tr valign="top"><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Hinweis:<br /></b>Für die logischen Gerätenamen "/dev/ext/1...9", "/dev/v24" und "/dev/cyc/1...2" wird Groß-/Kleinschreibung ignoriert, bei der Pfadangabe zu einer Datei ist Groß-/Kleinschreibung signifikant. Für "LOCAL_DRIVE" und "CYC_DRIVE" ist nur Großschreibung zulässig.</p></td></tr><tr valign="top"><td rowspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;SyncMode></code>:</p></td><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Parameter 3:</b> Bearbeitungsmodus für die WRITE-Befehle zu diesem Gerät/Datei</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">Typ:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">STRING</p></td></tr><tr valign="top"><td rowspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Werte:</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"SYN"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Synchrones Schreiben</p><p type="p_table_l" align="left">Die Programmausführung wird angehalten, bis der Schreibvorgang abgeschlossen ist.</p><p type="p_table_l" align="left">Die erfolgreiche Beendigung des synchronen Schreibens kann durch Auswerten der Fehlervariablen des WRITE-Befehls überprüft werden. </p></td></tr><tr valign="top"><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"ASYN"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Asynchrones Schreiben</p><p type="p_table_l" align="left">Die Programmausführung wird durch den WRITE-Befehl nicht unterbrochen.</p><p type="p_table_l" align="left"><b>Hinweis:</b><br />Die Ergebnisvariable des WRITE-Befehls ist in diesem Modus nicht aussagekräftig und hat immer den Wert 0 (kein Fehler). Es gibt in diesem Modus keine Sicherheit, dass der WRITE-Befehl erfolgreich war.</p></td></tr><tr valign="top"><td rowspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;AccessMode></code>:</p></td><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Parameter 4:</b> Benutzungsmodus für dieses Gerät/Datei</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">Typ:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">STRING</p></td></tr><tr valign="top"><td rowspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Werte:</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"SHARED"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Gerät/Datei wird im "Shared"-Modus angefordert. Andere Kanäle können das Gerät mitverwenden, d. h. ebenfalls in diesem Modus öffnen.</p></td></tr><tr valign="top"><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"EXCL"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Gerät/Datei wird in dem Kanal exklusiv verwendet, kein anderer Kanal kann das Gerät mitverwenden.</p></td></tr><tr valign="top"><td rowspan="5"><p type="p_table_l" style="margin-top: 4px" align="left"><code>&lt;WriteMode></code>:</p><p type="p_table_l" align="left"></p></td><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Parameter 5:</b> Schreibmodus für die WRITE-Befehle zu diesem Gerät/Datei (optional)</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left">Typ:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left">STRING</p></td></tr><tr valign="top"><td rowspan="2"><p type="p_table_l" style="margin-top: 4px" align="left">Werte:</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"APP"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Anhängen</p><p type="p_table_l" align="left">Die Datei bleibt in ihrem Inhalt erhalten, Schreibaufrufe fügen an das Ende an.</p></td></tr><tr valign="top"><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left"><code>"OVR"</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left">Überschreiben</p><p type="p_table_l" align="left">Der Inhalt der Datei wird gelöscht und durch nachfolgende Schreibaufrufe neu erstellt.</p></td></tr><tr valign="top"><td colspan="4"><p type="p_table_l" style="margin-top: 4px" align="left"><b>Hinweis:<br /></b>Mit diesem Parameter kann der in der Datei extdev.ini projektierte Schreibmodus nicht überschrieben werden. Im Konfliktfall wird der EXTOPEN-Aufruf mit Fehler quittiert.</p></td></tr></table></p><a id="table_480b1478-4fed-90b4-4bcc-9b00e47e9ac2"></a> <a id="table_2"></a> <a id="table_480b1478-4fed-90b4-4bcc-9b00e47e9ac2"></a> <a id="table_2"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_default" border="1"><colgroup><col width="21.0%"><col width="79.0%"></colgroup><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment"><code>WRITE</code>:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">Vordefinierte Prozedur zum Schreiben der Ausgabedaten</p></td></tr></table></p><a id="table_704e74fe-8071-c667-0332-e23831e8f6ba"></a> <a id="table_3"></a> <a id="table_704e74fe-8071-c667-0332-e23831e8f6ba"></a> <a id="table_3"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_default" border="1"><colgroup><col width="21.0%"><col width="10.0%"><col width="6.0%"><col width="63.0%"></colgroup><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment"><code>EXTCLOSE</code>:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">Vordefinierte Prozedur zum Schließen eines geöffneten externen Geräts/Datei</p></td></tr><tr valign="top"><td rowspan="5"><p type="p_table_l" style="margin-top: 4px" align="left" class="comment"><code>&lt;Result></code>:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left" class="comment"><b>Parameter 1:</b> Ergebnisvariable</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">Typ:</p></td><td colspan="2"><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">INT</p></td></tr><tr valign="top"><td rowspan="3"><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">Werte:</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">0</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">kein Fehler</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">16</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">ungültiger externer Pfad programmiert</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">21</p></td><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment">Fehler beim Schließen des externen Geräts</p></td></tr><tr valign="top"><td><p type="p_table_l" style="margin-top: 4px" align="left" class="comment"><code>&lt;ExtDev></code>:</p></td><td colspan="3"><p type="p_table_l" style="margin-top: 4px" align="left" class="comment"><b>Parameter 2: </b>Symbolischer Bezeichner für das zu schließende externe Gerät/DateiBeschreibung siehe unter EXTOPEN!</p><p type="p_table_l" align="left" class="comment"><b>Hinweis:<br /></b>Der Bezeichner muss identisch zu dem im EXTOPEN-Aufruf angegebenen Bezeichner sein!</p></td></tr></table></p><a name="block_3"></a><h3 class="Blocktitle">Beispiel</h3><a id="table_a6710145-a68c-4b50-bcec-cf09667aac94"></a> <a id="table_4"></a> <a id="table_a6710145-a68c-4b50-bcec-cf09667aac94"></a> <a id="table_4"></a> <p><table width="100%" cellspacing="0" cellpadding="0" class="table_listing" border="1" id="EXLAC"><colgroup><col width="12.1%"><col width="87.9%"></colgroup><tr valign="top"><th colspan="2">Programmcode</th></tr><tr valign="top"><td>N10</td><td>DEF INT RESULT</td></tr><tr valign="top"><td>N20</td><td>DEF BOOL EXTDEVICE</td></tr><tr valign="top"><td>N30</td><td>DEF STRING[80] OUTPUT</td></tr><tr valign="top"><td>N40</td><td>DEF INT PHASE</td></tr><tr valign="top"><td>N50</td><td>EXTOPEN(RESULT,"LOCAL_DRIVE/my_file.txt","SYN","SHARED")</td></tr><tr valign="top"><td>N60</td><td>IF RESULT > 0</td></tr><tr valign="top"><td>N70</td><td>   MSG("Fehler bei EXTOPEN:" &lt;&lt; RESULT)</td></tr><tr valign="top"><td>N80</td><td>ELSE</td></tr><tr valign="top"><td>N90</td><td>   EXTDEVICE=TRUE</td></tr><tr valign="top"><td>N100</td><td>ENDIF</td></tr><tr valign="top"><td colspan="2">…</td></tr><tr valign="top"><td>N200</td><td>PHASE=4</td></tr><tr valign="top"><td>N210</td><td>IF EXTDEVICE</td></tr><tr valign="top"><td>N220</td><td>   OUTPUT=SPRINT("Ende Phase: %D",PHASE)</td></tr><tr valign="top"><td>N230</td><td>   WRITE(RESULT,"LOCAL_DRIVE/my_file.txt",OUTPUT)</td></tr><tr valign="top"><td>N240</td><td>ENDIF</td></tr><tr valign="top"><td colspan="2">…</td></tr></table><textarea id="textarea" style="display: none;" value="">clipboard</textarea></p></div>
  </body>
</html>